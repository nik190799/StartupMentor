(function ($) {
    $.fn.stackedRows = function(options) {
    	  
    	var settings = $.extend({
            classPrefix: "sr",
            firstRowHeader : true,       
            showLabels : true,
            altRowStyle : true                     
        }, options);

    	   
	    var obj = {
		 	colNames : Array(),
	   		numRows : 0,
	    	tableTypes : Array('withTbody', 'noTbody'),
	    	tableType : '',
	    	cols : '',
	    	body : '',
	    	findCols : function(curTable){
				var tableType = 1;		
				if(curTable.find('thead > tr > th').length > 0){
					obj.cols = curTable.find('thead > tr > th');
					curTable.find('thead > tr').addClass(settings.classPrefix +'-header');
					tableType = obj.tableTypes[0];
				}else if(curTable.find('thead > tr > td').length > 0){
					obj.cols = curTable.find('thead > tr > td');
					curTable.find('thead > tr').addClass(settings.classPrefix +'-header');
					tableType = obj.tableTypes[0];
				}else if(curTable.find('tbody > tr > th').length > 0){
					obj.cols = curTable.find('tbody > tr > th');
					curTable.find('tbody > tr:first-child').addClass(settings.classPrefix +'-header');
					tableType = obj.tableTypes[1];
				}else{
					obj.cols = curTable.find('tr:first-child > td');
					curTable.find('tr:first-child').addClass(settings.classPrefix +'-header');
					tableType = obj.tableTypes[1];
				}
				obj.tableType = tableType;
	    	},
	     	findBody : function(curTable){
		    	var body = '';
				switch(obj.tableType){
					case 'withTbody': 
						body = curTable.find('tbody tr');
						break;
					case 'noTbody':
						if(settings.firstRowHeader == true){
							body = curTable.find('tr:not(:first-child)');
						}else{
							body = curTable.find('tr');
						}	
					break;
				} 
				obj.body = body;
		    	}
	    };
 

		this.each(function(x){ //selector passed to plugin
			
			var curTable = $(this);		
		 	curTable.css({"width":"100%"});

			obj.findCols(curTable);
			obj.findBody(curTable);
			obj.cols.each(function(){
				obj.colNames.push($(this).html());
			});
			obj.body.each(function(q){
			  	var curRow = 'row-'+q;
	            obj.numRows++;
	            obj[curRow] = Array();
	            $(this).addClass(settings.classPrefix + '-' + curRow + ' '+ settings.classPrefix +'-hide');
	            $(this).find('td').each(function(){
	                var contents = $(this).html();
	                obj[curRow].push(contents.trim());
	            });
			});

		    //build output from array

		    for(var y = 0; y < obj.numRows; y++){
		        var html = '';
		        var curRow = 'row-'+y;
		        var outRow = obj[curRow];       
		        if(typeof outRow !== 'undefined'){
		            var altRowClass = (y%2 != 0) && settings.altRowStyle == true ? 'even' : '';
		            var lastRowClass = ((y+1) == obj.numRows) ? settings.classPrefix + '-tr-last' : '';
		            html += '<tr class="'+ settings.classPrefix +'-table-tr '; 
		            html += altRowClass +' '+ settings.classPrefix + '-table-tr-'+ curRow + ' '; 
		            html += lastRowClass +'">'
		            html += '<td colspan="'+obj.colNames.length+'">';
		            html += '<div class="' + settings.classPrefix + '-table-div">';
		            for(var k=0;k<outRow.length;k++){
		                var blankValueClass = outRow[k] == '' || outRow[k] == '&nbsp;' ? 'blankValue' : ''; 
		                var blankLabelClass = obj.colNames[k] == '' || obj.colNames[k] == '&nbsp;' ? 'blankLabel' : '' 
		                html += '<div class="' + settings.classPrefix + '-table-record-div '+ blankValueClass + ' ' + blankLabelClass +'">';
		                /*label*/
		                var label = obj.colNames[k];
		                var labelClass = settings.showLabels == false ? 'hidden' : '';
		                if(settings.firstRowHeader == true) {
		                	 html += '<label class="'+labelClass+'">'+label+'</label>';
		                }		               
		                /*end label*/
		                html += '<p>'+outRow[k]+'</p>';
		                html += '</div>';
		            }
		            html += '</div></td></tr>';
		            curTable.find('tr.'+ settings.classPrefix + '-' +curRow).after(html);
		        }
		    }
			obj.colNames = Array();
			obj.numRows = 0;
		});

    };
}( jQuery ));
/*! 
 * jQuery Steps v1.1.0 - 09/04/2014
 * Copyright (c) 2014 Rafael Staib (http://www.jquery-steps.com)
 * Licensed under MIT http://www.opensource.org/licenses/MIT
 */
;(function ($, undefined)
{
$.fn.extend({
    _aria: function (name, value)
    {
        return this.attr("aria-" + name, value);
    },

    _removeAria: function (name)
    {
        return this.removeAttr("aria-" + name);
    },

    _enableAria: function (enable)
    {
        return (enable == null || enable) ? 
            this.removeClass("disabled")._aria("disabled", "false") : 
            this.addClass("disabled")._aria("disabled", "true");
    },

    _showAria: function (show)
    {
        return (show == null || show) ? 
            this.show()._aria("hidden", "false") : 
            this.hide()._aria("hidden", "true");
    },

    _selectAria: function (select)
    {
        return (select == null || select) ? 
            this.addClass("current")._aria("selected", "true") : 
            this.removeClass("current")._aria("selected", "false");
    },

    _id: function (id)
    {
        return (id) ? this.attr("id", id) : this.attr("id");
    }
});

if (!String.prototype.format)
{
    String.prototype.format = function()
    {
        var args = (arguments.length === 1 && $.isArray(arguments[0])) ? arguments[0] : arguments;
        var formattedString = this;
        for (var i = 0; i < args.length; i++)
        {
            var pattern = new RegExp("\\{" + i + "\\}", "gm");
            formattedString = formattedString.replace(pattern, args[i]);
        }
        return formattedString;
    };
}

/**
 * A global unique id count.
 *
 * @static
 * @private
 * @property _uniqueId
 * @type Integer
 **/
var _uniqueId = 0;

/**
 * The plugin prefix for cookies.
 *
 * @final
 * @private
 * @property _cookiePrefix
 * @type String
 **/
var _cookiePrefix = "jQu3ry_5teps_St@te_";

/**
 * Suffix for the unique tab id.
 *
 * @final
 * @private
 * @property _tabSuffix
 * @type String
 * @since 0.9.7
 **/
var _tabSuffix = "-t-";

/**
 * Suffix for the unique tabpanel id.
 *
 * @final
 * @private
 * @property _tabpanelSuffix
 * @type String
 * @since 0.9.7
 **/
var _tabpanelSuffix = "-p-";

/**
 * Suffix for the unique title id.
 *
 * @final
 * @private
 * @property _titleSuffix
 * @type String
 * @since 0.9.7
 **/
var _titleSuffix = "-h-";

/**
 * An error message for an "index out of range" error.
 *
 * @final
 * @private
 * @property _indexOutOfRangeErrorMessage
 * @type String
 **/
var _indexOutOfRangeErrorMessage = "Index out of range.";

/**
 * An error message for an "missing corresponding element" error.
 *
 * @final
 * @private
 * @property _missingCorrespondingElementErrorMessage
 * @type String
 **/
var _missingCorrespondingElementErrorMessage = "One or more corresponding step {0} are missing.";

/**
 * Adds a step to the cache.
 *
 * @static
 * @private
 * @method addStepToCache
 * @param wizard {Object} A jQuery wizard object
 * @param step {Object} The step object to add
 **/
function addStepToCache(wizard, step)
{
    getSteps(wizard).push(step);
}

function analyzeData(wizard, options, state)
{
    var stepTitles = wizard.children(options.headerTag),
        stepContents = wizard.children(options.bodyTag);

    // Validate content
    if (stepTitles.length > stepContents.length)
    {
        throwError(_missingCorrespondingElementErrorMessage, "contents");
    }
    else if (stepTitles.length < stepContents.length)
    {
        throwError(_missingCorrespondingElementErrorMessage, "titles");
    }
        
    var startIndex = options.startIndex;

    state.stepCount = stepTitles.length;

    // Tries to load the saved state (step position)
    if (options.saveState && $.cookie)
    {
        var savedState = $.cookie(_cookiePrefix + getUniqueId(wizard));
        // Sets the saved position to the start index if not undefined or out of range 
        var savedIndex = parseInt(savedState, 0);
        if (!isNaN(savedIndex) && savedIndex < state.stepCount)
        {
            startIndex = savedIndex;
        }
    }

    state.currentIndex = startIndex;

    stepTitles.each(function (index)
    {
        var item = $(this), // item == header
            content = stepContents.eq(index),
            modeData = content.data("mode"),
            mode = (modeData == null) ? contentMode.html : getValidEnumValue(contentMode,
                (/^\s*$/.test(modeData) || isNaN(modeData)) ? modeData : parseInt(modeData, 0)),
            contentUrl = (mode === contentMode.html || content.data("url") === undefined) ?
                "" : content.data("url"),
            contentLoaded = (mode !== contentMode.html && content.data("loaded") === "1"),
            step = $.extend({}, stepModel, {
                title: item.html(),
                content: (mode === contentMode.html) ? content.html() : "",
                contentUrl: contentUrl,
                contentMode: mode,
                contentLoaded: contentLoaded
            });

        addStepToCache(wizard, step);
    });
}

/**
 * Triggers the onCanceled event.
 *
 * @static
 * @private
 * @method cancel
 * @param wizard {Object} The jQuery wizard object
 **/
function cancel(wizard)
{
    wizard.triggerHandler("canceled");
}

function decreaseCurrentIndexBy(state, decreaseBy)
{
    return state.currentIndex - decreaseBy;
}

/**
 * Removes the control functionality completely and transforms the current state to the initial HTML structure.
 *
 * @static
 * @private
 * @method destroy
 * @param wizard {Object} A jQuery wizard object
 **/
function destroy(wizard, options)
{
    var eventNamespace = getEventNamespace(wizard);

    // Remove virtual data objects from the wizard
    wizard.unbind(eventNamespace).removeData("uid").removeData("options")
        .removeData("state").removeData("steps").removeData("eventNamespace")
        .find(".actions a").unbind(eventNamespace);

    // Remove attributes and CSS classes from the wizard
    wizard.removeClass(options.clearFixCssClass + " vertical");

    var contents = wizard.find(".content > *");

    // Remove virtual data objects from panels and their titles
    contents.removeData("loaded").removeData("mode").removeData("url");

    // Remove attributes, CSS classes and reset inline styles on all panels and their titles
    contents.removeAttr("id").removeAttr("role").removeAttr("tabindex")
        .removeAttr("class").removeAttr("style")._removeAria("labelledby")
        ._removeAria("hidden");

    // Empty panels if the mode is set to 'async' or 'iframe'
    wizard.find(".content > [data-mode='async'],.content > [data-mode='iframe']").empty();

    var wizardSubstitute = $("<{0} class=\"{1}\"></{0}>".format(wizard.get(0).tagName, wizard.attr("class")));

    var wizardId = wizard._id();
    if (wizardId != null && wizardId !== "")
    {
        wizardSubstitute._id(wizardId);
    }

    wizardSubstitute.html(wizard.find(".content").html());
    wizard.after(wizardSubstitute);
    wizard.remove();

    return wizardSubstitute;
}

/**
 * Triggers the onFinishing and onFinished event.
 *
 * @static
 * @private
 * @method finishStep
 * @param wizard {Object} The jQuery wizard object
 * @param state {Object} The state container of the current wizard
 **/
function finishStep(wizard, state)
{
    var currentStep = wizard.find(".steps li").eq(state.currentIndex);

    if (wizard.triggerHandler("finishing", [state.currentIndex]))
    {
        currentStep.addClass("done").removeClass("error");
        wizard.triggerHandler("finished", [state.currentIndex]);
    }
    else
    {
        currentStep.addClass("error");
    }
}

/**
 * Gets or creates if not exist an unique event namespace for the given wizard instance.
 *
 * @static
 * @private
 * @method getEventNamespace
 * @param wizard {Object} A jQuery wizard object
 * @return {String} Returns the unique event namespace for the given wizard
 */
function getEventNamespace(wizard)
{
    var eventNamespace = wizard.data("eventNamespace");

    if (eventNamespace == null)
    {
        eventNamespace = "." + getUniqueId(wizard);
        wizard.data("eventNamespace", eventNamespace);
    }

    return eventNamespace;
}

function getStepAnchor(wizard, index)
{
    var uniqueId = getUniqueId(wizard);

    return wizard.find("#" + uniqueId + _tabSuffix + index);
}

function getStepPanel(wizard, index)
{
    var uniqueId = getUniqueId(wizard);

    return wizard.find("#" + uniqueId + _tabpanelSuffix + index);
}

function getStepTitle(wizard, index)
{
    var uniqueId = getUniqueId(wizard);

    return wizard.find("#" + uniqueId + _titleSuffix + index);
}

function getOptions(wizard)
{
    return wizard.data("options");
}

function getState(wizard)
{
    return wizard.data("state");
}

function getSteps(wizard)
{
    return wizard.data("steps");
}

/**
 * Gets a specific step object by index.
 *
 * @static
 * @private
 * @method getStep
 * @param index {Integer} An integer that belongs to the position of a step
 * @return {Object} A specific step object
 **/
function getStep(wizard, index)
{
    var steps = getSteps(wizard);

    if (index < 0 || index >= steps.length)
    {
        throwError(_indexOutOfRangeErrorMessage);
    }

    return steps[index];
}

/**
 * Gets or creates if not exist an unique id from the given wizard instance.
 *
 * @static
 * @private
 * @method getUniqueId
 * @param wizard {Object} A jQuery wizard object
 * @return {String} Returns the unique id for the given wizard
 */
function getUniqueId(wizard)
{
    var uniqueId = wizard.data("uid");

    if (uniqueId == null)
    {
        uniqueId = wizard._id();
        if (uniqueId == null)
        {
            uniqueId = "steps-uid-".concat(_uniqueId);
            wizard._id(uniqueId);
        }

        _uniqueId++;
        wizard.data("uid", uniqueId);
    }

    return uniqueId;
}

/**
 * Gets a valid enum value by checking a specific enum key or value.
 * 
 * @static
 * @private
 * @method getValidEnumValue
 * @param enumType {Object} Type of enum
 * @param keyOrValue {Object} Key as `String` or value as `Integer` to check for
 */
function getValidEnumValue(enumType, keyOrValue)
{
    validateArgument("enumType", enumType);
    validateArgument("keyOrValue", keyOrValue);

    // Is key
    if (typeof keyOrValue === "string")
    {
        var value = enumType[keyOrValue];
        if (value === undefined)
        {
            throwError("The enum key '{0}' does not exist.", keyOrValue);
        }

        return value;
    }
    // Is value
    else if (typeof keyOrValue === "number")
    {
        for (var key in enumType)
        {
            if (enumType[key] === keyOrValue)
            {
                return keyOrValue;
            }
        }

        throwError("Invalid enum value '{0}'.", keyOrValue);
    }
    // Type is not supported
    else
    {
        throwError("Invalid key or value type.");
    }
}

/**
 * Routes to the next step.
 *
 * @static
 * @private
 * @method goToNextStep
 * @param wizard {Object} The jQuery wizard object
 * @param options {Object} Settings of the current wizard
 * @param state {Object} The state container of the current wizard
 * @return {Boolean} Indicates whether the action executed
 **/
function goToNextStep(wizard, options, state)
{
    return paginationClick(wizard, options, state, increaseCurrentIndexBy(state, 1));
}

/**
 * Routes to the previous step.
 *
 * @static
 * @private
 * @method goToPreviousStep
 * @param wizard {Object} The jQuery wizard object
 * @param options {Object} Settings of the current wizard
 * @param state {Object} The state container of the current wizard
 * @return {Boolean} Indicates whether the action executed
 **/
function goToPreviousStep(wizard, options, state)
{
    return paginationClick(wizard, options, state, decreaseCurrentIndexBy(state, 1));
}

/**
 * Routes to a specific step by a given index.
 *
 * @static
 * @private
 * @method goToStep
 * @param wizard {Object} The jQuery wizard object
 * @param options {Object} Settings of the current wizard
 * @param state {Object} The state container of the current wizard
 * @param index {Integer} The position (zero-based) to route to
 * @return {Boolean} Indicates whether the action succeeded or failed
 **/
function goToStep(wizard, options, state, index)
{
    if (index < 0 || index >= state.stepCount)
    {
        throwError(_indexOutOfRangeErrorMessage);
    }

    if (options.forceMoveForward && index < state.currentIndex)
    {
        return;
    }

    var oldIndex = state.currentIndex;
    if (wizard.triggerHandler("stepChanging", [state.currentIndex, index]))
    {
        // Save new state
        state.currentIndex = index;
        saveCurrentStateToCookie(wizard, options, state);

        // Change visualisation
        refreshStepNavigation(wizard, options, state, oldIndex);
        refreshPagination(wizard, options, state);
        loadAsyncContent(wizard, options, state);
        startTransitionEffect(wizard, options, state, index, oldIndex, function()
        {
            wizard.triggerHandler("stepChanged", [index, oldIndex]);
        });
    }
    else
    {
        wizard.find(".steps li").eq(oldIndex).addClass("error");
    }

    return true;
}

function increaseCurrentIndexBy(state, increaseBy)
{
    return state.currentIndex + increaseBy;
}

/**
 * Initializes the component.
 *
 * @static
 * @private
 * @method initialize
 * @param options {Object} The component settings
 **/
function initialize(options)
{
    /*jshint -W040 */
    var opts = $.extend(true, {}, defaults, options);

    return this.each(function ()
    {
        var wizard = $(this);
        var state = {
            currentIndex: opts.startIndex,
            currentStep: null,
            stepCount: 0,
            transitionElement: null
        };

        // Create data container
        wizard.data("options", opts);
        wizard.data("state", state);
        wizard.data("steps", []);

        analyzeData(wizard, opts, state);
        render(wizard, opts, state);
        registerEvents(wizard, opts);

        // Trigger focus
        if (opts.autoFocus && _uniqueId === 0)
        {
            getStepAnchor(wizard, opts.startIndex).focus();
        }

        wizard.triggerHandler("init", [opts.startIndex]);
    });
}

/**
 * Inserts a new step to a specific position.
 *
 * @static
 * @private
 * @method insertStep
 * @param wizard {Object} The jQuery wizard object
 * @param options {Object} Settings of the current wizard
 * @param state {Object} The state container of the current wizard
 * @param index {Integer} The position (zero-based) to add
 * @param step {Object} The step object to add
 * @example
 *     $("#wizard").steps().insert(0, {
 *         title: "Title",
 *         content: "", // optional
 *         contentMode: "async", // optional
 *         contentUrl: "/Content/Step/1" // optional
 *     });
 * @chainable
 **/
function insertStep(wizard, options, state, index, step)
{
    if (index < 0 || index > state.stepCount)
    {
        throwError(_indexOutOfRangeErrorMessage);
    }

    // TODO: Validate step object

    // Change data
    step = $.extend({}, stepModel, step);
    insertStepToCache(wizard, index, step);
    if (state.currentIndex !== state.stepCount && state.currentIndex >= index)
    {
        state.currentIndex++;
        saveCurrentStateToCookie(wizard, options, state);
    }
    state.stepCount++;

    var contentContainer = wizard.find(".content"),
        header = $("<{0}>{1}</{0}>".format(options.headerTag, step.title)),
        body = $("<{0}></{0}>".format(options.bodyTag));

    if (step.contentMode == null || step.contentMode === contentMode.html)
    {
        body.html(step.content);
    }

    if (index === 0)
    {
        contentContainer.prepend(body).prepend(header);
    }
    else
    {
        getStepPanel(wizard, (index - 1)).after(body).after(header);
    }

    renderBody(wizard, state, body, index);
    renderTitle(wizard, options, state, header, index);
    refreshSteps(wizard, options, state, index);
    if (index === state.currentIndex)
    {
        refreshStepNavigation(wizard, options, state);
    }
    refreshPagination(wizard, options, state);

    return wizard;
}

/**
 * Inserts a step object to the cache at a specific position.
 *
 * @static
 * @private
 * @method insertStepToCache
 * @param wizard {Object} A jQuery wizard object
 * @param index {Integer} The position (zero-based) to add
 * @param step {Object} The step object to add
 **/
function insertStepToCache(wizard, index, step)
{
    getSteps(wizard).splice(index, 0, step);
}

/**
 * Handles the keyup DOM event for pagination.
 *
 * @static
 * @private
 * @event keyup
 * @param event {Object} An event object
 */
function keyUpHandler(event)
{
    var wizard = $(this),
        options = getOptions(wizard),
        state = getState(wizard);

    if (options.suppressPaginationOnFocus && wizard.find(":focus").is(":input"))
    {
        event.preventDefault();
        return false;
    }

    var keyCodes = { left: 37, right: 39 };
    if (event.keyCode === keyCodes.left)
    {
        event.preventDefault();
        goToPreviousStep(wizard, options, state);
    }
    else if (event.keyCode === keyCodes.right)
    {
        event.preventDefault();
        goToNextStep(wizard, options, state);
    }
}

/**
 * Loads and includes async content.
 *
 * @static
 * @private
 * @method loadAsyncContent
 * @param wizard {Object} A jQuery wizard object
 * @param options {Object} Settings of the current wizard
 * @param state {Object} The state container of the current wizard
 */
function loadAsyncContent(wizard, options, state)
{
    if (state.stepCount > 0)
    {
        var currentIndex = state.currentIndex,
            currentStep = getStep(wizard, currentIndex);

        if (!options.enableContentCache || !currentStep.contentLoaded)
        {
            switch (getValidEnumValue(contentMode, currentStep.contentMode))
            {
                case contentMode.iframe:
                    wizard.find(".content > .body").eq(state.currentIndex).empty()
                        .html("<iframe src=\"" + currentStep.contentUrl + "\" frameborder=\"0\" scrolling=\"no\" />")
                        .data("loaded", "1");
                    break;

                case contentMode.async:
                    var currentStepContent = getStepPanel(wizard, currentIndex)._aria("busy", "true")
                        .empty().append(renderTemplate(options.loadingTemplate, { text: options.labels.loading }));

                    $.ajax({ url: currentStep.contentUrl, cache: false }).done(function (data)
                    {
                        currentStepContent.empty().html(data)._aria("busy", "false").data("loaded", "1");
                        wizard.triggerHandler("contentLoaded", [currentIndex]);
                    });
                    break;
            }
        }
    }
}

/**
 * Fires the action next or previous click event.
 *
 * @static
 * @private
 * @method paginationClick
 * @param wizard {Object} The jQuery wizard object
 * @param options {Object} Settings of the current wizard
 * @param state {Object} The state container of the current wizard
 * @param index {Integer} The position (zero-based) to route to
 * @return {Boolean} Indicates whether the event fired successfully or not
 **/
function paginationClick(wizard, options, state, index)
{
    var oldIndex = state.currentIndex;

    if (index >= 0 && index < state.stepCount && !(options.forceMoveForward && index < state.currentIndex))
    {
        var anchor = getStepAnchor(wizard, index),
            parent = anchor.parent(),
            isDisabled = parent.hasClass("disabled");

        // Enable the step to make the anchor clickable!
        parent._enableAria();
        anchor.click();

        // An error occured
        if (oldIndex === state.currentIndex && isDisabled)
        {
            // Disable the step again if current index has not changed; prevents click action.
            parent._enableAria(false);
            return false;
        }

        return true;
    }

    return false;
}

/**
 * Fires when a pagination click happens.
 *
 * @static
 * @private
 * @event click
 * @param event {Object} An event object
 */
function paginationClickHandler(event)
{
    event.preventDefault();

    var anchor = $(this),
        wizard = anchor.parent().parent().parent().parent(),
        options = getOptions(wizard),
        state = getState(wizard),
        href = anchor.attr("href");

    switch (href.substring(href.lastIndexOf("#") + 1))
    {
        case "cancel":
            cancel(wizard);
            break;

        case "finish":
            finishStep(wizard, state);
            break;

        case "next":
            goToNextStep(wizard, options, state);
            break;

        case "previous":
            goToPreviousStep(wizard, options, state);
            break;
    }
}

/**
 * Refreshs the visualization state for the entire pagination.
 *
 * @static
 * @private
 * @method refreshPagination
 * @param wizard {Object} A jQuery wizard object
 * @param options {Object} Settings of the current wizard
 * @param state {Object} The state container of the current wizard
 */
function refreshPagination(wizard, options, state)
{
    if (options.enablePagination)
    {
        var finish = wizard.find(".actions a[href$='#finish']").parent(),
            next = wizard.find(".actions a[href$='#next']").parent();

        if (!options.forceMoveForward)
        {
            var previous = wizard.find(".actions a[href$='#previous']").parent();
            previous._enableAria(state.currentIndex > 0);
        }

        if (options.enableFinishButton && options.showFinishButtonAlways)
        {
            finish._enableAria(state.stepCount > 0);
            next._enableAria(state.stepCount > 1 && state.stepCount > (state.currentIndex + 1));
        }
        else
        {
            finish._showAria(options.enableFinishButton && state.stepCount === (state.currentIndex + 1));
            next._showAria(state.stepCount === 0 || state.stepCount > (state.currentIndex + 1)).
                _enableAria(state.stepCount > (state.currentIndex + 1) || !options.enableFinishButton);
        }
    }
}

/**
 * Refreshs the visualization state for the step navigation (tabs).
 *
 * @static
 * @private
 * @method refreshStepNavigation
 * @param wizard {Object} A jQuery wizard object
 * @param options {Object} Settings of the current wizard
 * @param state {Object} The state container of the current wizard
 * @param [oldIndex] {Integer} The index of the prior step
 */
function refreshStepNavigation(wizard, options, state, oldIndex)
{
    var currentOrNewStepAnchor = getStepAnchor(wizard, state.currentIndex),
        currentInfo = $("<span class=\"current-info audible\">" + options.labels.current + " </span>"),
        stepTitles = wizard.find(".content > .title");

    if (oldIndex != null)
    {
        var oldStepAnchor = getStepAnchor(wizard, oldIndex);
        oldStepAnchor.parent().addClass("done").removeClass("error")._selectAria(false);
        stepTitles.eq(oldIndex).removeClass("current").next(".body").removeClass("current");
        currentInfo = oldStepAnchor.find(".current-info");
        currentOrNewStepAnchor.focus();
    }

    currentOrNewStepAnchor.prepend(currentInfo).parent()._selectAria().removeClass("done")._enableAria();
    stepTitles.eq(state.currentIndex).addClass("current").next(".body").addClass("current");
}

/**
 * Refreshes step buttons and their related titles beyond a certain position.
 *
 * @static
 * @private
 * @method refreshSteps
 * @param wizard {Object} A jQuery wizard object
 * @param options {Object} Settings of the current wizard
 * @param state {Object} The state container of the current wizard
 * @param index {Integer} The start point for refreshing ids
 */
function refreshSteps(wizard, options, state, index)
{
    var uniqueId = getUniqueId(wizard);

    for (var i = index; i < state.stepCount; i++)
    {
        var uniqueStepId = uniqueId + _tabSuffix + i,
            uniqueBodyId = uniqueId + _tabpanelSuffix + i,
            uniqueHeaderId = uniqueId + _titleSuffix + i,
            title = wizard.find(".title").eq(i)._id(uniqueHeaderId);

        wizard.find(".steps a").eq(i)._id(uniqueStepId)
            ._aria("controls", uniqueBodyId).attr("href", "#" + uniqueHeaderId)
            .html(renderTemplate(options.titleTemplate, { index: i + 1, title: title.html() }));
        wizard.find(".body").eq(i)._id(uniqueBodyId)
            ._aria("labelledby", uniqueHeaderId);
    }
}

function registerEvents(wizard, options)
{
    var eventNamespace = getEventNamespace(wizard);

    wizard.bind("canceled" + eventNamespace, options.onCanceled);
    wizard.bind("contentLoaded" + eventNamespace, options.onContentLoaded);
    wizard.bind("finishing" + eventNamespace, options.onFinishing);
    wizard.bind("finished" + eventNamespace, options.onFinished);
    wizard.bind("init" + eventNamespace, options.onInit);
    wizard.bind("stepChanging" + eventNamespace, options.onStepChanging);
    wizard.bind("stepChanged" + eventNamespace, options.onStepChanged);

    if (options.enableKeyNavigation)
    {
        wizard.bind("keyup" + eventNamespace, keyUpHandler);
    }

    wizard.find(".actions a").bind("click" + eventNamespace, paginationClickHandler);
}

/**
 * Removes a specific step by an given index.
 *
 * @static
 * @private
 * @method removeStep
 * @param wizard {Object} A jQuery wizard object
 * @param options {Object} Settings of the current wizard
 * @param state {Object} The state container of the current wizard
 * @param index {Integer} The position (zero-based) of the step to remove
 * @return Indecates whether the item is removed.
 **/
function removeStep(wizard, options, state, index)
{
    // Index out of range and try deleting current item will return false.
    if (index < 0 || index >= state.stepCount || state.currentIndex === index)
    {
        return false;
    }

    // Change data
    removeStepFromCache(wizard, index);
    if (state.currentIndex > index)
    {
        state.currentIndex--;
        saveCurrentStateToCookie(wizard, options, state);
    }
    state.stepCount--;

    getStepTitle(wizard, index).remove();
    getStepPanel(wizard, index).remove();
    getStepAnchor(wizard, index).parent().remove();

    // Set the "first" class to the new first step button 
    if (index === 0)
    {
        wizard.find(".steps li").first().addClass("first");
    }

    // Set the "last" class to the new last step button 
    if (index === state.stepCount)
    {
        wizard.find(".steps li").eq(index).addClass("last");
    }

    refreshSteps(wizard, options, state, index);
    refreshPagination(wizard, options, state);

    return true;
}

function removeStepFromCache(wizard, index)
{
    getSteps(wizard).splice(index, 1);
}

/**
 * Transforms the base html structure to a more sensible html structure.
 *
 * @static
 * @private
 * @method render
 * @param wizard {Object} A jQuery wizard object
 * @param options {Object} Settings of the current wizard
 * @param state {Object} The state container of the current wizard
 **/
function render(wizard, options, state)
{
    // Create a content wrapper and copy HTML from the intial wizard structure
    var wrapperTemplate = "<{0} class=\"{1}\">{2}</{0}>",
        orientation = getValidEnumValue(stepsOrientation, options.stepsOrientation),
        verticalCssClass = (orientation === stepsOrientation.vertical) ? " vertical" : "",
        contentWrapper = $(wrapperTemplate.format(options.contentContainerTag, "content " + options.clearFixCssClass, wizard.html())),
        stepsWrapper = $(wrapperTemplate.format(options.stepsContainerTag, "steps " + options.clearFixCssClass, "<ul role=\"tablist\"></ul>")),
        stepTitles = contentWrapper.children(options.headerTag),
        stepContents = contentWrapper.children(options.bodyTag);

    // Transform the wizard wrapper and remove the inner HTML
    wizard.attr("role", "application").empty().append(stepsWrapper).append(contentWrapper)
        .addClass(options.cssClass + " " + options.clearFixCssClass + verticalCssClass);

    // Add WIA-ARIA support
    stepContents.each(function (index)
    {
        renderBody(wizard, state, $(this), index);
    });

    stepTitles.each(function (index)
    {
        renderTitle(wizard, options, state, $(this), index);
    });

    refreshStepNavigation(wizard, options, state);
    renderPagination(wizard, options, state);
}

/**
 * Transforms the body to a proper tabpanel.
 *
 * @static
 * @private
 * @method renderBody
 * @param wizard {Object} A jQuery wizard object
 * @param body {Object} A jQuery body object
 * @param index {Integer} The position of the body
 */
function renderBody(wizard, state, body, index)
{
    var uniqueId = getUniqueId(wizard),
        uniqueBodyId = uniqueId + _tabpanelSuffix + index,
        uniqueHeaderId = uniqueId + _titleSuffix + index;

    body._id(uniqueBodyId).attr("role", "tabpanel")._aria("labelledby", uniqueHeaderId)
        .addClass("body")._showAria(state.currentIndex === index);
}

/**
 * Renders a pagination if enabled.
 *
 * @static
 * @private
 * @method renderPagination
 * @param wizard {Object} A jQuery wizard object
 * @param options {Object} Settings of the current wizard
 * @param state {Object} The state container of the current wizard
 */
function renderPagination(wizard, options, state)
{
    if (options.enablePagination)
    {
        var pagination = "<{0} class=\"actions {1}\"><ul role=\"menu\" aria-label=\"{2}\">{3}</ul></{0}>",
            buttonTemplate = "<li><a href=\"#{0}\" role=\"menuitem\">{1}</a></li>",
            buttons = "";

        if (!options.forceMoveForward)
        {
            buttons += buttonTemplate.format("previous", options.labels.previous);
        }

        buttons += buttonTemplate.format("next", options.labels.next);

        if (options.enableFinishButton)
        {
            buttons += buttonTemplate.format("finish", options.labels.finish);
        }

        if (options.enableCancelButton)
        {
            buttons += buttonTemplate.format("cancel", options.labels.cancel);
        }

        wizard.append(pagination.format(options.actionContainerTag, options.clearFixCssClass,
            options.labels.pagination, buttons));

        refreshPagination(wizard, options, state);
        loadAsyncContent(wizard, options, state);
    }
}

/**
 * Renders a template and replaces all placeholder.
 *
 * @static
 * @private
 * @method renderTemplate
 * @param template {String} A template
 * @param substitutes {Object} A list of substitute
 * @return {String} The rendered template
 */
function renderTemplate(template, substitutes)
{
    var matches = template.match(/#([a-z]*)#/gi);

    for (var i = 0; i < matches.length; i++)
    {
        var match = matches[i], 
            key = match.substring(1, match.length - 1);

        if (substitutes[key] === undefined)
        {
            throwError("The key '{0}' does not exist in the substitute collection!", key);
        }

        template = template.replace(match, substitutes[key]);
    }

    return template;
}

/**
 * Transforms the title to a step item button.
 *
 * @static
 * @private
 * @method renderTitle
 * @param wizard {Object} A jQuery wizard object
 * @param options {Object} Settings of the current wizard
 * @param state {Object} The state container of the current wizard
 * @param header {Object} A jQuery header object
 * @param index {Integer} The position of the header
 */
function renderTitle(wizard, options, state, header, index)
{
    var uniqueId = getUniqueId(wizard),
        uniqueStepId = uniqueId + _tabSuffix + index,
        uniqueBodyId = uniqueId + _tabpanelSuffix + index,
        uniqueHeaderId = uniqueId + _titleSuffix + index,
        stepCollection = wizard.find(".steps > ul"),
        title = renderTemplate(options.titleTemplate, {
            index: index + 1,
            title: header.html()
        }),
        stepItem = $("<li role=\"tab\"><a id=\"" + uniqueStepId + "\" href=\"#" + uniqueHeaderId + 
            "\" aria-controls=\"" + uniqueBodyId + "\">" + title + "</a></li>");
        
    stepItem._enableAria(options.enableAllSteps || state.currentIndex > index);

    if (state.currentIndex > index)
    {
        stepItem.addClass("done");
    }

    header._id(uniqueHeaderId).attr("tabindex", "-1").addClass("title");

    if (index === 0)
    {
        stepCollection.prepend(stepItem);
    }
    else
    {
        stepCollection.find("li").eq(index - 1).after(stepItem);
    }

    // Set the "first" class to the new first step button
    if (index === 0)
    {
        stepCollection.find("li").removeClass("first").eq(index).addClass("first");
    }

    // Set the "last" class to the new last step button
    if (index === (state.stepCount - 1))
    {
        stepCollection.find("li").removeClass("last").eq(index).addClass("last");
    }

    // Register click event
    stepItem.children("a").bind("click" + getEventNamespace(wizard), stepClickHandler);
}

/**
 * Saves the current state to a cookie.
 *
 * @static
 * @private
 * @method saveCurrentStateToCookie
 * @param wizard {Object} A jQuery wizard object
 * @param options {Object} Settings of the current wizard
 * @param state {Object} The state container of the current wizard
 */
function saveCurrentStateToCookie(wizard, options, state)
{
    if (options.saveState && $.cookie)
    {
        $.cookie(_cookiePrefix + getUniqueId(wizard), state.currentIndex);
    }
}

function startTransitionEffect(wizard, options, state, index, oldIndex, doneCallback)
{
    var stepContents = wizard.find(".content > .body"),
        effect = getValidEnumValue(transitionEffect, options.transitionEffect),
        effectSpeed = options.transitionEffectSpeed,
        newStep = stepContents.eq(index),
        currentStep = stepContents.eq(oldIndex);

    switch (effect)
    {
        case transitionEffect.fade:
        case transitionEffect.slide:
            var hide = (effect === transitionEffect.fade) ? "fadeOut" : "slideUp",
                show = (effect === transitionEffect.fade) ? "fadeIn" : "slideDown";

            state.transitionElement = newStep;
            currentStep[hide](effectSpeed, function ()
            {
                var wizard = $(this)._showAria(false).parent().parent(),
                    state = getState(wizard);

                if (state.transitionElement)
                {
                    state.transitionElement[show](effectSpeed, function ()
                    {
                        $(this)._showAria();
                    }).promise().done(doneCallback);
                    state.transitionElement = null;
                }
            });
            break;

        case transitionEffect.slideLeft:
            var outerWidth = currentStep.outerWidth(true),
                posFadeOut = (index > oldIndex) ? -(outerWidth) : outerWidth,
                posFadeIn = (index > oldIndex) ? outerWidth : -(outerWidth);

            $.when(currentStep.animate({ left: posFadeOut }, effectSpeed, 
                    function () { $(this)._showAria(false); }),
                newStep.css("left", posFadeIn + "px")._showAria()
                    .animate({ left: 0 }, effectSpeed)).done(doneCallback);
            break;

        default:
            $.when(currentStep._showAria(false), newStep._showAria())
                .done(doneCallback);
            break;
    }
}

/**
 * Fires when a step click happens.
 *
 * @static
 * @private
 * @event click
 * @param event {Object} An event object
 */
function stepClickHandler(event)
{
    event.preventDefault();

    var anchor = $(this),
        wizard = anchor.parent().parent().parent().parent(),
        options = getOptions(wizard),
        state = getState(wizard),
        oldIndex = state.currentIndex;

    if (anchor.parent().is(":not(.disabled):not(.current)"))
    {
        var href = anchor.attr("href"),
            position = parseInt(href.substring(href.lastIndexOf("-") + 1), 0);

        goToStep(wizard, options, state, position);
    }

    // If nothing has changed
    if (oldIndex === state.currentIndex)
    {
        getStepAnchor(wizard, oldIndex).focus();
        return false;
    }
}

function throwError(message)
{
    if (arguments.length > 1)
    {
        message = message.format(Array.prototype.slice.call(arguments, 1));
    }

    throw new Error(message);
}

/**
 * Checks an argument for null or undefined and throws an error if one check applies.
 *
 * @static
 * @private
 * @method validateArgument
 * @param argumentName {String} The name of the given argument
 * @param argumentValue {Object} The argument itself
 */
function validateArgument(argumentName, argumentValue)
{
    if (argumentValue == null)
    {
        throwError("The argument '{0}' is null or undefined.", argumentName);
    }
}

/**
 * Represents a jQuery wizard plugin.
 *
 * @class steps
 * @constructor
 * @param [method={}] The name of the method as `String` or an JSON object for initialization
 * @param [params=]* {Array} Additional arguments for a method call
 * @chainable
 **/
$.fn.steps = function (method)
{
    if ($.fn.steps[method])
    {
        return $.fn.steps[method].apply(this, Array.prototype.slice.call(arguments, 1));
    }
    else if (typeof method === "object" || !method)
    {
        return initialize.apply(this, arguments);
    }
    else
    {
        $.error("Method " + method + " does not exist on jQuery.steps");
    }
};

/**
 * Adds a new step.
 *
 * @method add
 * @param step {Object} The step object to add
 * @chainable
 **/
$.fn.steps.add = function (step)
{
    var state = getState(this);
    return insertStep(this, getOptions(this), state, state.stepCount, step);
};

/**
 * Removes the control functionality completely and transforms the current state to the initial HTML structure.
 *
 * @method destroy
 * @chainable
 **/
$.fn.steps.destroy = function ()
{
    return destroy(this, getOptions(this));
};

/**
 * Triggers the onFinishing and onFinished event.
 *
 * @method finish
 **/
$.fn.steps.finish = function ()
{
    finishStep(this, getState(this));
};

/**
 * Gets the current step index.
 *
 * @method getCurrentIndex
 * @return {Integer} The actual step index (zero-based)
 * @for steps
 **/
$.fn.steps.getCurrentIndex = function ()
{
    return getState(this).currentIndex;
};

/**
 * Gets the current step object.
 *
 * @method getCurrentStep
 * @return {Object} The actual step object
 **/
$.fn.steps.getCurrentStep = function ()
{
    return getStep(this, getState(this).currentIndex);
};

/**
 * Gets a specific step object by index.
 *
 * @method getStep
 * @param index {Integer} An integer that belongs to the position of a step
 * @return {Object} A specific step object
 **/
$.fn.steps.getStep = function (index)
{
    return getStep(this, index);
};

/**
 * Inserts a new step to a specific position.
 *
 * @method insert
 * @param index {Integer} The position (zero-based) to add
 * @param step {Object} The step object to add
 * @example
 *     $("#wizard").steps().insert(0, {
 *         title: "Title",
 *         content: "", // optional
 *         contentMode: "async", // optional
 *         contentUrl: "/Content/Step/1" // optional
 *     });
 * @chainable
 **/
$.fn.steps.insert = function (index, step)
{
    return insertStep(this, getOptions(this), getState(this), index, step);
};

/**
 * Routes to the next step.
 *
 * @method next
 * @return {Boolean} Indicates whether the action executed
 **/
$.fn.steps.next = function ()
{
    return goToNextStep(this, getOptions(this), getState(this));
};

/**
 * Routes to the previous step.
 *
 * @method previous
 * @return {Boolean} Indicates whether the action executed
 **/
$.fn.steps.previous = function ()
{
    return goToPreviousStep(this, getOptions(this), getState(this));
};

/**
 * Removes a specific step by an given index.
 *
 * @method remove
 * @param index {Integer} The position (zero-based) of the step to remove
 * @return Indecates whether the item is removed.
 **/
$.fn.steps.remove = function (index)
{
    return removeStep(this, getOptions(this), getState(this), index);
};

/**
 * Sets a specific step object by index.
 *
 * @method setStep
 * @param index {Integer} An integer that belongs to the position of a step
 * @param step {Object} The step object to change
 **/
$.fn.steps.setStep = function (index, step)
{
    throw new Error("Not yet implemented!");
};

/**
 * Skips an certain amount of steps.
 *
 * @method skip
 * @param count {Integer} The amount of steps that should be skipped
 * @return {Boolean} Indicates whether the action executed
 **/
$.fn.steps.skip = function (count)
{
    throw new Error("Not yet implemented!");
};

/**
 * An enum represents the different content types of a step and their loading mechanisms.
 *
 * @class contentMode
 * @for steps
 **/
var contentMode = $.fn.steps.contentMode = {
    /**
     * HTML embedded content
     *
     * @readOnly
     * @property html
     * @type Integer
     * @for contentMode
     **/
    html: 0,

    /**
     * IFrame embedded content
     *
     * @readOnly
     * @property iframe
     * @type Integer
     * @for contentMode
     **/
    iframe: 1,

    /**
     * Async embedded content
     *
     * @readOnly
     * @property async
     * @type Integer
     * @for contentMode
     **/
    async: 2
};

/**
 * An enum represents the orientation of the steps navigation.
 *
 * @class stepsOrientation
 * @for steps
 **/
var stepsOrientation = $.fn.steps.stepsOrientation = {
    /**
     * Horizontal orientation
     *
     * @readOnly
     * @property horizontal
     * @type Integer
     * @for stepsOrientation
     **/
    horizontal: 0,

    /**
     * Vertical orientation
     *
     * @readOnly
     * @property vertical
     * @type Integer
     * @for stepsOrientation
     **/
    vertical: 1
};

/**
 * An enum that represents the various transition animations.
 *
 * @class transitionEffect
 * @for steps
 **/
var transitionEffect = $.fn.steps.transitionEffect = {
    /**
     * No transition animation
     *
     * @readOnly
     * @property none
     * @type Integer
     * @for transitionEffect
     **/
    none: 0,

    /**
     * Fade in transition
     *
     * @readOnly
     * @property fade
     * @type Integer
     * @for transitionEffect
     **/
    fade: 1,

    /**
     * Slide up transition
     *
     * @readOnly
     * @property slide
     * @type Integer
     * @for transitionEffect
     **/
    slide: 2,

    /**
     * Slide left transition
     *
     * @readOnly
     * @property slideLeft
     * @type Integer
     * @for transitionEffect
     **/
    slideLeft: 3
};

var stepModel = $.fn.steps.stepModel = {
    title: "",
    content: "",
    contentUrl: "",
    contentMode: contentMode.html,
    contentLoaded: false
};

/**
 * An object that represents the default settings.
 * There are two possibities to override the sub-properties.
 * Either by doing it generally (global) or on initialization.
 *
 * @static
 * @class defaults
 * @for steps
 * @example
 *   // Global approach
 *   $.steps.defaults.headerTag = "h3";
 * @example
 *   // Initialization approach
 *   $("#wizard").steps({ headerTag: "h3" });
 **/
var defaults = $.fn.steps.defaults = {
    /**
     * The header tag is used to find the step button text within the declared wizard area.
     *
     * @property headerTag
     * @type String
     * @default "h1"
     * @for defaults
     **/
    headerTag: "h1",

    /**
     * The body tag is used to find the step content within the declared wizard area.
     *
     * @property bodyTag
     * @type String
     * @default "div"
     * @for defaults
     **/
    bodyTag: "div",

    /**
     * The content container tag which will be used to wrap all step contents.
     *
     * @property contentContainerTag
     * @type String
     * @default "div"
     * @for defaults
     **/
    contentContainerTag: "div",

    /**
     * The action container tag which will be used to wrap the pagination navigation.
     *
     * @property actionContainerTag
     * @type String
     * @default "div"
     * @for defaults
     **/
    actionContainerTag: "div",

    /**
     * The steps container tag which will be used to wrap the steps navigation.
     *
     * @property stepsContainerTag
     * @type String
     * @default "div"
     * @for defaults
     **/
    stepsContainerTag: "div",

    /**
     * The css class which will be added to the outer component wrapper.
     *
     * @property cssClass
     * @type String
     * @default "wizard"
     * @for defaults
     * @example
     *     <div class="wizard">
     *         ...
     *     </div>
     **/
    cssClass: "wizard",

    /**
     * The css class which will be used for floating scenarios.
     *
     * @property clearFixCssClass
     * @type String
     * @default "clearfix"
     * @for defaults
     **/
    clearFixCssClass: "clearfix",

    /**
     * Determines whether the steps are vertically or horizontally oriented.
     *
     * @property stepsOrientation
     * @type stepsOrientation
     * @default horizontal
     * @for defaults
     * @since 1.0.0
     **/
    stepsOrientation: stepsOrientation.horizontal,

    /*
     * Tempplates
     */

    /**
     * The title template which will be used to create a step button.
     *
     * @property titleTemplate
     * @type String
     * @default "<span class=\"number\">#index#.</span> #title#"
     * @for defaults
     **/
    titleTemplate: "<span class=\"number\">#index#.</span> #title#",

    /**
     * The loading template which will be used to create the loading animation.
     *
     * @property loadingTemplate
     * @type String
     * @default "<span class=\"spinner\"></span> #text#"
     * @for defaults
     **/
    loadingTemplate: "<span class=\"spinner\"></span> #text#",

    /*
     * Behaviour
     */

    /**
     * Sets the focus to the first wizard instance in order to enable the key navigation from the begining if `true`. 
     *
     * @property autoFocus
     * @type Boolean
     * @default false
     * @for defaults
     * @since 0.9.4
     **/
    autoFocus: false,

    /**
     * Enables all steps from the begining if `true` (all steps are clickable).
     *
     * @property enableAllSteps
     * @type Boolean
     * @default false
     * @for defaults
     **/
    enableAllSteps: false,

    /**
     * Enables keyboard navigation if `true` (arrow left and arrow right).
     *
     * @property enableKeyNavigation
     * @type Boolean
     * @default true
     * @for defaults
     **/
    enableKeyNavigation: true,

    /**
     * Enables pagination if `true`.
     *
     * @property enablePagination
     * @type Boolean
     * @default true
     * @for defaults
     **/
    enablePagination: true,

    /**
     * Suppresses pagination if a form field is focused.
     *
     * @property suppressPaginationOnFocus
     * @type Boolean
     * @default true
     * @for defaults
     **/
    suppressPaginationOnFocus: true,

    /**
     * Enables cache for async loaded or iframe embedded content.
     *
     * @property enableContentCache
     * @type Boolean
     * @default true
     * @for defaults
     **/
    enableContentCache: true,

    /**
     * Shows the cancel button if enabled.
     *
     * @property enableCancelButton
     * @type Boolean
     * @default false
     * @for defaults
     **/
    enableCancelButton: false,

    /**
     * Shows the finish button if enabled.
     *
     * @property enableFinishButton
     * @type Boolean
     * @default true
     * @for defaults
     **/
    enableFinishButton: true,

    /**
     * Not yet implemented.
     *
     * @property preloadContent
     * @type Boolean
     * @default false
     * @for defaults
     **/
    preloadContent: false,

    /**
     * Shows the finish button always (on each step; right beside the next button) if `true`. 
     * Otherwise the next button will be replaced by the finish button if the last step becomes active.
     *
     * @property showFinishButtonAlways
     * @type Boolean
     * @default false
     * @for defaults
     **/
    showFinishButtonAlways: false,

    /**
     * Prevents jumping to a previous step.
     *
     * @property forceMoveForward
     * @type Boolean
     * @default false
     * @for defaults
     **/
    forceMoveForward: false,

    /**
     * Saves the current state (step position) to a cookie.
     * By coming next time the last active step becomes activated.
     *
     * @property saveState
     * @type Boolean
     * @default false
     * @for defaults
     **/
    saveState: false,

    /**
     * The position to start on (zero-based).
     *
     * @property startIndex
     * @type Integer
     * @default 0
     * @for defaults
     **/
    startIndex: 0,

    /*
     * Animation Effect Configuration
     */

    /**
     * The animation effect which will be used for step transitions.
     *
     * @property transitionEffect
     * @type transitionEffect
     * @default none
     * @for defaults
     **/
    transitionEffect: transitionEffect.none,

    /**
     * Animation speed for step transitions (in milliseconds).
     *
     * @property transitionEffectSpeed
     * @type Integer
     * @default 200
     * @for defaults
     **/
    transitionEffectSpeed: 200,

    /*
     * Events
     */

    /**
     * Fires before the step changes and can be used to prevent step changing by returning `false`. 
     * Very useful for form validation. 
     *
     * @property onStepChanging
     * @type Event
     * @default function (event, currentIndex, newIndex) { return true; }
     * @for defaults
     **/
    onStepChanging: function (event, currentIndex, newIndex) { return true; },

    /**
     * Fires after the step has change. 
     *
     * @property onStepChanged
     * @type Event
     * @default function (event, currentIndex, priorIndex) { }
     * @for defaults
     **/
    onStepChanged: function (event, currentIndex, priorIndex) { },

    /**
     * Fires after cancelation. 
     *
     * @property onCanceled
     * @type Event
     * @default function (event) { }
     * @for defaults
     **/
    onCanceled: function (event) { },

    /**
     * Fires before finishing and can be used to prevent completion by returning `false`. 
     * Very useful for form validation. 
     *
     * @property onFinishing
     * @type Event
     * @default function (event, currentIndex) { return true; }
     * @for defaults
     **/
    onFinishing: function (event, currentIndex) { return true; },

    /**
     * Fires after completion. 
     *
     * @property onFinished
     * @type Event
     * @default function (event, currentIndex) { }
     * @for defaults
     **/
    onFinished: function (event, currentIndex) { },

    /**
     * Fires after async content is loaded. 
     *
     * @property onContentLoaded
     * @type Event
     * @default function (event, index) { }
     * @for defaults
     **/
    onContentLoaded: function (event, currentIndex) { },

    /**
     * Fires when the wizard is initialized. 
     *
     * @property onInit
     * @type Event
     * @default function (event) { }
     * @for defaults
     **/
    onInit: function (event, currentIndex) { },

    /**
     * Contains all labels. 
     *
     * @property labels
     * @type Object
     * @for defaults
     **/
    labels: {
        /**
         * Label for the cancel button.
         *
         * @property cancel
         * @type String
         * @default "Cancel"
         * @for defaults
         **/
        cancel: "Cancel",

        /**
         * This label is important for accessability reasons.
         * Indicates which step is activated.
         *
         * @property current
         * @type String
         * @default "current step:"
         * @for defaults
         **/
        current: "current step:",

        /**
         * This label is important for accessability reasons and describes the kind of navigation.
         *
         * @property pagination
         * @type String
         * @default "Pagination"
         * @for defaults
         * @since 0.9.7
         **/
        pagination: "Pagination",

        /**
         * Label for the finish button.
         *
         * @property finish
         * @type String
         * @default "Finish"
         * @for defaults
         **/
        finish: "Finish",

        /**
         * Label for the next button.
         *
         * @property next
         * @type String
         * @default "Next"
         * @for defaults
         **/
        next: "Next",

        /**
         * Label for the previous button.
         *
         * @property previous
         * @type String
         * @default "Previous"
         * @for defaults
         **/
        previous: "Previous",

        /**
         * Label for the loading animation.
         *
         * @property loading
         * @type String
         * @default "Loading ..."
         * @for defaults
         **/
        loading: "Loading ..."
    }
};
})(jQuery);
function getSelector(path, index) {
    if (path) {
        var pathParts = path.split(".");
        // subtracting 3 for index based searching excluding path & extension
        if (index <= (pathParts.length - 3)) {
            return pathParts[index + 1];
        }
    }
    return "";
}


function getParameterByName(name) {
    var regexS = "[\\?&]" + name + "=([^&#]*)",
        regex = new RegExp(regexS),
        results = regex.exec(window.location.search);
    if (results == null) {
        return "";
    } else {
        return decodeURIComponent(results[1].replace(/\+/g, " "));
    }
}

function getYoutubeVideoId(path) {
    if(path) {
        var video_id = path.split('v=')[1];
        var ampersandPosition = video_id.indexOf('&');
        if (ampersandPosition !== -1) {
            video_id = video_id.substring(0, ampersandPosition);
        }
        return video_id;
    }
}

function populateMultiSelectOption(fieldName, value) {
    $("input[name=" + fieldName + "]").val(value).trigger("change");
    $("select[name=" + fieldName + "]").val(value).trigger("change");
}

function createQueryString(data) {
    var queryString = "";
    for (var key in data) {
        queryString = queryString + key + "=" + data["" + key] + "&";
    }
    return queryString;
}

function populateFieldsUsingKeyAsNameInObject(obj) {
    $.each(obj, function (key, value) {
        $("input[name=" + key + "]").val(value);
    });
}

function repeatElements(elName, num) {
    var $field;
    if ($('[name=' + elName + ']').is('select')) {
        $field = $("select[name=" + elName + "]");
    } else {
        $field = $("input[name=" + elName + "]");
    }
    if ($field && $field.length > 0) {
        var repeatContainer = $field.closest("div.repeat-container");
        if (repeatContainer.length > 0) {
            var repeatBtn = repeatContainer.find("button.repeat-add");
            if (repeatBtn.length > 0) {
                for (var counter = 0; counter < (num - 1); counter++) {
                    repeatBtn.trigger("click");
                }
            }
        }

    }
}

function setImage(elName, imagePath) {
    var fileUploadEl = $("input[type=file][name=" + elName + "]").closest("div.file-upload");
    var imageEl = fileUploadEl.find("img.browse");
    if (imageEl && imageEl.length > 0 && imagePath) {
        imageEl.attr("src", imagePath).show();
        fileUploadEl.find("div.image-section").find("span").hide();
    }
}

function populateSingleSelect(elName, value) {
    $("select[name=" + elName + "]").val(value).trigger('change');
}

function getKeyFromValue(value, obj) {
    $.each(obj, function (key, val) {
        if (val === value) {
            return key;
        }
    });
    return null;
}

function convertToLowerCaseDash(str) {
    str = str.substring(0, 1).toLowerCase() + str.substring(1, str.length);
    str = str.replace(/([A-Z])/, '-$1');
    return str.toLowerCase();
}

function populateArrayValuesInRepeatField(elName, values) {
    if (values && values.length > 0) {
        var inputs = $("input[name=" + elName + "]");
        if (values.length > 1) {
            repeatElements(elName, values.length);
            inputs = $("input[name=" + elName + "]");
        }
        $.each(values, function (idx, value) {
            $(inputs[idx]).val(value);
        });
    }
}

function updateQueryStringParameter(uri, key, value) {
    var re = new RegExp("([?&])" + key + "=.*?(&|$)", "i");
    var separator = uri.indexOf('?') !== -1 ? "&" : "?";
    if (uri.match(re)) {
        return uri.replace(re, '$1' + key + "=" + value + '$2');
    }
    else {
        return uri + separator + key + "=" + value;
    }
}


function registerUdemyUser(){
    $.ajax({
        url: SIH.getEndPoint("/api/auth/user/udemy/register"),
        type: 'POST',
        dataType: 'json',
        headers: {"X-Auth-Token": store.getItem("token")},
        contentType: "application/json",
        success: function (response) {
           // showUdemyMessage(true,"");
            $("#modal-loader").modal('hide');
        },
        error:function(response){
           // showUdemyMessage(false,response);
            $("#modal-loader").modal('hide');
        }
    });
}
var errorHand = function(e) {
    e.preventDefault();
    e.stopPropagation();

};
/*function showUdemyMessage(succes,message){
    if(succes){
        $('.thankyou-modal').addClass("no-reload");
        $('.thankyou-modal .modal-body .heading').html("Congratulations");
        $('.thankyou-modal .modal-body p')
            .html("Your subscription request has been processed successfully!\n" +
                "\n" +
                "You will shortly receive email confirmation outlining details of your subscription.\n");
        $('.thankyou-modal').modal('show');
        return;
    }else{
        //var msg;
        //var msg = "Only DPIIT recognised startups can participate in this plan";
        if(message && message.responseText && message.responseText.indexOf("already taken")){
           //msg = "You are already registered.";
            //$('.thankyou-modal .modal-body .heading').html("Thank You");
            $('.thankyou-modal').addClass("no-reload");
            $('.thankyou-modal .modal-body p')
                .html("You are already subscribed");
            $('.thankyou-modal').modal('show');
            return;
        }else if([400,401,403,500].indexOf(message.status) > -1){
            $('.thankyou-modal').addClass("no-reload");
            $('.thankyou-modal .modal-body p')
                .html("Seems there is no response from Udemy. Please try later.");
            $('.thankyou-modal').modal('show');
            return;
        }
        //showErrorDialog(msg,errorHand);
    }
    $("#modal-loader").modal('hide');
}*/

$(document).ready(function(){
    if($(".enrol-udemy-btn").length) {
        if(store.getItem("token")){
            $(".enrol-udemy-btn").removeClass("secure");
        }else{
            return;
        }
        if (store.getItem("role") === 'Startup') {
            /*checkDippRecognizedStartup(function (data) {
                if (!data || !data.referenceNo) {
                    showUdemyMessage(false);
                    $(document).on('click','.enrol-udemy-btn',function(e){
                        e.preventDefault();
                        e.stopPropagation();
                        showUdemyMessage(false,"");
                        $("#modal-loader").modal('hide');
                    });
                   // $(".enrol-udemy-btn").addClass("display-n");
                }else{*/
                    $(document).on('click','.enrol-udemy-btn',function(e){
                        e.preventDefault();
                        e.stopPropagation();
                        if(store.getItem("role") === 'Startup') {
                            $("#modal-loader").modal('show');
                            /*checkDippRecognizedStartup(function (data) {
                                if (data && data.referenceNo) {*/
                                    registerUdemyUser();
                                   // $("#modal-loader").modal('hide');
                                /*} else {
                                    showUdemyMessage(false,"");
                                  //  $("#modal-loader").modal('hide');
                                }*/
                            /*});*/
                        }else{
                           // showUdemyMessage(false,"");
                            $("#modal-loader").modal('hide');
                        }
                    });
                }
                $("#modal-loader").modal('hide');
            /*})*/
        }else{
            //showUdemyMessage(false);
            $(".enrol-udemy-btn").addClass("display-n");
        }
    });

function checkDippRecognizedStartup(successCallback){
    $.ajax({
        type: "GET",
        async: false,
        url: SIH.getEndPoint("/api/auth/user/cin"),
        headers: {"X-Auth-Token": store.getItem("token")}
    }).done(successCallback);
}

function messageDialaog(title, message){
    bootbox.dialog({
        title: title,
        message: message,
        className: 'view-all-focus-sectors tag-view',
        buttons: {
            ok: {
                label: "OK",
                className: 'btn-info',
                callback: function(){
                    console.log('Custom OK clicked');
                    location.reload();
                }
            }
        }
    });

}

function showMessageDialog(title, message, reload, redirectUrl) {
    var options = {
        title: title,
        message: message,
        className: 'view-all-focus-sectors tag-view'
    };
    if(reload){
        options.buttons = {
            ok: {
                label: "OK",
                className: 'btn-info',
                callback: function(){
                    console.log('Custom OK clicked');
                    if (redirectUrl) {
                        location.href = redirectUrl;
                    } else {
                        location.reload();
                    }
                }
            }
        };
        options.closeButton= false;
    }
    bootbox.dialog(options);
}

function createBlob(data, contentType) {
    contentType = contentType || '';
    var sliceSize = 1024;
    var byteCharacters = null;
    var blobObj = null;
    try{
        byteCharacters = atob(data);
        //var byteCharacters = decodeURIComponent(escape(window.atob(base64Data)))
        var bytesLength = byteCharacters.length;
        var slicesCount = Math.ceil(bytesLength / sliceSize);
        var byteArrays = new Array(slicesCount);

        for (var sliceIndex = 0; sliceIndex < slicesCount; ++sliceIndex) {
            var begin = sliceIndex * sliceSize;
            var end = Math.min(begin + sliceSize, bytesLength);

            var bytes = new Array(end - begin);
            for (var offset = begin, i = 0 ; offset < end; ++i, ++offset) {
                bytes[i] = byteCharacters[offset].charCodeAt(0);
            }
            byteArrays[sliceIndex] = new Uint8Array(bytes);
        }
        blobObj = new Blob(byteArrays, { type: contentType });
    }catch(err){
        blobObj = new Blob(["\ufeff", data], { type: contentType });
    }

    return blobObj;
}

function downloadFile(blob, filename) {
    if (typeof window.navigator.msSaveBlob !== 'undefined') {
        // IE workaround for "HTML7007: One or more blob URLs were revoked by closing the blob for which they were created.
        // These URLs will no longer resolve as the data backing the URL has been freed."
        window.navigator.msSaveBlob(blob, filename);
    } else {
        var URL = window.URL || window.webkitURL;
        var downloadUrl = URL.createObjectURL(blob);

        if (filename) {
            // use HTML5 a[download] attribute to specify filename
            var a = document.createElement("a");
            // safari doesn't support this yet
            if (typeof a.download === 'undefined') {
                window.location = downloadUrl;
            } else {
                a.href = downloadUrl;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
            }
        } else {
            window.location = downloadUrl;
        }
        // cleanup
        setTimeout(function () { URL.revokeObjectURL(downloadUrl); }, 100);
    }
}


/* -----------------------------------------------
/* Author : Vincent Garreau  - vincentgarreau.com
/* MIT license: http://opensource.org/licenses/MIT
/* Demo / Generator : vincentgarreau.com/particles.js
/* GitHub : github.com/VincentGarreau/particles.js
/* How to use? : Check the GitHub README
/* v2.0.0
/* ----------------------------------------------- */

var pJS = function(tag_id, params){

    var canvas_el = document.querySelector('#'+tag_id+' > .particles-js-canvas-el');
  
    /* particles.js variables with default values */
    this.pJS = {
      canvas: {
        el: canvas_el,
        w: canvas_el.offsetWidth,
        h: canvas_el.offsetHeight
      },
      particles: {
        number: {
          value: 400,
          density: {
            enable: true,
            value_area: 800
          }
        },
        color: {
          value: '#fff'
        },
        shape: {
          type: 'circle',
          stroke: {
            width: 0,
            color: '#ff0000'
          },
          polygon: {
            nb_sides: 5
          },
          image: {
            src: '',
            width: 100,
            height: 100
          }
        },
        opacity: {
          value: 1,
          random: false,
          anim: {
            enable: false,
            speed: 2,
            opacity_min: 0,
            sync: false
          }
        },
        size: {
          value: 20,
          random: false,
          anim: {
            enable: false,
            speed: 20,
            size_min: 0,
            sync: false
          }
        },
        line_linked: {
          enable: true,
          distance: 100,
          color: '#fff',
          opacity: 1,
          width: 1
        },
        move: {
          enable: true,
          speed: 2,
          direction: 'none',
          random: false,
          straight: false,
          out_mode: 'out',
          bounce: false,
          attract: {
            enable: false,
            rotateX: 3000,
            rotateY: 3000
          }
        },
        array: []
      },
      interactivity: {
        detect_on: 'canvas',
        events: {
          onhover: {
            enable: true,
            mode: 'grab'
          },
          onclick: {
            enable: true,
            mode: 'push'
          },
          resize: true
        },
        modes: {
          grab:{
            distance: 100,
            line_linked:{
              opacity: 1
            }
          },
          bubble:{
            distance: 200,
            size: 80,
            duration: 0.4
          },
          repulse:{
            distance: 200,
            duration: 0.4
          },
          push:{
            particles_nb: 4
          },
          remove:{
            particles_nb: 2
          }
        },
        mouse:{}
      },
      retina_detect: false,
      fn: {
        interact: {},
        modes: {},
        vendors:{}
      },
      tmp: {}
    };
  
    var pJS = this.pJS;
  
    /* params settings */
    if(params){
      Object.deepExtend(pJS, params);
    }
  
    pJS.tmp.obj = {
      size_value: pJS.particles.size.value,
      size_anim_speed: pJS.particles.size.anim.speed,
      move_speed: pJS.particles.move.speed,
      line_linked_distance: pJS.particles.line_linked.distance,
      line_linked_width: pJS.particles.line_linked.width,
      mode_grab_distance: pJS.interactivity.modes.grab.distance,
      mode_bubble_distance: pJS.interactivity.modes.bubble.distance,
      mode_bubble_size: pJS.interactivity.modes.bubble.size,
      mode_repulse_distance: pJS.interactivity.modes.repulse.distance
    };
  
  
    pJS.fn.retinaInit = function(){
  
      if(pJS.retina_detect && window.devicePixelRatio > 1){
        pJS.canvas.pxratio = window.devicePixelRatio; 
        pJS.tmp.retina = true;
      } 
      else{
        pJS.canvas.pxratio = 1;
        pJS.tmp.retina = false;
      }
  
      pJS.canvas.w = pJS.canvas.el.offsetWidth * pJS.canvas.pxratio;
      pJS.canvas.h = pJS.canvas.el.offsetHeight * pJS.canvas.pxratio;
  
      pJS.particles.size.value = pJS.tmp.obj.size_value * pJS.canvas.pxratio;
      pJS.particles.size.anim.speed = pJS.tmp.obj.size_anim_speed * pJS.canvas.pxratio;
      pJS.particles.move.speed = pJS.tmp.obj.move_speed * pJS.canvas.pxratio;
      pJS.particles.line_linked.distance = pJS.tmp.obj.line_linked_distance * pJS.canvas.pxratio;
      pJS.interactivity.modes.grab.distance = pJS.tmp.obj.mode_grab_distance * pJS.canvas.pxratio;
      pJS.interactivity.modes.bubble.distance = pJS.tmp.obj.mode_bubble_distance * pJS.canvas.pxratio;
      pJS.particles.line_linked.width = pJS.tmp.obj.line_linked_width * pJS.canvas.pxratio;
      pJS.interactivity.modes.bubble.size = pJS.tmp.obj.mode_bubble_size * pJS.canvas.pxratio;
      pJS.interactivity.modes.repulse.distance = pJS.tmp.obj.mode_repulse_distance * pJS.canvas.pxratio;
  
    };
  
  
  
    /* ---------- pJS functions - canvas ------------ */
  
    pJS.fn.canvasInit = function(){
      pJS.canvas.ctx = pJS.canvas.el.getContext('2d');
    };
  
    pJS.fn.canvasSize = function(){
  
      pJS.canvas.el.width = pJS.canvas.w;
      pJS.canvas.el.height = pJS.canvas.h;
  
      if(pJS && pJS.interactivity.events.resize){
  
        window.addEventListener('resize', function(){
  
            pJS.canvas.w = pJS.canvas.el.offsetWidth;
            pJS.canvas.h = pJS.canvas.el.offsetHeight;
  
            /* resize canvas */
            if(pJS.tmp.retina){
              pJS.canvas.w *= pJS.canvas.pxratio;
              pJS.canvas.h *= pJS.canvas.pxratio;
            }
  
            pJS.canvas.el.width = pJS.canvas.w;
            pJS.canvas.el.height = pJS.canvas.h;
  
            /* repaint canvas on anim disabled */
            if(!pJS.particles.move.enable){
              pJS.fn.particlesEmpty();
              pJS.fn.particlesCreate();
              pJS.fn.particlesDraw();
              pJS.fn.vendors.densityAutoParticles();
            }
  
          /* density particles enabled */
          pJS.fn.vendors.densityAutoParticles();
  
        });
  
      }
  
    };
  
  
    pJS.fn.canvasPaint = function(){
      pJS.canvas.ctx.fillRect(0, 0, pJS.canvas.w, pJS.canvas.h);
    };
  
    pJS.fn.canvasClear = function(){
      pJS.canvas.ctx.clearRect(0, 0, pJS.canvas.w, pJS.canvas.h);
    };
  
  
    /* --------- pJS functions - particles ----------- */
  
    pJS.fn.particle = function(color, opacity, position){
  
      /* size */
      this.radius = (pJS.particles.size.random ? Math.random() : 1) * pJS.particles.size.value;
      if(pJS.particles.size.anim.enable){
        this.size_status = false;
        this.vs = pJS.particles.size.anim.speed / 100;
        if(!pJS.particles.size.anim.sync){
          this.vs = this.vs * Math.random();
        }
      }
  
      /* position */
      this.x = position ? position.x : Math.random() * pJS.canvas.w;
      this.y = position ? position.y : Math.random() * pJS.canvas.h;
  
      /* check position  - into the canvas */
      if(this.x > pJS.canvas.w - this.radius*2) this.x = this.x - this.radius;
      else if(this.x < this.radius*2) this.x = this.x + this.radius;
      if(this.y > pJS.canvas.h - this.radius*2) this.y = this.y - this.radius;
      else if(this.y < this.radius*2) this.y = this.y + this.radius;
  
      /* check position - avoid overlap */
      if(pJS.particles.move.bounce){
        pJS.fn.vendors.checkOverlap(this, position);
      }
  
      /* color */
      this.color = {};
      if(typeof(color.value) == 'object'){
  
        if(color.value instanceof Array){
          var color_selected = color.value[Math.floor(Math.random() * pJS.particles.color.value.length)];
          this.color.rgb = hexToRgb(color_selected);
        }else{
          if(color.value.r != undefined && color.value.g != undefined && color.value.b != undefined){
            this.color.rgb = {
              r: color.value.r,
              g: color.value.g,
              b: color.value.b
            }
          }
          if(color.value.h != undefined && color.value.s != undefined && color.value.l != undefined){
            this.color.hsl = {
              h: color.value.h,
              s: color.value.s,
              l: color.value.l
            }
          }
        }
  
      }
      else if(color.value == 'random'){
        this.color.rgb = {
          r: (Math.floor(Math.random() * (255 - 0 + 1)) + 0),
          g: (Math.floor(Math.random() * (255 - 0 + 1)) + 0),
          b: (Math.floor(Math.random() * (255 - 0 + 1)) + 0)
        }
      }
      else if(typeof(color.value) == 'string'){
        this.color = color;
        this.color.rgb = hexToRgb(this.color.value);
      }
  
      /* opacity */
      this.opacity = (pJS.particles.opacity.random ? Math.random() : 1) * pJS.particles.opacity.value;
      if(pJS.particles.opacity.anim.enable){
        this.opacity_status = false;
        this.vo = pJS.particles.opacity.anim.speed / 100;
        if(!pJS.particles.opacity.anim.sync){
          this.vo = this.vo * Math.random();
        }
      }
  
      /* animation - velocity for speed */
      var velbase = {}
      switch(pJS.particles.move.direction){
        case 'top':
          velbase = { x:0, y:-1 };
        break;
        case 'top-right':
          velbase = { x:0.5, y:-0.5 };
        break;
        case 'right':
          velbase = { x:1, y:-0 };
        break;
        case 'bottom-right':
          velbase = { x:0.5, y:0.5 };
        break;
        case 'bottom':
          velbase = { x:0, y:1 };
        break;
        case 'bottom-left':
          velbase = { x:-0.5, y:1 };
        break;
        case 'left':
          velbase = { x:-1, y:0 };
        break;
        case 'top-left':
          velbase = { x:-0.5, y:-0.5 };
        break;
        default:
          velbase = { x:0, y:0 };
        break;
      }
  
      if(pJS.particles.move.straight){
        this.vx = velbase.x;
        this.vy = velbase.y;
        if(pJS.particles.move.random){
          this.vx = this.vx * (Math.random());
          this.vy = this.vy * (Math.random());
        }
      }else{
        this.vx = velbase.x + Math.random()-0.5;
        this.vy = velbase.y + Math.random()-0.5;
      }
  
      // var theta = 2.0 * Math.PI * Math.random();
      // this.vx = Math.cos(theta);
      // this.vy = Math.sin(theta);
  
      this.vx_i = this.vx;
      this.vy_i = this.vy;
  
      
  
      /* if shape is image */
  
      var shape_type = pJS.particles.shape.type;
      if(typeof(shape_type) == 'object'){
        if(shape_type instanceof Array){
          var shape_selected = shape_type[Math.floor(Math.random() * shape_type.length)];
          this.shape = shape_selected;
        }
      }else{
        this.shape = shape_type;
      }
  
      if(this.shape == 'image'){
        var sh = pJS.particles.shape;
        this.img = {
          src: sh.image.src,
          ratio: sh.image.width / sh.image.height
        }
        if(!this.img.ratio) this.img.ratio = 1;
        if(pJS.tmp.img_type == 'svg' && pJS.tmp.source_svg != undefined){
          pJS.fn.vendors.createSvgImg(this);
          if(pJS.tmp.pushing){
            this.img.loaded = false;
          }
        }
      }
  
      
  
    };
  
  
    pJS.fn.particle.prototype.draw = function() {
  
      var p = this;
  
      if(p.radius_bubble != undefined){
        var radius = p.radius_bubble; 
      }else{
        var radius = p.radius;
      }
  
      if(p.opacity_bubble != undefined){
        var opacity = p.opacity_bubble;
      }else{
        var opacity = p.opacity;
      }
  
      if(p.color.rgb){
        var color_value = 'rgba('+p.color.rgb.r+','+p.color.rgb.g+','+p.color.rgb.b+','+opacity+')';
      }else{
        var color_value = 'hsla('+p.color.hsl.h+','+p.color.hsl.s+'%,'+p.color.hsl.l+'%,'+opacity+')';
      }
  
      pJS.canvas.ctx.fillStyle = color_value;
      pJS.canvas.ctx.beginPath();
  
      switch(p.shape){
  
        case 'circle':
          pJS.canvas.ctx.arc(p.x, p.y, radius, 0, Math.PI * 2, false);
        break;
  
        case 'edge':
          pJS.canvas.ctx.rect(p.x-radius, p.y-radius, radius*2, radius*2);
        break;
  
        case 'triangle':
          pJS.fn.vendors.drawShape(pJS.canvas.ctx, p.x-radius, p.y+radius / 1.66, radius*2, 3, 2);
        break;
  
        case 'polygon':
          pJS.fn.vendors.drawShape(
            pJS.canvas.ctx,
            p.x - radius / (pJS.particles.shape.polygon.nb_sides/3.5), // startX
            p.y - radius / (2.66/3.5), // startY
            radius*2.66 / (pJS.particles.shape.polygon.nb_sides/3), // sideLength
            pJS.particles.shape.polygon.nb_sides, // sideCountNumerator
            1 // sideCountDenominator
          );
        break;
  
        case 'star':
          pJS.fn.vendors.drawShape(
            pJS.canvas.ctx,
            p.x - radius*2 / (pJS.particles.shape.polygon.nb_sides/4), // startX
            p.y - radius / (2*2.66/3.5), // startY
            radius*2*2.66 / (pJS.particles.shape.polygon.nb_sides/3), // sideLength
            pJS.particles.shape.polygon.nb_sides, // sideCountNumerator
            2 // sideCountDenominator
          );
        break;
  
        case 'image':
  
          function draw(){
            pJS.canvas.ctx.drawImage(
              img_obj,
              p.x-radius,
              p.y-radius,
              radius*2,
              radius*2 / p.img.ratio
            );
          }
  
          if(pJS.tmp.img_type == 'svg'){
            var img_obj = p.img.obj;
          }else{
            var img_obj = pJS.tmp.img_obj;
          }
  
          if(img_obj){
            draw();
          }
  
        break;
  
      }
  
      pJS.canvas.ctx.closePath();
  
      if(pJS.particles.shape.stroke.width > 0){
        pJS.canvas.ctx.strokeStyle = pJS.particles.shape.stroke.color;
        pJS.canvas.ctx.lineWidth = pJS.particles.shape.stroke.width;
        pJS.canvas.ctx.stroke();
      }
      
      pJS.canvas.ctx.fill();
      
    };
  
  
    pJS.fn.particlesCreate = function(){
      for(var i = 0; i < pJS.particles.number.value; i++) {
        pJS.particles.array.push(new pJS.fn.particle(pJS.particles.color, pJS.particles.opacity.value));
      }
    };
  
    pJS.fn.particlesUpdate = function(){
  
      for(var i = 0; i < pJS.particles.array.length; i++){
  
        /* the particle */
        var p = pJS.particles.array[i];
  
        // var d = ( dx = pJS.interactivity.mouse.click_pos_x - p.x ) * dx + ( dy = pJS.interactivity.mouse.click_pos_y - p.y ) * dy;
        // var f = -BANG_SIZE / d;
        // if ( d < BANG_SIZE ) {
        //     var t = Math.atan2( dy, dx );
        //     p.vx = f * Math.cos(t);
        //     p.vy = f * Math.sin(t);
        // }
  
        /* move the particle */
        if(pJS.particles.move.enable){
          var ms = pJS.particles.move.speed/2;
          p.x += p.vx * ms;
          p.y += p.vy * ms;
        }
  
        /* change opacity status */
        if(pJS.particles.opacity.anim.enable) {
          if(p.opacity_status == true) {
            if(p.opacity >= pJS.particles.opacity.value) p.opacity_status = false;
            p.opacity += p.vo;
          }else {
            if(p.opacity <= pJS.particles.opacity.anim.opacity_min) p.opacity_status = true;
            p.opacity -= p.vo;
          }
          if(p.opacity < 0) p.opacity = 0;
        }
  
        /* change size */
        if(pJS.particles.size.anim.enable){
          if(p.size_status == true){
            if(p.radius >= pJS.particles.size.value) p.size_status = false;
            p.radius += p.vs;
          }else{
            if(p.radius <= pJS.particles.size.anim.size_min) p.size_status = true;
            p.radius -= p.vs;
          }
          if(p.radius < 0) p.radius = 0;
        }
  
        /* change particle position if it is out of canvas */
        if(pJS.particles.move.out_mode == 'bounce'){
          var new_pos = {
            x_left: p.radius,
            x_right:  pJS.canvas.w,
            y_top: p.radius,
            y_bottom: pJS.canvas.h
          }
        }else{
          var new_pos = {
            x_left: -p.radius,
            x_right: pJS.canvas.w + p.radius,
            y_top: -p.radius,
            y_bottom: pJS.canvas.h + p.radius
          }
        }
  
        if(p.x - p.radius > pJS.canvas.w){
          p.x = new_pos.x_left;
          p.y = Math.random() * pJS.canvas.h;
        }
        else if(p.x + p.radius < 0){
          p.x = new_pos.x_right;
          p.y = Math.random() * pJS.canvas.h;
        }
        if(p.y - p.radius > pJS.canvas.h){
          p.y = new_pos.y_top;
          p.x = Math.random() * pJS.canvas.w;
        }
        else if(p.y + p.radius < 0){
          p.y = new_pos.y_bottom;
          p.x = Math.random() * pJS.canvas.w;
        }
  
        /* out of canvas modes */
        switch(pJS.particles.move.out_mode){
          case 'bounce':
            if (p.x + p.radius > pJS.canvas.w) p.vx = -p.vx;
            else if (p.x - p.radius < 0) p.vx = -p.vx;
            if (p.y + p.radius > pJS.canvas.h) p.vy = -p.vy;
            else if (p.y - p.radius < 0) p.vy = -p.vy;
          break;
        }
  
        /* events */
        if(isInArray('grab', pJS.interactivity.events.onhover.mode)){
          pJS.fn.modes.grabParticle(p);
        }
  
        if(isInArray('bubble', pJS.interactivity.events.onhover.mode) || isInArray('bubble', pJS.interactivity.events.onclick.mode)){
          pJS.fn.modes.bubbleParticle(p);
        }
  
        if(isInArray('repulse', pJS.interactivity.events.onhover.mode) || isInArray('repulse', pJS.interactivity.events.onclick.mode)){
          pJS.fn.modes.repulseParticle(p);
        }
  
        /* interaction auto between particles */
        if(pJS.particles.line_linked.enable || pJS.particles.move.attract.enable){
          for(var j = i + 1; j < pJS.particles.array.length; j++){
            var p2 = pJS.particles.array[j];
  
            /* link particles */
            if(pJS.particles.line_linked.enable){
              pJS.fn.interact.linkParticles(p,p2);
            }
  
            /* attract particles */
            if(pJS.particles.move.attract.enable){
              pJS.fn.interact.attractParticles(p,p2);
            }
  
            /* bounce particles */
            if(pJS.particles.move.bounce){
              pJS.fn.interact.bounceParticles(p,p2);
            }
  
          }
        }
  
  
      }
  
    };
  
    pJS.fn.particlesDraw = function(){
  
      /* clear canvas */
      pJS.canvas.ctx.clearRect(0, 0, pJS.canvas.w, pJS.canvas.h);
  
      /* update each particles param */
      pJS.fn.particlesUpdate();
  
      /* draw each particle */
      for(var i = 0; i < pJS.particles.array.length; i++){
        var p = pJS.particles.array[i];
        p.draw();
      }
  
    };
  
    pJS.fn.particlesEmpty = function(){
      pJS.particles.array = [];
    };
  
    pJS.fn.particlesRefresh = function(){
  
      /* init all */
      cancelRequestAnimFrame(pJS.fn.checkAnimFrame);
      cancelRequestAnimFrame(pJS.fn.drawAnimFrame);
      pJS.tmp.source_svg = undefined;
      pJS.tmp.img_obj = undefined;
      pJS.tmp.count_svg = 0;
      pJS.fn.particlesEmpty();
      pJS.fn.canvasClear();
      
      /* restart */
      pJS.fn.vendors.start();
  
    };
  
  
    /* ---------- pJS functions - particles interaction ------------ */
  
    pJS.fn.interact.linkParticles = function(p1, p2){
  
      var dx = p1.x - p2.x,
          dy = p1.y - p2.y,
          dist = Math.sqrt(dx*dx + dy*dy);
  
      /* draw a line between p1 and p2 if the distance between them is under the config distance */
      if(dist <= pJS.particles.line_linked.distance){
  
        var opacity_line = pJS.particles.line_linked.opacity - (dist / (1/pJS.particles.line_linked.opacity)) / pJS.particles.line_linked.distance;
  
        if(opacity_line > 0){        
          
          /* style */
          var color_line = pJS.particles.line_linked.color_rgb_line;
          pJS.canvas.ctx.strokeStyle = 'rgba('+color_line.r+','+color_line.g+','+color_line.b+','+opacity_line+')';
          pJS.canvas.ctx.lineWidth = pJS.particles.line_linked.width;
          //pJS.canvas.ctx.lineCap = 'round'; /* performance issue */
          
          /* path */
          pJS.canvas.ctx.beginPath();
          pJS.canvas.ctx.moveTo(p1.x, p1.y);
          pJS.canvas.ctx.lineTo(p2.x, p2.y);
          pJS.canvas.ctx.stroke();
          pJS.canvas.ctx.closePath();
  
        }
  
      }
  
    };
  
  
    pJS.fn.interact.attractParticles  = function(p1, p2){
  
      /* condensed particles */
      var dx = p1.x - p2.x,
          dy = p1.y - p2.y,
          dist = Math.sqrt(dx*dx + dy*dy);
  
      if(dist <= pJS.particles.line_linked.distance){
  
        var ax = dx/(pJS.particles.move.attract.rotateX*1000),
            ay = dy/(pJS.particles.move.attract.rotateY*1000);
  
        p1.vx -= ax;
        p1.vy -= ay;
  
        p2.vx += ax;
        p2.vy += ay;
  
      }
      
  
    }
  
  
    pJS.fn.interact.bounceParticles = function(p1, p2){
  
      var dx = p1.x - p2.x,
          dy = p1.y - p2.y,
          dist = Math.sqrt(dx*dx + dy*dy),
          dist_p = p1.radius+p2.radius;
  
      if(dist <= dist_p){
        p1.vx = -p1.vx;
        p1.vy = -p1.vy;
  
        p2.vx = -p2.vx;
        p2.vy = -p2.vy;
      }
  
    }
  
  
    /* ---------- pJS functions - modes events ------------ */
  
    pJS.fn.modes.pushParticles = function(nb, pos){
  
      pJS.tmp.pushing = true;
  
      for(var i = 0; i < nb; i++){
        pJS.particles.array.push(
          new pJS.fn.particle(
            pJS.particles.color,
            pJS.particles.opacity.value,
            {
              'x': pos ? pos.pos_x : Math.random() * pJS.canvas.w,
              'y': pos ? pos.pos_y : Math.random() * pJS.canvas.h
            }
          )
        )
        if(i == nb-1){
          if(!pJS.particles.move.enable){
            pJS.fn.particlesDraw();
          }
          pJS.tmp.pushing = false;
        }
      }
  
    };
  
  
    pJS.fn.modes.removeParticles = function(nb){
  
      pJS.particles.array.splice(0, nb);
      if(!pJS.particles.move.enable){
        pJS.fn.particlesDraw();
      }
  
    };
  
  
    pJS.fn.modes.bubbleParticle = function(p){
  
      /* on hover event */
      if(pJS.interactivity.events.onhover.enable && isInArray('bubble', pJS.interactivity.events.onhover.mode)){
  
        var dx_mouse = p.x - pJS.interactivity.mouse.pos_x,
            dy_mouse = p.y - pJS.interactivity.mouse.pos_y,
            dist_mouse = Math.sqrt(dx_mouse*dx_mouse + dy_mouse*dy_mouse),
            ratio = 1 - dist_mouse / pJS.interactivity.modes.bubble.distance;
  
        function init(){
          p.opacity_bubble = p.opacity;
          p.radius_bubble = p.radius;
        }
  
        /* mousemove - check ratio */
        if(dist_mouse <= pJS.interactivity.modes.bubble.distance){
  
          if(ratio >= 0 && pJS.interactivity.status == 'mousemove'){
            
            /* size */
            if(pJS.interactivity.modes.bubble.size != pJS.particles.size.value){
  
              if(pJS.interactivity.modes.bubble.size > pJS.particles.size.value){
                var size = p.radius + (pJS.interactivity.modes.bubble.size*ratio);
                if(size >= 0){
                  p.radius_bubble = size;
                }
              }else{
                var dif = p.radius - pJS.interactivity.modes.bubble.size,
                    size = p.radius - (dif*ratio);
                if(size > 0){
                  p.radius_bubble = size;
                }else{
                  p.radius_bubble = 0;
                }
              }
  
            }
  
            /* opacity */
            if(pJS.interactivity.modes.bubble.opacity != pJS.particles.opacity.value){
  
              if(pJS.interactivity.modes.bubble.opacity > pJS.particles.opacity.value){
                var opacity = pJS.interactivity.modes.bubble.opacity*ratio;
                if(opacity > p.opacity && opacity <= pJS.interactivity.modes.bubble.opacity){
                  p.opacity_bubble = opacity;
                }
              }else{
                var opacity = p.opacity - (pJS.particles.opacity.value-pJS.interactivity.modes.bubble.opacity)*ratio;
                if(opacity < p.opacity && opacity >= pJS.interactivity.modes.bubble.opacity){
                  p.opacity_bubble = opacity;
                }
              }
  
            }
  
          }
  
        }else{
          init();
        }
  
  
        /* mouseleave */
        if(pJS.interactivity.status == 'mouseleave'){
          init();
        }
      
      }
  
      /* on click event */
      else if(pJS.interactivity.events.onclick.enable && isInArray('bubble', pJS.interactivity.events.onclick.mode)){
  
  
        if(pJS.tmp.bubble_clicking){
          var dx_mouse = p.x - pJS.interactivity.mouse.click_pos_x,
              dy_mouse = p.y - pJS.interactivity.mouse.click_pos_y,
              dist_mouse = Math.sqrt(dx_mouse*dx_mouse + dy_mouse*dy_mouse),
              time_spent = (new Date().getTime() - pJS.interactivity.mouse.click_time)/1000;
  
          if(time_spent > pJS.interactivity.modes.bubble.duration){
            pJS.tmp.bubble_duration_end = true;
          }
  
          if(time_spent > pJS.interactivity.modes.bubble.duration*2){
            pJS.tmp.bubble_clicking = false;
            pJS.tmp.bubble_duration_end = false;
          }
        }
  
  
        function process(bubble_param, particles_param, p_obj_bubble, p_obj, id){
  
          if(bubble_param != particles_param){
  
            if(!pJS.tmp.bubble_duration_end){
              if(dist_mouse <= pJS.interactivity.modes.bubble.distance){
                if(p_obj_bubble != undefined) var obj = p_obj_bubble;
                else var obj = p_obj;
                if(obj != bubble_param){
                  var value = p_obj - (time_spent * (p_obj - bubble_param) / pJS.interactivity.modes.bubble.duration);
                  if(id == 'size') p.radius_bubble = value;
                  if(id == 'opacity') p.opacity_bubble = value;
                }
              }else{
                if(id == 'size') p.radius_bubble = undefined;
                if(id == 'opacity') p.opacity_bubble = undefined;
              }
            }else{
              if(p_obj_bubble != undefined){
                var value_tmp = p_obj - (time_spent * (p_obj - bubble_param) / pJS.interactivity.modes.bubble.duration),
                    dif = bubble_param - value_tmp;
                    value = bubble_param + dif;
                if(id == 'size') p.radius_bubble = value;
                if(id == 'opacity') p.opacity_bubble = value;
              }
            }
  
          }
  
        }
  
        if(pJS.tmp.bubble_clicking){
          /* size */
          process(pJS.interactivity.modes.bubble.size, pJS.particles.size.value, p.radius_bubble, p.radius, 'size');
          /* opacity */
          process(pJS.interactivity.modes.bubble.opacity, pJS.particles.opacity.value, p.opacity_bubble, p.opacity, 'opacity');
        }
  
      }
  
    };
  
  
    pJS.fn.modes.repulseParticle = function(p){
  
      if(pJS.interactivity.events.onhover.enable && isInArray('repulse', pJS.interactivity.events.onhover.mode) && pJS.interactivity.status == 'mousemove') {
  
        var dx_mouse = p.x - pJS.interactivity.mouse.pos_x,
            dy_mouse = p.y - pJS.interactivity.mouse.pos_y,
            dist_mouse = Math.sqrt(dx_mouse*dx_mouse + dy_mouse*dy_mouse);
  
        var normVec = {x: dx_mouse/dist_mouse, y: dy_mouse/dist_mouse},
            repulseRadius = pJS.interactivity.modes.repulse.distance,
            velocity = 100,
            repulseFactor = clamp((1/repulseRadius)*(-1*Math.pow(dist_mouse/repulseRadius,2)+1)*repulseRadius*velocity, 0, 50);
        
        var pos = {
          x: p.x + normVec.x * repulseFactor,
          y: p.y + normVec.y * repulseFactor
        }
  
        if(pJS.particles.move.out_mode == 'bounce'){
          if(pos.x - p.radius > 0 && pos.x + p.radius < pJS.canvas.w) p.x = pos.x;
          if(pos.y - p.radius > 0 && pos.y + p.radius < pJS.canvas.h) p.y = pos.y;
        }else{
          p.x = pos.x;
          p.y = pos.y;
        }
      
      }
  
  
      else if(pJS.interactivity.events.onclick.enable && isInArray('repulse', pJS.interactivity.events.onclick.mode)) {
  
        if(!pJS.tmp.repulse_finish){
          pJS.tmp.repulse_count++;
          if(pJS.tmp.repulse_count == pJS.particles.array.length){
            pJS.tmp.repulse_finish = true;
          }
        }
  
        if(pJS.tmp.repulse_clicking){
  
          var repulseRadius = Math.pow(pJS.interactivity.modes.repulse.distance/6, 3);
  
          var dx = pJS.interactivity.mouse.click_pos_x - p.x,
              dy = pJS.interactivity.mouse.click_pos_y - p.y,
              d = dx*dx + dy*dy;
  
          var force = -repulseRadius / d * 1;
  
          function process(){
  
            var f = Math.atan2(dy,dx);
            p.vx = force * Math.cos(f);
            p.vy = force * Math.sin(f);
  
            if(pJS.particles.move.out_mode == 'bounce'){
              var pos = {
                x: p.x + p.vx,
                y: p.y + p.vy
              }
              if (pos.x + p.radius > pJS.canvas.w) p.vx = -p.vx;
              else if (pos.x - p.radius < 0) p.vx = -p.vx;
              if (pos.y + p.radius > pJS.canvas.h) p.vy = -p.vy;
              else if (pos.y - p.radius < 0) p.vy = -p.vy;
            }
  
          }
  
          // default
          if(d <= repulseRadius){
            process();
          }
  
          // bang - slow motion mode
          // if(!pJS.tmp.repulse_finish){
          //   if(d <= repulseRadius){
          //     process();
          //   }
          // }else{
          //   process();
          // }
          
  
        }else{
  
          if(pJS.tmp.repulse_clicking == false){
  
            p.vx = p.vx_i;
            p.vy = p.vy_i;
          
          }
  
        }
  
      }
  
    }
  
  
    pJS.fn.modes.grabParticle = function(p){
  
      if(pJS.interactivity.events.onhover.enable && pJS.interactivity.status == 'mousemove'){
  
        var dx_mouse = p.x - pJS.interactivity.mouse.pos_x,
            dy_mouse = p.y - pJS.interactivity.mouse.pos_y,
            dist_mouse = Math.sqrt(dx_mouse*dx_mouse + dy_mouse*dy_mouse);
  
        /* draw a line between the cursor and the particle if the distance between them is under the config distance */
        if(dist_mouse <= pJS.interactivity.modes.grab.distance){
  
          var opacity_line = pJS.interactivity.modes.grab.line_linked.opacity - (dist_mouse / (1/pJS.interactivity.modes.grab.line_linked.opacity)) / pJS.interactivity.modes.grab.distance;
  
          if(opacity_line > 0){
  
            /* style */
            var color_line = pJS.particles.line_linked.color_rgb_line;
            pJS.canvas.ctx.strokeStyle = 'rgba('+color_line.r+','+color_line.g+','+color_line.b+','+opacity_line+')';
            pJS.canvas.ctx.lineWidth = pJS.particles.line_linked.width;
            //pJS.canvas.ctx.lineCap = 'round'; /* performance issue */
            
            /* path */
            pJS.canvas.ctx.beginPath();
            pJS.canvas.ctx.moveTo(p.x, p.y);
            pJS.canvas.ctx.lineTo(pJS.interactivity.mouse.pos_x, pJS.interactivity.mouse.pos_y);
            pJS.canvas.ctx.stroke();
            pJS.canvas.ctx.closePath();
  
          }
  
        }
  
      }
  
    };
  
  
  
    /* ---------- pJS functions - vendors ------------ */
  
    pJS.fn.vendors.eventsListeners = function(){
  
      /* events target element */
      if(pJS.interactivity.detect_on == 'window'){
        pJS.interactivity.el = window;
      }else{
        pJS.interactivity.el = pJS.canvas.el;
      }
  
  
      /* detect mouse pos - on hover / click event */
      if(pJS.interactivity.events.onhover.enable || pJS.interactivity.events.onclick.enable){
  
        /* el on mousemove */
        pJS.interactivity.el.addEventListener('mousemove', function(e){
  
          if(pJS.interactivity.el == window){
            var pos_x = e.clientX,
                pos_y = e.clientY;
          }
          else{
            var pos_x = e.offsetX || e.clientX,
                pos_y = e.offsetY || e.clientY;
          }
  
          pJS.interactivity.mouse.pos_x = pos_x;
          pJS.interactivity.mouse.pos_y = pos_y;
  
          if(pJS.tmp.retina){
            pJS.interactivity.mouse.pos_x *= pJS.canvas.pxratio;
            pJS.interactivity.mouse.pos_y *= pJS.canvas.pxratio;
          }
  
          pJS.interactivity.status = 'mousemove';
  
        });
  
        /* el on onmouseleave */
        pJS.interactivity.el.addEventListener('mouseleave', function(e){
  
          pJS.interactivity.mouse.pos_x = null;
          pJS.interactivity.mouse.pos_y = null;
          pJS.interactivity.status = 'mouseleave';
  
        });
  
      }
  
      /* on click event */
      if(pJS.interactivity.events.onclick.enable){
  
        pJS.interactivity.el.addEventListener('click', function(){
  
          pJS.interactivity.mouse.click_pos_x = pJS.interactivity.mouse.pos_x;
          pJS.interactivity.mouse.click_pos_y = pJS.interactivity.mouse.pos_y;
          pJS.interactivity.mouse.click_time = new Date().getTime();
  
          if(pJS.interactivity.events.onclick.enable){
  
            switch(pJS.interactivity.events.onclick.mode){
  
              case 'push':
                if(pJS.particles.move.enable){
                  pJS.fn.modes.pushParticles(pJS.interactivity.modes.push.particles_nb, pJS.interactivity.mouse);
                }else{
                  if(pJS.interactivity.modes.push.particles_nb == 1){
                    pJS.fn.modes.pushParticles(pJS.interactivity.modes.push.particles_nb, pJS.interactivity.mouse);
                  }
                  else if(pJS.interactivity.modes.push.particles_nb > 1){
                    pJS.fn.modes.pushParticles(pJS.interactivity.modes.push.particles_nb);
                  }
                }
              break;
  
              case 'remove':
                pJS.fn.modes.removeParticles(pJS.interactivity.modes.remove.particles_nb);
              break;
  
              case 'bubble':
                pJS.tmp.bubble_clicking = true;
              break;
  
              case 'repulse':
                pJS.tmp.repulse_clicking = true;
                pJS.tmp.repulse_count = 0;
                pJS.tmp.repulse_finish = false;
                setTimeout(function(){
                  pJS.tmp.repulse_clicking = false;
                }, pJS.interactivity.modes.repulse.duration*1000)
              break;
  
            }
  
          }
  
        });
          
      }
  
  
    };
  
    pJS.fn.vendors.densityAutoParticles = function(){
  
      if(pJS.particles.number.density.enable){
  
        /* calc area */
        var area = pJS.canvas.el.width * pJS.canvas.el.height / 1000;
        if(pJS.tmp.retina){
          area = area/(pJS.canvas.pxratio*2);
        }
  
        /* calc number of particles based on density area */
        var nb_particles = area * pJS.particles.number.value / pJS.particles.number.density.value_area;
  
        /* add or remove X particles */
        var missing_particles = pJS.particles.array.length - nb_particles;
        if(missing_particles < 0) pJS.fn.modes.pushParticles(Math.abs(missing_particles));
        else pJS.fn.modes.removeParticles(missing_particles);
  
      }
  
    };
  
  
    pJS.fn.vendors.checkOverlap = function(p1, position){
      for(var i = 0; i < pJS.particles.array.length; i++){
        var p2 = pJS.particles.array[i];
  
        var dx = p1.x - p2.x,
            dy = p1.y - p2.y,
            dist = Math.sqrt(dx*dx + dy*dy);
  
        if(dist <= p1.radius + p2.radius){
          p1.x = position ? position.x : Math.random() * pJS.canvas.w;
          p1.y = position ? position.y : Math.random() * pJS.canvas.h;
          pJS.fn.vendors.checkOverlap(p1);
        }
      }
    };
  
  
    pJS.fn.vendors.createSvgImg = function(p){
  
      /* set color to svg element */
      var svgXml = pJS.tmp.source_svg,
          rgbHex = /#([0-9A-F]{3,6})/gi,
          coloredSvgXml = svgXml.replace(rgbHex, function (m, r, g, b) {
            if(p.color.rgb){
              var color_value = 'rgba('+p.color.rgb.r+','+p.color.rgb.g+','+p.color.rgb.b+','+p.opacity+')';
            }else{
              var color_value = 'hsla('+p.color.hsl.h+','+p.color.hsl.s+'%,'+p.color.hsl.l+'%,'+p.opacity+')';
            }
            return color_value;
          });
  
      /* prepare to create img with colored svg */
      var svg = new Blob([coloredSvgXml], {type: 'image/svg+xml;charset=utf-8'}),
          DOMURL = window.URL || window.webkitURL || window,
          url = DOMURL.createObjectURL(svg);
  
      /* create particle img obj */
      var img = new Image();
      img.addEventListener('load', function(){
        p.img.obj = img;
        p.img.loaded = true;
        DOMURL.revokeObjectURL(url);
        pJS.tmp.count_svg++;
      });
      img.src = url;
  
    };
  
  
    pJS.fn.vendors.destroypJS = function(){
      cancelAnimationFrame(pJS.fn.drawAnimFrame);
      canvas_el.remove();
      pJSDom = null;
    };
  
  
    pJS.fn.vendors.drawShape = function(c, startX, startY, sideLength, sideCountNumerator, sideCountDenominator){
  
      // By Programming Thomas - https://programmingthomas.wordpress.com/2013/04/03/n-sided-shapes/
      var sideCount = sideCountNumerator * sideCountDenominator;
      var decimalSides = sideCountNumerator / sideCountDenominator;
      var interiorAngleDegrees = (180 * (decimalSides - 2)) / decimalSides;
      var interiorAngle = Math.PI - Math.PI * interiorAngleDegrees / 180; // convert to radians
      c.save();
      c.beginPath();
      c.translate(startX, startY);
      c.moveTo(0,0);
      for (var i = 0; i < sideCount; i++) {
        c.lineTo(sideLength,0);
        c.translate(sideLength,0);
        c.rotate(interiorAngle);
      }
      //c.stroke();
      c.fill();
      c.restore();
  
    };
  
    pJS.fn.vendors.exportImg = function(){
      window.open(pJS.canvas.el.toDataURL('image/png'), '_blank');
    };
  
  
    pJS.fn.vendors.loadImg = function(type){
  
      pJS.tmp.img_error = undefined;
  
      if(pJS.particles.shape.image.src != ''){
  
        if(type == 'svg'){
  
          var xhr = new XMLHttpRequest();
          xhr.open('GET', pJS.particles.shape.image.src);
          xhr.onreadystatechange = function (data) {
            if(xhr.readyState == 4){
              if(xhr.status == 200){
                pJS.tmp.source_svg = data.currentTarget.response;
                pJS.fn.vendors.checkBeforeDraw();
              }else{
                console.log('Error pJS - Image not found');
                pJS.tmp.img_error = true;
              }
            }
          }
          xhr.send();
  
        }else{
  
          var img = new Image();
          img.addEventListener('load', function(){
            pJS.tmp.img_obj = img;
            pJS.fn.vendors.checkBeforeDraw();
          });
          img.src = pJS.particles.shape.image.src;
  
        }
  
      }else{
        console.log('Error pJS - No image.src');
        pJS.tmp.img_error = true;
      }
  
    };
  
  
    pJS.fn.vendors.draw = function(){
  
      if(pJS.particles.shape.type == 'image'){
  
        if(pJS.tmp.img_type == 'svg'){
  
          if(pJS.tmp.count_svg >= pJS.particles.number.value){
            pJS.fn.particlesDraw();
            if(!pJS.particles.move.enable) cancelRequestAnimFrame(pJS.fn.drawAnimFrame);
            else pJS.fn.drawAnimFrame = requestAnimFrame(pJS.fn.vendors.draw);
          }else{
            //console.log('still loading...');
            if(!pJS.tmp.img_error) pJS.fn.drawAnimFrame = requestAnimFrame(pJS.fn.vendors.draw);
          }
  
        }else{
  
          if(pJS.tmp.img_obj != undefined){
            pJS.fn.particlesDraw();
            if(!pJS.particles.move.enable) cancelRequestAnimFrame(pJS.fn.drawAnimFrame);
            else pJS.fn.drawAnimFrame = requestAnimFrame(pJS.fn.vendors.draw);
          }else{
            if(!pJS.tmp.img_error) pJS.fn.drawAnimFrame = requestAnimFrame(pJS.fn.vendors.draw);
          }
  
        }
  
      }else{
        pJS.fn.particlesDraw();
        if(!pJS.particles.move.enable) cancelRequestAnimFrame(pJS.fn.drawAnimFrame);
        else pJS.fn.drawAnimFrame = requestAnimFrame(pJS.fn.vendors.draw);
      }
  
    };
  
  
    pJS.fn.vendors.checkBeforeDraw = function(){
  
      // if shape is image
      if(pJS.particles.shape.type == 'image'){
  
        if(pJS.tmp.img_type == 'svg' && pJS.tmp.source_svg == undefined){
          pJS.tmp.checkAnimFrame = requestAnimFrame(check);
        }else{
          //console.log('images loaded! cancel check');
          cancelRequestAnimFrame(pJS.tmp.checkAnimFrame);
          if(!pJS.tmp.img_error){
            pJS.fn.vendors.init();
            pJS.fn.vendors.draw();
          }
          
        }
  
      }else{
        pJS.fn.vendors.init();
        pJS.fn.vendors.draw();
      }
  
    };
  
  
    pJS.fn.vendors.init = function(){
  
      /* init canvas + particles */
      pJS.fn.retinaInit();
      pJS.fn.canvasInit();
      pJS.fn.canvasSize();
      pJS.fn.canvasPaint();
      pJS.fn.particlesCreate();
      pJS.fn.vendors.densityAutoParticles();
  
      /* particles.line_linked - convert hex colors to rgb */
      pJS.particles.line_linked.color_rgb_line = hexToRgb(pJS.particles.line_linked.color);
  
    };
  
  
    pJS.fn.vendors.start = function(){
  
      if(isInArray('image', pJS.particles.shape.type)){
        pJS.tmp.img_type = pJS.particles.shape.image.src.substr(pJS.particles.shape.image.src.length - 3);
        pJS.fn.vendors.loadImg(pJS.tmp.img_type);
      }else{
        pJS.fn.vendors.checkBeforeDraw();
      }
  
    };
  
  
  
  
    /* ---------- pJS - start ------------ */
  
  
    pJS.fn.vendors.eventsListeners();
  
    pJS.fn.vendors.start();
    
  
  
  };
  
  /* ---------- global functions - vendors ------------ */
  
  Object.deepExtend = function(destination, source) {
    for (var property in source) {
      if (source[property] && source[property].constructor &&
       source[property].constructor === Object) {
        destination[property] = destination[property] || {};
        arguments.callee(destination[property], source[property]);
      } else {
        destination[property] = source[property];
      }
    }
    return destination;
  };
  
  window.requestAnimFrame = (function(){
    return  window.requestAnimationFrame ||
      window.webkitRequestAnimationFrame ||
      window.mozRequestAnimationFrame    ||
      window.oRequestAnimationFrame      ||
      window.msRequestAnimationFrame     ||
      function(callback){
        window.setTimeout(callback, 1000 / 60);
      };
  })();
  
  window.cancelRequestAnimFrame = ( function() {
    return window.cancelAnimationFrame         ||
      window.webkitCancelRequestAnimationFrame ||
      window.mozCancelRequestAnimationFrame    ||
      window.oCancelRequestAnimationFrame      ||
      window.msCancelRequestAnimationFrame     ||
      clearTimeout
  } )();
  
  function hexToRgb(hex){
    // By Tim Down - http://stackoverflow.com/a/5624139/3493650
    // Expand shorthand form (e.g. "03F") to full form (e.g. "0033FF")
    var shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
    hex = hex.replace(shorthandRegex, function(m, r, g, b) {
       return r + r + g + g + b + b;
    });
    var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
    return result ? {
        r: parseInt(result[1], 16),
        g: parseInt(result[2], 16),
        b: parseInt(result[3], 16)
    } : null;
  };
  
  function clamp(number, min, max) {
    return Math.min(Math.max(number, min), max);
  };
  
  function isInArray(value, array) {
    return array.indexOf(value) > -1;
  }
  
  
  /* ---------- particles.js functions - start ------------ */
  
  window.pJSDom = [];
  
  window.particlesJS = function(tag_id, params){
  
    //console.log(params);
  
    /* no string id? so it's object params, and set the id with default id */
    if(typeof(tag_id) != 'string'){
      params = tag_id;
      tag_id = 'particles-js';
    }
  
    /* no id? set the id to default id */
    if(!tag_id){
      tag_id = 'particles-js';
    }
  
    /* pJS elements */
    var pJS_tag = document.getElementById(tag_id),
        pJS_canvas_class = 'particles-js-canvas-el',
        exist_canvas = pJS_tag.getElementsByClassName(pJS_canvas_class);
  
    /* remove canvas if exists into the pJS target tag */
    if(exist_canvas.length){
      while(exist_canvas.length > 0){
        pJS_tag.removeChild(exist_canvas[0]);
      }
    }
  
    /* create canvas element */
    var canvas_el = document.createElement('canvas');
    canvas_el.className = pJS_canvas_class;
  
    /* set size canvas */
    canvas_el.style.width = "100%";
    canvas_el.style.height = "100%";
  
    /* append canvas */
    var canvas = document.getElementById(tag_id).appendChild(canvas_el);
  
    /* launch particle.js */
    if(canvas != null){
      pJSDom.push(new pJS(tag_id, params));
    }
  
  };
  
  window.particlesJS.load = function(tag_id, path_config_json, callback){
  
    /* load json config */
    var xhr = new XMLHttpRequest();
    xhr.open('GET', path_config_json);
    xhr.onreadystatechange = function (data) {
      if(xhr.readyState == 4){
        if(xhr.status == 200){
          var params = JSON.parse(data.currentTarget.response);
          window.particlesJS(tag_id, params);
          if(callback) callback();
        }else{
          console.log('Error pJS - XMLHttpRequest status: '+xhr.status);
          console.log('Error pJS - File config not found');
        }
      }
    };
    xhr.send();
  
  };
(function(e){typeof define=="function"&&define.amd?define(["jquery"],e):typeof module=="object"&&module.exports?module.exports=function(t,n){return n===undefined&&(typeof window!="undefined"?n=require("jquery"):n=require("jquery")(t)),e(n),n}:e(jQuery)})(function(e){function A(t,n,i){typeof i=="string"&&(i={className:i}),this.options=E(w,e.isPlainObject(i)?i:{}),this.loadHTML(),this.wrapper=e(h.html),this.options.clickToHide&&this.wrapper.addClass(r+"-hidable"),this.wrapper.data(r,this),this.arrow=this.wrapper.find("."+r+"-arrow"),this.container=this.wrapper.find("."+r+"-container"),this.container.append(this.userContainer),t&&t.length&&(this.elementType=t.attr("type"),this.originalElement=t,this.elem=N(t),this.elem.data(r,this),this.elem.before(this.wrapper)),this.container.hide(),this.run(n)}var t=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},n="notify",r=n+"js",i=n+"!blank",s={t:"top",m:"middle",b:"bottom",l:"left",c:"center",r:"right"},o=["l","c","r"],u=["t","m","b"],a=["t","b","l","r"],f={t:"b",m:null,b:"t",l:"r",c:null,r:"l"},l=function(t){var n;return n=[],e.each(t.split(/\W+/),function(e,t){var r;r=t.toLowerCase().charAt(0);if(s[r])return n.push(r)}),n},c={},h={name:"core",html:'<div class="'+r+'-wrapper">\n	<div class="'+r+'-arrow"></div>\n	<div class="'+r+'-container"></div>\n</div>',css:"."+r+"-corner {\n	position: fixed;\n	margin: 5px;\n	z-index: 1050;\n}\n\n."+r+"-corner ."+r+"-wrapper,\n."+r+"-corner ."+r+"-container {\n	position: relative;\n	display: block;\n	height: inherit;\n	width: inherit;\n	margin: 3px;\n}\n\n."+r+"-wrapper {\n	z-index: 1;\n	position: absolute;\n	display: inline-block;\n	height: 0;\n	width: 0;\n}\n\n."+r+"-container {\n	display: none;\n	z-index: 1;\n	position: absolute;\n}\n\n."+r+"-hidable {\n	cursor: pointer;\n}\n\n[data-notify-text],[data-notify-html] {\n	position: relative;\n}\n\n."+r+"-arrow {\n	position: absolute;\n	z-index: 2;\n	width: 0;\n	height: 0;\n}"},p={"border-radius":["-webkit-","-moz-"]},d=function(e){return c[e]},v=function(e){if(!e)throw"Missing Style name";c[e]&&delete c[e]},m=function(t,i){if(!t)throw"Missing Style name";if(!i)throw"Missing Style definition";if(!i.html)throw"Missing Style HTML";var s=c[t];s&&s.cssElem&&(window.console&&console.warn(n+": overwriting style '"+t+"'"),c[t].cssElem.remove()),i.name=t,c[t]=i;var o="";i.classes&&e.each(i.classes,function(t,n){return o+="."+r+"-"+i.name+"-"+t+" {\n",e.each(n,function(t,n){return p[t]&&e.each(p[t],function(e,r){return o+="	"+r+t+": "+n+";\n"}),o+="	"+t+": "+n+";\n"}),o+="}\n"}),i.css&&(o+="/* styles for "+i.name+" */\n"+i.css),o&&(i.cssElem=g(o),i.cssElem.attr("id","notify-"+i.name));var u={},a=e(i.html);y("html",a,u),y("text",a,u),i.fields=u},g=function(t){var n,r,i;r=x("style"),r.attr("type","text/css"),e("head").append(r);try{r.html(t)}catch(s){r[0].styleSheet.cssText=t}return r},y=function(t,n,r){var s;return t!=="html"&&(t="text"),s="data-notify-"+t,b(n,"["+s+"]").each(function(){var n;n=e(this).attr(s),n||(n=i),r[n]=t})},b=function(e,t){return e.is(t)?e:e.find(t)},w={clickToHide:!0,autoHide:!0,autoHideDelay:5e3,arrowShow:!0,arrowSize:5,breakNewLines:!0,elementPosition:"bottom",globalPosition:"top right",style:"bootstrap",className:"error",showAnimation:"slideDown",showDuration:400,hideAnimation:"slideUp",hideDuration:200,gap:5},E=function(t,n){var r;return r=function(){},r.prototype=t,e.extend(!0,new r,n)},S=function(t){return e.extend(w,t)},x=function(t){return e("<"+t+"></"+t+">")},T={},N=function(t){var n;return t.is("[type=radio]")&&(n=t.parents("form:first").find("[type=radio]").filter(function(n,r){return e(r).attr("name")===t.attr("name")}),t=n.first()),t},C=function(e,t,n){var r,i;if(typeof n=="string")n=parseInt(n,10);else if(typeof n!="number")return;if(isNaN(n))return;return r=s[f[t.charAt(0)]],i=t,e[r]!==undefined&&(t=s[r.charAt(0)],n=-n),e[t]===undefined?e[t]=n:e[t]+=n,null},k=function(e,t,n){if(e==="l"||e==="t")return 0;if(e==="c"||e==="m")return n/2-t/2;if(e==="r"||e==="b")return n-t;throw"Invalid alignment"},L=function(e){return L.e=L.e||x("div"),L.e.text(e).html()};A.prototype.loadHTML=function(){var t;t=this.getStyle(),this.userContainer=e(t.html),this.userFields=t.fields},A.prototype.show=function(e,t){var n,r,i,s,o;r=function(n){return function(){!e&&!n.elem&&n.destroy();if(t)return t()}}(this),o=this.container.parent().parents(":hidden").length>0,i=this.container.add(this.arrow),n=[];if(o&&e)s="show";else if(o&&!e)s="hide";else if(!o&&e)s=this.options.showAnimation,n.push(this.options.showDuration);else{if(!!o||!!e)return r();s=this.options.hideAnimation,n.push(this.options.hideDuration)}return n.push(r),i[s].apply(i,n)},A.prototype.setGlobalPosition=function(){var t=this.getPosition(),n=t[0],i=t[1],o=s[n],u=s[i],a=n+"|"+i,f=T[a];if(!f||!document.body.contains(f[0])){f=T[a]=x("div");var l={};l[o]=0,u==="middle"?l.top="45%":u==="center"?l.left="45%":l[u]=0,f.css(l).addClass(r+"-corner"),e("body").append(f)}return f.prepend(this.wrapper)},A.prototype.setElementPosition=function(){var n,r,i,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,L,A,O,M,_,D,P,H,B,j;H=this.getPosition(),_=H[0],O=H[1],M=H[2],g=this.elem.position(),d=this.elem.outerHeight(),y=this.elem.outerWidth(),v=this.elem.innerHeight(),m=this.elem.innerWidth(),j=this.wrapper.position(),c=this.container.height(),h=this.container.width(),T=s[_],L=f[_],A=s[L],p={},p[A]=_==="b"?d:_==="r"?y:0,C(p,"top",g.top-j.top),C(p,"left",g.left-j.left),B=["top","left"];for(w=0,S=B.length;w<S;w++)D=B[w],N=parseInt(this.elem.css("margin-"+D),10),N&&C(p,D,N);b=Math.max(0,this.options.gap-(this.options.arrowShow?i:0)),C(p,A,b);if(!this.options.arrowShow)this.arrow.hide();else{i=this.options.arrowSize,r=e.extend({},p),n=this.userContainer.css("border-color")||this.userContainer.css("border-top-color")||this.userContainer.css("background-color")||"white";for(E=0,x=a.length;E<x;E++){D=a[E],P=s[D];if(D===L)continue;l=P===T?n:"transparent",r["border-"+P]=i+"px solid "+l}C(p,s[L],i),t.call(a,O)>=0&&C(r,s[O],i*2)}t.call(u,_)>=0?(C(p,"left",k(O,h,y)),r&&C(r,"left",k(O,i,m))):t.call(o,_)>=0&&(C(p,"top",k(O,c,d)),r&&C(r,"top",k(O,i,v))),this.container.is(":visible")&&(p.display="block"),this.container.removeAttr("style").css(p);if(r)return this.arrow.removeAttr("style").css(r)},A.prototype.getPosition=function(){var e,n,r,i,s,f,c,h;h=this.options.position||(this.elem?this.options.elementPosition:this.options.globalPosition),e=l(h),e.length===0&&(e[0]="b");if(n=e[0],t.call(a,n)<0)throw"Must be one of ["+a+"]";if(e.length===1||(r=e[0],t.call(u,r)>=0)&&(i=e[1],t.call(o,i)<0)||(s=e[0],t.call(o,s)>=0)&&(f=e[1],t.call(u,f)<0))e[1]=(c=e[0],t.call(o,c)>=0)?"m":"l";return e.length===2&&(e[2]=e[1]),e},A.prototype.getStyle=function(e){var t;e||(e=this.options.style),e||(e="default"),t=c[e];if(!t)throw"Missing style: "+e;return t},A.prototype.updateClasses=function(){var t,n;return t=["base"],e.isArray(this.options.className)?t=t.concat(this.options.className):this.options.className&&t.push(this.options.className),n=this.getStyle(),t=e.map(t,function(e){return r+"-"+n.name+"-"+e}).join(" "),this.userContainer.attr("class",t)},A.prototype.run=function(t,n){var r,s,o,u,a;e.isPlainObject(n)?e.extend(this.options,n):e.type(n)==="string"&&(this.options.className=n);if(this.container&&!t){this.show(!1);return}if(!this.container&&!t)return;s={},e.isPlainObject(t)?s=t:s[i]=t;for(o in s){r=s[o],u=this.userFields[o];if(!u)continue;u==="text"&&(r=L(r),this.options.breakNewLines&&(r=r.replace(/\n/g,"<br/>"))),a=o===i?"":"="+o,b(this.userContainer,"[data-notify-"+u+a+"]").html(r)}this.updateClasses(),this.elem?this.setElementPosition():this.setGlobalPosition(),this.show(!0),this.options.autoHide&&(clearTimeout(this.autohideTimer),this.autohideTimer=setTimeout(this.show.bind(this,!1),this.options.autoHideDelay))},A.prototype.destroy=function(){this.wrapper.data(r,null),this.wrapper.remove()},e[n]=function(t,r,i){return t&&t.nodeName||t.jquery?e(t)[n](r,i):(i=r,r=t,new A(null,r,i)),t},e.fn[n]=function(t,n){return e(this).each(function(){var i=N(e(this)).data(r);i&&i.destroy();var s=new A(e(this),t,n)}),this},e.extend(e[n],{defaults:S,addStyle:m,removeStyle:v,pluginOptions:w,getStyle:d,insertCSS:g}),m("bootstrap",{html:"<div>\n<span data-notify-text=''></span>\n</div>",classes:{base:{"font-weight":"bold",padding:"8px 15px 8px 14px","text-shadow":"0 1px 0 rgba(255, 255, 255, 0.5)","background-color":"#fcf8e3",border:"1px solid #fbeed5","border-radius":"4px","white-space":"nowrap","padding-left":"25px","background-repeat":"no-repeat","background-position":"3px 7px"},error:{color:"#B94A48","background-color":"#F2DEDE","border-color":"#EED3D7","background-image":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAtRJREFUeNqkVc1u00AQHq+dOD+0poIQfkIjalW0SEGqRMuRnHos3DjwAH0ArlyQeANOOSMeAA5VjyBxKBQhgSpVUKKQNGloFdw4cWw2jtfMOna6JOUArDTazXi/b3dm55socPqQhFka++aHBsI8GsopRJERNFlY88FCEk9Yiwf8RhgRyaHFQpPHCDmZG5oX2ui2yilkcTT1AcDsbYC1NMAyOi7zTX2Agx7A9luAl88BauiiQ/cJaZQfIpAlngDcvZZMrl8vFPK5+XktrWlx3/ehZ5r9+t6e+WVnp1pxnNIjgBe4/6dAysQc8dsmHwPcW9C0h3fW1hans1ltwJhy0GxK7XZbUlMp5Ww2eyan6+ft/f2FAqXGK4CvQk5HueFz7D6GOZtIrK+srupdx1GRBBqNBtzc2AiMr7nPplRdKhb1q6q6zjFhrklEFOUutoQ50xcX86ZlqaZpQrfbBdu2R6/G19zX6XSgh6RX5ubyHCM8nqSID6ICrGiZjGYYxojEsiw4PDwMSL5VKsC8Yf4VRYFzMzMaxwjlJSlCyAQ9l0CW44PBADzXhe7xMdi9HtTrdYjFYkDQL0cn4Xdq2/EAE+InCnvADTf2eah4Sx9vExQjkqXT6aAERICMewd/UAp/IeYANM2joxt+q5VI+ieq2i0Wg3l6DNzHwTERPgo1ko7XBXj3vdlsT2F+UuhIhYkp7u7CarkcrFOCtR3H5JiwbAIeImjT/YQKKBtGjRFCU5IUgFRe7fF4cCNVIPMYo3VKqxwjyNAXNepuopyqnld602qVsfRpEkkz+GFL1wPj6ySXBpJtWVa5xlhpcyhBNwpZHmtX8AGgfIExo0ZpzkWVTBGiXCSEaHh62/PoR0p/vHaczxXGnj4bSo+G78lELU80h1uogBwWLf5YlsPmgDEd4M236xjm+8nm4IuE/9u+/PH2JXZfbwz4zw1WbO+SQPpXfwG/BBgAhCNZiSb/pOQAAAAASUVORK5CYII=)"},success:{color:"#468847","background-color":"#DFF0D8","border-color":"#D6E9C6","background-image":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAutJREFUeNq0lctPE0Ecx38zu/RFS1EryqtgJFA08YCiMZIAQQ4eRG8eDGdPJiYeTIwHTfwPiAcvXIwXLwoXPaDxkWgQ6islKlJLSQWLUraPLTv7Gme32zoF9KSTfLO7v53vZ3d/M7/fIth+IO6INt2jjoA7bjHCJoAlzCRw59YwHYjBnfMPqAKWQYKjGkfCJqAF0xwZjipQtA3MxeSG87VhOOYegVrUCy7UZM9S6TLIdAamySTclZdYhFhRHloGYg7mgZv1Zzztvgud7V1tbQ2twYA34LJmF4p5dXF1KTufnE+SxeJtuCZNsLDCQU0+RyKTF27Unw101l8e6hns3u0PBalORVVVkcaEKBJDgV3+cGM4tKKmI+ohlIGnygKX00rSBfszz/n2uXv81wd6+rt1orsZCHRdr1Imk2F2Kob3hutSxW8thsd8AXNaln9D7CTfA6O+0UgkMuwVvEFFUbbAcrkcTA8+AtOk8E6KiQiDmMFSDqZItAzEVQviRkdDdaFgPp8HSZKAEAL5Qh7Sq2lIJBJwv2scUqkUnKoZgNhcDKhKg5aH+1IkcouCAdFGAQsuWZYhOjwFHQ96oagWgRoUov1T9kRBEODAwxM2QtEUl+Wp+Ln9VRo6BcMw4ErHRYjH4/B26AlQoQQTRdHWwcd9AH57+UAXddvDD37DmrBBV34WfqiXPl61g+vr6xA9zsGeM9gOdsNXkgpEtTwVvwOklXLKm6+/p5ezwk4B+j6droBs2CsGa/gNs6RIxazl4Tc25mpTgw/apPR1LYlNRFAzgsOxkyXYLIM1V8NMwyAkJSctD1eGVKiq5wWjSPdjmeTkiKvVW4f2YPHWl3GAVq6ymcyCTgovM3FzyRiDe2TaKcEKsLpJvNHjZgPNqEtyi6mZIm4SRFyLMUsONSSdkPeFtY1n0mczoY3BHTLhwPRy9/lzcziCw9ACI+yql0VLzcGAZbYSM5CCSZg1/9oc/nn7+i8N9p/8An4JMADxhH+xHfuiKwAAAABJRU5ErkJggg==)"},info:{color:"#3A87AD","background-color":"#D9EDF7","border-color":"#BCE8F1","background-image":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3QYFAhkSsdes/QAAA8dJREFUOMvVlGtMW2UYx//POaWHXg6lLaW0ypAtw1UCgbniNOLcVOLmAjHZolOYlxmTGXVZdAnRfXQm+7SoU4mXaOaiZsEpC9FkiQs6Z6bdCnNYruM6KNBw6YWewzl9z+sHImEWv+vz7XmT95f/+3/+7wP814v+efDOV3/SoX3lHAA+6ODeUFfMfjOWMADgdk+eEKz0pF7aQdMAcOKLLjrcVMVX3xdWN29/GhYP7SvnP0cWfS8caSkfHZsPE9Fgnt02JNutQ0QYHB2dDz9/pKX8QjjuO9xUxd/66HdxTeCHZ3rojQObGQBcuNjfplkD3b19Y/6MrimSaKgSMmpGU5WevmE/swa6Oy73tQHA0Rdr2Mmv/6A1n9w9suQ7097Z9lM4FlTgTDrzZTu4StXVfpiI48rVcUDM5cmEksrFnHxfpTtU/3BFQzCQF/2bYVoNbH7zmItbSoMj40JSzmMyX5qDvriA7QdrIIpA+3cdsMpu0nXI8cV0MtKXCPZev+gCEM1S2NHPvWfP/hL+7FSr3+0p5RBEyhEN5JCKYr8XnASMT0xBNyzQGQeI8fjsGD39RMPk7se2bd5ZtTyoFYXftF6y37gx7NeUtJJOTFlAHDZLDuILU3j3+H5oOrD3yWbIztugaAzgnBKJuBLpGfQrS8wO4FZgV+c1IxaLgWVU0tMLEETCos4xMzEIv9cJXQcyagIwigDGwJgOAtHAwAhisQUjy0ORGERiELgG4iakkzo4MYAxcM5hAMi1WWG1yYCJIcMUaBkVRLdGeSU2995TLWzcUAzONJ7J6FBVBYIggMzmFbvdBV44Corg8vjhzC+EJEl8U1kJtgYrhCzgc/vvTwXKSib1paRFVRVORDAJAsw5FuTaJEhWM2SHB3mOAlhkNxwuLzeJsGwqWzf5TFNdKgtY5qHp6ZFf67Y/sAVadCaVY5YACDDb3Oi4NIjLnWMw2QthCBIsVhsUTU9tvXsjeq9+X1d75/KEs4LNOfcdf/+HthMnvwxOD0wmHaXr7ZItn2wuH2SnBzbZAbPJwpPx+VQuzcm7dgRCB57a1uBzUDRL4bfnI0RE0eaXd9W89mpjqHZnUI5Hh2l2dkZZUhOqpi2qSmpOmZ64Tuu9qlz/SEXo6MEHa3wOip46F1n7633eekV8ds8Wxjn37Wl63VVa+ej5oeEZ/82ZBETJjpJ1Rbij2D3Z/1trXUvLsblCK0XfOx0SX2kMsn9dX+d+7Kf6h8o4AIykuffjT8L20LU+w4AZd5VvEPY+XpWqLV327HR7DzXuDnD8r+ovkBehJ8i+y8YAAAAASUVORK5CYII=)"},warn:{color:"#C09853","background-color":"#FCF8E3","border-color":"#FBEED5","background-image":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAMAAAC6V+0/AAABJlBMVEXr6eb/2oD/wi7/xjr/0mP/ykf/tQD/vBj/3o7/uQ//vyL/twebhgD/4pzX1K3z8e349vK6tHCilCWbiQymn0jGworr6dXQza3HxcKkn1vWvV/5uRfk4dXZ1bD18+/52YebiAmyr5S9mhCzrWq5t6ufjRH54aLs0oS+qD751XqPhAybhwXsujG3sm+Zk0PTwG6Shg+PhhObhwOPgQL4zV2nlyrf27uLfgCPhRHu7OmLgAafkyiWkD3l49ibiAfTs0C+lgCniwD4sgDJxqOilzDWowWFfAH08uebig6qpFHBvH/aw26FfQTQzsvy8OyEfz20r3jAvaKbhgG9q0nc2LbZxXanoUu/u5WSggCtp1anpJKdmFz/zlX/1nGJiYmuq5Dx7+sAAADoPUZSAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfdBgUBGhh4aah5AAAAlklEQVQY02NgoBIIE8EUcwn1FkIXM1Tj5dDUQhPU502Mi7XXQxGz5uVIjGOJUUUW81HnYEyMi2HVcUOICQZzMMYmxrEyMylJwgUt5BljWRLjmJm4pI1hYp5SQLGYxDgmLnZOVxuooClIDKgXKMbN5ggV1ACLJcaBxNgcoiGCBiZwdWxOETBDrTyEFey0jYJ4eHjMGWgEAIpRFRCUt08qAAAAAElFTkSuQmCC)"}}}),e(function(){g(h.css).attr("id","core-notify"),e(document).on("click","."+r+"-hidable",function(t){e(this).trigger("notify-hide")}),e(document).on("notify-hide","."+r+"-wrapper",function(t){var n=e(this).data(r);n&&n.show(!1)})})})
/*! Select2 4.0.10 | https://github.com/select2/select2/blob/master/LICENSE.md */
!function(n){"function"==typeof define&&define.amd?define(["jquery"],n):"object"==typeof module&&module.exports?module.exports=function(e,t){return void 0===t&&(t="undefined"!=typeof window?require("jquery"):require("jquery")(e)),n(t),t}:n(jQuery)}(function(d){var e=function(){if(d&&d.fn&&d.fn.select2&&d.fn.select2.amd)var e=d.fn.select2.amd;var t,n,i,h,o,s,f,g,m,v,y,_,r,a,w,l;function b(e,t){return r.call(e,t)}function c(e,t){var n,i,r,o,s,a,l,c,u,d,p,h=t&&t.split("/"),f=y.map,g=f&&f["*"]||{};if(e){for(s=(e=e.split("/")).length-1,y.nodeIdCompat&&w.test(e[s])&&(e[s]=e[s].replace(w,"")),"."===e[0].charAt(0)&&h&&(e=h.slice(0,h.length-1).concat(e)),u=0;u<e.length;u++)if("."===(p=e[u]))e.splice(u,1),u-=1;else if(".."===p){if(0===u||1===u&&".."===e[2]||".."===e[u-1])continue;0<u&&(e.splice(u-1,2),u-=2)}e=e.join("/")}if((h||g)&&f){for(u=(n=e.split("/")).length;0<u;u-=1){if(i=n.slice(0,u).join("/"),h)for(d=h.length;0<d;d-=1)if(r=(r=f[h.slice(0,d).join("/")])&&r[i]){o=r,a=u;break}if(o)break;!l&&g&&g[i]&&(l=g[i],c=u)}!o&&l&&(o=l,a=c),o&&(n.splice(0,a,o),e=n.join("/"))}return e}function A(t,n){return function(){var e=a.call(arguments,0);return"string"!=typeof e[0]&&1===e.length&&e.push(null),s.apply(h,e.concat([t,n]))}}function x(t){return function(e){m[t]=e}}function S(e){if(b(v,e)){var t=v[e];delete v[e],_[e]=!0,o.apply(h,t)}if(!b(m,e)&&!b(_,e))throw new Error("No "+e);return m[e]}function u(e){var t,n=e?e.indexOf("!"):-1;return-1<n&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function D(e){return e?u(e):[]}return e&&e.requirejs||(e?n=e:e={},m={},v={},y={},_={},r=Object.prototype.hasOwnProperty,a=[].slice,w=/\.js$/,f=function(e,t){var n,i=u(e),r=i[0],o=t[1];return e=i[1],r&&(n=S(r=c(r,o))),r?e=n&&n.normalize?n.normalize(e,function(t){return function(e){return c(e,t)}}(o)):c(e,o):(r=(i=u(e=c(e,o)))[0],e=i[1],r&&(n=S(r))),{f:r?r+"!"+e:e,n:e,pr:r,p:n}},g={require:function(e){return A(e)},exports:function(e){var t=m[e];return void 0!==t?t:m[e]={}},module:function(e){return{id:e,uri:"",exports:m[e],config:function(e){return function(){return y&&y.config&&y.config[e]||{}}}(e)}}},o=function(e,t,n,i){var r,o,s,a,l,c,u,d=[],p=typeof n;if(c=D(i=i||e),"undefined"==p||"function"==p){for(t=!t.length&&n.length?["require","exports","module"]:t,l=0;l<t.length;l+=1)if("require"===(o=(a=f(t[l],c)).f))d[l]=g.require(e);else if("exports"===o)d[l]=g.exports(e),u=!0;else if("module"===o)r=d[l]=g.module(e);else if(b(m,o)||b(v,o)||b(_,o))d[l]=S(o);else{if(!a.p)throw new Error(e+" missing "+o);a.p.load(a.n,A(i,!0),x(o),{}),d[l]=m[o]}s=n?n.apply(m[e],d):void 0,e&&(r&&r.exports!==h&&r.exports!==m[e]?m[e]=r.exports:s===h&&u||(m[e]=s))}else e&&(m[e]=n)},t=n=s=function(e,t,n,i,r){if("string"==typeof e)return g[e]?g[e](t):S(f(e,D(t)).f);if(!e.splice){if((y=e).deps&&s(y.deps,y.callback),!t)return;t.splice?(e=t,t=n,n=null):e=h}return t=t||function(){},"function"==typeof n&&(n=i,i=r),i?o(h,e,t,n):setTimeout(function(){o(h,e,t,n)},4),s},s.config=function(e){return s(e)},t._defined=m,(i=function(e,t,n){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),b(m,e)||b(v,e)||(v[e]=[e,t,n])}).amd={jQuery:!0},e.requirejs=t,e.require=n,e.define=i),e.define("almond",function(){}),e.define("jquery",[],function(){var e=d||$;return null==e&&console&&console.error&&console.error("Select2: An instance of jQuery or a jQuery-compatible library was not found. Make sure that you are including jQuery before Select2 on your web page."),e}),e.define("select2/utils",["jquery"],function(o){var r={};function u(e){var t=e.prototype,n=[];for(var i in t){"function"==typeof t[i]&&"constructor"!==i&&n.push(i)}return n}r.Extend=function(e,t){var n={}.hasOwnProperty;function i(){this.constructor=e}for(var r in t)n.call(t,r)&&(e[r]=t[r]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},r.Decorate=function(i,r){var e=u(r),t=u(i);function o(){var e=Array.prototype.unshift,t=r.prototype.constructor.length,n=i.prototype.constructor;0<t&&(e.call(arguments,i.prototype.constructor),n=r.prototype.constructor),n.apply(this,arguments)}r.displayName=i.displayName,o.prototype=new function(){this.constructor=o};for(var n=0;n<t.length;n++){var s=t[n];o.prototype[s]=i.prototype[s]}function a(e){var t=function(){};e in o.prototype&&(t=o.prototype[e]);var n=r.prototype[e];return function(){return Array.prototype.unshift.call(arguments,t),n.apply(this,arguments)}}for(var l=0;l<e.length;l++){var c=e[l];o.prototype[c]=a(c)}return o};function e(){this.listeners={}}e.prototype.on=function(e,t){this.listeners=this.listeners||{},e in this.listeners?this.listeners[e].push(t):this.listeners[e]=[t]},e.prototype.trigger=function(e){var t=Array.prototype.slice,n=t.call(arguments,1);this.listeners=this.listeners||{},null==n&&(n=[]),0===n.length&&n.push({}),(n[0]._type=e)in this.listeners&&this.invoke(this.listeners[e],t.call(arguments,1)),"*"in this.listeners&&this.invoke(this.listeners["*"],arguments)},e.prototype.invoke=function(e,t){for(var n=0,i=e.length;n<i;n++)e[n].apply(this,t)},r.Observable=e,r.generateChars=function(e){for(var t="",n=0;n<e;n++){t+=Math.floor(36*Math.random()).toString(36)}return t},r.bind=function(e,t){return function(){e.apply(t,arguments)}},r._convertData=function(e){for(var t in e){var n=t.split("-"),i=e;if(1!==n.length){for(var r=0;r<n.length;r++){var o=n[r];(o=o.substring(0,1).toLowerCase()+o.substring(1))in i||(i[o]={}),r==n.length-1&&(i[o]=e[t]),i=i[o]}delete e[t]}}return e},r.hasScroll=function(e,t){var n=o(t),i=t.style.overflowX,r=t.style.overflowY;return(i!==r||"hidden"!==r&&"visible"!==r)&&("scroll"===i||"scroll"===r||(n.innerHeight()<t.scrollHeight||n.innerWidth()<t.scrollWidth))},r.escapeMarkup=function(e){var t={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#47;"};return"string"!=typeof e?e:String(e).replace(/[&<>"'\/\\]/g,function(e){return t[e]})},r.appendMany=function(e,t){if("1.7"===o.fn.jquery.substr(0,3)){var n=o();o.map(t,function(e){n=n.add(e)}),t=n}e.append(t)},r.__cache={};var n=0;return r.GetUniqueElementId=function(e){var t=e.getAttribute("data-select2-id");return null==t&&(e.id?(t=e.id,e.setAttribute("data-select2-id",t)):(e.setAttribute("data-select2-id",++n),t=n.toString())),t},r.StoreData=function(e,t,n){var i=r.GetUniqueElementId(e);r.__cache[i]||(r.__cache[i]={}),r.__cache[i][t]=n},r.GetData=function(e,t){var n=r.GetUniqueElementId(e);return t?r.__cache[n]&&null!=r.__cache[n][t]?r.__cache[n][t]:o(e).data(t):r.__cache[n]},r.RemoveData=function(e){var t=r.GetUniqueElementId(e);null!=r.__cache[t]&&delete r.__cache[t],e.removeAttribute("data-select2-id")},r}),e.define("select2/results",["jquery","./utils"],function(h,f){function i(e,t,n){this.$element=e,this.data=n,this.options=t,i.__super__.constructor.call(this)}return f.Extend(i,f.Observable),i.prototype.render=function(){var e=h('<ul class="select2-results__options" role="listbox"></ul>');return this.options.get("multiple")&&e.attr("aria-multiselectable","true"),this.$results=e},i.prototype.clear=function(){this.$results.empty()},i.prototype.displayMessage=function(e){var t=this.options.get("escapeMarkup");this.clear(),this.hideLoading();var n=h('<li role="alert" aria-live="assertive" class="select2-results__option"></li>'),i=this.options.get("translations").get(e.message);n.append(t(i(e.args))),n[0].className+=" select2-results__message",this.$results.append(n)},i.prototype.hideMessages=function(){this.$results.find(".select2-results__message").remove()},i.prototype.append=function(e){this.hideLoading();var t=[];if(null!=e.results&&0!==e.results.length){e.results=this.sort(e.results);for(var n=0;n<e.results.length;n++){var i=e.results[n],r=this.option(i);t.push(r)}this.$results.append(t)}else 0===this.$results.children().length&&this.trigger("results:message",{message:"noResults"})},i.prototype.position=function(e,t){t.find(".select2-results").append(e)},i.prototype.sort=function(e){return this.options.get("sorter")(e)},i.prototype.highlightFirstItem=function(){var e=this.$results.find(".select2-results__option[aria-selected]"),t=e.filter("[aria-selected=true]");0<t.length?t.first().trigger("mouseenter"):e.first().trigger("mouseenter"),this.ensureHighlightVisible()},i.prototype.setClasses=function(){var t=this;this.data.current(function(e){var i=h.map(e,function(e){return e.id.toString()});t.$results.find(".select2-results__option[aria-selected]").each(function(){var e=h(this),t=f.GetData(this,"data"),n=""+t.id;null!=t.element&&t.element.selected||null==t.element&&-1<h.inArray(n,i)?e.attr("aria-selected","true"):e.attr("aria-selected","false")})})},i.prototype.showLoading=function(e){this.hideLoading();var t={disabled:!0,loading:!0,text:this.options.get("translations").get("searching")(e)},n=this.option(t);n.className+=" loading-results",this.$results.prepend(n)},i.prototype.hideLoading=function(){this.$results.find(".loading-results").remove()},i.prototype.option=function(e){var t=document.createElement("li");t.className="select2-results__option";var n={role:"option","aria-selected":"false"},i=window.Element.prototype.matches||window.Element.prototype.msMatchesSelector||window.Element.prototype.webkitMatchesSelector;for(var r in(null!=e.element&&i.call(e.element,":disabled")||null==e.element&&e.disabled)&&(delete n["aria-selected"],n["aria-disabled"]="true"),null==e.id&&delete n["aria-selected"],null!=e._resultId&&(t.id=e._resultId),e.title&&(t.title=e.title),e.children&&(n.role="group",n["aria-label"]=e.text,delete n["aria-selected"]),n){var o=n[r];t.setAttribute(r,o)}if(e.children){var s=h(t),a=document.createElement("strong");a.className="select2-results__group";h(a);this.template(e,a);for(var l=[],c=0;c<e.children.length;c++){var u=e.children[c],d=this.option(u);l.push(d)}var p=h("<ul></ul>",{class:"select2-results__options select2-results__options--nested"});p.append(l),s.append(a),s.append(p)}else this.template(e,t);return f.StoreData(t,"data",e),t},i.prototype.bind=function(t,e){var l=this,n=t.id+"-results";this.$results.attr("id",n),t.on("results:all",function(e){l.clear(),l.append(e.data),t.isOpen()&&(l.setClasses(),l.highlightFirstItem())}),t.on("results:append",function(e){l.append(e.data),t.isOpen()&&l.setClasses()}),t.on("query",function(e){l.hideMessages(),l.showLoading(e)}),t.on("select",function(){t.isOpen()&&(l.setClasses(),l.options.get("scrollAfterSelect")&&l.highlightFirstItem())}),t.on("unselect",function(){t.isOpen()&&(l.setClasses(),l.options.get("scrollAfterSelect")&&l.highlightFirstItem())}),t.on("open",function(){l.$results.attr("aria-expanded","true"),l.$results.attr("aria-hidden","false"),l.setClasses(),l.ensureHighlightVisible()}),t.on("close",function(){l.$results.attr("aria-expanded","false"),l.$results.attr("aria-hidden","true"),l.$results.removeAttr("aria-activedescendant")}),t.on("results:toggle",function(){var e=l.getHighlightedResults();0!==e.length&&e.trigger("mouseup")}),t.on("results:select",function(){var e=l.getHighlightedResults();if(0!==e.length){var t=f.GetData(e[0],"data");"true"==e.attr("aria-selected")?l.trigger("close",{}):l.trigger("select",{data:t})}}),t.on("results:previous",function(){var e=l.getHighlightedResults(),t=l.$results.find("[aria-selected]"),n=t.index(e);if(!(n<=0)){var i=n-1;0===e.length&&(i=0);var r=t.eq(i);r.trigger("mouseenter");var o=l.$results.offset().top,s=r.offset().top,a=l.$results.scrollTop()+(s-o);0===i?l.$results.scrollTop(0):s-o<0&&l.$results.scrollTop(a)}}),t.on("results:next",function(){var e=l.getHighlightedResults(),t=l.$results.find("[aria-selected]"),n=t.index(e)+1;if(!(n>=t.length)){var i=t.eq(n);i.trigger("mouseenter");var r=l.$results.offset().top+l.$results.outerHeight(!1),o=i.offset().top+i.outerHeight(!1),s=l.$results.scrollTop()+o-r;0===n?l.$results.scrollTop(0):r<o&&l.$results.scrollTop(s)}}),t.on("results:focus",function(e){e.element.addClass("select2-results__option--highlighted")}),t.on("results:message",function(e){l.displayMessage(e)}),h.fn.mousewheel&&this.$results.on("mousewheel",function(e){var t=l.$results.scrollTop(),n=l.$results.get(0).scrollHeight-t+e.deltaY,i=0<e.deltaY&&t-e.deltaY<=0,r=e.deltaY<0&&n<=l.$results.height();i?(l.$results.scrollTop(0),e.preventDefault(),e.stopPropagation()):r&&(l.$results.scrollTop(l.$results.get(0).scrollHeight-l.$results.height()),e.preventDefault(),e.stopPropagation())}),this.$results.on("mouseup",".select2-results__option[aria-selected]",function(e){var t=h(this),n=f.GetData(this,"data");"true"!==t.attr("aria-selected")?l.trigger("select",{originalEvent:e,data:n}):l.options.get("multiple")?l.trigger("unselect",{originalEvent:e,data:n}):l.trigger("close",{})}),this.$results.on("mouseenter",".select2-results__option[aria-selected]",function(e){var t=f.GetData(this,"data");l.getHighlightedResults().removeClass("select2-results__option--highlighted"),l.trigger("results:focus",{data:t,element:h(this)})})},i.prototype.getHighlightedResults=function(){return this.$results.find(".select2-results__option--highlighted")},i.prototype.destroy=function(){this.$results.remove()},i.prototype.ensureHighlightVisible=function(){var e=this.getHighlightedResults();if(0!==e.length){var t=this.$results.find("[aria-selected]").index(e),n=this.$results.offset().top,i=e.offset().top,r=this.$results.scrollTop()+(i-n),o=i-n;r-=2*e.outerHeight(!1),t<=2?this.$results.scrollTop(0):(o>this.$results.outerHeight()||o<0)&&this.$results.scrollTop(r)}},i.prototype.template=function(e,t){var n=this.options.get("templateResult"),i=this.options.get("escapeMarkup"),r=n(e,t);null==r?t.style.display="none":"string"==typeof r?t.innerHTML=i(r):h(t).append(r)},i}),e.define("select2/keys",[],function(){return{BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46}}),e.define("select2/selection/base",["jquery","../utils","../keys"],function(n,i,r){function o(e,t){this.$element=e,this.options=t,o.__super__.constructor.call(this)}return i.Extend(o,i.Observable),o.prototype.render=function(){var e=n('<span class="select2-selection" role="combobox"  aria-haspopup="true" aria-expanded="false"></span>');return this._tabindex=0,null!=i.GetData(this.$element[0],"old-tabindex")?this._tabindex=i.GetData(this.$element[0],"old-tabindex"):null!=this.$element.attr("tabindex")&&(this._tabindex=this.$element.attr("tabindex")),e.attr("title",this.$element.attr("title")),e.attr("tabindex",this._tabindex),e.attr("aria-disabled","false"),this.$selection=e},o.prototype.bind=function(e,t){var n=this,i=e.id+"-results";this.container=e,this.$selection.on("focus",function(e){n.trigger("focus",e)}),this.$selection.on("blur",function(e){n._handleBlur(e)}),this.$selection.on("keydown",function(e){n.trigger("keypress",e),e.which===r.SPACE&&e.preventDefault()}),e.on("results:focus",function(e){n.$selection.attr("aria-activedescendant",e.data._resultId)}),e.on("selection:update",function(e){n.update(e.data)}),e.on("open",function(){n.$selection.attr("aria-expanded","true"),n.$selection.attr("aria-owns",i),n._attachCloseHandler(e)}),e.on("close",function(){n.$selection.attr("aria-expanded","false"),n.$selection.removeAttr("aria-activedescendant"),n.$selection.removeAttr("aria-owns"),n.$selection.trigger("focus"),n._detachCloseHandler(e)}),e.on("enable",function(){n.$selection.attr("tabindex",n._tabindex),n.$selection.attr("aria-disabled","false")}),e.on("disable",function(){n.$selection.attr("tabindex","-1"),n.$selection.attr("aria-disabled","true")})},o.prototype._handleBlur=function(e){var t=this;window.setTimeout(function(){document.activeElement==t.$selection[0]||n.contains(t.$selection[0],document.activeElement)||t.trigger("blur",e)},1)},o.prototype._attachCloseHandler=function(e){n(document.body).on("mousedown.select2."+e.id,function(e){var t=n(e.target).closest(".select2");n(".select2.select2-container--open").each(function(){this!=t[0]&&i.GetData(this,"element").select2("close")})})},o.prototype._detachCloseHandler=function(e){n(document.body).off("mousedown.select2."+e.id)},o.prototype.position=function(e,t){t.find(".selection").append(e)},o.prototype.destroy=function(){this._detachCloseHandler(this.container)},o.prototype.update=function(e){throw new Error("The `update` method must be defined in child classes.")},o}),e.define("select2/selection/single",["jquery","./base","../utils","../keys"],function(e,t,n,i){function r(){r.__super__.constructor.apply(this,arguments)}return n.Extend(r,t),r.prototype.render=function(){var e=r.__super__.render.call(this);return e.addClass("select2-selection--single"),e.html('<span class="select2-selection__rendered"></span><span class="select2-selection__arrow" role="presentation"><b role="presentation"></b></span>'),e},r.prototype.bind=function(t,e){var n=this;r.__super__.bind.apply(this,arguments);var i=t.id+"-container";this.$selection.find(".select2-selection__rendered").attr("id",i).attr("role","textbox").attr("aria-readonly","true"),this.$selection.attr("aria-labelledby",i),this.$selection.on("mousedown",function(e){1===e.which&&n.trigger("toggle",{originalEvent:e})}),this.$selection.on("focus",function(e){}),this.$selection.on("blur",function(e){}),t.on("focus",function(e){t.isOpen()||n.$selection.trigger("focus")})},r.prototype.clear=function(){var e=this.$selection.find(".select2-selection__rendered");e.empty(),e.removeAttr("title")},r.prototype.display=function(e,t){var n=this.options.get("templateSelection");return this.options.get("escapeMarkup")(n(e,t))},r.prototype.selectionContainer=function(){return e("<span></span>")},r.prototype.update=function(e){if(0!==e.length){var t=e[0],n=this.$selection.find(".select2-selection__rendered"),i=this.display(t,n);n.empty().append(i);var r=t.title||t.text;r?n.attr("title",r):n.removeAttr("title")}else this.clear()},r}),e.define("select2/selection/multiple",["jquery","./base","../utils"],function(r,e,l){function n(e,t){n.__super__.constructor.apply(this,arguments)}return l.Extend(n,e),n.prototype.render=function(){var e=n.__super__.render.call(this);return e.addClass("select2-selection--multiple"),e.html('<ul class="select2-selection__rendered"></ul>'),e},n.prototype.bind=function(e,t){var i=this;n.__super__.bind.apply(this,arguments),this.$selection.on("click",function(e){i.trigger("toggle",{originalEvent:e})}),this.$selection.on("click",".select2-selection__choice__remove",function(e){if(!i.options.get("disabled")){var t=r(this).parent(),n=l.GetData(t[0],"data");i.trigger("unselect",{originalEvent:e,data:n})}})},n.prototype.clear=function(){var e=this.$selection.find(".select2-selection__rendered");e.empty(),e.removeAttr("title")},n.prototype.display=function(e,t){var n=this.options.get("templateSelection");return this.options.get("escapeMarkup")(n(e,t))},n.prototype.selectionContainer=function(){return r('<li class="select2-selection__choice"><span class="select2-selection__choice__remove" role="presentation">&times;</span></li>')},n.prototype.update=function(e){if(this.clear(),0!==e.length){for(var t=[],n=0;n<e.length;n++){var i=e[n],r=this.selectionContainer(),o=this.display(i,r);r.append(o);var s=i.title||i.text;s&&r.attr("title",s),l.StoreData(r[0],"data",i),t.push(r)}var a=this.$selection.find(".select2-selection__rendered");l.appendMany(a,t)}},n}),e.define("select2/selection/placeholder",["../utils"],function(e){function t(e,t,n){this.placeholder=this.normalizePlaceholder(n.get("placeholder")),e.call(this,t,n)}return t.prototype.normalizePlaceholder=function(e,t){return"string"==typeof t&&(t={id:"",text:t}),t},t.prototype.createPlaceholder=function(e,t){var n=this.selectionContainer();return n.html(this.display(t)),n.addClass("select2-selection__placeholder").removeClass("select2-selection__choice"),n},t.prototype.update=function(e,t){var n=1==t.length&&t[0].id!=this.placeholder.id;if(1<t.length||n)return e.call(this,t);this.clear();var i=this.createPlaceholder(this.placeholder);this.$selection.find(".select2-selection__rendered").append(i)},t}),e.define("select2/selection/allowClear",["jquery","../keys","../utils"],function(r,i,a){function e(){}return e.prototype.bind=function(e,t,n){var i=this;e.call(this,t,n),null==this.placeholder&&this.options.get("debug")&&window.console&&console.error&&console.error("Select2: The `allowClear` option should be used in combination with the `placeholder` option."),this.$selection.on("mousedown",".select2-selection__clear",function(e){i._handleClear(e)}),t.on("keypress",function(e){i._handleKeyboardClear(e,t)})},e.prototype._handleClear=function(e,t){if(!this.options.get("disabled")){var n=this.$selection.find(".select2-selection__clear");if(0!==n.length){t.stopPropagation();var i=a.GetData(n[0],"data"),r=this.$element.val();this.$element.val(this.placeholder.id);var o={data:i};if(this.trigger("clear",o),o.prevented)this.$element.val(r);else{for(var s=0;s<i.length;s++)if(o={data:i[s]},this.trigger("unselect",o),o.prevented)return void this.$element.val(r);this.$element.trigger("change"),this.trigger("toggle",{})}}}},e.prototype._handleKeyboardClear=function(e,t,n){n.isOpen()||t.which!=i.DELETE&&t.which!=i.BACKSPACE||this._handleClear(t)},e.prototype.update=function(e,t){if(e.call(this,t),!(0<this.$selection.find(".select2-selection__placeholder").length||0===t.length)){var n=this.options.get("translations").get("removeAllItems"),i=r('<span class="select2-selection__clear" title="'+n()+'">&times;</span>');a.StoreData(i[0],"data",t),this.$selection.find(".select2-selection__rendered").prepend(i)}},e}),e.define("select2/selection/search",["jquery","../utils","../keys"],function(i,a,l){function e(e,t,n){e.call(this,t,n)}return e.prototype.render=function(e){var t=i('<li class="select2-search select2-search--inline"><input class="select2-search__field" type="search" tabindex="-1" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" role="searchbox" aria-autocomplete="list" /></li>');this.$searchContainer=t,this.$search=t.find("input");var n=e.call(this);return this._transferTabIndex(),n},e.prototype.bind=function(e,t,n){var i=this,r=t.id+"-results";e.call(this,t,n),t.on("open",function(){i.$search.attr("aria-controls",r),i.$search.trigger("focus")}),t.on("close",function(){i.$search.val(""),i.$search.removeAttr("aria-controls"),i.$search.removeAttr("aria-activedescendant"),i.$search.trigger("focus")}),t.on("enable",function(){i.$search.prop("disabled",!1),i._transferTabIndex()}),t.on("disable",function(){i.$search.prop("disabled",!0)}),t.on("focus",function(e){i.$search.trigger("focus")}),t.on("results:focus",function(e){e.data._resultId?i.$search.attr("aria-activedescendant",e.data._resultId):i.$search.removeAttr("aria-activedescendant")}),this.$selection.on("focusin",".select2-search--inline",function(e){i.trigger("focus",e)}),this.$selection.on("focusout",".select2-search--inline",function(e){i._handleBlur(e)}),this.$selection.on("keydown",".select2-search--inline",function(e){if(e.stopPropagation(),i.trigger("keypress",e),i._keyUpPrevented=e.isDefaultPrevented(),e.which===l.BACKSPACE&&""===i.$search.val()){var t=i.$searchContainer.prev(".select2-selection__choice");if(0<t.length){var n=a.GetData(t[0],"data");i.searchRemoveChoice(n),e.preventDefault()}}}),this.$selection.on("click",".select2-search--inline",function(e){i.$search.val()&&e.stopPropagation()});var o=document.documentMode,s=o&&o<=11;this.$selection.on("input.searchcheck",".select2-search--inline",function(e){s?i.$selection.off("input.search input.searchcheck"):i.$selection.off("keyup.search")}),this.$selection.on("keyup.search input.search",".select2-search--inline",function(e){if(s&&"input"===e.type)i.$selection.off("input.search input.searchcheck");else{var t=e.which;t!=l.SHIFT&&t!=l.CTRL&&t!=l.ALT&&t!=l.TAB&&i.handleSearch(e)}})},e.prototype._transferTabIndex=function(e){this.$search.attr("tabindex",this.$selection.attr("tabindex")),this.$selection.attr("tabindex","-1")},e.prototype.createPlaceholder=function(e,t){this.$search.attr("placeholder",t.text)},e.prototype.update=function(e,t){var n=this.$search[0]==document.activeElement;this.$search.attr("placeholder",""),e.call(this,t),this.$selection.find(".select2-selection__rendered").append(this.$searchContainer),this.resizeSearch(),n&&this.$search.trigger("focus")},e.prototype.handleSearch=function(){if(this.resizeSearch(),!this._keyUpPrevented){var e=this.$search.val();this.trigger("query",{term:e})}this._keyUpPrevented=!1},e.prototype.searchRemoveChoice=function(e,t){this.trigger("unselect",{data:t}),this.$search.val(t.text),this.handleSearch()},e.prototype.resizeSearch=function(){this.$search.css("width","25px");var e="";""!==this.$search.attr("placeholder")?e=this.$selection.find(".select2-selection__rendered").width():e=.75*(this.$search.val().length+1)+"em";this.$search.css("width",e)},e}),e.define("select2/selection/eventRelay",["jquery"],function(s){function e(){}return e.prototype.bind=function(e,t,n){var i=this,r=["open","opening","close","closing","select","selecting","unselect","unselecting","clear","clearing"],o=["opening","closing","selecting","unselecting","clearing"];e.call(this,t,n),t.on("*",function(e,t){if(-1!==s.inArray(e,r)){t=t||{};var n=s.Event("select2:"+e,{params:t});i.$element.trigger(n),-1!==s.inArray(e,o)&&(t.prevented=n.isDefaultPrevented())}})},e}),e.define("select2/translation",["jquery","require"],function(t,n){function i(e){this.dict=e||{}}return i.prototype.all=function(){return this.dict},i.prototype.get=function(e){return this.dict[e]},i.prototype.extend=function(e){this.dict=t.extend({},e.all(),this.dict)},i._cache={},i.loadPath=function(e){if(!(e in i._cache)){var t=n(e);i._cache[e]=t}return new i(i._cache[e])},i}),e.define("select2/diacritics",[],function(){return{"Ⓐ":"A","Ａ":"A","À":"A","Á":"A","Â":"A","Ầ":"A","Ấ":"A","Ẫ":"A","Ẩ":"A","Ã":"A","Ā":"A","Ă":"A","Ằ":"A","Ắ":"A","Ẵ":"A","Ẳ":"A","Ȧ":"A","Ǡ":"A","Ä":"A","Ǟ":"A","Ả":"A","Å":"A","Ǻ":"A","Ǎ":"A","Ȁ":"A","Ȃ":"A","Ạ":"A","Ậ":"A","Ặ":"A","Ḁ":"A","Ą":"A","Ⱥ":"A","Ɐ":"A","Ꜳ":"AA","Æ":"AE","Ǽ":"AE","Ǣ":"AE","Ꜵ":"AO","Ꜷ":"AU","Ꜹ":"AV","Ꜻ":"AV","Ꜽ":"AY","Ⓑ":"B","Ｂ":"B","Ḃ":"B","Ḅ":"B","Ḇ":"B","Ƀ":"B","Ƃ":"B","Ɓ":"B","Ⓒ":"C","Ｃ":"C","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","Ç":"C","Ḉ":"C","Ƈ":"C","Ȼ":"C","Ꜿ":"C","Ⓓ":"D","Ｄ":"D","Ḋ":"D","Ď":"D","Ḍ":"D","Ḑ":"D","Ḓ":"D","Ḏ":"D","Đ":"D","Ƌ":"D","Ɗ":"D","Ɖ":"D","Ꝺ":"D","Ǳ":"DZ","Ǆ":"DZ","ǲ":"Dz","ǅ":"Dz","Ⓔ":"E","Ｅ":"E","È":"E","É":"E","Ê":"E","Ề":"E","Ế":"E","Ễ":"E","Ể":"E","Ẽ":"E","Ē":"E","Ḕ":"E","Ḗ":"E","Ĕ":"E","Ė":"E","Ë":"E","Ẻ":"E","Ě":"E","Ȅ":"E","Ȇ":"E","Ẹ":"E","Ệ":"E","Ȩ":"E","Ḝ":"E","Ę":"E","Ḙ":"E","Ḛ":"E","Ɛ":"E","Ǝ":"E","Ⓕ":"F","Ｆ":"F","Ḟ":"F","Ƒ":"F","Ꝼ":"F","Ⓖ":"G","Ｇ":"G","Ǵ":"G","Ĝ":"G","Ḡ":"G","Ğ":"G","Ġ":"G","Ǧ":"G","Ģ":"G","Ǥ":"G","Ɠ":"G","Ꞡ":"G","Ᵹ":"G","Ꝿ":"G","Ⓗ":"H","Ｈ":"H","Ĥ":"H","Ḣ":"H","Ḧ":"H","Ȟ":"H","Ḥ":"H","Ḩ":"H","Ḫ":"H","Ħ":"H","Ⱨ":"H","Ⱶ":"H","Ɥ":"H","Ⓘ":"I","Ｉ":"I","Ì":"I","Í":"I","Î":"I","Ĩ":"I","Ī":"I","Ĭ":"I","İ":"I","Ï":"I","Ḯ":"I","Ỉ":"I","Ǐ":"I","Ȉ":"I","Ȋ":"I","Ị":"I","Į":"I","Ḭ":"I","Ɨ":"I","Ⓙ":"J","Ｊ":"J","Ĵ":"J","Ɉ":"J","Ⓚ":"K","Ｋ":"K","Ḱ":"K","Ǩ":"K","Ḳ":"K","Ķ":"K","Ḵ":"K","Ƙ":"K","Ⱪ":"K","Ꝁ":"K","Ꝃ":"K","Ꝅ":"K","Ꞣ":"K","Ⓛ":"L","Ｌ":"L","Ŀ":"L","Ĺ":"L","Ľ":"L","Ḷ":"L","Ḹ":"L","Ļ":"L","Ḽ":"L","Ḻ":"L","Ł":"L","Ƚ":"L","Ɫ":"L","Ⱡ":"L","Ꝉ":"L","Ꝇ":"L","Ꞁ":"L","Ǉ":"LJ","ǈ":"Lj","Ⓜ":"M","Ｍ":"M","Ḿ":"M","Ṁ":"M","Ṃ":"M","Ɱ":"M","Ɯ":"M","Ⓝ":"N","Ｎ":"N","Ǹ":"N","Ń":"N","Ñ":"N","Ṅ":"N","Ň":"N","Ṇ":"N","Ņ":"N","Ṋ":"N","Ṉ":"N","Ƞ":"N","Ɲ":"N","Ꞑ":"N","Ꞥ":"N","Ǌ":"NJ","ǋ":"Nj","Ⓞ":"O","Ｏ":"O","Ò":"O","Ó":"O","Ô":"O","Ồ":"O","Ố":"O","Ỗ":"O","Ổ":"O","Õ":"O","Ṍ":"O","Ȭ":"O","Ṏ":"O","Ō":"O","Ṑ":"O","Ṓ":"O","Ŏ":"O","Ȯ":"O","Ȱ":"O","Ö":"O","Ȫ":"O","Ỏ":"O","Ő":"O","Ǒ":"O","Ȍ":"O","Ȏ":"O","Ơ":"O","Ờ":"O","Ớ":"O","Ỡ":"O","Ở":"O","Ợ":"O","Ọ":"O","Ộ":"O","Ǫ":"O","Ǭ":"O","Ø":"O","Ǿ":"O","Ɔ":"O","Ɵ":"O","Ꝋ":"O","Ꝍ":"O","Œ":"OE","Ƣ":"OI","Ꝏ":"OO","Ȣ":"OU","Ⓟ":"P","Ｐ":"P","Ṕ":"P","Ṗ":"P","Ƥ":"P","Ᵽ":"P","Ꝑ":"P","Ꝓ":"P","Ꝕ":"P","Ⓠ":"Q","Ｑ":"Q","Ꝗ":"Q","Ꝙ":"Q","Ɋ":"Q","Ⓡ":"R","Ｒ":"R","Ŕ":"R","Ṙ":"R","Ř":"R","Ȑ":"R","Ȓ":"R","Ṛ":"R","Ṝ":"R","Ŗ":"R","Ṟ":"R","Ɍ":"R","Ɽ":"R","Ꝛ":"R","Ꞧ":"R","Ꞃ":"R","Ⓢ":"S","Ｓ":"S","ẞ":"S","Ś":"S","Ṥ":"S","Ŝ":"S","Ṡ":"S","Š":"S","Ṧ":"S","Ṣ":"S","Ṩ":"S","Ș":"S","Ş":"S","Ȿ":"S","Ꞩ":"S","Ꞅ":"S","Ⓣ":"T","Ｔ":"T","Ṫ":"T","Ť":"T","Ṭ":"T","Ț":"T","Ţ":"T","Ṱ":"T","Ṯ":"T","Ŧ":"T","Ƭ":"T","Ʈ":"T","Ⱦ":"T","Ꞇ":"T","Ꜩ":"TZ","Ⓤ":"U","Ｕ":"U","Ù":"U","Ú":"U","Û":"U","Ũ":"U","Ṹ":"U","Ū":"U","Ṻ":"U","Ŭ":"U","Ü":"U","Ǜ":"U","Ǘ":"U","Ǖ":"U","Ǚ":"U","Ủ":"U","Ů":"U","Ű":"U","Ǔ":"U","Ȕ":"U","Ȗ":"U","Ư":"U","Ừ":"U","Ứ":"U","Ữ":"U","Ử":"U","Ự":"U","Ụ":"U","Ṳ":"U","Ų":"U","Ṷ":"U","Ṵ":"U","Ʉ":"U","Ⓥ":"V","Ｖ":"V","Ṽ":"V","Ṿ":"V","Ʋ":"V","Ꝟ":"V","Ʌ":"V","Ꝡ":"VY","Ⓦ":"W","Ｗ":"W","Ẁ":"W","Ẃ":"W","Ŵ":"W","Ẇ":"W","Ẅ":"W","Ẉ":"W","Ⱳ":"W","Ⓧ":"X","Ｘ":"X","Ẋ":"X","Ẍ":"X","Ⓨ":"Y","Ｙ":"Y","Ỳ":"Y","Ý":"Y","Ŷ":"Y","Ỹ":"Y","Ȳ":"Y","Ẏ":"Y","Ÿ":"Y","Ỷ":"Y","Ỵ":"Y","Ƴ":"Y","Ɏ":"Y","Ỿ":"Y","Ⓩ":"Z","Ｚ":"Z","Ź":"Z","Ẑ":"Z","Ż":"Z","Ž":"Z","Ẓ":"Z","Ẕ":"Z","Ƶ":"Z","Ȥ":"Z","Ɀ":"Z","Ⱬ":"Z","Ꝣ":"Z","ⓐ":"a","ａ":"a","ẚ":"a","à":"a","á":"a","â":"a","ầ":"a","ấ":"a","ẫ":"a","ẩ":"a","ã":"a","ā":"a","ă":"a","ằ":"a","ắ":"a","ẵ":"a","ẳ":"a","ȧ":"a","ǡ":"a","ä":"a","ǟ":"a","ả":"a","å":"a","ǻ":"a","ǎ":"a","ȁ":"a","ȃ":"a","ạ":"a","ậ":"a","ặ":"a","ḁ":"a","ą":"a","ⱥ":"a","ɐ":"a","ꜳ":"aa","æ":"ae","ǽ":"ae","ǣ":"ae","ꜵ":"ao","ꜷ":"au","ꜹ":"av","ꜻ":"av","ꜽ":"ay","ⓑ":"b","ｂ":"b","ḃ":"b","ḅ":"b","ḇ":"b","ƀ":"b","ƃ":"b","ɓ":"b","ⓒ":"c","ｃ":"c","ć":"c","ĉ":"c","ċ":"c","č":"c","ç":"c","ḉ":"c","ƈ":"c","ȼ":"c","ꜿ":"c","ↄ":"c","ⓓ":"d","ｄ":"d","ḋ":"d","ď":"d","ḍ":"d","ḑ":"d","ḓ":"d","ḏ":"d","đ":"d","ƌ":"d","ɖ":"d","ɗ":"d","ꝺ":"d","ǳ":"dz","ǆ":"dz","ⓔ":"e","ｅ":"e","è":"e","é":"e","ê":"e","ề":"e","ế":"e","ễ":"e","ể":"e","ẽ":"e","ē":"e","ḕ":"e","ḗ":"e","ĕ":"e","ė":"e","ë":"e","ẻ":"e","ě":"e","ȅ":"e","ȇ":"e","ẹ":"e","ệ":"e","ȩ":"e","ḝ":"e","ę":"e","ḙ":"e","ḛ":"e","ɇ":"e","ɛ":"e","ǝ":"e","ⓕ":"f","ｆ":"f","ḟ":"f","ƒ":"f","ꝼ":"f","ⓖ":"g","ｇ":"g","ǵ":"g","ĝ":"g","ḡ":"g","ğ":"g","ġ":"g","ǧ":"g","ģ":"g","ǥ":"g","ɠ":"g","ꞡ":"g","ᵹ":"g","ꝿ":"g","ⓗ":"h","ｈ":"h","ĥ":"h","ḣ":"h","ḧ":"h","ȟ":"h","ḥ":"h","ḩ":"h","ḫ":"h","ẖ":"h","ħ":"h","ⱨ":"h","ⱶ":"h","ɥ":"h","ƕ":"hv","ⓘ":"i","ｉ":"i","ì":"i","í":"i","î":"i","ĩ":"i","ī":"i","ĭ":"i","ï":"i","ḯ":"i","ỉ":"i","ǐ":"i","ȉ":"i","ȋ":"i","ị":"i","į":"i","ḭ":"i","ɨ":"i","ı":"i","ⓙ":"j","ｊ":"j","ĵ":"j","ǰ":"j","ɉ":"j","ⓚ":"k","ｋ":"k","ḱ":"k","ǩ":"k","ḳ":"k","ķ":"k","ḵ":"k","ƙ":"k","ⱪ":"k","ꝁ":"k","ꝃ":"k","ꝅ":"k","ꞣ":"k","ⓛ":"l","ｌ":"l","ŀ":"l","ĺ":"l","ľ":"l","ḷ":"l","ḹ":"l","ļ":"l","ḽ":"l","ḻ":"l","ſ":"l","ł":"l","ƚ":"l","ɫ":"l","ⱡ":"l","ꝉ":"l","ꞁ":"l","ꝇ":"l","ǉ":"lj","ⓜ":"m","ｍ":"m","ḿ":"m","ṁ":"m","ṃ":"m","ɱ":"m","ɯ":"m","ⓝ":"n","ｎ":"n","ǹ":"n","ń":"n","ñ":"n","ṅ":"n","ň":"n","ṇ":"n","ņ":"n","ṋ":"n","ṉ":"n","ƞ":"n","ɲ":"n","ŉ":"n","ꞑ":"n","ꞥ":"n","ǌ":"nj","ⓞ":"o","ｏ":"o","ò":"o","ó":"o","ô":"o","ồ":"o","ố":"o","ỗ":"o","ổ":"o","õ":"o","ṍ":"o","ȭ":"o","ṏ":"o","ō":"o","ṑ":"o","ṓ":"o","ŏ":"o","ȯ":"o","ȱ":"o","ö":"o","ȫ":"o","ỏ":"o","ő":"o","ǒ":"o","ȍ":"o","ȏ":"o","ơ":"o","ờ":"o","ớ":"o","ỡ":"o","ở":"o","ợ":"o","ọ":"o","ộ":"o","ǫ":"o","ǭ":"o","ø":"o","ǿ":"o","ɔ":"o","ꝋ":"o","ꝍ":"o","ɵ":"o","œ":"oe","ƣ":"oi","ȣ":"ou","ꝏ":"oo","ⓟ":"p","ｐ":"p","ṕ":"p","ṗ":"p","ƥ":"p","ᵽ":"p","ꝑ":"p","ꝓ":"p","ꝕ":"p","ⓠ":"q","ｑ":"q","ɋ":"q","ꝗ":"q","ꝙ":"q","ⓡ":"r","ｒ":"r","ŕ":"r","ṙ":"r","ř":"r","ȑ":"r","ȓ":"r","ṛ":"r","ṝ":"r","ŗ":"r","ṟ":"r","ɍ":"r","ɽ":"r","ꝛ":"r","ꞧ":"r","ꞃ":"r","ⓢ":"s","ｓ":"s","ß":"s","ś":"s","ṥ":"s","ŝ":"s","ṡ":"s","š":"s","ṧ":"s","ṣ":"s","ṩ":"s","ș":"s","ş":"s","ȿ":"s","ꞩ":"s","ꞅ":"s","ẛ":"s","ⓣ":"t","ｔ":"t","ṫ":"t","ẗ":"t","ť":"t","ṭ":"t","ț":"t","ţ":"t","ṱ":"t","ṯ":"t","ŧ":"t","ƭ":"t","ʈ":"t","ⱦ":"t","ꞇ":"t","ꜩ":"tz","ⓤ":"u","ｕ":"u","ù":"u","ú":"u","û":"u","ũ":"u","ṹ":"u","ū":"u","ṻ":"u","ŭ":"u","ü":"u","ǜ":"u","ǘ":"u","ǖ":"u","ǚ":"u","ủ":"u","ů":"u","ű":"u","ǔ":"u","ȕ":"u","ȗ":"u","ư":"u","ừ":"u","ứ":"u","ữ":"u","ử":"u","ự":"u","ụ":"u","ṳ":"u","ų":"u","ṷ":"u","ṵ":"u","ʉ":"u","ⓥ":"v","ｖ":"v","ṽ":"v","ṿ":"v","ʋ":"v","ꝟ":"v","ʌ":"v","ꝡ":"vy","ⓦ":"w","ｗ":"w","ẁ":"w","ẃ":"w","ŵ":"w","ẇ":"w","ẅ":"w","ẘ":"w","ẉ":"w","ⱳ":"w","ⓧ":"x","ｘ":"x","ẋ":"x","ẍ":"x","ⓨ":"y","ｙ":"y","ỳ":"y","ý":"y","ŷ":"y","ỹ":"y","ȳ":"y","ẏ":"y","ÿ":"y","ỷ":"y","ẙ":"y","ỵ":"y","ƴ":"y","ɏ":"y","ỿ":"y","ⓩ":"z","ｚ":"z","ź":"z","ẑ":"z","ż":"z","ž":"z","ẓ":"z","ẕ":"z","ƶ":"z","ȥ":"z","ɀ":"z","ⱬ":"z","ꝣ":"z","Ά":"Α","Έ":"Ε","Ή":"Η","Ί":"Ι","Ϊ":"Ι","Ό":"Ο","Ύ":"Υ","Ϋ":"Υ","Ώ":"Ω","ά":"α","έ":"ε","ή":"η","ί":"ι","ϊ":"ι","ΐ":"ι","ό":"ο","ύ":"υ","ϋ":"υ","ΰ":"υ","ώ":"ω","ς":"σ","’":"'"}}),e.define("select2/data/base",["../utils"],function(i){function n(e,t){n.__super__.constructor.call(this)}return i.Extend(n,i.Observable),n.prototype.current=function(e){throw new Error("The `current` method must be defined in child classes.")},n.prototype.query=function(e,t){throw new Error("The `query` method must be defined in child classes.")},n.prototype.bind=function(e,t){},n.prototype.destroy=function(){},n.prototype.generateResultId=function(e,t){var n=e.id+"-result-";return n+=i.generateChars(4),null!=t.id?n+="-"+t.id.toString():n+="-"+i.generateChars(4),n},n}),e.define("select2/data/select",["./base","../utils","jquery"],function(e,a,l){function n(e,t){this.$element=e,this.options=t,n.__super__.constructor.call(this)}return a.Extend(n,e),n.prototype.current=function(e){var n=[],i=this;this.$element.find(":selected").each(function(){var e=l(this),t=i.item(e);n.push(t)}),e(n)},n.prototype.select=function(r){var o=this;if(r.selected=!0,l(r.element).is("option"))return r.element.selected=!0,void this.$element.trigger("change");if(this.$element.prop("multiple"))this.current(function(e){var t=[];(r=[r]).push.apply(r,e);for(var n=0;n<r.length;n++){var i=r[n].id;-1===l.inArray(i,t)&&t.push(i)}o.$element.val(t),o.$element.trigger("change")});else{var e=r.id;this.$element.val(e),this.$element.trigger("change")}},n.prototype.unselect=function(r){var o=this;if(this.$element.prop("multiple")){if(r.selected=!1,l(r.element).is("option"))return r.element.selected=!1,void this.$element.trigger("change");this.current(function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n].id;i!==r.id&&-1===l.inArray(i,t)&&t.push(i)}o.$element.val(t),o.$element.trigger("change")})}},n.prototype.bind=function(e,t){var n=this;(this.container=e).on("select",function(e){n.select(e.data)}),e.on("unselect",function(e){n.unselect(e.data)})},n.prototype.destroy=function(){this.$element.find("*").each(function(){a.RemoveData(this)})},n.prototype.query=function(i,e){var r=[],o=this;this.$element.children().each(function(){var e=l(this);if(e.is("option")||e.is("optgroup")){var t=o.item(e),n=o.matches(i,t);null!==n&&r.push(n)}}),e({results:r})},n.prototype.addOptions=function(e){a.appendMany(this.$element,e)},n.prototype.option=function(e){var t;e.children?(t=document.createElement("optgroup")).label=e.text:void 0!==(t=document.createElement("option")).textContent?t.textContent=e.text:t.innerText=e.text,void 0!==e.id&&(t.value=e.id),e.disabled&&(t.disabled=!0),e.selected&&(t.selected=!0),e.title&&(t.title=e.title);var n=l(t),i=this._normalizeItem(e);return i.element=t,a.StoreData(t,"data",i),n},n.prototype.item=function(e){var t={};if(null!=(t=a.GetData(e[0],"data")))return t;if(e.is("option"))t={id:e.val(),text:e.text(),disabled:e.prop("disabled"),selected:e.prop("selected"),title:e.prop("title")};else if(e.is("optgroup")){t={text:e.prop("label"),children:[],title:e.prop("title")};for(var n=e.children("option"),i=[],r=0;r<n.length;r++){var o=l(n[r]),s=this.item(o);i.push(s)}t.children=i}return(t=this._normalizeItem(t)).element=e[0],a.StoreData(e[0],"data",t),t},n.prototype._normalizeItem=function(e){e!==Object(e)&&(e={id:e,text:e});return null!=(e=l.extend({},{text:""},e)).id&&(e.id=e.id.toString()),null!=e.text&&(e.text=e.text.toString()),null==e._resultId&&e.id&&null!=this.container&&(e._resultId=this.generateResultId(this.container,e)),l.extend({},{selected:!1,disabled:!1},e)},n.prototype.matches=function(e,t){return this.options.get("matcher")(e,t)},n}),e.define("select2/data/array",["./select","../utils","jquery"],function(e,f,g){function i(e,t){this._dataToConvert=t.get("data")||[],i.__super__.constructor.call(this,e,t)}return f.Extend(i,e),i.prototype.bind=function(e,t){i.__super__.bind.call(this,e,t),this.addOptions(this.convertToOptions(this._dataToConvert))},i.prototype.select=function(n){var e=this.$element.find("option").filter(function(e,t){return t.value==n.id.toString()});0===e.length&&(e=this.option(n),this.addOptions(e)),i.__super__.select.call(this,n)},i.prototype.convertToOptions=function(e){var t=this,n=this.$element.find("option"),i=n.map(function(){return t.item(g(this)).id}).get(),r=[];function o(e){return function(){return g(this).val()==e.id}}for(var s=0;s<e.length;s++){var a=this._normalizeItem(e[s]);if(0<=g.inArray(a.id,i)){var l=n.filter(o(a)),c=this.item(l),u=g.extend(!0,{},a,c),d=this.option(u);l.replaceWith(d)}else{var p=this.option(a);if(a.children){var h=this.convertToOptions(a.children);f.appendMany(p,h)}r.push(p)}}return r},i}),e.define("select2/data/ajax",["./array","../utils","jquery"],function(e,t,o){function n(e,t){this.ajaxOptions=this._applyDefaults(t.get("ajax")),null!=this.ajaxOptions.processResults&&(this.processResults=this.ajaxOptions.processResults),n.__super__.constructor.call(this,e,t)}return t.Extend(n,e),n.prototype._applyDefaults=function(e){var t={data:function(e){return o.extend({},e,{q:e.term})},transport:function(e,t,n){var i=o.ajax(e);return i.then(t),i.fail(n),i}};return o.extend({},t,e,!0)},n.prototype.processResults=function(e){return e},n.prototype.query=function(n,i){var r=this;null!=this._request&&(o.isFunction(this._request.abort)&&this._request.abort(),this._request=null);var t=o.extend({type:"GET"},this.ajaxOptions);function e(){var e=t.transport(t,function(e){var t=r.processResults(e,n);r.options.get("debug")&&window.console&&console.error&&(t&&t.results&&o.isArray(t.results)||console.error("Select2: The AJAX results did not return an array in the `results` key of the response.")),i(t)},function(){"status"in e&&(0===e.status||"0"===e.status)||r.trigger("results:message",{message:"errorLoading"})});r._request=e}"function"==typeof t.url&&(t.url=t.url.call(this.$element,n)),"function"==typeof t.data&&(t.data=t.data.call(this.$element,n)),this.ajaxOptions.delay&&null!=n.term?(this._queryTimeout&&window.clearTimeout(this._queryTimeout),this._queryTimeout=window.setTimeout(e,this.ajaxOptions.delay)):e()},n}),e.define("select2/data/tags",["jquery"],function(u){function e(e,t,n){var i=n.get("tags"),r=n.get("createTag");void 0!==r&&(this.createTag=r);var o=n.get("insertTag");if(void 0!==o&&(this.insertTag=o),e.call(this,t,n),u.isArray(i))for(var s=0;s<i.length;s++){var a=i[s],l=this._normalizeItem(a),c=this.option(l);this.$element.append(c)}}return e.prototype.query=function(e,c,u){var d=this;this._removeOldTags(),null!=c.term&&null==c.page?e.call(this,c,function e(t,n){for(var i=t.results,r=0;r<i.length;r++){var o=i[r],s=null!=o.children&&!e({results:o.children},!0);if((o.text||"").toUpperCase()===(c.term||"").toUpperCase()||s)return!n&&(t.data=i,void u(t))}if(n)return!0;var a=d.createTag(c);if(null!=a){var l=d.option(a);l.attr("data-select2-tag",!0),d.addOptions([l]),d.insertTag(i,a)}t.results=i,u(t)}):e.call(this,c,u)},e.prototype.createTag=function(e,t){var n=u.trim(t.term);return""===n?null:{id:n,text:n}},e.prototype.insertTag=function(e,t,n){t.unshift(n)},e.prototype._removeOldTags=function(e){this.$element.find("option[data-select2-tag]").each(function(){this.selected||u(this).remove()})},e}),e.define("select2/data/tokenizer",["jquery"],function(d){function e(e,t,n){var i=n.get("tokenizer");void 0!==i&&(this.tokenizer=i),e.call(this,t,n)}return e.prototype.bind=function(e,t,n){e.call(this,t,n),this.$search=t.dropdown.$search||t.selection.$search||n.find(".select2-search__field")},e.prototype.query=function(e,t,n){var i=this;t.term=t.term||"";var r=this.tokenizer(t,this.options,function(e){var t=i._normalizeItem(e);if(!i.$element.find("option").filter(function(){return d(this).val()===t.id}).length){var n=i.option(t);n.attr("data-select2-tag",!0),i._removeOldTags(),i.addOptions([n])}!function(e){i.trigger("select",{data:e})}(t)});r.term!==t.term&&(this.$search.length&&(this.$search.val(r.term),this.$search.trigger("focus")),t.term=r.term),e.call(this,t,n)},e.prototype.tokenizer=function(e,t,n,i){for(var r=n.get("tokenSeparators")||[],o=t.term,s=0,a=this.createTag||function(e){return{id:e.term,text:e.term}};s<o.length;){var l=o[s];if(-1!==d.inArray(l,r)){var c=o.substr(0,s),u=a(d.extend({},t,{term:c}));null!=u?(i(u),o=o.substr(s+1)||"",s=0):s++}else s++}return{term:o}},e}),e.define("select2/data/minimumInputLength",[],function(){function e(e,t,n){this.minimumInputLength=n.get("minimumInputLength"),e.call(this,t,n)}return e.prototype.query=function(e,t,n){t.term=t.term||"",t.term.length<this.minimumInputLength?this.trigger("results:message",{message:"inputTooShort",args:{minimum:this.minimumInputLength,input:t.term,params:t}}):e.call(this,t,n)},e}),e.define("select2/data/maximumInputLength",[],function(){function e(e,t,n){this.maximumInputLength=n.get("maximumInputLength"),e.call(this,t,n)}return e.prototype.query=function(e,t,n){t.term=t.term||"",0<this.maximumInputLength&&t.term.length>this.maximumInputLength?this.trigger("results:message",{message:"inputTooLong",args:{maximum:this.maximumInputLength,input:t.term,params:t}}):e.call(this,t,n)},e}),e.define("select2/data/maximumSelectionLength",[],function(){function e(e,t,n){this.maximumSelectionLength=n.get("maximumSelectionLength"),e.call(this,t,n)}return e.prototype.bind=function(e,t,n){var i=this;e.call(this,t,n),t.on("select",function(){i._checkIfMaximumSelected()})},e.prototype.query=function(e,t,n){var i=this;this._checkIfMaximumSelected(function(){e.call(i,t,n)})},e.prototype._checkIfMaximumSelected=function(e,n){var i=this;this.current(function(e){var t=null!=e?e.length:0;0<i.maximumSelectionLength&&t>=i.maximumSelectionLength?i.trigger("results:message",{message:"maximumSelected",args:{maximum:i.maximumSelectionLength}}):n&&n()})},e}),e.define("select2/dropdown",["jquery","./utils"],function(t,e){function n(e,t){this.$element=e,this.options=t,n.__super__.constructor.call(this)}return e.Extend(n,e.Observable),n.prototype.render=function(){var e=t('<span class="select2-dropdown"><span class="select2-results"></span></span>');return e.attr("dir",this.options.get("dir")),this.$dropdown=e},n.prototype.bind=function(){},n.prototype.position=function(e,t){},n.prototype.destroy=function(){this.$dropdown.remove()},n}),e.define("select2/dropdown/search",["jquery","../utils"],function(o,e){function t(){}return t.prototype.render=function(e){var t=e.call(this),n=o('<span class="select2-search select2-search--dropdown"><input class="select2-search__field" type="search" tabindex="-1" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" role="searchbox" aria-autocomplete="list" /></span>');return this.$searchContainer=n,this.$search=n.find("input"),t.prepend(n),t},t.prototype.bind=function(e,t,n){var i=this,r=t.id+"-results";e.call(this,t,n),this.$search.on("keydown",function(e){i.trigger("keypress",e),i._keyUpPrevented=e.isDefaultPrevented()}),this.$search.on("input",function(e){o(this).off("keyup")}),this.$search.on("keyup input",function(e){i.handleSearch(e)}),t.on("open",function(){i.$search.attr("tabindex",0),i.$search.attr("aria-controls",r),i.$search.trigger("focus"),window.setTimeout(function(){i.$search.trigger("focus")},0)}),t.on("close",function(){i.$search.attr("tabindex",-1),i.$search.removeAttr("aria-controls"),i.$search.removeAttr("aria-activedescendant"),i.$search.val(""),i.$search.trigger("blur")}),t.on("focus",function(){t.isOpen()||i.$search.trigger("focus")}),t.on("results:all",function(e){null!=e.query.term&&""!==e.query.term||(i.showSearch(e)?i.$searchContainer.removeClass("select2-search--hide"):i.$searchContainer.addClass("select2-search--hide"))}),t.on("results:focus",function(e){e.data._resultId?i.$search.attr("aria-activedescendant",e.data._resultId):i.$search.removeAttr("aria-activedescendant")})},t.prototype.handleSearch=function(e){if(!this._keyUpPrevented){var t=this.$search.val();this.trigger("query",{term:t})}this._keyUpPrevented=!1},t.prototype.showSearch=function(e,t){return!0},t}),e.define("select2/dropdown/hidePlaceholder",[],function(){function e(e,t,n,i){this.placeholder=this.normalizePlaceholder(n.get("placeholder")),e.call(this,t,n,i)}return e.prototype.append=function(e,t){t.results=this.removePlaceholder(t.results),e.call(this,t)},e.prototype.normalizePlaceholder=function(e,t){return"string"==typeof t&&(t={id:"",text:t}),t},e.prototype.removePlaceholder=function(e,t){for(var n=t.slice(0),i=t.length-1;0<=i;i--){var r=t[i];this.placeholder.id===r.id&&n.splice(i,1)}return n},e}),e.define("select2/dropdown/infiniteScroll",["jquery"],function(n){function e(e,t,n,i){this.lastParams={},e.call(this,t,n,i),this.$loadingMore=this.createLoadingMore(),this.loading=!1}return e.prototype.append=function(e,t){this.$loadingMore.remove(),this.loading=!1,e.call(this,t),this.showLoadingMore(t)&&(this.$results.append(this.$loadingMore),this.loadMoreIfNeeded())},e.prototype.bind=function(e,t,n){var i=this;e.call(this,t,n),t.on("query",function(e){i.lastParams=e,i.loading=!0}),t.on("query:append",function(e){i.lastParams=e,i.loading=!0}),this.$results.on("scroll",this.loadMoreIfNeeded.bind(this))},e.prototype.loadMoreIfNeeded=function(){var e=n.contains(document.documentElement,this.$loadingMore[0]);if(!this.loading&&e){var t=this.$results.offset().top+this.$results.outerHeight(!1);this.$loadingMore.offset().top+this.$loadingMore.outerHeight(!1)<=t+50&&this.loadMore()}},e.prototype.loadMore=function(){this.loading=!0;var e=n.extend({},{page:1},this.lastParams);e.page++,this.trigger("query:append",e)},e.prototype.showLoadingMore=function(e,t){return t.pagination&&t.pagination.more},e.prototype.createLoadingMore=function(){var e=n('<li class="select2-results__option select2-results__option--load-more"role="option" aria-disabled="true"></li>'),t=this.options.get("translations").get("loadingMore");return e.html(t(this.lastParams)),e},e}),e.define("select2/dropdown/attachBody",["jquery","../utils"],function(f,a){function e(e,t,n){this.$dropdownParent=f(n.get("dropdownParent")||document.body),e.call(this,t,n)}return e.prototype.bind=function(e,t,n){var i=this;e.call(this,t,n),t.on("open",function(){i._showDropdown(),i._attachPositioningHandler(t),i._bindContainerResultHandlers(t)}),t.on("close",function(){i._hideDropdown(),i._detachPositioningHandler(t)}),this.$dropdownContainer.on("mousedown",function(e){e.stopPropagation()})},e.prototype.destroy=function(e){e.call(this),this.$dropdownContainer.remove()},e.prototype.position=function(e,t,n){t.attr("class",n.attr("class")),t.removeClass("select2"),t.addClass("select2-container--open"),t.css({position:"absolute",top:-999999}),this.$container=n},e.prototype.render=function(e){var t=f("<span></span>"),n=e.call(this);return t.append(n),this.$dropdownContainer=t},e.prototype._hideDropdown=function(e){this.$dropdownContainer.detach()},e.prototype._bindContainerResultHandlers=function(e,t){if(!this._containerResultsHandlersBound){var n=this;t.on("results:all",function(){n._positionDropdown(),n._resizeDropdown()}),t.on("results:append",function(){n._positionDropdown(),n._resizeDropdown()}),t.on("results:message",function(){n._positionDropdown(),n._resizeDropdown()}),t.on("select",function(){n._positionDropdown(),n._resizeDropdown()}),t.on("unselect",function(){n._positionDropdown(),n._resizeDropdown()}),this._containerResultsHandlersBound=!0}},e.prototype._attachPositioningHandler=function(e,t){var n=this,i="scroll.select2."+t.id,r="resize.select2."+t.id,o="orientationchange.select2."+t.id,s=this.$container.parents().filter(a.hasScroll);s.each(function(){a.StoreData(this,"select2-scroll-position",{x:f(this).scrollLeft(),y:f(this).scrollTop()})}),s.on(i,function(e){var t=a.GetData(this,"select2-scroll-position");f(this).scrollTop(t.y)}),f(window).on(i+" "+r+" "+o,function(e){n._positionDropdown(),n._resizeDropdown()})},e.prototype._detachPositioningHandler=function(e,t){var n="scroll.select2."+t.id,i="resize.select2."+t.id,r="orientationchange.select2."+t.id;this.$container.parents().filter(a.hasScroll).off(n),f(window).off(n+" "+i+" "+r)},e.prototype._positionDropdown=function(){var e=f(window),t=this.$dropdown.hasClass("select2-dropdown--above"),n=this.$dropdown.hasClass("select2-dropdown--below"),i=null,r=this.$container.offset();r.bottom=r.top+this.$container.outerHeight(!1);var o={height:this.$container.outerHeight(!1)};o.top=r.top,o.bottom=r.top+o.height;var s=this.$dropdown.outerHeight(!1),a=e.scrollTop(),l=e.scrollTop()+e.height(),c=a<r.top-s,u=l>r.bottom+s,d={left:r.left,top:o.bottom},p=this.$dropdownParent;"static"===p.css("position")&&(p=p.offsetParent());var h=p.offset();d.top-=h.top,d.left-=h.left,t||n||(i="below"),u||!c||t?!c&&u&&t&&(i="below"):i="above",("above"==i||t&&"below"!==i)&&(d.top=o.top-h.top-s),null!=i&&(this.$dropdown.removeClass("select2-dropdown--below select2-dropdown--above").addClass("select2-dropdown--"+i),this.$container.removeClass("select2-container--below select2-container--above").addClass("select2-container--"+i)),this.$dropdownContainer.css(d)},e.prototype._resizeDropdown=function(){var e={width:this.$container.outerWidth(!1)+"px"};this.options.get("dropdownAutoWidth")&&(e.minWidth=e.width,e.position="relative",e.width="auto"),this.$dropdown.css(e)},e.prototype._showDropdown=function(e){this.$dropdownContainer.appendTo(this.$dropdownParent),this._positionDropdown(),this._resizeDropdown()},e}),e.define("select2/dropdown/minimumResultsForSearch",[],function(){function e(e,t,n,i){this.minimumResultsForSearch=n.get("minimumResultsForSearch"),this.minimumResultsForSearch<0&&(this.minimumResultsForSearch=1/0),e.call(this,t,n,i)}return e.prototype.showSearch=function(e,t){return!(function e(t){for(var n=0,i=0;i<t.length;i++){var r=t[i];r.children?n+=e(r.children):n++}return n}(t.data.results)<this.minimumResultsForSearch)&&e.call(this,t)},e}),e.define("select2/dropdown/selectOnClose",["../utils"],function(o){function e(){}return e.prototype.bind=function(e,t,n){var i=this;e.call(this,t,n),t.on("close",function(e){i._handleSelectOnClose(e)})},e.prototype._handleSelectOnClose=function(e,t){if(t&&null!=t.originalSelect2Event){var n=t.originalSelect2Event;if("select"===n._type||"unselect"===n._type)return}var i=this.getHighlightedResults();if(!(i.length<1)){var r=o.GetData(i[0],"data");null!=r.element&&r.element.selected||null==r.element&&r.selected||this.trigger("select",{data:r})}},e}),e.define("select2/dropdown/closeOnSelect",[],function(){function e(){}return e.prototype.bind=function(e,t,n){var i=this;e.call(this,t,n),t.on("select",function(e){i._selectTriggered(e)}),t.on("unselect",function(e){i._selectTriggered(e)})},e.prototype._selectTriggered=function(e,t){var n=t.originalEvent;n&&(n.ctrlKey||n.metaKey)||this.trigger("close",{originalEvent:n,originalSelect2Event:t})},e}),e.define("select2/i18n/en",[],function(){return{errorLoading:function(){return"The results could not be loaded."},inputTooLong:function(e){var t=e.input.length-e.maximum,n="Please delete "+t+" character";return 1!=t&&(n+="s"),n},inputTooShort:function(e){return"Please enter "+(e.minimum-e.input.length)+" or more characters"},loadingMore:function(){return"Loading more results…"},maximumSelected:function(e){var t="You can only select "+e.maximum+" item";return 1!=e.maximum&&(t+="s"),t},noResults:function(){return"No results found"},searching:function(){return"Searching…"},removeAllItems:function(){return"Remove all items"}}}),e.define("select2/defaults",["jquery","require","./results","./selection/single","./selection/multiple","./selection/placeholder","./selection/allowClear","./selection/search","./selection/eventRelay","./utils","./translation","./diacritics","./data/select","./data/array","./data/ajax","./data/tags","./data/tokenizer","./data/minimumInputLength","./data/maximumInputLength","./data/maximumSelectionLength","./dropdown","./dropdown/search","./dropdown/hidePlaceholder","./dropdown/infiniteScroll","./dropdown/attachBody","./dropdown/minimumResultsForSearch","./dropdown/selectOnClose","./dropdown/closeOnSelect","./i18n/en"],function(c,u,d,p,h,f,g,m,v,y,s,t,_,w,$,b,A,x,S,D,C,E,O,T,q,j,L,I,e){function n(){this.reset()}return n.prototype.apply=function(e){if(null==(e=c.extend(!0,{},this.defaults,e)).dataAdapter){if(null!=e.ajax?e.dataAdapter=$:null!=e.data?e.dataAdapter=w:e.dataAdapter=_,0<e.minimumInputLength&&(e.dataAdapter=y.Decorate(e.dataAdapter,x)),0<e.maximumInputLength&&(e.dataAdapter=y.Decorate(e.dataAdapter,S)),0<e.maximumSelectionLength&&(e.dataAdapter=y.Decorate(e.dataAdapter,D)),e.tags&&(e.dataAdapter=y.Decorate(e.dataAdapter,b)),null==e.tokenSeparators&&null==e.tokenizer||(e.dataAdapter=y.Decorate(e.dataAdapter,A)),null!=e.query){var t=u(e.amdBase+"compat/query");e.dataAdapter=y.Decorate(e.dataAdapter,t)}if(null!=e.initSelection){var n=u(e.amdBase+"compat/initSelection");e.dataAdapter=y.Decorate(e.dataAdapter,n)}}if(null==e.resultsAdapter&&(e.resultsAdapter=d,null!=e.ajax&&(e.resultsAdapter=y.Decorate(e.resultsAdapter,T)),null!=e.placeholder&&(e.resultsAdapter=y.Decorate(e.resultsAdapter,O)),e.selectOnClose&&(e.resultsAdapter=y.Decorate(e.resultsAdapter,L))),null==e.dropdownAdapter){if(e.multiple)e.dropdownAdapter=C;else{var i=y.Decorate(C,E);e.dropdownAdapter=i}if(0!==e.minimumResultsForSearch&&(e.dropdownAdapter=y.Decorate(e.dropdownAdapter,j)),e.closeOnSelect&&(e.dropdownAdapter=y.Decorate(e.dropdownAdapter,I)),null!=e.dropdownCssClass||null!=e.dropdownCss||null!=e.adaptDropdownCssClass){var r=u(e.amdBase+"compat/dropdownCss");e.dropdownAdapter=y.Decorate(e.dropdownAdapter,r)}e.dropdownAdapter=y.Decorate(e.dropdownAdapter,q)}if(null==e.selectionAdapter){if(e.multiple?e.selectionAdapter=h:e.selectionAdapter=p,null!=e.placeholder&&(e.selectionAdapter=y.Decorate(e.selectionAdapter,f)),e.allowClear&&(e.selectionAdapter=y.Decorate(e.selectionAdapter,g)),e.multiple&&(e.selectionAdapter=y.Decorate(e.selectionAdapter,m)),null!=e.containerCssClass||null!=e.containerCss||null!=e.adaptContainerCssClass){var o=u(e.amdBase+"compat/containerCss");e.selectionAdapter=y.Decorate(e.selectionAdapter,o)}e.selectionAdapter=y.Decorate(e.selectionAdapter,v)}e.language=this._resolveLanguage(e.language),e.language.push("en");for(var s=[],a=0;a<e.language.length;a++){var l=e.language[a];-1===s.indexOf(l)&&s.push(l)}return e.language=s,e.translations=this._processTranslations(e.language,e.debug),e},n.prototype.reset=function(){function a(e){return e.replace(/[^\u0000-\u007E]/g,function(e){return t[e]||e})}this.defaults={amdBase:"./",amdLanguageBase:"./i18n/",closeOnSelect:!0,debug:!1,dropdownAutoWidth:!1,escapeMarkup:y.escapeMarkup,language:{},matcher:function e(t,n){if(""===c.trim(t.term))return n;if(n.children&&0<n.children.length){for(var i=c.extend(!0,{},n),r=n.children.length-1;0<=r;r--)null==e(t,n.children[r])&&i.children.splice(r,1);return 0<i.children.length?i:e(t,i)}var o=a(n.text).toUpperCase(),s=a(t.term).toUpperCase();return-1<o.indexOf(s)?n:null},minimumInputLength:0,maximumInputLength:0,maximumSelectionLength:0,minimumResultsForSearch:0,selectOnClose:!1,scrollAfterSelect:!1,sorter:function(e){return e},templateResult:function(e){return e.text},templateSelection:function(e){return e.text},theme:"default",width:"resolve"}},n.prototype.applyFromElement=function(e,t){var n=e.language,i=this.defaults.language,r=t.prop("lang"),o=t.closest("[lang]").prop("lang"),s=Array.prototype.concat.call(this._resolveLanguage(r),this._resolveLanguage(n),this._resolveLanguage(i),this._resolveLanguage(o));return e.language=s,e},n.prototype._resolveLanguage=function(e){if(!e)return[];if(c.isEmptyObject(e))return[];if(c.isPlainObject(e))return[e];var t;t=c.isArray(e)?e:[e];for(var n=[],i=0;i<t.length;i++)if(n.push(t[i]),"string"==typeof t[i]&&0<t[i].indexOf("-")){var r=t[i].split("-")[0];n.push(r)}return n},n.prototype._processTranslations=function(e,t){for(var n=new s,i=0;i<e.length;i++){var r=new s,o=e[i];if("string"==typeof o)try{r=s.loadPath(o)}catch(e){try{o=this.defaults.amdLanguageBase+o,r=s.loadPath(o)}catch(e){t&&window.console&&console.warn&&console.warn('Select2: The language file for "'+o+'" could not be automatically loaded. A fallback will be used instead.')}}else r=c.isPlainObject(o)?new s(o):o;n.extend(r)}return n},n.prototype.set=function(e,t){var n={};n[c.camelCase(e)]=t;var i=y._convertData(n);c.extend(!0,this.defaults,i)},new n}),e.define("select2/options",["require","jquery","./defaults","./utils"],function(i,d,r,p){function e(e,t){if(this.options=e,null!=t&&this.fromElement(t),null!=t&&(this.options=r.applyFromElement(this.options,t)),this.options=r.apply(this.options),t&&t.is("input")){var n=i(this.get("amdBase")+"compat/inputData");this.options.dataAdapter=p.Decorate(this.options.dataAdapter,n)}}return e.prototype.fromElement=function(e){var t=["select2"];null==this.options.multiple&&(this.options.multiple=e.prop("multiple")),null==this.options.disabled&&(this.options.disabled=e.prop("disabled")),null==this.options.dir&&(e.prop("dir")?this.options.dir=e.prop("dir"):e.closest("[dir]").prop("dir")?this.options.dir=e.closest("[dir]").prop("dir"):this.options.dir="ltr"),e.prop("disabled",this.options.disabled),e.prop("multiple",this.options.multiple),p.GetData(e[0],"select2Tags")&&(this.options.debug&&window.console&&console.warn&&console.warn('Select2: The `data-select2-tags` attribute has been changed to use the `data-data` and `data-tags="true"` attributes and will be removed in future versions of Select2.'),p.StoreData(e[0],"data",p.GetData(e[0],"select2Tags")),p.StoreData(e[0],"tags",!0)),p.GetData(e[0],"ajaxUrl")&&(this.options.debug&&window.console&&console.warn&&console.warn("Select2: The `data-ajax-url` attribute has been changed to `data-ajax--url` and support for the old attribute will be removed in future versions of Select2."),e.attr("ajax--url",p.GetData(e[0],"ajaxUrl")),p.StoreData(e[0],"ajax-Url",p.GetData(e[0],"ajaxUrl")));var n={};function i(e,t){return t.toUpperCase()}for(var r=0;r<e[0].attributes.length;r++){var o=e[0].attributes[r].name,s="data-";if(o.substr(0,s.length)==s){var a=o.substring(s.length),l=p.GetData(e[0],a);n[a.replace(/-([a-z])/g,i)]=l}}d.fn.jquery&&"1."==d.fn.jquery.substr(0,2)&&e[0].dataset&&(n=d.extend(!0,{},e[0].dataset,n));var c=d.extend(!0,{},p.GetData(e[0]),n);for(var u in c=p._convertData(c))-1<d.inArray(u,t)||(d.isPlainObject(this.options[u])?d.extend(this.options[u],c[u]):this.options[u]=c[u]);return this},e.prototype.get=function(e){return this.options[e]},e.prototype.set=function(e,t){this.options[e]=t},e}),e.define("select2/core",["jquery","./options","./utils","./keys"],function(r,c,u,i){var d=function(e,t){null!=u.GetData(e[0],"select2")&&u.GetData(e[0],"select2").destroy(),this.$element=e,this.id=this._generateId(e),t=t||{},this.options=new c(t,e),d.__super__.constructor.call(this);var n=e.attr("tabindex")||0;u.StoreData(e[0],"old-tabindex",n),e.attr("tabindex","-1");var i=this.options.get("dataAdapter");this.dataAdapter=new i(e,this.options);var r=this.render();this._placeContainer(r);var o=this.options.get("selectionAdapter");this.selection=new o(e,this.options),this.$selection=this.selection.render(),this.selection.position(this.$selection,r);var s=this.options.get("dropdownAdapter");this.dropdown=new s(e,this.options),this.$dropdown=this.dropdown.render(),this.dropdown.position(this.$dropdown,r);var a=this.options.get("resultsAdapter");this.results=new a(e,this.options,this.dataAdapter),this.$results=this.results.render(),this.results.position(this.$results,this.$dropdown);var l=this;this._bindAdapters(),this._registerDomEvents(),this._registerDataEvents(),this._registerSelectionEvents(),this._registerDropdownEvents(),this._registerResultsEvents(),this._registerEvents(),this.dataAdapter.current(function(e){l.trigger("selection:update",{data:e})}),e.addClass("select2-hidden-accessible"),e.attr("aria-hidden","true"),this._syncAttributes(),u.StoreData(e[0],"select2",this),e.data("select2",this)};return u.Extend(d,u.Observable),d.prototype._generateId=function(e){return"select2-"+(null!=e.attr("id")?e.attr("id"):null!=e.attr("name")?e.attr("name")+"-"+u.generateChars(2):u.generateChars(4)).replace(/(:|\.|\[|\]|,)/g,"")},d.prototype._placeContainer=function(e){e.insertAfter(this.$element);var t=this._resolveWidth(this.$element,this.options.get("width"));null!=t&&e.css("width",t)},d.prototype._resolveWidth=function(e,t){var n=/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i;if("resolve"==t){var i=this._resolveWidth(e,"style");return null!=i?i:this._resolveWidth(e,"element")}if("element"==t){var r=e.outerWidth(!1);return r<=0?"auto":r+"px"}if("style"!=t)return"computedstyle"!=t?t:window.getComputedStyle(e[0]).width;var o=e.attr("style");if("string"!=typeof o)return null;for(var s=o.split(";"),a=0,l=s.length;a<l;a+=1){var c=s[a].replace(/\s/g,"").match(n);if(null!==c&&1<=c.length)return c[1]}return null},d.prototype._bindAdapters=function(){this.dataAdapter.bind(this,this.$container),this.selection.bind(this,this.$container),this.dropdown.bind(this,this.$container),this.results.bind(this,this.$container)},d.prototype._registerDomEvents=function(){var t=this;this.$element.on("change.select2",function(){t.dataAdapter.current(function(e){t.trigger("selection:update",{data:e})})}),this.$element.on("focus.select2",function(e){t.trigger("focus",e)}),this._syncA=u.bind(this._syncAttributes,this),this._syncS=u.bind(this._syncSubtree,this),this.$element[0].attachEvent&&this.$element[0].attachEvent("onpropertychange",this._syncA);var e=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;null!=e?(this._observer=new e(function(e){r.each(e,t._syncA),r.each(e,t._syncS)}),this._observer.observe(this.$element[0],{attributes:!0,childList:!0,subtree:!1})):this.$element[0].addEventListener&&(this.$element[0].addEventListener("DOMAttrModified",t._syncA,!1),this.$element[0].addEventListener("DOMNodeInserted",t._syncS,!1),this.$element[0].addEventListener("DOMNodeRemoved",t._syncS,!1))},d.prototype._registerDataEvents=function(){var n=this;this.dataAdapter.on("*",function(e,t){n.trigger(e,t)})},d.prototype._registerSelectionEvents=function(){var n=this,i=["toggle","focus"];this.selection.on("toggle",function(){n.toggleDropdown()}),this.selection.on("focus",function(e){n.focus(e)}),this.selection.on("*",function(e,t){-1===r.inArray(e,i)&&n.trigger(e,t)})},d.prototype._registerDropdownEvents=function(){var n=this;this.dropdown.on("*",function(e,t){n.trigger(e,t)})},d.prototype._registerResultsEvents=function(){var n=this;this.results.on("*",function(e,t){n.trigger(e,t)})},d.prototype._registerEvents=function(){var n=this;this.on("open",function(){n.$container.addClass("select2-container--open")}),this.on("close",function(){n.$container.removeClass("select2-container--open")}),this.on("enable",function(){n.$container.removeClass("select2-container--disabled")}),this.on("disable",function(){n.$container.addClass("select2-container--disabled")}),this.on("blur",function(){n.$container.removeClass("select2-container--focus")}),this.on("query",function(t){n.isOpen()||n.trigger("open",{}),this.dataAdapter.query(t,function(e){n.trigger("results:all",{data:e,query:t})})}),this.on("query:append",function(t){this.dataAdapter.query(t,function(e){n.trigger("results:append",{data:e,query:t})})}),this.on("keypress",function(e){var t=e.which;n.isOpen()?t===i.ESC||t===i.TAB||t===i.UP&&e.altKey?(n.close(),e.preventDefault()):t===i.ENTER?(n.trigger("results:select",{}),e.preventDefault()):t===i.SPACE&&e.ctrlKey?(n.trigger("results:toggle",{}),e.preventDefault()):t===i.UP?(n.trigger("results:previous",{}),e.preventDefault()):t===i.DOWN&&(n.trigger("results:next",{}),e.preventDefault()):(t===i.ENTER||t===i.SPACE||t===i.DOWN&&e.altKey)&&(n.open(),e.preventDefault())})},d.prototype._syncAttributes=function(){this.options.set("disabled",this.$element.prop("disabled")),this.options.get("disabled")?(this.isOpen()&&this.close(),this.trigger("disable",{})):this.trigger("enable",{})},d.prototype._syncSubtree=function(e,t){var n=!1,i=this;if(!e||!e.target||"OPTION"===e.target.nodeName||"OPTGROUP"===e.target.nodeName){if(t)if(t.addedNodes&&0<t.addedNodes.length)for(var r=0;r<t.addedNodes.length;r++){t.addedNodes[r].selected&&(n=!0)}else t.removedNodes&&0<t.removedNodes.length&&(n=!0);else n=!0;n&&this.dataAdapter.current(function(e){i.trigger("selection:update",{data:e})})}},d.prototype.trigger=function(e,t){var n=d.__super__.trigger,i={open:"opening",close:"closing",select:"selecting",unselect:"unselecting",clear:"clearing"};if(void 0===t&&(t={}),e in i){var r=i[e],o={prevented:!1,name:e,args:t};if(n.call(this,r,o),o.prevented)return void(t.prevented=!0)}n.call(this,e,t)},d.prototype.toggleDropdown=function(){this.options.get("disabled")||(this.isOpen()?this.close():this.open())},d.prototype.open=function(){this.isOpen()||this.trigger("query",{})},d.prototype.close=function(){this.isOpen()&&this.trigger("close",{})},d.prototype.isOpen=function(){return this.$container.hasClass("select2-container--open")},d.prototype.hasFocus=function(){return this.$container.hasClass("select2-container--focus")},d.prototype.focus=function(e){this.hasFocus()||(this.$container.addClass("select2-container--focus"),this.trigger("focus",{}))},d.prototype.enable=function(e){this.options.get("debug")&&window.console&&console.warn&&console.warn('Select2: The `select2("enable")` method has been deprecated and will be removed in later Select2 versions. Use $element.prop("disabled") instead.'),null!=e&&0!==e.length||(e=[!0]);var t=!e[0];this.$element.prop("disabled",t)},d.prototype.data=function(){this.options.get("debug")&&0<arguments.length&&window.console&&console.warn&&console.warn('Select2: Data can no longer be set using `select2("data")`. You should consider setting the value instead using `$element.val()`.');var t=[];return this.dataAdapter.current(function(e){t=e}),t},d.prototype.val=function(e){if(this.options.get("debug")&&window.console&&console.warn&&console.warn('Select2: The `select2("val")` method has been deprecated and will be removed in later Select2 versions. Use $element.val() instead.'),null==e||0===e.length)return this.$element.val();var t=e[0];r.isArray(t)&&(t=r.map(t,function(e){return e.toString()})),this.$element.val(t).trigger("change")},d.prototype.destroy=function(){this.$container.remove(),this.$element[0].detachEvent&&this.$element[0].detachEvent("onpropertychange",this._syncA),null!=this._observer?(this._observer.disconnect(),this._observer=null):this.$element[0].removeEventListener&&(this.$element[0].removeEventListener("DOMAttrModified",this._syncA,!1),this.$element[0].removeEventListener("DOMNodeInserted",this._syncS,!1),this.$element[0].removeEventListener("DOMNodeRemoved",this._syncS,!1)),this._syncA=null,this._syncS=null,this.$element.off(".select2"),this.$element.attr("tabindex",u.GetData(this.$element[0],"old-tabindex")),this.$element.removeClass("select2-hidden-accessible"),this.$element.attr("aria-hidden","false"),u.RemoveData(this.$element[0]),this.$element.removeData("select2"),this.dataAdapter.destroy(),this.selection.destroy(),this.dropdown.destroy(),this.results.destroy(),this.dataAdapter=null,this.selection=null,this.dropdown=null,this.results=null},d.prototype.render=function(){var e=r('<span class="select2 select2-container"><span class="selection"></span><span class="dropdown-wrapper" aria-hidden="true"></span></span>');return e.attr("dir",this.options.get("dir")),this.$container=e,this.$container.addClass("select2-container--"+this.options.get("theme")),u.StoreData(e[0],"element",this.$element),e},d}),e.define("select2/compat/utils",["jquery"],function(s){return{syncCssClasses:function(e,t,n){var i,r,o=[];(i=s.trim(e.attr("class")))&&s((i=""+i).split(/\s+/)).each(function(){0===this.indexOf("select2-")&&o.push(this)}),(i=s.trim(t.attr("class")))&&s((i=""+i).split(/\s+/)).each(function(){0!==this.indexOf("select2-")&&null!=(r=n(this))&&o.push(r)}),e.attr("class",o.join(" "))}}}),e.define("select2/compat/containerCss",["jquery","./utils"],function(s,a){function l(e){return null}function e(){}return e.prototype.render=function(e){var t=e.call(this),n=this.options.get("containerCssClass")||"";s.isFunction(n)&&(n=n(this.$element));var i=this.options.get("adaptContainerCssClass");if(i=i||l,-1!==n.indexOf(":all:")){n=n.replace(":all:","");var r=i;i=function(e){var t=r(e);return null!=t?t+" "+e:e}}var o=this.options.get("containerCss")||{};return s.isFunction(o)&&(o=o(this.$element)),a.syncCssClasses(t,this.$element,i),t.css(o),t.addClass(n),t},e}),e.define("select2/compat/dropdownCss",["jquery","./utils"],function(s,a){function l(e){return null}function e(){}return e.prototype.render=function(e){var t=e.call(this),n=this.options.get("dropdownCssClass")||"";s.isFunction(n)&&(n=n(this.$element));var i=this.options.get("adaptDropdownCssClass");if(i=i||l,-1!==n.indexOf(":all:")){n=n.replace(":all:","");var r=i;i=function(e){var t=r(e);return null!=t?t+" "+e:e}}var o=this.options.get("dropdownCss")||{};return s.isFunction(o)&&(o=o(this.$element)),a.syncCssClasses(t,this.$element,i),t.css(o),t.addClass(n),t},e}),e.define("select2/compat/initSelection",["jquery"],function(i){function e(e,t,n){n.get("debug")&&window.console&&console.warn&&console.warn("Select2: The `initSelection` option has been deprecated in favor of a custom data adapter that overrides the `current` method. This method is now called multiple times instead of a single time when the instance is initialized. Support will be removed for the `initSelection` option in future versions of Select2"),this.initSelection=n.get("initSelection"),this._isInitialized=!1,e.call(this,t,n)}return e.prototype.current=function(e,t){var n=this;this._isInitialized?e.call(this,t):this.initSelection.call(null,this.$element,function(e){n._isInitialized=!0,i.isArray(e)||(e=[e]),t(e)})},e}),e.define("select2/compat/inputData",["jquery","../utils"],function(s,i){function e(e,t,n){this._currentData=[],this._valueSeparator=n.get("valueSeparator")||",","hidden"===t.prop("type")&&n.get("debug")&&console&&console.warn&&console.warn("Select2: Using a hidden input with Select2 is no longer supported and may stop working in the future. It is recommended to use a `<select>` element instead."),e.call(this,t,n)}return e.prototype.current=function(e,t){function i(e,t){var n=[];return e.selected||-1!==s.inArray(e.id,t)?(e.selected=!0,n.push(e)):e.selected=!1,e.children&&n.push.apply(n,i(e.children,t)),n}for(var n=[],r=0;r<this._currentData.length;r++){var o=this._currentData[r];n.push.apply(n,i(o,this.$element.val().split(this._valueSeparator)))}t(n)},e.prototype.select=function(e,t){if(this.options.get("multiple")){var n=this.$element.val();n+=this._valueSeparator+t.id,this.$element.val(n),this.$element.trigger("change")}else this.current(function(e){s.map(e,function(e){e.selected=!1})}),this.$element.val(t.id),this.$element.trigger("change")},e.prototype.unselect=function(e,r){var o=this;r.selected=!1,this.current(function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];r.id!=i.id&&t.push(i.id)}o.$element.val(t.join(o._valueSeparator)),o.$element.trigger("change")})},e.prototype.query=function(e,t,n){for(var i=[],r=0;r<this._currentData.length;r++){var o=this._currentData[r],s=this.matches(t,o);null!==s&&i.push(s)}n({results:i})},e.prototype.addOptions=function(e,t){var n=s.map(t,function(e){return i.GetData(e[0],"data")});this._currentData.push.apply(this._currentData,n)},e}),e.define("select2/compat/matcher",["jquery"],function(s){return function(o){return function(e,t){var n=s.extend(!0,{},t);if(null==e.term||""===s.trim(e.term))return n;if(t.children){for(var i=t.children.length-1;0<=i;i--){var r=t.children[i];o(e.term,r.text,r)||n.children.splice(i,1)}if(0<n.children.length)return n}return o(e.term,t.text,t)?n:null}}}),e.define("select2/compat/query",[],function(){function e(e,t,n){n.get("debug")&&window.console&&console.warn&&console.warn("Select2: The `query` option has been deprecated in favor of a custom data adapter that overrides the `query` method. Support will be removed for the `query` option in future versions of Select2."),e.call(this,t,n)}return e.prototype.query=function(e,t,n){t.callback=n,this.options.get("query").call(null,t)},e}),e.define("select2/dropdown/attachContainer",[],function(){function e(e,t,n){e.call(this,t,n)}return e.prototype.position=function(e,t,n){n.find(".dropdown-wrapper").append(t),t.addClass("select2-dropdown--below"),n.addClass("select2-container--below")},e}),e.define("select2/dropdown/stopPropagation",[],function(){function e(){}return e.prototype.bind=function(e,t,n){e.call(this,t,n);this.$dropdown.on(["blur","change","click","dblclick","focus","focusin","focusout","input","keydown","keyup","keypress","mousedown","mouseenter","mouseleave","mousemove","mouseover","mouseup","search","touchend","touchstart"].join(" "),function(e){e.stopPropagation()})},e}),e.define("select2/selection/stopPropagation",[],function(){function e(){}return e.prototype.bind=function(e,t,n){e.call(this,t,n);this.$selection.on(["blur","change","click","dblclick","focus","focusin","focusout","input","keydown","keyup","keypress","mousedown","mouseenter","mouseleave","mousemove","mouseover","mouseup","search","touchend","touchstart"].join(" "),function(e){e.stopPropagation()})},e}),l=function(p){var h,f,e=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],t="onwheel"in document||9<=document.documentMode?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],g=Array.prototype.slice;if(p.event.fixHooks)for(var n=e.length;n;)p.event.fixHooks[e[--n]]=p.event.mouseHooks;var m=p.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var e=t.length;e;)this.addEventListener(t[--e],i,!1);else this.onmousewheel=i;p.data(this,"mousewheel-line-height",m.getLineHeight(this)),p.data(this,"mousewheel-page-height",m.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var e=t.length;e;)this.removeEventListener(t[--e],i,!1);else this.onmousewheel=null;p.removeData(this,"mousewheel-line-height"),p.removeData(this,"mousewheel-page-height")},getLineHeight:function(e){var t=p(e),n=t["offsetParent"in p.fn?"offsetParent":"parent"]();return n.length||(n=p("body")),parseInt(n.css("fontSize"),10)||parseInt(t.css("fontSize"),10)||16},getPageHeight:function(e){return p(e).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};function i(e){var t,n=e||window.event,i=g.call(arguments,1),r=0,o=0,s=0,a=0,l=0;if((e=p.event.fix(n)).type="mousewheel","detail"in n&&(s=-1*n.detail),"wheelDelta"in n&&(s=n.wheelDelta),"wheelDeltaY"in n&&(s=n.wheelDeltaY),"wheelDeltaX"in n&&(o=-1*n.wheelDeltaX),"axis"in n&&n.axis===n.HORIZONTAL_AXIS&&(o=-1*s,s=0),r=0===s?o:s,"deltaY"in n&&(r=s=-1*n.deltaY),"deltaX"in n&&(o=n.deltaX,0===s&&(r=-1*o)),0!==s||0!==o){if(1===n.deltaMode){var c=p.data(this,"mousewheel-line-height");r*=c,s*=c,o*=c}else if(2===n.deltaMode){var u=p.data(this,"mousewheel-page-height");r*=u,s*=u,o*=u}if(t=Math.max(Math.abs(s),Math.abs(o)),(!f||t<f)&&y(n,f=t)&&(f/=40),y(n,t)&&(r/=40,o/=40,s/=40),r=Math[1<=r?"floor":"ceil"](r/f),o=Math[1<=o?"floor":"ceil"](o/f),s=Math[1<=s?"floor":"ceil"](s/f),m.settings.normalizeOffset&&this.getBoundingClientRect){var d=this.getBoundingClientRect();a=e.clientX-d.left,l=e.clientY-d.top}return e.deltaX=o,e.deltaY=s,e.deltaFactor=f,e.offsetX=a,e.offsetY=l,e.deltaMode=0,i.unshift(e,r,o,s),h&&clearTimeout(h),h=setTimeout(v,200),(p.event.dispatch||p.event.handle).apply(this,i)}}function v(){f=null}function y(e,t){return m.settings.adjustOldDeltas&&"mousewheel"===e.type&&t%120==0}p.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})},"function"==typeof e.define&&e.define.amd?e.define("jquery-mousewheel",["jquery"],l):"object"==typeof exports?module.exports=l:l(d),e.define("jquery.select2",["jquery","jquery-mousewheel","./select2/core","./select2/defaults","./select2/utils"],function(r,e,o,t,s){if(null==r.fn.select2){var a=["open","close","destroy"];r.fn.select2=function(t){if("object"==typeof(t=t||{}))return this.each(function(){var e=r.extend(!0,{},t);new o(r(this),e)}),this;if("string"!=typeof t)throw new Error("Invalid arguments for Select2: "+t);var n,i=Array.prototype.slice.call(arguments,1);return this.each(function(){var e=s.GetData(this,"select2");null==e&&window.console&&console.error&&console.error("The select2('"+t+"') method was called on an element that is not using Select2."),n=e[t].apply(e,i)}),-1<r.inArray(t,a)?this:n}}return null==r.fn.select2.defaults&&(r.fn.select2.defaults=t),o}),{define:e.define,require:e.require}}(),t=e.require("jquery.select2");return d.fn.select2.amd=e,t});
;(function ( $, window, undefined ) {

    /** Default settings */
    var defaults = {
        active: null,
        event: 'click',
        disabled: [],
        collapsible: 'accordion',
        startCollapsed: false,
        rotate: false,
        setHash: false,
        animation: 'default',
        animationQueue: false,
        duration: 500,
        fluidHeight: true,
        scrollToAccordion: false,
        scrollToAccordionOnLoad: true,
        scrollToAccordionOffset: 0,
        accordionTabElement: '<div></div>',
        navigationContainer: '',
        click: function(){},
        activate: function(){},
        deactivate: function(){},
        load: function(){},
        activateState: function(){},
        classes: {
            stateDefault: 'r-tabs-state-default',
            stateActive: 'r-tabs-state-active',
            stateDisabled: 'r-tabs-state-disabled',
            stateExcluded: 'r-tabs-state-excluded',
            container: 'r-tabs',
            ul: 'r-tabs-nav',
            tab: 'r-tabs-tab',
            anchor: 'r-tabs-anchor',
            panel: 'r-tabs-panel',
            accordionTitle: 'r-tabs-accordion-title'
        }
    };

    /**
     * Responsive Tabs
     * @constructor
     * @param {object} element - The HTML element the validator should be bound to
     * @param {object} options - An option map
     */
    function ResponsiveTabs(element, options) {
        this.element = element; // Selected DOM element
        this.$element = $(element); // Selected jQuery element

        this.tabs = []; // Create tabs array
        this.state = ''; // Define the plugin state (tabs/accordion)
        this.rotateInterval = 0; // Define rotate interval
        this.$queue = $({});

        // Extend the defaults with the passed options
        this.options = $.extend( {}, defaults, options);

        this.init();
    }


    /**
     * This function initializes the tab plugin
     */
    ResponsiveTabs.prototype.init = function () {
        var _this = this;

        // Load all the elements
        this.tabs = this._loadElements();
        this._loadClasses();
        this._loadEvents();

        // Window resize bind to check state
        $(window).on('resize', function(e) {
            _this._setState(e);
            if(_this.options.fluidHeight !== true) {
                _this._equaliseHeights();
            }
        });

        // Hashchange event
        $(window).on('hashchange', function(e) {
            var tabRef = _this._getTabRefBySelector(window.location.hash);
            var oTab = _this._getTab(tabRef);

            // Check if a tab is found that matches the hash
            if(tabRef >= 0 && !oTab._ignoreHashChange && !oTab.disabled) {
                // If so, open the tab and auto close the current one
                _this._openTab(e, _this._getTab(tabRef), true);
            }
        });

        // Start rotate event if rotate option is defined
        if(this.options.rotate !== false) {
            this.startRotation();
        }

        // Set fluid height
        if(this.options.fluidHeight !== true) {
            _this._equaliseHeights();
        }

        // --------------------
        // Define plugin events
        //

        // Activate: this event is called when a tab is selected
        this.$element.bind('tabs-click', function(e, oTab) {
            _this.options.click.call(this, e, oTab);
        });

        // Activate: this event is called when a tab is selected
        this.$element.bind('tabs-activate', function(e, oTab) {
            _this.options.activate.call(this, e, oTab);
        });
        // Deactivate: this event is called when a tab is closed
        this.$element.bind('tabs-deactivate', function(e, oTab) {
            _this.options.deactivate.call(this, e, oTab);
        });
        // Activate State: this event is called when the plugin switches states
        this.$element.bind('tabs-activate-state', function(e, state) {
            _this.options.activateState.call(this, e, state);
        });

        // Load: this event is called when the plugin has been loaded
        this.$element.bind('tabs-load', function(e) {
            var startTab;

            _this._setState(e); // Set state

            // Check if the panel should be collaped on load
            if(_this.options.startCollapsed !== true && !(_this.options.startCollapsed === 'accordion' && _this.state === 'accordion')) {

                startTab = _this._getStartTab();

                // Open the initial tab
                _this._openTab(e, startTab); // Open first tab

                // Call the callback function
                _this.options.load.call(this, e, startTab); // Call the load callback
            }
        });
        // Trigger loaded event
        this.$element.trigger('tabs-load');
    };

    //
    // PRIVATE FUNCTIONS
    //

    /**
     * This function loads the tab elements and stores them in an array
     * @returns {Array} Array of tab elements
     */
    ResponsiveTabs.prototype._loadElements = function() {
        var _this = this;
        var $ul = (_this.options.navigationContainer === '') ? this.$element.children('ul:first') : this.$element.find(_this.options.navigationContainer).children('ul:first');
        var tabs = [];
        var id = 0;

        // Add the classes to the basic html elements
        this.$element.addClass(_this.options.classes.container); // Tab container
        $ul.addClass(_this.options.classes.ul); // List container

        // Get tab buttons and store their data in an array
        $('li', $ul).each(function() {
            var $tab = $(this);
            var isExcluded = $tab.hasClass(_this.options.classes.stateExcluded);
            var $anchor, $panel, $accordionTab, $accordionAnchor, panelSelector;

            // Check if the tab should be excluded
            if(!isExcluded) {

                $anchor = $('a', $tab);
                panelSelector = $anchor.attr('href');
                $panel = $(panelSelector);
                $accordionTab = $(_this.options.accordionTabElement).insertBefore($panel);
                $accordionAnchor = $('<a></a>').attr('href', panelSelector).html($anchor.html()).appendTo($accordionTab);

                var oTab = {
                    _ignoreHashChange: false,
                    id: id,
                    disabled: ($.inArray(id, _this.options.disabled) !== -1),
                    tab: $(this),
                    anchor: $('a', $tab),
                    panel: $panel,
                    selector: panelSelector,
                    accordionTab: $accordionTab,
                    accordionAnchor: $accordionAnchor,
                    active: false
                };

                // 1up the ID
                id++;
                // Add to tab array
                tabs.push(oTab);
            }
        });
        return tabs;
    };


    /**
     * This function adds classes to the tab elements based on the options
     */
    ResponsiveTabs.prototype._loadClasses = function() {
        for (var i=0; i<this.tabs.length; i++) {
            this.tabs[i].tab.addClass(this.options.classes.stateDefault).addClass(this.options.classes.tab);
            this.tabs[i].anchor.addClass(this.options.classes.anchor);
            this.tabs[i].panel.addClass(this.options.classes.stateDefault).addClass(this.options.classes.panel);
            this.tabs[i].accordionTab.addClass(this.options.classes.accordionTitle);
            this.tabs[i].accordionAnchor.addClass(this.options.classes.anchor);
            if(this.tabs[i].disabled) {
                this.tabs[i].tab.removeClass(this.options.classes.stateDefault).addClass(this.options.classes.stateDisabled);
                this.tabs[i].accordionTab.removeClass(this.options.classes.stateDefault).addClass(this.options.classes.stateDisabled);
            }
        }
    };

    /**
     * This function adds events to the tab elements
     */
    ResponsiveTabs.prototype._loadEvents = function() {
        var _this = this;

        // Define activate event on a tab element
        var fActivate = function(e) {
            var current = _this._getCurrentTab(); // Fetch current tab
            var activatedTab = e.data.tab;

            e.preventDefault();

            // Trigger click event for whenever a tab is clicked/touched even if the tab is disabled
            activatedTab.tab.trigger('tabs-click', activatedTab);

            // Make sure this tab isn't disabled
            if(!activatedTab.disabled) {

                // Check if hash has to be set in the URL location
                if(_this.options.setHash) {
                    // Set the hash using the history api if available to tackle Chromes repaint bug on hash change
                    if(history.pushState) {
                        // Fix for missing window.location.origin in IE
                        if (!window.location.origin) {
                            window.location.origin = window.location.protocol + "//" + window.location.hostname + (window.location.port ? ':' + window.location.port: '');
                        }

                        history.pushState(null, null, window.location.origin + window.location.pathname + window.location.search + activatedTab.selector);
                    } else {
                        // Otherwise fallback to the hash update for sites that don't support the history api
                        window.location.hash = activatedTab.selector;
                    }
                }

                e.data.tab._ignoreHashChange = true;

                // Check if the activated tab isnt the current one or if its collapsible. If not, do nothing
                if(current !== activatedTab || _this._isCollapisble()) {
                    // The activated tab is either another tab of the current one. If it's the current tab it is collapsible
                    // Either way, the current tab can be closed
                    _this._closeTab(e, current);

                    // Check if the activated tab isnt the current one or if it isnt collapsible
                    if(current !== activatedTab || !_this._isCollapisble()) {
                        _this._openTab(e, activatedTab, false, true);
                    }
                }
            }
        };

        // Loop tabs
        for (var i=0; i<this.tabs.length; i++) {
            // Add activate function to the tab and accordion selection element
            this.tabs[i].anchor.on(_this.options.event, {tab: _this.tabs[i]}, fActivate);
            this.tabs[i].accordionAnchor.on(_this.options.event, {tab: _this.tabs[i]}, fActivate);
        }
    };

    /**
     * This function gets the tab that should be opened at start
     * @returns {Object} Tab object
     */
    ResponsiveTabs.prototype._getStartTab = function() {
        var tabRef = this._getTabRefBySelector(window.location.hash);
        var startTab;

        // Check if the page has a hash set that is linked to a tab
        if(tabRef >= 0 && !this._getTab(tabRef).disabled) {
            // If so, set the current tab to the linked tab
            startTab = this._getTab(tabRef);
        } else if(this.options.active > 0 && !this._getTab(this.options.active).disabled) {
            startTab = this._getTab(this.options.active);
        } else {
            // If not, just get the first one
            startTab = this._getTab(0);
        }

        return startTab;
    };

    /**
     * This function sets the current state of the plugin
     * @param {Event} e - The event that triggers the state change
     */
    ResponsiveTabs.prototype._setState = function(e) {
        var $ul = $('ul:first', this.$element);
        var oldState = this.state;
        var startCollapsedIsState = (typeof this.options.startCollapsed === 'string');
        var startTab;

        // The state is based on the visibility of the tabs list
        if($ul.is(':visible')){
            // Tab list is visible, so the state is 'tabs'
            this.state = 'tabs';
        } else {
            // Tab list is invisible, so the state is 'accordion'
            this.state = 'accordion';
        }

        // If the new state is different from the old state
        if(this.state !== oldState) {
            // If so, the state activate trigger must be called
            this.$element.trigger('tabs-activate-state', {oldState: oldState, newState: this.state});

            // Check if the state switch should open a tab
            if(oldState && startCollapsedIsState && this.options.startCollapsed !== this.state && this._getCurrentTab() === undefined) {
                // Get initial tab
                startTab = this._getStartTab(e);
                // Open the initial tab
                this._openTab(e, startTab); // Open first tab
            }
        }
    };

    /**
     * This function opens a tab
     * @param {Event} e - The event that triggers the tab opening
     * @param {Object} oTab - The tab object that should be opened
     * @param {Boolean} closeCurrent - Defines if the current tab should be closed
     * @param {Boolean} stopRotation - Defines if the tab rotation loop should be stopped
     */
    ResponsiveTabs.prototype._openTab = function(e, oTab, closeCurrent, stopRotation) {
        var _this = this;
        var scrollOffset;

        // Check if the current tab has to be closed
        if(closeCurrent) {
            this._closeTab(e, this._getCurrentTab());
        }

        // Check if the rotation has to be stopped when activated
        if(stopRotation && this.rotateInterval > 0) {
            this.stopRotation();
        }

        // Set this tab to active
        oTab.active = true;
        // Set active classes to the tab button and accordion tab button
        oTab.tab.removeClass(_this.options.classes.stateDefault).addClass(_this.options.classes.stateActive);
        oTab.accordionTab.removeClass(_this.options.classes.stateDefault).addClass(_this.options.classes.stateActive);

        // Run panel transiton
        _this._doTransition(oTab.panel, _this.options.animation, 'open', function() {
            var scrollOnLoad = (e.type !== 'tabs-load' || _this.options.scrollToAccordionOnLoad);

            // When finished, set active class to the panel
            oTab.panel.removeClass(_this.options.classes.stateDefault).addClass(_this.options.classes.stateActive);

            // And if enabled and state is accordion, scroll to the accordion tab
            if(_this.getState() === 'accordion' && _this.options.scrollToAccordion && (!_this._isInView(oTab.accordionTab) || _this.options.animation !== 'default') && scrollOnLoad) {

                // Add offset element's height to scroll position
                scrollOffset = oTab.accordionTab.offset().top - _this.options.scrollToAccordionOffset;

                // Check if the animation option is enabled, and if the duration isn't 0
                if(_this.options.animation !== 'default' && _this.options.duration > 0) {
                    // If so, set scrollTop with animate and use the 'animation' duration
                    $('html, body').animate({
                        scrollTop: scrollOffset
                    }, _this.options.duration);
                } else {
                    //  If not, just set scrollTop
                    $('html, body').scrollTop(scrollOffset);
                }
            }
        });

        this.$element.trigger('tabs-activate', oTab);
    };

    /**
     * This function closes a tab
     * @param {Event} e - The event that is triggered when a tab is closed
     * @param {Object} oTab - The tab object that should be closed
     */
    ResponsiveTabs.prototype._closeTab = function(e, oTab) {
        var _this = this;
        var doQueueOnState = typeof _this.options.animationQueue === 'string';
        var doQueue;

        if(oTab !== undefined) {
            if(doQueueOnState && _this.getState() === _this.options.animationQueue) {
                doQueue = true;
            } else if(doQueueOnState) {
                doQueue = false;
            } else {
                doQueue = _this.options.animationQueue;
            }

            // Deactivate tab
            oTab.active = false;
            // Set default class to the tab button
            oTab.tab.removeClass(_this.options.classes.stateActive).addClass(_this.options.classes.stateDefault);

            // Run panel transition
            _this._doTransition(oTab.panel, _this.options.animation, 'close', function() {
                // Set default class to the accordion tab button and tab panel
                oTab.accordionTab.removeClass(_this.options.classes.stateActive).addClass(_this.options.classes.stateDefault);
                oTab.panel.removeClass(_this.options.classes.stateActive).addClass(_this.options.classes.stateDefault);
            }, !doQueue);

            this.$element.trigger('tabs-deactivate', oTab);
        }
    };

    /**
     * This function runs an effect on a panel
     * @param {Element} panel - The HTML element of the tab panel
     * @param {String} method - The transition method reference
     * @param {String} state - The state (open/closed) that the panel should transition to
     * @param {Function} callback - The callback function that is called after the transition
     * @param {Boolean} dequeue - Defines if the event queue should be dequeued after the transition
     */
    ResponsiveTabs.prototype._doTransition = function(panel, method, state, callback, dequeue) {
        var effect;
        var _this = this;

        // Get effect based on method
        switch(method) {
            case 'slide':
                effect = (state === 'open') ? 'slideDown' : 'slideUp';
                break;
            case 'fade':
                effect = (state === 'open') ? 'fadeIn' : 'fadeOut';
                break;
            default:
                effect = (state === 'open') ? 'show' : 'hide';
                // When default is used, set the duration to 0
                _this.options.duration = 0;
                break;
        }

        // Add the transition to a custom queue
        this.$queue.queue('responsive-tabs',function(next){
            // Run the transition on the panel
            panel[effect]({
                duration: _this.options.duration,
                complete: function() {
                    // Call the callback function
                    callback.call(panel, method, state);
                    // Run the next function in the queue
                    next();
                }
            });
        });

        // When the panel is openend, dequeue everything so the animation starts
        if(state === 'open' || dequeue) {
            this.$queue.dequeue('responsive-tabs');
        }

    };

    /**
     * This function returns the collapsibility of the tab in this state
     * @returns {Boolean} The collapsibility of the tab
     */
    ResponsiveTabs.prototype._isCollapisble = function() {
        return (typeof this.options.collapsible === 'boolean' && this.options.collapsible) || (typeof this.options.collapsible === 'string' && this.options.collapsible === this.getState());
    };

    /**
     * This function returns a tab by numeric reference
     * @param {Integer} numRef - Numeric tab reference
     * @returns {Object} Tab object
     */
    ResponsiveTabs.prototype._getTab = function(numRef) {
        return this.tabs[numRef];
    };

    /**
     * This function returns the numeric tab reference based on a hash selector
     * @param {String} selector - Hash selector
     * @returns {Integer} Numeric tab reference
     */
    ResponsiveTabs.prototype._getTabRefBySelector = function(selector) {
        // Loop all tabs
        for (var i=0; i<this.tabs.length; i++) {
            // Check if the hash selector is equal to the tab selector
            if(this.tabs[i].selector === selector) {
                return i;
            }
        }
        // If none is found return a negative index
        return -1;
    };

    /**
     * This function returns the current tab element
     * @returns {Object} Current tab element
     */
    ResponsiveTabs.prototype._getCurrentTab = function() {
        return this._getTab(this._getCurrentTabRef());
    };

    /**
     * This function returns the next tab's numeric reference
     * @param {Integer} currentTabRef - Current numeric tab reference
     * @returns {Integer} Numeric tab reference
     */
    ResponsiveTabs.prototype._getNextTabRef = function(currentTabRef) {
        var tabRef = (currentTabRef || this._getCurrentTabRef());
        var nextTabRef = (tabRef === this.tabs.length - 1) ? 0 : tabRef + 1;
        return (this._getTab(nextTabRef).disabled) ? this._getNextTabRef(nextTabRef) : nextTabRef;
    };

    /**
     * This function returns the previous tab's numeric reference
     * @returns {Integer} Numeric tab reference
     */
    ResponsiveTabs.prototype._getPreviousTabRef = function() {
        return (this._getCurrentTabRef() === 0) ? this.tabs.length - 1 : this._getCurrentTabRef() - 1;
    };

    /**
     * This function returns the current tab's numeric reference
     * @returns {Integer} Numeric tab reference
     */
    ResponsiveTabs.prototype._getCurrentTabRef = function() {
        // Loop all tabs
        for (var i=0; i<this.tabs.length; i++) {
            // If this tab is active, return it
            if(this.tabs[i].active) {
                return i;
            }
        }
        // No tabs have been found, return negative index
        return -1;
    };

    /**
     * This function gets the tallest tab and applied the height to all tabs
     */
    ResponsiveTabs.prototype._equaliseHeights = function() {
        var maxHeight = 0;

        $.each($.map(this.tabs, function(tab) {
            maxHeight = Math.max(maxHeight, tab.panel.css('minHeight', '').height());
            return tab.panel;
        }), function() {
            this.css('minHeight', maxHeight);
        });
    };

    //
    // HELPER FUNCTIONS
    //

    ResponsiveTabs.prototype._isInView = function($element) {
        var docViewTop = $(window).scrollTop(),
            docViewBottom = docViewTop + $(window).height(),
            elemTop = $element.offset().top,
            elemBottom = elemTop + $element.height();
        return ((elemBottom <= docViewBottom) && (elemTop >= docViewTop));
    };

    //
    // PUBLIC FUNCTIONS
    //

    /**
     * This function activates a tab
     * @param {Integer} tabRef - Numeric tab reference
     * @param {Boolean} stopRotation - Defines if the tab rotation should stop after activation
     */
    ResponsiveTabs.prototype.activate = function(tabRef, stopRotation) {
        var e = jQuery.Event('tabs-activate');
        var oTab = this._getTab(tabRef);
        if(!oTab.disabled) {
            this._openTab(e, oTab, true, stopRotation || true);
        }
    };

    /**
     * This function deactivates a tab
     * @param {Integer} tabRef - Numeric tab reference
     */
    ResponsiveTabs.prototype.deactivate = function(tabRef) {
        var e = jQuery.Event('tabs-dectivate');
        var oTab = this._getTab(tabRef);
        if(!oTab.disabled) {
            this._closeTab(e, oTab);
        }
    };

    /**
     * This function enables a tab
     * @param {Integer} tabRef - Numeric tab reference
     */
    ResponsiveTabs.prototype.enable = function(tabRef) {
        var oTab = this._getTab(tabRef);
        if(oTab){
            oTab.disabled = false;
            oTab.tab.addClass(this.options.classes.stateDefault).removeClass(this.options.classes.stateDisabled);
            oTab.accordionTab.addClass(this.options.classes.stateDefault).removeClass(this.options.classes.stateDisabled);
        }
    };

    /**
     * This function disable a tab
     * @param {Integer} tabRef - Numeric tab reference
     */
    ResponsiveTabs.prototype.disable = function(tabRef) {
        var oTab = this._getTab(tabRef);
        if(oTab){
            oTab.disabled = true;
            oTab.tab.removeClass(this.options.classes.stateDefault).addClass(this.options.classes.stateDisabled);
            oTab.accordionTab.removeClass(this.options.classes.stateDefault).addClass(this.options.classes.stateDisabled);
        }
    };

    /**
     * This function gets the current state of the plugin
     * @returns {String} State of the plugin
     */
    ResponsiveTabs.prototype.getState = function() {
        return this.state;
    };

    /**
     * This function starts the rotation of the tabs
     * @param {Integer} speed - The speed of the rotation
     */
    ResponsiveTabs.prototype.startRotation = function(speed) {
        var _this = this;
        // Make sure not all tabs are disabled
        if(this.tabs.length > this.options.disabled.length) {
            this.rotateInterval = setInterval(function(){
                var e = jQuery.Event('rotate');
                _this._openTab(e, _this._getTab(_this._getNextTabRef()), true);
            }, speed || (($.isNumeric(_this.options.rotate)) ? _this.options.rotate : 4000) );
        } else {
            throw new Error("Rotation is not possible if all tabs are disabled");
        }
    };

    /**
     * This function stops the rotation of the tabs
     */
    ResponsiveTabs.prototype.stopRotation = function() {
        window.clearInterval(this.rotateInterval);
        this.rotateInterval = 0;
    };

    /**
     * This function can be used to get/set options
     * @return {any} Option value
     */
    ResponsiveTabs.prototype.option = function(key, value) {
        if(value) {
            this.options[key] = value;
        }
        return this.options[key];
    };

    /** jQuery wrapper */
    $.fn.responsiveTabs = function ( options ) {
        var args = arguments;
        var instance;

        if (options === undefined || typeof options === 'object') {
            return this.each(function () {
                if (!$.data(this, 'responsivetabs')) {
                    $.data(this, 'responsivetabs', new ResponsiveTabs( this, options ));
                }
            });
        } else if (typeof options === 'string' && options[0] !== '_' && options !== 'init') {
            instance = $.data(this[0], 'responsivetabs');

            // Allow instances to be destroyed via the 'destroy' method
            if (options === 'destroy') {
                // TODO: destroy instance classes, etc
                $.data(this, 'responsivetabs', null);
            }

            if (instance instanceof ResponsiveTabs && typeof instance[options] === 'function') {
                return instance[options].apply( instance, Array.prototype.slice.call( args, 1 ) );
            } else {
                return this;
            }
        }
    };

}(jQuery, window));

/*! jQuery UI - v1.12.1 - 2016-09-14
* http://jqueryui.com
* Includes: widget.js, position.js, data.js, disable-selection.js, effect.js, effects/effect-blind.js, effects/effect-bounce.js, effects/effect-clip.js, effects/effect-drop.js, effects/effect-explode.js, effects/effect-fade.js, effects/effect-fold.js, effects/effect-highlight.js, effects/effect-puff.js, effects/effect-pulsate.js, effects/effect-scale.js, effects/effect-shake.js, effects/effect-size.js, effects/effect-slide.js, effects/effect-transfer.js, focusable.js, form-reset-mixin.js, jquery-1-7.js, keycode.js, labels.js, scroll-parent.js, tabbable.js, unique-id.js, widgets/accordion.js, widgets/autocomplete.js, widgets/button.js, widgets/checkboxradio.js, widgets/controlgroup.js, widgets/datepicker.js, widgets/dialog.js, widgets/draggable.js, widgets/droppable.js, widgets/menu.js, widgets/mouse.js, widgets/progressbar.js, widgets/resizable.js, widgets/selectable.js, widgets/selectmenu.js, widgets/slider.js, widgets/sortable.js, widgets/spinner.js, widgets/tabs.js, widgets/tooltip.js
* Copyright jQuery Foundation and other contributors; Licensed MIT */

(function (factory) {
    if (typeof define === "function" && define.amd) {

        // AMD. Register as an anonymous module.
        define(["jquery"], factory);
    } else {

        // Browser globals
        factory(jQuery);
    }
}(function ($) {

    $.ui = $.ui || {};

    var version = $.ui.version = "1.12.1";


    /*!
 * jQuery UI Widget 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Widget
//>>group: Core
//>>description: Provides a factory for creating stateful widgets with a common API.
//>>docs: http://api.jqueryui.com/jQuery.widget/
//>>demos: http://jqueryui.com/widget/


    var widgetUuid = 0;
    var widgetSlice = Array.prototype.slice;

    $.cleanData = (function (orig) {
        return function (elems) {
            var events, elem, i;
            for (i = 0; (elem = elems[i]) != null; i++) {
                try {

                    // Only trigger remove when necessary to save time
                    events = $._data(elem, "events");
                    if (events && events.remove) {
                        $(elem).triggerHandler("remove");
                    }

                    // Http://bugs.jquery.com/ticket/8235
                } catch (e) {
                }
            }
            orig(elems);
        };
    })($.cleanData);

    $.widget = function (name, base, prototype) {
        var existingConstructor, constructor, basePrototype;

        // ProxiedPrototype allows the provided prototype to remain unmodified
        // so that it can be used as a mixin for multiple widgets (#8876)
        var proxiedPrototype = {};

        var namespace = name.split(".")[0];
        name = name.split(".")[1];
        var fullName = namespace + "-" + name;

        if (!prototype) {
            prototype = base;
            base = $.Widget;
        }

        if ($.isArray(prototype)) {
            prototype = $.extend.apply(null, [{}].concat(prototype));
        }

        // Create selector for plugin
        $.expr[":"][fullName.toLowerCase()] = function (elem) {
            return !!$.data(elem, fullName);
        };

        $[namespace] = $[namespace] || {};
        existingConstructor = $[namespace][name];
        constructor = $[namespace][name] = function (options, element) {

            // Allow instantiation without "new" keyword
            if (!this._createWidget) {
                return new constructor(options, element);
            }

            // Allow instantiation without initializing for simple inheritance
            // must use "new" keyword (the code above always passes args)
            if (arguments.length) {
                this._createWidget(options, element);
            }
        };

        // Extend with the existing constructor to carry over any static properties
        $.extend(constructor, existingConstructor, {
            version: prototype.version,

            // Copy the object used to create the prototype in case we need to
            // redefine the widget later
            _proto: $.extend({}, prototype),

            // Track widgets that inherit from this widget in case this widget is
            // redefined after a widget inherits from it
            _childConstructors: []
        });

        basePrototype = new base();

        // We need to make the options hash a property directly on the new instance
        // otherwise we'll modify the options hash on the prototype that we're
        // inheriting from
        basePrototype.options = $.widget.extend({}, basePrototype.options);
        $.each(prototype, function (prop, value) {
            if (!$.isFunction(value)) {
                proxiedPrototype[prop] = value;
                return;
            }
            proxiedPrototype[prop] = (function () {
                function _super() {
                    return base.prototype[prop].apply(this, arguments);
                }

                function _superApply(args) {
                    return base.prototype[prop].apply(this, args);
                }

                return function () {
                    var __super = this._super;
                    var __superApply = this._superApply;
                    var returnValue;

                    this._super = _super;
                    this._superApply = _superApply;

                    returnValue = value.apply(this, arguments);

                    this._super = __super;
                    this._superApply = __superApply;

                    return returnValue;
                };
            })();
        });
        constructor.prototype = $.widget.extend(basePrototype, {

            // TODO: remove support for widgetEventPrefix
            // always use the name + a colon as the prefix, e.g., draggable:start
            // don't prefix for widgets that aren't DOM-based
            widgetEventPrefix: existingConstructor ? (basePrototype.widgetEventPrefix || name) : name
        }, proxiedPrototype, {
            constructor: constructor,
            namespace: namespace,
            widgetName: name,
            widgetFullName: fullName
        });

        // If this widget is being redefined then we need to find all widgets that
        // are inheriting from it and redefine all of them so that they inherit from
        // the new version of this widget. We're essentially trying to replace one
        // level in the prototype chain.
        if (existingConstructor) {
            $.each(existingConstructor._childConstructors, function (i, child) {
                var childPrototype = child.prototype;

                // Redefine the child widget using the same prototype that was
                // originally used, but inherit from the new version of the base
                $.widget(childPrototype.namespace + "." + childPrototype.widgetName, constructor,
                    child._proto);
            });

            // Remove the list of existing child constructors from the old constructor
            // so the old child constructors can be garbage collected
            delete existingConstructor._childConstructors;
        } else {
            base._childConstructors.push(constructor);
        }

        $.widget.bridge(name, constructor);

        return constructor;
    };

    $.widget.extend = function (target) {
        var input = widgetSlice.call(arguments, 1);
        var inputIndex = 0;
        var inputLength = input.length;
        var key;
        var value;

        for (; inputIndex < inputLength; inputIndex++) {
            for (key in input[inputIndex]) {
                value = input[inputIndex][key];
                if (input[inputIndex].hasOwnProperty(key) && value !== undefined) {

                    // Clone objects
                    if ($.isPlainObject(value)) {
                        target[key] = $.isPlainObject(target[key]) ?
                            $.widget.extend({}, target[key], value) :

                            // Don't extend strings, arrays, etc. with objects
                            $.widget.extend({}, value);

                        // Copy everything else by reference
                    } else {
                        target[key] = value;
                    }
                }
            }
        }
        return target;
    };

    $.widget.bridge = function (name, object) {
        var fullName = object.prototype.widgetFullName || name;
        $.fn[name] = function (options) {
            var isMethodCall = typeof options === "string";
            var args = widgetSlice.call(arguments, 1);
            var returnValue = this;

            if (isMethodCall) {

                // If this is an empty collection, we need to have the instance method
                // return undefined instead of the jQuery instance
                if (!this.length && options === "instance") {
                    returnValue = undefined;
                } else {
                    this.each(function () {
                        var methodValue;
                        var instance = $.data(this, fullName);

                        if (options === "instance") {
                            returnValue = instance;
                            return false;
                        }

                        if (!instance) {
                            return $.error("cannot call methods on " + name +
                                " prior to initialization; " +
                                "attempted to call method '" + options + "'");
                        }

                        if (!$.isFunction(instance[options]) || options.charAt(0) === "_") {
                            return $.error("no such method '" + options + "' for " + name +
                                " widget instance");
                        }

                        methodValue = instance[options].apply(instance, args);

                        if (methodValue !== instance && methodValue !== undefined) {
                            returnValue = methodValue && methodValue.jquery ?
                                returnValue.pushStack(methodValue.get()) :
                                methodValue;
                            return false;
                        }
                    });
                }
            } else {

                // Allow multiple hashes to be passed on init
                if (args.length) {
                    options = $.widget.extend.apply(null, [options].concat(args));
                }

                this.each(function () {
                    var instance = $.data(this, fullName);
                    if (instance) {
                        instance.option(options || {});
                        if (instance._init) {
                            instance._init();
                        }
                    } else {
                        $.data(this, fullName, new object(options, this));
                    }
                });
            }

            return returnValue;
        };
    };

    $.Widget = function (/* options, element */) {
    };
    $.Widget._childConstructors = [];

    $.Widget.prototype = {
        widgetName: "widget",
        widgetEventPrefix: "",
        defaultElement: "<div>",

        options: {
            classes: {},
            disabled: false,

            // Callbacks
            create: null
        },

        _createWidget: function (options, element) {
            element = $(element || this.defaultElement || this)[0];
            this.element = $(element);
            this.uuid = widgetUuid++;
            this.eventNamespace = "." + this.widgetName + this.uuid;

            this.bindings = $();
            this.hoverable = $();
            this.focusable = $();
            this.classesElementLookup = {};

            if (element !== this) {
                $.data(element, this.widgetFullName, this);
                this._on(true, this.element, {
                    remove: function (event) {
                        if (event.target === element) {
                            this.destroy();
                        }
                    }
                });
                this.document = $(element.style ?

                    // Element within the document
                    element.ownerDocument :

                    // Element is window or document
                    element.document || element);
                this.window = $(this.document[0].defaultView || this.document[0].parentWindow);
            }

            this.options = $.widget.extend({},
                this.options,
                this._getCreateOptions(),
                options);

            this._create();

            if (this.options.disabled) {
                this._setOptionDisabled(this.options.disabled);
            }

            this._trigger("create", null, this._getCreateEventData());
            this._init();
        },

        _getCreateOptions: function () {
            return {};
        },

        _getCreateEventData: $.noop,

        _create: $.noop,

        _init: $.noop,

        destroy: function () {
            var that = this;

            this._destroy();
            $.each(this.classesElementLookup, function (key, value) {
                that._removeClass(value, key);
            });

            // We can probably remove the unbind calls in 2.0
            // all event bindings should go through this._on()
            this.element
                .off(this.eventNamespace)
                .removeData(this.widgetFullName);
            this.widget()
                .off(this.eventNamespace)
                .removeAttr("aria-disabled");

            // Clean up events and states
            this.bindings.off(this.eventNamespace);
        },

        _destroy: $.noop,

        widget: function () {
            return this.element;
        },

        option: function (key, value) {
            var options = key;
            var parts;
            var curOption;
            var i;

            if (arguments.length === 0) {

                // Don't return a reference to the internal hash
                return $.widget.extend({}, this.options);
            }

            if (typeof key === "string") {

                // Handle nested keys, e.g., "foo.bar" => { foo: { bar: ___ } }
                options = {};
                parts = key.split(".");
                key = parts.shift();
                if (parts.length) {
                    curOption = options[key] = $.widget.extend({}, this.options[key]);
                    for (i = 0; i < parts.length - 1; i++) {
                        curOption[parts[i]] = curOption[parts[i]] || {};
                        curOption = curOption[parts[i]];
                    }
                    key = parts.pop();
                    if (arguments.length === 1) {
                        return curOption[key] === undefined ? null : curOption[key];
                    }
                    curOption[key] = value;
                } else {
                    if (arguments.length === 1) {
                        return this.options[key] === undefined ? null : this.options[key];
                    }
                    options[key] = value;
                }
            }

            this._setOptions(options);

            return this;
        },

        _setOptions: function (options) {
            var key;

            for (key in options) {
                this._setOption(key, options[key]);
            }

            return this;
        },

        _setOption: function (key, value) {
            if (key === "classes") {
                this._setOptionClasses(value);
            }

            this.options[key] = value;

            if (key === "disabled") {
                this._setOptionDisabled(value);
            }

            return this;
        },

        _setOptionClasses: function (value) {
            var classKey, elements, currentElements;

            for (classKey in value) {
                currentElements = this.classesElementLookup[classKey];
                if (value[classKey] === this.options.classes[classKey] ||
                    !currentElements ||
                    !currentElements.length) {
                    continue;
                }

                // We are doing this to create a new jQuery object because the _removeClass() call
                // on the next line is going to destroy the reference to the current elements being
                // tracked. We need to save a copy of this collection so that we can add the new classes
                // below.
                elements = $(currentElements.get());
                this._removeClass(currentElements, classKey);

                // We don't use _addClass() here, because that uses this.options.classes
                // for generating the string of classes. We want to use the value passed in from
                // _setOption(), this is the new value of the classes option which was passed to
                // _setOption(). We pass this value directly to _classes().
                elements.addClass(this._classes({
                    element: elements,
                    keys: classKey,
                    classes: value,
                    add: true
                }));
            }
        },

        _setOptionDisabled: function (value) {
            this._toggleClass(this.widget(), this.widgetFullName + "-disabled", null, !!value);

            // If the widget is becoming disabled, then nothing is interactive
            if (value) {
                this._removeClass(this.hoverable, null, "ui-state-hover");
                this._removeClass(this.focusable, null, "ui-state-focus");
            }
        },

        enable: function () {
            return this._setOptions({disabled: false});
        },

        disable: function () {
            return this._setOptions({disabled: true});
        },

        _classes: function (options) {
            var full = [];
            var that = this;

            options = $.extend({
                element: this.element,
                classes: this.options.classes || {}
            }, options);

            function processClassString(classes, checkOption) {
                var current, i;
                for (i = 0; i < classes.length; i++) {
                    current = that.classesElementLookup[classes[i]] || $();
                    if (options.add) {
                        current = $($.unique(current.get().concat(options.element.get())));
                    } else {
                        current = $(current.not(options.element).get());
                    }
                    that.classesElementLookup[classes[i]] = current;
                    full.push(classes[i]);
                    if (checkOption && options.classes[classes[i]]) {
                        full.push(options.classes[classes[i]]);
                    }
                }
            }

            this._on(options.element, {
                "remove": "_untrackClassesElement"
            });

            if (options.keys) {
                processClassString(options.keys.match(/\S+/g) || [], true);
            }
            if (options.extra) {
                processClassString(options.extra.match(/\S+/g) || []);
            }

            return full.join(" ");
        },

        _untrackClassesElement: function (event) {
            var that = this;
            $.each(that.classesElementLookup, function (key, value) {
                if ($.inArray(event.target, value) !== -1) {
                    that.classesElementLookup[key] = $(value.not(event.target).get());
                }
            });
        },

        _removeClass: function (element, keys, extra) {
            return this._toggleClass(element, keys, extra, false);
        },

        _addClass: function (element, keys, extra) {
            return this._toggleClass(element, keys, extra, true);
        },

        _toggleClass: function (element, keys, extra, add) {
            add = (typeof add === "boolean") ? add : extra;
            var shift = (typeof element === "string" || element === null),
                options = {
                    extra: shift ? keys : extra,
                    keys: shift ? element : keys,
                    element: shift ? this.element : element,
                    add: add
                };
            options.element.toggleClass(this._classes(options), add);
            return this;
        },

        _on: function (suppressDisabledCheck, element, handlers) {
            var delegateElement;
            var instance = this;

            // No suppressDisabledCheck flag, shuffle arguments
            if (typeof suppressDisabledCheck !== "boolean") {
                handlers = element;
                element = suppressDisabledCheck;
                suppressDisabledCheck = false;
            }

            // No element argument, shuffle and use this.element
            if (!handlers) {
                handlers = element;
                element = this.element;
                delegateElement = this.widget();
            } else {
                element = delegateElement = $(element);
                this.bindings = this.bindings.add(element);
            }

            $.each(handlers, function (event, handler) {
                function handlerProxy() {

                    // Allow widgets to customize the disabled handling
                    // - disabled as an array instead of boolean
                    // - disabled class as method for disabling individual parts
                    if (!suppressDisabledCheck &&
                        (instance.options.disabled === true ||
                            $(this).hasClass("ui-state-disabled"))) {
                        return;
                    }
                    return (typeof handler === "string" ? instance[handler] : handler)
                        .apply(instance, arguments);
                }

                // Copy the guid so direct unbinding works
                if (typeof handler !== "string") {
                    handlerProxy.guid = handler.guid =
                        handler.guid || handlerProxy.guid || $.guid++;
                }

                var match = event.match(/^([\w:-]*)\s*(.*)$/);
                var eventName = match[1] + instance.eventNamespace;
                var selector = match[2];

                if (selector) {
                    delegateElement.on(eventName, selector, handlerProxy);
                } else {
                    element.on(eventName, handlerProxy);
                }
            });
        },

        _off: function (element, eventName) {
            eventName = (eventName || "").split(" ").join(this.eventNamespace + " ") +
                this.eventNamespace;
            element.off(eventName).off(eventName);

            // Clear the stack to avoid memory leaks (#10056)
            this.bindings = $(this.bindings.not(element).get());
            this.focusable = $(this.focusable.not(element).get());
            this.hoverable = $(this.hoverable.not(element).get());
        },

        _delay: function (handler, delay) {
            function handlerProxy() {
                return (typeof handler === "string" ? instance[handler] : handler)
                    .apply(instance, arguments);
            }

            var instance = this;
            return setTimeout(handlerProxy, delay || 0);
        },

        _hoverable: function (element) {
            this.hoverable = this.hoverable.add(element);
            this._on(element, {
                mouseenter: function (event) {
                    this._addClass($(event.currentTarget), null, "ui-state-hover");
                },
                mouseleave: function (event) {
                    this._removeClass($(event.currentTarget), null, "ui-state-hover");
                }
            });
        },

        _focusable: function (element) {
            this.focusable = this.focusable.add(element);
            this._on(element, {
                focusin: function (event) {
                    this._addClass($(event.currentTarget), null, "ui-state-focus");
                },
                focusout: function (event) {
                    this._removeClass($(event.currentTarget), null, "ui-state-focus");
                }
            });
        },

        _trigger: function (type, event, data) {
            var prop, orig;
            var callback = this.options[type];

            data = data || {};
            event = $.Event(event);
            event.type = (type === this.widgetEventPrefix ?
                type :
                this.widgetEventPrefix + type).toLowerCase();

            // The original event may come from any element
            // so we need to reset the target on the new event
            event.target = this.element[0];

            // Copy original event properties over to the new event
            orig = event.originalEvent;
            if (orig) {
                for (prop in orig) {
                    if (!(prop in event)) {
                        event[prop] = orig[prop];
                    }
                }
            }

            this.element.trigger(event, data);
            return !($.isFunction(callback) &&
                callback.apply(this.element[0], [event].concat(data)) === false ||
                event.isDefaultPrevented());
        }
    };

    $.each({show: "fadeIn", hide: "fadeOut"}, function (method, defaultEffect) {
        $.Widget.prototype["_" + method] = function (element, options, callback) {
            if (typeof options === "string") {
                options = {effect: options};
            }

            var hasOptions;
            var effectName = !options ?
                method :
                options === true || typeof options === "number" ?
                    defaultEffect :
                    options.effect || defaultEffect;

            options = options || {};
            if (typeof options === "number") {
                options = {duration: options};
            }

            hasOptions = !$.isEmptyObject(options);
            options.complete = callback;

            if (options.delay) {
                element.delay(options.delay);
            }

            if (hasOptions && $.effects && $.effects.effect[effectName]) {
                element[method](options);
            } else if (effectName !== method && element[effectName]) {
                element[effectName](options.duration, options.easing, callback);
            } else {
                element.queue(function (next) {
                    $(this)[method]();
                    if (callback) {
                        callback.call(element[0]);
                    }
                    next();
                });
            }
        };
    });

    var widget = $.widget;


    /*!
 * jQuery UI Position 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/position/
 */

//>>label: Position
//>>group: Core
//>>description: Positions elements relative to other elements.
//>>docs: http://api.jqueryui.com/position/
//>>demos: http://jqueryui.com/position/


    (function () {
        var cachedScrollbarWidth,
            max = Math.max,
            abs = Math.abs,
            rhorizontal = /left|center|right/,
            rvertical = /top|center|bottom/,
            roffset = /[\+\-]\d+(\.[\d]+)?%?/,
            rposition = /^\w+/,
            rpercent = /%$/,
            _position = $.fn.position;

        function getOffsets(offsets, width, height) {
            return [
                parseFloat(offsets[0]) * (rpercent.test(offsets[0]) ? width / 100 : 1),
                parseFloat(offsets[1]) * (rpercent.test(offsets[1]) ? height / 100 : 1)
            ];
        }

        function parseCss(element, property) {
            return parseInt($.css(element, property), 10) || 0;
        }

        function getDimensions(elem) {
            var raw = elem[0];
            if (raw.nodeType === 9) {
                return {
                    width: elem.width(),
                    height: elem.height(),
                    offset: {top: 0, left: 0}
                };
            }
            if ($.isWindow(raw)) {
                return {
                    width: elem.width(),
                    height: elem.height(),
                    offset: {top: elem.scrollTop(), left: elem.scrollLeft()}
                };
            }
            if (raw.preventDefault) {
                return {
                    width: 0,
                    height: 0,
                    offset: {top: raw.pageY, left: raw.pageX}
                };
            }
            return {
                width: elem.outerWidth(),
                height: elem.outerHeight(),
                offset: elem.offset()
            };
        }

        $.position = {
            scrollbarWidth: function () {
                if (cachedScrollbarWidth !== undefined) {
                    return cachedScrollbarWidth;
                }
                var w1, w2,
                    div = $("<div " +
                        "style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'>" +
                        "<div style='height:100px;width:auto;'></div></div>"),
                    innerDiv = div.children()[0];

                $("body").append(div);
                w1 = innerDiv.offsetWidth;
                div.css("overflow", "scroll");

                w2 = innerDiv.offsetWidth;

                if (w1 === w2) {
                    w2 = div[0].clientWidth;
                }

                div.remove();

                return (cachedScrollbarWidth = w1 - w2);
            },
            getScrollInfo: function (within) {
                var overflowX = within.isWindow || within.isDocument ? "" :
                    within.element.css("overflow-x"),
                    overflowY = within.isWindow || within.isDocument ? "" :
                        within.element.css("overflow-y"),
                    hasOverflowX = overflowX === "scroll" ||
                        (overflowX === "auto" && within.width < within.element[0].scrollWidth),
                    hasOverflowY = overflowY === "scroll" ||
                        (overflowY === "auto" && within.height < within.element[0].scrollHeight);
                return {
                    width: hasOverflowY ? $.position.scrollbarWidth() : 0,
                    height: hasOverflowX ? $.position.scrollbarWidth() : 0
                };
            },
            getWithinInfo: function (element) {
                var withinElement = $(element || window),
                    isWindow = $.isWindow(withinElement[0]),
                    isDocument = !!withinElement[0] && withinElement[0].nodeType === 9,
                    hasOffset = !isWindow && !isDocument;
                return {
                    element: withinElement,
                    isWindow: isWindow,
                    isDocument: isDocument,
                    offset: hasOffset ? $(element).offset() : {left: 0, top: 0},
                    scrollLeft: withinElement.scrollLeft(),
                    scrollTop: withinElement.scrollTop(),
                    width: withinElement.outerWidth(),
                    height: withinElement.outerHeight()
                };
            }
        };

        $.fn.position = function (options) {
            if (!options || !options.of) {
                return _position.apply(this, arguments);
            }

            // Make a copy, we don't want to modify arguments
            options = $.extend({}, options);

            var atOffset, targetWidth, targetHeight, targetOffset, basePosition, dimensions,
                target = $(options.of),
                within = $.position.getWithinInfo(options.within),
                scrollInfo = $.position.getScrollInfo(within),
                collision = (options.collision || "flip").split(" "),
                offsets = {};

            dimensions = getDimensions(target);
            if (target[0].preventDefault) {

                // Force left top to allow flipping
                options.at = "left top";
            }
            targetWidth = dimensions.width;
            targetHeight = dimensions.height;
            targetOffset = dimensions.offset;

            // Clone to reuse original targetOffset later
            basePosition = $.extend({}, targetOffset);

            // Force my and at to have valid horizontal and vertical positions
            // if a value is missing or invalid, it will be converted to center
            $.each(["my", "at"], function () {
                var pos = (options[this] || "").split(" "),
                    horizontalOffset,
                    verticalOffset;

                if (pos.length === 1) {
                    pos = rhorizontal.test(pos[0]) ?
                        pos.concat(["center"]) :
                        rvertical.test(pos[0]) ?
                            ["center"].concat(pos) :
                            ["center", "center"];
                }
                pos[0] = rhorizontal.test(pos[0]) ? pos[0] : "center";
                pos[1] = rvertical.test(pos[1]) ? pos[1] : "center";

                // Calculate offsets
                horizontalOffset = roffset.exec(pos[0]);
                verticalOffset = roffset.exec(pos[1]);
                offsets[this] = [
                    horizontalOffset ? horizontalOffset[0] : 0,
                    verticalOffset ? verticalOffset[0] : 0
                ];

                // Reduce to just the positions without the offsets
                options[this] = [
                    rposition.exec(pos[0])[0],
                    rposition.exec(pos[1])[0]
                ];
            });

            // Normalize collision option
            if (collision.length === 1) {
                collision[1] = collision[0];
            }

            if (options.at[0] === "right") {
                basePosition.left += targetWidth;
            } else if (options.at[0] === "center") {
                basePosition.left += targetWidth / 2;
            }

            if (options.at[1] === "bottom") {
                basePosition.top += targetHeight;
            } else if (options.at[1] === "center") {
                basePosition.top += targetHeight / 2;
            }

            atOffset = getOffsets(offsets.at, targetWidth, targetHeight);
            basePosition.left += atOffset[0];
            basePosition.top += atOffset[1];

            return this.each(function () {
                var collisionPosition, using,
                    elem = $(this),
                    elemWidth = elem.outerWidth(),
                    elemHeight = elem.outerHeight(),
                    marginLeft = parseCss(this, "marginLeft"),
                    marginTop = parseCss(this, "marginTop"),
                    collisionWidth = elemWidth + marginLeft + parseCss(this, "marginRight") +
                        scrollInfo.width,
                    collisionHeight = elemHeight + marginTop + parseCss(this, "marginBottom") +
                        scrollInfo.height,
                    position = $.extend({}, basePosition),
                    myOffset = getOffsets(offsets.my, elem.outerWidth(), elem.outerHeight());

                if (options.my[0] === "right") {
                    position.left -= elemWidth;
                } else if (options.my[0] === "center") {
                    position.left -= elemWidth / 2;
                }

                if (options.my[1] === "bottom") {
                    position.top -= elemHeight;
                } else if (options.my[1] === "center") {
                    position.top -= elemHeight / 2;
                }

                position.left += myOffset[0];
                position.top += myOffset[1];

                collisionPosition = {
                    marginLeft: marginLeft,
                    marginTop: marginTop
                };

                $.each(["left", "top"], function (i, dir) {
                    if ($.ui.position[collision[i]]) {
                        $.ui.position[collision[i]][dir](position, {
                            targetWidth: targetWidth,
                            targetHeight: targetHeight,
                            elemWidth: elemWidth,
                            elemHeight: elemHeight,
                            collisionPosition: collisionPosition,
                            collisionWidth: collisionWidth,
                            collisionHeight: collisionHeight,
                            offset: [atOffset[0] + myOffset[0], atOffset [1] + myOffset[1]],
                            my: options.my,
                            at: options.at,
                            within: within,
                            elem: elem
                        });
                    }
                });

                if (options.using) {

                    // Adds feedback as second argument to using callback, if present
                    using = function (props) {
                        var left = targetOffset.left - position.left,
                            right = left + targetWidth - elemWidth,
                            top = targetOffset.top - position.top,
                            bottom = top + targetHeight - elemHeight,
                            feedback = {
                                target: {
                                    element: target,
                                    left: targetOffset.left,
                                    top: targetOffset.top,
                                    width: targetWidth,
                                    height: targetHeight
                                },
                                element: {
                                    element: elem,
                                    left: position.left,
                                    top: position.top,
                                    width: elemWidth,
                                    height: elemHeight
                                },
                                horizontal: right < 0 ? "left" : left > 0 ? "right" : "center",
                                vertical: bottom < 0 ? "top" : top > 0 ? "bottom" : "middle"
                            };
                        if (targetWidth < elemWidth && abs(left + right) < targetWidth) {
                            feedback.horizontal = "center";
                        }
                        if (targetHeight < elemHeight && abs(top + bottom) < targetHeight) {
                            feedback.vertical = "middle";
                        }
                        if (max(abs(left), abs(right)) > max(abs(top), abs(bottom))) {
                            feedback.important = "horizontal";
                        } else {
                            feedback.important = "vertical";
                        }
                        options.using.call(this, props, feedback);
                    };
                }

                elem.offset($.extend(position, {using: using}));
            });
        };

        $.ui.position = {
            fit: {
                left: function (position, data) {
                    var within = data.within,
                        withinOffset = within.isWindow ? within.scrollLeft : within.offset.left,
                        outerWidth = within.width,
                        collisionPosLeft = position.left - data.collisionPosition.marginLeft,
                        overLeft = withinOffset - collisionPosLeft,
                        overRight = collisionPosLeft + data.collisionWidth - outerWidth - withinOffset,
                        newOverRight;

                    // Element is wider than within
                    if (data.collisionWidth > outerWidth) {

                        // Element is initially over the left side of within
                        if (overLeft > 0 && overRight <= 0) {
                            newOverRight = position.left + overLeft + data.collisionWidth - outerWidth -
                                withinOffset;
                            position.left += overLeft - newOverRight;

                            // Element is initially over right side of within
                        } else if (overRight > 0 && overLeft <= 0) {
                            position.left = withinOffset;

                            // Element is initially over both left and right sides of within
                        } else {
                            if (overLeft > overRight) {
                                position.left = withinOffset + outerWidth - data.collisionWidth;
                            } else {
                                position.left = withinOffset;
                            }
                        }

                        // Too far left -> align with left edge
                    } else if (overLeft > 0) {
                        position.left += overLeft;

                        // Too far right -> align with right edge
                    } else if (overRight > 0) {
                        position.left -= overRight;

                        // Adjust based on position and margin
                    } else {
                        position.left = max(position.left - collisionPosLeft, position.left);
                    }
                },
                top: function (position, data) {
                    var within = data.within,
                        withinOffset = within.isWindow ? within.scrollTop : within.offset.top,
                        outerHeight = data.within.height,
                        collisionPosTop = position.top - data.collisionPosition.marginTop,
                        overTop = withinOffset - collisionPosTop,
                        overBottom = collisionPosTop + data.collisionHeight - outerHeight - withinOffset,
                        newOverBottom;

                    // Element is taller than within
                    if (data.collisionHeight > outerHeight) {

                        // Element is initially over the top of within
                        if (overTop > 0 && overBottom <= 0) {
                            newOverBottom = position.top + overTop + data.collisionHeight - outerHeight -
                                withinOffset;
                            position.top += overTop - newOverBottom;

                            // Element is initially over bottom of within
                        } else if (overBottom > 0 && overTop <= 0) {
                            position.top = withinOffset;

                            // Element is initially over both top and bottom of within
                        } else {
                            if (overTop > overBottom) {
                                position.top = withinOffset + outerHeight - data.collisionHeight;
                            } else {
                                position.top = withinOffset;
                            }
                        }

                        // Too far up -> align with top
                    } else if (overTop > 0) {
                        position.top += overTop;

                        // Too far down -> align with bottom edge
                    } else if (overBottom > 0) {
                        position.top -= overBottom;

                        // Adjust based on position and margin
                    } else {
                        position.top = max(position.top - collisionPosTop, position.top);
                    }
                }
            },
            flip: {
                left: function (position, data) {
                    var within = data.within,
                        withinOffset = within.offset.left + within.scrollLeft,
                        outerWidth = within.width,
                        offsetLeft = within.isWindow ? within.scrollLeft : within.offset.left,
                        collisionPosLeft = position.left - data.collisionPosition.marginLeft,
                        overLeft = collisionPosLeft - offsetLeft,
                        overRight = collisionPosLeft + data.collisionWidth - outerWidth - offsetLeft,
                        myOffset = data.my[0] === "left" ?
                            -data.elemWidth :
                            data.my[0] === "right" ?
                                data.elemWidth :
                                0,
                        atOffset = data.at[0] === "left" ?
                            data.targetWidth :
                            data.at[0] === "right" ?
                                -data.targetWidth :
                                0,
                        offset = -2 * data.offset[0],
                        newOverRight,
                        newOverLeft;

                    if (overLeft < 0) {
                        newOverRight = position.left + myOffset + atOffset + offset + data.collisionWidth -
                            outerWidth - withinOffset;
                        if (newOverRight < 0 || newOverRight < abs(overLeft)) {
                            position.left += myOffset + atOffset + offset;
                        }
                    } else if (overRight > 0) {
                        newOverLeft = position.left - data.collisionPosition.marginLeft + myOffset +
                            atOffset + offset - offsetLeft;
                        if (newOverLeft > 0 || abs(newOverLeft) < overRight) {
                            position.left += myOffset + atOffset + offset;
                        }
                    }
                },
                top: function (position, data) {
                    var within = data.within,
                        withinOffset = within.offset.top + within.scrollTop,
                        outerHeight = within.height,
                        offsetTop = within.isWindow ? within.scrollTop : within.offset.top,
                        collisionPosTop = position.top - data.collisionPosition.marginTop,
                        overTop = collisionPosTop - offsetTop,
                        overBottom = collisionPosTop + data.collisionHeight - outerHeight - offsetTop,
                        top = data.my[1] === "top",
                        myOffset = top ?
                            -data.elemHeight :
                            data.my[1] === "bottom" ?
                                data.elemHeight :
                                0,
                        atOffset = data.at[1] === "top" ?
                            data.targetHeight :
                            data.at[1] === "bottom" ?
                                -data.targetHeight :
                                0,
                        offset = -2 * data.offset[1],
                        newOverTop,
                        newOverBottom;
                    if (overTop < 0) {
                        newOverBottom = position.top + myOffset + atOffset + offset + data.collisionHeight -
                            outerHeight - withinOffset;
                        if (newOverBottom < 0 || newOverBottom < abs(overTop)) {
                            position.top += myOffset + atOffset + offset;
                        }
                    } else if (overBottom > 0) {
                        newOverTop = position.top - data.collisionPosition.marginTop + myOffset + atOffset +
                            offset - offsetTop;
                        if (newOverTop > 0 || abs(newOverTop) < overBottom) {
                            position.top += myOffset + atOffset + offset;
                        }
                    }
                }
            },
            flipfit: {
                left: function () {
                    $.ui.position.flip.left.apply(this, arguments);
                    $.ui.position.fit.left.apply(this, arguments);
                },
                top: function () {
                    $.ui.position.flip.top.apply(this, arguments);
                    $.ui.position.fit.top.apply(this, arguments);
                }
            }
        };

    })();

    var position = $.ui.position;


    /*!
 * jQuery UI :data 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: :data Selector
//>>group: Core
//>>description: Selects elements which have data stored under the specified key.
//>>docs: http://api.jqueryui.com/data-selector/


    var data = $.extend($.expr[":"], {
        data: $.expr.createPseudo ?
            $.expr.createPseudo(function (dataName) {
                return function (elem) {
                    return !!$.data(elem, dataName);
                };
            }) :

            // Support: jQuery <1.8
            function (elem, i, match) {
                return !!$.data(elem, match[3]);
            }
    });

    /*!
 * jQuery UI Disable Selection 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: disableSelection
//>>group: Core
//>>description: Disable selection of text content within the set of matched elements.
//>>docs: http://api.jqueryui.com/disableSelection/

// This file is deprecated


    var disableSelection = $.fn.extend({
        disableSelection: (function () {
            var eventType = "onselectstart" in document.createElement("div") ?
                "selectstart" :
                "mousedown";

            return function () {
                return this.on(eventType + ".ui-disableSelection", function (event) {
                    event.preventDefault();
                });
            };
        })(),

        enableSelection: function () {
            return this.off(".ui-disableSelection");
        }
    });


    /*!
 * jQuery UI Effects 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Effects Core
//>>group: Effects
// jscs:disable maximumLineLength
//>>description: Extends the internal jQuery effects. Includes morphing and easing. Required by all other effects.
// jscs:enable maximumLineLength
//>>docs: http://api.jqueryui.com/category/effects-core/
//>>demos: http://jqueryui.com/effect/


    var dataSpace = "ui-effects-",
        dataSpaceStyle = "ui-effects-style",
        dataSpaceAnimated = "ui-effects-animated",

        // Create a local jQuery because jQuery Color relies on it and the
        // global may not exist with AMD and a custom build (#10199)
        jQuery = $;

    $.effects = {
        effect: {}
    };

    /*!
 * jQuery Color Animations v2.1.2
 * https://github.com/jquery/jquery-color
 *
 * Copyright 2014 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * Date: Wed Jan 16 08:47:09 2013 -0600
 */
    (function (jQuery, undefined) {

        var stepHooks = "backgroundColor borderBottomColor borderLeftColor borderRightColor " +
            "borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",

            // Plusequals test for += 100 -= 100
            rplusequals = /^([\-+])=\s*(\d+\.?\d*)/,

            // A set of RE's that can match strings and generate color tuples.
            stringParsers = [{
                re: /rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,
                parse: function (execResult) {
                    return [
                        execResult[1],
                        execResult[2],
                        execResult[3],
                        execResult[4]
                    ];
                }
            }, {
                re: /rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,
                parse: function (execResult) {
                    return [
                        execResult[1] * 2.55,
                        execResult[2] * 2.55,
                        execResult[3] * 2.55,
                        execResult[4]
                    ];
                }
            }, {

                // This regex ignores A-F because it's compared against an already lowercased string
                re: /#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,
                parse: function (execResult) {
                    return [
                        parseInt(execResult[1], 16),
                        parseInt(execResult[2], 16),
                        parseInt(execResult[3], 16)
                    ];
                }
            }, {

                // This regex ignores A-F because it's compared against an already lowercased string
                re: /#([a-f0-9])([a-f0-9])([a-f0-9])/,
                parse: function (execResult) {
                    return [
                        parseInt(execResult[1] + execResult[1], 16),
                        parseInt(execResult[2] + execResult[2], 16),
                        parseInt(execResult[3] + execResult[3], 16)
                    ];
                }
            }, {
                re: /hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,
                space: "hsla",
                parse: function (execResult) {
                    return [
                        execResult[1],
                        execResult[2] / 100,
                        execResult[3] / 100,
                        execResult[4]
                    ];
                }
            }],

            // JQuery.Color( )
            color = jQuery.Color = function (color, green, blue, alpha) {
                return new jQuery.Color.fn.parse(color, green, blue, alpha);
            },
            spaces = {
                rgba: {
                    props: {
                        red: {
                            idx: 0,
                            type: "byte"
                        },
                        green: {
                            idx: 1,
                            type: "byte"
                        },
                        blue: {
                            idx: 2,
                            type: "byte"
                        }
                    }
                },

                hsla: {
                    props: {
                        hue: {
                            idx: 0,
                            type: "degrees"
                        },
                        saturation: {
                            idx: 1,
                            type: "percent"
                        },
                        lightness: {
                            idx: 2,
                            type: "percent"
                        }
                    }
                }
            },
            propTypes = {
                "byte": {
                    floor: true,
                    max: 255
                },
                "percent": {
                    max: 1
                },
                "degrees": {
                    mod: 360,
                    floor: true
                }
            },
            support = color.support = {},

            // Element for support tests
            supportElem = jQuery("<p>")[0],

            // Colors = jQuery.Color.names
            colors,

            // Local aliases of functions called often
            each = jQuery.each;

// Determine rgba support immediately
        supportElem.style.cssText = "background-color:rgba(1,1,1,.5)";
        support.rgba = supportElem.style.backgroundColor.indexOf("rgba") > -1;

// Define cache name and alpha properties
// for rgba and hsla spaces
        each(spaces, function (spaceName, space) {
            space.cache = "_" + spaceName;
            space.props.alpha = {
                idx: 3,
                type: "percent",
                def: 1
            };
        });

        function clamp(value, prop, allowEmpty) {
            var type = propTypes[prop.type] || {};

            if (value == null) {
                return (allowEmpty || !prop.def) ? null : prop.def;
            }

            // ~~ is an short way of doing floor for positive numbers
            value = type.floor ? ~~value : parseFloat(value);

            // IE will pass in empty strings as value for alpha,
            // which will hit this case
            if (isNaN(value)) {
                return prop.def;
            }

            if (type.mod) {

                // We add mod before modding to make sure that negatives values
                // get converted properly: -10 -> 350
                return (value + type.mod) % type.mod;
            }

            // For now all property types without mod have min and max
            return 0 > value ? 0 : type.max < value ? type.max : value;
        }

        function stringParse(string) {
            var inst = color(),
                rgba = inst._rgba = [];

            string = string.toLowerCase();

            each(stringParsers, function (i, parser) {
                var parsed,
                    match = parser.re.exec(string),
                    values = match && parser.parse(match),
                    spaceName = parser.space || "rgba";

                if (values) {
                    parsed = inst[spaceName](values);

                    // If this was an rgba parse the assignment might happen twice
                    // oh well....
                    inst[spaces[spaceName].cache] = parsed[spaces[spaceName].cache];
                    rgba = inst._rgba = parsed._rgba;

                    // Exit each( stringParsers ) here because we matched
                    return false;
                }
            });

            // Found a stringParser that handled it
            if (rgba.length) {

                // If this came from a parsed string, force "transparent" when alpha is 0
                // chrome, (and maybe others) return "transparent" as rgba(0,0,0,0)
                if (rgba.join() === "0,0,0,0") {
                    jQuery.extend(rgba, colors.transparent);
                }
                return inst;
            }

            // Named colors
            return colors[string];
        }

        color.fn = jQuery.extend(color.prototype, {
            parse: function (red, green, blue, alpha) {
                if (red === undefined) {
                    this._rgba = [null, null, null, null];
                    return this;
                }
                if (red.jquery || red.nodeType) {
                    red = jQuery(red).css(green);
                    green = undefined;
                }

                var inst = this,
                    type = jQuery.type(red),
                    rgba = this._rgba = [];

                // More than 1 argument specified - assume ( red, green, blue, alpha )
                if (green !== undefined) {
                    red = [red, green, blue, alpha];
                    type = "array";
                }

                if (type === "string") {
                    return this.parse(stringParse(red) || colors._default);
                }

                if (type === "array") {
                    each(spaces.rgba.props, function (key, prop) {
                        rgba[prop.idx] = clamp(red[prop.idx], prop);
                    });
                    return this;
                }

                if (type === "object") {
                    if (red instanceof color) {
                        each(spaces, function (spaceName, space) {
                            if (red[space.cache]) {
                                inst[space.cache] = red[space.cache].slice();
                            }
                        });
                    } else {
                        each(spaces, function (spaceName, space) {
                            var cache = space.cache;
                            each(space.props, function (key, prop) {

                                // If the cache doesn't exist, and we know how to convert
                                if (!inst[cache] && space.to) {

                                    // If the value was null, we don't need to copy it
                                    // if the key was alpha, we don't need to copy it either
                                    if (key === "alpha" || red[key] == null) {
                                        return;
                                    }
                                    inst[cache] = space.to(inst._rgba);
                                }

                                // This is the only case where we allow nulls for ALL properties.
                                // call clamp with alwaysAllowEmpty
                                inst[cache][prop.idx] = clamp(red[key], prop, true);
                            });

                            // Everything defined but alpha?
                            if (inst[cache] &&
                                jQuery.inArray(null, inst[cache].slice(0, 3)) < 0) {

                                // Use the default of 1
                                inst[cache][3] = 1;
                                if (space.from) {
                                    inst._rgba = space.from(inst[cache]);
                                }
                            }
                        });
                    }
                    return this;
                }
            },
            is: function (compare) {
                var is = color(compare),
                    same = true,
                    inst = this;

                each(spaces, function (_, space) {
                    var localCache,
                        isCache = is[space.cache];
                    if (isCache) {
                        localCache = inst[space.cache] || space.to && space.to(inst._rgba) || [];
                        each(space.props, function (_, prop) {
                            if (isCache[prop.idx] != null) {
                                same = (isCache[prop.idx] === localCache[prop.idx]);
                                return same;
                            }
                        });
                    }
                    return same;
                });
                return same;
            },
            _space: function () {
                var used = [],
                    inst = this;
                each(spaces, function (spaceName, space) {
                    if (inst[space.cache]) {
                        used.push(spaceName);
                    }
                });
                return used.pop();
            },
            transition: function (other, distance) {
                var end = color(other),
                    spaceName = end._space(),
                    space = spaces[spaceName],
                    startColor = this.alpha() === 0 ? color("transparent") : this,
                    start = startColor[space.cache] || space.to(startColor._rgba),
                    result = start.slice();

                end = end[space.cache];
                each(space.props, function (key, prop) {
                    var index = prop.idx,
                        startValue = start[index],
                        endValue = end[index],
                        type = propTypes[prop.type] || {};

                    // If null, don't override start value
                    if (endValue === null) {
                        return;
                    }

                    // If null - use end
                    if (startValue === null) {
                        result[index] = endValue;
                    } else {
                        if (type.mod) {
                            if (endValue - startValue > type.mod / 2) {
                                startValue += type.mod;
                            } else if (startValue - endValue > type.mod / 2) {
                                startValue -= type.mod;
                            }
                        }
                        result[index] = clamp((endValue - startValue) * distance + startValue, prop);
                    }
                });
                return this[spaceName](result);
            },
            blend: function (opaque) {

                // If we are already opaque - return ourself
                if (this._rgba[3] === 1) {
                    return this;
                }

                var rgb = this._rgba.slice(),
                    a = rgb.pop(),
                    blend = color(opaque)._rgba;

                return color(jQuery.map(rgb, function (v, i) {
                    return (1 - a) * blend[i] + a * v;
                }));
            },
            toRgbaString: function () {
                var prefix = "rgba(",
                    rgba = jQuery.map(this._rgba, function (v, i) {
                        return v == null ? (i > 2 ? 1 : 0) : v;
                    });

                if (rgba[3] === 1) {
                    rgba.pop();
                    prefix = "rgb(";
                }

                return prefix + rgba.join() + ")";
            },
            toHslaString: function () {
                var prefix = "hsla(",
                    hsla = jQuery.map(this.hsla(), function (v, i) {
                        if (v == null) {
                            v = i > 2 ? 1 : 0;
                        }

                        // Catch 1 and 2
                        if (i && i < 3) {
                            v = Math.round(v * 100) + "%";
                        }
                        return v;
                    });

                if (hsla[3] === 1) {
                    hsla.pop();
                    prefix = "hsl(";
                }
                return prefix + hsla.join() + ")";
            },
            toHexString: function (includeAlpha) {
                var rgba = this._rgba.slice(),
                    alpha = rgba.pop();

                if (includeAlpha) {
                    rgba.push(~~(alpha * 255));
                }

                return "#" + jQuery.map(rgba, function (v) {

                    // Default to 0 when nulls exist
                    v = (v || 0).toString(16);
                    return v.length === 1 ? "0" + v : v;
                }).join("");
            },
            toString: function () {
                return this._rgba[3] === 0 ? "transparent" : this.toRgbaString();
            }
        });
        color.fn.parse.prototype = color.fn;

// Hsla conversions adapted from:
// https://code.google.com/p/maashaack/source/browse/packages/graphics/trunk/src/graphics/colors/HUE2RGB.as?r=5021

        function hue2rgb(p, q, h) {
            h = (h + 1) % 1;
            if (h * 6 < 1) {
                return p + (q - p) * h * 6;
            }
            if (h * 2 < 1) {
                return q;
            }
            if (h * 3 < 2) {
                return p + (q - p) * ((2 / 3) - h) * 6;
            }
            return p;
        }

        spaces.hsla.to = function (rgba) {
            if (rgba[0] == null || rgba[1] == null || rgba[2] == null) {
                return [null, null, null, rgba[3]];
            }
            var r = rgba[0] / 255,
                g = rgba[1] / 255,
                b = rgba[2] / 255,
                a = rgba[3],
                max = Math.max(r, g, b),
                min = Math.min(r, g, b),
                diff = max - min,
                add = max + min,
                l = add * 0.5,
                h, s;

            if (min === max) {
                h = 0;
            } else if (r === max) {
                h = (60 * (g - b) / diff) + 360;
            } else if (g === max) {
                h = (60 * (b - r) / diff) + 120;
            } else {
                h = (60 * (r - g) / diff) + 240;
            }

            // Chroma (diff) == 0 means greyscale which, by definition, saturation = 0%
            // otherwise, saturation is based on the ratio of chroma (diff) to lightness (add)
            if (diff === 0) {
                s = 0;
            } else if (l <= 0.5) {
                s = diff / add;
            } else {
                s = diff / (2 - add);
            }
            return [Math.round(h) % 360, s, l, a == null ? 1 : a];
        };

        spaces.hsla.from = function (hsla) {
            if (hsla[0] == null || hsla[1] == null || hsla[2] == null) {
                return [null, null, null, hsla[3]];
            }
            var h = hsla[0] / 360,
                s = hsla[1],
                l = hsla[2],
                a = hsla[3],
                q = l <= 0.5 ? l * (1 + s) : l + s - l * s,
                p = 2 * l - q;

            return [
                Math.round(hue2rgb(p, q, h + (1 / 3)) * 255),
                Math.round(hue2rgb(p, q, h) * 255),
                Math.round(hue2rgb(p, q, h - (1 / 3)) * 255),
                a
            ];
        };

        each(spaces, function (spaceName, space) {
            var props = space.props,
                cache = space.cache,
                to = space.to,
                from = space.from;

            // Makes rgba() and hsla()
            color.fn[spaceName] = function (value) {

                // Generate a cache for this space if it doesn't exist
                if (to && !this[cache]) {
                    this[cache] = to(this._rgba);
                }
                if (value === undefined) {
                    return this[cache].slice();
                }

                var ret,
                    type = jQuery.type(value),
                    arr = (type === "array" || type === "object") ? value : arguments,
                    local = this[cache].slice();

                each(props, function (key, prop) {
                    var val = arr[type === "object" ? key : prop.idx];
                    if (val == null) {
                        val = local[prop.idx];
                    }
                    local[prop.idx] = clamp(val, prop);
                });

                if (from) {
                    ret = color(from(local));
                    ret[cache] = local;
                    return ret;
                } else {
                    return color(local);
                }
            };

            // Makes red() green() blue() alpha() hue() saturation() lightness()
            each(props, function (key, prop) {

                // Alpha is included in more than one space
                if (color.fn[key]) {
                    return;
                }
                color.fn[key] = function (value) {
                    var vtype = jQuery.type(value),
                        fn = (key === "alpha" ? (this._hsla ? "hsla" : "rgba") : spaceName),
                        local = this[fn](),
                        cur = local[prop.idx],
                        match;

                    if (vtype === "undefined") {
                        return cur;
                    }

                    if (vtype === "function") {
                        value = value.call(this, cur);
                        vtype = jQuery.type(value);
                    }
                    if (value == null && prop.empty) {
                        return this;
                    }
                    if (vtype === "string") {
                        match = rplusequals.exec(value);
                        if (match) {
                            value = cur + parseFloat(match[2]) * (match[1] === "+" ? 1 : -1);
                        }
                    }
                    local[prop.idx] = value;
                    return this[fn](local);
                };
            });
        });

// Add cssHook and .fx.step function for each named hook.
// accept a space separated string of properties
        color.hook = function (hook) {
            var hooks = hook.split(" ");
            each(hooks, function (i, hook) {
                jQuery.cssHooks[hook] = {
                    set: function (elem, value) {
                        var parsed, curElem,
                            backgroundColor = "";

                        if (value !== "transparent" && (jQuery.type(value) !== "string" ||
                            (parsed = stringParse(value)))) {
                            value = color(parsed || value);
                            if (!support.rgba && value._rgba[3] !== 1) {
                                curElem = hook === "backgroundColor" ? elem.parentNode : elem;
                                while (
                                    (backgroundColor === "" || backgroundColor === "transparent") &&
                                    curElem && curElem.style
                                    ) {
                                    try {
                                        backgroundColor = jQuery.css(curElem, "backgroundColor");
                                        curElem = curElem.parentNode;
                                    } catch (e) {
                                    }
                                }

                                value = value.blend(backgroundColor && backgroundColor !== "transparent" ?
                                    backgroundColor :
                                    "_default");
                            }

                            value = value.toRgbaString();
                        }
                        try {
                            elem.style[hook] = value;
                        } catch (e) {

                            // Wrapped to prevent IE from throwing errors on "invalid" values like
                            // 'auto' or 'inherit'
                        }
                    }
                };
                jQuery.fx.step[hook] = function (fx) {
                    if (!fx.colorInit) {
                        fx.start = color(fx.elem, hook);
                        fx.end = color(fx.end);
                        fx.colorInit = true;
                    }
                    jQuery.cssHooks[hook].set(fx.elem, fx.start.transition(fx.end, fx.pos));
                };
            });

        };

        color.hook(stepHooks);

        jQuery.cssHooks.borderColor = {
            expand: function (value) {
                var expanded = {};

                each(["Top", "Right", "Bottom", "Left"], function (i, part) {
                    expanded["border" + part + "Color"] = value;
                });
                return expanded;
            }
        };

// Basic color names only.
// Usage of any of the other color names requires adding yourself or including
// jquery.color.svg-names.js.
        colors = jQuery.Color.names = {

            // 4.1. Basic color keywords
            aqua: "#00ffff",
            black: "#000000",
            blue: "#0000ff",
            fuchsia: "#ff00ff",
            gray: "#808080",
            green: "#008000",
            lime: "#00ff00",
            maroon: "#800000",
            navy: "#000080",
            olive: "#808000",
            purple: "#800080",
            red: "#ff0000",
            silver: "#c0c0c0",
            teal: "#008080",
            white: "#ffffff",
            yellow: "#ffff00",

            // 4.2.3. "transparent" color keyword
            transparent: [null, null, null, 0],

            _default: "#ffffff"
        };

    })(jQuery);

    /******************************************************************************/
    /****************************** CLASS ANIMATIONS ******************************/
    /******************************************************************************/
    (function () {

        var classAnimationActions = ["add", "remove", "toggle"],
            shorthandStyles = {
                border: 1,
                borderBottom: 1,
                borderColor: 1,
                borderLeft: 1,
                borderRight: 1,
                borderTop: 1,
                borderWidth: 1,
                margin: 1,
                padding: 1
            };

        $.each(
            ["borderLeftStyle", "borderRightStyle", "borderBottomStyle", "borderTopStyle"],
            function (_, prop) {
                $.fx.step[prop] = function (fx) {
                    if (fx.end !== "none" && !fx.setAttr || fx.pos === 1 && !fx.setAttr) {
                        jQuery.style(fx.elem, prop, fx.end);
                        fx.setAttr = true;
                    }
                };
            }
        );

        function getElementStyles(elem) {
            var key, len,
                style = elem.ownerDocument.defaultView ?
                    elem.ownerDocument.defaultView.getComputedStyle(elem, null) :
                    elem.currentStyle,
                styles = {};

            if (style && style.length && style[0] && style[style[0]]) {
                len = style.length;
                while (len--) {
                    key = style[len];
                    if (typeof style[key] === "string") {
                        styles[$.camelCase(key)] = style[key];
                    }
                }

                // Support: Opera, IE <9
            } else {
                for (key in style) {
                    if (typeof style[key] === "string") {
                        styles[key] = style[key];
                    }
                }
            }

            return styles;
        }

        function styleDifference(oldStyle, newStyle) {
            var diff = {},
                name, value;

            for (name in newStyle) {
                value = newStyle[name];
                if (oldStyle[name] !== value) {
                    if (!shorthandStyles[name]) {
                        if ($.fx.step[name] || !isNaN(parseFloat(value))) {
                            diff[name] = value;
                        }
                    }
                }
            }

            return diff;
        }

// Support: jQuery <1.8
        if (!$.fn.addBack) {
            $.fn.addBack = function (selector) {
                return this.add(selector == null ?
                    this.prevObject : this.prevObject.filter(selector)
                );
            };
        }

        $.effects.animateClass = function (value, duration, easing, callback) {
            var o = $.speed(duration, easing, callback);

            return this.queue(function () {
                var animated = $(this),
                    baseClass = animated.attr("class") || "",
                    applyClassChange,
                    allAnimations = o.children ? animated.find("*").addBack() : animated;

                // Map the animated objects to store the original styles.
                allAnimations = allAnimations.map(function () {
                    var el = $(this);
                    return {
                        el: el,
                        start: getElementStyles(this)
                    };
                });

                // Apply class change
                applyClassChange = function () {
                    $.each(classAnimationActions, function (i, action) {
                        if (value[action]) {
                            animated[action + "Class"](value[action]);
                        }
                    });
                };
                applyClassChange();

                // Map all animated objects again - calculate new styles and diff
                allAnimations = allAnimations.map(function () {
                    this.end = getElementStyles(this.el[0]);
                    this.diff = styleDifference(this.start, this.end);
                    return this;
                });

                // Apply original class
                animated.attr("class", baseClass);

                // Map all animated objects again - this time collecting a promise
                allAnimations = allAnimations.map(function () {
                    var styleInfo = this,
                        dfd = $.Deferred(),
                        opts = $.extend({}, o, {
                            queue: false,
                            complete: function () {
                                dfd.resolve(styleInfo);
                            }
                        });

                    this.el.animate(this.diff, opts);
                    return dfd.promise();
                });

                // Once all animations have completed:
                $.when.apply($, allAnimations.get()).done(function () {

                    // Set the final class
                    applyClassChange();

                    // For each animated element,
                    // clear all css properties that were animated
                    $.each(arguments, function () {
                        var el = this.el;
                        $.each(this.diff, function (key) {
                            el.css(key, "");
                        });
                    });

                    // This is guarnteed to be there if you use jQuery.speed()
                    // it also handles dequeuing the next anim...
                    o.complete.call(animated[0]);
                });
            });
        };

        $.fn.extend({
            addClass: (function (orig) {
                return function (classNames, speed, easing, callback) {
                    return speed ?
                        $.effects.animateClass.call(this,
                            {add: classNames}, speed, easing, callback) :
                        orig.apply(this, arguments);
                };
            })($.fn.addClass),

            removeClass: (function (orig) {
                return function (classNames, speed, easing, callback) {
                    return arguments.length > 1 ?
                        $.effects.animateClass.call(this,
                            {remove: classNames}, speed, easing, callback) :
                        orig.apply(this, arguments);
                };
            })($.fn.removeClass),

            toggleClass: (function (orig) {
                return function (classNames, force, speed, easing, callback) {
                    if (typeof force === "boolean" || force === undefined) {
                        if (!speed) {

                            // Without speed parameter
                            return orig.apply(this, arguments);
                        } else {
                            return $.effects.animateClass.call(this,
                                (force ? {add: classNames} : {remove: classNames}),
                                speed, easing, callback);
                        }
                    } else {

                        // Without force parameter
                        return $.effects.animateClass.call(this,
                            {toggle: classNames}, force, speed, easing);
                    }
                };
            })($.fn.toggleClass),

            switchClass: function (remove, add, speed, easing, callback) {
                return $.effects.animateClass.call(this, {
                    add: add,
                    remove: remove
                }, speed, easing, callback);
            }
        });

    })();

    /******************************************************************************/
    /*********************************** EFFECTS **********************************/
    /******************************************************************************/

    (function () {

        if ($.expr && $.expr.filters && $.expr.filters.animated) {
            $.expr.filters.animated = (function (orig) {
                return function (elem) {
                    return !!$(elem).data(dataSpaceAnimated) || orig(elem);
                };
            })($.expr.filters.animated);
        }

        if ($.uiBackCompat !== false) {
            $.extend($.effects, {

                // Saves a set of properties in a data storage
                save: function (element, set) {
                    var i = 0, length = set.length;
                    for (; i < length; i++) {
                        if (set[i] !== null) {
                            element.data(dataSpace + set[i], element[0].style[set[i]]);
                        }
                    }
                },

                // Restores a set of previously saved properties from a data storage
                restore: function (element, set) {
                    var val, i = 0, length = set.length;
                    for (; i < length; i++) {
                        if (set[i] !== null) {
                            val = element.data(dataSpace + set[i]);
                            element.css(set[i], val);
                        }
                    }
                },

                setMode: function (el, mode) {
                    if (mode === "toggle") {
                        mode = el.is(":hidden") ? "show" : "hide";
                    }
                    return mode;
                },

                // Wraps the element around a wrapper that copies position properties
                createWrapper: function (element) {

                    // If the element is already wrapped, return it
                    if (element.parent().is(".ui-effects-wrapper")) {
                        return element.parent();
                    }

                    // Wrap the element
                    var props = {
                            width: element.outerWidth(true),
                            height: element.outerHeight(true),
                            "float": element.css("float")
                        },
                        wrapper = $("<div></div>")
                            .addClass("ui-effects-wrapper")
                            .css({
                                fontSize: "100%",
                                background: "transparent",
                                border: "none",
                                margin: 0,
                                padding: 0
                            }),

                        // Store the size in case width/height are defined in % - Fixes #5245
                        size = {
                            width: element.width(),
                            height: element.height()
                        },
                        active = document.activeElement;

                    // Support: Firefox
                    // Firefox incorrectly exposes anonymous content
                    // https://bugzilla.mozilla.org/show_bug.cgi?id=561664
                    try {
                        active.id;
                    } catch (e) {
                        active = document.body;
                    }

                    element.wrap(wrapper);

                    // Fixes #7595 - Elements lose focus when wrapped.
                    if (element[0] === active || $.contains(element[0], active)) {
                        $(active).trigger("focus");
                    }

                    // Hotfix for jQuery 1.4 since some change in wrap() seems to actually
                    // lose the reference to the wrapped element
                    wrapper = element.parent();

                    // Transfer positioning properties to the wrapper
                    if (element.css("position") === "static") {
                        wrapper.css({position: "relative"});
                        element.css({position: "relative"});
                    } else {
                        $.extend(props, {
                            position: element.css("position"),
                            zIndex: element.css("z-index")
                        });
                        $.each(["top", "left", "bottom", "right"], function (i, pos) {
                            props[pos] = element.css(pos);
                            if (isNaN(parseInt(props[pos], 10))) {
                                props[pos] = "auto";
                            }
                        });
                        element.css({
                            position: "relative",
                            top: 0,
                            left: 0,
                            right: "auto",
                            bottom: "auto"
                        });
                    }
                    element.css(size);

                    return wrapper.css(props).show();
                },

                removeWrapper: function (element) {
                    var active = document.activeElement;

                    if (element.parent().is(".ui-effects-wrapper")) {
                        element.parent().replaceWith(element);

                        // Fixes #7595 - Elements lose focus when wrapped.
                        if (element[0] === active || $.contains(element[0], active)) {
                            $(active).trigger("focus");
                        }
                    }

                    return element;
                }
            });
        }

        $.extend($.effects, {
            version: "1.12.1",

            define: function (name, mode, effect) {
                if (!effect) {
                    effect = mode;
                    mode = "effect";
                }

                $.effects.effect[name] = effect;
                $.effects.effect[name].mode = mode;

                return effect;
            },

            scaledDimensions: function (element, percent, direction) {
                if (percent === 0) {
                    return {
                        height: 0,
                        width: 0,
                        outerHeight: 0,
                        outerWidth: 0
                    };
                }

                var x = direction !== "horizontal" ? ((percent || 100) / 100) : 1,
                    y = direction !== "vertical" ? ((percent || 100) / 100) : 1;

                return {
                    height: element.height() * y,
                    width: element.width() * x,
                    outerHeight: element.outerHeight() * y,
                    outerWidth: element.outerWidth() * x
                };

            },

            clipToBox: function (animation) {
                return {
                    width: animation.clip.right - animation.clip.left,
                    height: animation.clip.bottom - animation.clip.top,
                    left: animation.clip.left,
                    top: animation.clip.top
                };
            },

            // Injects recently queued functions to be first in line (after "inprogress")
            unshift: function (element, queueLength, count) {
                var queue = element.queue();

                if (queueLength > 1) {
                    queue.splice.apply(queue,
                        [1, 0].concat(queue.splice(queueLength, count)));
                }
                element.dequeue();
            },

            saveStyle: function (element) {
                element.data(dataSpaceStyle, element[0].style.cssText);
            },

            restoreStyle: function (element) {
                element[0].style.cssText = element.data(dataSpaceStyle) || "";
                element.removeData(dataSpaceStyle);
            },

            mode: function (element, mode) {
                var hidden = element.is(":hidden");

                if (mode === "toggle") {
                    mode = hidden ? "show" : "hide";
                }
                if (hidden ? mode === "hide" : mode === "show") {
                    mode = "none";
                }
                return mode;
            },

            // Translates a [top,left] array into a baseline value
            getBaseline: function (origin, original) {
                var y, x;

                switch (origin[0]) {
                    case "top":
                        y = 0;
                        break;
                    case "middle":
                        y = 0.5;
                        break;
                    case "bottom":
                        y = 1;
                        break;
                    default:
                        y = origin[0] / original.height;
                }

                switch (origin[1]) {
                    case "left":
                        x = 0;
                        break;
                    case "center":
                        x = 0.5;
                        break;
                    case "right":
                        x = 1;
                        break;
                    default:
                        x = origin[1] / original.width;
                }

                return {
                    x: x,
                    y: y
                };
            },

            // Creates a placeholder element so that the original element can be made absolute
            createPlaceholder: function (element) {
                var placeholder,
                    cssPosition = element.css("position"),
                    position = element.position();

                // Lock in margins first to account for form elements, which
                // will change margin if you explicitly set height
                // see: http://jsfiddle.net/JZSMt/3/ https://bugs.webkit.org/show_bug.cgi?id=107380
                // Support: Safari
                element.css({
                    marginTop: element.css("marginTop"),
                    marginBottom: element.css("marginBottom"),
                    marginLeft: element.css("marginLeft"),
                    marginRight: element.css("marginRight")
                })
                    .outerWidth(element.outerWidth())
                    .outerHeight(element.outerHeight());

                if (/^(static|relative)/.test(cssPosition)) {
                    cssPosition = "absolute";

                    placeholder = $("<" + element[0].nodeName + ">").insertAfter(element).css({

                        // Convert inline to inline block to account for inline elements
                        // that turn to inline block based on content (like img)
                        display: /^(inline|ruby)/.test(element.css("display")) ?
                            "inline-block" :
                            "block",
                        visibility: "hidden",

                        // Margins need to be set to account for margin collapse
                        marginTop: element.css("marginTop"),
                        marginBottom: element.css("marginBottom"),
                        marginLeft: element.css("marginLeft"),
                        marginRight: element.css("marginRight"),
                        "float": element.css("float")
                    })
                        .outerWidth(element.outerWidth())
                        .outerHeight(element.outerHeight())
                        .addClass("ui-effects-placeholder");

                    element.data(dataSpace + "placeholder", placeholder);
                }

                element.css({
                    position: cssPosition,
                    left: position.left,
                    top: position.top
                });

                return placeholder;
            },

            removePlaceholder: function (element) {
                var dataKey = dataSpace + "placeholder",
                    placeholder = element.data(dataKey);

                if (placeholder) {
                    placeholder.remove();
                    element.removeData(dataKey);
                }
            },

            // Removes a placeholder if it exists and restores
            // properties that were modified during placeholder creation
            cleanUp: function (element) {
                $.effects.restoreStyle(element);
                $.effects.removePlaceholder(element);
            },

            setTransition: function (element, list, factor, value) {
                value = value || {};
                $.each(list, function (i, x) {
                    var unit = element.cssUnit(x);
                    if (unit[0] > 0) {
                        value[x] = unit[0] * factor + unit[1];
                    }
                });
                return value;
            }
        });

// Return an effect options object for the given parameters:
        function _normalizeArguments(effect, options, speed, callback) {

            // Allow passing all options as the first parameter
            if ($.isPlainObject(effect)) {
                options = effect;
                effect = effect.effect;
            }

            // Convert to an object
            effect = {effect: effect};

            // Catch (effect, null, ...)
            if (options == null) {
                options = {};
            }

            // Catch (effect, callback)
            if ($.isFunction(options)) {
                callback = options;
                speed = null;
                options = {};
            }

            // Catch (effect, speed, ?)
            if (typeof options === "number" || $.fx.speeds[options]) {
                callback = speed;
                speed = options;
                options = {};
            }

            // Catch (effect, options, callback)
            if ($.isFunction(speed)) {
                callback = speed;
                speed = null;
            }

            // Add options to effect
            if (options) {
                $.extend(effect, options);
            }

            speed = speed || options.duration;
            effect.duration = $.fx.off ? 0 :
                typeof speed === "number" ? speed :
                    speed in $.fx.speeds ? $.fx.speeds[speed] :
                        $.fx.speeds._default;

            effect.complete = callback || options.complete;

            return effect;
        }

        function standardAnimationOption(option) {

            // Valid standard speeds (nothing, number, named speed)
            if (!option || typeof option === "number" || $.fx.speeds[option]) {
                return true;
            }

            // Invalid strings - treat as "normal" speed
            if (typeof option === "string" && !$.effects.effect[option]) {
                return true;
            }

            // Complete callback
            if ($.isFunction(option)) {
                return true;
            }

            // Options hash (but not naming an effect)
            if (typeof option === "object" && !option.effect) {
                return true;
            }

            // Didn't match any standard API
            return false;
        }

        $.fn.extend({
            effect: function (/* effect, options, speed, callback */) {
                var args = _normalizeArguments.apply(this, arguments),
                    effectMethod = $.effects.effect[args.effect],
                    defaultMode = effectMethod.mode,
                    queue = args.queue,
                    queueName = queue || "fx",
                    complete = args.complete,
                    mode = args.mode,
                    modes = [],
                    prefilter = function (next) {
                        var el = $(this),
                            normalizedMode = $.effects.mode(el, mode) || defaultMode;

                        // Sentinel for duck-punching the :animated psuedo-selector
                        el.data(dataSpaceAnimated, true);

                        // Save effect mode for later use,
                        // we can't just call $.effects.mode again later,
                        // as the .show() below destroys the initial state
                        modes.push(normalizedMode);

                        // See $.uiBackCompat inside of run() for removal of defaultMode in 1.13
                        if (defaultMode && (normalizedMode === "show" ||
                            (normalizedMode === defaultMode && normalizedMode === "hide"))) {
                            el.show();
                        }

                        if (!defaultMode || normalizedMode !== "none") {
                            $.effects.saveStyle(el);
                        }

                        if ($.isFunction(next)) {
                            next();
                        }
                    };

                if ($.fx.off || !effectMethod) {

                    // Delegate to the original method (e.g., .show()) if possible
                    if (mode) {
                        return this[mode](args.duration, complete);
                    } else {
                        return this.each(function () {
                            if (complete) {
                                complete.call(this);
                            }
                        });
                    }
                }

                function run(next) {
                    var elem = $(this);

                    function cleanup() {
                        elem.removeData(dataSpaceAnimated);

                        $.effects.cleanUp(elem);

                        if (args.mode === "hide") {
                            elem.hide();
                        }

                        done();
                    }

                    function done() {
                        if ($.isFunction(complete)) {
                            complete.call(elem[0]);
                        }

                        if ($.isFunction(next)) {
                            next();
                        }
                    }

                    // Override mode option on a per element basis,
                    // as toggle can be either show or hide depending on element state
                    args.mode = modes.shift();

                    if ($.uiBackCompat !== false && !defaultMode) {
                        if (elem.is(":hidden") ? mode === "hide" : mode === "show") {

                            // Call the core method to track "olddisplay" properly
                            elem[mode]();
                            done();
                        } else {
                            effectMethod.call(elem[0], args, done);
                        }
                    } else {
                        if (args.mode === "none") {

                            // Call the core method to track "olddisplay" properly
                            elem[mode]();
                            done();
                        } else {
                            effectMethod.call(elem[0], args, cleanup);
                        }
                    }
                }

                // Run prefilter on all elements first to ensure that
                // any showing or hiding happens before placeholder creation,
                // which ensures that any layout changes are correctly captured.
                return queue === false ?
                    this.each(prefilter).each(run) :
                    this.queue(queueName, prefilter).queue(queueName, run);
            },

            show: (function (orig) {
                return function (option) {
                    if (standardAnimationOption(option)) {
                        return orig.apply(this, arguments);
                    } else {
                        var args = _normalizeArguments.apply(this, arguments);
                        args.mode = "show";
                        return this.effect.call(this, args);
                    }
                };
            })($.fn.show),

            hide: (function (orig) {
                return function (option) {
                    if (standardAnimationOption(option)) {
                        return orig.apply(this, arguments);
                    } else {
                        var args = _normalizeArguments.apply(this, arguments);
                        args.mode = "hide";
                        return this.effect.call(this, args);
                    }
                };
            })($.fn.hide),

            toggle: (function (orig) {
                return function (option) {
                    if (standardAnimationOption(option) || typeof option === "boolean") {
                        return orig.apply(this, arguments);
                    } else {
                        var args = _normalizeArguments.apply(this, arguments);
                        args.mode = "toggle";
                        return this.effect.call(this, args);
                    }
                };
            })($.fn.toggle),

            cssUnit: function (key) {
                var style = this.css(key),
                    val = [];

                $.each(["em", "px", "%", "pt"], function (i, unit) {
                    if (style.indexOf(unit) > 0) {
                        val = [parseFloat(style), unit];
                    }
                });
                return val;
            },

            cssClip: function (clipObj) {
                if (clipObj) {
                    return this.css("clip", "rect(" + clipObj.top + "px " + clipObj.right + "px " +
                        clipObj.bottom + "px " + clipObj.left + "px)");
                }
                return parseClip(this.css("clip"), this);
            },

            transfer: function (options, done) {
                var element = $(this),
                    target = $(options.to),
                    targetFixed = target.css("position") === "fixed",
                    body = $("body"),
                    fixTop = targetFixed ? body.scrollTop() : 0,
                    fixLeft = targetFixed ? body.scrollLeft() : 0,
                    endPosition = target.offset(),
                    animation = {
                        top: endPosition.top - fixTop,
                        left: endPosition.left - fixLeft,
                        height: target.innerHeight(),
                        width: target.innerWidth()
                    },
                    startPosition = element.offset(),
                    transfer = $("<div class='ui-effects-transfer'></div>")
                        .appendTo("body")
                        .addClass(options.className)
                        .css({
                            top: startPosition.top - fixTop,
                            left: startPosition.left - fixLeft,
                            height: element.innerHeight(),
                            width: element.innerWidth(),
                            position: targetFixed ? "fixed" : "absolute"
                        })
                        .animate(animation, options.duration, options.easing, function () {
                            transfer.remove();
                            if ($.isFunction(done)) {
                                done();
                            }
                        });
            }
        });

        function parseClip(str, element) {
            var outerWidth = element.outerWidth(),
                outerHeight = element.outerHeight(),
                clipRegex = /^rect\((-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto)\)$/,
                values = clipRegex.exec(str) || ["", 0, outerWidth, outerHeight, 0];

            return {
                top: parseFloat(values[1]) || 0,
                right: values[2] === "auto" ? outerWidth : parseFloat(values[2]),
                bottom: values[3] === "auto" ? outerHeight : parseFloat(values[3]),
                left: parseFloat(values[4]) || 0
            };
        }

        $.fx.step.clip = function (fx) {
            if (!fx.clipInit) {
                fx.start = $(fx.elem).cssClip();
                if (typeof fx.end === "string") {
                    fx.end = parseClip(fx.end, fx.elem);
                }
                fx.clipInit = true;
            }

            $(fx.elem).cssClip({
                top: fx.pos * (fx.end.top - fx.start.top) + fx.start.top,
                right: fx.pos * (fx.end.right - fx.start.right) + fx.start.right,
                bottom: fx.pos * (fx.end.bottom - fx.start.bottom) + fx.start.bottom,
                left: fx.pos * (fx.end.left - fx.start.left) + fx.start.left
            });
        };

    })();

    /******************************************************************************/
    /*********************************** EASING ***********************************/
    /******************************************************************************/

    (function () {

// Based on easing equations from Robert Penner (http://www.robertpenner.com/easing)

        var baseEasings = {};

        $.each(["Quad", "Cubic", "Quart", "Quint", "Expo"], function (i, name) {
            baseEasings[name] = function (p) {
                return Math.pow(p, i + 2);
            };
        });

        $.extend(baseEasings, {
            Sine: function (p) {
                return 1 - Math.cos(p * Math.PI / 2);
            },
            Circ: function (p) {
                return 1 - Math.sqrt(1 - p * p);
            },
            Elastic: function (p) {
                return p === 0 || p === 1 ? p :
                    -Math.pow(2, 8 * (p - 1)) * Math.sin(((p - 1) * 80 - 7.5) * Math.PI / 15);
            },
            Back: function (p) {
                return p * p * (3 * p - 2);
            },
            Bounce: function (p) {
                var pow2,
                    bounce = 4;

                while (p < ((pow2 = Math.pow(2, --bounce)) - 1) / 11) {
                }
                return 1 / Math.pow(4, 3 - bounce) - 7.5625 * Math.pow((pow2 * 3 - 2) / 22 - p, 2);
            }
        });

        $.each(baseEasings, function (name, easeIn) {
            $.easing["easeIn" + name] = easeIn;
            $.easing["easeOut" + name] = function (p) {
                return 1 - easeIn(1 - p);
            };
            $.easing["easeInOut" + name] = function (p) {
                return p < 0.5 ?
                    easeIn(p * 2) / 2 :
                    1 - easeIn(p * -2 + 2) / 2;
            };
        });

    })();

    var effect = $.effects;


    /*!
 * jQuery UI Effects Blind 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Blind Effect
//>>group: Effects
//>>description: Blinds the element.
//>>docs: http://api.jqueryui.com/blind-effect/
//>>demos: http://jqueryui.com/effect/


    var effectsEffectBlind = $.effects.define("blind", "hide", function (options, done) {
        var map = {
                up: ["bottom", "top"],
                vertical: ["bottom", "top"],
                down: ["top", "bottom"],
                left: ["right", "left"],
                horizontal: ["right", "left"],
                right: ["left", "right"]
            },
            element = $(this),
            direction = options.direction || "up",
            start = element.cssClip(),
            animate = {clip: $.extend({}, start)},
            placeholder = $.effects.createPlaceholder(element);

        animate.clip[map[direction][0]] = animate.clip[map[direction][1]];

        if (options.mode === "show") {
            element.cssClip(animate.clip);
            if (placeholder) {
                placeholder.css($.effects.clipToBox(animate));
            }

            animate.clip = start;
        }

        if (placeholder) {
            placeholder.animate($.effects.clipToBox(animate), options.duration, options.easing);
        }

        element.animate(animate, {
            queue: false,
            duration: options.duration,
            easing: options.easing,
            complete: done
        });
    });


    /*!
 * jQuery UI Effects Bounce 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Bounce Effect
//>>group: Effects
//>>description: Bounces an element horizontally or vertically n times.
//>>docs: http://api.jqueryui.com/bounce-effect/
//>>demos: http://jqueryui.com/effect/


    var effectsEffectBounce = $.effects.define("bounce", function (options, done) {
        var upAnim, downAnim, refValue,
            element = $(this),

            // Defaults:
            mode = options.mode,
            hide = mode === "hide",
            show = mode === "show",
            direction = options.direction || "up",
            distance = options.distance,
            times = options.times || 5,

            // Number of internal animations
            anims = times * 2 + (show || hide ? 1 : 0),
            speed = options.duration / anims,
            easing = options.easing,

            // Utility:
            ref = (direction === "up" || direction === "down") ? "top" : "left",
            motion = (direction === "up" || direction === "left"),
            i = 0,

            queuelen = element.queue().length;

        $.effects.createPlaceholder(element);

        refValue = element.css(ref);

        // Default distance for the BIGGEST bounce is the outer Distance / 3
        if (!distance) {
            distance = element[ref === "top" ? "outerHeight" : "outerWidth"]() / 3;
        }

        if (show) {
            downAnim = {opacity: 1};
            downAnim[ref] = refValue;

            // If we are showing, force opacity 0 and set the initial position
            // then do the "first" animation
            element
                .css("opacity", 0)
                .css(ref, motion ? -distance * 2 : distance * 2)
                .animate(downAnim, speed, easing);
        }

        // Start at the smallest distance if we are hiding
        if (hide) {
            distance = distance / Math.pow(2, times - 1);
        }

        downAnim = {};
        downAnim[ref] = refValue;

        // Bounces up/down/left/right then back to 0 -- times * 2 animations happen here
        for (; i < times; i++) {
            upAnim = {};
            upAnim[ref] = (motion ? "-=" : "+=") + distance;

            element
                .animate(upAnim, speed, easing)
                .animate(downAnim, speed, easing);

            distance = hide ? distance * 2 : distance / 2;
        }

        // Last Bounce when Hiding
        if (hide) {
            upAnim = {opacity: 0};
            upAnim[ref] = (motion ? "-=" : "+=") + distance;

            element.animate(upAnim, speed, easing);
        }

        element.queue(done);

        $.effects.unshift(element, queuelen, anims + 1);
    });


    /*!
 * jQuery UI Effects Clip 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Clip Effect
//>>group: Effects
//>>description: Clips the element on and off like an old TV.
//>>docs: http://api.jqueryui.com/clip-effect/
//>>demos: http://jqueryui.com/effect/


    var effectsEffectClip = $.effects.define("clip", "hide", function (options, done) {
        var start,
            animate = {},
            element = $(this),
            direction = options.direction || "vertical",
            both = direction === "both",
            horizontal = both || direction === "horizontal",
            vertical = both || direction === "vertical";

        start = element.cssClip();
        animate.clip = {
            top: vertical ? (start.bottom - start.top) / 2 : start.top,
            right: horizontal ? (start.right - start.left) / 2 : start.right,
            bottom: vertical ? (start.bottom - start.top) / 2 : start.bottom,
            left: horizontal ? (start.right - start.left) / 2 : start.left
        };

        $.effects.createPlaceholder(element);

        if (options.mode === "show") {
            element.cssClip(animate.clip);
            animate.clip = start;
        }

        element.animate(animate, {
            queue: false,
            duration: options.duration,
            easing: options.easing,
            complete: done
        });

    });


    /*!
 * jQuery UI Effects Drop 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Drop Effect
//>>group: Effects
//>>description: Moves an element in one direction and hides it at the same time.
//>>docs: http://api.jqueryui.com/drop-effect/
//>>demos: http://jqueryui.com/effect/


    var effectsEffectDrop = $.effects.define("drop", "hide", function (options, done) {

        var distance,
            element = $(this),
            mode = options.mode,
            show = mode === "show",
            direction = options.direction || "left",
            ref = (direction === "up" || direction === "down") ? "top" : "left",
            motion = (direction === "up" || direction === "left") ? "-=" : "+=",
            oppositeMotion = (motion === "+=") ? "-=" : "+=",
            animation = {
                opacity: 0
            };

        $.effects.createPlaceholder(element);

        distance = options.distance ||
            element[ref === "top" ? "outerHeight" : "outerWidth"](true) / 2;

        animation[ref] = motion + distance;

        if (show) {
            element.css(animation);

            animation[ref] = oppositeMotion + distance;
            animation.opacity = 1;
        }

        // Animate
        element.animate(animation, {
            queue: false,
            duration: options.duration,
            easing: options.easing,
            complete: done
        });
    });


    /*!
 * jQuery UI Effects Explode 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Explode Effect
//>>group: Effects
// jscs:disable maximumLineLength
//>>description: Explodes an element in all directions into n pieces. Implodes an element to its original wholeness.
// jscs:enable maximumLineLength
//>>docs: http://api.jqueryui.com/explode-effect/
//>>demos: http://jqueryui.com/effect/


    var effectsEffectExplode = $.effects.define("explode", "hide", function (options, done) {

        var i, j, left, top, mx, my,
            rows = options.pieces ? Math.round(Math.sqrt(options.pieces)) : 3,
            cells = rows,
            element = $(this),
            mode = options.mode,
            show = mode === "show",

            // Show and then visibility:hidden the element before calculating offset
            offset = element.show().css("visibility", "hidden").offset(),

            // Width and height of a piece
            width = Math.ceil(element.outerWidth() / cells),
            height = Math.ceil(element.outerHeight() / rows),
            pieces = [];

        // Children animate complete:
        function childComplete() {
            pieces.push(this);
            if (pieces.length === rows * cells) {
                animComplete();
            }
        }

        // Clone the element for each row and cell.
        for (i = 0; i < rows; i++) { // ===>
            top = offset.top + i * height;
            my = i - (rows - 1) / 2;

            for (j = 0; j < cells; j++) { // |||
                left = offset.left + j * width;
                mx = j - (cells - 1) / 2;

                // Create a clone of the now hidden main element that will be absolute positioned
                // within a wrapper div off the -left and -top equal to size of our pieces
                element
                    .clone()
                    .appendTo("body")
                    .wrap("<div></div>")
                    .css({
                        position: "absolute",
                        visibility: "visible",
                        left: -j * width,
                        top: -i * height
                    })

                    // Select the wrapper - make it overflow: hidden and absolute positioned based on
                    // where the original was located +left and +top equal to the size of pieces
                    .parent()
                    .addClass("ui-effects-explode")
                    .css({
                        position: "absolute",
                        overflow: "hidden",
                        width: width,
                        height: height,
                        left: left + (show ? mx * width : 0),
                        top: top + (show ? my * height : 0),
                        opacity: show ? 0 : 1
                    })
                    .animate({
                        left: left + (show ? 0 : mx * width),
                        top: top + (show ? 0 : my * height),
                        opacity: show ? 1 : 0
                    }, options.duration || 500, options.easing, childComplete);
            }
        }

        function animComplete() {
            element.css({
                visibility: "visible"
            });
            $(pieces).remove();
            done();
        }
    });


    /*!
 * jQuery UI Effects Fade 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Fade Effect
//>>group: Effects
//>>description: Fades the element.
//>>docs: http://api.jqueryui.com/fade-effect/
//>>demos: http://jqueryui.com/effect/


    var effectsEffectFade = $.effects.define("fade", "toggle", function (options, done) {
        var show = options.mode === "show";

        $(this)
            .css("opacity", show ? 0 : 1)
            .animate({
                opacity: show ? 1 : 0
            }, {
                queue: false,
                duration: options.duration,
                easing: options.easing,
                complete: done
            });
    });


    /*!
 * jQuery UI Effects Fold 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Fold Effect
//>>group: Effects
//>>description: Folds an element first horizontally and then vertically.
//>>docs: http://api.jqueryui.com/fold-effect/
//>>demos: http://jqueryui.com/effect/


    var effectsEffectFold = $.effects.define("fold", "hide", function (options, done) {

        // Create element
        var element = $(this),
            mode = options.mode,
            show = mode === "show",
            hide = mode === "hide",
            size = options.size || 15,
            percent = /([0-9]+)%/.exec(size),
            horizFirst = !!options.horizFirst,
            ref = horizFirst ? ["right", "bottom"] : ["bottom", "right"],
            duration = options.duration / 2,

            placeholder = $.effects.createPlaceholder(element),

            start = element.cssClip(),
            animation1 = {clip: $.extend({}, start)},
            animation2 = {clip: $.extend({}, start)},

            distance = [start[ref[0]], start[ref[1]]],

            queuelen = element.queue().length;

        if (percent) {
            size = parseInt(percent[1], 10) / 100 * distance[hide ? 0 : 1];
        }
        animation1.clip[ref[0]] = size;
        animation2.clip[ref[0]] = size;
        animation2.clip[ref[1]] = 0;

        if (show) {
            element.cssClip(animation2.clip);
            if (placeholder) {
                placeholder.css($.effects.clipToBox(animation2));
            }

            animation2.clip = start;
        }

        // Animate
        element
            .queue(function (next) {
                if (placeholder) {
                    placeholder
                        .animate($.effects.clipToBox(animation1), duration, options.easing)
                        .animate($.effects.clipToBox(animation2), duration, options.easing);
                }

                next();
            })
            .animate(animation1, duration, options.easing)
            .animate(animation2, duration, options.easing)
            .queue(done);

        $.effects.unshift(element, queuelen, 4);
    });


    /*!
 * jQuery UI Effects Highlight 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Highlight Effect
//>>group: Effects
//>>description: Highlights the background of an element in a defined color for a custom duration.
//>>docs: http://api.jqueryui.com/highlight-effect/
//>>demos: http://jqueryui.com/effect/


    var effectsEffectHighlight = $.effects.define("highlight", "show", function (options, done) {
        var element = $(this),
            animation = {
                backgroundColor: element.css("backgroundColor")
            };

        if (options.mode === "hide") {
            animation.opacity = 0;
        }

        $.effects.saveStyle(element);

        element
            .css({
                backgroundImage: "none",
                backgroundColor: options.color || "#ffff99"
            })
            .animate(animation, {
                queue: false,
                duration: options.duration,
                easing: options.easing,
                complete: done
            });
    });


    /*!
 * jQuery UI Effects Size 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Size Effect
//>>group: Effects
//>>description: Resize an element to a specified width and height.
//>>docs: http://api.jqueryui.com/size-effect/
//>>demos: http://jqueryui.com/effect/


    var effectsEffectSize = $.effects.define("size", function (options, done) {

        // Create element
        var baseline, factor, temp,
            element = $(this),

            // Copy for children
            cProps = ["fontSize"],
            vProps = ["borderTopWidth", "borderBottomWidth", "paddingTop", "paddingBottom"],
            hProps = ["borderLeftWidth", "borderRightWidth", "paddingLeft", "paddingRight"],

            // Set options
            mode = options.mode,
            restore = mode !== "effect",
            scale = options.scale || "both",
            origin = options.origin || ["middle", "center"],
            position = element.css("position"),
            pos = element.position(),
            original = $.effects.scaledDimensions(element),
            from = options.from || original,
            to = options.to || $.effects.scaledDimensions(element, 0);

        $.effects.createPlaceholder(element);

        if (mode === "show") {
            temp = from;
            from = to;
            to = temp;
        }

        // Set scaling factor
        factor = {
            from: {
                y: from.height / original.height,
                x: from.width / original.width
            },
            to: {
                y: to.height / original.height,
                x: to.width / original.width
            }
        };

        // Scale the css box
        if (scale === "box" || scale === "both") {

            // Vertical props scaling
            if (factor.from.y !== factor.to.y) {
                from = $.effects.setTransition(element, vProps, factor.from.y, from);
                to = $.effects.setTransition(element, vProps, factor.to.y, to);
            }

            // Horizontal props scaling
            if (factor.from.x !== factor.to.x) {
                from = $.effects.setTransition(element, hProps, factor.from.x, from);
                to = $.effects.setTransition(element, hProps, factor.to.x, to);
            }
        }

        // Scale the content
        if (scale === "content" || scale === "both") {

            // Vertical props scaling
            if (factor.from.y !== factor.to.y) {
                from = $.effects.setTransition(element, cProps, factor.from.y, from);
                to = $.effects.setTransition(element, cProps, factor.to.y, to);
            }
        }

        // Adjust the position properties based on the provided origin points
        if (origin) {
            baseline = $.effects.getBaseline(origin, original);
            from.top = (original.outerHeight - from.outerHeight) * baseline.y + pos.top;
            from.left = (original.outerWidth - from.outerWidth) * baseline.x + pos.left;
            to.top = (original.outerHeight - to.outerHeight) * baseline.y + pos.top;
            to.left = (original.outerWidth - to.outerWidth) * baseline.x + pos.left;
        }
        element.css(from);

        // Animate the children if desired
        if (scale === "content" || scale === "both") {

            vProps = vProps.concat(["marginTop", "marginBottom"]).concat(cProps);
            hProps = hProps.concat(["marginLeft", "marginRight"]);

            // Only animate children with width attributes specified
            // TODO: is this right? should we include anything with css width specified as well
            element.find("*[width]").each(function () {
                var child = $(this),
                    childOriginal = $.effects.scaledDimensions(child),
                    childFrom = {
                        height: childOriginal.height * factor.from.y,
                        width: childOriginal.width * factor.from.x,
                        outerHeight: childOriginal.outerHeight * factor.from.y,
                        outerWidth: childOriginal.outerWidth * factor.from.x
                    },
                    childTo = {
                        height: childOriginal.height * factor.to.y,
                        width: childOriginal.width * factor.to.x,
                        outerHeight: childOriginal.height * factor.to.y,
                        outerWidth: childOriginal.width * factor.to.x
                    };

                // Vertical props scaling
                if (factor.from.y !== factor.to.y) {
                    childFrom = $.effects.setTransition(child, vProps, factor.from.y, childFrom);
                    childTo = $.effects.setTransition(child, vProps, factor.to.y, childTo);
                }

                // Horizontal props scaling
                if (factor.from.x !== factor.to.x) {
                    childFrom = $.effects.setTransition(child, hProps, factor.from.x, childFrom);
                    childTo = $.effects.setTransition(child, hProps, factor.to.x, childTo);
                }

                if (restore) {
                    $.effects.saveStyle(child);
                }

                // Animate children
                child.css(childFrom);
                child.animate(childTo, options.duration, options.easing, function () {

                    // Restore children
                    if (restore) {
                        $.effects.restoreStyle(child);
                    }
                });
            });
        }

        // Animate
        element.animate(to, {
            queue: false,
            duration: options.duration,
            easing: options.easing,
            complete: function () {

                var offset = element.offset();

                if (to.opacity === 0) {
                    element.css("opacity", from.opacity);
                }

                if (!restore) {
                    element
                        .css("position", position === "static" ? "relative" : position)
                        .offset(offset);

                    // Need to save style here so that automatic style restoration
                    // doesn't restore to the original styles from before the animation.
                    $.effects.saveStyle(element);
                }

                done();
            }
        });

    });


    /*!
 * jQuery UI Effects Scale 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Scale Effect
//>>group: Effects
//>>description: Grows or shrinks an element and its content.
//>>docs: http://api.jqueryui.com/scale-effect/
//>>demos: http://jqueryui.com/effect/


    var effectsEffectScale = $.effects.define("scale", function (options, done) {

        // Create element
        var el = $(this),
            mode = options.mode,
            percent = parseInt(options.percent, 10) ||
                (parseInt(options.percent, 10) === 0 ? 0 : (mode !== "effect" ? 0 : 100)),

            newOptions = $.extend(true, {
                from: $.effects.scaledDimensions(el),
                to: $.effects.scaledDimensions(el, percent, options.direction || "both"),
                origin: options.origin || ["middle", "center"]
            }, options);

        // Fade option to support puff
        if (options.fade) {
            newOptions.from.opacity = 1;
            newOptions.to.opacity = 0;
        }

        $.effects.effect.size.call(this, newOptions, done);
    });


    /*!
 * jQuery UI Effects Puff 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Puff Effect
//>>group: Effects
//>>description: Creates a puff effect by scaling the element up and hiding it at the same time.
//>>docs: http://api.jqueryui.com/puff-effect/
//>>demos: http://jqueryui.com/effect/


    var effectsEffectPuff = $.effects.define("puff", "hide", function (options, done) {
        var newOptions = $.extend(true, {}, options, {
            fade: true,
            percent: parseInt(options.percent, 10) || 150
        });

        $.effects.effect.scale.call(this, newOptions, done);
    });


    /*!
 * jQuery UI Effects Pulsate 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Pulsate Effect
//>>group: Effects
//>>description: Pulsates an element n times by changing the opacity to zero and back.
//>>docs: http://api.jqueryui.com/pulsate-effect/
//>>demos: http://jqueryui.com/effect/


    var effectsEffectPulsate = $.effects.define("pulsate", "show", function (options, done) {
        var element = $(this),
            mode = options.mode,
            show = mode === "show",
            hide = mode === "hide",
            showhide = show || hide,

            // Showing or hiding leaves off the "last" animation
            anims = ((options.times || 5) * 2) + (showhide ? 1 : 0),
            duration = options.duration / anims,
            animateTo = 0,
            i = 1,
            queuelen = element.queue().length;

        if (show || !element.is(":visible")) {
            element.css("opacity", 0).show();
            animateTo = 1;
        }

        // Anims - 1 opacity "toggles"
        for (; i < anims; i++) {
            element.animate({opacity: animateTo}, duration, options.easing);
            animateTo = 1 - animateTo;
        }

        element.animate({opacity: animateTo}, duration, options.easing);

        element.queue(done);

        $.effects.unshift(element, queuelen, anims + 1);
    });


    /*!
 * jQuery UI Effects Shake 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Shake Effect
//>>group: Effects
//>>description: Shakes an element horizontally or vertically n times.
//>>docs: http://api.jqueryui.com/shake-effect/
//>>demos: http://jqueryui.com/effect/


    var effectsEffectShake = $.effects.define("shake", function (options, done) {

        var i = 1,
            element = $(this),
            direction = options.direction || "left",
            distance = options.distance || 20,
            times = options.times || 3,
            anims = times * 2 + 1,
            speed = Math.round(options.duration / anims),
            ref = (direction === "up" || direction === "down") ? "top" : "left",
            positiveMotion = (direction === "up" || direction === "left"),
            animation = {},
            animation1 = {},
            animation2 = {},

            queuelen = element.queue().length;

        $.effects.createPlaceholder(element);

        // Animation
        animation[ref] = (positiveMotion ? "-=" : "+=") + distance;
        animation1[ref] = (positiveMotion ? "+=" : "-=") + distance * 2;
        animation2[ref] = (positiveMotion ? "-=" : "+=") + distance * 2;

        // Animate
        element.animate(animation, speed, options.easing);

        // Shakes
        for (; i < times; i++) {
            element
                .animate(animation1, speed, options.easing)
                .animate(animation2, speed, options.easing);
        }

        element
            .animate(animation1, speed, options.easing)
            .animate(animation, speed / 2, options.easing)
            .queue(done);

        $.effects.unshift(element, queuelen, anims + 1);
    });


    /*!
 * jQuery UI Effects Slide 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Slide Effect
//>>group: Effects
//>>description: Slides an element in and out of the viewport.
//>>docs: http://api.jqueryui.com/slide-effect/
//>>demos: http://jqueryui.com/effect/


    var effectsEffectSlide = $.effects.define("slide", "show", function (options, done) {
        var startClip, startRef,
            element = $(this),
            map = {
                up: ["bottom", "top"],
                down: ["top", "bottom"],
                left: ["right", "left"],
                right: ["left", "right"]
            },
            mode = options.mode,
            direction = options.direction || "left",
            ref = (direction === "up" || direction === "down") ? "top" : "left",
            positiveMotion = (direction === "up" || direction === "left"),
            distance = options.distance ||
                element[ref === "top" ? "outerHeight" : "outerWidth"](true),
            animation = {};

        $.effects.createPlaceholder(element);

        startClip = element.cssClip();
        startRef = element.position()[ref];

        // Define hide animation
        animation[ref] = (positiveMotion ? -1 : 1) * distance + startRef;
        animation.clip = element.cssClip();
        animation.clip[map[direction][1]] = animation.clip[map[direction][0]];

        // Reverse the animation if we're showing
        if (mode === "show") {
            element.cssClip(animation.clip);
            element.css(ref, animation[ref]);
            animation.clip = startClip;
            animation[ref] = startRef;
        }

        // Actually animate
        element.animate(animation, {
            queue: false,
            duration: options.duration,
            easing: options.easing,
            complete: done
        });
    });


    /*!
 * jQuery UI Effects Transfer 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Transfer Effect
//>>group: Effects
//>>description: Displays a transfer effect from one element to another.
//>>docs: http://api.jqueryui.com/transfer-effect/
//>>demos: http://jqueryui.com/effect/


    var effect;
    if ($.uiBackCompat !== false) {
        effect = $.effects.define("transfer", function (options, done) {
            $(this).transfer(options, done);
        });
    }
    var effectsEffectTransfer = effect;


    /*!
 * jQuery UI Focusable 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: :focusable Selector
//>>group: Core
//>>description: Selects elements which can be focused.
//>>docs: http://api.jqueryui.com/focusable-selector/


// Selectors
    $.ui.focusable = function (element, hasTabindex) {
        var map, mapName, img, focusableIfVisible, fieldset,
            nodeName = element.nodeName.toLowerCase();

        if ("area" === nodeName) {
            map = element.parentNode;
            mapName = map.name;
            if (!element.href || !mapName || map.nodeName.toLowerCase() !== "map") {
                return false;
            }
            img = $("img[usemap='#" + mapName + "']");
            return img.length > 0 && img.is(":visible");
        }

        if (/^(input|select|textarea|button|object)$/.test(nodeName)) {
            focusableIfVisible = !element.disabled;

            if (focusableIfVisible) {

                // Form controls within a disabled fieldset are disabled.
                // However, controls within the fieldset's legend do not get disabled.
                // Since controls generally aren't placed inside legends, we skip
                // this portion of the check.
                fieldset = $(element).closest("fieldset")[0];
                if (fieldset) {
                    focusableIfVisible = !fieldset.disabled;
                }
            }
        } else if ("a" === nodeName) {
            focusableIfVisible = element.href || hasTabindex;
        } else {
            focusableIfVisible = hasTabindex;
        }

        return focusableIfVisible && $(element).is(":visible") && visible($(element));
    };

// Support: IE 8 only
// IE 8 doesn't resolve inherit to visible/hidden for computed values
    function visible(element) {
        var visibility = element.css("visibility");
        while (visibility === "inherit") {
            element = element.parent();
            visibility = element.css("visibility");
        }
        return visibility !== "hidden";
    }

    $.extend($.expr[":"], {
        focusable: function (element) {
            return $.ui.focusable(element, $.attr(element, "tabindex") != null);
        }
    });

    var focusable = $.ui.focusable;


// Support: IE8 Only
// IE8 does not support the form attribute and when it is supplied. It overwrites the form prop
// with a string, so we need to find the proper form.
    var form = $.fn.form = function () {
        return typeof this[0].form === "string" ? this.closest("form") : $(this[0].form);
    };


    /*!
 * jQuery UI Form Reset Mixin 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Form Reset Mixin
//>>group: Core
//>>description: Refresh input widgets when their form is reset
//>>docs: http://api.jqueryui.com/form-reset-mixin/


    var formResetMixin = $.ui.formResetMixin = {
        _formResetHandler: function () {
            var form = $(this);

            // Wait for the form reset to actually happen before refreshing
            setTimeout(function () {
                var instances = form.data("ui-form-reset-instances");
                $.each(instances, function () {
                    this.refresh();
                });
            });
        },

        _bindFormResetHandler: function () {
            this.form = this.element.form();
            if (!this.form.length) {
                return;
            }

            var instances = this.form.data("ui-form-reset-instances") || [];
            if (!instances.length) {

                // We don't use _on() here because we use a single event handler per form
                this.form.on("reset.ui-form-reset", this._formResetHandler);
            }
            instances.push(this);
            this.form.data("ui-form-reset-instances", instances);
        },

        _unbindFormResetHandler: function () {
            if (!this.form.length) {
                return;
            }

            var instances = this.form.data("ui-form-reset-instances");
            instances.splice($.inArray(this, instances), 1);
            if (instances.length) {
                this.form.data("ui-form-reset-instances", instances);
            } else {
                this.form
                    .removeData("ui-form-reset-instances")
                    .off("reset.ui-form-reset");
            }
        }
    };


    /*!
 * jQuery UI Support for jQuery core 1.7.x 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 */

//>>label: jQuery 1.7 Support
//>>group: Core
//>>description: Support version 1.7.x of jQuery core


// Support: jQuery 1.7 only
// Not a great way to check versions, but since we only support 1.7+ and only
// need to detect <1.8, this is a simple check that should suffice. Checking
// for "1.7." would be a bit safer, but the version string is 1.7, not 1.7.0
// and we'll never reach 1.70.0 (if we do, we certainly won't be supporting
// 1.7 anymore). See #11197 for why we're not using feature detection.
    if ($.fn.jquery.substring(0, 3) === "1.7") {

        // Setters for .innerWidth(), .innerHeight(), .outerWidth(), .outerHeight()
        // Unlike jQuery Core 1.8+, these only support numeric values to set the
        // dimensions in pixels
        $.each(["Width", "Height"], function (i, name) {
            var side = name === "Width" ? ["Left", "Right"] : ["Top", "Bottom"],
                type = name.toLowerCase(),
                orig = {
                    innerWidth: $.fn.innerWidth,
                    innerHeight: $.fn.innerHeight,
                    outerWidth: $.fn.outerWidth,
                    outerHeight: $.fn.outerHeight
                };

            function reduce(elem, size, border, margin) {
                $.each(side, function () {
                    size -= parseFloat($.css(elem, "padding" + this)) || 0;
                    if (border) {
                        size -= parseFloat($.css(elem, "border" + this + "Width")) || 0;
                    }
                    if (margin) {
                        size -= parseFloat($.css(elem, "margin" + this)) || 0;
                    }
                });
                return size;
            }

            $.fn["inner" + name] = function (size) {
                if (size === undefined) {
                    return orig["inner" + name].call(this);
                }

                return this.each(function () {
                    $(this).css(type, reduce(this, size) + "px");
                });
            };

            $.fn["outer" + name] = function (size, margin) {
                if (typeof size !== "number") {
                    return orig["outer" + name].call(this, size);
                }

                return this.each(function () {
                    $(this).css(type, reduce(this, size, true, margin) + "px");
                });
            };
        });

        $.fn.addBack = function (selector) {
            return this.add(selector == null ?
                this.prevObject : this.prevObject.filter(selector)
            );
        };
    }

    ;
    /*!
 * jQuery UI Keycode 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Keycode
//>>group: Core
//>>description: Provide keycodes as keynames
//>>docs: http://api.jqueryui.com/jQuery.ui.keyCode/


    var keycode = $.ui.keyCode = {
        BACKSPACE: 8,
        COMMA: 188,
        DELETE: 46,
        DOWN: 40,
        END: 35,
        ENTER: 13,
        ESCAPE: 27,
        HOME: 36,
        LEFT: 37,
        PAGE_DOWN: 34,
        PAGE_UP: 33,
        PERIOD: 190,
        RIGHT: 39,
        SPACE: 32,
        TAB: 9,
        UP: 38
    };


// Internal use only
    var escapeSelector = $.ui.escapeSelector = (function () {
        var selectorEscape = /([!"#$%&'()*+,./:;<=>?@[\]^`{|}~])/g;
        return function (selector) {
            return selector.replace(selectorEscape, "\\$1");
        };
    })();


    /*!
 * jQuery UI Labels 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: labels
//>>group: Core
//>>description: Find all the labels associated with a given input
//>>docs: http://api.jqueryui.com/labels/


    var labels = $.fn.labels = function () {
        var ancestor, selector, id, labels, ancestors;

        // Check control.labels first
        if (this[0].labels && this[0].labels.length) {
            return this.pushStack(this[0].labels);
        }

        // Support: IE <= 11, FF <= 37, Android <= 2.3 only
        // Above browsers do not support control.labels. Everything below is to support them
        // as well as document fragments. control.labels does not work on document fragments
        labels = this.eq(0).parents("label");

        // Look for the label based on the id
        id = this.attr("id");
        if (id) {

            // We don't search against the document in case the element
            // is disconnected from the DOM
            ancestor = this.eq(0).parents().last();

            // Get a full set of top level ancestors
            ancestors = ancestor.add(ancestor.length ? ancestor.siblings() : this.siblings());

            // Create a selector for the label based on the id
            selector = "label[for='" + $.ui.escapeSelector(id) + "']";

            labels = labels.add(ancestors.find(selector).addBack(selector));

        }

        // Return whatever we have found for labels
        return this.pushStack(labels);
    };


    /*!
 * jQuery UI Scroll Parent 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: scrollParent
//>>group: Core
//>>description: Get the closest ancestor element that is scrollable.
//>>docs: http://api.jqueryui.com/scrollParent/


    var scrollParent = $.fn.scrollParent = function (includeHidden) {
        var position = this.css("position"),
            excludeStaticParent = position === "absolute",
            overflowRegex = includeHidden ? /(auto|scroll|hidden)/ : /(auto|scroll)/,
            scrollParent = this.parents().filter(function () {
                var parent = $(this);
                if (excludeStaticParent && parent.css("position") === "static") {
                    return false;
                }
                return overflowRegex.test(parent.css("overflow") + parent.css("overflow-y") +
                    parent.css("overflow-x"));
            }).eq(0);

        return position === "fixed" || !scrollParent.length ?
            $(this[0].ownerDocument || document) :
            scrollParent;
    };


    /*!
 * jQuery UI Tabbable 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: :tabbable Selector
//>>group: Core
//>>description: Selects elements which can be tabbed to.
//>>docs: http://api.jqueryui.com/tabbable-selector/


    var tabbable = $.extend($.expr[":"], {
        tabbable: function (element) {
            var tabIndex = $.attr(element, "tabindex"),
                hasTabindex = tabIndex != null;
            return (!hasTabindex || tabIndex >= 0) && $.ui.focusable(element, hasTabindex);
        }
    });


    /*!
 * jQuery UI Unique ID 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: uniqueId
//>>group: Core
//>>description: Functions to generate and remove uniqueId's
//>>docs: http://api.jqueryui.com/uniqueId/


    var uniqueId = $.fn.extend({
        uniqueId: (function () {
            var uuid = 0;

            return function () {
                return this.each(function () {
                    if (!this.id) {
                        this.id = "ui-id-" + (++uuid);
                    }
                });
            };
        })(),

        removeUniqueId: function () {
            return this.each(function () {
                if (/^ui-id-\d+$/.test(this.id)) {
                    $(this).removeAttr("id");
                }
            });
        }
    });


    /*!
 * jQuery UI Accordion 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Accordion
//>>group: Widgets
// jscs:disable maximumLineLength
//>>description: Displays collapsible content panels for presenting information in a limited amount of space.
// jscs:enable maximumLineLength
//>>docs: http://api.jqueryui.com/accordion/
//>>demos: http://jqueryui.com/accordion/
//>>css.structure: ../../themes/base/core.css
//>>css.structure: ../../themes/base/accordion.css
//>>css.theme: ../../themes/base/theme.css


    var widgetsAccordion = $.widget("ui.accordion", {
        version: "1.12.1",
        options: {
            active: 0,
            animate: {},
            classes: {
                "ui-accordion-header": "ui-corner-top",
                "ui-accordion-header-collapsed": "ui-corner-all",
                "ui-accordion-content": "ui-corner-bottom"
            },
            collapsible: false,
            event: "click",
            header: "> li > :first-child, > :not(li):even",
            heightStyle: "auto",
            icons: {
                activeHeader: "ui-icon-triangle-1-s",
                header: "ui-icon-triangle-1-e"
            },

            // Callbacks
            activate: null,
            beforeActivate: null
        },

        hideProps: {
            borderTopWidth: "hide",
            borderBottomWidth: "hide",
            paddingTop: "hide",
            paddingBottom: "hide",
            height: "hide"
        },

        showProps: {
            borderTopWidth: "show",
            borderBottomWidth: "show",
            paddingTop: "show",
            paddingBottom: "show",
            height: "show"
        },

        _create: function () {
            var options = this.options;

            this.prevShow = this.prevHide = $();
            this._addClass("ui-accordion", "ui-widget ui-helper-reset");
            this.element.attr("role", "tablist");

            // Don't allow collapsible: false and active: false / null
            if (!options.collapsible && (options.active === false || options.active == null)) {
                options.active = 0;
            }

            this._processPanels();

            // handle negative values
            if (options.active < 0) {
                options.active += this.headers.length;
            }
            this._refresh();
        },

        _getCreateEventData: function () {
            return {
                header: this.active,
                panel: !this.active.length ? $() : this.active.next()
            };
        },

        _createIcons: function () {
            var icon, children,
                icons = this.options.icons;

            if (icons) {
                icon = $("<span>");
                this._addClass(icon, "ui-accordion-header-icon", "ui-icon " + icons.header);
                icon.prependTo(this.headers);
                children = this.active.children(".ui-accordion-header-icon");
                this._removeClass(children, icons.header)
                    ._addClass(children, null, icons.activeHeader)
                    ._addClass(this.headers, "ui-accordion-icons");
            }
        },

        _destroyIcons: function () {
            this._removeClass(this.headers, "ui-accordion-icons");
            this.headers.children(".ui-accordion-header-icon").remove();
        },

        _destroy: function () {
            var contents;

            // Clean up main element
            this.element.removeAttr("role");

            // Clean up headers
            this.headers
                .removeAttr("role aria-expanded aria-selected aria-controls tabIndex")
                .removeUniqueId();

            this._destroyIcons();

            // Clean up content panels
            contents = this.headers.next()
                .css("display", "")
                .removeAttr("role aria-hidden aria-labelledby")
                .removeUniqueId();

            if (this.options.heightStyle !== "content") {
                contents.css("height", "");
            }
        },

        _setOption: function (key, value) {
            if (key === "active") {

                // _activate() will handle invalid values and update this.options
                this._activate(value);
                return;
            }

            if (key === "event") {
                if (this.options.event) {
                    this._off(this.headers, this.options.event);
                }
                this._setupEvents(value);
            }

            this._super(key, value);

            // Setting collapsible: false while collapsed; open first panel
            if (key === "collapsible" && !value && this.options.active === false) {
                this._activate(0);
            }

            if (key === "icons") {
                this._destroyIcons();
                if (value) {
                    this._createIcons();
                }
            }
        },

        _setOptionDisabled: function (value) {
            this._super(value);

            this.element.attr("aria-disabled", value);

            // Support: IE8 Only
            // #5332 / #6059 - opacity doesn't cascade to positioned elements in IE
            // so we need to add the disabled class to the headers and panels
            this._toggleClass(null, "ui-state-disabled", !!value);
            this._toggleClass(this.headers.add(this.headers.next()), null, "ui-state-disabled",
                !!value);
        },

        _keydown: function (event) {
            if (event.altKey || event.ctrlKey) {
                return;
            }

            var keyCode = $.ui.keyCode,
                length = this.headers.length,
                currentIndex = this.headers.index(event.target),
                toFocus = false;

            switch (event.keyCode) {
                case keyCode.RIGHT:
                case keyCode.DOWN:
                    toFocus = this.headers[(currentIndex + 1) % length];
                    break;
                case keyCode.LEFT:
                case keyCode.UP:
                    toFocus = this.headers[(currentIndex - 1 + length) % length];
                    break;
                case keyCode.SPACE:
                case keyCode.ENTER:
                    this._eventHandler(event);
                    break;
                case keyCode.HOME:
                    toFocus = this.headers[0];
                    break;
                case keyCode.END:
                    toFocus = this.headers[length - 1];
                    break;
            }

            if (toFocus) {
                $(event.target).attr("tabIndex", -1);
                $(toFocus).attr("tabIndex", 0);
                $(toFocus).trigger("focus");
                event.preventDefault();
            }
        },

        _panelKeyDown: function (event) {
            if (event.keyCode === $.ui.keyCode.UP && event.ctrlKey) {
                $(event.currentTarget).prev().trigger("focus");
            }
        },

        refresh: function () {
            var options = this.options;
            this._processPanels();

            // Was collapsed or no panel
            if ((options.active === false && options.collapsible === true) ||
                !this.headers.length) {
                options.active = false;
                this.active = $();

                // active false only when collapsible is true
            } else if (options.active === false) {
                this._activate(0);

                // was active, but active panel is gone
            } else if (this.active.length && !$.contains(this.element[0], this.active[0])) {

                // all remaining panel are disabled
                if (this.headers.length === this.headers.find(".ui-state-disabled").length) {
                    options.active = false;
                    this.active = $();

                    // activate previous panel
                } else {
                    this._activate(Math.max(0, options.active - 1));
                }

                // was active, active panel still exists
            } else {

                // make sure active index is correct
                options.active = this.headers.index(this.active);
            }

            this._destroyIcons();

            this._refresh();
        },

        _processPanels: function () {
            var prevHeaders = this.headers,
                prevPanels = this.panels;

            this.headers = this.element.find(this.options.header);
            this._addClass(this.headers, "ui-accordion-header ui-accordion-header-collapsed",
                "ui-state-default");

            this.panels = this.headers.next().filter(":not(.ui-accordion-content-active)").hide();
            this._addClass(this.panels, "ui-accordion-content", "ui-helper-reset ui-widget-content");

            // Avoid memory leaks (#10056)
            if (prevPanels) {
                this._off(prevHeaders.not(this.headers));
                this._off(prevPanels.not(this.panels));
            }
        },

        _refresh: function () {
            var maxHeight,
                options = this.options,
                heightStyle = options.heightStyle,
                parent = this.element.parent();

            this.active = this._findActive(options.active);
            this._addClass(this.active, "ui-accordion-header-active", "ui-state-active")
                ._removeClass(this.active, "ui-accordion-header-collapsed");
            this._addClass(this.active.next(), "ui-accordion-content-active");
            this.active.next().show();

            this.headers
                .attr("role", "tab")
                .each(function () {
                    var header = $(this),
                        headerId = header.uniqueId().attr("id"),
                        panel = header.next(),
                        panelId = panel.uniqueId().attr("id");
                    header.attr("aria-controls", panelId);
                    panel.attr("aria-labelledby", headerId);
                })
                .next()
                .attr("role", "tabpanel");

            this.headers
                .not(this.active)
                .attr({
                    "aria-selected": "false",
                    "aria-expanded": "false",
                    tabIndex: -1
                })
                .next()
                .attr({
                    "aria-hidden": "true"
                })
                .hide();

            // Make sure at least one header is in the tab order
            if (!this.active.length) {
                this.headers.eq(0).attr("tabIndex", 0);
            } else {
                this.active.attr({
                    "aria-selected": "true",
                    "aria-expanded": "true",
                    tabIndex: 0
                })
                    .next()
                    .attr({
                        "aria-hidden": "false"
                    });
            }

            this._createIcons();

            this._setupEvents(options.event);

            if (heightStyle === "fill") {
                maxHeight = parent.height();
                this.element.siblings(":visible").each(function () {
                    var elem = $(this),
                        position = elem.css("position");

                    if (position === "absolute" || position === "fixed") {
                        return;
                    }
                    maxHeight -= elem.outerHeight(true);
                });

                this.headers.each(function () {
                    maxHeight -= $(this).outerHeight(true);
                });

                this.headers.next()
                    .each(function () {
                        $(this).height(Math.max(0, maxHeight -
                            $(this).innerHeight() + $(this).height()));
                    })
                    .css("overflow", "auto");
            } else if (heightStyle === "auto") {
                maxHeight = 0;
                this.headers.next()
                    .each(function () {
                        var isVisible = $(this).is(":visible");
                        if (!isVisible) {
                            $(this).show();
                        }
                        maxHeight = Math.max(maxHeight, $(this).css("height", "").height());
                        if (!isVisible) {
                            $(this).hide();
                        }
                    })
                    .height(maxHeight);
            }
        },

        _activate: function (index) {
            var active = this._findActive(index)[0];

            // Trying to activate the already active panel
            if (active === this.active[0]) {
                return;
            }

            // Trying to collapse, simulate a click on the currently active header
            active = active || this.active[0];

            this._eventHandler({
                target: active,
                currentTarget: active,
                preventDefault: $.noop
            });
        },

        _findActive: function (selector) {
            return typeof selector === "number" ? this.headers.eq(selector) : $();
        },

        _setupEvents: function (event) {
            var events = {
                keydown: "_keydown"
            };
            if (event) {
                $.each(event.split(" "), function (index, eventName) {
                    events[eventName] = "_eventHandler";
                });
            }

            this._off(this.headers.add(this.headers.next()));
            this._on(this.headers, events);
            this._on(this.headers.next(), {keydown: "_panelKeyDown"});
            this._hoverable(this.headers);
            this._focusable(this.headers);
        },

        _eventHandler: function (event) {
            var activeChildren, clickedChildren,
                options = this.options,
                active = this.active,
                clicked = $(event.currentTarget),
                clickedIsActive = clicked[0] === active[0],
                collapsing = clickedIsActive && options.collapsible,
                toShow = collapsing ? $() : clicked.next(),
                toHide = active.next(),
                eventData = {
                    oldHeader: active,
                    oldPanel: toHide,
                    newHeader: collapsing ? $() : clicked,
                    newPanel: toShow
                };

            event.preventDefault();

            if (

                // click on active header, but not collapsible
                (clickedIsActive && !options.collapsible) ||

                // allow canceling activation
                (this._trigger("beforeActivate", event, eventData) === false)) {
                return;
            }

            options.active = collapsing ? false : this.headers.index(clicked);

            // When the call to ._toggle() comes after the class changes
            // it causes a very odd bug in IE 8 (see #6720)
            this.active = clickedIsActive ? $() : clicked;
            this._toggle(eventData);

            // Switch classes
            // corner classes on the previously active header stay after the animation
            this._removeClass(active, "ui-accordion-header-active", "ui-state-active");
            if (options.icons) {
                activeChildren = active.children(".ui-accordion-header-icon");
                this._removeClass(activeChildren, null, options.icons.activeHeader)
                    ._addClass(activeChildren, null, options.icons.header);
            }

            if (!clickedIsActive) {
                this._removeClass(clicked, "ui-accordion-header-collapsed")
                    ._addClass(clicked, "ui-accordion-header-active", "ui-state-active");
                if (options.icons) {
                    clickedChildren = clicked.children(".ui-accordion-header-icon");
                    this._removeClass(clickedChildren, null, options.icons.header)
                        ._addClass(clickedChildren, null, options.icons.activeHeader);
                }

                this._addClass(clicked.next(), "ui-accordion-content-active");
            }
        },

        _toggle: function (data) {
            var toShow = data.newPanel,
                toHide = this.prevShow.length ? this.prevShow : data.oldPanel;

            // Handle activating a panel during the animation for another activation
            this.prevShow.add(this.prevHide).stop(true, true);
            this.prevShow = toShow;
            this.prevHide = toHide;

            if (this.options.animate) {
                this._animate(toShow, toHide, data);
            } else {
                toHide.hide();
                toShow.show();
                this._toggleComplete(data);
            }

            toHide.attr({
                "aria-hidden": "true"
            });
            toHide.prev().attr({
                "aria-selected": "false",
                "aria-expanded": "false"
            });

            // if we're switching panels, remove the old header from the tab order
            // if we're opening from collapsed state, remove the previous header from the tab order
            // if we're collapsing, then keep the collapsing header in the tab order
            if (toShow.length && toHide.length) {
                toHide.prev().attr({
                    "tabIndex": -1,
                    "aria-expanded": "false"
                });
            } else if (toShow.length) {
                this.headers.filter(function () {
                    return parseInt($(this).attr("tabIndex"), 10) === 0;
                })
                    .attr("tabIndex", -1);
            }

            toShow
                .attr("aria-hidden", "false")
                .prev()
                .attr({
                    "aria-selected": "true",
                    "aria-expanded": "true",
                    tabIndex: 0
                });
        },

        _animate: function (toShow, toHide, data) {
            var total, easing, duration,
                that = this,
                adjust = 0,
                boxSizing = toShow.css("box-sizing"),
                down = toShow.length &&
                    (!toHide.length || (toShow.index() < toHide.index())),
                animate = this.options.animate || {},
                options = down && animate.down || animate,
                complete = function () {
                    that._toggleComplete(data);
                };

            if (typeof options === "number") {
                duration = options;
            }
            if (typeof options === "string") {
                easing = options;
            }

            // fall back from options to animation in case of partial down settings
            easing = easing || options.easing || animate.easing;
            duration = duration || options.duration || animate.duration;

            if (!toHide.length) {
                return toShow.animate(this.showProps, duration, easing, complete);
            }
            if (!toShow.length) {
                return toHide.animate(this.hideProps, duration, easing, complete);
            }

            total = toShow.show().outerHeight();
            toHide.animate(this.hideProps, {
                duration: duration,
                easing: easing,
                step: function (now, fx) {
                    fx.now = Math.round(now);
                }
            });
            toShow
                .hide()
                .animate(this.showProps, {
                    duration: duration,
                    easing: easing,
                    complete: complete,
                    step: function (now, fx) {
                        fx.now = Math.round(now);
                        if (fx.prop !== "height") {
                            if (boxSizing === "content-box") {
                                adjust += fx.now;
                            }
                        } else if (that.options.heightStyle !== "content") {
                            fx.now = Math.round(total - toHide.outerHeight() - adjust);
                            adjust = 0;
                        }
                    }
                });
        },

        _toggleComplete: function (data) {
            var toHide = data.oldPanel,
                prev = toHide.prev();

            this._removeClass(toHide, "ui-accordion-content-active");
            this._removeClass(prev, "ui-accordion-header-active")
                ._addClass(prev, "ui-accordion-header-collapsed");

            // Work around for rendering bug in IE (#5421)
            if (toHide.length) {
                toHide.parent()[0].className = toHide.parent()[0].className;
            }
            this._trigger("activate", null, data);
        }
    });


    var safeActiveElement = $.ui.safeActiveElement = function (document) {
        var activeElement;

        // Support: IE 9 only
        // IE9 throws an "Unspecified error" accessing document.activeElement from an <iframe>
        try {
            activeElement = document.activeElement;
        } catch (error) {
            activeElement = document.body;
        }

        // Support: IE 9 - 11 only
        // IE may return null instead of an element
        // Interestingly, this only seems to occur when NOT in an iframe
        if (!activeElement) {
            activeElement = document.body;
        }

        // Support: IE 11 only
        // IE11 returns a seemingly empty object in some cases when accessing
        // document.activeElement from an <iframe>
        if (!activeElement.nodeName) {
            activeElement = document.body;
        }

        return activeElement;
    };


    /*!
 * jQuery UI Menu 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Menu
//>>group: Widgets
//>>description: Creates nestable menus.
//>>docs: http://api.jqueryui.com/menu/
//>>demos: http://jqueryui.com/menu/
//>>css.structure: ../../themes/base/core.css
//>>css.structure: ../../themes/base/menu.css
//>>css.theme: ../../themes/base/theme.css


    var widgetsMenu = $.widget("ui.menu", {
        version: "1.12.1",
        defaultElement: "<ul>",
        delay: 300,
        options: {
            icons: {
                submenu: "ui-icon-caret-1-e"
            },
            items: "> *",
            menus: "ul",
            position: {
                my: "left top",
                at: "right top"
            },
            role: "menu",

            // Callbacks
            blur: null,
            focus: null,
            select: null
        },

        _create: function () {
            this.activeMenu = this.element;

            // Flag used to prevent firing of the click handler
            // as the event bubbles up through nested menus
            this.mouseHandled = false;
            this.element
                .uniqueId()
                .attr({
                    role: this.options.role,
                    tabIndex: 0
                });

            this._addClass("ui-menu", "ui-widget ui-widget-content");
            this._on({

                // Prevent focus from sticking to links inside menu after clicking
                // them (focus should always stay on UL during navigation).
                "mousedown .ui-menu-item": function (event) {
                    event.preventDefault();
                },
                "click .ui-menu-item": function (event) {
                    var target = $(event.target);
                    var active = $($.ui.safeActiveElement(this.document[0]));
                    if (!this.mouseHandled && target.not(".ui-state-disabled").length) {
                        this.select(event);

                        // Only set the mouseHandled flag if the event will bubble, see #9469.
                        if (!event.isPropagationStopped()) {
                            this.mouseHandled = true;
                        }

                        // Open submenu on click
                        if (target.has(".ui-menu").length) {
                            this.expand(event);
                        } else if (!this.element.is(":focus") &&
                            active.closest(".ui-menu").length) {

                            // Redirect focus to the menu
                            this.element.trigger("focus", [true]);

                            // If the active item is on the top level, let it stay active.
                            // Otherwise, blur the active item since it is no longer visible.
                            if (this.active && this.active.parents(".ui-menu").length === 1) {
                                clearTimeout(this.timer);
                            }
                        }
                    }
                },
                "mouseenter .ui-menu-item": function (event) {

                    // Ignore mouse events while typeahead is active, see #10458.
                    // Prevents focusing the wrong item when typeahead causes a scroll while the mouse
                    // is over an item in the menu
                    if (this.previousFilter) {
                        return;
                    }

                    var actualTarget = $(event.target).closest(".ui-menu-item"),
                        target = $(event.currentTarget);

                    // Ignore bubbled events on parent items, see #11641
                    if (actualTarget[0] !== target[0]) {
                        return;
                    }

                    // Remove ui-state-active class from siblings of the newly focused menu item
                    // to avoid a jump caused by adjacent elements both having a class with a border
                    this._removeClass(target.siblings().children(".ui-state-active"),
                        null, "ui-state-active");
                    this.focus(event, target);
                },
                mouseleave: "collapseAll",
                "mouseleave .ui-menu": "collapseAll",
                focus: function (event, keepActiveItem) {

                    // If there's already an active item, keep it active
                    // If not, activate the first item
                    var item = this.active || this.element.find(this.options.items).eq(0);

                    if (!keepActiveItem) {
                        this.focus(event, item);
                    }
                },
                blur: function (event) {
                    this._delay(function () {
                        var notContained = !$.contains(
                            this.element[0],
                            $.ui.safeActiveElement(this.document[0])
                        );
                        if (notContained) {
                            this.collapseAll(event);
                        }
                    });
                },
                keydown: "_keydown"
            });

            this.refresh();

            // Clicks outside of a menu collapse any open menus
            this._on(this.document, {
                click: function (event) {
                    if (this._closeOnDocumentClick(event)) {
                        this.collapseAll(event);
                    }

                    // Reset the mouseHandled flag
                    this.mouseHandled = false;
                }
            });
        },

        _destroy: function () {
            var items = this.element.find(".ui-menu-item")
                    .removeAttr("role aria-disabled"),
                submenus = items.children(".ui-menu-item-wrapper")
                    .removeUniqueId()
                    .removeAttr("tabIndex role aria-haspopup");

            // Destroy (sub)menus
            this.element
                .removeAttr("aria-activedescendant")
                .find(".ui-menu").addBack()
                .removeAttr("role aria-labelledby aria-expanded aria-hidden aria-disabled " +
                    "tabIndex")
                .removeUniqueId()
                .show();

            submenus.children().each(function () {
                var elem = $(this);
                if (elem.data("ui-menu-submenu-caret")) {
                    elem.remove();
                }
            });
        },

        _keydown: function (event) {
            var match, prev, character, skip,
                preventDefault = true;

            switch (event.keyCode) {
                case $.ui.keyCode.PAGE_UP:
                    this.previousPage(event);
                    break;
                case $.ui.keyCode.PAGE_DOWN:
                    this.nextPage(event);
                    break;
                case $.ui.keyCode.HOME:
                    this._move("first", "first", event);
                    break;
                case $.ui.keyCode.END:
                    this._move("last", "last", event);
                    break;
                case $.ui.keyCode.UP:
                    this.previous(event);
                    break;
                case $.ui.keyCode.DOWN:
                    this.next(event);
                    break;
                case $.ui.keyCode.LEFT:
                    this.collapse(event);
                    break;
                case $.ui.keyCode.RIGHT:
                    if (this.active && !this.active.is(".ui-state-disabled")) {
                        this.expand(event);
                    }
                    break;
                case $.ui.keyCode.ENTER:
                case $.ui.keyCode.SPACE:
                    this._activate(event);
                    break;
                case $.ui.keyCode.ESCAPE:
                    this.collapse(event);
                    break;
                default:
                    preventDefault = false;
                    prev = this.previousFilter || "";
                    skip = false;

                    // Support number pad values
                    character = event.keyCode >= 96 && event.keyCode <= 105 ?
                        (event.keyCode - 96).toString() : String.fromCharCode(event.keyCode);

                    clearTimeout(this.filterTimer);

                    if (character === prev) {
                        skip = true;
                    } else {
                        character = prev + character;
                    }

                    match = this._filterMenuItems(character);
                    match = skip && match.index(this.active.next()) !== -1 ?
                        this.active.nextAll(".ui-menu-item") :
                        match;

                    // If no matches on the current filter, reset to the last character pressed
                    // to move down the menu to the first item that starts with that character
                    if (!match.length) {
                        character = String.fromCharCode(event.keyCode);
                        match = this._filterMenuItems(character);
                    }

                    if (match.length) {
                        this.focus(event, match);
                        this.previousFilter = character;
                        this.filterTimer = this._delay(function () {
                            delete this.previousFilter;
                        }, 1000);
                    } else {
                        delete this.previousFilter;
                    }
            }

            if (preventDefault) {
                event.preventDefault();
            }
        },

        _activate: function (event) {
            if (this.active && !this.active.is(".ui-state-disabled")) {
                if (this.active.children("[aria-haspopup='true']").length) {
                    this.expand(event);
                } else {
                    this.select(event);
                }
            }
        },

        refresh: function () {
            var menus, items, newSubmenus, newItems, newWrappers,
                that = this,
                icon = this.options.icons.submenu,
                submenus = this.element.find(this.options.menus);

            this._toggleClass("ui-menu-icons", null, !!this.element.find(".ui-icon").length);

            // Initialize nested menus
            newSubmenus = submenus.filter(":not(.ui-menu)")
                .hide()
                .attr({
                    role: this.options.role,
                    "aria-hidden": "true",
                    "aria-expanded": "false"
                })
                .each(function () {
                    var menu = $(this),
                        item = menu.prev(),
                        submenuCaret = $("<span>").data("ui-menu-submenu-caret", true);

                    that._addClass(submenuCaret, "ui-menu-icon", "ui-icon " + icon);
                    item
                        .attr("aria-haspopup", "true")
                        .prepend(submenuCaret);
                    menu.attr("aria-labelledby", item.attr("id"));
                });

            this._addClass(newSubmenus, "ui-menu", "ui-widget ui-widget-content ui-front");

            menus = submenus.add(this.element);
            items = menus.find(this.options.items);

            // Initialize menu-items containing spaces and/or dashes only as dividers
            items.not(".ui-menu-item").each(function () {
                var item = $(this);
                if (that._isDivider(item)) {
                    that._addClass(item, "ui-menu-divider", "ui-widget-content");
                }
            });

            // Don't refresh list items that are already adapted
            newItems = items.not(".ui-menu-item, .ui-menu-divider");
            newWrappers = newItems.children()
                .not(".ui-menu")
                .uniqueId()
                .attr({
                    tabIndex: -1,
                    role: this._itemRole()
                });
            this._addClass(newItems, "ui-menu-item")
                ._addClass(newWrappers, "ui-menu-item-wrapper");

            // Add aria-disabled attribute to any disabled menu item
            items.filter(".ui-state-disabled").attr("aria-disabled", "true");

            // If the active item has been removed, blur the menu
            if (this.active && !$.contains(this.element[0], this.active[0])) {
                this.blur();
            }
        },

        _itemRole: function () {
            return {
                menu: "menuitem",
                listbox: "option"
            }[this.options.role];
        },

        _setOption: function (key, value) {
            if (key === "icons") {
                var icons = this.element.find(".ui-menu-icon");
                this._removeClass(icons, null, this.options.icons.submenu)
                    ._addClass(icons, null, value.submenu);
            }
            this._super(key, value);
        },

        _setOptionDisabled: function (value) {
            this._super(value);

            this.element.attr("aria-disabled", String(value));
            this._toggleClass(null, "ui-state-disabled", !!value);
        },

        focus: function (event, item) {
            var nested, focused, activeParent;
            this.blur(event, event && event.type === "focus");

            this._scrollIntoView(item);

            this.active = item.first();

            focused = this.active.children(".ui-menu-item-wrapper");
            this._addClass(focused, null, "ui-state-active");

            // Only update aria-activedescendant if there's a role
            // otherwise we assume focus is managed elsewhere
            if (this.options.role) {
                this.element.attr("aria-activedescendant", focused.attr("id"));
            }

            // Highlight active parent menu item, if any
            activeParent = this.active
                .parent()
                .closest(".ui-menu-item")
                .children(".ui-menu-item-wrapper");
            this._addClass(activeParent, null, "ui-state-active");

            if (event && event.type === "keydown") {
                this._close();
            } else {
                this.timer = this._delay(function () {
                    this._close();
                }, this.delay);
            }

            nested = item.children(".ui-menu");
            if (nested.length && event && (/^mouse/.test(event.type))) {
                this._startOpening(nested);
            }
            this.activeMenu = item.parent();

            this._trigger("focus", event, {item: item});
        },

        _scrollIntoView: function (item) {
            var borderTop, paddingTop, offset, scroll, elementHeight, itemHeight;
            if (this._hasScroll()) {
                borderTop = parseFloat($.css(this.activeMenu[0], "borderTopWidth")) || 0;
                paddingTop = parseFloat($.css(this.activeMenu[0], "paddingTop")) || 0;
                offset = item.offset().top - this.activeMenu.offset().top - borderTop - paddingTop;
                scroll = this.activeMenu.scrollTop();
                elementHeight = this.activeMenu.height();
                itemHeight = item.outerHeight();

                if (offset < 0) {
                    this.activeMenu.scrollTop(scroll + offset);
                } else if (offset + itemHeight > elementHeight) {
                    this.activeMenu.scrollTop(scroll + offset - elementHeight + itemHeight);
                }
            }
        },

        blur: function (event, fromFocus) {
            if (!fromFocus) {
                clearTimeout(this.timer);
            }

            if (!this.active) {
                return;
            }

            this._removeClass(this.active.children(".ui-menu-item-wrapper"),
                null, "ui-state-active");

            this._trigger("blur", event, {item: this.active});
            this.active = null;
        },

        _startOpening: function (submenu) {
            clearTimeout(this.timer);

            // Don't open if already open fixes a Firefox bug that caused a .5 pixel
            // shift in the submenu position when mousing over the caret icon
            if (submenu.attr("aria-hidden") !== "true") {
                return;
            }

            this.timer = this._delay(function () {
                this._close();
                this._open(submenu);
            }, this.delay);
        },

        _open: function (submenu) {
            var position = $.extend({
                of: this.active
            }, this.options.position);

            clearTimeout(this.timer);
            this.element.find(".ui-menu").not(submenu.parents(".ui-menu"))
                .hide()
                .attr("aria-hidden", "true");

            submenu
                .show()
                .removeAttr("aria-hidden")
                .attr("aria-expanded", "true")
                .position(position);
        },

        collapseAll: function (event, all) {
            clearTimeout(this.timer);
            this.timer = this._delay(function () {

                // If we were passed an event, look for the submenu that contains the event
                var currentMenu = all ? this.element :
                    $(event && event.target).closest(this.element.find(".ui-menu"));

                // If we found no valid submenu ancestor, use the main menu to close all
                // sub menus anyway
                if (!currentMenu.length) {
                    currentMenu = this.element;
                }

                this._close(currentMenu);

                this.blur(event);

                // Work around active item staying active after menu is blurred
                this._removeClass(currentMenu.find(".ui-state-active"), null, "ui-state-active");

                this.activeMenu = currentMenu;
            }, this.delay);
        },

        // With no arguments, closes the currently active menu - if nothing is active
        // it closes all menus.  If passed an argument, it will search for menus BELOW
        _close: function (startMenu) {
            if (!startMenu) {
                startMenu = this.active ? this.active.parent() : this.element;
            }

            startMenu.find(".ui-menu")
                .hide()
                .attr("aria-hidden", "true")
                .attr("aria-expanded", "false");
        },

        _closeOnDocumentClick: function (event) {
            return !$(event.target).closest(".ui-menu").length;
        },

        _isDivider: function (item) {

            // Match hyphen, em dash, en dash
            return !/[^\-\u2014\u2013\s]/.test(item.text());
        },

        collapse: function (event) {
            var newItem = this.active &&
                this.active.parent().closest(".ui-menu-item", this.element);
            if (newItem && newItem.length) {
                this._close();
                this.focus(event, newItem);
            }
        },

        expand: function (event) {
            var newItem = this.active &&
                this.active
                    .children(".ui-menu ")
                    .find(this.options.items)
                    .first();

            if (newItem && newItem.length) {
                this._open(newItem.parent());

                // Delay so Firefox will not hide activedescendant change in expanding submenu from AT
                this._delay(function () {
                    this.focus(event, newItem);
                });
            }
        },

        next: function (event) {
            this._move("next", "first", event);
        },

        previous: function (event) {
            this._move("prev", "last", event);
        },

        isFirstItem: function () {
            return this.active && !this.active.prevAll(".ui-menu-item").length;
        },

        isLastItem: function () {
            return this.active && !this.active.nextAll(".ui-menu-item").length;
        },

        _move: function (direction, filter, event) {
            var next;
            if (this.active) {
                if (direction === "first" || direction === "last") {
                    next = this.active
                        [direction === "first" ? "prevAll" : "nextAll"](".ui-menu-item")
                        .eq(-1);
                } else {
                    next = this.active
                        [direction + "All"](".ui-menu-item")
                        .eq(0);
                }
            }
            if (!next || !next.length || !this.active) {
                next = this.activeMenu.find(this.options.items)[filter]();
            }

            this.focus(event, next);
        },

        nextPage: function (event) {
            var item, base, height;

            if (!this.active) {
                this.next(event);
                return;
            }
            if (this.isLastItem()) {
                return;
            }
            if (this._hasScroll()) {
                base = this.active.offset().top;
                height = this.element.height();
                this.active.nextAll(".ui-menu-item").each(function () {
                    item = $(this);
                    return item.offset().top - base - height < 0;
                });

                this.focus(event, item);
            } else {
                this.focus(event, this.activeMenu.find(this.options.items)
                    [!this.active ? "first" : "last"]());
            }
        },

        previousPage: function (event) {
            var item, base, height;
            if (!this.active) {
                this.next(event);
                return;
            }
            if (this.isFirstItem()) {
                return;
            }
            if (this._hasScroll()) {
                base = this.active.offset().top;
                height = this.element.height();
                this.active.prevAll(".ui-menu-item").each(function () {
                    item = $(this);
                    return item.offset().top - base + height > 0;
                });

                this.focus(event, item);
            } else {
                this.focus(event, this.activeMenu.find(this.options.items).first());
            }
        },

        _hasScroll: function () {
            return this.element.outerHeight() < this.element.prop("scrollHeight");
        },

        select: function (event) {

            // TODO: It should never be possible to not have an active item at this
            // point, but the tests don't trigger mouseenter before click.
            this.active = this.active || $(event.target).closest(".ui-menu-item");
            var ui = {item: this.active};
            if (!this.active.has(".ui-menu").length) {
                this.collapseAll(event, true);
            }
            this._trigger("select", event, ui);
        },

        _filterMenuItems: function (character) {
            var escapedCharacter = character.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, "\\$&"),
                regex = new RegExp("^" + escapedCharacter, "i");

            return this.activeMenu
                .find(this.options.items)

                // Only match on items, not dividers or other content (#10571)
                .filter(".ui-menu-item")
                .filter(function () {
                    return regex.test(
                        $.trim($(this).children(".ui-menu-item-wrapper").text()));
                });
        }
    });


    /*!
 * jQuery UI Autocomplete 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Autocomplete
//>>group: Widgets
//>>description: Lists suggested words as the user is typing.
//>>docs: http://api.jqueryui.com/autocomplete/
//>>demos: http://jqueryui.com/autocomplete/
//>>css.structure: ../../themes/base/core.css
//>>css.structure: ../../themes/base/autocomplete.css
//>>css.theme: ../../themes/base/theme.css


    $.widget("ui.autocomplete", {
        version: "1.12.1",
        defaultElement: "<input>",
        options: {
            appendTo: null,
            autoFocus: false,
            delay: 300,
            minLength: 1,
            position: {
                my: "left top",
                at: "left bottom",
                collision: "none"
            },
            source: null,

            // Callbacks
            change: null,
            close: null,
            focus: null,
            open: null,
            response: null,
            search: null,
            select: null
        },

        requestIndex: 0,
        pending: 0,

        _create: function () {

            // Some browsers only repeat keydown events, not keypress events,
            // so we use the suppressKeyPress flag to determine if we've already
            // handled the keydown event. #7269
            // Unfortunately the code for & in keypress is the same as the up arrow,
            // so we use the suppressKeyPressRepeat flag to avoid handling keypress
            // events when we know the keydown event was used to modify the
            // search term. #7799
            var suppressKeyPress, suppressKeyPressRepeat, suppressInput,
                nodeName = this.element[0].nodeName.toLowerCase(),
                isTextarea = nodeName === "textarea",
                isInput = nodeName === "input";

            // Textareas are always multi-line
            // Inputs are always single-line, even if inside a contentEditable element
            // IE also treats inputs as contentEditable
            // All other element types are determined by whether or not they're contentEditable
            this.isMultiLine = isTextarea || !isInput && this._isContentEditable(this.element);

            this.valueMethod = this.element[isTextarea || isInput ? "val" : "text"];
            this.isNewMenu = true;

            this._addClass("ui-autocomplete-input");
            this.element.attr("autocomplete", "off");

            this._on(this.element, {
                keydown: function (event) {
                    if (this.element.prop("readOnly")) {
                        suppressKeyPress = true;
                        suppressInput = true;
                        suppressKeyPressRepeat = true;
                        return;
                    }

                    suppressKeyPress = false;
                    suppressInput = false;
                    suppressKeyPressRepeat = false;
                    var keyCode = $.ui.keyCode;
                    switch (event.keyCode) {
                        case keyCode.PAGE_UP:
                            suppressKeyPress = true;
                            this._move("previousPage", event);
                            break;
                        case keyCode.PAGE_DOWN:
                            suppressKeyPress = true;
                            this._move("nextPage", event);
                            break;
                        case keyCode.UP:
                            suppressKeyPress = true;
                            this._keyEvent("previous", event);
                            break;
                        case keyCode.DOWN:
                            suppressKeyPress = true;
                            this._keyEvent("next", event);
                            break;
                        case keyCode.ENTER:

                            // when menu is open and has focus
                            if (this.menu.active) {

                                // #6055 - Opera still allows the keypress to occur
                                // which causes forms to submit
                                suppressKeyPress = true;
                                event.preventDefault();
                                this.menu.select(event);
                            }
                            break;
                        case keyCode.TAB:
                            if (this.menu.active) {
                                this.menu.select(event);
                            }
                            break;
                        case keyCode.ESCAPE:
                            if (this.menu.element.is(":visible")) {
                                if (!this.isMultiLine) {
                                    this._value(this.term);
                                }
                                this.close(event);

                                // Different browsers have different default behavior for escape
                                // Single press can mean undo or clear
                                // Double press in IE means clear the whole form
                                event.preventDefault();
                            }
                            break;
                        default:
                            suppressKeyPressRepeat = true;

                            // search timeout should be triggered before the input value is changed
                            this._searchTimeout(event);
                            break;
                    }
                },
                keypress: function (event) {
                    if (suppressKeyPress) {
                        suppressKeyPress = false;
                        if (!this.isMultiLine || this.menu.element.is(":visible")) {
                            event.preventDefault();
                        }
                        return;
                    }
                    if (suppressKeyPressRepeat) {
                        return;
                    }

                    // Replicate some key handlers to allow them to repeat in Firefox and Opera
                    var keyCode = $.ui.keyCode;
                    switch (event.keyCode) {
                        case keyCode.PAGE_UP:
                            this._move("previousPage", event);
                            break;
                        case keyCode.PAGE_DOWN:
                            this._move("nextPage", event);
                            break;
                        case keyCode.UP:
                            this._keyEvent("previous", event);
                            break;
                        case keyCode.DOWN:
                            this._keyEvent("next", event);
                            break;
                    }
                },
                input: function (event) {
                    if (suppressInput) {
                        suppressInput = false;
                        event.preventDefault();
                        return;
                    }
                    this._searchTimeout(event);
                },
                focus: function () {
                    this.selectedItem = null;
                    this.previous = this._value();
                },
                blur: function (event) {
                    if (this.cancelBlur) {
                        delete this.cancelBlur;
                        return;
                    }

                    clearTimeout(this.searching);
                    this.close(event);
                    this._change(event);
                }
            });

            this._initSource();
            this.menu = $("<ul>")
                .appendTo(this._appendTo())
                .menu({

                    // disable ARIA support, the live region takes care of that
                    role: null
                })
                .hide()
                .menu("instance");

            this._addClass(this.menu.element, "ui-autocomplete", "ui-front");
            this._on(this.menu.element, {
                mousedown: function (event) {

                    // prevent moving focus out of the text field
                    event.preventDefault();

                    // IE doesn't prevent moving focus even with event.preventDefault()
                    // so we set a flag to know when we should ignore the blur event
                    this.cancelBlur = true;
                    this._delay(function () {
                        delete this.cancelBlur;

                        // Support: IE 8 only
                        // Right clicking a menu item or selecting text from the menu items will
                        // result in focus moving out of the input. However, we've already received
                        // and ignored the blur event because of the cancelBlur flag set above. So
                        // we restore focus to ensure that the menu closes properly based on the user's
                        // next actions.
                        if (this.element[0] !== $.ui.safeActiveElement(this.document[0])) {
                            this.element.trigger("focus");
                        }
                    });
                },
                menufocus: function (event, ui) {
                    var label, item;

                    // support: Firefox
                    // Prevent accidental activation of menu items in Firefox (#7024 #9118)
                    if (this.isNewMenu) {
                        this.isNewMenu = false;
                        if (event.originalEvent && /^mouse/.test(event.originalEvent.type)) {
                            this.menu.blur();

                            this.document.one("mousemove", function () {
                                $(event.target).trigger(event.originalEvent);
                            });

                            return;
                        }
                    }

                    item = ui.item.data("ui-autocomplete-item");
                    if (false !== this._trigger("focus", event, {item: item})) {

                        // use value to match what will end up in the input, if it was a key event
                        if (event.originalEvent && /^key/.test(event.originalEvent.type)) {
                            this._value(item.value);
                        }
                    }

                    // Announce the value in the liveRegion
                    label = ui.item.attr("aria-label") || item.value;
                    if (label && $.trim(label).length) {
                        this.liveRegion.children().hide();
                        $("<div>").text(label).appendTo(this.liveRegion);
                    }
                },
                menuselect: function (event, ui) {
                    var item = ui.item.data("ui-autocomplete-item"),
                        previous = this.previous;

                    // Only trigger when focus was lost (click on menu)
                    if (this.element[0] !== $.ui.safeActiveElement(this.document[0])) {
                        this.element.trigger("focus");
                        this.previous = previous;

                        // #6109 - IE triggers two focus events and the second
                        // is asynchronous, so we need to reset the previous
                        // term synchronously and asynchronously :-(
                        this._delay(function () {
                            this.previous = previous;
                            this.selectedItem = item;
                        });
                    }

                    if (false !== this._trigger("select", event, {item: item})) {
                        this._value(item.value);
                    }

                    // reset the term after the select event
                    // this allows custom select handling to work properly
                    this.term = this._value();

                    this.close(event);
                    this.selectedItem = item;
                }
            });

            this.liveRegion = $("<div>", {
                role: "status",
                "aria-live": "assertive",
                "aria-relevant": "additions"
            })
                .appendTo(this.document[0].body);

            this._addClass(this.liveRegion, null, "ui-helper-hidden-accessible");

            // Turning off autocomplete prevents the browser from remembering the
            // value when navigating through history, so we re-enable autocomplete
            // if the page is unloaded before the widget is destroyed. #7790
            this._on(this.window, {
                beforeunload: function () {
                    this.element.removeAttr("autocomplete");
                }
            });
        },

        _destroy: function () {
            clearTimeout(this.searching);
            this.element.removeAttr("autocomplete");
            this.menu.element.remove();
            this.liveRegion.remove();
        },

        _setOption: function (key, value) {
            this._super(key, value);
            if (key === "source") {
                this._initSource();
            }
            if (key === "appendTo") {
                this.menu.element.appendTo(this._appendTo());
            }
            if (key === "disabled" && value && this.xhr) {
                this.xhr.abort();
            }
        },

        _isEventTargetInWidget: function (event) {
            var menuElement = this.menu.element[0];

            return event.target === this.element[0] ||
                event.target === menuElement ||
                $.contains(menuElement, event.target);
        },

        _closeOnClickOutside: function (event) {
            if (!this._isEventTargetInWidget(event)) {
                this.close();
            }
        },

        _appendTo: function () {
            var element = this.options.appendTo;

            if (element) {
                element = element.jquery || element.nodeType ?
                    $(element) :
                    this.document.find(element).eq(0);
            }

            if (!element || !element[0]) {
                element = this.element.closest(".ui-front, dialog");
            }

            if (!element.length) {
                element = this.document[0].body;
            }

            return element;
        },

        _initSource: function () {
            var array, url,
                that = this;
            if ($.isArray(this.options.source)) {
                array = this.options.source;
                this.source = function (request, response) {
                    response($.ui.autocomplete.filter(array, request.term));
                };
            } else if (typeof this.options.source === "string") {
                url = this.options.source;
                this.source = function (request, response) {
                    if (that.xhr) {
                        that.xhr.abort();
                    }
                    that.xhr = $.ajax({
                        url: url,
                        data: request,
                        dataType: "json",
                        success: function (data) {
                            response(data);
                        },
                        error: function () {
                            response([]);
                        }
                    });
                };
            } else {
                this.source = this.options.source;
            }
        },

        _searchTimeout: function (event) {
            clearTimeout(this.searching);
            this.searching = this._delay(function () {

                // Search if the value has changed, or if the user retypes the same value (see #7434)
                var equalValues = this.term === this._value(),
                    menuVisible = this.menu.element.is(":visible"),
                    modifierKey = event.altKey || event.ctrlKey || event.metaKey || event.shiftKey;

                if (!equalValues || (equalValues && !menuVisible && !modifierKey)) {
                    this.selectedItem = null;
                    this.search(null, event);
                }
            }, this.options.delay);
        },

        search: function (value, event) {
            value = value != null ? value : this._value();

            // Always save the actual value, not the one passed as an argument
            this.term = this._value();

            if (value.length < this.options.minLength) {
                return this.close(event);
            }

            if (this._trigger("search", event) === false) {
                return;
            }

            return this._search(value);
        },

        _search: function (value) {
            this.pending++;
            this._addClass("ui-autocomplete-loading");
            this.cancelSearch = false;

            this.source({term: value}, this._response());
        },

        _response: function () {
            var index = ++this.requestIndex;

            return $.proxy(function (content) {
                if (index === this.requestIndex) {
                    this.__response(content);
                }

                this.pending--;
                if (!this.pending) {
                    this._removeClass("ui-autocomplete-loading");
                }
            }, this);
        },

        __response: function (content) {
            if (content) {
                content = this._normalize(content);
            }
            this._trigger("response", null, {content: content});
            if (!this.options.disabled && content && content.length && !this.cancelSearch) {
                this._suggest(content);
                this._trigger("open");
            } else {

                // use ._close() instead of .close() so we don't cancel future searches
                this._close();
            }
        },

        close: function (event) {
            this.cancelSearch = true;
            this._close(event);
        },

        _close: function (event) {

            // Remove the handler that closes the menu on outside clicks
            this._off(this.document, "mousedown");

            if (this.menu.element.is(":visible")) {
                this.menu.element.hide();
                this.menu.blur();
                this.isNewMenu = true;
                this._trigger("close", event);
            }
        },

        _change: function (event) {
            if (this.previous !== this._value()) {
                this._trigger("change", event, {item: this.selectedItem});
            }
        },

        _normalize: function (items) {

            // assume all items have the right format when the first item is complete
            if (items.length && items[0].label && items[0].value) {
                return items;
            }
            return $.map(items, function (item) {
                if (typeof item === "string") {
                    return {
                        label: item,
                        value: item
                    };
                }
                return $.extend({}, item, {
                    label: item.label || item.value,
                    value: item.value || item.label
                });
            });
        },

        _suggest: function (items) {
            var ul = this.menu.element.empty();
            this._renderMenu(ul, items);
            this.isNewMenu = true;
            this.menu.refresh();

            // Size and position menu
            ul.show();
            this._resizeMenu();
            ul.position($.extend({
                of: this.element
            }, this.options.position));

            if (this.options.autoFocus) {
                this.menu.next();
            }

            // Listen for interactions outside of the widget (#6642)
            this._on(this.document, {
                mousedown: "_closeOnClickOutside"
            });
        },

        _resizeMenu: function () {
            var ul = this.menu.element;
            ul.outerWidth(Math.max(
                // Firefox wraps long text (possibly a rounding bug)
                // so we add 1px to avoid the wrapping (#7513)
                ul.width("").outerWidth() + 1,
                this.element.outerWidth()
            ));
        },

        _renderMenu: function (ul, items) {
            var that = this;
            $.each(items, function (index, item) {
                that._renderItemData(ul, item);
            });
        },

        _renderItemData: function (ul, item) {
            return this._renderItem(ul, item).data("ui-autocomplete-item", item);
        },

        _renderItem: function (ul, item) {
            return $("<li>")
                .append($("<div>").text(item.label))
                .appendTo(ul);
        },

        _move: function (direction, event) {
            if (!this.menu.element.is(":visible")) {
                this.search(null, event);
                return;
            }
            if (this.menu.isFirstItem() && /^previous/.test(direction) ||
                this.menu.isLastItem() && /^next/.test(direction)) {

                if (!this.isMultiLine) {
                    this._value(this.term);
                }

                this.menu.blur();
                return;
            }
            this.menu[direction](event);
        },

        widget: function () {
            return this.menu.element;
        },

        _value: function () {
            return this.valueMethod.apply(this.element, arguments);
        },

        _keyEvent: function (keyEvent, event) {
            if (!this.isMultiLine || this.menu.element.is(":visible")) {
                this._move(keyEvent, event);

                // Prevents moving cursor to beginning/end of the text field in some browsers
                event.preventDefault();
            }
        },

        // Support: Chrome <=50
        // We should be able to just use this.element.prop( "isContentEditable" )
        // but hidden elements always report false in Chrome.
        // https://code.google.com/p/chromium/issues/detail?id=313082
        _isContentEditable: function (element) {
            if (!element.length) {
                return false;
            }

            var editable = element.prop("contentEditable");

            if (editable === "inherit") {
                return this._isContentEditable(element.parent());
            }

            return editable === "true";
        }
    });

    $.extend($.ui.autocomplete, {
        escapeRegex: function (value) {
            return value.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, "\\$&");
        },
        filter: function (array, term) {
            var matcher = new RegExp($.ui.autocomplete.escapeRegex(term), "i");
            return $.grep(array, function (value) {
                return matcher.test(value.label || value.value || value);
            });
        }
    });

// Live region extension, adding a `messages` option
// NOTE: This is an experimental API. We are still investigating
// a full solution for string manipulation and internationalization.
    $.widget("ui.autocomplete", $.ui.autocomplete, {
        options: {
            messages: {
                noResults: "No search results.",
                results: function (amount) {
                    return amount + (amount > 1 ? " results are" : " result is") +
                        " available, use up and down arrow keys to navigate.";
                }
            }
        },

        __response: function (content) {
            var message;
            this._superApply(arguments);
            if (this.options.disabled || this.cancelSearch) {
                return;
            }
            if (content && content.length) {
                message = this.options.messages.results(content.length);
            } else {
                message = this.options.messages.noResults;
            }
            this.liveRegion.children().hide();
            $("<div>").text(message).appendTo(this.liveRegion);
        }
    });

    var widgetsAutocomplete = $.ui.autocomplete;


    /*!
 * jQuery UI Controlgroup 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Controlgroup
//>>group: Widgets
//>>description: Visually groups form control widgets
//>>docs: http://api.jqueryui.com/controlgroup/
//>>demos: http://jqueryui.com/controlgroup/
//>>css.structure: ../../themes/base/core.css
//>>css.structure: ../../themes/base/controlgroup.css
//>>css.theme: ../../themes/base/theme.css


    var controlgroupCornerRegex = /ui-corner-([a-z]){2,6}/g;

    var widgetsControlgroup = $.widget("ui.controlgroup", {
        version: "1.12.1",
        defaultElement: "<div>",
        options: {
            direction: "horizontal",
            disabled: null,
            onlyVisible: true,
            items: {
                "button": "input[type=button], input[type=submit], input[type=reset], button, a",
                "controlgroupLabel": ".ui-controlgroup-label",
                "checkboxradio": "input[type='checkbox'], input[type='radio']",
                "selectmenu": "select",
                "spinner": ".ui-spinner-input"
            }
        },

        _create: function () {
            this._enhance();
        },

        // To support the enhanced option in jQuery Mobile, we isolate DOM manipulation
        _enhance: function () {
            this.element.attr("role", "toolbar");
            this.refresh();
        },

        _destroy: function () {
            this._callChildMethod("destroy");
            this.childWidgets.removeData("ui-controlgroup-data");
            this.element.removeAttr("role");
            if (this.options.items.controlgroupLabel) {
                this.element
                    .find(this.options.items.controlgroupLabel)
                    .find(".ui-controlgroup-label-contents")
                    .contents().unwrap();
            }
        },

        _initWidgets: function () {
            var that = this,
                childWidgets = [];

            // First we iterate over each of the items options
            $.each(this.options.items, function (widget, selector) {
                var labels;
                var options = {};

                // Make sure the widget has a selector set
                if (!selector) {
                    return;
                }

                if (widget === "controlgroupLabel") {
                    labels = that.element.find(selector);
                    labels.each(function () {
                        var element = $(this);

                        if (element.children(".ui-controlgroup-label-contents").length) {
                            return;
                        }
                        element.contents()
                            .wrapAll("<span class='ui-controlgroup-label-contents'></span>");
                    });
                    that._addClass(labels, null, "ui-widget ui-widget-content ui-state-default");
                    childWidgets = childWidgets.concat(labels.get());
                    return;
                }

                // Make sure the widget actually exists
                if (!$.fn[widget]) {
                    return;
                }

                // We assume everything is in the middle to start because we can't determine
                // first / last elements until all enhancments are done.
                if (that["_" + widget + "Options"]) {
                    options = that["_" + widget + "Options"]("middle");
                } else {
                    options = {classes: {}};
                }

                // Find instances of this widget inside controlgroup and init them
                that.element
                    .find(selector)
                    .each(function () {
                        var element = $(this);
                        var instance = element[widget]("instance");

                        // We need to clone the default options for this type of widget to avoid
                        // polluting the variable options which has a wider scope than a single widget.
                        var instanceOptions = $.widget.extend({}, options);

                        // If the button is the child of a spinner ignore it
                        // TODO: Find a more generic solution
                        if (widget === "button" && element.parent(".ui-spinner").length) {
                            return;
                        }

                        // Create the widget if it doesn't exist
                        if (!instance) {
                            instance = element[widget]()[widget]("instance");
                        }
                        if (instance) {
                            instanceOptions.classes =
                                that._resolveClassesValues(instanceOptions.classes, instance);
                        }
                        element[widget](instanceOptions);

                        // Store an instance of the controlgroup to be able to reference
                        // from the outermost element for changing options and refresh
                        var widgetElement = element[widget]("widget");
                        $.data(widgetElement[0], "ui-controlgroup-data",
                            instance ? instance : element[widget]("instance"));

                        childWidgets.push(widgetElement[0]);
                    });
            });

            this.childWidgets = $($.unique(childWidgets));
            this._addClass(this.childWidgets, "ui-controlgroup-item");
        },

        _callChildMethod: function (method) {
            this.childWidgets.each(function () {
                var element = $(this),
                    data = element.data("ui-controlgroup-data");
                if (data && data[method]) {
                    data[method]();
                }
            });
        },

        _updateCornerClass: function (element, position) {
            var remove = "ui-corner-top ui-corner-bottom ui-corner-left ui-corner-right ui-corner-all";
            var add = this._buildSimpleOptions(position, "label").classes.label;

            this._removeClass(element, null, remove);
            this._addClass(element, null, add);
        },

        _buildSimpleOptions: function (position, key) {
            var direction = this.options.direction === "vertical";
            var result = {
                classes: {}
            };
            result.classes[key] = {
                "middle": "",
                "first": "ui-corner-" + (direction ? "top" : "left"),
                "last": "ui-corner-" + (direction ? "bottom" : "right"),
                "only": "ui-corner-all"
            }[position];

            return result;
        },

        _spinnerOptions: function (position) {
            var options = this._buildSimpleOptions(position, "ui-spinner");

            options.classes["ui-spinner-up"] = "";
            options.classes["ui-spinner-down"] = "";

            return options;
        },

        _buttonOptions: function (position) {
            return this._buildSimpleOptions(position, "ui-button");
        },

        _checkboxradioOptions: function (position) {
            return this._buildSimpleOptions(position, "ui-checkboxradio-label");
        },

        _selectmenuOptions: function (position) {
            var direction = this.options.direction === "vertical";
            return {
                width: direction ? "auto" : false,
                classes: {
                    middle: {
                        "ui-selectmenu-button-open": "",
                        "ui-selectmenu-button-closed": ""
                    },
                    first: {
                        "ui-selectmenu-button-open": "ui-corner-" + (direction ? "top" : "tl"),
                        "ui-selectmenu-button-closed": "ui-corner-" + (direction ? "top" : "left")
                    },
                    last: {
                        "ui-selectmenu-button-open": direction ? "" : "ui-corner-tr",
                        "ui-selectmenu-button-closed": "ui-corner-" + (direction ? "bottom" : "right")
                    },
                    only: {
                        "ui-selectmenu-button-open": "ui-corner-top",
                        "ui-selectmenu-button-closed": "ui-corner-all"
                    }

                }[position]
            };
        },

        _resolveClassesValues: function (classes, instance) {
            var result = {};
            $.each(classes, function (key) {
                var current = instance.options.classes[key] || "";
                current = $.trim(current.replace(controlgroupCornerRegex, ""));
                result[key] = (current + " " + classes[key]).replace(/\s+/g, " ");
            });
            return result;
        },

        _setOption: function (key, value) {
            if (key === "direction") {
                this._removeClass("ui-controlgroup-" + this.options.direction);
            }

            this._super(key, value);
            if (key === "disabled") {
                this._callChildMethod(value ? "disable" : "enable");
                return;
            }

            this.refresh();
        },

        refresh: function () {
            var children,
                that = this;

            this._addClass("ui-controlgroup ui-controlgroup-" + this.options.direction);

            if (this.options.direction === "horizontal") {
                this._addClass(null, "ui-helper-clearfix");
            }
            this._initWidgets();

            children = this.childWidgets;

            // We filter here because we need to track all childWidgets not just the visible ones
            if (this.options.onlyVisible) {
                children = children.filter(":visible");
            }

            if (children.length) {

                // We do this last because we need to make sure all enhancment is done
                // before determining first and last
                $.each(["first", "last"], function (index, value) {
                    var instance = children[value]().data("ui-controlgroup-data");

                    if (instance && that["_" + instance.widgetName + "Options"]) {
                        var options = that["_" + instance.widgetName + "Options"](
                            children.length === 1 ? "only" : value
                        );
                        options.classes = that._resolveClassesValues(options.classes, instance);
                        instance.element[instance.widgetName](options);
                    } else {
                        that._updateCornerClass(children[value](), value);
                    }
                });

                // Finally call the refresh method on each of the child widgets.
                this._callChildMethod("refresh");
            }
        }
    });

    /*!
 * jQuery UI Checkboxradio 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Checkboxradio
//>>group: Widgets
//>>description: Enhances a form with multiple themeable checkboxes or radio buttons.
//>>docs: http://api.jqueryui.com/checkboxradio/
//>>demos: http://jqueryui.com/checkboxradio/
//>>css.structure: ../../themes/base/core.css
//>>css.structure: ../../themes/base/button.css
//>>css.structure: ../../themes/base/checkboxradio.css
//>>css.theme: ../../themes/base/theme.css


    $.widget("ui.checkboxradio", [$.ui.formResetMixin, {
        version: "1.12.1",
        options: {
            disabled: null,
            label: null,
            icon: true,
            classes: {
                "ui-checkboxradio-label": "ui-corner-all",
                "ui-checkboxradio-icon": "ui-corner-all"
            }
        },

        _getCreateOptions: function () {
            var disabled, labels;
            var that = this;
            var options = this._super() || {};

            // We read the type here, because it makes more sense to throw a element type error first,
            // rather then the error for lack of a label. Often if its the wrong type, it
            // won't have a label (e.g. calling on a div, btn, etc)
            this._readType();

            labels = this.element.labels();

            // If there are multiple labels, use the last one
            this.label = $(labels[labels.length - 1]);
            if (!this.label.length) {
                $.error("No label found for checkboxradio widget");
            }

            this.originalLabel = "";

            // We need to get the label text but this may also need to make sure it does not contain the
            // input itself.
            this.label.contents().not(this.element[0]).each(function () {

                // The label contents could be text, html, or a mix. We concat each element to get a
                // string representation of the label, without the input as part of it.
                that.originalLabel += this.nodeType === 3 ? $(this).text() : this.outerHTML;
            });

            // Set the label option if we found label text
            if (this.originalLabel) {
                options.label = this.originalLabel;
            }

            disabled = this.element[0].disabled;
            if (disabled != null) {
                options.disabled = disabled;
            }
            return options;
        },

        _create: function () {
            var checked = this.element[0].checked;

            this._bindFormResetHandler();

            if (this.options.disabled == null) {
                this.options.disabled = this.element[0].disabled;
            }

            this._setOption("disabled", this.options.disabled);
            this._addClass("ui-checkboxradio", "ui-helper-hidden-accessible");
            this._addClass(this.label, "ui-checkboxradio-label", "ui-button ui-widget");

            if (this.type === "radio") {
                this._addClass(this.label, "ui-checkboxradio-radio-label");
            }

            if (this.options.label && this.options.label !== this.originalLabel) {
                this._updateLabel();
            } else if (this.originalLabel) {
                this.options.label = this.originalLabel;
            }

            this._enhance();

            if (checked) {
                this._addClass(this.label, "ui-checkboxradio-checked", "ui-state-active");
                if (this.icon) {
                    this._addClass(this.icon, null, "ui-state-hover");
                }
            }

            this._on({
                change: "_toggleClasses",
                focus: function () {
                    this._addClass(this.label, null, "ui-state-focus ui-visual-focus");
                },
                blur: function () {
                    this._removeClass(this.label, null, "ui-state-focus ui-visual-focus");
                }
            });
        },

        _readType: function () {
            var nodeName = this.element[0].nodeName.toLowerCase();
            this.type = this.element[0].type;
            if (nodeName !== "input" || !/radio|checkbox/.test(this.type)) {
                $.error("Can't create checkboxradio on element.nodeName=" + nodeName +
                    " and element.type=" + this.type);
            }
        },

        // Support jQuery Mobile enhanced option
        _enhance: function () {
            this._updateIcon(this.element[0].checked);
        },

        widget: function () {
            return this.label;
        },

        _getRadioGroup: function () {
            var group;
            var name = this.element[0].name;
            var nameSelector = "input[name='" + $.ui.escapeSelector(name) + "']";

            if (!name) {
                return $([]);
            }

            if (this.form.length) {
                group = $(this.form[0].elements).filter(nameSelector);
            } else {

                // Not inside a form, check all inputs that also are not inside a form
                group = $(nameSelector).filter(function () {
                    return $(this).form().length === 0;
                });
            }

            return group.not(this.element);
        },

        _toggleClasses: function () {
            var checked = this.element[0].checked;
            this._toggleClass(this.label, "ui-checkboxradio-checked", "ui-state-active", checked);

            if (this.options.icon && this.type === "checkbox") {
                this._toggleClass(this.icon, null, "ui-icon-check ui-state-checked", checked)
                    ._toggleClass(this.icon, null, "ui-icon-blank", !checked);
            }

            if (this.type === "radio") {
                this._getRadioGroup()
                    .each(function () {
                        var instance = $(this).checkboxradio("instance");

                        if (instance) {
                            instance._removeClass(instance.label,
                                "ui-checkboxradio-checked", "ui-state-active");
                        }
                    });
            }
        },

        _destroy: function () {
            this._unbindFormResetHandler();

            if (this.icon) {
                this.icon.remove();
                this.iconSpace.remove();
            }
        },

        _setOption: function (key, value) {

            // We don't allow the value to be set to nothing
            if (key === "label" && !value) {
                return;
            }

            this._super(key, value);

            if (key === "disabled") {
                this._toggleClass(this.label, null, "ui-state-disabled", value);
                this.element[0].disabled = value;

                // Don't refresh when setting disabled
                return;
            }
            this.refresh();
        },

        _updateIcon: function (checked) {
            var toAdd = "ui-icon ui-icon-background ";

            if (this.options.icon) {
                if (!this.icon) {
                    this.icon = $("<span>");
                    this.iconSpace = $("<span> </span>");
                    this._addClass(this.iconSpace, "ui-checkboxradio-icon-space");
                }

                if (this.type === "checkbox") {
                    toAdd += checked ? "ui-icon-check ui-state-checked" : "ui-icon-blank";
                    this._removeClass(this.icon, null, checked ? "ui-icon-blank" : "ui-icon-check");
                } else {
                    toAdd += "ui-icon-blank";
                }
                this._addClass(this.icon, "ui-checkboxradio-icon", toAdd);
                if (!checked) {
                    this._removeClass(this.icon, null, "ui-icon-check ui-state-checked");
                }
                this.icon.prependTo(this.label).after(this.iconSpace);
            } else if (this.icon !== undefined) {
                this.icon.remove();
                this.iconSpace.remove();
                delete this.icon;
            }
        },

        _updateLabel: function () {

            // Remove the contents of the label ( minus the icon, icon space, and input )
            var contents = this.label.contents().not(this.element[0]);
            if (this.icon) {
                contents = contents.not(this.icon[0]);
            }
            if (this.iconSpace) {
                contents = contents.not(this.iconSpace[0]);
            }
            contents.remove();

            this.label.append(this.options.label);
        },

        refresh: function () {
            var checked = this.element[0].checked,
                isDisabled = this.element[0].disabled;

            this._updateIcon(checked);
            this._toggleClass(this.label, "ui-checkboxradio-checked", "ui-state-active", checked);
            if (this.options.label !== null) {
                this._updateLabel();
            }

            if (isDisabled !== this.options.disabled) {
                this._setOptions({"disabled": isDisabled});
            }
        }

    }]);

    var widgetsCheckboxradio = $.ui.checkboxradio;


    /*!
 * jQuery UI Button 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Button
//>>group: Widgets
//>>description: Enhances a form with themeable buttons.
//>>docs: http://api.jqueryui.com/button/
//>>demos: http://jqueryui.com/button/
//>>css.structure: ../../themes/base/core.css
//>>css.structure: ../../themes/base/button.css
//>>css.theme: ../../themes/base/theme.css


    $.widget("ui.button", {
        version: "1.12.1",
        defaultElement: "<button>",
        options: {
            classes: {
                "ui-button": "ui-corner-all"
            },
            disabled: null,
            icon: null,
            iconPosition: "beginning",
            label: null,
            showLabel: true
        },

        _getCreateOptions: function () {
            var disabled,

                // This is to support cases like in jQuery Mobile where the base widget does have
                // an implementation of _getCreateOptions
                options = this._super() || {};

            this.isInput = this.element.is("input");

            disabled = this.element[0].disabled;
            if (disabled != null) {
                options.disabled = disabled;
            }

            this.originalLabel = this.isInput ? this.element.val() : this.element.html();
            if (this.originalLabel) {
                options.label = this.originalLabel;
            }

            return options;
        },

        _create: function () {
            if (!this.option.showLabel & !this.options.icon) {
                this.options.showLabel = true;
            }

            // We have to check the option again here even though we did in _getCreateOptions,
            // because null may have been passed on init which would override what was set in
            // _getCreateOptions
            if (this.options.disabled == null) {
                this.options.disabled = this.element[0].disabled || false;
            }

            this.hasTitle = !!this.element.attr("title");

            // Check to see if the label needs to be set or if its already correct
            if (this.options.label && this.options.label !== this.originalLabel) {
                if (this.isInput) {
                    this.element.val(this.options.label);
                } else {
                    this.element.html(this.options.label);
                }
            }
            this._addClass("ui-button", "ui-widget");
            this._setOption("disabled", this.options.disabled);
            this._enhance();

            if (this.element.is("a")) {
                this._on({
                    "keyup": function (event) {
                        if (event.keyCode === $.ui.keyCode.SPACE) {
                            event.preventDefault();

                            // Support: PhantomJS <= 1.9, IE 8 Only
                            // If a native click is available use it so we actually cause navigation
                            // otherwise just trigger a click event
                            if (this.element[0].click) {
                                this.element[0].click();
                            } else {
                                this.element.trigger("click");
                            }
                        }
                    }
                });
            }
        },

        _enhance: function () {
            if (!this.element.is("button")) {
                this.element.attr("role", "button");
            }

            if (this.options.icon) {
                this._updateIcon("icon", this.options.icon);
                this._updateTooltip();
            }
        },

        _updateTooltip: function () {
            this.title = this.element.attr("title");

            if (!this.options.showLabel && !this.title) {
                this.element.attr("title", this.options.label);
            }
        },

        _updateIcon: function (option, value) {
            var icon = option !== "iconPosition",
                position = icon ? this.options.iconPosition : value,
                displayBlock = position === "top" || position === "bottom";

            // Create icon
            if (!this.icon) {
                this.icon = $("<span>");

                this._addClass(this.icon, "ui-button-icon", "ui-icon");

                if (!this.options.showLabel) {
                    this._addClass("ui-button-icon-only");
                }
            } else if (icon) {

                // If we are updating the icon remove the old icon class
                this._removeClass(this.icon, null, this.options.icon);
            }

            // If we are updating the icon add the new icon class
            if (icon) {
                this._addClass(this.icon, null, value);
            }

            this._attachIcon(position);

            // If the icon is on top or bottom we need to add the ui-widget-icon-block class and remove
            // the iconSpace if there is one.
            if (displayBlock) {
                this._addClass(this.icon, null, "ui-widget-icon-block");
                if (this.iconSpace) {
                    this.iconSpace.remove();
                }
            } else {

                // Position is beginning or end so remove the ui-widget-icon-block class and add the
                // space if it does not exist
                if (!this.iconSpace) {
                    this.iconSpace = $("<span> </span>");
                    this._addClass(this.iconSpace, "ui-button-icon-space");
                }
                this._removeClass(this.icon, null, "ui-wiget-icon-block");
                this._attachIconSpace(position);
            }
        },

        _destroy: function () {
            this.element.removeAttr("role");

            if (this.icon) {
                this.icon.remove();
            }
            if (this.iconSpace) {
                this.iconSpace.remove();
            }
            if (!this.hasTitle) {
                this.element.removeAttr("title");
            }
        },

        _attachIconSpace: function (iconPosition) {
            this.icon[/^(?:end|bottom)/.test(iconPosition) ? "before" : "after"](this.iconSpace);
        },

        _attachIcon: function (iconPosition) {
            this.element[/^(?:end|bottom)/.test(iconPosition) ? "append" : "prepend"](this.icon);
        },

        _setOptions: function (options) {
            var newShowLabel = options.showLabel === undefined ?
                this.options.showLabel :
                options.showLabel,
                newIcon = options.icon === undefined ? this.options.icon : options.icon;

            if (!newShowLabel && !newIcon) {
                options.showLabel = true;
            }
            this._super(options);
        },

        _setOption: function (key, value) {
            if (key === "icon") {
                if (value) {
                    this._updateIcon(key, value);
                } else if (this.icon) {
                    this.icon.remove();
                    if (this.iconSpace) {
                        this.iconSpace.remove();
                    }
                }
            }

            if (key === "iconPosition") {
                this._updateIcon(key, value);
            }

            // Make sure we can't end up with a button that has neither text nor icon
            if (key === "showLabel") {
                this._toggleClass("ui-button-icon-only", null, !value);
                this._updateTooltip();
            }

            if (key === "label") {
                if (this.isInput) {
                    this.element.val(value);
                } else {

                    // If there is an icon, append it, else nothing then append the value
                    // this avoids removal of the icon when setting label text
                    this.element.html(value);
                    if (this.icon) {
                        this._attachIcon(this.options.iconPosition);
                        this._attachIconSpace(this.options.iconPosition);
                    }
                }
            }

            this._super(key, value);

            if (key === "disabled") {
                this._toggleClass(null, "ui-state-disabled", value);
                this.element[0].disabled = value;
                if (value) {
                    this.element.blur();
                }
            }
        },

        refresh: function () {

            // Make sure to only check disabled if its an element that supports this otherwise
            // check for the disabled class to determine state
            var isDisabled = this.element.is("input, button") ?
                this.element[0].disabled : this.element.hasClass("ui-button-disabled");

            if (isDisabled !== this.options.disabled) {
                this._setOptions({disabled: isDisabled});
            }

            this._updateTooltip();
        }
    });

// DEPRECATED
    if ($.uiBackCompat !== false) {

        // Text and Icons options
        $.widget("ui.button", $.ui.button, {
            options: {
                text: true,
                icons: {
                    primary: null,
                    secondary: null
                }
            },

            _create: function () {
                if (this.options.showLabel && !this.options.text) {
                    this.options.showLabel = this.options.text;
                }
                if (!this.options.showLabel && this.options.text) {
                    this.options.text = this.options.showLabel;
                }
                if (!this.options.icon && (this.options.icons.primary ||
                    this.options.icons.secondary)) {
                    if (this.options.icons.primary) {
                        this.options.icon = this.options.icons.primary;
                    } else {
                        this.options.icon = this.options.icons.secondary;
                        this.options.iconPosition = "end";
                    }
                } else if (this.options.icon) {
                    this.options.icons.primary = this.options.icon;
                }
                this._super();
            },

            _setOption: function (key, value) {
                if (key === "text") {
                    this._super("showLabel", value);
                    return;
                }
                if (key === "showLabel") {
                    this.options.text = value;
                }
                if (key === "icon") {
                    this.options.icons.primary = value;
                }
                if (key === "icons") {
                    if (value.primary) {
                        this._super("icon", value.primary);
                        this._super("iconPosition", "beginning");
                    } else if (value.secondary) {
                        this._super("icon", value.secondary);
                        this._super("iconPosition", "end");
                    }
                }
                this._superApply(arguments);
            }
        });

        $.fn.button = (function (orig) {
            return function () {
                if (!this.length || (this.length && this[0].tagName !== "INPUT") ||
                    (this.length && this[0].tagName === "INPUT" && (
                        this.attr("type") !== "checkbox" && this.attr("type") !== "radio"
                    ))) {
                    return orig.apply(this, arguments);
                }
                if (!$.ui.checkboxradio) {
                    $.error("Checkboxradio widget missing");
                }
                if (arguments.length === 0) {
                    return this.checkboxradio({
                        "icon": false
                    });
                }
                return this.checkboxradio.apply(this, arguments);
            };
        })($.fn.button);

        $.fn.buttonset = function () {
            if (!$.ui.controlgroup) {
                $.error("Controlgroup widget missing");
            }
            if (arguments[0] === "option" && arguments[1] === "items" && arguments[2]) {
                return this.controlgroup.apply(this,
                    [arguments[0], "items.button", arguments[2]]);
            }
            if (arguments[0] === "option" && arguments[1] === "items") {
                return this.controlgroup.apply(this, [arguments[0], "items.button"]);
            }
            if (typeof arguments[0] === "object" && arguments[0].items) {
                arguments[0].items = {
                    button: arguments[0].items
                };
            }
            return this.controlgroup.apply(this, arguments);
        };
    }

    var widgetsButton = $.ui.button;


// jscs:disable maximumLineLength
    /* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */
    /*!
 * jQuery UI Datepicker 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Datepicker
//>>group: Widgets
//>>description: Displays a calendar from an input or inline for selecting dates.
//>>docs: http://api.jqueryui.com/datepicker/
//>>demos: http://jqueryui.com/datepicker/
//>>css.structure: ../../themes/base/core.css
//>>css.structure: ../../themes/base/datepicker.css
//>>css.theme: ../../themes/base/theme.css


    $.extend($.ui, {datepicker: {version: "1.12.1"}});

    var datepicker_instActive;

    function datepicker_getZindex(elem) {
        var position, value;
        while (elem.length && elem[0] !== document) {

            // Ignore z-index if position is set to a value where z-index is ignored by the browser
            // This makes behavior of this function consistent across browsers
            // WebKit always returns auto if the element is positioned
            position = elem.css("position");
            if (position === "absolute" || position === "relative" || position === "fixed") {

                // IE returns 0 when zIndex is not specified
                // other browsers return a string
                // we ignore the case of nested elements with an explicit value of 0
                // <div style="z-index: -10;"><div style="z-index: 0;"></div></div>
                value = parseInt(elem.css("zIndex"), 10);
                if (!isNaN(value) && value !== 0) {
                    return value;
                }
            }
            elem = elem.parent();
        }

        return 0;
    }

    /* Date picker manager.
   Use the singleton instance of this class, $.datepicker, to interact with the date picker.
   Settings for (groups of) date pickers are maintained in an instance object,
   allowing multiple different settings on the same page. */

    function Datepicker() {
        this._curInst = null; // The current instance in use
        this._keyEvent = false; // If the last event was a key event
        this._disabledInputs = []; // List of date picker inputs that have been disabled
        this._datepickerShowing = false; // True if the popup picker is showing , false if not
        this._inDialog = false; // True if showing within a "dialog", false if not
        this._mainDivId = "ui-datepicker-div"; // The ID of the main datepicker division
        this._inlineClass = "ui-datepicker-inline"; // The name of the inline marker class
        this._appendClass = "ui-datepicker-append"; // The name of the append marker class
        this._triggerClass = "ui-datepicker-trigger"; // The name of the trigger marker class
        this._dialogClass = "ui-datepicker-dialog"; // The name of the dialog marker class
        this._disableClass = "ui-datepicker-disabled"; // The name of the disabled covering marker class
        this._unselectableClass = "ui-datepicker-unselectable"; // The name of the unselectable cell marker class
        this._currentClass = "ui-datepicker-current-day"; // The name of the current day marker class
        this._dayOverClass = "ui-datepicker-days-cell-over"; // The name of the day hover marker class
        this.regional = []; // Available regional settings, indexed by language code
        this.regional[""] = { // Default regional settings
            closeText: "Done", // Display text for close link
            prevText: "Prev", // Display text for previous month link
            nextText: "Next", // Display text for next month link
            currentText: "Today", // Display text for current month link
            monthNames: ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"], // Names of months for drop-down and formatting
            monthNamesShort: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"], // For formatting
            dayNames: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"], // For formatting
            dayNamesShort: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"], // For formatting
            dayNamesMin: ["Su", "Mo", "Tu", "We", "Th", "Fr", "Sa"], // Column headings for days starting at Sunday
            weekHeader: "Wk", // Column header for week of the year
            dateFormat: "mm/dd/yy", // See format options on parseDate
            firstDay: 0, // The first day of the week, Sun = 0, Mon = 1, ...
            isRTL: false, // True if right-to-left language, false if left-to-right
            showMonthAfterYear: false, // True if the year select precedes month, false for month then year
            yearSuffix: "" // Additional text to append to the year in the month headers
        };
        this._defaults = { // Global defaults for all the date picker instances
            showOn: "focus", // "focus" for popup on focus,
            // "button" for trigger button, or "both" for either
            showAnim: "fadeIn", // Name of jQuery animation for popup
            showOptions: {}, // Options for enhanced animations
            defaultDate: null, // Used when field is blank: actual date,
            // +/-number for offset from today, null for today
            appendText: "", // Display text following the input box, e.g. showing the format
            buttonText: "...", // Text for trigger button
            buttonImage: "", // URL for trigger button image
            buttonImageOnly: false, // True if the image appears alone, false if it appears on a button
            hideIfNoPrevNext: false, // True to hide next/previous month links
            // if not applicable, false to just disable them
            navigationAsDateFormat: false, // True if date formatting applied to prev/today/next links
            gotoCurrent: false, // True if today link goes back to current selection instead
            changeMonth: false, // True if month can be selected directly, false if only prev/next
            changeYear: false, // True if year can be selected directly, false if only prev/next
            yearRange: "c-10:c+10", // Range of years to display in drop-down,
            // either relative to today's year (-nn:+nn), relative to currently displayed year
            // (c-nn:c+nn), absolute (nnnn:nnnn), or a combination of the above (nnnn:-n)
            showOtherMonths: false, // True to show dates in other months, false to leave blank
            selectOtherMonths: false, // True to allow selection of dates in other months, false for unselectable
            showWeek: false, // True to show week of the year, false to not show it
            calculateWeek: this.iso8601Week, // How to calculate the week of the year,
            // takes a Date and returns the number of the week for it
            shortYearCutoff: "+10", // Short year values < this are in the current century,
            // > this are in the previous century,
            // string value starting with "+" for current year + value
            minDate: null, // The earliest selectable date, or null for no limit
            maxDate: null, // The latest selectable date, or null for no limit
            duration: "fast", // Duration of display/closure
            beforeShowDay: null, // Function that takes a date and returns an array with
            // [0] = true if selectable, false if not, [1] = custom CSS class name(s) or "",
            // [2] = cell title (optional), e.g. $.datepicker.noWeekends
            beforeShow: null, // Function that takes an input field and
            // returns a set of custom settings for the date picker
            onSelect: null, // Define a callback function when a date is selected
            onChangeMonthYear: null, // Define a callback function when the month or year is changed
            onClose: null, // Define a callback function when the datepicker is closed
            numberOfMonths: 1, // Number of months to show at a time
            showCurrentAtPos: 0, // The position in multipe months at which to show the current month (starting at 0)
            stepMonths: 1, // Number of months to step back/forward
            stepBigMonths: 12, // Number of months to step back/forward for the big links
            altField: "", // Selector for an alternate field to store selected dates into
            altFormat: "", // The date format to use for the alternate field
            constrainInput: true, // The input is constrained by the current date format
            showButtonPanel: false, // True to show button panel, false to not show it
            autoSize: false, // True to size the input for the date format, false to leave as is
            disabled: false // The initial disabled state
        };
        $.extend(this._defaults, this.regional[""]);
        this.regional.en = $.extend(true, {}, this.regional[""]);
        this.regional["en-US"] = $.extend(true, {}, this.regional.en);
        this.dpDiv = datepicker_bindHover($("<div id='" + this._mainDivId + "' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"));
    }

    $.extend(Datepicker.prototype, {
        /* Class name added to elements to indicate already configured with a date picker. */
        markerClassName: "hasDatepicker",

        //Keep track of the maximum number of rows displayed (see #7043)
        maxRows: 4,

        // TODO rename to "widget" when switching to widget factory
        _widgetDatepicker: function () {
            return this.dpDiv;
        },

        /* Override the default settings for all instances of the date picker.
	 * @param  settings  object - the new settings to use as defaults (anonymous object)
	 * @return the manager object
	 */
        setDefaults: function (settings) {
            datepicker_extendRemove(this._defaults, settings || {});
            return this;
        },

        /* Attach the date picker to a jQuery selection.
	 * @param  target	element - the target input field or division or span
	 * @param  settings  object - the new settings to use for this date picker instance (anonymous)
	 */
        _attachDatepicker: function (target, settings) {
            var nodeName, inline, inst;
            nodeName = target.nodeName.toLowerCase();
            inline = (nodeName === "div" || nodeName === "span");
            if (!target.id) {
                this.uuid += 1;
                target.id = "dp" + this.uuid;
            }
            inst = this._newInst($(target), inline);
            inst.settings = $.extend({}, settings || {});
            if (nodeName === "input") {
                this._connectDatepicker(target, inst);
            } else if (inline) {
                this._inlineDatepicker(target, inst);
            }
        },

        /* Create a new instance object. */
        _newInst: function (target, inline) {
            var id = target[0].id.replace(/([^A-Za-z0-9_\-])/g, "\\\\$1"); // escape jQuery meta chars
            return {
                id: id, input: target, // associated target
                selectedDay: 0, selectedMonth: 0, selectedYear: 0, // current selection
                drawMonth: 0, drawYear: 0, // month being drawn
                inline: inline, // is datepicker inline or not
                dpDiv: (!inline ? this.dpDiv : // presentation div
                    datepicker_bindHover($("<div class='" + this._inlineClass + " ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")))
            };
        },

        /* Attach the date picker to an input field. */
        _connectDatepicker: function (target, inst) {
            var input = $(target);
            inst.append = $([]);
            inst.trigger = $([]);
            if (input.hasClass(this.markerClassName)) {
                return;
            }
            this._attachments(input, inst);
            input.addClass(this.markerClassName).on("keydown", this._doKeyDown).on("keypress", this._doKeyPress).on("keyup", this._doKeyUp);
            this._autoSize(inst);
            $.data(target, "datepicker", inst);

            //If disabled option is true, disable the datepicker once it has been attached to the input (see ticket #5665)
            if (inst.settings.disabled) {
                this._disableDatepicker(target);
            }
        },

        /* Make attachments based on settings. */
        _attachments: function (input, inst) {
            var showOn, buttonText, buttonImage,
                appendText = this._get(inst, "appendText"),
                isRTL = this._get(inst, "isRTL");

            if (inst.append) {
                inst.append.remove();
            }
            if (appendText) {
                inst.append = $("<span class='" + this._appendClass + "'>" + appendText + "</span>");
                input[isRTL ? "before" : "after"](inst.append);
            }

            input.off("focus", this._showDatepicker);

            if (inst.trigger) {
                inst.trigger.remove();
            }

            showOn = this._get(inst, "showOn");
            if (showOn === "focus" || showOn === "both") { // pop-up date picker when in the marked field
                input.on("focus", this._showDatepicker);
            }
            if (showOn === "button" || showOn === "both") { // pop-up date picker when button clicked
                buttonText = this._get(inst, "buttonText");
                buttonImage = this._get(inst, "buttonImage");
                inst.trigger = $(this._get(inst, "buttonImageOnly") ?
                    $("<img/>").addClass(this._triggerClass).attr({
                        src: buttonImage,
                        alt: buttonText,
                        title: buttonText
                    }) :
                    $("<button type='button'></button>").addClass(this._triggerClass).html(!buttonImage ? buttonText : $("<img/>").attr(
                        {src: buttonImage, alt: buttonText, title: buttonText})));
                input[isRTL ? "before" : "after"](inst.trigger);
                inst.trigger.on("click", function () {
                    if ($.datepicker._datepickerShowing && $.datepicker._lastInput === input[0]) {
                        $.datepicker._hideDatepicker();
                    } else if ($.datepicker._datepickerShowing && $.datepicker._lastInput !== input[0]) {
                        $.datepicker._hideDatepicker();
                        $.datepicker._showDatepicker(input[0]);
                    } else {
                        $.datepicker._showDatepicker(input[0]);
                    }
                    return false;
                });
            }
        },

        /* Apply the maximum length for the date format. */
        _autoSize: function (inst) {
            if (this._get(inst, "autoSize") && !inst.inline) {
                var findMax, max, maxI, i,
                    date = new Date(2009, 12 - 1, 20), // Ensure double digits
                    dateFormat = this._get(inst, "dateFormat");

                if (dateFormat.match(/[DM]/)) {
                    findMax = function (names) {
                        max = 0;
                        maxI = 0;
                        for (i = 0; i < names.length; i++) {
                            if (names[i].length > max) {
                                max = names[i].length;
                                maxI = i;
                            }
                        }
                        return maxI;
                    };
                    date.setMonth(findMax(this._get(inst, (dateFormat.match(/MM/) ?
                        "monthNames" : "monthNamesShort"))));
                    date.setDate(findMax(this._get(inst, (dateFormat.match(/DD/) ?
                        "dayNames" : "dayNamesShort"))) + 20 - date.getDay());
                }
                inst.input.attr("size", this._formatDate(inst, date).length);
            }
        },

        /* Attach an inline date picker to a div. */
        _inlineDatepicker: function (target, inst) {
            var divSpan = $(target);
            if (divSpan.hasClass(this.markerClassName)) {
                return;
            }
            divSpan.addClass(this.markerClassName).append(inst.dpDiv);
            $.data(target, "datepicker", inst);
            this._setDate(inst, this._getDefaultDate(inst), true);
            this._updateDatepicker(inst);
            this._updateAlternate(inst);

            //If disabled option is true, disable the datepicker before showing it (see ticket #5665)
            if (inst.settings.disabled) {
                this._disableDatepicker(target);
            }

            // Set display:block in place of inst.dpDiv.show() which won't work on disconnected elements
            // http://bugs.jqueryui.com/ticket/7552 - A Datepicker created on a detached div has zero height
            inst.dpDiv.css("display", "block");
        },

        /* Pop-up the date picker in a "dialog" box.
	 * @param  input element - ignored
	 * @param  date	string or Date - the initial date to display
	 * @param  onSelect  function - the function to call when a date is selected
	 * @param  settings  object - update the dialog date picker instance's settings (anonymous object)
	 * @param  pos int[2] - coordinates for the dialog's position within the screen or
	 *					event - with x/y coordinates or
	 *					leave empty for default (screen centre)
	 * @return the manager object
	 */
        _dialogDatepicker: function (input, date, onSelect, settings, pos) {
            var id, browserWidth, browserHeight, scrollX, scrollY,
                inst = this._dialogInst; // internal instance

            if (!inst) {
                this.uuid += 1;
                id = "dp" + this.uuid;
                this._dialogInput = $("<input type='text' id='" + id +
                    "' style='position: absolute; top: -100px; width: 0px;'/>");
                this._dialogInput.on("keydown", this._doKeyDown);
                $("body").append(this._dialogInput);
                inst = this._dialogInst = this._newInst(this._dialogInput, false);
                inst.settings = {};
                $.data(this._dialogInput[0], "datepicker", inst);
            }
            datepicker_extendRemove(inst.settings, settings || {});
            date = (date && date.constructor === Date ? this._formatDate(inst, date) : date);
            this._dialogInput.val(date);

            this._pos = (pos ? (pos.length ? pos : [pos.pageX, pos.pageY]) : null);
            if (!this._pos) {
                browserWidth = document.documentElement.clientWidth;
                browserHeight = document.documentElement.clientHeight;
                scrollX = document.documentElement.scrollLeft || document.body.scrollLeft;
                scrollY = document.documentElement.scrollTop || document.body.scrollTop;
                this._pos = // should use actual width/height below
                    [(browserWidth / 2) - 100 + scrollX, (browserHeight / 2) - 150 + scrollY];
            }

            // Move input on screen for focus, but hidden behind dialog
            this._dialogInput.css("left", (this._pos[0] + 20) + "px").css("top", this._pos[1] + "px");
            inst.settings.onSelect = onSelect;
            this._inDialog = true;
            this.dpDiv.addClass(this._dialogClass);
            this._showDatepicker(this._dialogInput[0]);
            if ($.blockUI) {
                $.blockUI(this.dpDiv);
            }
            $.data(this._dialogInput[0], "datepicker", inst);
            return this;
        },

        /* Detach a datepicker from its control.
	 * @param  target	element - the target input field or division or span
	 */
        _destroyDatepicker: function (target) {
            var nodeName,
                $target = $(target),
                inst = $.data(target, "datepicker");

            if (!$target.hasClass(this.markerClassName)) {
                return;
            }

            nodeName = target.nodeName.toLowerCase();
            $.removeData(target, "datepicker");
            if (nodeName === "input") {
                inst.append.remove();
                inst.trigger.remove();
                $target.removeClass(this.markerClassName).off("focus", this._showDatepicker).off("keydown", this._doKeyDown).off("keypress", this._doKeyPress).off("keyup", this._doKeyUp);
            } else if (nodeName === "div" || nodeName === "span") {
                $target.removeClass(this.markerClassName).empty();
            }

            if (datepicker_instActive === inst) {
                datepicker_instActive = null;
            }
        },

        /* Enable the date picker to a jQuery selection.
	 * @param  target	element - the target input field or division or span
	 */
        _enableDatepicker: function (target) {
            var nodeName, inline,
                $target = $(target),
                inst = $.data(target, "datepicker");

            if (!$target.hasClass(this.markerClassName)) {
                return;
            }

            nodeName = target.nodeName.toLowerCase();
            if (nodeName === "input") {
                target.disabled = false;
                inst.trigger.filter("button").each(function () {
                    this.disabled = false;
                }).end().filter("img").css({opacity: "1.0", cursor: ""});
            } else if (nodeName === "div" || nodeName === "span") {
                inline = $target.children("." + this._inlineClass);
                inline.children().removeClass("ui-state-disabled");
                inline.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled", false);
            }
            this._disabledInputs = $.map(this._disabledInputs,
                function (value) {
                    return (value === target ? null : value);
                }); // delete entry
        },

        /* Disable the date picker to a jQuery selection.
	 * @param  target	element - the target input field or division or span
	 */
        _disableDatepicker: function (target) {
            var nodeName, inline,
                $target = $(target),
                inst = $.data(target, "datepicker");

            if (!$target.hasClass(this.markerClassName)) {
                return;
            }

            nodeName = target.nodeName.toLowerCase();
            if (nodeName === "input") {
                target.disabled = true;
                inst.trigger.filter("button").each(function () {
                    this.disabled = true;
                }).end().filter("img").css({opacity: "0.5", cursor: "default"});
            } else if (nodeName === "div" || nodeName === "span") {
                inline = $target.children("." + this._inlineClass);
                inline.children().addClass("ui-state-disabled");
                inline.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled", true);
            }
            this._disabledInputs = $.map(this._disabledInputs,
                function (value) {
                    return (value === target ? null : value);
                }); // delete entry
            this._disabledInputs[this._disabledInputs.length] = target;
        },

        /* Is the first field in a jQuery collection disabled as a datepicker?
	 * @param  target	element - the target input field or division or span
	 * @return boolean - true if disabled, false if enabled
	 */
        _isDisabledDatepicker: function (target) {
            if (!target) {
                return false;
            }
            for (var i = 0; i < this._disabledInputs.length; i++) {
                if (this._disabledInputs[i] === target) {
                    return true;
                }
            }
            return false;
        },

        /* Retrieve the instance data for the target control.
	 * @param  target  element - the target input field or division or span
	 * @return  object - the associated instance data
	 * @throws  error if a jQuery problem getting data
	 */
        _getInst: function (target) {
            try {
                return $.data(target, "datepicker");
            }
            catch (err) {
                throw "Missing instance data for this datepicker";
            }
        },

        /* Update or retrieve the settings for a date picker attached to an input field or division.
	 * @param  target  element - the target input field or division or span
	 * @param  name	object - the new settings to update or
	 *				string - the name of the setting to change or retrieve,
	 *				when retrieving also "all" for all instance settings or
	 *				"defaults" for all global defaults
	 * @param  value   any - the new value for the setting
	 *				(omit if above is an object or to retrieve a value)
	 */
        _optionDatepicker: function (target, name, value) {
            var settings, date, minDate, maxDate,
                inst = this._getInst(target);

            if (arguments.length === 2 && typeof name === "string") {
                return (name === "defaults" ? $.extend({}, $.datepicker._defaults) :
                    (inst ? (name === "all" ? $.extend({}, inst.settings) :
                        this._get(inst, name)) : null));
            }

            settings = name || {};
            if (typeof name === "string") {
                settings = {};
                settings[name] = value;
            }

            if (inst) {
                if (this._curInst === inst) {
                    this._hideDatepicker();
                }

                date = this._getDateDatepicker(target, true);
                minDate = this._getMinMaxDate(inst, "min");
                maxDate = this._getMinMaxDate(inst, "max");
                datepicker_extendRemove(inst.settings, settings);

                // reformat the old minDate/maxDate values if dateFormat changes and a new minDate/maxDate isn't provided
                if (minDate !== null && settings.dateFormat !== undefined && settings.minDate === undefined) {
                    inst.settings.minDate = this._formatDate(inst, minDate);
                }
                if (maxDate !== null && settings.dateFormat !== undefined && settings.maxDate === undefined) {
                    inst.settings.maxDate = this._formatDate(inst, maxDate);
                }
                if ("disabled" in settings) {
                    if (settings.disabled) {
                        this._disableDatepicker(target);
                    } else {
                        this._enableDatepicker(target);
                    }
                }
                this._attachments($(target), inst);
                this._autoSize(inst);
                this._setDate(inst, date);
                this._updateAlternate(inst);
                this._updateDatepicker(inst);
            }
        },

        // Change method deprecated
        _changeDatepicker: function (target, name, value) {
            this._optionDatepicker(target, name, value);
        },

        /* Redraw the date picker attached to an input field or division.
	 * @param  target  element - the target input field or division or span
	 */
        _refreshDatepicker: function (target) {
            var inst = this._getInst(target);
            if (inst) {
                this._updateDatepicker(inst);
            }
        },

        /* Set the dates for a jQuery selection.
	 * @param  target element - the target input field or division or span
	 * @param  date	Date - the new date
	 */
        _setDateDatepicker: function (target, date) {
            var inst = this._getInst(target);
            if (inst) {
                this._setDate(inst, date);
                this._updateDatepicker(inst);
                this._updateAlternate(inst);
            }
        },

        /* Get the date(s) for the first entry in a jQuery selection.
	 * @param  target element - the target input field or division or span
	 * @param  noDefault boolean - true if no default date is to be used
	 * @return Date - the current date
	 */
        _getDateDatepicker: function (target, noDefault) {
            var inst = this._getInst(target);
            if (inst && !inst.inline) {
                this._setDateFromField(inst, noDefault);
            }
            return (inst ? this._getDate(inst) : null);
        },

        /* Handle keystrokes. */
        _doKeyDown: function (event) {
            var onSelect, dateStr, sel,
                inst = $.datepicker._getInst(event.target),
                handled = true,
                isRTL = inst.dpDiv.is(".ui-datepicker-rtl");

            inst._keyEvent = true;
            if ($.datepicker._datepickerShowing) {
                switch (event.keyCode) {
                    case 9:
                        $.datepicker._hideDatepicker();
                        handled = false;
                        break; // hide on tab out
                    case 13:
                        sel = $("td." + $.datepicker._dayOverClass + ":not(." +
                            $.datepicker._currentClass + ")", inst.dpDiv);
                        if (sel[0]) {
                            $.datepicker._selectDay(event.target, inst.selectedMonth, inst.selectedYear, sel[0]);
                        }

                        onSelect = $.datepicker._get(inst, "onSelect");
                        if (onSelect) {
                            dateStr = $.datepicker._formatDate(inst);

                            // Trigger custom callback
                            onSelect.apply((inst.input ? inst.input[0] : null), [dateStr, inst]);
                        } else {
                            $.datepicker._hideDatepicker();
                        }

                        return false; // don't submit the form
                    case 27:
                        $.datepicker._hideDatepicker();
                        break; // hide on escape
                    case 33:
                        $.datepicker._adjustDate(event.target, (event.ctrlKey ?
                            -$.datepicker._get(inst, "stepBigMonths") :
                            -$.datepicker._get(inst, "stepMonths")), "M");
                        break; // previous month/year on page up/+ ctrl
                    case 34:
                        $.datepicker._adjustDate(event.target, (event.ctrlKey ?
                            +$.datepicker._get(inst, "stepBigMonths") :
                            +$.datepicker._get(inst, "stepMonths")), "M");
                        break; // next month/year on page down/+ ctrl
                    case 35:
                        if (event.ctrlKey || event.metaKey) {
                            $.datepicker._clearDate(event.target);
                        }
                        handled = event.ctrlKey || event.metaKey;
                        break; // clear on ctrl or command +end
                    case 36:
                        if (event.ctrlKey || event.metaKey) {
                            $.datepicker._gotoToday(event.target);
                        }
                        handled = event.ctrlKey || event.metaKey;
                        break; // current on ctrl or command +home
                    case 37:
                        if (event.ctrlKey || event.metaKey) {
                            $.datepicker._adjustDate(event.target, (isRTL ? +1 : -1), "D");
                        }
                        handled = event.ctrlKey || event.metaKey;

                        // -1 day on ctrl or command +left
                        if (event.originalEvent.altKey) {
                            $.datepicker._adjustDate(event.target, (event.ctrlKey ?
                                -$.datepicker._get(inst, "stepBigMonths") :
                                -$.datepicker._get(inst, "stepMonths")), "M");
                        }

                        // next month/year on alt +left on Mac
                        break;
                    case 38:
                        if (event.ctrlKey || event.metaKey) {
                            $.datepicker._adjustDate(event.target, -7, "D");
                        }
                        handled = event.ctrlKey || event.metaKey;
                        break; // -1 week on ctrl or command +up
                    case 39:
                        if (event.ctrlKey || event.metaKey) {
                            $.datepicker._adjustDate(event.target, (isRTL ? -1 : +1), "D");
                        }
                        handled = event.ctrlKey || event.metaKey;

                        // +1 day on ctrl or command +right
                        if (event.originalEvent.altKey) {
                            $.datepicker._adjustDate(event.target, (event.ctrlKey ?
                                +$.datepicker._get(inst, "stepBigMonths") :
                                +$.datepicker._get(inst, "stepMonths")), "M");
                        }

                        // next month/year on alt +right
                        break;
                    case 40:
                        if (event.ctrlKey || event.metaKey) {
                            $.datepicker._adjustDate(event.target, +7, "D");
                        }
                        handled = event.ctrlKey || event.metaKey;
                        break; // +1 week on ctrl or command +down
                    default:
                        handled = false;
                }
            } else if (event.keyCode === 36 && event.ctrlKey) { // display the date picker on ctrl+home
                $.datepicker._showDatepicker(this);
            } else {
                handled = false;
            }

            if (handled) {
                event.preventDefault();
                event.stopPropagation();
            }
        },

        /* Filter entered characters - based on date format. */
        _doKeyPress: function (event) {
            var chars, chr,
                inst = $.datepicker._getInst(event.target);

            if ($.datepicker._get(inst, "constrainInput")) {
                chars = $.datepicker._possibleChars($.datepicker._get(inst, "dateFormat"));
                chr = String.fromCharCode(event.charCode == null ? event.keyCode : event.charCode);
                return event.ctrlKey || event.metaKey || (chr < " " || !chars || chars.indexOf(chr) > -1);
            }
        },

        /* Synchronise manual entry and field/alternate field. */
        _doKeyUp: function (event) {
            var date,
                inst = $.datepicker._getInst(event.target);

            if (inst.input.val() !== inst.lastVal) {
                try {
                    date = $.datepicker.parseDate($.datepicker._get(inst, "dateFormat"),
                        (inst.input ? inst.input.val() : null),
                        $.datepicker._getFormatConfig(inst));

                    if (date) { // only if valid
                        $.datepicker._setDateFromField(inst);
                        $.datepicker._updateAlternate(inst);
                        $.datepicker._updateDatepicker(inst);
                    }
                }
                catch (err) {
                }
            }
            return true;
        },

        /* Pop-up the date picker for a given input field.
	 * If false returned from beforeShow event handler do not show.
	 * @param  input  element - the input field attached to the date picker or
	 *					event - if triggered by focus
	 */
        _showDatepicker: function (input) {
            input = input.target || input;
            if (input.nodeName.toLowerCase() !== "input") { // find from button/image trigger
                input = $("input", input.parentNode)[0];
            }

            if ($.datepicker._isDisabledDatepicker(input) || $.datepicker._lastInput === input) { // already here
                return;
            }

            var inst, beforeShow, beforeShowSettings, isFixed,
                offset, showAnim, duration;

            inst = $.datepicker._getInst(input);
            if ($.datepicker._curInst && $.datepicker._curInst !== inst) {
                $.datepicker._curInst.dpDiv.stop(true, true);
                if (inst && $.datepicker._datepickerShowing) {
                    $.datepicker._hideDatepicker($.datepicker._curInst.input[0]);
                }
            }

            beforeShow = $.datepicker._get(inst, "beforeShow");
            beforeShowSettings = beforeShow ? beforeShow.apply(input, [input, inst]) : {};
            if (beforeShowSettings === false) {
                return;
            }
            datepicker_extendRemove(inst.settings, beforeShowSettings);

            inst.lastVal = null;
            $.datepicker._lastInput = input;
            $.datepicker._setDateFromField(inst);

            if ($.datepicker._inDialog) { // hide cursor
                input.value = "";
            }
            if (!$.datepicker._pos) { // position below input
                $.datepicker._pos = $.datepicker._findPos(input);
                $.datepicker._pos[1] += input.offsetHeight; // add the height
            }

            isFixed = false;
            $(input).parents().each(function () {
                isFixed |= $(this).css("position") === "fixed";
                return !isFixed;
            });

            offset = {left: $.datepicker._pos[0], top: $.datepicker._pos[1]};
            $.datepicker._pos = null;

            //to avoid flashes on Firefox
            inst.dpDiv.empty();

            // determine sizing offscreen
            inst.dpDiv.css({position: "absolute", display: "block", top: "-1000px"});
            $.datepicker._updateDatepicker(inst);

            // fix width for dynamic number of date pickers
            // and adjust position before showing
            offset = $.datepicker._checkOffset(inst, offset, isFixed);
            inst.dpDiv.css({
                position: ($.datepicker._inDialog && $.blockUI ?
                    "static" : (isFixed ? "fixed" : "absolute")), display: "none",
                left: offset.left + "px", top: offset.top + "px"
            });

            if (!inst.inline) {
                showAnim = $.datepicker._get(inst, "showAnim");
                duration = $.datepicker._get(inst, "duration");
                inst.dpDiv.css("z-index", datepicker_getZindex($(input)) + 1);
                $.datepicker._datepickerShowing = true;

                if ($.effects && $.effects.effect[showAnim]) {
                    inst.dpDiv.show(showAnim, $.datepicker._get(inst, "showOptions"), duration);
                } else {
                    inst.dpDiv[showAnim || "show"](showAnim ? duration : null);
                }

                if ($.datepicker._shouldFocusInput(inst)) {
                    inst.input.trigger("focus");
                }

                $.datepicker._curInst = inst;
            }
        },

        /* Generate the date picker content. */
        _updateDatepicker: function (inst) {
            this.maxRows = 4; //Reset the max number of rows being displayed (see #7043)
            datepicker_instActive = inst; // for delegate hover events
            inst.dpDiv.empty().append(this._generateHTML(inst));
            this._attachHandlers(inst);

            var origyearshtml,
                numMonths = this._getNumberOfMonths(inst),
                cols = numMonths[1],
                width = 17,
                activeCell = inst.dpDiv.find("." + this._dayOverClass + " a");

            if (activeCell.length > 0) {
                datepicker_handleMouseover.apply(activeCell.get(0));
            }

            inst.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width("");
            if (cols > 1) {
                inst.dpDiv.addClass("ui-datepicker-multi-" + cols).css("width", (width * cols) + "em");
            }
            inst.dpDiv[(numMonths[0] !== 1 || numMonths[1] !== 1 ? "add" : "remove") +
            "Class"]("ui-datepicker-multi");
            inst.dpDiv[(this._get(inst, "isRTL") ? "add" : "remove") +
            "Class"]("ui-datepicker-rtl");

            if (inst === $.datepicker._curInst && $.datepicker._datepickerShowing && $.datepicker._shouldFocusInput(inst)) {
                inst.input.trigger("focus");
            }

            // Deffered render of the years select (to avoid flashes on Firefox)
            if (inst.yearshtml) {
                origyearshtml = inst.yearshtml;
                setTimeout(function () {

                    //assure that inst.yearshtml didn't change.
                    if (origyearshtml === inst.yearshtml && inst.yearshtml) {
                        inst.dpDiv.find("select.ui-datepicker-year:first").replaceWith(inst.yearshtml);
                    }
                    origyearshtml = inst.yearshtml = null;
                }, 0);
            }
        },

        // #6694 - don't focus the input if it's already focused
        // this breaks the change event in IE
        // Support: IE and jQuery <1.9
        _shouldFocusInput: function (inst) {
            return inst.input && inst.input.is(":visible") && !inst.input.is(":disabled") && !inst.input.is(":focus");
        },

        /* Check positioning to remain on screen. */
        _checkOffset: function (inst, offset, isFixed) {
            var dpWidth = inst.dpDiv.outerWidth(),
                dpHeight = inst.dpDiv.outerHeight(),
                inputWidth = inst.input ? inst.input.outerWidth() : 0,
                inputHeight = inst.input ? inst.input.outerHeight() : 0,
                viewWidth = document.documentElement.clientWidth + (isFixed ? 0 : $(document).scrollLeft()),
                viewHeight = document.documentElement.clientHeight + (isFixed ? 0 : $(document).scrollTop());

            offset.left -= (this._get(inst, "isRTL") ? (dpWidth - inputWidth) : 0);
            offset.left -= (isFixed && offset.left === inst.input.offset().left) ? $(document).scrollLeft() : 0;
            offset.top -= (isFixed && offset.top === (inst.input.offset().top + inputHeight)) ? $(document).scrollTop() : 0;

            // Now check if datepicker is showing outside window viewport - move to a better place if so.
            offset.left -= Math.min(offset.left, (offset.left + dpWidth > viewWidth && viewWidth > dpWidth) ?
                Math.abs(offset.left + dpWidth - viewWidth) : 0);
            offset.top -= Math.min(offset.top, (offset.top + dpHeight > viewHeight && viewHeight > dpHeight) ?
                Math.abs(dpHeight + inputHeight) : 0);

            return offset;
        },

        /* Find an object's position on the screen. */
        _findPos: function (obj) {
            var position,
                inst = this._getInst(obj),
                isRTL = this._get(inst, "isRTL");

            while (obj && (obj.type === "hidden" || obj.nodeType !== 1 || $.expr.filters.hidden(obj))) {
                obj = obj[isRTL ? "previousSibling" : "nextSibling"];
            }

            position = $(obj).offset();
            return [position.left, position.top];
        },

        /* Hide the date picker from view.
	 * @param  input  element - the input field attached to the date picker
	 */
        _hideDatepicker: function (input) {
            var showAnim, duration, postProcess, onClose,
                inst = this._curInst;

            if (!inst || (input && inst !== $.data(input, "datepicker"))) {
                return;
            }

            if (this._datepickerShowing) {
                showAnim = this._get(inst, "showAnim");
                duration = this._get(inst, "duration");
                postProcess = function () {
                    $.datepicker._tidyDialog(inst);
                };

                // DEPRECATED: after BC for 1.8.x $.effects[ showAnim ] is not needed
                if ($.effects && ($.effects.effect[showAnim] || $.effects[showAnim])) {
                    inst.dpDiv.hide(showAnim, $.datepicker._get(inst, "showOptions"), duration, postProcess);
                } else {
                    inst.dpDiv[(showAnim === "slideDown" ? "slideUp" :
                        (showAnim === "fadeIn" ? "fadeOut" : "hide"))]((showAnim ? duration : null), postProcess);
                }

                if (!showAnim) {
                    postProcess();
                }
                this._datepickerShowing = false;

                onClose = this._get(inst, "onClose");
                if (onClose) {
                    onClose.apply((inst.input ? inst.input[0] : null), [(inst.input ? inst.input.val() : ""), inst]);
                }

                this._lastInput = null;
                if (this._inDialog) {
                    this._dialogInput.css({position: "absolute", left: "0", top: "-100px"});
                    if ($.blockUI) {
                        $.unblockUI();
                        $("body").append(this.dpDiv);
                    }
                }
                this._inDialog = false;
            }
        },

        /* Tidy up after a dialog display. */
        _tidyDialog: function (inst) {
            inst.dpDiv.removeClass(this._dialogClass).off(".ui-datepicker-calendar");
        },

        /* Close date picker if clicked elsewhere. */
        _checkExternalClick: function (event) {
            if (!$.datepicker._curInst) {
                return;
            }

            var $target = $(event.target),
                inst = $.datepicker._getInst($target[0]);

            if ((($target[0].id !== $.datepicker._mainDivId &&
                $target.parents("#" + $.datepicker._mainDivId).length === 0 &&
                !$target.hasClass($.datepicker.markerClassName) &&
                !$target.closest("." + $.datepicker._triggerClass).length &&
                $.datepicker._datepickerShowing && !($.datepicker._inDialog && $.blockUI))) ||
                ($target.hasClass($.datepicker.markerClassName) && $.datepicker._curInst !== inst)) {
                $.datepicker._hideDatepicker();
            }
        },

        /* Adjust one of the date sub-fields. */
        _adjustDate: function (id, offset, period) {
            var target = $(id),
                inst = this._getInst(target[0]);

            if (this._isDisabledDatepicker(target[0])) {
                return;
            }
            this._adjustInstDate(inst, offset +
                (period === "M" ? this._get(inst, "showCurrentAtPos") : 0), // undo positioning
                period);
            this._updateDatepicker(inst);
        },

        /* Action for current link. */
        _gotoToday: function (id) {
            var date,
                target = $(id),
                inst = this._getInst(target[0]);

            if (this._get(inst, "gotoCurrent") && inst.currentDay) {
                inst.selectedDay = inst.currentDay;
                inst.drawMonth = inst.selectedMonth = inst.currentMonth;
                inst.drawYear = inst.selectedYear = inst.currentYear;
            } else {
                date = new Date();
                inst.selectedDay = date.getDate();
                inst.drawMonth = inst.selectedMonth = date.getMonth();
                inst.drawYear = inst.selectedYear = date.getFullYear();
            }
            this._notifyChange(inst);
            this._adjustDate(target);
        },

        /* Action for selecting a new month/year. */
        _selectMonthYear: function (id, select, period) {
            var target = $(id),
                inst = this._getInst(target[0]);

            inst["selected" + (period === "M" ? "Month" : "Year")] =
                inst["draw" + (period === "M" ? "Month" : "Year")] =
                    parseInt(select.options[select.selectedIndex].value, 10);

            this._notifyChange(inst);
            this._adjustDate(target);
        },

        /* Action for selecting a day. */
        _selectDay: function (id, month, year, td) {
            var inst,
                target = $(id);

            if ($(td).hasClass(this._unselectableClass) || this._isDisabledDatepicker(target[0])) {
                return;
            }

            inst = this._getInst(target[0]);
            inst.selectedDay = inst.currentDay = $("a", td).html();
            inst.selectedMonth = inst.currentMonth = month;
            inst.selectedYear = inst.currentYear = year;
            this._selectDate(id, this._formatDate(inst,
                inst.currentDay, inst.currentMonth, inst.currentYear));
        },

        /* Erase the input field and hide the date picker. */
        _clearDate: function (id) {
            var target = $(id);
            this._selectDate(target, "");
        },

        /* Update the input field with the selected date. */
        _selectDate: function (id, dateStr) {
            var onSelect,
                target = $(id),
                inst = this._getInst(target[0]);

            dateStr = (dateStr != null ? dateStr : this._formatDate(inst));
            if (inst.input) {
                inst.input.val(dateStr);
            }
            this._updateAlternate(inst);

            onSelect = this._get(inst, "onSelect");
            if (onSelect) {
                onSelect.apply((inst.input ? inst.input[0] : null), [dateStr, inst]);  // trigger custom callback
            } else if (inst.input) {
                inst.input.trigger("change"); // fire the change event
            }

            if (inst.inline) {
                this._updateDatepicker(inst);
            } else {
                this._hideDatepicker();
                this._lastInput = inst.input[0];
                if (typeof(inst.input[0]) !== "object") {
                    inst.input.trigger("focus"); // restore focus
                }
                this._lastInput = null;
            }
        },

        /* Update any alternate field to synchronise with the main field. */
        _updateAlternate: function (inst) {
            var altFormat, date, dateStr,
                altField = this._get(inst, "altField");

            if (altField) { // update alternate field too
                altFormat = this._get(inst, "altFormat") || this._get(inst, "dateFormat");
                date = this._getDate(inst);
                dateStr = this.formatDate(altFormat, date, this._getFormatConfig(inst));
                $(altField).val(dateStr);
            }
        },

        /* Set as beforeShowDay function to prevent selection of weekends.
	 * @param  date  Date - the date to customise
	 * @return [boolean, string] - is this date selectable?, what is its CSS class?
	 */
        noWeekends: function (date) {
            var day = date.getDay();
            return [(day > 0 && day < 6), ""];
        },

        /* Set as calculateWeek to determine the week of the year based on the ISO 8601 definition.
	 * @param  date  Date - the date to get the week for
	 * @return  number - the number of the week within the year that contains this date
	 */
        iso8601Week: function (date) {
            var time,
                checkDate = new Date(date.getTime());

            // Find Thursday of this week starting on Monday
            checkDate.setDate(checkDate.getDate() + 4 - (checkDate.getDay() || 7));

            time = checkDate.getTime();
            checkDate.setMonth(0); // Compare with Jan 1
            checkDate.setDate(1);
            return Math.floor(Math.round((time - checkDate) / 86400000) / 7) + 1;
        },

        /* Parse a string value into a date object.
	 * See formatDate below for the possible formats.
	 *
	 * @param  format string - the expected format of the date
	 * @param  value string - the date in the above format
	 * @param  settings Object - attributes include:
	 *					shortYearCutoff  number - the cutoff year for determining the century (optional)
	 *					dayNamesShort	string[7] - abbreviated names of the days from Sunday (optional)
	 *					dayNames		string[7] - names of the days from Sunday (optional)
	 *					monthNamesShort string[12] - abbreviated names of the months (optional)
	 *					monthNames		string[12] - names of the months (optional)
	 * @return  Date - the extracted date value or null if value is blank
	 */
        parseDate: function (format, value, settings) {
            if (format == null || value == null) {
                throw "Invalid arguments";
            }

            value = (typeof value === "object" ? value.toString() : value + "");
            if (value === "") {
                return null;
            }

            var iFormat, dim, extra,
                iValue = 0,
                shortYearCutoffTemp = (settings ? settings.shortYearCutoff : null) || this._defaults.shortYearCutoff,
                shortYearCutoff = (typeof shortYearCutoffTemp !== "string" ? shortYearCutoffTemp :
                    new Date().getFullYear() % 100 + parseInt(shortYearCutoffTemp, 10)),
                dayNamesShort = (settings ? settings.dayNamesShort : null) || this._defaults.dayNamesShort,
                dayNames = (settings ? settings.dayNames : null) || this._defaults.dayNames,
                monthNamesShort = (settings ? settings.monthNamesShort : null) || this._defaults.monthNamesShort,
                monthNames = (settings ? settings.monthNames : null) || this._defaults.monthNames,
                year = -1,
                month = -1,
                day = -1,
                doy = -1,
                literal = false,
                date,

                // Check whether a format character is doubled
                lookAhead = function (match) {
                    var matches = (iFormat + 1 < format.length && format.charAt(iFormat + 1) === match);
                    if (matches) {
                        iFormat++;
                    }
                    return matches;
                },

                // Extract a number from the string value
                getNumber = function (match) {
                    var isDoubled = lookAhead(match),
                        size = (match === "@" ? 14 : (match === "!" ? 20 :
                            (match === "y" && isDoubled ? 4 : (match === "o" ? 3 : 2)))),
                        minSize = (match === "y" ? size : 1),
                        digits = new RegExp("^\\d{" + minSize + "," + size + "}"),
                        num = value.substring(iValue).match(digits);
                    if (!num) {
                        throw "Missing number at position " + iValue;
                    }
                    iValue += num[0].length;
                    return parseInt(num[0], 10);
                },

                // Extract a name from the string value and convert to an index
                getName = function (match, shortNames, longNames) {
                    var index = -1,
                        names = $.map(lookAhead(match) ? longNames : shortNames, function (v, k) {
                            return [[k, v]];
                        }).sort(function (a, b) {
                            return -(a[1].length - b[1].length);
                        });

                    $.each(names, function (i, pair) {
                        var name = pair[1];
                        if (value.substr(iValue, name.length).toLowerCase() === name.toLowerCase()) {
                            index = pair[0];
                            iValue += name.length;
                            return false;
                        }
                    });
                    if (index !== -1) {
                        return index + 1;
                    } else {
                        throw "Unknown name at position " + iValue;
                    }
                },

                // Confirm that a literal character matches the string value
                checkLiteral = function () {
                    if (value.charAt(iValue) !== format.charAt(iFormat)) {
                        throw "Unexpected literal at position " + iValue;
                    }
                    iValue++;
                };

            for (iFormat = 0; iFormat < format.length; iFormat++) {
                if (literal) {
                    if (format.charAt(iFormat) === "'" && !lookAhead("'")) {
                        literal = false;
                    } else {
                        checkLiteral();
                    }
                } else {
                    switch (format.charAt(iFormat)) {
                        case "d":
                            day = getNumber("d");
                            break;
                        case "D":
                            getName("D", dayNamesShort, dayNames);
                            break;
                        case "o":
                            doy = getNumber("o");
                            break;
                        case "m":
                            month = getNumber("m");
                            break;
                        case "M":
                            month = getName("M", monthNamesShort, monthNames);
                            break;
                        case "y":
                            year = getNumber("y");
                            break;
                        case "@":
                            date = new Date(getNumber("@"));
                            year = date.getFullYear();
                            month = date.getMonth() + 1;
                            day = date.getDate();
                            break;
                        case "!":
                            date = new Date((getNumber("!") - this._ticksTo1970) / 10000);
                            year = date.getFullYear();
                            month = date.getMonth() + 1;
                            day = date.getDate();
                            break;
                        case "'":
                            if (lookAhead("'")) {
                                checkLiteral();
                            } else {
                                literal = true;
                            }
                            break;
                        default:
                            checkLiteral();
                    }
                }
            }

            if (iValue < value.length) {
                extra = value.substr(iValue);
                if (!/^\s+/.test(extra)) {
                    throw "Extra/unparsed characters found in date: " + extra;
                }
            }

            if (year === -1) {
                year = new Date().getFullYear();
            } else if (year < 100) {
                year += new Date().getFullYear() - new Date().getFullYear() % 100 +
                    (year <= shortYearCutoff ? 0 : -100);
            }

            if (doy > -1) {
                month = 1;
                day = doy;
                do {
                    dim = this._getDaysInMonth(year, month - 1);
                    if (day <= dim) {
                        break;
                    }
                    month++;
                    day -= dim;
                } while (true);
            }

            date = this._daylightSavingAdjust(new Date(year, month - 1, day));
            if (date.getFullYear() !== year || date.getMonth() + 1 !== month || date.getDate() !== day) {
                throw "Invalid date"; // E.g. 31/02/00
            }
            return date;
        },

        /* Standard date formats. */
        ATOM: "yy-mm-dd", // RFC 3339 (ISO 8601)
        COOKIE: "D, dd M yy",
        ISO_8601: "yy-mm-dd",
        RFC_822: "D, d M y",
        RFC_850: "DD, dd-M-y",
        RFC_1036: "D, d M y",
        RFC_1123: "D, d M yy",
        RFC_2822: "D, d M yy",
        RSS: "D, d M y", // RFC 822
        TICKS: "!",
        TIMESTAMP: "@",
        W3C: "yy-mm-dd", // ISO 8601

        _ticksTo1970: (((1970 - 1) * 365 + Math.floor(1970 / 4) - Math.floor(1970 / 100) +
            Math.floor(1970 / 400)) * 24 * 60 * 60 * 10000000),

        /* Format a date object into a string value.
	 * The format can be combinations of the following:
	 * d  - day of month (no leading zero)
	 * dd - day of month (two digit)
	 * o  - day of year (no leading zeros)
	 * oo - day of year (three digit)
	 * D  - day name short
	 * DD - day name long
	 * m  - month of year (no leading zero)
	 * mm - month of year (two digit)
	 * M  - month name short
	 * MM - month name long
	 * y  - year (two digit)
	 * yy - year (four digit)
	 * @ - Unix timestamp (ms since 01/01/1970)
	 * ! - Windows ticks (100ns since 01/01/0001)
	 * "..." - literal text
	 * '' - single quote
	 *
	 * @param  format string - the desired format of the date
	 * @param  date Date - the date value to format
	 * @param  settings Object - attributes include:
	 *					dayNamesShort	string[7] - abbreviated names of the days from Sunday (optional)
	 *					dayNames		string[7] - names of the days from Sunday (optional)
	 *					monthNamesShort string[12] - abbreviated names of the months (optional)
	 *					monthNames		string[12] - names of the months (optional)
	 * @return  string - the date in the above format
	 */
        formatDate: function (format, date, settings) {
            if (!date) {
                return "";
            }

            var iFormat,
                dayNamesShort = (settings ? settings.dayNamesShort : null) || this._defaults.dayNamesShort,
                dayNames = (settings ? settings.dayNames : null) || this._defaults.dayNames,
                monthNamesShort = (settings ? settings.monthNamesShort : null) || this._defaults.monthNamesShort,
                monthNames = (settings ? settings.monthNames : null) || this._defaults.monthNames,

                // Check whether a format character is doubled
                lookAhead = function (match) {
                    var matches = (iFormat + 1 < format.length && format.charAt(iFormat + 1) === match);
                    if (matches) {
                        iFormat++;
                    }
                    return matches;
                },

                // Format a number, with leading zero if necessary
                formatNumber = function (match, value, len) {
                    var num = "" + value;
                    if (lookAhead(match)) {
                        while (num.length < len) {
                            num = "0" + num;
                        }
                    }
                    return num;
                },

                // Format a name, short or long as requested
                formatName = function (match, value, shortNames, longNames) {
                    return (lookAhead(match) ? longNames[value] : shortNames[value]);
                },
                output = "",
                literal = false;

            if (date) {
                for (iFormat = 0; iFormat < format.length; iFormat++) {
                    if (literal) {
                        if (format.charAt(iFormat) === "'" && !lookAhead("'")) {
                            literal = false;
                        } else {
                            output += format.charAt(iFormat);
                        }
                    } else {
                        switch (format.charAt(iFormat)) {
                            case "d":
                                output += formatNumber("d", date.getDate(), 2);
                                break;
                            case "D":
                                output += formatName("D", date.getDay(), dayNamesShort, dayNames);
                                break;
                            case "o":
                                output += formatNumber("o",
                                    Math.round((new Date(date.getFullYear(), date.getMonth(), date.getDate()).getTime() - new Date(date.getFullYear(), 0, 0).getTime()) / 86400000), 3);
                                break;
                            case "m":
                                output += formatNumber("m", date.getMonth() + 1, 2);
                                break;
                            case "M":
                                output += formatName("M", date.getMonth(), monthNamesShort, monthNames);
                                break;
                            case "y":
                                output += (lookAhead("y") ? date.getFullYear() :
                                    (date.getFullYear() % 100 < 10 ? "0" : "") + date.getFullYear() % 100);
                                break;
                            case "@":
                                output += date.getTime();
                                break;
                            case "!":
                                output += date.getTime() * 10000 + this._ticksTo1970;
                                break;
                            case "'":
                                if (lookAhead("'")) {
                                    output += "'";
                                } else {
                                    literal = true;
                                }
                                break;
                            default:
                                output += format.charAt(iFormat);
                        }
                    }
                }
            }
            return output;
        },

        /* Extract all possible characters from the date format. */
        _possibleChars: function (format) {
            var iFormat,
                chars = "",
                literal = false,

                // Check whether a format character is doubled
                lookAhead = function (match) {
                    var matches = (iFormat + 1 < format.length && format.charAt(iFormat + 1) === match);
                    if (matches) {
                        iFormat++;
                    }
                    return matches;
                };

            for (iFormat = 0; iFormat < format.length; iFormat++) {
                if (literal) {
                    if (format.charAt(iFormat) === "'" && !lookAhead("'")) {
                        literal = false;
                    } else {
                        chars += format.charAt(iFormat);
                    }
                } else {
                    switch (format.charAt(iFormat)) {
                        case "d":
                        case "m":
                        case "y":
                        case "@":
                            chars += "0123456789";
                            break;
                        case "D":
                        case "M":
                            return null; // Accept anything
                        case "'":
                            if (lookAhead("'")) {
                                chars += "'";
                            } else {
                                literal = true;
                            }
                            break;
                        default:
                            chars += format.charAt(iFormat);
                    }
                }
            }
            return chars;
        },

        /* Get a setting value, defaulting if necessary. */
        _get: function (inst, name) {
            return inst.settings[name] !== undefined ?
                inst.settings[name] : this._defaults[name];
        },

        /* Parse existing date and initialise date picker. */
        _setDateFromField: function (inst, noDefault) {
            if (inst.input.val() === inst.lastVal) {
                return;
            }

            var dateFormat = this._get(inst, "dateFormat"),
                dates = inst.lastVal = inst.input ? inst.input.val() : null,
                defaultDate = this._getDefaultDate(inst),
                date = defaultDate,
                settings = this._getFormatConfig(inst);

            try {
                date = this.parseDate(dateFormat, dates, settings) || defaultDate;
            } catch (event) {
                dates = (noDefault ? "" : dates);
            }
            inst.selectedDay = date.getDate();
            inst.drawMonth = inst.selectedMonth = date.getMonth();
            inst.drawYear = inst.selectedYear = date.getFullYear();
            inst.currentDay = (dates ? date.getDate() : 0);
            inst.currentMonth = (dates ? date.getMonth() : 0);
            inst.currentYear = (dates ? date.getFullYear() : 0);
            this._adjustInstDate(inst);
        },

        /* Retrieve the default date shown on opening. */
        _getDefaultDate: function (inst) {
            return this._restrictMinMax(inst,
                this._determineDate(inst, this._get(inst, "defaultDate"), new Date()));
        },

        /* A date may be specified as an exact value or a relative one. */
        _determineDate: function (inst, date, defaultDate) {
            var offsetNumeric = function (offset) {
                    var date = new Date();
                    date.setDate(date.getDate() + offset);
                    return date;
                },
                offsetString = function (offset) {
                    try {
                        return $.datepicker.parseDate($.datepicker._get(inst, "dateFormat"),
                            offset, $.datepicker._getFormatConfig(inst));
                    }
                    catch (e) {

                        // Ignore
                    }

                    var date = (offset.toLowerCase().match(/^c/) ?
                        $.datepicker._getDate(inst) : null) || new Date(),
                        year = date.getFullYear(),
                        month = date.getMonth(),
                        day = date.getDate(),
                        pattern = /([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,
                        matches = pattern.exec(offset);

                    while (matches) {
                        switch (matches[2] || "d") {
                            case "d" :
                            case "D" :
                                day += parseInt(matches[1], 10);
                                break;
                            case "w" :
                            case "W" :
                                day += parseInt(matches[1], 10) * 7;
                                break;
                            case "m" :
                            case "M" :
                                month += parseInt(matches[1], 10);
                                day = Math.min(day, $.datepicker._getDaysInMonth(year, month));
                                break;
                            case "y":
                            case "Y" :
                                year += parseInt(matches[1], 10);
                                day = Math.min(day, $.datepicker._getDaysInMonth(year, month));
                                break;
                        }
                        matches = pattern.exec(offset);
                    }
                    return new Date(year, month, day);
                },
                newDate = (date == null || date === "" ? defaultDate : (typeof date === "string" ? offsetString(date) :
                    (typeof date === "number" ? (isNaN(date) ? defaultDate : offsetNumeric(date)) : new Date(date.getTime()))));

            newDate = (newDate && newDate.toString() === "Invalid Date" ? defaultDate : newDate);
            if (newDate) {
                newDate.setHours(0);
                newDate.setMinutes(0);
                newDate.setSeconds(0);
                newDate.setMilliseconds(0);
            }
            return this._daylightSavingAdjust(newDate);
        },

        /* Handle switch to/from daylight saving.
	 * Hours may be non-zero on daylight saving cut-over:
	 * > 12 when midnight changeover, but then cannot generate
	 * midnight datetime, so jump to 1AM, otherwise reset.
	 * @param  date  (Date) the date to check
	 * @return  (Date) the corrected date
	 */
        _daylightSavingAdjust: function (date) {
            if (!date) {
                return null;
            }
            date.setHours(date.getHours() > 12 ? date.getHours() + 2 : 0);
            return date;
        },

        /* Set the date(s) directly. */
        _setDate: function (inst, date, noChange) {
            var clear = !date,
                origMonth = inst.selectedMonth,
                origYear = inst.selectedYear,
                newDate = this._restrictMinMax(inst, this._determineDate(inst, date, new Date()));

            inst.selectedDay = inst.currentDay = newDate.getDate();
            inst.drawMonth = inst.selectedMonth = inst.currentMonth = newDate.getMonth();
            inst.drawYear = inst.selectedYear = inst.currentYear = newDate.getFullYear();
            if ((origMonth !== inst.selectedMonth || origYear !== inst.selectedYear) && !noChange) {
                this._notifyChange(inst);
            }
            this._adjustInstDate(inst);
            if (inst.input) {
                inst.input.val(clear ? "" : this._formatDate(inst));
            }
        },

        /* Retrieve the date(s) directly. */
        _getDate: function (inst) {
            var startDate = (!inst.currentYear || (inst.input && inst.input.val() === "") ? null :
                this._daylightSavingAdjust(new Date(
                    inst.currentYear, inst.currentMonth, inst.currentDay)));
            return startDate;
        },

        /* Attach the onxxx handlers.  These are declared statically so
	 * they work with static code transformers like Caja.
	 */
        _attachHandlers: function (inst) {
            var stepMonths = this._get(inst, "stepMonths"),
                id = "#" + inst.id.replace(/\\\\/g, "\\");
            inst.dpDiv.find("[data-handler]").map(function () {
                var handler = {
                    prev: function () {
                        $.datepicker._adjustDate(id, -stepMonths, "M");
                    },
                    next: function () {
                        $.datepicker._adjustDate(id, +stepMonths, "M");
                    },
                    hide: function () {
                        $.datepicker._hideDatepicker();
                    },
                    today: function () {
                        $.datepicker._gotoToday(id);
                    },
                    selectDay: function () {
                        $.datepicker._selectDay(id, +this.getAttribute("data-month"), +this.getAttribute("data-year"), this);
                        return false;
                    },
                    selectMonth: function () {
                        $.datepicker._selectMonthYear(id, this, "M");
                        return false;
                    },
                    selectYear: function () {
                        $.datepicker._selectMonthYear(id, this, "Y");
                        return false;
                    }
                };
                $(this).on(this.getAttribute("data-event"), handler[this.getAttribute("data-handler")]);
            });
        },

        /* Generate the HTML for the current state of the date picker. */
        _generateHTML: function (inst) {
            var maxDraw, prevText, prev, nextText, next, currentText, gotoDate,
                controls, buttonPanel, firstDay, showWeek, dayNames, dayNamesMin,
                monthNames, monthNamesShort, beforeShowDay, showOtherMonths,
                selectOtherMonths, defaultDate, html, dow, row, group, col, selectedDate,
                cornerClass, calender, thead, day, daysInMonth, leadDays, curRows, numRows,
                printDate, dRow, tbody, daySettings, otherMonth, unselectable,
                tempDate = new Date(),
                today = this._daylightSavingAdjust(
                    new Date(tempDate.getFullYear(), tempDate.getMonth(), tempDate.getDate())), // clear time
                isRTL = this._get(inst, "isRTL"),
                showButtonPanel = this._get(inst, "showButtonPanel"),
                hideIfNoPrevNext = this._get(inst, "hideIfNoPrevNext"),
                navigationAsDateFormat = this._get(inst, "navigationAsDateFormat"),
                numMonths = this._getNumberOfMonths(inst),
                showCurrentAtPos = this._get(inst, "showCurrentAtPos"),
                stepMonths = this._get(inst, "stepMonths"),
                isMultiMonth = (numMonths[0] !== 1 || numMonths[1] !== 1),
                currentDate = this._daylightSavingAdjust((!inst.currentDay ? new Date(9999, 9, 9) :
                    new Date(inst.currentYear, inst.currentMonth, inst.currentDay))),
                minDate = this._getMinMaxDate(inst, "min"),
                maxDate = this._getMinMaxDate(inst, "max"),
                drawMonth = inst.drawMonth - showCurrentAtPos,
                drawYear = inst.drawYear;

            if (drawMonth < 0) {
                drawMonth += 12;
                drawYear--;
            }
            if (maxDate) {
                maxDraw = this._daylightSavingAdjust(new Date(maxDate.getFullYear(),
                    maxDate.getMonth() - (numMonths[0] * numMonths[1]) + 1, maxDate.getDate()));
                maxDraw = (minDate && maxDraw < minDate ? minDate : maxDraw);
                while (this._daylightSavingAdjust(new Date(drawYear, drawMonth, 1)) > maxDraw) {
                    drawMonth--;
                    if (drawMonth < 0) {
                        drawMonth = 11;
                        drawYear--;
                    }
                }
            }
            inst.drawMonth = drawMonth;
            inst.drawYear = drawYear;

            prevText = this._get(inst, "prevText");
            prevText = (!navigationAsDateFormat ? prevText : this.formatDate(prevText,
                this._daylightSavingAdjust(new Date(drawYear, drawMonth - stepMonths, 1)),
                this._getFormatConfig(inst)));

            prev = (this._canAdjustMonth(inst, -1, drawYear, drawMonth) ?
                "<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click'" +
                " title='" + prevText + "'><span class='ui-icon ui-icon-circle-triangle-" + (isRTL ? "e" : "w") + "'>" + prevText + "</span></a>" :
                (hideIfNoPrevNext ? "" : "<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='" + prevText + "'><span class='ui-icon ui-icon-circle-triangle-" + (isRTL ? "e" : "w") + "'>" + prevText + "</span></a>"));

            nextText = this._get(inst, "nextText");
            nextText = (!navigationAsDateFormat ? nextText : this.formatDate(nextText,
                this._daylightSavingAdjust(new Date(drawYear, drawMonth + stepMonths, 1)),
                this._getFormatConfig(inst)));

            next = (this._canAdjustMonth(inst, +1, drawYear, drawMonth) ?
                "<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click'" +
                " title='" + nextText + "'><span class='ui-icon ui-icon-circle-triangle-" + (isRTL ? "w" : "e") + "'>" + nextText + "</span></a>" :
                (hideIfNoPrevNext ? "" : "<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='" + nextText + "'><span class='ui-icon ui-icon-circle-triangle-" + (isRTL ? "w" : "e") + "'>" + nextText + "</span></a>"));

            currentText = this._get(inst, "currentText");
            gotoDate = (this._get(inst, "gotoCurrent") && inst.currentDay ? currentDate : today);
            currentText = (!navigationAsDateFormat ? currentText :
                this.formatDate(currentText, gotoDate, this._getFormatConfig(inst)));

            controls = (!inst.inline ? "<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>" +
                this._get(inst, "closeText") + "</button>" : "");

            buttonPanel = (showButtonPanel) ? "<div class='ui-datepicker-buttonpane ui-widget-content'>" + (isRTL ? controls : "") +
                (this._isInRange(inst, gotoDate) ? "<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'" +
                    ">" + currentText + "</button>" : "") + (isRTL ? "" : controls) + "</div>" : "";

            firstDay = parseInt(this._get(inst, "firstDay"), 10);
            firstDay = (isNaN(firstDay) ? 0 : firstDay);

            showWeek = this._get(inst, "showWeek");
            dayNames = this._get(inst, "dayNames");
            dayNamesMin = this._get(inst, "dayNamesMin");
            monthNames = this._get(inst, "monthNames");
            monthNamesShort = this._get(inst, "monthNamesShort");
            beforeShowDay = this._get(inst, "beforeShowDay");
            showOtherMonths = this._get(inst, "showOtherMonths");
            selectOtherMonths = this._get(inst, "selectOtherMonths");
            defaultDate = this._getDefaultDate(inst);
            html = "";

            for (row = 0; row < numMonths[0]; row++) {
                group = "";
                this.maxRows = 4;
                for (col = 0; col < numMonths[1]; col++) {
                    selectedDate = this._daylightSavingAdjust(new Date(drawYear, drawMonth, inst.selectedDay));
                    cornerClass = " ui-corner-all";
                    calender = "";
                    if (isMultiMonth) {
                        calender += "<div class='ui-datepicker-group";
                        if (numMonths[1] > 1) {
                            switch (col) {
                                case 0:
                                    calender += " ui-datepicker-group-first";
                                    cornerClass = " ui-corner-" + (isRTL ? "right" : "left");
                                    break;
                                case numMonths[1] - 1:
                                    calender += " ui-datepicker-group-last";
                                    cornerClass = " ui-corner-" + (isRTL ? "left" : "right");
                                    break;
                                default:
                                    calender += " ui-datepicker-group-middle";
                                    cornerClass = "";
                                    break;
                            }
                        }
                        calender += "'>";
                    }
                    calender += "<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix" + cornerClass + "'>" +
                        (/all|left/.test(cornerClass) && row === 0 ? (isRTL ? next : prev) : "") +
                        (/all|right/.test(cornerClass) && row === 0 ? (isRTL ? prev : next) : "") +
                        this._generateMonthYearHeader(inst, drawMonth, drawYear, minDate, maxDate,
                            row > 0 || col > 0, monthNames, monthNamesShort) + // draw month headers
                        "</div><table class='ui-datepicker-calendar'><thead>" +
                        "<tr>";
                    thead = (showWeek ? "<th class='ui-datepicker-week-col'>" + this._get(inst, "weekHeader") + "</th>" : "");
                    for (dow = 0; dow < 7; dow++) { // days of the week
                        day = (dow + firstDay) % 7;
                        thead += "<th scope='col'" + ((dow + firstDay + 6) % 7 >= 5 ? " class='ui-datepicker-week-end'" : "") + ">" +
                            "<span title='" + dayNames[day] + "'>" + dayNamesMin[day] + "</span></th>";
                    }
                    calender += thead + "</tr></thead><tbody>";
                    daysInMonth = this._getDaysInMonth(drawYear, drawMonth);
                    if (drawYear === inst.selectedYear && drawMonth === inst.selectedMonth) {
                        inst.selectedDay = Math.min(inst.selectedDay, daysInMonth);
                    }
                    leadDays = (this._getFirstDayOfMonth(drawYear, drawMonth) - firstDay + 7) % 7;
                    curRows = Math.ceil((leadDays + daysInMonth) / 7); // calculate the number of rows to generate
                    numRows = (isMultiMonth ? this.maxRows > curRows ? this.maxRows : curRows : curRows); //If multiple months, use the higher number of rows (see #7043)
                    this.maxRows = numRows;
                    printDate = this._daylightSavingAdjust(new Date(drawYear, drawMonth, 1 - leadDays));
                    for (dRow = 0; dRow < numRows; dRow++) { // create date picker rows
                        calender += "<tr>";
                        tbody = (!showWeek ? "" : "<td class='ui-datepicker-week-col'>" +
                            this._get(inst, "calculateWeek")(printDate) + "</td>");
                        for (dow = 0; dow < 7; dow++) { // create date picker days
                            daySettings = (beforeShowDay ?
                                beforeShowDay.apply((inst.input ? inst.input[0] : null), [printDate]) : [true, ""]);
                            otherMonth = (printDate.getMonth() !== drawMonth);
                            unselectable = (otherMonth && !selectOtherMonths) || !daySettings[0] ||
                                (minDate && printDate < minDate) || (maxDate && printDate > maxDate);
                            tbody += "<td class='" +
                                ((dow + firstDay + 6) % 7 >= 5 ? " ui-datepicker-week-end" : "") + // highlight weekends
                                (otherMonth ? " ui-datepicker-other-month" : "") + // highlight days from other months
                                ((printDate.getTime() === selectedDate.getTime() && drawMonth === inst.selectedMonth && inst._keyEvent) || // user pressed key
                                (defaultDate.getTime() === printDate.getTime() && defaultDate.getTime() === selectedDate.getTime()) ?

                                    // or defaultDate is current printedDate and defaultDate is selectedDate
                                    " " + this._dayOverClass : "") + // highlight selected day
                                (unselectable ? " " + this._unselectableClass + " ui-state-disabled" : "") +  // highlight unselectable days
                                (otherMonth && !showOtherMonths ? "" : " " + daySettings[1] + // highlight custom dates
                                    (printDate.getTime() === currentDate.getTime() ? " " + this._currentClass : "") + // highlight selected day
                                    (printDate.getTime() === today.getTime() ? " ui-datepicker-today" : "")) + "'" + // highlight today (if different)
                                ((!otherMonth || showOtherMonths) && daySettings[2] ? " title='" + daySettings[2].replace(/'/g, "&#39;") + "'" : "") + // cell title
                                (unselectable ? "" : " data-handler='selectDay' data-event='click' data-month='" + printDate.getMonth() + "' data-year='" + printDate.getFullYear() + "'") + ">" + // actions
                                (otherMonth && !showOtherMonths ? "&#xa0;" : // display for other months
                                    (unselectable ? "<span class='ui-state-default'>" + printDate.getDate() + "</span>" : "<a class='ui-state-default" +
                                        (printDate.getTime() === today.getTime() ? " ui-state-highlight" : "") +
                                        (printDate.getTime() === currentDate.getTime() ? " ui-state-active" : "") + // highlight selected day
                                        (otherMonth ? " ui-priority-secondary" : "") + // distinguish dates from other months
                                        "' href='#'>" + printDate.getDate() + "</a>")) + "</td>"; // display selectable date
                            printDate.setDate(printDate.getDate() + 1);
                            printDate = this._daylightSavingAdjust(printDate);
                        }
                        calender += tbody + "</tr>";
                    }
                    drawMonth++;
                    if (drawMonth > 11) {
                        drawMonth = 0;
                        drawYear++;
                    }
                    calender += "</tbody></table>" + (isMultiMonth ? "</div>" +
                        ((numMonths[0] > 0 && col === numMonths[1] - 1) ? "<div class='ui-datepicker-row-break'></div>" : "") : "");
                    group += calender;
                }
                html += group;
            }
            html += buttonPanel;
            inst._keyEvent = false;
            return html;
        },

        /* Generate the month and year header. */
        _generateMonthYearHeader: function (inst, drawMonth, drawYear, minDate, maxDate,
                                            secondary, monthNames, monthNamesShort) {

            var inMinYear, inMaxYear, month, years, thisYear, determineYear, year, endYear,
                changeMonth = this._get(inst, "changeMonth"),
                changeYear = this._get(inst, "changeYear"),
                showMonthAfterYear = this._get(inst, "showMonthAfterYear"),
                html = "<div class='ui-datepicker-title'>",
                monthHtml = "";

            // Month selection
            if (secondary || !changeMonth) {
                monthHtml += "<span class='ui-datepicker-month'>" + monthNames[drawMonth] + "</span>";
            } else {
                inMinYear = (minDate && minDate.getFullYear() === drawYear);
                inMaxYear = (maxDate && maxDate.getFullYear() === drawYear);
                monthHtml += "<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>";
                for (month = 0; month < 12; month++) {
                    if ((!inMinYear || month >= minDate.getMonth()) && (!inMaxYear || month <= maxDate.getMonth())) {
                        monthHtml += "<option value='" + month + "'" +
                            (month === drawMonth ? " selected='selected'" : "") +
                            ">" + monthNamesShort[month] + "</option>";
                    }
                }
                monthHtml += "</select>";
            }

            if (!showMonthAfterYear) {
                html += monthHtml + (secondary || !(changeMonth && changeYear) ? "&#xa0;" : "");
            }

            // Year selection
            if (!inst.yearshtml) {
                inst.yearshtml = "";
                if (secondary || !changeYear) {
                    html += "<span class='ui-datepicker-year'>" + drawYear + "</span>";
                } else {

                    // determine range of years to display
                    years = this._get(inst, "yearRange").split(":");
                    thisYear = new Date().getFullYear();
                    determineYear = function (value) {
                        var year = (value.match(/c[+\-].*/) ? drawYear + parseInt(value.substring(1), 10) :
                            (value.match(/[+\-].*/) ? thisYear + parseInt(value, 10) :
                                parseInt(value, 10)));
                        return (isNaN(year) ? thisYear : year);
                    };
                    year = determineYear(years[0]);
                    endYear = Math.max(year, determineYear(years[1] || ""));
                    year = (minDate ? Math.max(year, minDate.getFullYear()) : year);
                    endYear = (maxDate ? Math.min(endYear, maxDate.getFullYear()) : endYear);
                    inst.yearshtml += "<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";
                    for (; year <= endYear; year++) {
                        inst.yearshtml += "<option value='" + year + "'" +
                            (year === drawYear ? " selected='selected'" : "") +
                            ">" + year + "</option>";
                    }
                    inst.yearshtml += "</select>";

                    html += inst.yearshtml;
                    inst.yearshtml = null;
                }
            }

            html += this._get(inst, "yearSuffix");
            if (showMonthAfterYear) {
                html += (secondary || !(changeMonth && changeYear) ? "&#xa0;" : "") + monthHtml;
            }
            html += "</div>"; // Close datepicker_header
            return html;
        },

        /* Adjust one of the date sub-fields. */
        _adjustInstDate: function (inst, offset, period) {
            var year = inst.selectedYear + (period === "Y" ? offset : 0),
                month = inst.selectedMonth + (period === "M" ? offset : 0),
                day = Math.min(inst.selectedDay, this._getDaysInMonth(year, month)) + (period === "D" ? offset : 0),
                date = this._restrictMinMax(inst, this._daylightSavingAdjust(new Date(year, month, day)));

            inst.selectedDay = date.getDate();
            inst.drawMonth = inst.selectedMonth = date.getMonth();
            inst.drawYear = inst.selectedYear = date.getFullYear();
            if (period === "M" || period === "Y") {
                this._notifyChange(inst);
            }
        },

        /* Ensure a date is within any min/max bounds. */
        _restrictMinMax: function (inst, date) {
            var minDate = this._getMinMaxDate(inst, "min"),
                maxDate = this._getMinMaxDate(inst, "max"),
                newDate = (minDate && date < minDate ? minDate : date);
            return (maxDate && newDate > maxDate ? maxDate : newDate);
        },

        /* Notify change of month/year. */
        _notifyChange: function (inst) {
            var onChange = this._get(inst, "onChangeMonthYear");
            if (onChange) {
                onChange.apply((inst.input ? inst.input[0] : null),
                    [inst.selectedYear, inst.selectedMonth + 1, inst]);
            }
        },

        /* Determine the number of months to show. */
        _getNumberOfMonths: function (inst) {
            var numMonths = this._get(inst, "numberOfMonths");
            return (numMonths == null ? [1, 1] : (typeof numMonths === "number" ? [1, numMonths] : numMonths));
        },

        /* Determine the current maximum date - ensure no time components are set. */
        _getMinMaxDate: function (inst, minMax) {
            return this._determineDate(inst, this._get(inst, minMax + "Date"), null);
        },

        /* Find the number of days in a given month. */
        _getDaysInMonth: function (year, month) {
            return 32 - this._daylightSavingAdjust(new Date(year, month, 32)).getDate();
        },

        /* Find the day of the week of the first of a month. */
        _getFirstDayOfMonth: function (year, month) {
            return new Date(year, month, 1).getDay();
        },

        /* Determines if we should allow a "next/prev" month display change. */
        _canAdjustMonth: function (inst, offset, curYear, curMonth) {
            var numMonths = this._getNumberOfMonths(inst),
                date = this._daylightSavingAdjust(new Date(curYear,
                    curMonth + (offset < 0 ? offset : numMonths[0] * numMonths[1]), 1));

            if (offset < 0) {
                date.setDate(this._getDaysInMonth(date.getFullYear(), date.getMonth()));
            }
            return this._isInRange(inst, date);
        },

        /* Is the given date in the accepted range? */
        _isInRange: function (inst, date) {
            var yearSplit, currentYear,
                minDate = this._getMinMaxDate(inst, "min"),
                maxDate = this._getMinMaxDate(inst, "max"),
                minYear = null,
                maxYear = null,
                years = this._get(inst, "yearRange");
            if (years) {
                yearSplit = years.split(":");
                currentYear = new Date().getFullYear();
                minYear = parseInt(yearSplit[0], 10);
                maxYear = parseInt(yearSplit[1], 10);
                if (yearSplit[0].match(/[+\-].*/)) {
                    minYear += currentYear;
                }
                if (yearSplit[1].match(/[+\-].*/)) {
                    maxYear += currentYear;
                }
            }

            return ((!minDate || date.getTime() >= minDate.getTime()) &&
                (!maxDate || date.getTime() <= maxDate.getTime()) &&
                (!minYear || date.getFullYear() >= minYear) &&
                (!maxYear || date.getFullYear() <= maxYear));
        },

        /* Provide the configuration settings for formatting/parsing. */
        _getFormatConfig: function (inst) {
            var shortYearCutoff = this._get(inst, "shortYearCutoff");
            shortYearCutoff = (typeof shortYearCutoff !== "string" ? shortYearCutoff :
                new Date().getFullYear() % 100 + parseInt(shortYearCutoff, 10));
            return {
                shortYearCutoff: shortYearCutoff,
                dayNamesShort: this._get(inst, "dayNamesShort"), dayNames: this._get(inst, "dayNames"),
                monthNamesShort: this._get(inst, "monthNamesShort"), monthNames: this._get(inst, "monthNames")
            };
        },

        /* Format the given date for display. */
        _formatDate: function (inst, day, month, year) {
            if (!day) {
                inst.currentDay = inst.selectedDay;
                inst.currentMonth = inst.selectedMonth;
                inst.currentYear = inst.selectedYear;
            }
            var date = (day ? (typeof day === "object" ? day :
                this._daylightSavingAdjust(new Date(year, month, day))) :
                this._daylightSavingAdjust(new Date(inst.currentYear, inst.currentMonth, inst.currentDay)));
            return this.formatDate(this._get(inst, "dateFormat"), date, this._getFormatConfig(inst));
        }
    });

    /*
 * Bind hover events for datepicker elements.
 * Done via delegate so the binding only occurs once in the lifetime of the parent div.
 * Global datepicker_instActive, set by _updateDatepicker allows the handlers to find their way back to the active picker.
 */
    function datepicker_bindHover(dpDiv) {
        var selector = "button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";
        return dpDiv.on("mouseout", selector, function () {
            $(this).removeClass("ui-state-hover");
            if (this.className.indexOf("ui-datepicker-prev") !== -1) {
                $(this).removeClass("ui-datepicker-prev-hover");
            }
            if (this.className.indexOf("ui-datepicker-next") !== -1) {
                $(this).removeClass("ui-datepicker-next-hover");
            }
        })
            .on("mouseover", selector, datepicker_handleMouseover);
    }

    function datepicker_handleMouseover() {
        if (!$.datepicker._isDisabledDatepicker(datepicker_instActive.inline ? datepicker_instActive.dpDiv.parent()[0] : datepicker_instActive.input[0])) {
            $(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover");
            $(this).addClass("ui-state-hover");
            if (this.className.indexOf("ui-datepicker-prev") !== -1) {
                $(this).addClass("ui-datepicker-prev-hover");
            }
            if (this.className.indexOf("ui-datepicker-next") !== -1) {
                $(this).addClass("ui-datepicker-next-hover");
            }
        }
    }

    /* jQuery extend now ignores nulls! */
    function datepicker_extendRemove(target, props) {
        $.extend(target, props);
        for (var name in props) {
            if (props[name] == null) {
                target[name] = props[name];
            }
        }
        return target;
    }

    /* Invoke the datepicker functionality.
   @param  options  string - a command, optionally followed by additional parameters or
					Object - settings for attaching new datepicker functionality
   @return  jQuery object */
    $.fn.datepicker = function (options) {

        /* Verify an empty collection wasn't passed - Fixes #6976 */
        if (!this.length) {
            return this;
        }

        /* Initialise the date picker. */
        if (!$.datepicker.initialized) {
            $(document).on("mousedown", $.datepicker._checkExternalClick);
            $.datepicker.initialized = true;
        }

        /* Append datepicker main container to body if not exist. */
        if ($("#" + $.datepicker._mainDivId).length === 0) {
            $("body").append($.datepicker.dpDiv);
        }

        var otherArgs = Array.prototype.slice.call(arguments, 1);
        if (typeof options === "string" && (options === "isDisabled" || options === "getDate" || options === "widget")) {
            return $.datepicker["_" + options + "Datepicker"].apply($.datepicker, [this[0]].concat(otherArgs));
        }
        if (options === "option" && arguments.length === 2 && typeof arguments[1] === "string") {
            return $.datepicker["_" + options + "Datepicker"].apply($.datepicker, [this[0]].concat(otherArgs));
        }
        return this.each(function () {
            typeof options === "string" ?
                $.datepicker["_" + options + "Datepicker"].apply($.datepicker, [this].concat(otherArgs)) :
                $.datepicker._attachDatepicker(this, options);
        });
    };

    $.datepicker = new Datepicker(); // singleton instance
    $.datepicker.initialized = false;
    $.datepicker.uuid = new Date().getTime();
    $.datepicker.version = "1.12.1";

    var widgetsDatepicker = $.datepicker;


// This file is deprecated
    var ie = $.ui.ie = !!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());

    /*!
 * jQuery UI Mouse 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Mouse
//>>group: Widgets
//>>description: Abstracts mouse-based interactions to assist in creating certain widgets.
//>>docs: http://api.jqueryui.com/mouse/


    var mouseHandled = false;
    $(document).on("mouseup", function () {
        mouseHandled = false;
    });

    var widgetsMouse = $.widget("ui.mouse", {
        version: "1.12.1",
        options: {
            cancel: "input, textarea, button, select, option",
            distance: 1,
            delay: 0
        },
        _mouseInit: function () {
            var that = this;

            this.element
                .on("mousedown." + this.widgetName, function (event) {
                    return that._mouseDown(event);
                })
                .on("click." + this.widgetName, function (event) {
                    if (true === $.data(event.target, that.widgetName + ".preventClickEvent")) {
                        $.removeData(event.target, that.widgetName + ".preventClickEvent");
                        event.stopImmediatePropagation();
                        return false;
                    }
                });

            this.started = false;
        },

        // TODO: make sure destroying one instance of mouse doesn't mess with
        // other instances of mouse
        _mouseDestroy: function () {
            this.element.off("." + this.widgetName);
            if (this._mouseMoveDelegate) {
                this.document
                    .off("mousemove." + this.widgetName, this._mouseMoveDelegate)
                    .off("mouseup." + this.widgetName, this._mouseUpDelegate);
            }
        },

        _mouseDown: function (event) {

            // don't let more than one widget handle mouseStart
            if (mouseHandled) {
                return;
            }

            this._mouseMoved = false;

            // We may have missed mouseup (out of window)
            (this._mouseStarted && this._mouseUp(event));

            this._mouseDownEvent = event;

            var that = this,
                btnIsLeft = (event.which === 1),

                // event.target.nodeName works around a bug in IE 8 with
                // disabled inputs (#7620)
                elIsCancel = (typeof this.options.cancel === "string" && event.target.nodeName ?
                    $(event.target).closest(this.options.cancel).length : false);
            if (!btnIsLeft || elIsCancel || !this._mouseCapture(event)) {
                return true;
            }

            this.mouseDelayMet = !this.options.delay;
            if (!this.mouseDelayMet) {
                this._mouseDelayTimer = setTimeout(function () {
                    that.mouseDelayMet = true;
                }, this.options.delay);
            }

            if (this._mouseDistanceMet(event) && this._mouseDelayMet(event)) {
                this._mouseStarted = (this._mouseStart(event) !== false);
                if (!this._mouseStarted) {
                    event.preventDefault();
                    return true;
                }
            }

            // Click event may never have fired (Gecko & Opera)
            if (true === $.data(event.target, this.widgetName + ".preventClickEvent")) {
                $.removeData(event.target, this.widgetName + ".preventClickEvent");
            }

            // These delegates are required to keep context
            this._mouseMoveDelegate = function (event) {
                return that._mouseMove(event);
            };
            this._mouseUpDelegate = function (event) {
                return that._mouseUp(event);
            };

            this.document
                .on("mousemove." + this.widgetName, this._mouseMoveDelegate)
                .on("mouseup." + this.widgetName, this._mouseUpDelegate);

            event.preventDefault();

            mouseHandled = true;
            return true;
        },

        _mouseMove: function (event) {

            // Only check for mouseups outside the document if you've moved inside the document
            // at least once. This prevents the firing of mouseup in the case of IE<9, which will
            // fire a mousemove event if content is placed under the cursor. See #7778
            // Support: IE <9
            if (this._mouseMoved) {

                // IE mouseup check - mouseup happened when mouse was out of window
                if ($.ui.ie && (!document.documentMode || document.documentMode < 9) &&
                    !event.button) {
                    return this._mouseUp(event);

                    // Iframe mouseup check - mouseup occurred in another document
                } else if (!event.which) {

                    // Support: Safari <=8 - 9
                    // Safari sets which to 0 if you press any of the following keys
                    // during a drag (#14461)
                    if (event.originalEvent.altKey || event.originalEvent.ctrlKey ||
                        event.originalEvent.metaKey || event.originalEvent.shiftKey) {
                        this.ignoreMissingWhich = true;
                    } else if (!this.ignoreMissingWhich) {
                        return this._mouseUp(event);
                    }
                }
            }

            if (event.which || event.button) {
                this._mouseMoved = true;
            }

            if (this._mouseStarted) {
                this._mouseDrag(event);
                return event.preventDefault();
            }

            if (this._mouseDistanceMet(event) && this._mouseDelayMet(event)) {
                this._mouseStarted =
                    (this._mouseStart(this._mouseDownEvent, event) !== false);
                (this._mouseStarted ? this._mouseDrag(event) : this._mouseUp(event));
            }

            return !this._mouseStarted;
        },

        _mouseUp: function (event) {
            this.document
                .off("mousemove." + this.widgetName, this._mouseMoveDelegate)
                .off("mouseup." + this.widgetName, this._mouseUpDelegate);

            if (this._mouseStarted) {
                this._mouseStarted = false;

                if (event.target === this._mouseDownEvent.target) {
                    $.data(event.target, this.widgetName + ".preventClickEvent", true);
                }

                this._mouseStop(event);
            }

            if (this._mouseDelayTimer) {
                clearTimeout(this._mouseDelayTimer);
                delete this._mouseDelayTimer;
            }

            this.ignoreMissingWhich = false;
            mouseHandled = false;
            event.preventDefault();
        },

        _mouseDistanceMet: function (event) {
            return (Math.max(
                    Math.abs(this._mouseDownEvent.pageX - event.pageX),
                    Math.abs(this._mouseDownEvent.pageY - event.pageY)
                ) >= this.options.distance
            );
        },

        _mouseDelayMet: function (/* event */) {
            return this.mouseDelayMet;
        },

        // These are placeholder methods, to be overriden by extending plugin
        _mouseStart: function (/* event */) {
        },
        _mouseDrag: function (/* event */) {
        },
        _mouseStop: function (/* event */) {
        },
        _mouseCapture: function (/* event */) {
            return true;
        }
    });


// $.ui.plugin is deprecated. Use $.widget() extensions instead.
    var plugin = $.ui.plugin = {
        add: function (module, option, set) {
            var i,
                proto = $.ui[module].prototype;
            for (i in set) {
                proto.plugins[i] = proto.plugins[i] || [];
                proto.plugins[i].push([option, set[i]]);
            }
        },
        call: function (instance, name, args, allowDisconnected) {
            var i,
                set = instance.plugins[name];

            if (!set) {
                return;
            }

            if (!allowDisconnected && (!instance.element[0].parentNode ||
                instance.element[0].parentNode.nodeType === 11)) {
                return;
            }

            for (i = 0; i < set.length; i++) {
                if (instance.options[set[i][0]]) {
                    set[i][1].apply(instance.element, args);
                }
            }
        }
    };


    var safeBlur = $.ui.safeBlur = function (element) {

        // Support: IE9 - 10 only
        // If the <body> is blurred, IE will switch windows, see #9420
        if (element && element.nodeName.toLowerCase() !== "body") {
            $(element).trigger("blur");
        }
    };


    /*!
 * jQuery UI Draggable 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Draggable
//>>group: Interactions
//>>description: Enables dragging functionality for any element.
//>>docs: http://api.jqueryui.com/draggable/
//>>demos: http://jqueryui.com/draggable/
//>>css.structure: ../../themes/base/draggable.css


    $.widget("ui.draggable", $.ui.mouse, {
        version: "1.12.1",
        widgetEventPrefix: "drag",
        options: {
            addClasses: true,
            appendTo: "parent",
            axis: false,
            connectToSortable: false,
            containment: false,
            cursor: "auto",
            cursorAt: false,
            grid: false,
            handle: false,
            helper: "original",
            iframeFix: false,
            opacity: false,
            refreshPositions: false,
            revert: false,
            revertDuration: 500,
            scope: "default",
            scroll: true,
            scrollSensitivity: 20,
            scrollSpeed: 20,
            snap: false,
            snapMode: "both",
            snapTolerance: 20,
            stack: false,
            zIndex: false,

            // Callbacks
            drag: null,
            start: null,
            stop: null
        },
        _create: function () {

            if (this.options.helper === "original") {
                this._setPositionRelative();
            }
            if (this.options.addClasses) {
                this._addClass("ui-draggable");
            }
            this._setHandleClassName();

            this._mouseInit();
        },

        _setOption: function (key, value) {
            this._super(key, value);
            if (key === "handle") {
                this._removeHandleClassName();
                this._setHandleClassName();
            }
        },

        _destroy: function () {
            if ((this.helper || this.element).is(".ui-draggable-dragging")) {
                this.destroyOnClear = true;
                return;
            }
            this._removeHandleClassName();
            this._mouseDestroy();
        },

        _mouseCapture: function (event) {
            var o = this.options;

            // Among others, prevent a drag on a resizable-handle
            if (this.helper || o.disabled ||
                $(event.target).closest(".ui-resizable-handle").length > 0) {
                return false;
            }

            //Quit if we're not on a valid handle
            this.handle = this._getHandle(event);
            if (!this.handle) {
                return false;
            }

            this._blurActiveElement(event);

            this._blockFrames(o.iframeFix === true ? "iframe" : o.iframeFix);

            return true;

        },

        _blockFrames: function (selector) {
            this.iframeBlocks = this.document.find(selector).map(function () {
                var iframe = $(this);

                return $("<div>")
                    .css("position", "absolute")
                    .appendTo(iframe.parent())
                    .outerWidth(iframe.outerWidth())
                    .outerHeight(iframe.outerHeight())
                    .offset(iframe.offset())[0];
            });
        },

        _unblockFrames: function () {
            if (this.iframeBlocks) {
                this.iframeBlocks.remove();
                delete this.iframeBlocks;
            }
        },

        _blurActiveElement: function (event) {
            var activeElement = $.ui.safeActiveElement(this.document[0]),
                target = $(event.target);

            // Don't blur if the event occurred on an element that is within
            // the currently focused element
            // See #10527, #12472
            if (target.closest(activeElement).length) {
                return;
            }

            // Blur any element that currently has focus, see #4261
            $.ui.safeBlur(activeElement);
        },

        _mouseStart: function (event) {

            var o = this.options;

            //Create and append the visible helper
            this.helper = this._createHelper(event);

            this._addClass(this.helper, "ui-draggable-dragging");

            //Cache the helper size
            this._cacheHelperProportions();

            //If ddmanager is used for droppables, set the global draggable
            if ($.ui.ddmanager) {
                $.ui.ddmanager.current = this;
            }

            /*
		 * - Position generation -
		 * This block generates everything position related - it's the core of draggables.
		 */

            //Cache the margins of the original element
            this._cacheMargins();

            //Store the helper's css position
            this.cssPosition = this.helper.css("position");
            this.scrollParent = this.helper.scrollParent(true);
            this.offsetParent = this.helper.offsetParent();
            this.hasFixedAncestor = this.helper.parents().filter(function () {
                return $(this).css("position") === "fixed";
            }).length > 0;

            //The element's absolute position on the page minus margins
            this.positionAbs = this.element.offset();
            this._refreshOffsets(event);

            //Generate the original position
            this.originalPosition = this.position = this._generatePosition(event, false);
            this.originalPageX = event.pageX;
            this.originalPageY = event.pageY;

            //Adjust the mouse offset relative to the helper if "cursorAt" is supplied
            (o.cursorAt && this._adjustOffsetFromHelper(o.cursorAt));

            //Set a containment if given in the options
            this._setContainment();

            //Trigger event + callbacks
            if (this._trigger("start", event) === false) {
                this._clear();
                return false;
            }

            //Recache the helper size
            this._cacheHelperProportions();

            //Prepare the droppable offsets
            if ($.ui.ddmanager && !o.dropBehaviour) {
                $.ui.ddmanager.prepareOffsets(this, event);
            }

            // Execute the drag once - this causes the helper not to be visible before getting its
            // correct position
            this._mouseDrag(event, true);

            // If the ddmanager is used for droppables, inform the manager that dragging has started
            // (see #5003)
            if ($.ui.ddmanager) {
                $.ui.ddmanager.dragStart(this, event);
            }

            return true;
        },

        _refreshOffsets: function (event) {
            this.offset = {
                top: this.positionAbs.top - this.margins.top,
                left: this.positionAbs.left - this.margins.left,
                scroll: false,
                parent: this._getParentOffset(),
                relative: this._getRelativeOffset()
            };

            this.offset.click = {
                left: event.pageX - this.offset.left,
                top: event.pageY - this.offset.top
            };
        },

        _mouseDrag: function (event, noPropagation) {

            // reset any necessary cached properties (see #5009)
            if (this.hasFixedAncestor) {
                this.offset.parent = this._getParentOffset();
            }

            //Compute the helpers position
            this.position = this._generatePosition(event, true);
            this.positionAbs = this._convertPositionTo("absolute");

            //Call plugins and callbacks and use the resulting position if something is returned
            if (!noPropagation) {
                var ui = this._uiHash();
                if (this._trigger("drag", event, ui) === false) {
                    this._mouseUp(new $.Event("mouseup", event));
                    return false;
                }
                this.position = ui.position;
            }

            this.helper[0].style.left = this.position.left + "px";
            this.helper[0].style.top = this.position.top + "px";

            if ($.ui.ddmanager) {
                $.ui.ddmanager.drag(this, event);
            }

            return false;
        },

        _mouseStop: function (event) {

            //If we are using droppables, inform the manager about the drop
            var that = this,
                dropped = false;
            if ($.ui.ddmanager && !this.options.dropBehaviour) {
                dropped = $.ui.ddmanager.drop(this, event);
            }

            //if a drop comes from outside (a sortable)
            if (this.dropped) {
                dropped = this.dropped;
                this.dropped = false;
            }

            if ((this.options.revert === "invalid" && !dropped) ||
                (this.options.revert === "valid" && dropped) ||
                this.options.revert === true || ($.isFunction(this.options.revert) &&
                    this.options.revert.call(this.element, dropped))
            ) {
                $(this.helper).animate(
                    this.originalPosition,
                    parseInt(this.options.revertDuration, 10),
                    function () {
                        if (that._trigger("stop", event) !== false) {
                            that._clear();
                        }
                    }
                );
            } else {
                if (this._trigger("stop", event) !== false) {
                    this._clear();
                }
            }

            return false;
        },

        _mouseUp: function (event) {
            this._unblockFrames();

            // If the ddmanager is used for droppables, inform the manager that dragging has stopped
            // (see #5003)
            if ($.ui.ddmanager) {
                $.ui.ddmanager.dragStop(this, event);
            }

            // Only need to focus if the event occurred on the draggable itself, see #10527
            if (this.handleElement.is(event.target)) {

                // The interaction is over; whether or not the click resulted in a drag,
                // focus the element
                this.element.trigger("focus");
            }

            return $.ui.mouse.prototype._mouseUp.call(this, event);
        },

        cancel: function () {

            if (this.helper.is(".ui-draggable-dragging")) {
                this._mouseUp(new $.Event("mouseup", {target: this.element[0]}));
            } else {
                this._clear();
            }

            return this;

        },

        _getHandle: function (event) {
            return this.options.handle ?
                !!$(event.target).closest(this.element.find(this.options.handle)).length :
                true;
        },

        _setHandleClassName: function () {
            this.handleElement = this.options.handle ?
                this.element.find(this.options.handle) : this.element;
            this._addClass(this.handleElement, "ui-draggable-handle");
        },

        _removeHandleClassName: function () {
            this._removeClass(this.handleElement, "ui-draggable-handle");
        },

        _createHelper: function (event) {

            var o = this.options,
                helperIsFunction = $.isFunction(o.helper),
                helper = helperIsFunction ?
                    $(o.helper.apply(this.element[0], [event])) :
                    (o.helper === "clone" ?
                        this.element.clone().removeAttr("id") :
                        this.element);

            if (!helper.parents("body").length) {
                helper.appendTo((o.appendTo === "parent" ?
                    this.element[0].parentNode :
                    o.appendTo));
            }

            // Http://bugs.jqueryui.com/ticket/9446
            // a helper function can return the original element
            // which wouldn't have been set to relative in _create
            if (helperIsFunction && helper[0] === this.element[0]) {
                this._setPositionRelative();
            }

            if (helper[0] !== this.element[0] &&
                !(/(fixed|absolute)/).test(helper.css("position"))) {
                helper.css("position", "absolute");
            }

            return helper;

        },

        _setPositionRelative: function () {
            if (!(/^(?:r|a|f)/).test(this.element.css("position"))) {
                this.element[0].style.position = "relative";
            }
        },

        _adjustOffsetFromHelper: function (obj) {
            if (typeof obj === "string") {
                obj = obj.split(" ");
            }
            if ($.isArray(obj)) {
                obj = {left: +obj[0], top: +obj[1] || 0};
            }
            if ("left" in obj) {
                this.offset.click.left = obj.left + this.margins.left;
            }
            if ("right" in obj) {
                this.offset.click.left = this.helperProportions.width - obj.right + this.margins.left;
            }
            if ("top" in obj) {
                this.offset.click.top = obj.top + this.margins.top;
            }
            if ("bottom" in obj) {
                this.offset.click.top = this.helperProportions.height - obj.bottom + this.margins.top;
            }
        },

        _isRootNode: function (element) {
            return (/(html|body)/i).test(element.tagName) || element === this.document[0];
        },

        _getParentOffset: function () {

            //Get the offsetParent and cache its position
            var po = this.offsetParent.offset(),
                document = this.document[0];

            // This is a special case where we need to modify a offset calculated on start, since the
            // following happened:
            // 1. The position of the helper is absolute, so it's position is calculated based on the
            // next positioned parent
            // 2. The actual offset parent is a child of the scroll parent, and the scroll parent isn't
            // the document, which means that the scroll is included in the initial calculation of the
            // offset of the parent, and never recalculated upon drag
            if (this.cssPosition === "absolute" && this.scrollParent[0] !== document &&
                $.contains(this.scrollParent[0], this.offsetParent[0])) {
                po.left += this.scrollParent.scrollLeft();
                po.top += this.scrollParent.scrollTop();
            }

            if (this._isRootNode(this.offsetParent[0])) {
                po = {top: 0, left: 0};
            }

            return {
                top: po.top + (parseInt(this.offsetParent.css("borderTopWidth"), 10) || 0),
                left: po.left + (parseInt(this.offsetParent.css("borderLeftWidth"), 10) || 0)
            };

        },

        _getRelativeOffset: function () {
            if (this.cssPosition !== "relative") {
                return {top: 0, left: 0};
            }

            var p = this.element.position(),
                scrollIsRootNode = this._isRootNode(this.scrollParent[0]);

            return {
                top: p.top - (parseInt(this.helper.css("top"), 10) || 0) +
                    (!scrollIsRootNode ? this.scrollParent.scrollTop() : 0),
                left: p.left - (parseInt(this.helper.css("left"), 10) || 0) +
                    (!scrollIsRootNode ? this.scrollParent.scrollLeft() : 0)
            };

        },

        _cacheMargins: function () {
            this.margins = {
                left: (parseInt(this.element.css("marginLeft"), 10) || 0),
                top: (parseInt(this.element.css("marginTop"), 10) || 0),
                right: (parseInt(this.element.css("marginRight"), 10) || 0),
                bottom: (parseInt(this.element.css("marginBottom"), 10) || 0)
            };
        },

        _cacheHelperProportions: function () {
            this.helperProportions = {
                width: this.helper.outerWidth(),
                height: this.helper.outerHeight()
            };
        },

        _setContainment: function () {

            var isUserScrollable, c, ce,
                o = this.options,
                document = this.document[0];

            this.relativeContainer = null;

            if (!o.containment) {
                this.containment = null;
                return;
            }

            if (o.containment === "window") {
                this.containment = [
                    $(window).scrollLeft() - this.offset.relative.left - this.offset.parent.left,
                    $(window).scrollTop() - this.offset.relative.top - this.offset.parent.top,
                    $(window).scrollLeft() + $(window).width() -
                    this.helperProportions.width - this.margins.left,
                    $(window).scrollTop() +
                    ($(window).height() || document.body.parentNode.scrollHeight) -
                    this.helperProportions.height - this.margins.top
                ];
                return;
            }

            if (o.containment === "document") {
                this.containment = [
                    0,
                    0,
                    $(document).width() - this.helperProportions.width - this.margins.left,
                    ($(document).height() || document.body.parentNode.scrollHeight) -
                    this.helperProportions.height - this.margins.top
                ];
                return;
            }

            if (o.containment.constructor === Array) {
                this.containment = o.containment;
                return;
            }

            if (o.containment === "parent") {
                o.containment = this.helper[0].parentNode;
            }

            c = $(o.containment);
            ce = c[0];

            if (!ce) {
                return;
            }

            isUserScrollable = /(scroll|auto)/.test(c.css("overflow"));

            this.containment = [
                (parseInt(c.css("borderLeftWidth"), 10) || 0) +
                (parseInt(c.css("paddingLeft"), 10) || 0),
                (parseInt(c.css("borderTopWidth"), 10) || 0) +
                (parseInt(c.css("paddingTop"), 10) || 0),
                (isUserScrollable ? Math.max(ce.scrollWidth, ce.offsetWidth) : ce.offsetWidth) -
                (parseInt(c.css("borderRightWidth"), 10) || 0) -
                (parseInt(c.css("paddingRight"), 10) || 0) -
                this.helperProportions.width -
                this.margins.left -
                this.margins.right,
                (isUserScrollable ? Math.max(ce.scrollHeight, ce.offsetHeight) : ce.offsetHeight) -
                (parseInt(c.css("borderBottomWidth"), 10) || 0) -
                (parseInt(c.css("paddingBottom"), 10) || 0) -
                this.helperProportions.height -
                this.margins.top -
                this.margins.bottom
            ];
            this.relativeContainer = c;
        },

        _convertPositionTo: function (d, pos) {

            if (!pos) {
                pos = this.position;
            }

            var mod = d === "absolute" ? 1 : -1,
                scrollIsRootNode = this._isRootNode(this.scrollParent[0]);

            return {
                top: (

                    // The absolute mouse position
                    pos.top +

                    // Only for relative positioned nodes: Relative offset from element to offset parent
                    this.offset.relative.top * mod +

                    // The offsetParent's offset without borders (offset + border)
                    this.offset.parent.top * mod -
                    ((this.cssPosition === "fixed" ?
                        -this.offset.scroll.top :
                        (scrollIsRootNode ? 0 : this.offset.scroll.top)) * mod)
                ),
                left: (

                    // The absolute mouse position
                    pos.left +

                    // Only for relative positioned nodes: Relative offset from element to offset parent
                    this.offset.relative.left * mod +

                    // The offsetParent's offset without borders (offset + border)
                    this.offset.parent.left * mod -
                    ((this.cssPosition === "fixed" ?
                        -this.offset.scroll.left :
                        (scrollIsRootNode ? 0 : this.offset.scroll.left)) * mod)
                )
            };

        },

        _generatePosition: function (event, constrainPosition) {

            var containment, co, top, left,
                o = this.options,
                scrollIsRootNode = this._isRootNode(this.scrollParent[0]),
                pageX = event.pageX,
                pageY = event.pageY;

            // Cache the scroll
            if (!scrollIsRootNode || !this.offset.scroll) {
                this.offset.scroll = {
                    top: this.scrollParent.scrollTop(),
                    left: this.scrollParent.scrollLeft()
                };
            }

            /*
		 * - Position constraining -
		 * Constrain the position to a mix of grid, containment.
		 */

            // If we are not dragging yet, we won't check for options
            if (constrainPosition) {
                if (this.containment) {
                    if (this.relativeContainer) {
                        co = this.relativeContainer.offset();
                        containment = [
                            this.containment[0] + co.left,
                            this.containment[1] + co.top,
                            this.containment[2] + co.left,
                            this.containment[3] + co.top
                        ];
                    } else {
                        containment = this.containment;
                    }

                    if (event.pageX - this.offset.click.left < containment[0]) {
                        pageX = containment[0] + this.offset.click.left;
                    }
                    if (event.pageY - this.offset.click.top < containment[1]) {
                        pageY = containment[1] + this.offset.click.top;
                    }
                    if (event.pageX - this.offset.click.left > containment[2]) {
                        pageX = containment[2] + this.offset.click.left;
                    }
                    if (event.pageY - this.offset.click.top > containment[3]) {
                        pageY = containment[3] + this.offset.click.top;
                    }
                }

                if (o.grid) {

                    //Check for grid elements set to 0 to prevent divide by 0 error causing invalid
                    // argument errors in IE (see ticket #6950)
                    top = o.grid[1] ? this.originalPageY + Math.round((pageY -
                        this.originalPageY) / o.grid[1]) * o.grid[1] : this.originalPageY;
                    pageY = containment ? ((top - this.offset.click.top >= containment[1] ||
                        top - this.offset.click.top > containment[3]) ?
                        top :
                        ((top - this.offset.click.top >= containment[1]) ?
                            top - o.grid[1] : top + o.grid[1])) : top;

                    left = o.grid[0] ? this.originalPageX +
                        Math.round((pageX - this.originalPageX) / o.grid[0]) * o.grid[0] :
                        this.originalPageX;
                    pageX = containment ? ((left - this.offset.click.left >= containment[0] ||
                        left - this.offset.click.left > containment[2]) ?
                        left :
                        ((left - this.offset.click.left >= containment[0]) ?
                            left - o.grid[0] : left + o.grid[0])) : left;
                }

                if (o.axis === "y") {
                    pageX = this.originalPageX;
                }

                if (o.axis === "x") {
                    pageY = this.originalPageY;
                }
            }

            return {
                top: (

                    // The absolute mouse position
                    pageY -

                    // Click offset (relative to the element)
                    this.offset.click.top -

                    // Only for relative positioned nodes: Relative offset from element to offset parent
                    this.offset.relative.top -

                    // The offsetParent's offset without borders (offset + border)
                    this.offset.parent.top +
                    (this.cssPosition === "fixed" ?
                        -this.offset.scroll.top :
                        (scrollIsRootNode ? 0 : this.offset.scroll.top))
                ),
                left: (

                    // The absolute mouse position
                    pageX -

                    // Click offset (relative to the element)
                    this.offset.click.left -

                    // Only for relative positioned nodes: Relative offset from element to offset parent
                    this.offset.relative.left -

                    // The offsetParent's offset without borders (offset + border)
                    this.offset.parent.left +
                    (this.cssPosition === "fixed" ?
                        -this.offset.scroll.left :
                        (scrollIsRootNode ? 0 : this.offset.scroll.left))
                )
            };

        },

        _clear: function () {
            this._removeClass(this.helper, "ui-draggable-dragging");
            if (this.helper[0] !== this.element[0] && !this.cancelHelperRemoval) {
                this.helper.remove();
            }
            this.helper = null;
            this.cancelHelperRemoval = false;
            if (this.destroyOnClear) {
                this.destroy();
            }
        },

        // From now on bulk stuff - mainly helpers

        _trigger: function (type, event, ui) {
            ui = ui || this._uiHash();
            $.ui.plugin.call(this, type, [event, ui, this], true);

            // Absolute position and offset (see #6884 ) have to be recalculated after plugins
            if (/^(drag|start|stop)/.test(type)) {
                this.positionAbs = this._convertPositionTo("absolute");
                ui.offset = this.positionAbs;
            }
            return $.Widget.prototype._trigger.call(this, type, event, ui);
        },

        plugins: {},

        _uiHash: function () {
            return {
                helper: this.helper,
                position: this.position,
                originalPosition: this.originalPosition,
                offset: this.positionAbs
            };
        }

    });

    $.ui.plugin.add("draggable", "connectToSortable", {
        start: function (event, ui, draggable) {
            var uiSortable = $.extend({}, ui, {
                item: draggable.element
            });

            draggable.sortables = [];
            $(draggable.options.connectToSortable).each(function () {
                var sortable = $(this).sortable("instance");

                if (sortable && !sortable.options.disabled) {
                    draggable.sortables.push(sortable);

                    // RefreshPositions is called at drag start to refresh the containerCache
                    // which is used in drag. This ensures it's initialized and synchronized
                    // with any changes that might have happened on the page since initialization.
                    sortable.refreshPositions();
                    sortable._trigger("activate", event, uiSortable);
                }
            });
        },
        stop: function (event, ui, draggable) {
            var uiSortable = $.extend({}, ui, {
                item: draggable.element
            });

            draggable.cancelHelperRemoval = false;

            $.each(draggable.sortables, function () {
                var sortable = this;

                if (sortable.isOver) {
                    sortable.isOver = 0;

                    // Allow this sortable to handle removing the helper
                    draggable.cancelHelperRemoval = true;
                    sortable.cancelHelperRemoval = false;

                    // Use _storedCSS To restore properties in the sortable,
                    // as this also handles revert (#9675) since the draggable
                    // may have modified them in unexpected ways (#8809)
                    sortable._storedCSS = {
                        position: sortable.placeholder.css("position"),
                        top: sortable.placeholder.css("top"),
                        left: sortable.placeholder.css("left")
                    };

                    sortable._mouseStop(event);

                    // Once drag has ended, the sortable should return to using
                    // its original helper, not the shared helper from draggable
                    sortable.options.helper = sortable.options._helper;
                } else {

                    // Prevent this Sortable from removing the helper.
                    // However, don't set the draggable to remove the helper
                    // either as another connected Sortable may yet handle the removal.
                    sortable.cancelHelperRemoval = true;

                    sortable._trigger("deactivate", event, uiSortable);
                }
            });
        },
        drag: function (event, ui, draggable) {
            $.each(draggable.sortables, function () {
                var innermostIntersecting = false,
                    sortable = this;

                // Copy over variables that sortable's _intersectsWith uses
                sortable.positionAbs = draggable.positionAbs;
                sortable.helperProportions = draggable.helperProportions;
                sortable.offset.click = draggable.offset.click;

                if (sortable._intersectsWith(sortable.containerCache)) {
                    innermostIntersecting = true;

                    $.each(draggable.sortables, function () {

                        // Copy over variables that sortable's _intersectsWith uses
                        this.positionAbs = draggable.positionAbs;
                        this.helperProportions = draggable.helperProportions;
                        this.offset.click = draggable.offset.click;

                        if (this !== sortable &&
                            this._intersectsWith(this.containerCache) &&
                            $.contains(sortable.element[0], this.element[0])) {
                            innermostIntersecting = false;
                        }

                        return innermostIntersecting;
                    });
                }

                if (innermostIntersecting) {

                    // If it intersects, we use a little isOver variable and set it once,
                    // so that the move-in stuff gets fired only once.
                    if (!sortable.isOver) {
                        sortable.isOver = 1;

                        // Store draggable's parent in case we need to reappend to it later.
                        draggable._parent = ui.helper.parent();

                        sortable.currentItem = ui.helper
                            .appendTo(sortable.element)
                            .data("ui-sortable-item", true);

                        // Store helper option to later restore it
                        sortable.options._helper = sortable.options.helper;

                        sortable.options.helper = function () {
                            return ui.helper[0];
                        };

                        // Fire the start events of the sortable with our passed browser event,
                        // and our own helper (so it doesn't create a new one)
                        event.target = sortable.currentItem[0];
                        sortable._mouseCapture(event, true);
                        sortable._mouseStart(event, true, true);

                        // Because the browser event is way off the new appended portlet,
                        // modify necessary variables to reflect the changes
                        sortable.offset.click.top = draggable.offset.click.top;
                        sortable.offset.click.left = draggable.offset.click.left;
                        sortable.offset.parent.left -= draggable.offset.parent.left -
                            sortable.offset.parent.left;
                        sortable.offset.parent.top -= draggable.offset.parent.top -
                            sortable.offset.parent.top;

                        draggable._trigger("toSortable", event);

                        // Inform draggable that the helper is in a valid drop zone,
                        // used solely in the revert option to handle "valid/invalid".
                        draggable.dropped = sortable.element;

                        // Need to refreshPositions of all sortables in the case that
                        // adding to one sortable changes the location of the other sortables (#9675)
                        $.each(draggable.sortables, function () {
                            this.refreshPositions();
                        });

                        // Hack so receive/update callbacks work (mostly)
                        draggable.currentItem = draggable.element;
                        sortable.fromOutside = draggable;
                    }

                    if (sortable.currentItem) {
                        sortable._mouseDrag(event);

                        // Copy the sortable's position because the draggable's can potentially reflect
                        // a relative position, while sortable is always absolute, which the dragged
                        // element has now become. (#8809)
                        ui.position = sortable.position;
                    }
                } else {

                    // If it doesn't intersect with the sortable, and it intersected before,
                    // we fake the drag stop of the sortable, but make sure it doesn't remove
                    // the helper by using cancelHelperRemoval.
                    if (sortable.isOver) {

                        sortable.isOver = 0;
                        sortable.cancelHelperRemoval = true;

                        // Calling sortable's mouseStop would trigger a revert,
                        // so revert must be temporarily false until after mouseStop is called.
                        sortable.options._revert = sortable.options.revert;
                        sortable.options.revert = false;

                        sortable._trigger("out", event, sortable._uiHash(sortable));
                        sortable._mouseStop(event, true);

                        // Restore sortable behaviors that were modfied
                        // when the draggable entered the sortable area (#9481)
                        sortable.options.revert = sortable.options._revert;
                        sortable.options.helper = sortable.options._helper;

                        if (sortable.placeholder) {
                            sortable.placeholder.remove();
                        }

                        // Restore and recalculate the draggable's offset considering the sortable
                        // may have modified them in unexpected ways. (#8809, #10669)
                        ui.helper.appendTo(draggable._parent);
                        draggable._refreshOffsets(event);
                        ui.position = draggable._generatePosition(event, true);

                        draggable._trigger("fromSortable", event);

                        // Inform draggable that the helper is no longer in a valid drop zone
                        draggable.dropped = false;

                        // Need to refreshPositions of all sortables just in case removing
                        // from one sortable changes the location of other sortables (#9675)
                        $.each(draggable.sortables, function () {
                            this.refreshPositions();
                        });
                    }
                }
            });
        }
    });

    $.ui.plugin.add("draggable", "cursor", {
        start: function (event, ui, instance) {
            var t = $("body"),
                o = instance.options;

            if (t.css("cursor")) {
                o._cursor = t.css("cursor");
            }
            t.css("cursor", o.cursor);
        },
        stop: function (event, ui, instance) {
            var o = instance.options;
            if (o._cursor) {
                $("body").css("cursor", o._cursor);
            }
        }
    });

    $.ui.plugin.add("draggable", "opacity", {
        start: function (event, ui, instance) {
            var t = $(ui.helper),
                o = instance.options;
            if (t.css("opacity")) {
                o._opacity = t.css("opacity");
            }
            t.css("opacity", o.opacity);
        },
        stop: function (event, ui, instance) {
            var o = instance.options;
            if (o._opacity) {
                $(ui.helper).css("opacity", o._opacity);
            }
        }
    });

    $.ui.plugin.add("draggable", "scroll", {
        start: function (event, ui, i) {
            if (!i.scrollParentNotHidden) {
                i.scrollParentNotHidden = i.helper.scrollParent(false);
            }

            if (i.scrollParentNotHidden[0] !== i.document[0] &&
                i.scrollParentNotHidden[0].tagName !== "HTML") {
                i.overflowOffset = i.scrollParentNotHidden.offset();
            }
        },
        drag: function (event, ui, i) {

            var o = i.options,
                scrolled = false,
                scrollParent = i.scrollParentNotHidden[0],
                document = i.document[0];

            if (scrollParent !== document && scrollParent.tagName !== "HTML") {
                if (!o.axis || o.axis !== "x") {
                    if ((i.overflowOffset.top + scrollParent.offsetHeight) - event.pageY <
                        o.scrollSensitivity) {
                        scrollParent.scrollTop = scrolled = scrollParent.scrollTop + o.scrollSpeed;
                    } else if (event.pageY - i.overflowOffset.top < o.scrollSensitivity) {
                        scrollParent.scrollTop = scrolled = scrollParent.scrollTop - o.scrollSpeed;
                    }
                }

                if (!o.axis || o.axis !== "y") {
                    if ((i.overflowOffset.left + scrollParent.offsetWidth) - event.pageX <
                        o.scrollSensitivity) {
                        scrollParent.scrollLeft = scrolled = scrollParent.scrollLeft + o.scrollSpeed;
                    } else if (event.pageX - i.overflowOffset.left < o.scrollSensitivity) {
                        scrollParent.scrollLeft = scrolled = scrollParent.scrollLeft - o.scrollSpeed;
                    }
                }

            } else {

                if (!o.axis || o.axis !== "x") {
                    if (event.pageY - $(document).scrollTop() < o.scrollSensitivity) {
                        scrolled = $(document).scrollTop($(document).scrollTop() - o.scrollSpeed);
                    } else if ($(window).height() - (event.pageY - $(document).scrollTop()) <
                        o.scrollSensitivity) {
                        scrolled = $(document).scrollTop($(document).scrollTop() + o.scrollSpeed);
                    }
                }

                if (!o.axis || o.axis !== "y") {
                    if (event.pageX - $(document).scrollLeft() < o.scrollSensitivity) {
                        scrolled = $(document).scrollLeft(
                            $(document).scrollLeft() - o.scrollSpeed
                        );
                    } else if ($(window).width() - (event.pageX - $(document).scrollLeft()) <
                        o.scrollSensitivity) {
                        scrolled = $(document).scrollLeft(
                            $(document).scrollLeft() + o.scrollSpeed
                        );
                    }
                }

            }

            if (scrolled !== false && $.ui.ddmanager && !o.dropBehaviour) {
                $.ui.ddmanager.prepareOffsets(i, event);
            }

        }
    });

    $.ui.plugin.add("draggable", "snap", {
        start: function (event, ui, i) {

            var o = i.options;

            i.snapElements = [];

            $(o.snap.constructor !== String ? (o.snap.items || ":data(ui-draggable)") : o.snap)
                .each(function () {
                    var $t = $(this),
                        $o = $t.offset();
                    if (this !== i.element[0]) {
                        i.snapElements.push({
                            item: this,
                            width: $t.outerWidth(), height: $t.outerHeight(),
                            top: $o.top, left: $o.left
                        });
                    }
                });

        },
        drag: function (event, ui, inst) {

            var ts, bs, ls, rs, l, r, t, b, i, first,
                o = inst.options,
                d = o.snapTolerance,
                x1 = ui.offset.left, x2 = x1 + inst.helperProportions.width,
                y1 = ui.offset.top, y2 = y1 + inst.helperProportions.height;

            for (i = inst.snapElements.length - 1; i >= 0; i--) {

                l = inst.snapElements[i].left - inst.margins.left;
                r = l + inst.snapElements[i].width;
                t = inst.snapElements[i].top - inst.margins.top;
                b = t + inst.snapElements[i].height;

                if (x2 < l - d || x1 > r + d || y2 < t - d || y1 > b + d ||
                    !$.contains(inst.snapElements[i].item.ownerDocument,
                        inst.snapElements[i].item)) {
                    if (inst.snapElements[i].snapping) {
                        (inst.options.snap.release &&
                            inst.options.snap.release.call(
                                inst.element,
                                event,
                                $.extend(inst._uiHash(), {snapItem: inst.snapElements[i].item})
                            ));
                    }
                    inst.snapElements[i].snapping = false;
                    continue;
                }

                if (o.snapMode !== "inner") {
                    ts = Math.abs(t - y2) <= d;
                    bs = Math.abs(b - y1) <= d;
                    ls = Math.abs(l - x2) <= d;
                    rs = Math.abs(r - x1) <= d;
                    if (ts) {
                        ui.position.top = inst._convertPositionTo("relative", {
                            top: t - inst.helperProportions.height,
                            left: 0
                        }).top;
                    }
                    if (bs) {
                        ui.position.top = inst._convertPositionTo("relative", {
                            top: b,
                            left: 0
                        }).top;
                    }
                    if (ls) {
                        ui.position.left = inst._convertPositionTo("relative", {
                            top: 0,
                            left: l - inst.helperProportions.width
                        }).left;
                    }
                    if (rs) {
                        ui.position.left = inst._convertPositionTo("relative", {
                            top: 0,
                            left: r
                        }).left;
                    }
                }

                first = (ts || bs || ls || rs);

                if (o.snapMode !== "outer") {
                    ts = Math.abs(t - y1) <= d;
                    bs = Math.abs(b - y2) <= d;
                    ls = Math.abs(l - x1) <= d;
                    rs = Math.abs(r - x2) <= d;
                    if (ts) {
                        ui.position.top = inst._convertPositionTo("relative", {
                            top: t,
                            left: 0
                        }).top;
                    }
                    if (bs) {
                        ui.position.top = inst._convertPositionTo("relative", {
                            top: b - inst.helperProportions.height,
                            left: 0
                        }).top;
                    }
                    if (ls) {
                        ui.position.left = inst._convertPositionTo("relative", {
                            top: 0,
                            left: l
                        }).left;
                    }
                    if (rs) {
                        ui.position.left = inst._convertPositionTo("relative", {
                            top: 0,
                            left: r - inst.helperProportions.width
                        }).left;
                    }
                }

                if (!inst.snapElements[i].snapping && (ts || bs || ls || rs || first)) {
                    (inst.options.snap.snap &&
                        inst.options.snap.snap.call(
                            inst.element,
                            event,
                            $.extend(inst._uiHash(), {
                                snapItem: inst.snapElements[i].item
                            })));
                }
                inst.snapElements[i].snapping = (ts || bs || ls || rs || first);

            }

        }
    });

    $.ui.plugin.add("draggable", "stack", {
        start: function (event, ui, instance) {
            var min,
                o = instance.options,
                group = $.makeArray($(o.stack)).sort(function (a, b) {
                    return (parseInt($(a).css("zIndex"), 10) || 0) -
                        (parseInt($(b).css("zIndex"), 10) || 0);
                });

            if (!group.length) {
                return;
            }

            min = parseInt($(group[0]).css("zIndex"), 10) || 0;
            $(group).each(function (i) {
                $(this).css("zIndex", min + i);
            });
            this.css("zIndex", (min + group.length));
        }
    });

    $.ui.plugin.add("draggable", "zIndex", {
        start: function (event, ui, instance) {
            var t = $(ui.helper),
                o = instance.options;

            if (t.css("zIndex")) {
                o._zIndex = t.css("zIndex");
            }
            t.css("zIndex", o.zIndex);
        },
        stop: function (event, ui, instance) {
            var o = instance.options;

            if (o._zIndex) {
                $(ui.helper).css("zIndex", o._zIndex);
            }
        }
    });

    var widgetsDraggable = $.ui.draggable;


    /*!
 * jQuery UI Resizable 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Resizable
//>>group: Interactions
//>>description: Enables resize functionality for any element.
//>>docs: http://api.jqueryui.com/resizable/
//>>demos: http://jqueryui.com/resizable/
//>>css.structure: ../../themes/base/core.css
//>>css.structure: ../../themes/base/resizable.css
//>>css.theme: ../../themes/base/theme.css


    $.widget("ui.resizable", $.ui.mouse, {
        version: "1.12.1",
        widgetEventPrefix: "resize",
        options: {
            alsoResize: false,
            animate: false,
            animateDuration: "slow",
            animateEasing: "swing",
            aspectRatio: false,
            autoHide: false,
            classes: {
                "ui-resizable-se": "ui-icon ui-icon-gripsmall-diagonal-se"
            },
            containment: false,
            ghost: false,
            grid: false,
            handles: "e,s,se",
            helper: false,
            maxHeight: null,
            maxWidth: null,
            minHeight: 10,
            minWidth: 10,

            // See #7960
            zIndex: 90,

            // Callbacks
            resize: null,
            start: null,
            stop: null
        },

        _num: function (value) {
            return parseFloat(value) || 0;
        },

        _isNumber: function (value) {
            return !isNaN(parseFloat(value));
        },

        _hasScroll: function (el, a) {

            if ($(el).css("overflow") === "hidden") {
                return false;
            }

            var scroll = (a && a === "left") ? "scrollLeft" : "scrollTop",
                has = false;

            if (el[scroll] > 0) {
                return true;
            }

            // TODO: determine which cases actually cause this to happen
            // if the element doesn't have the scroll set, see if it's possible to
            // set the scroll
            el[scroll] = 1;
            has = (el[scroll] > 0);
            el[scroll] = 0;
            return has;
        },

        _create: function () {

            var margins,
                o = this.options,
                that = this;
            this._addClass("ui-resizable");

            $.extend(this, {
                _aspectRatio: !!(o.aspectRatio),
                aspectRatio: o.aspectRatio,
                originalElement: this.element,
                _proportionallyResizeElements: [],
                _helper: o.helper || o.ghost || o.animate ? o.helper || "ui-resizable-helper" : null
            });

            // Wrap the element if it cannot hold child nodes
            if (this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)) {

                this.element.wrap(
                    $("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({
                        position: this.element.css("position"),
                        width: this.element.outerWidth(),
                        height: this.element.outerHeight(),
                        top: this.element.css("top"),
                        left: this.element.css("left")
                    })
                );

                this.element = this.element.parent().data(
                    "ui-resizable", this.element.resizable("instance")
                );

                this.elementIsWrapper = true;

                margins = {
                    marginTop: this.originalElement.css("marginTop"),
                    marginRight: this.originalElement.css("marginRight"),
                    marginBottom: this.originalElement.css("marginBottom"),
                    marginLeft: this.originalElement.css("marginLeft")
                };

                this.element.css(margins);
                this.originalElement.css("margin", 0);

                // support: Safari
                // Prevent Safari textarea resize
                this.originalResizeStyle = this.originalElement.css("resize");
                this.originalElement.css("resize", "none");

                this._proportionallyResizeElements.push(this.originalElement.css({
                    position: "static",
                    zoom: 1,
                    display: "block"
                }));

                // Support: IE9
                // avoid IE jump (hard set the margin)
                this.originalElement.css(margins);

                this._proportionallyResize();
            }

            this._setupHandles();

            if (o.autoHide) {
                $(this.element)
                    .on("mouseenter", function () {
                        if (o.disabled) {
                            return;
                        }
                        that._removeClass("ui-resizable-autohide");
                        that._handles.show();
                    })
                    .on("mouseleave", function () {
                        if (o.disabled) {
                            return;
                        }
                        if (!that.resizing) {
                            that._addClass("ui-resizable-autohide");
                            that._handles.hide();
                        }
                    });
            }

            this._mouseInit();
        },

        _destroy: function () {

            this._mouseDestroy();

            var wrapper,
                _destroy = function (exp) {
                    $(exp)
                        .removeData("resizable")
                        .removeData("ui-resizable")
                        .off(".resizable")
                        .find(".ui-resizable-handle")
                        .remove();
                };

            // TODO: Unwrap at same DOM position
            if (this.elementIsWrapper) {
                _destroy(this.element);
                wrapper = this.element;
                this.originalElement.css({
                    position: wrapper.css("position"),
                    width: wrapper.outerWidth(),
                    height: wrapper.outerHeight(),
                    top: wrapper.css("top"),
                    left: wrapper.css("left")
                }).insertAfter(wrapper);
                wrapper.remove();
            }

            this.originalElement.css("resize", this.originalResizeStyle);
            _destroy(this.originalElement);

            return this;
        },

        _setOption: function (key, value) {
            this._super(key, value);

            switch (key) {
                case "handles":
                    this._removeHandles();
                    this._setupHandles();
                    break;
                default:
                    break;
            }
        },

        _setupHandles: function () {
            var o = this.options, handle, i, n, hname, axis, that = this;
            this.handles = o.handles ||
                (!$(".ui-resizable-handle", this.element).length ?
                    "e,s,se" : {
                        n: ".ui-resizable-n",
                        e: ".ui-resizable-e",
                        s: ".ui-resizable-s",
                        w: ".ui-resizable-w",
                        se: ".ui-resizable-se",
                        sw: ".ui-resizable-sw",
                        ne: ".ui-resizable-ne",
                        nw: ".ui-resizable-nw"
                    });

            this._handles = $();
            if (this.handles.constructor === String) {

                if (this.handles === "all") {
                    this.handles = "n,e,s,w,se,sw,ne,nw";
                }

                n = this.handles.split(",");
                this.handles = {};

                for (i = 0; i < n.length; i++) {

                    handle = $.trim(n[i]);
                    hname = "ui-resizable-" + handle;
                    axis = $("<div>");
                    this._addClass(axis, "ui-resizable-handle " + hname);

                    axis.css({zIndex: o.zIndex});

                    this.handles[handle] = ".ui-resizable-" + handle;
                    this.element.append(axis);
                }

            }

            this._renderAxis = function (target) {

                var i, axis, padPos, padWrapper;

                target = target || this.element;

                for (i in this.handles) {

                    if (this.handles[i].constructor === String) {
                        this.handles[i] = this.element.children(this.handles[i]).first().show();
                    } else if (this.handles[i].jquery || this.handles[i].nodeType) {
                        this.handles[i] = $(this.handles[i]);
                        this._on(this.handles[i], {"mousedown": that._mouseDown});
                    }

                    if (this.elementIsWrapper &&
                        this.originalElement[0]
                            .nodeName
                            .match(/^(textarea|input|select|button)$/i)) {
                        axis = $(this.handles[i], this.element);

                        padWrapper = /sw|ne|nw|se|n|s/.test(i) ?
                            axis.outerHeight() :
                            axis.outerWidth();

                        padPos = ["padding",
                            /ne|nw|n/.test(i) ? "Top" :
                                /se|sw|s/.test(i) ? "Bottom" :
                                    /^e$/.test(i) ? "Right" : "Left"].join("");

                        target.css(padPos, padWrapper);

                        this._proportionallyResize();
                    }

                    this._handles = this._handles.add(this.handles[i]);
                }
            };

            // TODO: make renderAxis a prototype function
            this._renderAxis(this.element);

            this._handles = this._handles.add(this.element.find(".ui-resizable-handle"));
            this._handles.disableSelection();

            this._handles.on("mouseover", function () {
                if (!that.resizing) {
                    if (this.className) {
                        axis = this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);
                    }
                    that.axis = axis && axis[1] ? axis[1] : "se";
                }
            });

            if (o.autoHide) {
                this._handles.hide();
                this._addClass("ui-resizable-autohide");
            }
        },

        _removeHandles: function () {
            this._handles.remove();
        },

        _mouseCapture: function (event) {
            var i, handle,
                capture = false;

            for (i in this.handles) {
                handle = $(this.handles[i])[0];
                if (handle === event.target || $.contains(handle, event.target)) {
                    capture = true;
                }
            }

            return !this.options.disabled && capture;
        },

        _mouseStart: function (event) {

            var curleft, curtop, cursor,
                o = this.options,
                el = this.element;

            this.resizing = true;

            this._renderProxy();

            curleft = this._num(this.helper.css("left"));
            curtop = this._num(this.helper.css("top"));

            if (o.containment) {
                curleft += $(o.containment).scrollLeft() || 0;
                curtop += $(o.containment).scrollTop() || 0;
            }

            this.offset = this.helper.offset();
            this.position = {left: curleft, top: curtop};

            this.size = this._helper ? {
                width: this.helper.width(),
                height: this.helper.height()
            } : {
                width: el.width(),
                height: el.height()
            };

            this.originalSize = this._helper ? {
                width: el.outerWidth(),
                height: el.outerHeight()
            } : {
                width: el.width(),
                height: el.height()
            };

            this.sizeDiff = {
                width: el.outerWidth() - el.width(),
                height: el.outerHeight() - el.height()
            };

            this.originalPosition = {left: curleft, top: curtop};
            this.originalMousePosition = {left: event.pageX, top: event.pageY};

            this.aspectRatio = (typeof o.aspectRatio === "number") ?
                o.aspectRatio :
                ((this.originalSize.width / this.originalSize.height) || 1);

            cursor = $(".ui-resizable-" + this.axis).css("cursor");
            $("body").css("cursor", cursor === "auto" ? this.axis + "-resize" : cursor);

            this._addClass("ui-resizable-resizing");
            this._propagate("start", event);
            return true;
        },

        _mouseDrag: function (event) {

            var data, props,
                smp = this.originalMousePosition,
                a = this.axis,
                dx = (event.pageX - smp.left) || 0,
                dy = (event.pageY - smp.top) || 0,
                trigger = this._change[a];

            this._updatePrevProperties();

            if (!trigger) {
                return false;
            }

            data = trigger.apply(this, [event, dx, dy]);

            this._updateVirtualBoundaries(event.shiftKey);
            if (this._aspectRatio || event.shiftKey) {
                data = this._updateRatio(data, event);
            }

            data = this._respectSize(data, event);

            this._updateCache(data);

            this._propagate("resize", event);

            props = this._applyChanges();

            if (!this._helper && this._proportionallyResizeElements.length) {
                this._proportionallyResize();
            }

            if (!$.isEmptyObject(props)) {
                this._updatePrevProperties();
                this._trigger("resize", event, this.ui());
                this._applyChanges();
            }

            return false;
        },

        _mouseStop: function (event) {

            this.resizing = false;
            var pr, ista, soffseth, soffsetw, s, left, top,
                o = this.options, that = this;

            if (this._helper) {

                pr = this._proportionallyResizeElements;
                ista = pr.length && (/textarea/i).test(pr[0].nodeName);
                soffseth = ista && this._hasScroll(pr[0], "left") ? 0 : that.sizeDiff.height;
                soffsetw = ista ? 0 : that.sizeDiff.width;

                s = {
                    width: (that.helper.width() - soffsetw),
                    height: (that.helper.height() - soffseth)
                };
                left = (parseFloat(that.element.css("left")) +
                    (that.position.left - that.originalPosition.left)) || null;
                top = (parseFloat(that.element.css("top")) +
                    (that.position.top - that.originalPosition.top)) || null;

                if (!o.animate) {
                    this.element.css($.extend(s, {top: top, left: left}));
                }

                that.helper.height(that.size.height);
                that.helper.width(that.size.width);

                if (this._helper && !o.animate) {
                    this._proportionallyResize();
                }
            }

            $("body").css("cursor", "auto");

            this._removeClass("ui-resizable-resizing");

            this._propagate("stop", event);

            if (this._helper) {
                this.helper.remove();
            }

            return false;

        },

        _updatePrevProperties: function () {
            this.prevPosition = {
                top: this.position.top,
                left: this.position.left
            };
            this.prevSize = {
                width: this.size.width,
                height: this.size.height
            };
        },

        _applyChanges: function () {
            var props = {};

            if (this.position.top !== this.prevPosition.top) {
                props.top = this.position.top + "px";
            }
            if (this.position.left !== this.prevPosition.left) {
                props.left = this.position.left + "px";
            }
            if (this.size.width !== this.prevSize.width) {
                props.width = this.size.width + "px";
            }
            if (this.size.height !== this.prevSize.height) {
                props.height = this.size.height + "px";
            }

            this.helper.css(props);

            return props;
        },

        _updateVirtualBoundaries: function (forceAspectRatio) {
            var pMinWidth, pMaxWidth, pMinHeight, pMaxHeight, b,
                o = this.options;

            b = {
                minWidth: this._isNumber(o.minWidth) ? o.minWidth : 0,
                maxWidth: this._isNumber(o.maxWidth) ? o.maxWidth : Infinity,
                minHeight: this._isNumber(o.minHeight) ? o.minHeight : 0,
                maxHeight: this._isNumber(o.maxHeight) ? o.maxHeight : Infinity
            };

            if (this._aspectRatio || forceAspectRatio) {
                pMinWidth = b.minHeight * this.aspectRatio;
                pMinHeight = b.minWidth / this.aspectRatio;
                pMaxWidth = b.maxHeight * this.aspectRatio;
                pMaxHeight = b.maxWidth / this.aspectRatio;

                if (pMinWidth > b.minWidth) {
                    b.minWidth = pMinWidth;
                }
                if (pMinHeight > b.minHeight) {
                    b.minHeight = pMinHeight;
                }
                if (pMaxWidth < b.maxWidth) {
                    b.maxWidth = pMaxWidth;
                }
                if (pMaxHeight < b.maxHeight) {
                    b.maxHeight = pMaxHeight;
                }
            }
            this._vBoundaries = b;
        },

        _updateCache: function (data) {
            this.offset = this.helper.offset();
            if (this._isNumber(data.left)) {
                this.position.left = data.left;
            }
            if (this._isNumber(data.top)) {
                this.position.top = data.top;
            }
            if (this._isNumber(data.height)) {
                this.size.height = data.height;
            }
            if (this._isNumber(data.width)) {
                this.size.width = data.width;
            }
        },

        _updateRatio: function (data) {

            var cpos = this.position,
                csize = this.size,
                a = this.axis;

            if (this._isNumber(data.height)) {
                data.width = (data.height * this.aspectRatio);
            } else if (this._isNumber(data.width)) {
                data.height = (data.width / this.aspectRatio);
            }

            if (a === "sw") {
                data.left = cpos.left + (csize.width - data.width);
                data.top = null;
            }
            if (a === "nw") {
                data.top = cpos.top + (csize.height - data.height);
                data.left = cpos.left + (csize.width - data.width);
            }

            return data;
        },

        _respectSize: function (data) {

            var o = this._vBoundaries,
                a = this.axis,
                ismaxw = this._isNumber(data.width) && o.maxWidth && (o.maxWidth < data.width),
                ismaxh = this._isNumber(data.height) && o.maxHeight && (o.maxHeight < data.height),
                isminw = this._isNumber(data.width) && o.minWidth && (o.minWidth > data.width),
                isminh = this._isNumber(data.height) && o.minHeight && (o.minHeight > data.height),
                dw = this.originalPosition.left + this.originalSize.width,
                dh = this.originalPosition.top + this.originalSize.height,
                cw = /sw|nw|w/.test(a), ch = /nw|ne|n/.test(a);
            if (isminw) {
                data.width = o.minWidth;
            }
            if (isminh) {
                data.height = o.minHeight;
            }
            if (ismaxw) {
                data.width = o.maxWidth;
            }
            if (ismaxh) {
                data.height = o.maxHeight;
            }

            if (isminw && cw) {
                data.left = dw - o.minWidth;
            }
            if (ismaxw && cw) {
                data.left = dw - o.maxWidth;
            }
            if (isminh && ch) {
                data.top = dh - o.minHeight;
            }
            if (ismaxh && ch) {
                data.top = dh - o.maxHeight;
            }

            // Fixing jump error on top/left - bug #2330
            if (!data.width && !data.height && !data.left && data.top) {
                data.top = null;
            } else if (!data.width && !data.height && !data.top && data.left) {
                data.left = null;
            }

            return data;
        },

        _getPaddingPlusBorderDimensions: function (element) {
            var i = 0,
                widths = [],
                borders = [
                    element.css("borderTopWidth"),
                    element.css("borderRightWidth"),
                    element.css("borderBottomWidth"),
                    element.css("borderLeftWidth")
                ],
                paddings = [
                    element.css("paddingTop"),
                    element.css("paddingRight"),
                    element.css("paddingBottom"),
                    element.css("paddingLeft")
                ];

            for (; i < 4; i++) {
                widths[i] = (parseFloat(borders[i]) || 0);
                widths[i] += (parseFloat(paddings[i]) || 0);
            }

            return {
                height: widths[0] + widths[2],
                width: widths[1] + widths[3]
            };
        },

        _proportionallyResize: function () {

            if (!this._proportionallyResizeElements.length) {
                return;
            }

            var prel,
                i = 0,
                element = this.helper || this.element;

            for (; i < this._proportionallyResizeElements.length; i++) {

                prel = this._proportionallyResizeElements[i];

                // TODO: Seems like a bug to cache this.outerDimensions
                // considering that we are in a loop.
                if (!this.outerDimensions) {
                    this.outerDimensions = this._getPaddingPlusBorderDimensions(prel);
                }

                prel.css({
                    height: (element.height() - this.outerDimensions.height) || 0,
                    width: (element.width() - this.outerDimensions.width) || 0
                });

            }

        },

        _renderProxy: function () {

            var el = this.element, o = this.options;
            this.elementOffset = el.offset();

            if (this._helper) {

                this.helper = this.helper || $("<div style='overflow:hidden;'></div>");

                this._addClass(this.helper, this._helper);
                this.helper.css({
                    width: this.element.outerWidth(),
                    height: this.element.outerHeight(),
                    position: "absolute",
                    left: this.elementOffset.left + "px",
                    top: this.elementOffset.top + "px",
                    zIndex: ++o.zIndex //TODO: Don't modify option
                });

                this.helper
                    .appendTo("body")
                    .disableSelection();

            } else {
                this.helper = this.element;
            }

        },

        _change: {
            e: function (event, dx) {
                return {width: this.originalSize.width + dx};
            },
            w: function (event, dx) {
                var cs = this.originalSize, sp = this.originalPosition;
                return {left: sp.left + dx, width: cs.width - dx};
            },
            n: function (event, dx, dy) {
                var cs = this.originalSize, sp = this.originalPosition;
                return {top: sp.top + dy, height: cs.height - dy};
            },
            s: function (event, dx, dy) {
                return {height: this.originalSize.height + dy};
            },
            se: function (event, dx, dy) {
                return $.extend(this._change.s.apply(this, arguments),
                    this._change.e.apply(this, [event, dx, dy]));
            },
            sw: function (event, dx, dy) {
                return $.extend(this._change.s.apply(this, arguments),
                    this._change.w.apply(this, [event, dx, dy]));
            },
            ne: function (event, dx, dy) {
                return $.extend(this._change.n.apply(this, arguments),
                    this._change.e.apply(this, [event, dx, dy]));
            },
            nw: function (event, dx, dy) {
                return $.extend(this._change.n.apply(this, arguments),
                    this._change.w.apply(this, [event, dx, dy]));
            }
        },

        _propagate: function (n, event) {
            $.ui.plugin.call(this, n, [event, this.ui()]);
            (n !== "resize" && this._trigger(n, event, this.ui()));
        },

        plugins: {},

        ui: function () {
            return {
                originalElement: this.originalElement,
                element: this.element,
                helper: this.helper,
                position: this.position,
                size: this.size,
                originalSize: this.originalSize,
                originalPosition: this.originalPosition
            };
        }

    });

    /*
 * Resizable Extensions
 */

    $.ui.plugin.add("resizable", "animate", {

        stop: function (event) {
            var that = $(this).resizable("instance"),
                o = that.options,
                pr = that._proportionallyResizeElements,
                ista = pr.length && (/textarea/i).test(pr[0].nodeName),
                soffseth = ista && that._hasScroll(pr[0], "left") ? 0 : that.sizeDiff.height,
                soffsetw = ista ? 0 : that.sizeDiff.width,
                style = {
                    width: (that.size.width - soffsetw),
                    height: (that.size.height - soffseth)
                },
                left = (parseFloat(that.element.css("left")) +
                    (that.position.left - that.originalPosition.left)) || null,
                top = (parseFloat(that.element.css("top")) +
                    (that.position.top - that.originalPosition.top)) || null;

            that.element.animate(
                $.extend(style, top && left ? {top: top, left: left} : {}), {
                    duration: o.animateDuration,
                    easing: o.animateEasing,
                    step: function () {

                        var data = {
                            width: parseFloat(that.element.css("width")),
                            height: parseFloat(that.element.css("height")),
                            top: parseFloat(that.element.css("top")),
                            left: parseFloat(that.element.css("left"))
                        };

                        if (pr && pr.length) {
                            $(pr[0]).css({width: data.width, height: data.height});
                        }

                        // Propagating resize, and updating values for each animation step
                        that._updateCache(data);
                        that._propagate("resize", event);

                    }
                }
            );
        }

    });

    $.ui.plugin.add("resizable", "containment", {

        start: function () {
            var element, p, co, ch, cw, width, height,
                that = $(this).resizable("instance"),
                o = that.options,
                el = that.element,
                oc = o.containment,
                ce = (oc instanceof $) ?
                    oc.get(0) :
                    (/parent/.test(oc)) ? el.parent().get(0) : oc;

            if (!ce) {
                return;
            }

            that.containerElement = $(ce);

            if (/document/.test(oc) || oc === document) {
                that.containerOffset = {
                    left: 0,
                    top: 0
                };
                that.containerPosition = {
                    left: 0,
                    top: 0
                };

                that.parentData = {
                    element: $(document),
                    left: 0,
                    top: 0,
                    width: $(document).width(),
                    height: $(document).height() || document.body.parentNode.scrollHeight
                };
            } else {
                element = $(ce);
                p = [];
                $(["Top", "Right", "Left", "Bottom"]).each(function (i, name) {
                    p[i] = that._num(element.css("padding" + name));
                });

                that.containerOffset = element.offset();
                that.containerPosition = element.position();
                that.containerSize = {
                    height: (element.innerHeight() - p[3]),
                    width: (element.innerWidth() - p[1])
                };

                co = that.containerOffset;
                ch = that.containerSize.height;
                cw = that.containerSize.width;
                width = (that._hasScroll(ce, "left") ? ce.scrollWidth : cw);
                height = (that._hasScroll(ce) ? ce.scrollHeight : ch);

                that.parentData = {
                    element: ce,
                    left: co.left,
                    top: co.top,
                    width: width,
                    height: height
                };
            }
        },

        resize: function (event) {
            var woset, hoset, isParent, isOffsetRelative,
                that = $(this).resizable("instance"),
                o = that.options,
                co = that.containerOffset,
                cp = that.position,
                pRatio = that._aspectRatio || event.shiftKey,
                cop = {
                    top: 0,
                    left: 0
                },
                ce = that.containerElement,
                continueResize = true;

            if (ce[0] !== document && (/static/).test(ce.css("position"))) {
                cop = co;
            }

            if (cp.left < (that._helper ? co.left : 0)) {
                that.size.width = that.size.width +
                    (that._helper ?
                        (that.position.left - co.left) :
                        (that.position.left - cop.left));

                if (pRatio) {
                    that.size.height = that.size.width / that.aspectRatio;
                    continueResize = false;
                }
                that.position.left = o.helper ? co.left : 0;
            }

            if (cp.top < (that._helper ? co.top : 0)) {
                that.size.height = that.size.height +
                    (that._helper ?
                        (that.position.top - co.top) :
                        that.position.top);

                if (pRatio) {
                    that.size.width = that.size.height * that.aspectRatio;
                    continueResize = false;
                }
                that.position.top = that._helper ? co.top : 0;
            }

            isParent = that.containerElement.get(0) === that.element.parent().get(0);
            isOffsetRelative = /relative|absolute/.test(that.containerElement.css("position"));

            if (isParent && isOffsetRelative) {
                that.offset.left = that.parentData.left + that.position.left;
                that.offset.top = that.parentData.top + that.position.top;
            } else {
                that.offset.left = that.element.offset().left;
                that.offset.top = that.element.offset().top;
            }

            woset = Math.abs(that.sizeDiff.width +
                (that._helper ?
                    that.offset.left - cop.left :
                    (that.offset.left - co.left)));

            hoset = Math.abs(that.sizeDiff.height +
                (that._helper ?
                    that.offset.top - cop.top :
                    (that.offset.top - co.top)));

            if (woset + that.size.width >= that.parentData.width) {
                that.size.width = that.parentData.width - woset;
                if (pRatio) {
                    that.size.height = that.size.width / that.aspectRatio;
                    continueResize = false;
                }
            }

            if (hoset + that.size.height >= that.parentData.height) {
                that.size.height = that.parentData.height - hoset;
                if (pRatio) {
                    that.size.width = that.size.height * that.aspectRatio;
                    continueResize = false;
                }
            }

            if (!continueResize) {
                that.position.left = that.prevPosition.left;
                that.position.top = that.prevPosition.top;
                that.size.width = that.prevSize.width;
                that.size.height = that.prevSize.height;
            }
        },

        stop: function () {
            var that = $(this).resizable("instance"),
                o = that.options,
                co = that.containerOffset,
                cop = that.containerPosition,
                ce = that.containerElement,
                helper = $(that.helper),
                ho = helper.offset(),
                w = helper.outerWidth() - that.sizeDiff.width,
                h = helper.outerHeight() - that.sizeDiff.height;

            if (that._helper && !o.animate && (/relative/).test(ce.css("position"))) {
                $(this).css({
                    left: ho.left - cop.left - co.left,
                    width: w,
                    height: h
                });
            }

            if (that._helper && !o.animate && (/static/).test(ce.css("position"))) {
                $(this).css({
                    left: ho.left - cop.left - co.left,
                    width: w,
                    height: h
                });
            }
        }
    });

    $.ui.plugin.add("resizable", "alsoResize", {

        start: function () {
            var that = $(this).resizable("instance"),
                o = that.options;

            $(o.alsoResize).each(function () {
                var el = $(this);
                el.data("ui-resizable-alsoresize", {
                    width: parseFloat(el.width()), height: parseFloat(el.height()),
                    left: parseFloat(el.css("left")), top: parseFloat(el.css("top"))
                });
            });
        },

        resize: function (event, ui) {
            var that = $(this).resizable("instance"),
                o = that.options,
                os = that.originalSize,
                op = that.originalPosition,
                delta = {
                    height: (that.size.height - os.height) || 0,
                    width: (that.size.width - os.width) || 0,
                    top: (that.position.top - op.top) || 0,
                    left: (that.position.left - op.left) || 0
                };

            $(o.alsoResize).each(function () {
                var el = $(this), start = $(this).data("ui-resizable-alsoresize"), style = {},
                    css = el.parents(ui.originalElement[0]).length ?
                        ["width", "height"] :
                        ["width", "height", "top", "left"];

                $.each(css, function (i, prop) {
                    var sum = (start[prop] || 0) + (delta[prop] || 0);
                    if (sum && sum >= 0) {
                        style[prop] = sum || null;
                    }
                });

                el.css(style);
            });
        },

        stop: function () {
            $(this).removeData("ui-resizable-alsoresize");
        }
    });

    $.ui.plugin.add("resizable", "ghost", {

        start: function () {

            var that = $(this).resizable("instance"), cs = that.size;

            that.ghost = that.originalElement.clone();
            that.ghost.css({
                opacity: 0.25,
                display: "block",
                position: "relative",
                height: cs.height,
                width: cs.width,
                margin: 0,
                left: 0,
                top: 0
            });

            that._addClass(that.ghost, "ui-resizable-ghost");

            // DEPRECATED
            // TODO: remove after 1.12
            if ($.uiBackCompat !== false && typeof that.options.ghost === "string") {

                // Ghost option
                that.ghost.addClass(this.options.ghost);
            }

            that.ghost.appendTo(that.helper);

        },

        resize: function () {
            var that = $(this).resizable("instance");
            if (that.ghost) {
                that.ghost.css({
                    position: "relative",
                    height: that.size.height,
                    width: that.size.width
                });
            }
        },

        stop: function () {
            var that = $(this).resizable("instance");
            if (that.ghost && that.helper) {
                that.helper.get(0).removeChild(that.ghost.get(0));
            }
        }

    });

    $.ui.plugin.add("resizable", "grid", {

        resize: function () {
            var outerDimensions,
                that = $(this).resizable("instance"),
                o = that.options,
                cs = that.size,
                os = that.originalSize,
                op = that.originalPosition,
                a = that.axis,
                grid = typeof o.grid === "number" ? [o.grid, o.grid] : o.grid,
                gridX = (grid[0] || 1),
                gridY = (grid[1] || 1),
                ox = Math.round((cs.width - os.width) / gridX) * gridX,
                oy = Math.round((cs.height - os.height) / gridY) * gridY,
                newWidth = os.width + ox,
                newHeight = os.height + oy,
                isMaxWidth = o.maxWidth && (o.maxWidth < newWidth),
                isMaxHeight = o.maxHeight && (o.maxHeight < newHeight),
                isMinWidth = o.minWidth && (o.minWidth > newWidth),
                isMinHeight = o.minHeight && (o.minHeight > newHeight);

            o.grid = grid;

            if (isMinWidth) {
                newWidth += gridX;
            }
            if (isMinHeight) {
                newHeight += gridY;
            }
            if (isMaxWidth) {
                newWidth -= gridX;
            }
            if (isMaxHeight) {
                newHeight -= gridY;
            }

            if (/^(se|s|e)$/.test(a)) {
                that.size.width = newWidth;
                that.size.height = newHeight;
            } else if (/^(ne)$/.test(a)) {
                that.size.width = newWidth;
                that.size.height = newHeight;
                that.position.top = op.top - oy;
            } else if (/^(sw)$/.test(a)) {
                that.size.width = newWidth;
                that.size.height = newHeight;
                that.position.left = op.left - ox;
            } else {
                if (newHeight - gridY <= 0 || newWidth - gridX <= 0) {
                    outerDimensions = that._getPaddingPlusBorderDimensions(this);
                }

                if (newHeight - gridY > 0) {
                    that.size.height = newHeight;
                    that.position.top = op.top - oy;
                } else {
                    newHeight = gridY - outerDimensions.height;
                    that.size.height = newHeight;
                    that.position.top = op.top + os.height - newHeight;
                }
                if (newWidth - gridX > 0) {
                    that.size.width = newWidth;
                    that.position.left = op.left - ox;
                } else {
                    newWidth = gridX - outerDimensions.width;
                    that.size.width = newWidth;
                    that.position.left = op.left + os.width - newWidth;
                }
            }
        }

    });

    var widgetsResizable = $.ui.resizable;


    /*!
 * jQuery UI Dialog 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Dialog
//>>group: Widgets
//>>description: Displays customizable dialog windows.
//>>docs: http://api.jqueryui.com/dialog/
//>>demos: http://jqueryui.com/dialog/
//>>css.structure: ../../themes/base/core.css
//>>css.structure: ../../themes/base/dialog.css
//>>css.theme: ../../themes/base/theme.css


    $.widget("ui.dialog", {
        version: "1.12.1",
        options: {
            appendTo: "body",
            autoOpen: true,
            buttons: [],
            classes: {
                "ui-dialog": "ui-corner-all",
                "ui-dialog-titlebar": "ui-corner-all"
            },
            closeOnEscape: true,
            closeText: "Close",
            draggable: true,
            hide: null,
            height: "auto",
            maxHeight: null,
            maxWidth: null,
            minHeight: 150,
            minWidth: 150,
            modal: false,
            position: {
                my: "center",
                at: "center",
                of: window,
                collision: "fit",

                // Ensure the titlebar is always visible
                using: function (pos) {
                    var topOffset = $(this).css(pos).offset().top;
                    if (topOffset < 0) {
                        $(this).css("top", pos.top - topOffset);
                    }
                }
            },
            resizable: true,
            show: null,
            title: null,
            width: 300,

            // Callbacks
            beforeClose: null,
            close: null,
            drag: null,
            dragStart: null,
            dragStop: null,
            focus: null,
            open: null,
            resize: null,
            resizeStart: null,
            resizeStop: null
        },

        sizeRelatedOptions: {
            buttons: true,
            height: true,
            maxHeight: true,
            maxWidth: true,
            minHeight: true,
            minWidth: true,
            width: true
        },

        resizableRelatedOptions: {
            maxHeight: true,
            maxWidth: true,
            minHeight: true,
            minWidth: true
        },

        _create: function () {
            this.originalCss = {
                display: this.element[0].style.display,
                width: this.element[0].style.width,
                minHeight: this.element[0].style.minHeight,
                maxHeight: this.element[0].style.maxHeight,
                height: this.element[0].style.height
            };
            this.originalPosition = {
                parent: this.element.parent(),
                index: this.element.parent().children().index(this.element)
            };
            this.originalTitle = this.element.attr("title");
            if (this.options.title == null && this.originalTitle != null) {
                this.options.title = this.originalTitle;
            }

            // Dialogs can't be disabled
            if (this.options.disabled) {
                this.options.disabled = false;
            }

            this._createWrapper();

            this.element
                .show()
                .removeAttr("title")
                .appendTo(this.uiDialog);

            this._addClass("ui-dialog-content", "ui-widget-content");

            this._createTitlebar();
            this._createButtonPane();

            if (this.options.draggable && $.fn.draggable) {
                this._makeDraggable();
            }
            if (this.options.resizable && $.fn.resizable) {
                this._makeResizable();
            }

            this._isOpen = false;

            this._trackFocus();
        },

        _init: function () {
            if (this.options.autoOpen) {
                this.open();
            }
        },

        _appendTo: function () {
            var element = this.options.appendTo;
            if (element && (element.jquery || element.nodeType)) {
                return $(element);
            }
            return this.document.find(element || "body").eq(0);
        },

        _destroy: function () {
            var next,
                originalPosition = this.originalPosition;

            this._untrackInstance();
            this._destroyOverlay();

            this.element
                .removeUniqueId()
                .css(this.originalCss)

                // Without detaching first, the following becomes really slow
                .detach();

            this.uiDialog.remove();

            if (this.originalTitle) {
                this.element.attr("title", this.originalTitle);
            }

            next = originalPosition.parent.children().eq(originalPosition.index);

            // Don't try to place the dialog next to itself (#8613)
            if (next.length && next[0] !== this.element[0]) {
                next.before(this.element);
            } else {
                originalPosition.parent.append(this.element);
            }
        },

        widget: function () {
            return this.uiDialog;
        },

        disable: $.noop,
        enable: $.noop,

        close: function (event) {
            var that = this;

            if (!this._isOpen || this._trigger("beforeClose", event) === false) {
                return;
            }

            this._isOpen = false;
            this._focusedElement = null;
            this._destroyOverlay();
            this._untrackInstance();

            if (!this.opener.filter(":focusable").trigger("focus").length) {

                // Hiding a focused element doesn't trigger blur in WebKit
                // so in case we have nothing to focus on, explicitly blur the active element
                // https://bugs.webkit.org/show_bug.cgi?id=47182
                $.ui.safeBlur($.ui.safeActiveElement(this.document[0]));
            }

            this._hide(this.uiDialog, this.options.hide, function () {
                that._trigger("close", event);
            });
        },

        isOpen: function () {
            return this._isOpen;
        },

        moveToTop: function () {
            this._moveToTop();
        },

        _moveToTop: function (event, silent) {
            var moved = false,
                zIndices = this.uiDialog.siblings(".ui-front:visible").map(function () {
                    return +$(this).css("z-index");
                }).get(),
                zIndexMax = Math.max.apply(null, zIndices);

            if (zIndexMax >= +this.uiDialog.css("z-index")) {
                this.uiDialog.css("z-index", zIndexMax + 1);
                moved = true;
            }

            if (moved && !silent) {
                this._trigger("focus", event);
            }
            return moved;
        },

        open: function () {
            var that = this;
            if (this._isOpen) {
                if (this._moveToTop()) {
                    this._focusTabbable();
                }
                return;
            }

            this._isOpen = true;
            this.opener = $($.ui.safeActiveElement(this.document[0]));

            this._size();
            this._position();
            this._createOverlay();
            this._moveToTop(null, true);

            // Ensure the overlay is moved to the top with the dialog, but only when
            // opening. The overlay shouldn't move after the dialog is open so that
            // modeless dialogs opened after the modal dialog stack properly.
            if (this.overlay) {
                this.overlay.css("z-index", this.uiDialog.css("z-index") - 1);
            }

            this._show(this.uiDialog, this.options.show, function () {
                that._focusTabbable();
                that._trigger("focus");
            });

            // Track the dialog immediately upon openening in case a focus event
            // somehow occurs outside of the dialog before an element inside the
            // dialog is focused (#10152)
            this._makeFocusTarget();

            this._trigger("open");
        },

        _focusTabbable: function () {

            // Set focus to the first match:
            // 1. An element that was focused previously
            // 2. First element inside the dialog matching [autofocus]
            // 3. Tabbable element inside the content element
            // 4. Tabbable element inside the buttonpane
            // 5. The close button
            // 6. The dialog itself
            var hasFocus = this._focusedElement;
            if (!hasFocus) {
                hasFocus = this.element.find("[autofocus]");
            }
            if (!hasFocus.length) {
                hasFocus = this.element.find(":tabbable");
            }
            if (!hasFocus.length) {
                hasFocus = this.uiDialogButtonPane.find(":tabbable");
            }
            if (!hasFocus.length) {
                hasFocus = this.uiDialogTitlebarClose.filter(":tabbable");
            }
            if (!hasFocus.length) {
                hasFocus = this.uiDialog;
            }
            hasFocus.eq(0).trigger("focus");
        },

        _keepFocus: function (event) {
            function checkFocus() {
                var activeElement = $.ui.safeActiveElement(this.document[0]),
                    isActive = this.uiDialog[0] === activeElement ||
                        $.contains(this.uiDialog[0], activeElement);
                if (!isActive) {
                    this._focusTabbable();
                }
            }

            event.preventDefault();
            checkFocus.call(this);

            // support: IE
            // IE <= 8 doesn't prevent moving focus even with event.preventDefault()
            // so we check again later
            this._delay(checkFocus);
        },

        _createWrapper: function () {
            this.uiDialog = $("<div>")
                .hide()
                .attr({

                    // Setting tabIndex makes the div focusable
                    tabIndex: -1,
                    role: "dialog"
                })
                .appendTo(this._appendTo());

            this._addClass(this.uiDialog, "ui-dialog", "ui-widget ui-widget-content ui-front");
            this._on(this.uiDialog, {
                keydown: function (event) {
                    if (this.options.closeOnEscape && !event.isDefaultPrevented() && event.keyCode &&
                        event.keyCode === $.ui.keyCode.ESCAPE) {
                        event.preventDefault();
                        this.close(event);
                        return;
                    }

                    // Prevent tabbing out of dialogs
                    if (event.keyCode !== $.ui.keyCode.TAB || event.isDefaultPrevented()) {
                        return;
                    }
                    var tabbables = this.uiDialog.find(":tabbable"),
                        first = tabbables.filter(":first"),
                        last = tabbables.filter(":last");

                    if ((event.target === last[0] || event.target === this.uiDialog[0]) &&
                        !event.shiftKey) {
                        this._delay(function () {
                            first.trigger("focus");
                        });
                        event.preventDefault();
                    } else if ((event.target === first[0] ||
                        event.target === this.uiDialog[0]) && event.shiftKey) {
                        this._delay(function () {
                            last.trigger("focus");
                        });
                        event.preventDefault();
                    }
                },
                mousedown: function (event) {
                    if (this._moveToTop(event)) {
                        this._focusTabbable();
                    }
                }
            });

            // We assume that any existing aria-describedby attribute means
            // that the dialog content is marked up properly
            // otherwise we brute force the content as the description
            if (!this.element.find("[aria-describedby]").length) {
                this.uiDialog.attr({
                    "aria-describedby": this.element.uniqueId().attr("id")
                });
            }
        },

        _createTitlebar: function () {
            var uiDialogTitle;

            this.uiDialogTitlebar = $("<div>");
            this._addClass(this.uiDialogTitlebar,
                "ui-dialog-titlebar", "ui-widget-header ui-helper-clearfix");
            this._on(this.uiDialogTitlebar, {
                mousedown: function (event) {

                    // Don't prevent click on close button (#8838)
                    // Focusing a dialog that is partially scrolled out of view
                    // causes the browser to scroll it into view, preventing the click event
                    if (!$(event.target).closest(".ui-dialog-titlebar-close")) {

                        // Dialog isn't getting focus when dragging (#8063)
                        this.uiDialog.trigger("focus");
                    }
                }
            });

            // Support: IE
            // Use type="button" to prevent enter keypresses in textboxes from closing the
            // dialog in IE (#9312)
            this.uiDialogTitlebarClose = $("<button type='button'></button>")
                .button({
                    label: $("<a>").text(this.options.closeText).html(),
                    icon: "ui-icon-closethick",
                    showLabel: false
                })
                .appendTo(this.uiDialogTitlebar);

            this._addClass(this.uiDialogTitlebarClose, "ui-dialog-titlebar-close");
            this._on(this.uiDialogTitlebarClose, {
                click: function (event) {
                    event.preventDefault();
                    this.close(event);
                }
            });

            uiDialogTitle = $("<span>").uniqueId().prependTo(this.uiDialogTitlebar);
            this._addClass(uiDialogTitle, "ui-dialog-title");
            this._title(uiDialogTitle);

            this.uiDialogTitlebar.prependTo(this.uiDialog);

            this.uiDialog.attr({
                "aria-labelledby": uiDialogTitle.attr("id")
            });
        },

        _title: function (title) {
            if (this.options.title) {
                title.text(this.options.title);
            } else {
                title.html("&#160;");
            }
        },

        _createButtonPane: function () {
            this.uiDialogButtonPane = $("<div>");
            this._addClass(this.uiDialogButtonPane, "ui-dialog-buttonpane",
                "ui-widget-content ui-helper-clearfix");

            this.uiButtonSet = $("<div>")
                .appendTo(this.uiDialogButtonPane);
            this._addClass(this.uiButtonSet, "ui-dialog-buttonset");

            this._createButtons();
        },

        _createButtons: function () {
            var that = this,
                buttons = this.options.buttons;

            // If we already have a button pane, remove it
            this.uiDialogButtonPane.remove();
            this.uiButtonSet.empty();

            if ($.isEmptyObject(buttons) || ($.isArray(buttons) && !buttons.length)) {
                this._removeClass(this.uiDialog, "ui-dialog-buttons");
                return;
            }

            $.each(buttons, function (name, props) {
                var click, buttonOptions;
                props = $.isFunction(props) ?
                    {click: props, text: name} :
                    props;

                // Default to a non-submitting button
                props = $.extend({type: "button"}, props);

                // Change the context for the click callback to be the main element
                click = props.click;
                buttonOptions = {
                    icon: props.icon,
                    iconPosition: props.iconPosition,
                    showLabel: props.showLabel,

                    // Deprecated options
                    icons: props.icons,
                    text: props.text
                };

                delete props.click;
                delete props.icon;
                delete props.iconPosition;
                delete props.showLabel;

                // Deprecated options
                delete props.icons;
                if (typeof props.text === "boolean") {
                    delete props.text;
                }

                $("<button></button>", props)
                    .button(buttonOptions)
                    .appendTo(that.uiButtonSet)
                    .on("click", function () {
                        click.apply(that.element[0], arguments);
                    });
            });
            this._addClass(this.uiDialog, "ui-dialog-buttons");
            this.uiDialogButtonPane.appendTo(this.uiDialog);
        },

        _makeDraggable: function () {
            var that = this,
                options = this.options;

            function filteredUi(ui) {
                return {
                    position: ui.position,
                    offset: ui.offset
                };
            }

            this.uiDialog.draggable({
                cancel: ".ui-dialog-content, .ui-dialog-titlebar-close",
                handle: ".ui-dialog-titlebar",
                containment: "document",
                start: function (event, ui) {
                    that._addClass($(this), "ui-dialog-dragging");
                    that._blockFrames();
                    that._trigger("dragStart", event, filteredUi(ui));
                },
                drag: function (event, ui) {
                    that._trigger("drag", event, filteredUi(ui));
                },
                stop: function (event, ui) {
                    var left = ui.offset.left - that.document.scrollLeft(),
                        top = ui.offset.top - that.document.scrollTop();

                    options.position = {
                        my: "left top",
                        at: "left" + (left >= 0 ? "+" : "") + left + " " +
                            "top" + (top >= 0 ? "+" : "") + top,
                        of: that.window
                    };
                    that._removeClass($(this), "ui-dialog-dragging");
                    that._unblockFrames();
                    that._trigger("dragStop", event, filteredUi(ui));
                }
            });
        },

        _makeResizable: function () {
            var that = this,
                options = this.options,
                handles = options.resizable,

                // .ui-resizable has position: relative defined in the stylesheet
                // but dialogs have to use absolute or fixed positioning
                position = this.uiDialog.css("position"),
                resizeHandles = typeof handles === "string" ?
                    handles :
                    "n,e,s,w,se,sw,ne,nw";

            function filteredUi(ui) {
                return {
                    originalPosition: ui.originalPosition,
                    originalSize: ui.originalSize,
                    position: ui.position,
                    size: ui.size
                };
            }

            this.uiDialog.resizable({
                cancel: ".ui-dialog-content",
                containment: "document",
                alsoResize: this.element,
                maxWidth: options.maxWidth,
                maxHeight: options.maxHeight,
                minWidth: options.minWidth,
                minHeight: this._minHeight(),
                handles: resizeHandles,
                start: function (event, ui) {
                    that._addClass($(this), "ui-dialog-resizing");
                    that._blockFrames();
                    that._trigger("resizeStart", event, filteredUi(ui));
                },
                resize: function (event, ui) {
                    that._trigger("resize", event, filteredUi(ui));
                },
                stop: function (event, ui) {
                    var offset = that.uiDialog.offset(),
                        left = offset.left - that.document.scrollLeft(),
                        top = offset.top - that.document.scrollTop();

                    options.height = that.uiDialog.height();
                    options.width = that.uiDialog.width();
                    options.position = {
                        my: "left top",
                        at: "left" + (left >= 0 ? "+" : "") + left + " " +
                            "top" + (top >= 0 ? "+" : "") + top,
                        of: that.window
                    };
                    that._removeClass($(this), "ui-dialog-resizing");
                    that._unblockFrames();
                    that._trigger("resizeStop", event, filteredUi(ui));
                }
            })
                .css("position", position);
        },

        _trackFocus: function () {
            this._on(this.widget(), {
                focusin: function (event) {
                    this._makeFocusTarget();
                    this._focusedElement = $(event.target);
                }
            });
        },

        _makeFocusTarget: function () {
            this._untrackInstance();
            this._trackingInstances().unshift(this);
        },

        _untrackInstance: function () {
            var instances = this._trackingInstances(),
                exists = $.inArray(this, instances);
            if (exists !== -1) {
                instances.splice(exists, 1);
            }
        },

        _trackingInstances: function () {
            var instances = this.document.data("ui-dialog-instances");
            if (!instances) {
                instances = [];
                this.document.data("ui-dialog-instances", instances);
            }
            return instances;
        },

        _minHeight: function () {
            var options = this.options;

            return options.height === "auto" ?
                options.minHeight :
                Math.min(options.minHeight, options.height);
        },

        _position: function () {

            // Need to show the dialog to get the actual offset in the position plugin
            var isVisible = this.uiDialog.is(":visible");
            if (!isVisible) {
                this.uiDialog.show();
            }
            this.uiDialog.position(this.options.position);
            if (!isVisible) {
                this.uiDialog.hide();
            }
        },

        _setOptions: function (options) {
            var that = this,
                resize = false,
                resizableOptions = {};

            $.each(options, function (key, value) {
                that._setOption(key, value);

                if (key in that.sizeRelatedOptions) {
                    resize = true;
                }
                if (key in that.resizableRelatedOptions) {
                    resizableOptions[key] = value;
                }
            });

            if (resize) {
                this._size();
                this._position();
            }
            if (this.uiDialog.is(":data(ui-resizable)")) {
                this.uiDialog.resizable("option", resizableOptions);
            }
        },

        _setOption: function (key, value) {
            var isDraggable, isResizable,
                uiDialog = this.uiDialog;

            if (key === "disabled") {
                return;
            }

            this._super(key, value);

            if (key === "appendTo") {
                this.uiDialog.appendTo(this._appendTo());
            }

            if (key === "buttons") {
                this._createButtons();
            }

            if (key === "closeText") {
                this.uiDialogTitlebarClose.button({

                    // Ensure that we always pass a string
                    label: $("<a>").text("" + this.options.closeText).html()
                });
            }

            if (key === "draggable") {
                isDraggable = uiDialog.is(":data(ui-draggable)");
                if (isDraggable && !value) {
                    uiDialog.draggable("destroy");
                }

                if (!isDraggable && value) {
                    this._makeDraggable();
                }
            }

            if (key === "position") {
                this._position();
            }

            if (key === "resizable") {

                // currently resizable, becoming non-resizable
                isResizable = uiDialog.is(":data(ui-resizable)");
                if (isResizable && !value) {
                    uiDialog.resizable("destroy");
                }

                // Currently resizable, changing handles
                if (isResizable && typeof value === "string") {
                    uiDialog.resizable("option", "handles", value);
                }

                // Currently non-resizable, becoming resizable
                if (!isResizable && value !== false) {
                    this._makeResizable();
                }
            }

            if (key === "title") {
                this._title(this.uiDialogTitlebar.find(".ui-dialog-title"));
            }
        },

        _size: function () {

            // If the user has resized the dialog, the .ui-dialog and .ui-dialog-content
            // divs will both have width and height set, so we need to reset them
            var nonContentHeight, minContentHeight, maxContentHeight,
                options = this.options;

            // Reset content sizing
            this.element.show().css({
                width: "auto",
                minHeight: 0,
                maxHeight: "none",
                height: 0
            });

            if (options.minWidth > options.width) {
                options.width = options.minWidth;
            }

            // Reset wrapper sizing
            // determine the height of all the non-content elements
            nonContentHeight = this.uiDialog.css({
                height: "auto",
                width: options.width
            })
                .outerHeight();
            minContentHeight = Math.max(0, options.minHeight - nonContentHeight);
            maxContentHeight = typeof options.maxHeight === "number" ?
                Math.max(0, options.maxHeight - nonContentHeight) :
                "none";

            if (options.height === "auto") {
                this.element.css({
                    minHeight: minContentHeight,
                    maxHeight: maxContentHeight,
                    height: "auto"
                });
            } else {
                this.element.height(Math.max(0, options.height - nonContentHeight));
            }

            if (this.uiDialog.is(":data(ui-resizable)")) {
                this.uiDialog.resizable("option", "minHeight", this._minHeight());
            }
        },

        _blockFrames: function () {
            this.iframeBlocks = this.document.find("iframe").map(function () {
                var iframe = $(this);

                return $("<div>")
                    .css({
                        position: "absolute",
                        width: iframe.outerWidth(),
                        height: iframe.outerHeight()
                    })
                    .appendTo(iframe.parent())
                    .offset(iframe.offset())[0];
            });
        },

        _unblockFrames: function () {
            if (this.iframeBlocks) {
                this.iframeBlocks.remove();
                delete this.iframeBlocks;
            }
        },

        _allowInteraction: function (event) {
            if ($(event.target).closest(".ui-dialog").length) {
                return true;
            }

            // TODO: Remove hack when datepicker implements
            // the .ui-front logic (#8989)
            return !!$(event.target).closest(".ui-datepicker").length;
        },

        _createOverlay: function () {
            if (!this.options.modal) {
                return;
            }

            // We use a delay in case the overlay is created from an
            // event that we're going to be cancelling (#2804)
            var isOpening = true;
            this._delay(function () {
                isOpening = false;
            });

            if (!this.document.data("ui-dialog-overlays")) {

                // Prevent use of anchors and inputs
                // Using _on() for an event handler shared across many instances is
                // safe because the dialogs stack and must be closed in reverse order
                this._on(this.document, {
                    focusin: function (event) {
                        if (isOpening) {
                            return;
                        }

                        if (!this._allowInteraction(event)) {
                            event.preventDefault();
                            this._trackingInstances()[0]._focusTabbable();
                        }
                    }
                });
            }

            this.overlay = $("<div>")
                .appendTo(this._appendTo());

            this._addClass(this.overlay, null, "ui-widget-overlay ui-front");
            this._on(this.overlay, {
                mousedown: "_keepFocus"
            });
            this.document.data("ui-dialog-overlays",
                (this.document.data("ui-dialog-overlays") || 0) + 1);
        },

        _destroyOverlay: function () {
            if (!this.options.modal) {
                return;
            }

            if (this.overlay) {
                var overlays = this.document.data("ui-dialog-overlays") - 1;

                if (!overlays) {
                    this._off(this.document, "focusin");
                    this.document.removeData("ui-dialog-overlays");
                } else {
                    this.document.data("ui-dialog-overlays", overlays);
                }

                this.overlay.remove();
                this.overlay = null;
            }
        }
    });

// DEPRECATED
// TODO: switch return back to widget declaration at top of file when this is removed
    if ($.uiBackCompat !== false) {

        // Backcompat for dialogClass option
        $.widget("ui.dialog", $.ui.dialog, {
            options: {
                dialogClass: ""
            },
            _createWrapper: function () {
                this._super();
                this.uiDialog.addClass(this.options.dialogClass);
            },
            _setOption: function (key, value) {
                if (key === "dialogClass") {
                    this.uiDialog
                        .removeClass(this.options.dialogClass)
                        .addClass(value);
                }
                this._superApply(arguments);
            }
        });
    }

    var widgetsDialog = $.ui.dialog;


    /*!
 * jQuery UI Droppable 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Droppable
//>>group: Interactions
//>>description: Enables drop targets for draggable elements.
//>>docs: http://api.jqueryui.com/droppable/
//>>demos: http://jqueryui.com/droppable/


    $.widget("ui.droppable", {
        version: "1.12.1",
        widgetEventPrefix: "drop",
        options: {
            accept: "*",
            addClasses: true,
            greedy: false,
            scope: "default",
            tolerance: "intersect",

            // Callbacks
            activate: null,
            deactivate: null,
            drop: null,
            out: null,
            over: null
        },
        _create: function () {

            var proportions,
                o = this.options,
                accept = o.accept;

            this.isover = false;
            this.isout = true;

            this.accept = $.isFunction(accept) ? accept : function (d) {
                return d.is(accept);
            };

            this.proportions = function (/* valueToWrite */) {
                if (arguments.length) {

                    // Store the droppable's proportions
                    proportions = arguments[0];
                } else {

                    // Retrieve or derive the droppable's proportions
                    return proportions ?
                        proportions :
                        proportions = {
                            width: this.element[0].offsetWidth,
                            height: this.element[0].offsetHeight
                        };
                }
            };

            this._addToManager(o.scope);

            o.addClasses && this._addClass("ui-droppable");

        },

        _addToManager: function (scope) {

            // Add the reference and positions to the manager
            $.ui.ddmanager.droppables[scope] = $.ui.ddmanager.droppables[scope] || [];
            $.ui.ddmanager.droppables[scope].push(this);
        },

        _splice: function (drop) {
            var i = 0;
            for (; i < drop.length; i++) {
                if (drop[i] === this) {
                    drop.splice(i, 1);
                }
            }
        },

        _destroy: function () {
            var drop = $.ui.ddmanager.droppables[this.options.scope];

            this._splice(drop);
        },

        _setOption: function (key, value) {

            if (key === "accept") {
                this.accept = $.isFunction(value) ? value : function (d) {
                    return d.is(value);
                };
            } else if (key === "scope") {
                var drop = $.ui.ddmanager.droppables[this.options.scope];

                this._splice(drop);
                this._addToManager(value);
            }

            this._super(key, value);
        },

        _activate: function (event) {
            var draggable = $.ui.ddmanager.current;

            this._addActiveClass();
            if (draggable) {
                this._trigger("activate", event, this.ui(draggable));
            }
        },

        _deactivate: function (event) {
            var draggable = $.ui.ddmanager.current;

            this._removeActiveClass();
            if (draggable) {
                this._trigger("deactivate", event, this.ui(draggable));
            }
        },

        _over: function (event) {

            var draggable = $.ui.ddmanager.current;

            // Bail if draggable and droppable are same element
            if (!draggable || (draggable.currentItem ||
                draggable.element)[0] === this.element[0]) {
                return;
            }

            if (this.accept.call(this.element[0], (draggable.currentItem ||
                draggable.element))) {
                this._addHoverClass();
                this._trigger("over", event, this.ui(draggable));
            }

        },

        _out: function (event) {

            var draggable = $.ui.ddmanager.current;

            // Bail if draggable and droppable are same element
            if (!draggable || (draggable.currentItem ||
                draggable.element)[0] === this.element[0]) {
                return;
            }

            if (this.accept.call(this.element[0], (draggable.currentItem ||
                draggable.element))) {
                this._removeHoverClass();
                this._trigger("out", event, this.ui(draggable));
            }

        },

        _drop: function (event, custom) {

            var draggable = custom || $.ui.ddmanager.current,
                childrenIntersection = false;

            // Bail if draggable and droppable are same element
            if (!draggable || (draggable.currentItem ||
                draggable.element)[0] === this.element[0]) {
                return false;
            }

            this.element
                .find(":data(ui-droppable)")
                .not(".ui-draggable-dragging")
                .each(function () {
                    var inst = $(this).droppable("instance");
                    if (
                        inst.options.greedy &&
                        !inst.options.disabled &&
                        inst.options.scope === draggable.options.scope &&
                        inst.accept.call(
                            inst.element[0], (draggable.currentItem || draggable.element)
                        ) &&
                        intersect(
                            draggable,
                            $.extend(inst, {offset: inst.element.offset()}),
                            inst.options.tolerance, event
                        )
                    ) {
                        childrenIntersection = true;
                        return false;
                    }
                });
            if (childrenIntersection) {
                return false;
            }

            if (this.accept.call(this.element[0],
                (draggable.currentItem || draggable.element))) {
                this._removeActiveClass();
                this._removeHoverClass();

                this._trigger("drop", event, this.ui(draggable));
                return this.element;
            }

            return false;

        },

        ui: function (c) {
            return {
                draggable: (c.currentItem || c.element),
                helper: c.helper,
                position: c.position,
                offset: c.positionAbs
            };
        },

        // Extension points just to make backcompat sane and avoid duplicating logic
        // TODO: Remove in 1.13 along with call to it below
        _addHoverClass: function () {
            this._addClass("ui-droppable-hover");
        },

        _removeHoverClass: function () {
            this._removeClass("ui-droppable-hover");
        },

        _addActiveClass: function () {
            this._addClass("ui-droppable-active");
        },

        _removeActiveClass: function () {
            this._removeClass("ui-droppable-active");
        }
    });

    var intersect = $.ui.intersect = (function () {
        function isOverAxis(x, reference, size) {
            return (x >= reference) && (x < (reference + size));
        }

        return function (draggable, droppable, toleranceMode, event) {

            if (!droppable.offset) {
                return false;
            }

            var x1 = (draggable.positionAbs ||
                draggable.position.absolute).left + draggable.margins.left,
                y1 = (draggable.positionAbs ||
                    draggable.position.absolute).top + draggable.margins.top,
                x2 = x1 + draggable.helperProportions.width,
                y2 = y1 + draggable.helperProportions.height,
                l = droppable.offset.left,
                t = droppable.offset.top,
                r = l + droppable.proportions().width,
                b = t + droppable.proportions().height;

            switch (toleranceMode) {
                case "fit":
                    return (l <= x1 && x2 <= r && t <= y1 && y2 <= b);
                case "intersect":
                    return (l < x1 + (draggable.helperProportions.width / 2) && // Right Half
                        x2 - (draggable.helperProportions.width / 2) < r && // Left Half
                        t < y1 + (draggable.helperProportions.height / 2) && // Bottom Half
                        y2 - (draggable.helperProportions.height / 2) < b); // Top Half
                case "pointer":
                    return isOverAxis(event.pageY, t, droppable.proportions().height) &&
                        isOverAxis(event.pageX, l, droppable.proportions().width);
                case "touch":
                    return (
                        (y1 >= t && y1 <= b) || // Top edge touching
                        (y2 >= t && y2 <= b) || // Bottom edge touching
                        (y1 < t && y2 > b) // Surrounded vertically
                    ) && (
                        (x1 >= l && x1 <= r) || // Left edge touching
                        (x2 >= l && x2 <= r) || // Right edge touching
                        (x1 < l && x2 > r) // Surrounded horizontally
                    );
                default:
                    return false;
            }
        };
    })();

    /*
	This manager tracks offsets of draggables and droppables
*/
    $.ui.ddmanager = {
        current: null,
        droppables: {"default": []},
        prepareOffsets: function (t, event) {

            var i, j,
                m = $.ui.ddmanager.droppables[t.options.scope] || [],
                type = event ? event.type : null, // workaround for #2317
                list = (t.currentItem || t.element).find(":data(ui-droppable)").addBack();

            droppablesLoop: for (i = 0; i < m.length; i++) {

                // No disabled and non-accepted
                if (m[i].options.disabled || (t && !m[i].accept.call(m[i].element[0],
                    (t.currentItem || t.element)))) {
                    continue;
                }

                // Filter out elements in the current dragged item
                for (j = 0; j < list.length; j++) {
                    if (list[j] === m[i].element[0]) {
                        m[i].proportions().height = 0;
                        continue droppablesLoop;
                    }
                }

                m[i].visible = m[i].element.css("display") !== "none";
                if (!m[i].visible) {
                    continue;
                }

                // Activate the droppable if used directly from draggables
                if (type === "mousedown") {
                    m[i]._activate.call(m[i], event);
                }

                m[i].offset = m[i].element.offset();
                m[i].proportions({
                    width: m[i].element[0].offsetWidth,
                    height: m[i].element[0].offsetHeight
                });

            }

        },
        drop: function (draggable, event) {

            var dropped = false;

            // Create a copy of the droppables in case the list changes during the drop (#9116)
            $.each(($.ui.ddmanager.droppables[draggable.options.scope] || []).slice(), function () {

                if (!this.options) {
                    return;
                }
                if (!this.options.disabled && this.visible &&
                    intersect(draggable, this, this.options.tolerance, event)) {
                    dropped = this._drop.call(this, event) || dropped;
                }

                if (!this.options.disabled && this.visible && this.accept.call(this.element[0],
                    (draggable.currentItem || draggable.element))) {
                    this.isout = true;
                    this.isover = false;
                    this._deactivate.call(this, event);
                }

            });
            return dropped;

        },
        dragStart: function (draggable, event) {

            // Listen for scrolling so that if the dragging causes scrolling the position of the
            // droppables can be recalculated (see #5003)
            draggable.element.parentsUntil("body").on("scroll.droppable", function () {
                if (!draggable.options.refreshPositions) {
                    $.ui.ddmanager.prepareOffsets(draggable, event);
                }
            });
        },
        drag: function (draggable, event) {

            // If you have a highly dynamic page, you might try this option. It renders positions
            // every time you move the mouse.
            if (draggable.options.refreshPositions) {
                $.ui.ddmanager.prepareOffsets(draggable, event);
            }

            // Run through all droppables and check their positions based on specific tolerance options
            $.each($.ui.ddmanager.droppables[draggable.options.scope] || [], function () {

                if (this.options.disabled || this.greedyChild || !this.visible) {
                    return;
                }

                var parentInstance, scope, parent,
                    intersects = intersect(draggable, this, this.options.tolerance, event),
                    c = !intersects && this.isover ?
                        "isout" :
                        (intersects && !this.isover ? "isover" : null);
                if (!c) {
                    return;
                }

                if (this.options.greedy) {

                    // find droppable parents with same scope
                    scope = this.options.scope;
                    parent = this.element.parents(":data(ui-droppable)").filter(function () {
                        return $(this).droppable("instance").options.scope === scope;
                    });

                    if (parent.length) {
                        parentInstance = $(parent[0]).droppable("instance");
                        parentInstance.greedyChild = (c === "isover");
                    }
                }

                // We just moved into a greedy child
                if (parentInstance && c === "isover") {
                    parentInstance.isover = false;
                    parentInstance.isout = true;
                    parentInstance._out.call(parentInstance, event);
                }

                this[c] = true;
                this[c === "isout" ? "isover" : "isout"] = false;
                this[c === "isover" ? "_over" : "_out"].call(this, event);

                // We just moved out of a greedy child
                if (parentInstance && c === "isout") {
                    parentInstance.isout = false;
                    parentInstance.isover = true;
                    parentInstance._over.call(parentInstance, event);
                }
            });

        },
        dragStop: function (draggable, event) {
            draggable.element.parentsUntil("body").off("scroll.droppable");

            // Call prepareOffsets one final time since IE does not fire return scroll events when
            // overflow was caused by drag (see #5003)
            if (!draggable.options.refreshPositions) {
                $.ui.ddmanager.prepareOffsets(draggable, event);
            }
        }
    };

// DEPRECATED
// TODO: switch return back to widget declaration at top of file when this is removed
    if ($.uiBackCompat !== false) {

        // Backcompat for activeClass and hoverClass options
        $.widget("ui.droppable", $.ui.droppable, {
            options: {
                hoverClass: false,
                activeClass: false
            },
            _addActiveClass: function () {
                this._super();
                if (this.options.activeClass) {
                    this.element.addClass(this.options.activeClass);
                }
            },
            _removeActiveClass: function () {
                this._super();
                if (this.options.activeClass) {
                    this.element.removeClass(this.options.activeClass);
                }
            },
            _addHoverClass: function () {
                this._super();
                if (this.options.hoverClass) {
                    this.element.addClass(this.options.hoverClass);
                }
            },
            _removeHoverClass: function () {
                this._super();
                if (this.options.hoverClass) {
                    this.element.removeClass(this.options.hoverClass);
                }
            }
        });
    }

    var widgetsDroppable = $.ui.droppable;


    /*!
 * jQuery UI Progressbar 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Progressbar
//>>group: Widgets
// jscs:disable maximumLineLength
//>>description: Displays a status indicator for loading state, standard percentage, and other progress indicators.
// jscs:enable maximumLineLength
//>>docs: http://api.jqueryui.com/progressbar/
//>>demos: http://jqueryui.com/progressbar/
//>>css.structure: ../../themes/base/core.css
//>>css.structure: ../../themes/base/progressbar.css
//>>css.theme: ../../themes/base/theme.css


    var widgetsProgressbar = $.widget("ui.progressbar", {
        version: "1.12.1",
        options: {
            classes: {
                "ui-progressbar": "ui-corner-all",
                "ui-progressbar-value": "ui-corner-left",
                "ui-progressbar-complete": "ui-corner-right"
            },
            max: 100,
            value: 0,

            change: null,
            complete: null
        },

        min: 0,

        _create: function () {

            // Constrain initial value
            this.oldValue = this.options.value = this._constrainedValue();

            this.element.attr({

                // Only set static values; aria-valuenow and aria-valuemax are
                // set inside _refreshValue()
                role: "progressbar",
                "aria-valuemin": this.min
            });
            this._addClass("ui-progressbar", "ui-widget ui-widget-content");

            this.valueDiv = $("<div>").appendTo(this.element);
            this._addClass(this.valueDiv, "ui-progressbar-value", "ui-widget-header");
            this._refreshValue();
        },

        _destroy: function () {
            this.element.removeAttr("role aria-valuemin aria-valuemax aria-valuenow");

            this.valueDiv.remove();
        },

        value: function (newValue) {
            if (newValue === undefined) {
                return this.options.value;
            }

            this.options.value = this._constrainedValue(newValue);
            this._refreshValue();
        },

        _constrainedValue: function (newValue) {
            if (newValue === undefined) {
                newValue = this.options.value;
            }

            this.indeterminate = newValue === false;

            // Sanitize value
            if (typeof newValue !== "number") {
                newValue = 0;
            }

            return this.indeterminate ? false :
                Math.min(this.options.max, Math.max(this.min, newValue));
        },

        _setOptions: function (options) {

            // Ensure "value" option is set after other values (like max)
            var value = options.value;
            delete options.value;

            this._super(options);

            this.options.value = this._constrainedValue(value);
            this._refreshValue();
        },

        _setOption: function (key, value) {
            if (key === "max") {

                // Don't allow a max less than min
                value = Math.max(this.min, value);
            }
            this._super(key, value);
        },

        _setOptionDisabled: function (value) {
            this._super(value);

            this.element.attr("aria-disabled", value);
            this._toggleClass(null, "ui-state-disabled", !!value);
        },

        _percentage: function () {
            return this.indeterminate ?
                100 :
                100 * (this.options.value - this.min) / (this.options.max - this.min);
        },

        _refreshValue: function () {
            var value = this.options.value,
                percentage = this._percentage();

            this.valueDiv
                .toggle(this.indeterminate || value > this.min)
                .width(percentage.toFixed(0) + "%");

            this
                ._toggleClass(this.valueDiv, "ui-progressbar-complete", null,
                    value === this.options.max)
                ._toggleClass("ui-progressbar-indeterminate", null, this.indeterminate);

            if (this.indeterminate) {
                this.element.removeAttr("aria-valuenow");
                if (!this.overlayDiv) {
                    this.overlayDiv = $("<div>").appendTo(this.valueDiv);
                    this._addClass(this.overlayDiv, "ui-progressbar-overlay");
                }
            } else {
                this.element.attr({
                    "aria-valuemax": this.options.max,
                    "aria-valuenow": value
                });
                if (this.overlayDiv) {
                    this.overlayDiv.remove();
                    this.overlayDiv = null;
                }
            }

            if (this.oldValue !== value) {
                this.oldValue = value;
                this._trigger("change");
            }
            if (value === this.options.max) {
                this._trigger("complete");
            }
        }
    });


    /*!
 * jQuery UI Selectable 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Selectable
//>>group: Interactions
//>>description: Allows groups of elements to be selected with the mouse.
//>>docs: http://api.jqueryui.com/selectable/
//>>demos: http://jqueryui.com/selectable/
//>>css.structure: ../../themes/base/selectable.css


    var widgetsSelectable = $.widget("ui.selectable", $.ui.mouse, {
        version: "1.12.1",
        options: {
            appendTo: "body",
            autoRefresh: true,
            distance: 0,
            filter: "*",
            tolerance: "touch",

            // Callbacks
            selected: null,
            selecting: null,
            start: null,
            stop: null,
            unselected: null,
            unselecting: null
        },
        _create: function () {
            var that = this;

            this._addClass("ui-selectable");

            this.dragged = false;

            // Cache selectee children based on filter
            this.refresh = function () {
                that.elementPos = $(that.element[0]).offset();
                that.selectees = $(that.options.filter, that.element[0]);
                that._addClass(that.selectees, "ui-selectee");
                that.selectees.each(function () {
                    var $this = $(this),
                        selecteeOffset = $this.offset(),
                        pos = {
                            left: selecteeOffset.left - that.elementPos.left,
                            top: selecteeOffset.top - that.elementPos.top
                        };
                    $.data(this, "selectable-item", {
                        element: this,
                        $element: $this,
                        left: pos.left,
                        top: pos.top,
                        right: pos.left + $this.outerWidth(),
                        bottom: pos.top + $this.outerHeight(),
                        startselected: false,
                        selected: $this.hasClass("ui-selected"),
                        selecting: $this.hasClass("ui-selecting"),
                        unselecting: $this.hasClass("ui-unselecting")
                    });
                });
            };
            this.refresh();

            this._mouseInit();

            this.helper = $("<div>");
            this._addClass(this.helper, "ui-selectable-helper");
        },

        _destroy: function () {
            this.selectees.removeData("selectable-item");
            this._mouseDestroy();
        },

        _mouseStart: function (event) {
            var that = this,
                options = this.options;

            this.opos = [event.pageX, event.pageY];
            this.elementPos = $(this.element[0]).offset();

            if (this.options.disabled) {
                return;
            }

            this.selectees = $(options.filter, this.element[0]);

            this._trigger("start", event);

            $(options.appendTo).append(this.helper);

            // position helper (lasso)
            this.helper.css({
                "left": event.pageX,
                "top": event.pageY,
                "width": 0,
                "height": 0
            });

            if (options.autoRefresh) {
                this.refresh();
            }

            this.selectees.filter(".ui-selected").each(function () {
                var selectee = $.data(this, "selectable-item");
                selectee.startselected = true;
                if (!event.metaKey && !event.ctrlKey) {
                    that._removeClass(selectee.$element, "ui-selected");
                    selectee.selected = false;
                    that._addClass(selectee.$element, "ui-unselecting");
                    selectee.unselecting = true;

                    // selectable UNSELECTING callback
                    that._trigger("unselecting", event, {
                        unselecting: selectee.element
                    });
                }
            });

            $(event.target).parents().addBack().each(function () {
                var doSelect,
                    selectee = $.data(this, "selectable-item");
                if (selectee) {
                    doSelect = (!event.metaKey && !event.ctrlKey) ||
                        !selectee.$element.hasClass("ui-selected");
                    that._removeClass(selectee.$element, doSelect ? "ui-unselecting" : "ui-selected")
                        ._addClass(selectee.$element, doSelect ? "ui-selecting" : "ui-unselecting");
                    selectee.unselecting = !doSelect;
                    selectee.selecting = doSelect;
                    selectee.selected = doSelect;

                    // selectable (UN)SELECTING callback
                    if (doSelect) {
                        that._trigger("selecting", event, {
                            selecting: selectee.element
                        });
                    } else {
                        that._trigger("unselecting", event, {
                            unselecting: selectee.element
                        });
                    }
                    return false;
                }
            });

        },

        _mouseDrag: function (event) {

            this.dragged = true;

            if (this.options.disabled) {
                return;
            }

            var tmp,
                that = this,
                options = this.options,
                x1 = this.opos[0],
                y1 = this.opos[1],
                x2 = event.pageX,
                y2 = event.pageY;

            if (x1 > x2) {
                tmp = x2;
                x2 = x1;
                x1 = tmp;
            }
            if (y1 > y2) {
                tmp = y2;
                y2 = y1;
                y1 = tmp;
            }
            this.helper.css({left: x1, top: y1, width: x2 - x1, height: y2 - y1});

            this.selectees.each(function () {
                var selectee = $.data(this, "selectable-item"),
                    hit = false,
                    offset = {};

                //prevent helper from being selected if appendTo: selectable
                if (!selectee || selectee.element === that.element[0]) {
                    return;
                }

                offset.left = selectee.left + that.elementPos.left;
                offset.right = selectee.right + that.elementPos.left;
                offset.top = selectee.top + that.elementPos.top;
                offset.bottom = selectee.bottom + that.elementPos.top;

                if (options.tolerance === "touch") {
                    hit = (!(offset.left > x2 || offset.right < x1 || offset.top > y2 ||
                        offset.bottom < y1));
                } else if (options.tolerance === "fit") {
                    hit = (offset.left > x1 && offset.right < x2 && offset.top > y1 &&
                        offset.bottom < y2);
                }

                if (hit) {

                    // SELECT
                    if (selectee.selected) {
                        that._removeClass(selectee.$element, "ui-selected");
                        selectee.selected = false;
                    }
                    if (selectee.unselecting) {
                        that._removeClass(selectee.$element, "ui-unselecting");
                        selectee.unselecting = false;
                    }
                    if (!selectee.selecting) {
                        that._addClass(selectee.$element, "ui-selecting");
                        selectee.selecting = true;

                        // selectable SELECTING callback
                        that._trigger("selecting", event, {
                            selecting: selectee.element
                        });
                    }
                } else {

                    // UNSELECT
                    if (selectee.selecting) {
                        if ((event.metaKey || event.ctrlKey) && selectee.startselected) {
                            that._removeClass(selectee.$element, "ui-selecting");
                            selectee.selecting = false;
                            that._addClass(selectee.$element, "ui-selected");
                            selectee.selected = true;
                        } else {
                            that._removeClass(selectee.$element, "ui-selecting");
                            selectee.selecting = false;
                            if (selectee.startselected) {
                                that._addClass(selectee.$element, "ui-unselecting");
                                selectee.unselecting = true;
                            }

                            // selectable UNSELECTING callback
                            that._trigger("unselecting", event, {
                                unselecting: selectee.element
                            });
                        }
                    }
                    if (selectee.selected) {
                        if (!event.metaKey && !event.ctrlKey && !selectee.startselected) {
                            that._removeClass(selectee.$element, "ui-selected");
                            selectee.selected = false;

                            that._addClass(selectee.$element, "ui-unselecting");
                            selectee.unselecting = true;

                            // selectable UNSELECTING callback
                            that._trigger("unselecting", event, {
                                unselecting: selectee.element
                            });
                        }
                    }
                }
            });

            return false;
        },

        _mouseStop: function (event) {
            var that = this;

            this.dragged = false;

            $(".ui-unselecting", this.element[0]).each(function () {
                var selectee = $.data(this, "selectable-item");
                that._removeClass(selectee.$element, "ui-unselecting");
                selectee.unselecting = false;
                selectee.startselected = false;
                that._trigger("unselected", event, {
                    unselected: selectee.element
                });
            });
            $(".ui-selecting", this.element[0]).each(function () {
                var selectee = $.data(this, "selectable-item");
                that._removeClass(selectee.$element, "ui-selecting")
                    ._addClass(selectee.$element, "ui-selected");
                selectee.selecting = false;
                selectee.selected = true;
                selectee.startselected = true;
                that._trigger("selected", event, {
                    selected: selectee.element
                });
            });
            this._trigger("stop", event);

            this.helper.remove();

            return false;
        }

    });


    /*!
 * jQuery UI Selectmenu 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Selectmenu
//>>group: Widgets
// jscs:disable maximumLineLength
//>>description: Duplicates and extends the functionality of a native HTML select element, allowing it to be customizable in behavior and appearance far beyond the limitations of a native select.
// jscs:enable maximumLineLength
//>>docs: http://api.jqueryui.com/selectmenu/
//>>demos: http://jqueryui.com/selectmenu/
//>>css.structure: ../../themes/base/core.css
//>>css.structure: ../../themes/base/selectmenu.css, ../../themes/base/button.css
//>>css.theme: ../../themes/base/theme.css


    var widgetsSelectmenu = $.widget("ui.selectmenu", [$.ui.formResetMixin, {
        version: "1.12.1",
        defaultElement: "<select>",
        options: {
            appendTo: null,
            classes: {
                "ui-selectmenu-button-open": "ui-corner-top",
                "ui-selectmenu-button-closed": "ui-corner-all"
            },
            disabled: null,
            icons: {
                button: "ui-icon-triangle-1-s"
            },
            position: {
                my: "left top",
                at: "left bottom",
                collision: "none"
            },
            width: false,

            // Callbacks
            change: null,
            close: null,
            focus: null,
            open: null,
            select: null
        },

        _create: function () {
            var selectmenuId = this.element.uniqueId().attr("id");
            this.ids = {
                element: selectmenuId,
                button: selectmenuId + "-button",
                menu: selectmenuId + "-menu"
            };

            this._drawButton();
            this._drawMenu();
            this._bindFormResetHandler();

            this._rendered = false;
            this.menuItems = $();
        },

        _drawButton: function () {
            var icon,
                that = this,
                item = this._parseOption(
                    this.element.find("option:selected"),
                    this.element[0].selectedIndex
                );

            // Associate existing label with the new button
            this.labels = this.element.labels().attr("for", this.ids.button);
            this._on(this.labels, {
                click: function (event) {
                    this.button.focus();
                    event.preventDefault();
                }
            });

            // Hide original select element
            this.element.hide();

            // Create button
            this.button = $("<span>", {
                tabindex: this.options.disabled ? -1 : 0,
                id: this.ids.button,
                role: "combobox",
                "aria-expanded": "false",
                "aria-autocomplete": "list",
                "aria-owns": this.ids.menu,
                "aria-haspopup": "true",
                title: this.element.attr("title")
            })
                .insertAfter(this.element);

            this._addClass(this.button, "ui-selectmenu-button ui-selectmenu-button-closed",
                "ui-button ui-widget");

            icon = $("<span>").appendTo(this.button);
            this._addClass(icon, "ui-selectmenu-icon", "ui-icon " + this.options.icons.button);
            this.buttonItem = this._renderButtonItem(item)
                .appendTo(this.button);

            if (this.options.width !== false) {
                this._resizeButton();
            }

            this._on(this.button, this._buttonEvents);
            this.button.one("focusin", function () {

                // Delay rendering the menu items until the button receives focus.
                // The menu may have already been rendered via a programmatic open.
                if (!that._rendered) {
                    that._refreshMenu();
                }
            });
        },

        _drawMenu: function () {
            var that = this;

            // Create menu
            this.menu = $("<ul>", {
                "aria-hidden": "true",
                "aria-labelledby": this.ids.button,
                id: this.ids.menu
            });

            // Wrap menu
            this.menuWrap = $("<div>").append(this.menu);
            this._addClass(this.menuWrap, "ui-selectmenu-menu", "ui-front");
            this.menuWrap.appendTo(this._appendTo());

            // Initialize menu widget
            this.menuInstance = this.menu
                .menu({
                    classes: {
                        "ui-menu": "ui-corner-bottom"
                    },
                    role: "listbox",
                    select: function (event, ui) {
                        event.preventDefault();

                        // Support: IE8
                        // If the item was selected via a click, the text selection
                        // will be destroyed in IE
                        that._setSelection();

                        that._select(ui.item.data("ui-selectmenu-item"), event);
                    },
                    focus: function (event, ui) {
                        var item = ui.item.data("ui-selectmenu-item");

                        // Prevent inital focus from firing and check if its a newly focused item
                        if (that.focusIndex != null && item.index !== that.focusIndex) {
                            that._trigger("focus", event, {item: item});
                            if (!that.isOpen) {
                                that._select(item, event);
                            }
                        }
                        that.focusIndex = item.index;

                        that.button.attr("aria-activedescendant",
                            that.menuItems.eq(item.index).attr("id"));
                    }
                })
                .menu("instance");

            // Don't close the menu on mouseleave
            this.menuInstance._off(this.menu, "mouseleave");

            // Cancel the menu's collapseAll on document click
            this.menuInstance._closeOnDocumentClick = function () {
                return false;
            };

            // Selects often contain empty items, but never contain dividers
            this.menuInstance._isDivider = function () {
                return false;
            };
        },

        refresh: function () {
            this._refreshMenu();
            this.buttonItem.replaceWith(
                this.buttonItem = this._renderButtonItem(
                    // Fall back to an empty object in case there are no options
                    this._getSelectedItem().data("ui-selectmenu-item") || {}
                )
            );
            if (this.options.width === null) {
                this._resizeButton();
            }
        },

        _refreshMenu: function () {
            var item,
                options = this.element.find("option");

            this.menu.empty();

            this._parseOptions(options);
            this._renderMenu(this.menu, this.items);

            this.menuInstance.refresh();
            this.menuItems = this.menu.find("li")
                .not(".ui-selectmenu-optgroup")
                .find(".ui-menu-item-wrapper");

            this._rendered = true;

            if (!options.length) {
                return;
            }

            item = this._getSelectedItem();

            // Update the menu to have the correct item focused
            this.menuInstance.focus(null, item);
            this._setAria(item.data("ui-selectmenu-item"));

            // Set disabled state
            this._setOption("disabled", this.element.prop("disabled"));
        },

        open: function (event) {
            if (this.options.disabled) {
                return;
            }

            // If this is the first time the menu is being opened, render the items
            if (!this._rendered) {
                this._refreshMenu();
            } else {

                // Menu clears focus on close, reset focus to selected item
                this._removeClass(this.menu.find(".ui-state-active"), null, "ui-state-active");
                this.menuInstance.focus(null, this._getSelectedItem());
            }

            // If there are no options, don't open the menu
            if (!this.menuItems.length) {
                return;
            }

            this.isOpen = true;
            this._toggleAttr();
            this._resizeMenu();
            this._position();

            this._on(this.document, this._documentClick);

            this._trigger("open", event);
        },

        _position: function () {
            this.menuWrap.position($.extend({of: this.button}, this.options.position));
        },

        close: function (event) {
            if (!this.isOpen) {
                return;
            }

            this.isOpen = false;
            this._toggleAttr();

            this.range = null;
            this._off(this.document);

            this._trigger("close", event);
        },

        widget: function () {
            return this.button;
        },

        menuWidget: function () {
            return this.menu;
        },

        _renderButtonItem: function (item) {
            var buttonItem = $("<span>");

            this._setText(buttonItem, item.label);
            this._addClass(buttonItem, "ui-selectmenu-text");

            return buttonItem;
        },

        _renderMenu: function (ul, items) {
            var that = this,
                currentOptgroup = "";

            $.each(items, function (index, item) {
                var li;

                if (item.optgroup !== currentOptgroup) {
                    li = $("<li>", {
                        text: item.optgroup
                    });
                    that._addClass(li, "ui-selectmenu-optgroup", "ui-menu-divider" +
                        (item.element.parent("optgroup").prop("disabled") ?
                            " ui-state-disabled" :
                            ""));

                    li.appendTo(ul);

                    currentOptgroup = item.optgroup;
                }

                that._renderItemData(ul, item);
            });
        },

        _renderItemData: function (ul, item) {
            return this._renderItem(ul, item).data("ui-selectmenu-item", item);
        },

        _renderItem: function (ul, item) {
            var li = $("<li>"),
                wrapper = $("<div>", {
                    title: item.element.attr("title")
                });

            if (item.disabled) {
                this._addClass(li, null, "ui-state-disabled");
            }
            this._setText(wrapper, item.label);

            return li.append(wrapper).appendTo(ul);
        },

        _setText: function (element, value) {
            if (value) {
                element.text(value);
            } else {
                element.html("&#160;");
            }
        },

        _move: function (direction, event) {
            var item, next,
                filter = ".ui-menu-item";

            if (this.isOpen) {
                item = this.menuItems.eq(this.focusIndex).parent("li");
            } else {
                item = this.menuItems.eq(this.element[0].selectedIndex).parent("li");
                filter += ":not(.ui-state-disabled)";
            }

            if (direction === "first" || direction === "last") {
                next = item[direction === "first" ? "prevAll" : "nextAll"](filter).eq(-1);
            } else {
                next = item[direction + "All"](filter).eq(0);
            }

            if (next.length) {
                this.menuInstance.focus(event, next);
            }
        },

        _getSelectedItem: function () {
            return this.menuItems.eq(this.element[0].selectedIndex).parent("li");
        },

        _toggle: function (event) {
            this[this.isOpen ? "close" : "open"](event);
        },

        _setSelection: function () {
            var selection;

            if (!this.range) {
                return;
            }

            if (window.getSelection) {
                selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(this.range);

                // Support: IE8
            } else {
                this.range.select();
            }

            // Support: IE
            // Setting the text selection kills the button focus in IE, but
            // restoring the focus doesn't kill the selection.
            this.button.focus();
        },

        _documentClick: {
            mousedown: function (event) {
                if (!this.isOpen) {
                    return;
                }

                if (!$(event.target).closest(".ui-selectmenu-menu, #" +
                    $.ui.escapeSelector(this.ids.button)).length) {
                    this.close(event);
                }
            }
        },

        _buttonEvents: {

            // Prevent text selection from being reset when interacting with the selectmenu (#10144)
            mousedown: function () {
                var selection;

                if (window.getSelection) {
                    selection = window.getSelection();
                    if (selection.rangeCount) {
                        this.range = selection.getRangeAt(0);
                    }

                    // Support: IE8
                } else {
                    this.range = document.selection.createRange();
                }
            },

            click: function (event) {
                this._setSelection();
                this._toggle(event);
            },

            keydown: function (event) {
                var preventDefault = true;
                switch (event.keyCode) {
                    case $.ui.keyCode.TAB:
                    case $.ui.keyCode.ESCAPE:
                        this.close(event);
                        preventDefault = false;
                        break;
                    case $.ui.keyCode.ENTER:
                        if (this.isOpen) {
                            this._selectFocusedItem(event);
                        }
                        break;
                    case $.ui.keyCode.UP:
                        if (event.altKey) {
                            this._toggle(event);
                        } else {
                            this._move("prev", event);
                        }
                        break;
                    case $.ui.keyCode.DOWN:
                        if (event.altKey) {
                            this._toggle(event);
                        } else {
                            this._move("next", event);
                        }
                        break;
                    case $.ui.keyCode.SPACE:
                        if (this.isOpen) {
                            this._selectFocusedItem(event);
                        } else {
                            this._toggle(event);
                        }
                        break;
                    case $.ui.keyCode.LEFT:
                        this._move("prev", event);
                        break;
                    case $.ui.keyCode.RIGHT:
                        this._move("next", event);
                        break;
                    case $.ui.keyCode.HOME:
                    case $.ui.keyCode.PAGE_UP:
                        this._move("first", event);
                        break;
                    case $.ui.keyCode.END:
                    case $.ui.keyCode.PAGE_DOWN:
                        this._move("last", event);
                        break;
                    default:
                        this.menu.trigger(event);
                        preventDefault = false;
                }

                if (preventDefault) {
                    event.preventDefault();
                }
            }
        },

        _selectFocusedItem: function (event) {
            var item = this.menuItems.eq(this.focusIndex).parent("li");
            if (!item.hasClass("ui-state-disabled")) {
                this._select(item.data("ui-selectmenu-item"), event);
            }
        },

        _select: function (item, event) {
            var oldIndex = this.element[0].selectedIndex;

            // Change native select element
            this.element[0].selectedIndex = item.index;
            this.buttonItem.replaceWith(this.buttonItem = this._renderButtonItem(item));
            this._setAria(item);
            this._trigger("select", event, {item: item});

            if (item.index !== oldIndex) {
                this._trigger("change", event, {item: item});
            }

            this.close(event);
        },

        _setAria: function (item) {
            var id = this.menuItems.eq(item.index).attr("id");

            this.button.attr({
                "aria-labelledby": id,
                "aria-activedescendant": id
            });
            this.menu.attr("aria-activedescendant", id);
        },

        _setOption: function (key, value) {
            if (key === "icons") {
                var icon = this.button.find("span.ui-icon");
                this._removeClass(icon, null, this.options.icons.button)
                    ._addClass(icon, null, value.button);
            }

            this._super(key, value);

            if (key === "appendTo") {
                this.menuWrap.appendTo(this._appendTo());
            }

            if (key === "width") {
                this._resizeButton();
            }
        },

        _setOptionDisabled: function (value) {
            this._super(value);

            this.menuInstance.option("disabled", value);
            this.button.attr("aria-disabled", value);
            this._toggleClass(this.button, null, "ui-state-disabled", value);

            this.element.prop("disabled", value);
            if (value) {
                this.button.attr("tabindex", -1);
                this.close();
            } else {
                this.button.attr("tabindex", 0);
            }
        },

        _appendTo: function () {
            var element = this.options.appendTo;

            if (element) {
                element = element.jquery || element.nodeType ?
                    $(element) :
                    this.document.find(element).eq(0);
            }

            if (!element || !element[0]) {
                element = this.element.closest(".ui-front, dialog");
            }

            if (!element.length) {
                element = this.document[0].body;
            }

            return element;
        },

        _toggleAttr: function () {
            this.button.attr("aria-expanded", this.isOpen);

            // We can't use two _toggleClass() calls here, because we need to make sure
            // we always remove classes first and add them second, otherwise if both classes have the
            // same theme class, it will be removed after we add it.
            this._removeClass(this.button, "ui-selectmenu-button-" +
                (this.isOpen ? "closed" : "open"))
                ._addClass(this.button, "ui-selectmenu-button-" +
                    (this.isOpen ? "open" : "closed"))
                ._toggleClass(this.menuWrap, "ui-selectmenu-open", null, this.isOpen);

            this.menu.attr("aria-hidden", !this.isOpen);
        },

        _resizeButton: function () {
            var width = this.options.width;

            // For `width: false`, just remove inline style and stop
            if (width === false) {
                this.button.css("width", "");
                return;
            }

            // For `width: null`, match the width of the original element
            if (width === null) {
                width = this.element.show().outerWidth();
                this.element.hide();
            }

            this.button.outerWidth(width);
        },

        _resizeMenu: function () {
            this.menu.outerWidth(Math.max(
                this.button.outerWidth(),

                // Support: IE10
                // IE10 wraps long text (possibly a rounding bug)
                // so we add 1px to avoid the wrapping
                this.menu.width("").outerWidth() + 1
            ));
        },

        _getCreateOptions: function () {
            var options = this._super();

            options.disabled = this.element.prop("disabled");

            return options;
        },

        _parseOptions: function (options) {
            var that = this,
                data = [];
            options.each(function (index, item) {
                data.push(that._parseOption($(item), index));
            });
            this.items = data;
        },

        _parseOption: function (option, index) {
            var optgroup = option.parent("optgroup");

            return {
                element: option,
                index: index,
                value: option.val(),
                label: option.text(),
                optgroup: optgroup.attr("label") || "",
                disabled: optgroup.prop("disabled") || option.prop("disabled")
            };
        },

        _destroy: function () {
            this._unbindFormResetHandler();
            this.menuWrap.remove();
            this.button.remove();
            this.element.show();
            this.element.removeUniqueId();
            this.labels.attr("for", this.ids.element);
        }
    }]);


    /*!
 * jQuery UI Slider 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Slider
//>>group: Widgets
//>>description: Displays a flexible slider with ranges and accessibility via keyboard.
//>>docs: http://api.jqueryui.com/slider/
//>>demos: http://jqueryui.com/slider/
//>>css.structure: ../../themes/base/core.css
//>>css.structure: ../../themes/base/slider.css
//>>css.theme: ../../themes/base/theme.css


    var widgetsSlider = $.widget("ui.slider", $.ui.mouse, {
        version: "1.12.1",
        widgetEventPrefix: "slide",

        options: {
            animate: false,
            classes: {
                "ui-slider": "ui-corner-all",
                "ui-slider-handle": "ui-corner-all",

                // Note: ui-widget-header isn't the most fittingly semantic framework class for this
                // element, but worked best visually with a variety of themes
                "ui-slider-range": "ui-corner-all ui-widget-header"
            },
            distance: 0,
            max: 100,
            min: 0,
            orientation: "horizontal",
            range: false,
            step: 1,
            value: 0,
            values: null,

            // Callbacks
            change: null,
            slide: null,
            start: null,
            stop: null
        },

        // Number of pages in a slider
        // (how many times can you page up/down to go through the whole range)
        numPages: 5,

        _create: function () {
            this._keySliding = false;
            this._mouseSliding = false;
            this._animateOff = true;
            this._handleIndex = null;
            this._detectOrientation();
            this._mouseInit();
            this._calculateNewMax();

            this._addClass("ui-slider ui-slider-" + this.orientation,
                "ui-widget ui-widget-content");

            this._refresh();

            this._animateOff = false;
        },

        _refresh: function () {
            this._createRange();
            this._createHandles();
            this._setupEvents();
            this._refreshValue();
        },

        _createHandles: function () {
            var i, handleCount,
                options = this.options,
                existingHandles = this.element.find(".ui-slider-handle"),
                handle = "<span tabindex='0'></span>",
                handles = [];

            handleCount = (options.values && options.values.length) || 1;

            if (existingHandles.length > handleCount) {
                existingHandles.slice(handleCount).remove();
                existingHandles = existingHandles.slice(0, handleCount);
            }

            for (i = existingHandles.length; i < handleCount; i++) {
                handles.push(handle);
            }

            this.handles = existingHandles.add($(handles.join("")).appendTo(this.element));

            this._addClass(this.handles, "ui-slider-handle", "ui-state-default");

            this.handle = this.handles.eq(0);

            this.handles.each(function (i) {
                $(this)
                    .data("ui-slider-handle-index", i)
                    .attr("tabIndex", 0);
            });
        },

        _createRange: function () {
            var options = this.options;

            if (options.range) {
                if (options.range === true) {
                    if (!options.values) {
                        options.values = [this._valueMin(), this._valueMin()];
                    } else if (options.values.length && options.values.length !== 2) {
                        options.values = [options.values[0], options.values[0]];
                    } else if ($.isArray(options.values)) {
                        options.values = options.values.slice(0);
                    }
                }

                if (!this.range || !this.range.length) {
                    this.range = $("<div>")
                        .appendTo(this.element);

                    this._addClass(this.range, "ui-slider-range");
                } else {
                    this._removeClass(this.range, "ui-slider-range-min ui-slider-range-max");

                    // Handle range switching from true to min/max
                    this.range.css({
                        "left": "",
                        "bottom": ""
                    });
                }
                if (options.range === "min" || options.range === "max") {
                    this._addClass(this.range, "ui-slider-range-" + options.range);
                }
            } else {
                if (this.range) {
                    this.range.remove();
                }
                this.range = null;
            }
        },

        _setupEvents: function () {
            this._off(this.handles);
            this._on(this.handles, this._handleEvents);
            this._hoverable(this.handles);
            this._focusable(this.handles);
        },

        _destroy: function () {
            this.handles.remove();
            if (this.range) {
                this.range.remove();
            }

            this._mouseDestroy();
        },

        _mouseCapture: function (event) {
            var position, normValue, distance, closestHandle, index, allowed, offset, mouseOverHandle,
                that = this,
                o = this.options;

            if (o.disabled) {
                return false;
            }

            this.elementSize = {
                width: this.element.outerWidth(),
                height: this.element.outerHeight()
            };
            this.elementOffset = this.element.offset();

            position = {x: event.pageX, y: event.pageY};
            normValue = this._normValueFromMouse(position);
            distance = this._valueMax() - this._valueMin() + 1;
            this.handles.each(function (i) {
                var thisDistance = Math.abs(normValue - that.values(i));
                if ((distance > thisDistance) ||
                    (distance === thisDistance &&
                        (i === that._lastChangedValue || that.values(i) === o.min))) {
                    distance = thisDistance;
                    closestHandle = $(this);
                    index = i;
                }
            });

            allowed = this._start(event, index);
            if (allowed === false) {
                return false;
            }
            this._mouseSliding = true;

            this._handleIndex = index;

            this._addClass(closestHandle, null, "ui-state-active");
            closestHandle.trigger("focus");

            offset = closestHandle.offset();
            mouseOverHandle = !$(event.target).parents().addBack().is(".ui-slider-handle");
            this._clickOffset = mouseOverHandle ? {left: 0, top: 0} : {
                left: event.pageX - offset.left - (closestHandle.width() / 2),
                top: event.pageY - offset.top -
                    (closestHandle.height() / 2) -
                    (parseInt(closestHandle.css("borderTopWidth"), 10) || 0) -
                    (parseInt(closestHandle.css("borderBottomWidth"), 10) || 0) +
                    (parseInt(closestHandle.css("marginTop"), 10) || 0)
            };

            if (!this.handles.hasClass("ui-state-hover")) {
                this._slide(event, index, normValue);
            }
            this._animateOff = true;
            return true;
        },

        _mouseStart: function () {
            return true;
        },

        _mouseDrag: function (event) {
            var position = {x: event.pageX, y: event.pageY},
                normValue = this._normValueFromMouse(position);

            this._slide(event, this._handleIndex, normValue);

            return false;
        },

        _mouseStop: function (event) {
            this._removeClass(this.handles, null, "ui-state-active");
            this._mouseSliding = false;

            this._stop(event, this._handleIndex);
            this._change(event, this._handleIndex);

            this._handleIndex = null;
            this._clickOffset = null;
            this._animateOff = false;

            return false;
        },

        _detectOrientation: function () {
            this.orientation = (this.options.orientation === "vertical") ? "vertical" : "horizontal";
        },

        _normValueFromMouse: function (position) {
            var pixelTotal,
                pixelMouse,
                percentMouse,
                valueTotal,
                valueMouse;

            if (this.orientation === "horizontal") {
                pixelTotal = this.elementSize.width;
                pixelMouse = position.x - this.elementOffset.left -
                    (this._clickOffset ? this._clickOffset.left : 0);
            } else {
                pixelTotal = this.elementSize.height;
                pixelMouse = position.y - this.elementOffset.top -
                    (this._clickOffset ? this._clickOffset.top : 0);
            }

            percentMouse = (pixelMouse / pixelTotal);
            if (percentMouse > 1) {
                percentMouse = 1;
            }
            if (percentMouse < 0) {
                percentMouse = 0;
            }
            if (this.orientation === "vertical") {
                percentMouse = 1 - percentMouse;
            }

            valueTotal = this._valueMax() - this._valueMin();
            valueMouse = this._valueMin() + percentMouse * valueTotal;

            return this._trimAlignValue(valueMouse);
        },

        _uiHash: function (index, value, values) {
            var uiHash = {
                handle: this.handles[index],
                handleIndex: index,
                value: value !== undefined ? value : this.value()
            };

            if (this._hasMultipleValues()) {
                uiHash.value = value !== undefined ? value : this.values(index);
                uiHash.values = values || this.values();
            }

            return uiHash;
        },

        _hasMultipleValues: function () {
            return this.options.values && this.options.values.length;
        },

        _start: function (event, index) {
            return this._trigger("start", event, this._uiHash(index));
        },

        _slide: function (event, index, newVal) {
            var allowed, otherVal,
                currentValue = this.value(),
                newValues = this.values();

            if (this._hasMultipleValues()) {
                otherVal = this.values(index ? 0 : 1);
                currentValue = this.values(index);

                if (this.options.values.length === 2 && this.options.range === true) {
                    newVal = index === 0 ? Math.min(otherVal, newVal) : Math.max(otherVal, newVal);
                }

                newValues[index] = newVal;
            }

            if (newVal === currentValue) {
                return;
            }

            allowed = this._trigger("slide", event, this._uiHash(index, newVal, newValues));

            // A slide can be canceled by returning false from the slide callback
            if (allowed === false) {
                return;
            }

            if (this._hasMultipleValues()) {
                this.values(index, newVal);
            } else {
                this.value(newVal);
            }
        },

        _stop: function (event, index) {
            this._trigger("stop", event, this._uiHash(index));
        },

        _change: function (event, index) {
            if (!this._keySliding && !this._mouseSliding) {

                //store the last changed value index for reference when handles overlap
                this._lastChangedValue = index;
                this._trigger("change", event, this._uiHash(index));
            }
        },

        value: function (newValue) {
            if (arguments.length) {
                this.options.value = this._trimAlignValue(newValue);
                this._refreshValue();
                this._change(null, 0);
                return;
            }

            return this._value();
        },

        values: function (index, newValue) {
            var vals,
                newValues,
                i;

            if (arguments.length > 1) {
                this.options.values[index] = this._trimAlignValue(newValue);
                this._refreshValue();
                this._change(null, index);
                return;
            }

            if (arguments.length) {
                if ($.isArray(arguments[0])) {
                    vals = this.options.values;
                    newValues = arguments[0];
                    for (i = 0; i < vals.length; i += 1) {
                        vals[i] = this._trimAlignValue(newValues[i]);
                        this._change(null, i);
                    }
                    this._refreshValue();
                } else {
                    if (this._hasMultipleValues()) {
                        return this._values(index);
                    } else {
                        return this.value();
                    }
                }
            } else {
                return this._values();
            }
        },

        _setOption: function (key, value) {
            var i,
                valsLength = 0;

            if (key === "range" && this.options.range === true) {
                if (value === "min") {
                    this.options.value = this._values(0);
                    this.options.values = null;
                } else if (value === "max") {
                    this.options.value = this._values(this.options.values.length - 1);
                    this.options.values = null;
                }
            }

            if ($.isArray(this.options.values)) {
                valsLength = this.options.values.length;
            }

            this._super(key, value);

            switch (key) {
                case "orientation":
                    this._detectOrientation();
                    this._removeClass("ui-slider-horizontal ui-slider-vertical")
                        ._addClass("ui-slider-" + this.orientation);
                    this._refreshValue();
                    if (this.options.range) {
                        this._refreshRange(value);
                    }

                    // Reset positioning from previous orientation
                    this.handles.css(value === "horizontal" ? "bottom" : "left", "");
                    break;
                case "value":
                    this._animateOff = true;
                    this._refreshValue();
                    this._change(null, 0);
                    this._animateOff = false;
                    break;
                case "values":
                    this._animateOff = true;
                    this._refreshValue();

                    // Start from the last handle to prevent unreachable handles (#9046)
                    for (i = valsLength - 1; i >= 0; i--) {
                        this._change(null, i);
                    }
                    this._animateOff = false;
                    break;
                case "step":
                case "min":
                case "max":
                    this._animateOff = true;
                    this._calculateNewMax();
                    this._refreshValue();
                    this._animateOff = false;
                    break;
                case "range":
                    this._animateOff = true;
                    this._refresh();
                    this._animateOff = false;
                    break;
            }
        },

        _setOptionDisabled: function (value) {
            this._super(value);

            this._toggleClass(null, "ui-state-disabled", !!value);
        },

        //internal value getter
        // _value() returns value trimmed by min and max, aligned by step
        _value: function () {
            var val = this.options.value;
            val = this._trimAlignValue(val);

            return val;
        },

        //internal values getter
        // _values() returns array of values trimmed by min and max, aligned by step
        // _values( index ) returns single value trimmed by min and max, aligned by step
        _values: function (index) {
            var val,
                vals,
                i;

            if (arguments.length) {
                val = this.options.values[index];
                val = this._trimAlignValue(val);

                return val;
            } else if (this._hasMultipleValues()) {

                // .slice() creates a copy of the array
                // this copy gets trimmed by min and max and then returned
                vals = this.options.values.slice();
                for (i = 0; i < vals.length; i += 1) {
                    vals[i] = this._trimAlignValue(vals[i]);
                }

                return vals;
            } else {
                return [];
            }
        },

        // Returns the step-aligned value that val is closest to, between (inclusive) min and max
        _trimAlignValue: function (val) {
            if (val <= this._valueMin()) {
                return this._valueMin();
            }
            if (val >= this._valueMax()) {
                return this._valueMax();
            }
            var step = (this.options.step > 0) ? this.options.step : 1,
                valModStep = (val - this._valueMin()) % step,
                alignValue = val - valModStep;

            if (Math.abs(valModStep) * 2 >= step) {
                alignValue += (valModStep > 0) ? step : (-step);
            }

            // Since JavaScript has problems with large floats, round
            // the final value to 5 digits after the decimal point (see #4124)
            return parseFloat(alignValue.toFixed(5));
        },

        _calculateNewMax: function () {
            var max = this.options.max,
                min = this._valueMin(),
                step = this.options.step,
                aboveMin = Math.round((max - min) / step) * step;
            max = aboveMin + min;
            if (max > this.options.max) {

                //If max is not divisible by step, rounding off may increase its value
                max -= step;
            }
            this.max = parseFloat(max.toFixed(this._precision()));
        },

        _precision: function () {
            var precision = this._precisionOf(this.options.step);
            if (this.options.min !== null) {
                precision = Math.max(precision, this._precisionOf(this.options.min));
            }
            return precision;
        },

        _precisionOf: function (num) {
            var str = num.toString(),
                decimal = str.indexOf(".");
            return decimal === -1 ? 0 : str.length - decimal - 1;
        },

        _valueMin: function () {
            return this.options.min;
        },

        _valueMax: function () {
            return this.max;
        },

        _refreshRange: function (orientation) {
            if (orientation === "vertical") {
                this.range.css({"width": "", "left": ""});
            }
            if (orientation === "horizontal") {
                this.range.css({"height": "", "bottom": ""});
            }
        },

        _refreshValue: function () {
            var lastValPercent, valPercent, value, valueMin, valueMax,
                oRange = this.options.range,
                o = this.options,
                that = this,
                animate = (!this._animateOff) ? o.animate : false,
                _set = {};

            if (this._hasMultipleValues()) {
                this.handles.each(function (i) {
                    valPercent = (that.values(i) - that._valueMin()) / (that._valueMax() -
                        that._valueMin()) * 100;
                    _set[that.orientation === "horizontal" ? "left" : "bottom"] = valPercent + "%";
                    $(this).stop(1, 1)[animate ? "animate" : "css"](_set, o.animate);
                    if (that.options.range === true) {
                        if (that.orientation === "horizontal") {
                            if (i === 0) {
                                that.range.stop(1, 1)[animate ? "animate" : "css"]({
                                    left: valPercent + "%"
                                }, o.animate);
                            }
                            if (i === 1) {
                                that.range[animate ? "animate" : "css"]({
                                    width: (valPercent - lastValPercent) + "%"
                                }, {
                                    queue: false,
                                    duration: o.animate
                                });
                            }
                        } else {
                            if (i === 0) {
                                that.range.stop(1, 1)[animate ? "animate" : "css"]({
                                    bottom: (valPercent) + "%"
                                }, o.animate);
                            }
                            if (i === 1) {
                                that.range[animate ? "animate" : "css"]({
                                    height: (valPercent - lastValPercent) + "%"
                                }, {
                                    queue: false,
                                    duration: o.animate
                                });
                            }
                        }
                    }
                    lastValPercent = valPercent;
                });
            } else {
                value = this.value();
                valueMin = this._valueMin();
                valueMax = this._valueMax();
                valPercent = (valueMax !== valueMin) ?
                    (value - valueMin) / (valueMax - valueMin) * 100 :
                    0;
                _set[this.orientation === "horizontal" ? "left" : "bottom"] = valPercent + "%";
                this.handle.stop(1, 1)[animate ? "animate" : "css"](_set, o.animate);

                if (oRange === "min" && this.orientation === "horizontal") {
                    this.range.stop(1, 1)[animate ? "animate" : "css"]({
                        width: valPercent + "%"
                    }, o.animate);
                }
                if (oRange === "max" && this.orientation === "horizontal") {
                    this.range.stop(1, 1)[animate ? "animate" : "css"]({
                        width: (100 - valPercent) + "%"
                    }, o.animate);
                }
                if (oRange === "min" && this.orientation === "vertical") {
                    this.range.stop(1, 1)[animate ? "animate" : "css"]({
                        height: valPercent + "%"
                    }, o.animate);
                }
                if (oRange === "max" && this.orientation === "vertical") {
                    this.range.stop(1, 1)[animate ? "animate" : "css"]({
                        height: (100 - valPercent) + "%"
                    }, o.animate);
                }
            }
        },

        _handleEvents: {
            keydown: function (event) {
                var allowed, curVal, newVal, step,
                    index = $(event.target).data("ui-slider-handle-index");

                switch (event.keyCode) {
                    case $.ui.keyCode.HOME:
                    case $.ui.keyCode.END:
                    case $.ui.keyCode.PAGE_UP:
                    case $.ui.keyCode.PAGE_DOWN:
                    case $.ui.keyCode.UP:
                    case $.ui.keyCode.RIGHT:
                    case $.ui.keyCode.DOWN:
                    case $.ui.keyCode.LEFT:
                        event.preventDefault();
                        if (!this._keySliding) {
                            this._keySliding = true;
                            this._addClass($(event.target), null, "ui-state-active");
                            allowed = this._start(event, index);
                            if (allowed === false) {
                                return;
                            }
                        }
                        break;
                }

                step = this.options.step;
                if (this._hasMultipleValues()) {
                    curVal = newVal = this.values(index);
                } else {
                    curVal = newVal = this.value();
                }

                switch (event.keyCode) {
                    case $.ui.keyCode.HOME:
                        newVal = this._valueMin();
                        break;
                    case $.ui.keyCode.END:
                        newVal = this._valueMax();
                        break;
                    case $.ui.keyCode.PAGE_UP:
                        newVal = this._trimAlignValue(
                            curVal + ((this._valueMax() - this._valueMin()) / this.numPages)
                        );
                        break;
                    case $.ui.keyCode.PAGE_DOWN:
                        newVal = this._trimAlignValue(
                            curVal - ((this._valueMax() - this._valueMin()) / this.numPages));
                        break;
                    case $.ui.keyCode.UP:
                    case $.ui.keyCode.RIGHT:
                        if (curVal === this._valueMax()) {
                            return;
                        }
                        newVal = this._trimAlignValue(curVal + step);
                        break;
                    case $.ui.keyCode.DOWN:
                    case $.ui.keyCode.LEFT:
                        if (curVal === this._valueMin()) {
                            return;
                        }
                        newVal = this._trimAlignValue(curVal - step);
                        break;
                }

                this._slide(event, index, newVal);
            },
            keyup: function (event) {
                var index = $(event.target).data("ui-slider-handle-index");

                if (this._keySliding) {
                    this._keySliding = false;
                    this._stop(event, index);
                    this._change(event, index);
                    this._removeClass($(event.target), null, "ui-state-active");
                }
            }
        }
    });


    /*!
 * jQuery UI Sortable 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Sortable
//>>group: Interactions
//>>description: Enables items in a list to be sorted using the mouse.
//>>docs: http://api.jqueryui.com/sortable/
//>>demos: http://jqueryui.com/sortable/
//>>css.structure: ../../themes/base/sortable.css


    var widgetsSortable = $.widget("ui.sortable", $.ui.mouse, {
        version: "1.12.1",
        widgetEventPrefix: "sort",
        ready: false,
        options: {
            appendTo: "parent",
            axis: false,
            connectWith: false,
            containment: false,
            cursor: "auto",
            cursorAt: false,
            dropOnEmpty: true,
            forcePlaceholderSize: false,
            forceHelperSize: false,
            grid: false,
            handle: false,
            helper: "original",
            items: "> *",
            opacity: false,
            placeholder: false,
            revert: false,
            scroll: true,
            scrollSensitivity: 20,
            scrollSpeed: 20,
            scope: "default",
            tolerance: "intersect",
            zIndex: 1000,

            // Callbacks
            activate: null,
            beforeStop: null,
            change: null,
            deactivate: null,
            out: null,
            over: null,
            receive: null,
            remove: null,
            sort: null,
            start: null,
            stop: null,
            update: null
        },

        _isOverAxis: function (x, reference, size) {
            return (x >= reference) && (x < (reference + size));
        },

        _isFloating: function (item) {
            return (/left|right/).test(item.css("float")) ||
                (/inline|table-cell/).test(item.css("display"));
        },

        _create: function () {
            this.containerCache = {};
            this._addClass("ui-sortable");

            //Get the items
            this.refresh();

            //Let's determine the parent's offset
            this.offset = this.element.offset();

            //Initialize mouse events for interaction
            this._mouseInit();

            this._setHandleClassName();

            //We're ready to go
            this.ready = true;

        },

        _setOption: function (key, value) {
            this._super(key, value);

            if (key === "handle") {
                this._setHandleClassName();
            }
        },

        _setHandleClassName: function () {
            var that = this;
            this._removeClass(this.element.find(".ui-sortable-handle"), "ui-sortable-handle");
            $.each(this.items, function () {
                that._addClass(
                    this.instance.options.handle ?
                        this.item.find(this.instance.options.handle) :
                        this.item,
                    "ui-sortable-handle"
                );
            });
        },

        _destroy: function () {
            this._mouseDestroy();

            for (var i = this.items.length - 1; i >= 0; i--) {
                this.items[i].item.removeData(this.widgetName + "-item");
            }

            return this;
        },

        _mouseCapture: function (event, overrideHandle) {
            var currentItem = null,
                validHandle = false,
                that = this;

            if (this.reverting) {
                return false;
            }

            if (this.options.disabled || this.options.type === "static") {
                return false;
            }

            //We have to refresh the items data once first
            this._refreshItems(event);

            //Find out if the clicked node (or one of its parents) is a actual item in this.items
            $(event.target).parents().each(function () {
                if ($.data(this, that.widgetName + "-item") === that) {
                    currentItem = $(this);
                    return false;
                }
            });
            if ($.data(event.target, that.widgetName + "-item") === that) {
                currentItem = $(event.target);
            }

            if (!currentItem) {
                return false;
            }
            if (this.options.handle && !overrideHandle) {
                $(this.options.handle, currentItem).find("*").addBack().each(function () {
                    if (this === event.target) {
                        validHandle = true;
                    }
                });
                if (!validHandle) {
                    return false;
                }
            }

            this.currentItem = currentItem;
            this._removeCurrentsFromItems();
            return true;

        },

        _mouseStart: function (event, overrideHandle, noActivation) {

            var i, body,
                o = this.options;

            this.currentContainer = this;

            //We only need to call refreshPositions, because the refreshItems call has been moved to
            // mouseCapture
            this.refreshPositions();

            //Create and append the visible helper
            this.helper = this._createHelper(event);

            //Cache the helper size
            this._cacheHelperProportions();

            /*
		 * - Position generation -
		 * This block generates everything position related - it's the core of draggables.
		 */

            //Cache the margins of the original element
            this._cacheMargins();

            //Get the next scrolling parent
            this.scrollParent = this.helper.scrollParent();

            //The element's absolute position on the page minus margins
            this.offset = this.currentItem.offset();
            this.offset = {
                top: this.offset.top - this.margins.top,
                left: this.offset.left - this.margins.left
            };

            $.extend(this.offset, {
                click: { //Where the click happened, relative to the element
                    left: event.pageX - this.offset.left,
                    top: event.pageY - this.offset.top
                },
                parent: this._getParentOffset(),

                // This is a relative to absolute position minus the actual position calculation -
                // only used for relative positioned helper
                relative: this._getRelativeOffset()
            });

            // Only after we got the offset, we can change the helper's position to absolute
            // TODO: Still need to figure out a way to make relative sorting possible
            this.helper.css("position", "absolute");
            this.cssPosition = this.helper.css("position");

            //Generate the original position
            this.originalPosition = this._generatePosition(event);
            this.originalPageX = event.pageX;
            this.originalPageY = event.pageY;

            //Adjust the mouse offset relative to the helper if "cursorAt" is supplied
            (o.cursorAt && this._adjustOffsetFromHelper(o.cursorAt));

            //Cache the former DOM position
            this.domPosition = {
                prev: this.currentItem.prev()[0],
                parent: this.currentItem.parent()[0]
            };

            // If the helper is not the original, hide the original so it's not playing any role during
            // the drag, won't cause anything bad this way
            if (this.helper[0] !== this.currentItem[0]) {
                this.currentItem.hide();
            }

            //Create the placeholder
            this._createPlaceholder();

            //Set a containment if given in the options
            if (o.containment) {
                this._setContainment();
            }

            if (o.cursor && o.cursor !== "auto") { // cursor option
                body = this.document.find("body");

                // Support: IE
                this.storedCursor = body.css("cursor");
                body.css("cursor", o.cursor);

                this.storedStylesheet =
                    $("<style>*{ cursor: " + o.cursor + " !important; }</style>").appendTo(body);
            }

            if (o.opacity) { // opacity option
                if (this.helper.css("opacity")) {
                    this._storedOpacity = this.helper.css("opacity");
                }
                this.helper.css("opacity", o.opacity);
            }

            if (o.zIndex) { // zIndex option
                if (this.helper.css("zIndex")) {
                    this._storedZIndex = this.helper.css("zIndex");
                }
                this.helper.css("zIndex", o.zIndex);
            }

            //Prepare scrolling
            if (this.scrollParent[0] !== this.document[0] &&
                this.scrollParent[0].tagName !== "HTML") {
                this.overflowOffset = this.scrollParent.offset();
            }

            //Call callbacks
            this._trigger("start", event, this._uiHash());

            //Recache the helper size
            if (!this._preserveHelperProportions) {
                this._cacheHelperProportions();
            }

            //Post "activate" events to possible containers
            if (!noActivation) {
                for (i = this.containers.length - 1; i >= 0; i--) {
                    this.containers[i]._trigger("activate", event, this._uiHash(this));
                }
            }

            //Prepare possible droppables
            if ($.ui.ddmanager) {
                $.ui.ddmanager.current = this;
            }

            if ($.ui.ddmanager && !o.dropBehaviour) {
                $.ui.ddmanager.prepareOffsets(this, event);
            }

            this.dragging = true;

            this._addClass(this.helper, "ui-sortable-helper");

            // Execute the drag once - this causes the helper not to be visiblebefore getting its
            // correct position
            this._mouseDrag(event);
            return true;

        },

        _mouseDrag: function (event) {
            var i, item, itemElement, intersection,
                o = this.options,
                scrolled = false;

            //Compute the helpers position
            this.position = this._generatePosition(event);
            this.positionAbs = this._convertPositionTo("absolute");

            if (!this.lastPositionAbs) {
                this.lastPositionAbs = this.positionAbs;
            }

            //Do scrolling
            if (this.options.scroll) {
                if (this.scrollParent[0] !== this.document[0] &&
                    this.scrollParent[0].tagName !== "HTML") {

                    if ((this.overflowOffset.top + this.scrollParent[0].offsetHeight) -
                        event.pageY < o.scrollSensitivity) {
                        this.scrollParent[0].scrollTop =
                            scrolled = this.scrollParent[0].scrollTop + o.scrollSpeed;
                    } else if (event.pageY - this.overflowOffset.top < o.scrollSensitivity) {
                        this.scrollParent[0].scrollTop =
                            scrolled = this.scrollParent[0].scrollTop - o.scrollSpeed;
                    }

                    if ((this.overflowOffset.left + this.scrollParent[0].offsetWidth) -
                        event.pageX < o.scrollSensitivity) {
                        this.scrollParent[0].scrollLeft = scrolled =
                            this.scrollParent[0].scrollLeft + o.scrollSpeed;
                    } else if (event.pageX - this.overflowOffset.left < o.scrollSensitivity) {
                        this.scrollParent[0].scrollLeft = scrolled =
                            this.scrollParent[0].scrollLeft - o.scrollSpeed;
                    }

                } else {

                    if (event.pageY - this.document.scrollTop() < o.scrollSensitivity) {
                        scrolled = this.document.scrollTop(this.document.scrollTop() - o.scrollSpeed);
                    } else if (this.window.height() - (event.pageY - this.document.scrollTop()) <
                        o.scrollSensitivity) {
                        scrolled = this.document.scrollTop(this.document.scrollTop() + o.scrollSpeed);
                    }

                    if (event.pageX - this.document.scrollLeft() < o.scrollSensitivity) {
                        scrolled = this.document.scrollLeft(
                            this.document.scrollLeft() - o.scrollSpeed
                        );
                    } else if (this.window.width() - (event.pageX - this.document.scrollLeft()) <
                        o.scrollSensitivity) {
                        scrolled = this.document.scrollLeft(
                            this.document.scrollLeft() + o.scrollSpeed
                        );
                    }

                }

                if (scrolled !== false && $.ui.ddmanager && !o.dropBehaviour) {
                    $.ui.ddmanager.prepareOffsets(this, event);
                }
            }

            //Regenerate the absolute position used for position checks
            this.positionAbs = this._convertPositionTo("absolute");

            //Set the helper position
            if (!this.options.axis || this.options.axis !== "y") {
                this.helper[0].style.left = this.position.left + "px";
            }
            if (!this.options.axis || this.options.axis !== "x") {
                this.helper[0].style.top = this.position.top + "px";
            }

            //Rearrange
            for (i = this.items.length - 1; i >= 0; i--) {

                //Cache variables and intersection, continue if no intersection
                item = this.items[i];
                itemElement = item.item[0];
                intersection = this._intersectsWithPointer(item);
                if (!intersection) {
                    continue;
                }

                // Only put the placeholder inside the current Container, skip all
                // items from other containers. This works because when moving
                // an item from one container to another the
                // currentContainer is switched before the placeholder is moved.
                //
                // Without this, moving items in "sub-sortables" can cause
                // the placeholder to jitter between the outer and inner container.
                if (item.instance !== this.currentContainer) {
                    continue;
                }

                // Cannot intersect with itself
                // no useless actions that have been done before
                // no action if the item moved is the parent of the item checked
                if (itemElement !== this.currentItem[0] &&
                    this.placeholder[intersection === 1 ? "next" : "prev"]()[0] !== itemElement &&
                    !$.contains(this.placeholder[0], itemElement) &&
                    (this.options.type === "semi-dynamic" ?
                            !$.contains(this.element[0], itemElement) :
                            true
                    )
                ) {

                    this.direction = intersection === 1 ? "down" : "up";

                    if (this.options.tolerance === "pointer" || this._intersectsWithSides(item)) {
                        this._rearrange(event, item);
                    } else {
                        break;
                    }

                    this._trigger("change", event, this._uiHash());
                    break;
                }
            }

            //Post events to containers
            this._contactContainers(event);

            //Interconnect with droppables
            if ($.ui.ddmanager) {
                $.ui.ddmanager.drag(this, event);
            }

            //Call callbacks
            this._trigger("sort", event, this._uiHash());

            this.lastPositionAbs = this.positionAbs;
            return false;

        },

        _mouseStop: function (event, noPropagation) {

            if (!event) {
                return;
            }

            //If we are using droppables, inform the manager about the drop
            if ($.ui.ddmanager && !this.options.dropBehaviour) {
                $.ui.ddmanager.drop(this, event);
            }

            if (this.options.revert) {
                var that = this,
                    cur = this.placeholder.offset(),
                    axis = this.options.axis,
                    animation = {};

                if (!axis || axis === "x") {
                    animation.left = cur.left - this.offset.parent.left - this.margins.left +
                        (this.offsetParent[0] === this.document[0].body ?
                                0 :
                                this.offsetParent[0].scrollLeft
                        );
                }
                if (!axis || axis === "y") {
                    animation.top = cur.top - this.offset.parent.top - this.margins.top +
                        (this.offsetParent[0] === this.document[0].body ?
                                0 :
                                this.offsetParent[0].scrollTop
                        );
                }
                this.reverting = true;
                $(this.helper).animate(
                    animation,
                    parseInt(this.options.revert, 10) || 500,
                    function () {
                        that._clear(event);
                    }
                );
            } else {
                this._clear(event, noPropagation);
            }

            return false;

        },

        cancel: function () {

            if (this.dragging) {

                this._mouseUp(new $.Event("mouseup", {target: null}));

                if (this.options.helper === "original") {
                    this.currentItem.css(this._storedCSS);
                    this._removeClass(this.currentItem, "ui-sortable-helper");
                } else {
                    this.currentItem.show();
                }

                //Post deactivating events to containers
                for (var i = this.containers.length - 1; i >= 0; i--) {
                    this.containers[i]._trigger("deactivate", null, this._uiHash(this));
                    if (this.containers[i].containerCache.over) {
                        this.containers[i]._trigger("out", null, this._uiHash(this));
                        this.containers[i].containerCache.over = 0;
                    }
                }

            }

            if (this.placeholder) {

                //$(this.placeholder[0]).remove(); would have been the jQuery way - unfortunately,
                // it unbinds ALL events from the original node!
                if (this.placeholder[0].parentNode) {
                    this.placeholder[0].parentNode.removeChild(this.placeholder[0]);
                }
                if (this.options.helper !== "original" && this.helper &&
                    this.helper[0].parentNode) {
                    this.helper.remove();
                }

                $.extend(this, {
                    helper: null,
                    dragging: false,
                    reverting: false,
                    _noFinalSort: null
                });

                if (this.domPosition.prev) {
                    $(this.domPosition.prev).after(this.currentItem);
                } else {
                    $(this.domPosition.parent).prepend(this.currentItem);
                }
            }

            return this;

        },

        serialize: function (o) {

            var items = this._getItemsAsjQuery(o && o.connected),
                str = [];
            o = o || {};

            $(items).each(function () {
                var res = ($(o.item || this).attr(o.attribute || "id") || "")
                    .match(o.expression || (/(.+)[\-=_](.+)/));
                if (res) {
                    str.push(
                        (o.key || res[1] + "[]") +
                        "=" + (o.key && o.expression ? res[1] : res[2]));
                }
            });

            if (!str.length && o.key) {
                str.push(o.key + "=");
            }

            return str.join("&");

        },

        toArray: function (o) {

            var items = this._getItemsAsjQuery(o && o.connected),
                ret = [];

            o = o || {};

            items.each(function () {
                ret.push($(o.item || this).attr(o.attribute || "id") || "");
            });
            return ret;

        },

        /* Be careful with the following core functions */
        _intersectsWith: function (item) {

            var x1 = this.positionAbs.left,
                x2 = x1 + this.helperProportions.width,
                y1 = this.positionAbs.top,
                y2 = y1 + this.helperProportions.height,
                l = item.left,
                r = l + item.width,
                t = item.top,
                b = t + item.height,
                dyClick = this.offset.click.top,
                dxClick = this.offset.click.left,
                isOverElementHeight = (this.options.axis === "x") || ((y1 + dyClick) > t &&
                    (y1 + dyClick) < b),
                isOverElementWidth = (this.options.axis === "y") || ((x1 + dxClick) > l &&
                    (x1 + dxClick) < r),
                isOverElement = isOverElementHeight && isOverElementWidth;

            if (this.options.tolerance === "pointer" ||
                this.options.forcePointerForContainers ||
                (this.options.tolerance !== "pointer" &&
                    this.helperProportions[this.floating ? "width" : "height"] >
                    item[this.floating ? "width" : "height"])
            ) {
                return isOverElement;
            } else {

                return (l < x1 + (this.helperProportions.width / 2) && // Right Half
                    x2 - (this.helperProportions.width / 2) < r && // Left Half
                    t < y1 + (this.helperProportions.height / 2) && // Bottom Half
                    y2 - (this.helperProportions.height / 2) < b); // Top Half

            }
        },

        _intersectsWithPointer: function (item) {
            var verticalDirection, horizontalDirection,
                isOverElementHeight = (this.options.axis === "x") ||
                    this._isOverAxis(
                        this.positionAbs.top + this.offset.click.top, item.top, item.height),
                isOverElementWidth = (this.options.axis === "y") ||
                    this._isOverAxis(
                        this.positionAbs.left + this.offset.click.left, item.left, item.width),
                isOverElement = isOverElementHeight && isOverElementWidth;

            if (!isOverElement) {
                return false;
            }

            verticalDirection = this._getDragVerticalDirection();
            horizontalDirection = this._getDragHorizontalDirection();

            return this.floating ?
                ((horizontalDirection === "right" || verticalDirection === "down") ? 2 : 1)
                : (verticalDirection && (verticalDirection === "down" ? 2 : 1));

        },

        _intersectsWithSides: function (item) {

            var isOverBottomHalf = this._isOverAxis(this.positionAbs.top +
                this.offset.click.top, item.top + (item.height / 2), item.height),
                isOverRightHalf = this._isOverAxis(this.positionAbs.left +
                    this.offset.click.left, item.left + (item.width / 2), item.width),
                verticalDirection = this._getDragVerticalDirection(),
                horizontalDirection = this._getDragHorizontalDirection();

            if (this.floating && horizontalDirection) {
                return ((horizontalDirection === "right" && isOverRightHalf) ||
                    (horizontalDirection === "left" && !isOverRightHalf));
            } else {
                return verticalDirection && ((verticalDirection === "down" && isOverBottomHalf) ||
                    (verticalDirection === "up" && !isOverBottomHalf));
            }

        },

        _getDragVerticalDirection: function () {
            var delta = this.positionAbs.top - this.lastPositionAbs.top;
            return delta !== 0 && (delta > 0 ? "down" : "up");
        },

        _getDragHorizontalDirection: function () {
            var delta = this.positionAbs.left - this.lastPositionAbs.left;
            return delta !== 0 && (delta > 0 ? "right" : "left");
        },

        refresh: function (event) {
            this._refreshItems(event);
            this._setHandleClassName();
            this.refreshPositions();
            return this;
        },

        _connectWith: function () {
            var options = this.options;
            return options.connectWith.constructor === String ?
                [options.connectWith] :
                options.connectWith;
        },

        _getItemsAsjQuery: function (connected) {

            var i, j, cur, inst,
                items = [],
                queries = [],
                connectWith = this._connectWith();

            if (connectWith && connected) {
                for (i = connectWith.length - 1; i >= 0; i--) {
                    cur = $(connectWith[i], this.document[0]);
                    for (j = cur.length - 1; j >= 0; j--) {
                        inst = $.data(cur[j], this.widgetFullName);
                        if (inst && inst !== this && !inst.options.disabled) {
                            queries.push([$.isFunction(inst.options.items) ?
                                inst.options.items.call(inst.element) :
                                $(inst.options.items, inst.element)
                                    .not(".ui-sortable-helper")
                                    .not(".ui-sortable-placeholder"), inst]);
                        }
                    }
                }
            }

            queries.push([$.isFunction(this.options.items) ?
                this.options.items
                    .call(this.element, null, {options: this.options, item: this.currentItem}) :
                $(this.options.items, this.element)
                    .not(".ui-sortable-helper")
                    .not(".ui-sortable-placeholder"), this]);

            function addItems() {
                items.push(this);
            }

            for (i = queries.length - 1; i >= 0; i--) {
                queries[i][0].each(addItems);
            }

            return $(items);

        },

        _removeCurrentsFromItems: function () {

            var list = this.currentItem.find(":data(" + this.widgetName + "-item)");

            this.items = $.grep(this.items, function (item) {
                for (var j = 0; j < list.length; j++) {
                    if (list[j] === item.item[0]) {
                        return false;
                    }
                }
                return true;
            });

        },

        _refreshItems: function (event) {

            this.items = [];
            this.containers = [this];

            var i, j, cur, inst, targetData, _queries, item, queriesLength,
                items = this.items,
                queries = [[$.isFunction(this.options.items) ?
                    this.options.items.call(this.element[0], event, {item: this.currentItem}) :
                    $(this.options.items, this.element), this]],
                connectWith = this._connectWith();

            //Shouldn't be run the first time through due to massive slow-down
            if (connectWith && this.ready) {
                for (i = connectWith.length - 1; i >= 0; i--) {
                    cur = $(connectWith[i], this.document[0]);
                    for (j = cur.length - 1; j >= 0; j--) {
                        inst = $.data(cur[j], this.widgetFullName);
                        if (inst && inst !== this && !inst.options.disabled) {
                            queries.push([$.isFunction(inst.options.items) ?
                                inst.options.items
                                    .call(inst.element[0], event, {item: this.currentItem}) :
                                $(inst.options.items, inst.element), inst]);
                            this.containers.push(inst);
                        }
                    }
                }
            }

            for (i = queries.length - 1; i >= 0; i--) {
                targetData = queries[i][1];
                _queries = queries[i][0];

                for (j = 0, queriesLength = _queries.length; j < queriesLength; j++) {
                    item = $(_queries[j]);

                    // Data for target checking (mouse manager)
                    item.data(this.widgetName + "-item", targetData);

                    items.push({
                        item: item,
                        instance: targetData,
                        width: 0, height: 0,
                        left: 0, top: 0
                    });
                }
            }

        },

        refreshPositions: function (fast) {

            // Determine whether items are being displayed horizontally
            this.floating = this.items.length ?
                this.options.axis === "x" || this._isFloating(this.items[0].item) :
                false;

            //This has to be redone because due to the item being moved out/into the offsetParent,
            // the offsetParent's position will change
            if (this.offsetParent && this.helper) {
                this.offset.parent = this._getParentOffset();
            }

            var i, item, t, p;

            for (i = this.items.length - 1; i >= 0; i--) {
                item = this.items[i];

                //We ignore calculating positions of all connected containers when we're not over them
                if (item.instance !== this.currentContainer && this.currentContainer &&
                    item.item[0] !== this.currentItem[0]) {
                    continue;
                }

                t = this.options.toleranceElement ?
                    $(this.options.toleranceElement, item.item) :
                    item.item;

                if (!fast) {
                    item.width = t.outerWidth();
                    item.height = t.outerHeight();
                }

                p = t.offset();
                item.left = p.left;
                item.top = p.top;
            }

            if (this.options.custom && this.options.custom.refreshContainers) {
                this.options.custom.refreshContainers.call(this);
            } else {
                for (i = this.containers.length - 1; i >= 0; i--) {
                    p = this.containers[i].element.offset();
                    this.containers[i].containerCache.left = p.left;
                    this.containers[i].containerCache.top = p.top;
                    this.containers[i].containerCache.width =
                        this.containers[i].element.outerWidth();
                    this.containers[i].containerCache.height =
                        this.containers[i].element.outerHeight();
                }
            }

            return this;
        },

        _createPlaceholder: function (that) {
            that = that || this;
            var className,
                o = that.options;

            if (!o.placeholder || o.placeholder.constructor === String) {
                className = o.placeholder;
                o.placeholder = {
                    element: function () {

                        var nodeName = that.currentItem[0].nodeName.toLowerCase(),
                            element = $("<" + nodeName + ">", that.document[0]);

                        that._addClass(element, "ui-sortable-placeholder",
                            className || that.currentItem[0].className)
                            ._removeClass(element, "ui-sortable-helper");

                        if (nodeName === "tbody") {
                            that._createTrPlaceholder(
                                that.currentItem.find("tr").eq(0),
                                $("<tr>", that.document[0]).appendTo(element)
                            );
                        } else if (nodeName === "tr") {
                            that._createTrPlaceholder(that.currentItem, element);
                        } else if (nodeName === "img") {
                            element.attr("src", that.currentItem.attr("src"));
                        }

                        if (!className) {
                            element.css("visibility", "hidden");
                        }

                        return element;
                    },
                    update: function (container, p) {

                        // 1. If a className is set as 'placeholder option, we don't force sizes -
                        // the class is responsible for that
                        // 2. The option 'forcePlaceholderSize can be enabled to force it even if a
                        // class name is specified
                        if (className && !o.forcePlaceholderSize) {
                            return;
                        }

                        //If the element doesn't have a actual height by itself (without styles coming
                        // from a stylesheet), it receives the inline height from the dragged item
                        if (!p.height()) {
                            p.height(
                                that.currentItem.innerHeight() -
                                parseInt(that.currentItem.css("paddingTop") || 0, 10) -
                                parseInt(that.currentItem.css("paddingBottom") || 0, 10));
                        }
                        if (!p.width()) {
                            p.width(
                                that.currentItem.innerWidth() -
                                parseInt(that.currentItem.css("paddingLeft") || 0, 10) -
                                parseInt(that.currentItem.css("paddingRight") || 0, 10));
                        }
                    }
                };
            }

            //Create the placeholder
            that.placeholder = $(o.placeholder.element.call(that.element, that.currentItem));

            //Append it after the actual current item
            that.currentItem.after(that.placeholder);

            //Update the size of the placeholder (TODO: Logic to fuzzy, see line 316/317)
            o.placeholder.update(that, that.placeholder);

        },

        _createTrPlaceholder: function (sourceTr, targetTr) {
            var that = this;

            sourceTr.children().each(function () {
                $("<td>&#160;</td>", that.document[0])
                    .attr("colspan", $(this).attr("colspan") || 1)
                    .appendTo(targetTr);
            });
        },

        _contactContainers: function (event) {
            var i, j, dist, itemWithLeastDistance, posProperty, sizeProperty, cur, nearBottom,
                floating, axis,
                innermostContainer = null,
                innermostIndex = null;

            // Get innermost container that intersects with item
            for (i = this.containers.length - 1; i >= 0; i--) {

                // Never consider a container that's located within the item itself
                if ($.contains(this.currentItem[0], this.containers[i].element[0])) {
                    continue;
                }

                if (this._intersectsWith(this.containers[i].containerCache)) {

                    // If we've already found a container and it's more "inner" than this, then continue
                    if (innermostContainer &&
                        $.contains(
                            this.containers[i].element[0],
                            innermostContainer.element[0])) {
                        continue;
                    }

                    innermostContainer = this.containers[i];
                    innermostIndex = i;

                } else {

                    // container doesn't intersect. trigger "out" event if necessary
                    if (this.containers[i].containerCache.over) {
                        this.containers[i]._trigger("out", event, this._uiHash(this));
                        this.containers[i].containerCache.over = 0;
                    }
                }

            }

            // If no intersecting containers found, return
            if (!innermostContainer) {
                return;
            }

            // Move the item into the container if it's not there already
            if (this.containers.length === 1) {
                if (!this.containers[innermostIndex].containerCache.over) {
                    this.containers[innermostIndex]._trigger("over", event, this._uiHash(this));
                    this.containers[innermostIndex].containerCache.over = 1;
                }
            } else {

                // When entering a new container, we will find the item with the least distance and
                // append our item near it
                dist = 10000;
                itemWithLeastDistance = null;
                floating = innermostContainer.floating || this._isFloating(this.currentItem);
                posProperty = floating ? "left" : "top";
                sizeProperty = floating ? "width" : "height";
                axis = floating ? "pageX" : "pageY";

                for (j = this.items.length - 1; j >= 0; j--) {
                    if (!$.contains(
                        this.containers[innermostIndex].element[0], this.items[j].item[0])
                    ) {
                        continue;
                    }
                    if (this.items[j].item[0] === this.currentItem[0]) {
                        continue;
                    }

                    cur = this.items[j].item.offset()[posProperty];
                    nearBottom = false;
                    if (event[axis] - cur > this.items[j][sizeProperty] / 2) {
                        nearBottom = true;
                    }

                    if (Math.abs(event[axis] - cur) < dist) {
                        dist = Math.abs(event[axis] - cur);
                        itemWithLeastDistance = this.items[j];
                        this.direction = nearBottom ? "up" : "down";
                    }
                }

                //Check if dropOnEmpty is enabled
                if (!itemWithLeastDistance && !this.options.dropOnEmpty) {
                    return;
                }

                if (this.currentContainer === this.containers[innermostIndex]) {
                    if (!this.currentContainer.containerCache.over) {
                        this.containers[innermostIndex]._trigger("over", event, this._uiHash());
                        this.currentContainer.containerCache.over = 1;
                    }
                    return;
                }

                itemWithLeastDistance ?
                    this._rearrange(event, itemWithLeastDistance, null, true) :
                    this._rearrange(event, null, this.containers[innermostIndex].element, true);
                this._trigger("change", event, this._uiHash());
                this.containers[innermostIndex]._trigger("change", event, this._uiHash(this));
                this.currentContainer = this.containers[innermostIndex];

                //Update the placeholder
                this.options.placeholder.update(this.currentContainer, this.placeholder);

                this.containers[innermostIndex]._trigger("over", event, this._uiHash(this));
                this.containers[innermostIndex].containerCache.over = 1;
            }

        },

        _createHelper: function (event) {

            var o = this.options,
                helper = $.isFunction(o.helper) ?
                    $(o.helper.apply(this.element[0], [event, this.currentItem])) :
                    (o.helper === "clone" ? this.currentItem.clone() : this.currentItem);

            //Add the helper to the DOM if that didn't happen already
            if (!helper.parents("body").length) {
                $(o.appendTo !== "parent" ?
                    o.appendTo :
                    this.currentItem[0].parentNode)[0].appendChild(helper[0]);
            }

            if (helper[0] === this.currentItem[0]) {
                this._storedCSS = {
                    width: this.currentItem[0].style.width,
                    height: this.currentItem[0].style.height,
                    position: this.currentItem.css("position"),
                    top: this.currentItem.css("top"),
                    left: this.currentItem.css("left")
                };
            }

            if (!helper[0].style.width || o.forceHelperSize) {
                helper.width(this.currentItem.width());
            }
            if (!helper[0].style.height || o.forceHelperSize) {
                helper.height(this.currentItem.height());
            }

            return helper;

        },

        _adjustOffsetFromHelper: function (obj) {
            if (typeof obj === "string") {
                obj = obj.split(" ");
            }
            if ($.isArray(obj)) {
                obj = {left: +obj[0], top: +obj[1] || 0};
            }
            if ("left" in obj) {
                this.offset.click.left = obj.left + this.margins.left;
            }
            if ("right" in obj) {
                this.offset.click.left = this.helperProportions.width - obj.right + this.margins.left;
            }
            if ("top" in obj) {
                this.offset.click.top = obj.top + this.margins.top;
            }
            if ("bottom" in obj) {
                this.offset.click.top = this.helperProportions.height - obj.bottom + this.margins.top;
            }
        },

        _getParentOffset: function () {

            //Get the offsetParent and cache its position
            this.offsetParent = this.helper.offsetParent();
            var po = this.offsetParent.offset();

            // This is a special case where we need to modify a offset calculated on start, since the
            // following happened:
            // 1. The position of the helper is absolute, so it's position is calculated based on the
            // next positioned parent
            // 2. The actual offset parent is a child of the scroll parent, and the scroll parent isn't
            // the document, which means that the scroll is included in the initial calculation of the
            // offset of the parent, and never recalculated upon drag
            if (this.cssPosition === "absolute" && this.scrollParent[0] !== this.document[0] &&
                $.contains(this.scrollParent[0], this.offsetParent[0])) {
                po.left += this.scrollParent.scrollLeft();
                po.top += this.scrollParent.scrollTop();
            }

            // This needs to be actually done for all browsers, since pageX/pageY includes this
            // information with an ugly IE fix
            if (this.offsetParent[0] === this.document[0].body ||
                (this.offsetParent[0].tagName &&
                    this.offsetParent[0].tagName.toLowerCase() === "html" && $.ui.ie)) {
                po = {top: 0, left: 0};
            }

            return {
                top: po.top + (parseInt(this.offsetParent.css("borderTopWidth"), 10) || 0),
                left: po.left + (parseInt(this.offsetParent.css("borderLeftWidth"), 10) || 0)
            };

        },

        _getRelativeOffset: function () {

            if (this.cssPosition === "relative") {
                var p = this.currentItem.position();
                return {
                    top: p.top - (parseInt(this.helper.css("top"), 10) || 0) +
                        this.scrollParent.scrollTop(),
                    left: p.left - (parseInt(this.helper.css("left"), 10) || 0) +
                        this.scrollParent.scrollLeft()
                };
            } else {
                return {top: 0, left: 0};
            }

        },

        _cacheMargins: function () {
            this.margins = {
                left: (parseInt(this.currentItem.css("marginLeft"), 10) || 0),
                top: (parseInt(this.currentItem.css("marginTop"), 10) || 0)
            };
        },

        _cacheHelperProportions: function () {
            this.helperProportions = {
                width: this.helper.outerWidth(),
                height: this.helper.outerHeight()
            };
        },

        _setContainment: function () {

            var ce, co, over,
                o = this.options;
            if (o.containment === "parent") {
                o.containment = this.helper[0].parentNode;
            }
            if (o.containment === "document" || o.containment === "window") {
                this.containment = [
                    0 - this.offset.relative.left - this.offset.parent.left,
                    0 - this.offset.relative.top - this.offset.parent.top,
                    o.containment === "document" ?
                        this.document.width() :
                        this.window.width() - this.helperProportions.width - this.margins.left,
                    (o.containment === "document" ?
                            (this.document.height() || document.body.parentNode.scrollHeight) :
                            this.window.height() || this.document[0].body.parentNode.scrollHeight
                    ) - this.helperProportions.height - this.margins.top
                ];
            }

            if (!(/^(document|window|parent)$/).test(o.containment)) {
                ce = $(o.containment)[0];
                co = $(o.containment).offset();
                over = ($(ce).css("overflow") !== "hidden");

                this.containment = [
                    co.left + (parseInt($(ce).css("borderLeftWidth"), 10) || 0) +
                    (parseInt($(ce).css("paddingLeft"), 10) || 0) - this.margins.left,
                    co.top + (parseInt($(ce).css("borderTopWidth"), 10) || 0) +
                    (parseInt($(ce).css("paddingTop"), 10) || 0) - this.margins.top,
                    co.left + (over ? Math.max(ce.scrollWidth, ce.offsetWidth) : ce.offsetWidth) -
                    (parseInt($(ce).css("borderLeftWidth"), 10) || 0) -
                    (parseInt($(ce).css("paddingRight"), 10) || 0) -
                    this.helperProportions.width - this.margins.left,
                    co.top + (over ? Math.max(ce.scrollHeight, ce.offsetHeight) : ce.offsetHeight) -
                    (parseInt($(ce).css("borderTopWidth"), 10) || 0) -
                    (parseInt($(ce).css("paddingBottom"), 10) || 0) -
                    this.helperProportions.height - this.margins.top
                ];
            }

        },

        _convertPositionTo: function (d, pos) {

            if (!pos) {
                pos = this.position;
            }
            var mod = d === "absolute" ? 1 : -1,
                scroll = this.cssPosition === "absolute" &&
                !(this.scrollParent[0] !== this.document[0] &&
                    $.contains(this.scrollParent[0], this.offsetParent[0])) ?
                    this.offsetParent :
                    this.scrollParent,
                scrollIsRootNode = (/(html|body)/i).test(scroll[0].tagName);

            return {
                top: (

                    // The absolute mouse position
                    pos.top +

                    // Only for relative positioned nodes: Relative offset from element to offset parent
                    this.offset.relative.top * mod +

                    // The offsetParent's offset without borders (offset + border)
                    this.offset.parent.top * mod -
                    ((this.cssPosition === "fixed" ?
                        -this.scrollParent.scrollTop() :
                        (scrollIsRootNode ? 0 : scroll.scrollTop())) * mod)
                ),
                left: (

                    // The absolute mouse position
                    pos.left +

                    // Only for relative positioned nodes: Relative offset from element to offset parent
                    this.offset.relative.left * mod +

                    // The offsetParent's offset without borders (offset + border)
                    this.offset.parent.left * mod -
                    ((this.cssPosition === "fixed" ?
                        -this.scrollParent.scrollLeft() : scrollIsRootNode ? 0 :
                            scroll.scrollLeft()) * mod)
                )
            };

        },

        _generatePosition: function (event) {

            var top, left,
                o = this.options,
                pageX = event.pageX,
                pageY = event.pageY,
                scroll = this.cssPosition === "absolute" &&
                !(this.scrollParent[0] !== this.document[0] &&
                    $.contains(this.scrollParent[0], this.offsetParent[0])) ?
                    this.offsetParent :
                    this.scrollParent,
                scrollIsRootNode = (/(html|body)/i).test(scroll[0].tagName);

            // This is another very weird special case that only happens for relative elements:
            // 1. If the css position is relative
            // 2. and the scroll parent is the document or similar to the offset parent
            // we have to refresh the relative offset during the scroll so there are no jumps
            if (this.cssPosition === "relative" && !(this.scrollParent[0] !== this.document[0] &&
                this.scrollParent[0] !== this.offsetParent[0])) {
                this.offset.relative = this._getRelativeOffset();
            }

            /*
		 * - Position constraining -
		 * Constrain the position to a mix of grid, containment.
		 */

            if (this.originalPosition) { //If we are not dragging yet, we won't check for options

                if (this.containment) {
                    if (event.pageX - this.offset.click.left < this.containment[0]) {
                        pageX = this.containment[0] + this.offset.click.left;
                    }
                    if (event.pageY - this.offset.click.top < this.containment[1]) {
                        pageY = this.containment[1] + this.offset.click.top;
                    }
                    if (event.pageX - this.offset.click.left > this.containment[2]) {
                        pageX = this.containment[2] + this.offset.click.left;
                    }
                    if (event.pageY - this.offset.click.top > this.containment[3]) {
                        pageY = this.containment[3] + this.offset.click.top;
                    }
                }

                if (o.grid) {
                    top = this.originalPageY + Math.round((pageY - this.originalPageY) /
                        o.grid[1]) * o.grid[1];
                    pageY = this.containment ?
                        ((top - this.offset.click.top >= this.containment[1] &&
                            top - this.offset.click.top <= this.containment[3]) ?
                            top :
                            ((top - this.offset.click.top >= this.containment[1]) ?
                                top - o.grid[1] : top + o.grid[1])) :
                        top;

                    left = this.originalPageX + Math.round((pageX - this.originalPageX) /
                        o.grid[0]) * o.grid[0];
                    pageX = this.containment ?
                        ((left - this.offset.click.left >= this.containment[0] &&
                            left - this.offset.click.left <= this.containment[2]) ?
                            left :
                            ((left - this.offset.click.left >= this.containment[0]) ?
                                left - o.grid[0] : left + o.grid[0])) :
                        left;
                }

            }

            return {
                top: (

                    // The absolute mouse position
                    pageY -

                    // Click offset (relative to the element)
                    this.offset.click.top -

                    // Only for relative positioned nodes: Relative offset from element to offset parent
                    this.offset.relative.top -

                    // The offsetParent's offset without borders (offset + border)
                    this.offset.parent.top +
                    ((this.cssPosition === "fixed" ?
                        -this.scrollParent.scrollTop() :
                        (scrollIsRootNode ? 0 : scroll.scrollTop())))
                ),
                left: (

                    // The absolute mouse position
                    pageX -

                    // Click offset (relative to the element)
                    this.offset.click.left -

                    // Only for relative positioned nodes: Relative offset from element to offset parent
                    this.offset.relative.left -

                    // The offsetParent's offset without borders (offset + border)
                    this.offset.parent.left +
                    ((this.cssPosition === "fixed" ?
                        -this.scrollParent.scrollLeft() :
                        scrollIsRootNode ? 0 : scroll.scrollLeft()))
                )
            };

        },

        _rearrange: function (event, i, a, hardRefresh) {

            a ? a[0].appendChild(this.placeholder[0]) :
                i.item[0].parentNode.insertBefore(this.placeholder[0],
                    (this.direction === "down" ? i.item[0] : i.item[0].nextSibling));

            //Various things done here to improve the performance:
            // 1. we create a setTimeout, that calls refreshPositions
            // 2. on the instance, we have a counter variable, that get's higher after every append
            // 3. on the local scope, we copy the counter variable, and check in the timeout,
            // if it's still the same
            // 4. this lets only the last addition to the timeout stack through
            this.counter = this.counter ? ++this.counter : 1;
            var counter = this.counter;

            this._delay(function () {
                if (counter === this.counter) {

                    //Precompute after each DOM insertion, NOT on mousemove
                    this.refreshPositions(!hardRefresh);
                }
            });

        },

        _clear: function (event, noPropagation) {

            this.reverting = false;

            // We delay all events that have to be triggered to after the point where the placeholder
            // has been removed and everything else normalized again
            var i,
                delayedTriggers = [];

            // We first have to update the dom position of the actual currentItem
            // Note: don't do it if the current item is already removed (by a user), or it gets
            // reappended (see #4088)
            if (!this._noFinalSort && this.currentItem.parent().length) {
                this.placeholder.before(this.currentItem);
            }
            this._noFinalSort = null;

            if (this.helper[0] === this.currentItem[0]) {
                for (i in this._storedCSS) {
                    if (this._storedCSS[i] === "auto" || this._storedCSS[i] === "static") {
                        this._storedCSS[i] = "";
                    }
                }
                this.currentItem.css(this._storedCSS);
                this._removeClass(this.currentItem, "ui-sortable-helper");
            } else {
                this.currentItem.show();
            }

            if (this.fromOutside && !noPropagation) {
                delayedTriggers.push(function (event) {
                    this._trigger("receive", event, this._uiHash(this.fromOutside));
                });
            }
            if ((this.fromOutside ||
                this.domPosition.prev !==
                this.currentItem.prev().not(".ui-sortable-helper")[0] ||
                this.domPosition.parent !== this.currentItem.parent()[0]) && !noPropagation) {

                // Trigger update callback if the DOM position has changed
                delayedTriggers.push(function (event) {
                    this._trigger("update", event, this._uiHash());
                });
            }

            // Check if the items Container has Changed and trigger appropriate
            // events.
            if (this !== this.currentContainer) {
                if (!noPropagation) {
                    delayedTriggers.push(function (event) {
                        this._trigger("remove", event, this._uiHash());
                    });
                    delayedTriggers.push((function (c) {
                        return function (event) {
                            c._trigger("receive", event, this._uiHash(this));
                        };
                    }).call(this, this.currentContainer));
                    delayedTriggers.push((function (c) {
                        return function (event) {
                            c._trigger("update", event, this._uiHash(this));
                        };
                    }).call(this, this.currentContainer));
                }
            }

            //Post events to containers
            function delayEvent(type, instance, container) {
                return function (event) {
                    container._trigger(type, event, instance._uiHash(instance));
                };
            }

            for (i = this.containers.length - 1; i >= 0; i--) {
                if (!noPropagation) {
                    delayedTriggers.push(delayEvent("deactivate", this, this.containers[i]));
                }
                if (this.containers[i].containerCache.over) {
                    delayedTriggers.push(delayEvent("out", this, this.containers[i]));
                    this.containers[i].containerCache.over = 0;
                }
            }

            //Do what was originally in plugins
            if (this.storedCursor) {
                this.document.find("body").css("cursor", this.storedCursor);
                this.storedStylesheet.remove();
            }
            if (this._storedOpacity) {
                this.helper.css("opacity", this._storedOpacity);
            }
            if (this._storedZIndex) {
                this.helper.css("zIndex", this._storedZIndex === "auto" ? "" : this._storedZIndex);
            }

            this.dragging = false;

            if (!noPropagation) {
                this._trigger("beforeStop", event, this._uiHash());
            }

            //$(this.placeholder[0]).remove(); would have been the jQuery way - unfortunately,
            // it unbinds ALL events from the original node!
            this.placeholder[0].parentNode.removeChild(this.placeholder[0]);

            if (!this.cancelHelperRemoval) {
                if (this.helper[0] !== this.currentItem[0]) {
                    this.helper.remove();
                }
                this.helper = null;
            }

            if (!noPropagation) {
                for (i = 0; i < delayedTriggers.length; i++) {

                    // Trigger all delayed events
                    delayedTriggers[i].call(this, event);
                }
                this._trigger("stop", event, this._uiHash());
            }

            this.fromOutside = false;
            return !this.cancelHelperRemoval;

        },

        _trigger: function () {
            if ($.Widget.prototype._trigger.apply(this, arguments) === false) {
                this.cancel();
            }
        },

        _uiHash: function (_inst) {
            var inst = _inst || this;
            return {
                helper: inst.helper,
                placeholder: inst.placeholder || $([]),
                position: inst.position,
                originalPosition: inst.originalPosition,
                offset: inst.positionAbs,
                item: inst.currentItem,
                sender: _inst ? _inst.element : null
            };
        }

    });


    /*!
 * jQuery UI Spinner 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Spinner
//>>group: Widgets
//>>description: Displays buttons to easily input numbers via the keyboard or mouse.
//>>docs: http://api.jqueryui.com/spinner/
//>>demos: http://jqueryui.com/spinner/
//>>css.structure: ../../themes/base/core.css
//>>css.structure: ../../themes/base/spinner.css
//>>css.theme: ../../themes/base/theme.css


    function spinnerModifer(fn) {
        return function () {
            var previous = this.element.val();
            fn.apply(this, arguments);
            this._refresh();
            if (previous !== this.element.val()) {
                this._trigger("change");
            }
        };
    }

    $.widget("ui.spinner", {
        version: "1.12.1",
        defaultElement: "<input>",
        widgetEventPrefix: "spin",
        options: {
            classes: {
                "ui-spinner": "ui-corner-all",
                "ui-spinner-down": "ui-corner-br",
                "ui-spinner-up": "ui-corner-tr"
            },
            culture: null,
            icons: {
                down: "ui-icon-triangle-1-s",
                up: "ui-icon-triangle-1-n"
            },
            incremental: true,
            max: null,
            min: null,
            numberFormat: null,
            page: 10,
            step: 1,

            change: null,
            spin: null,
            start: null,
            stop: null
        },

        _create: function () {

            // handle string values that need to be parsed
            this._setOption("max", this.options.max);
            this._setOption("min", this.options.min);
            this._setOption("step", this.options.step);

            // Only format if there is a value, prevents the field from being marked
            // as invalid in Firefox, see #9573.
            if (this.value() !== "") {

                // Format the value, but don't constrain.
                this._value(this.element.val(), true);
            }

            this._draw();
            this._on(this._events);
            this._refresh();

            // Turning off autocomplete prevents the browser from remembering the
            // value when navigating through history, so we re-enable autocomplete
            // if the page is unloaded before the widget is destroyed. #7790
            this._on(this.window, {
                beforeunload: function () {
                    this.element.removeAttr("autocomplete");
                }
            });
        },

        _getCreateOptions: function () {
            var options = this._super();
            var element = this.element;

            $.each(["min", "max", "step"], function (i, option) {
                var value = element.attr(option);
                if (value != null && value.length) {
                    options[option] = value;
                }
            });

            return options;
        },

        _events: {
            keydown: function (event) {
                if (this._start(event) && this._keydown(event)) {
                    event.preventDefault();
                }
            },
            keyup: "_stop",
            focus: function () {
                this.previous = this.element.val();
            },
            blur: function (event) {
                if (this.cancelBlur) {
                    delete this.cancelBlur;
                    return;
                }

                this._stop();
                this._refresh();
                if (this.previous !== this.element.val()) {
                    this._trigger("change", event);
                }
            },
            mousewheel: function (event, delta) {
                if (!delta) {
                    return;
                }
                if (!this.spinning && !this._start(event)) {
                    return false;
                }

                this._spin((delta > 0 ? 1 : -1) * this.options.step, event);
                clearTimeout(this.mousewheelTimer);
                this.mousewheelTimer = this._delay(function () {
                    if (this.spinning) {
                        this._stop(event);
                    }
                }, 100);
                event.preventDefault();
            },
            "mousedown .ui-spinner-button": function (event) {
                var previous;

                // We never want the buttons to have focus; whenever the user is
                // interacting with the spinner, the focus should be on the input.
                // If the input is focused then this.previous is properly set from
                // when the input first received focus. If the input is not focused
                // then we need to set this.previous based on the value before spinning.
                previous = this.element[0] === $.ui.safeActiveElement(this.document[0]) ?
                    this.previous : this.element.val();

                function checkFocus() {
                    var isActive = this.element[0] === $.ui.safeActiveElement(this.document[0]);
                    if (!isActive) {
                        this.element.trigger("focus");
                        this.previous = previous;

                        // support: IE
                        // IE sets focus asynchronously, so we need to check if focus
                        // moved off of the input because the user clicked on the button.
                        this._delay(function () {
                            this.previous = previous;
                        });
                    }
                }

                // Ensure focus is on (or stays on) the text field
                event.preventDefault();
                checkFocus.call(this);

                // Support: IE
                // IE doesn't prevent moving focus even with event.preventDefault()
                // so we set a flag to know when we should ignore the blur event
                // and check (again) if focus moved off of the input.
                this.cancelBlur = true;
                this._delay(function () {
                    delete this.cancelBlur;
                    checkFocus.call(this);
                });

                if (this._start(event) === false) {
                    return;
                }

                this._repeat(null, $(event.currentTarget)
                    .hasClass("ui-spinner-up") ? 1 : -1, event);
            },
            "mouseup .ui-spinner-button": "_stop",
            "mouseenter .ui-spinner-button": function (event) {

                // button will add ui-state-active if mouse was down while mouseleave and kept down
                if (!$(event.currentTarget).hasClass("ui-state-active")) {
                    return;
                }

                if (this._start(event) === false) {
                    return false;
                }
                this._repeat(null, $(event.currentTarget)
                    .hasClass("ui-spinner-up") ? 1 : -1, event);
            },

            // TODO: do we really want to consider this a stop?
            // shouldn't we just stop the repeater and wait until mouseup before
            // we trigger the stop event?
            "mouseleave .ui-spinner-button": "_stop"
        },

        // Support mobile enhanced option and make backcompat more sane
        _enhance: function () {
            this.uiSpinner = this.element
                .attr("autocomplete", "off")
                .wrap("<span>")
                .parent()

                // Add buttons
                .append(
                    "<a></a><a></a>"
                );
        },

        _draw: function () {
            this._enhance();

            this._addClass(this.uiSpinner, "ui-spinner", "ui-widget ui-widget-content");
            this._addClass("ui-spinner-input");

            this.element.attr("role", "spinbutton");

            // Button bindings
            this.buttons = this.uiSpinner.children("a")
                .attr("tabIndex", -1)
                .attr("aria-hidden", true)
                .button({
                    classes: {
                        "ui-button": ""
                    }
                });

            // TODO: Right now button does not support classes this is already updated in button PR
            this._removeClass(this.buttons, "ui-corner-all");

            this._addClass(this.buttons.first(), "ui-spinner-button ui-spinner-up");
            this._addClass(this.buttons.last(), "ui-spinner-button ui-spinner-down");
            this.buttons.first().button({
                "icon": this.options.icons.up,
                "showLabel": false
            });
            this.buttons.last().button({
                "icon": this.options.icons.down,
                "showLabel": false
            });

            // IE 6 doesn't understand height: 50% for the buttons
            // unless the wrapper has an explicit height
            if (this.buttons.height() > Math.ceil(this.uiSpinner.height() * 0.5) &&
                this.uiSpinner.height() > 0) {
                this.uiSpinner.height(this.uiSpinner.height());
            }
        },

        _keydown: function (event) {
            var options = this.options,
                keyCode = $.ui.keyCode;

            switch (event.keyCode) {
                case keyCode.UP:
                    this._repeat(null, 1, event);
                    return true;
                case keyCode.DOWN:
                    this._repeat(null, -1, event);
                    return true;
                case keyCode.PAGE_UP:
                    this._repeat(null, options.page, event);
                    return true;
                case keyCode.PAGE_DOWN:
                    this._repeat(null, -options.page, event);
                    return true;
            }

            return false;
        },

        _start: function (event) {
            if (!this.spinning && this._trigger("start", event) === false) {
                return false;
            }

            if (!this.counter) {
                this.counter = 1;
            }
            this.spinning = true;
            return true;
        },

        _repeat: function (i, steps, event) {
            i = i || 500;

            clearTimeout(this.timer);
            this.timer = this._delay(function () {
                this._repeat(40, steps, event);
            }, i);

            this._spin(steps * this.options.step, event);
        },

        _spin: function (step, event) {
            var value = this.value() || 0;

            if (!this.counter) {
                this.counter = 1;
            }

            value = this._adjustValue(value + step * this._increment(this.counter));

            if (!this.spinning || this._trigger("spin", event, {value: value}) !== false) {
                this._value(value);
                this.counter++;
            }
        },

        _increment: function (i) {
            var incremental = this.options.incremental;

            if (incremental) {
                return $.isFunction(incremental) ?
                    incremental(i) :
                    Math.floor(i * i * i / 50000 - i * i / 500 + 17 * i / 200 + 1);
            }

            return 1;
        },

        _precision: function () {
            var precision = this._precisionOf(this.options.step);
            if (this.options.min !== null) {
                precision = Math.max(precision, this._precisionOf(this.options.min));
            }
            return precision;
        },

        _precisionOf: function (num) {
            var str = num.toString(),
                decimal = str.indexOf(".");
            return decimal === -1 ? 0 : str.length - decimal - 1;
        },

        _adjustValue: function (value) {
            var base, aboveMin,
                options = this.options;

            // Make sure we're at a valid step
            // - find out where we are relative to the base (min or 0)
            base = options.min !== null ? options.min : 0;
            aboveMin = value - base;

            // - round to the nearest step
            aboveMin = Math.round(aboveMin / options.step) * options.step;

            // - rounding is based on 0, so adjust back to our base
            value = base + aboveMin;

            // Fix precision from bad JS floating point math
            value = parseFloat(value.toFixed(this._precision()));

            // Clamp the value
            if (options.max !== null && value > options.max) {
                return options.max;
            }
            if (options.min !== null && value < options.min) {
                return options.min;
            }

            return value;
        },

        _stop: function (event) {
            if (!this.spinning) {
                return;
            }

            clearTimeout(this.timer);
            clearTimeout(this.mousewheelTimer);
            this.counter = 0;
            this.spinning = false;
            this._trigger("stop", event);
        },

        _setOption: function (key, value) {
            var prevValue, first, last;

            if (key === "culture" || key === "numberFormat") {
                prevValue = this._parse(this.element.val());
                this.options[key] = value;
                this.element.val(this._format(prevValue));
                return;
            }

            if (key === "max" || key === "min" || key === "step") {
                if (typeof value === "string") {
                    value = this._parse(value);
                }
            }
            if (key === "icons") {
                first = this.buttons.first().find(".ui-icon");
                this._removeClass(first, null, this.options.icons.up);
                this._addClass(first, null, value.up);
                last = this.buttons.last().find(".ui-icon");
                this._removeClass(last, null, this.options.icons.down);
                this._addClass(last, null, value.down);
            }

            this._super(key, value);
        },

        _setOptionDisabled: function (value) {
            this._super(value);

            this._toggleClass(this.uiSpinner, null, "ui-state-disabled", !!value);
            this.element.prop("disabled", !!value);
            this.buttons.button(value ? "disable" : "enable");
        },

        _setOptions: spinnerModifer(function (options) {
            this._super(options);
        }),

        _parse: function (val) {
            if (typeof val === "string" && val !== "") {
                val = window.Globalize && this.options.numberFormat ?
                    Globalize.parseFloat(val, 10, this.options.culture) : +val;
            }
            return val === "" || isNaN(val) ? null : val;
        },

        _format: function (value) {
            if (value === "") {
                return "";
            }
            return window.Globalize && this.options.numberFormat ?
                Globalize.format(value, this.options.numberFormat, this.options.culture) :
                value;
        },

        _refresh: function () {
            this.element.attr({
                "aria-valuemin": this.options.min,
                "aria-valuemax": this.options.max,

                // TODO: what should we do with values that can't be parsed?
                "aria-valuenow": this._parse(this.element.val())
            });
        },

        isValid: function () {
            var value = this.value();

            // Null is invalid
            if (value === null) {
                return false;
            }

            // If value gets adjusted, it's invalid
            return value === this._adjustValue(value);
        },

        // Update the value without triggering change
        _value: function (value, allowAny) {
            var parsed;
            if (value !== "") {
                parsed = this._parse(value);
                if (parsed !== null) {
                    if (!allowAny) {
                        parsed = this._adjustValue(parsed);
                    }
                    value = this._format(parsed);
                }
            }
            this.element.val(value);
            this._refresh();
        },

        _destroy: function () {
            this.element
                .prop("disabled", false)
                .removeAttr("autocomplete role aria-valuemin aria-valuemax aria-valuenow");

            this.uiSpinner.replaceWith(this.element);
        },

        stepUp: spinnerModifer(function (steps) {
            this._stepUp(steps);
        }),
        _stepUp: function (steps) {
            if (this._start()) {
                this._spin((steps || 1) * this.options.step);
                this._stop();
            }
        },

        stepDown: spinnerModifer(function (steps) {
            this._stepDown(steps);
        }),
        _stepDown: function (steps) {
            if (this._start()) {
                this._spin((steps || 1) * -this.options.step);
                this._stop();
            }
        },

        pageUp: spinnerModifer(function (pages) {
            this._stepUp((pages || 1) * this.options.page);
        }),

        pageDown: spinnerModifer(function (pages) {
            this._stepDown((pages || 1) * this.options.page);
        }),

        value: function (newVal) {
            if (!arguments.length) {
                return this._parse(this.element.val());
            }
            spinnerModifer(this._value).call(this, newVal);
        },

        widget: function () {
            return this.uiSpinner;
        }
    });

// DEPRECATED
// TODO: switch return back to widget declaration at top of file when this is removed
    if ($.uiBackCompat !== false) {

        // Backcompat for spinner html extension points
        $.widget("ui.spinner", $.ui.spinner, {
            _enhance: function () {
                this.uiSpinner = this.element
                    .attr("autocomplete", "off")
                    .wrap(this._uiSpinnerHtml())
                    .parent()

                    // Add buttons
                    .append(this._buttonHtml());
            },
            _uiSpinnerHtml: function () {
                return "<span>";
            },

            _buttonHtml: function () {
                return "<a></a><a></a>";
            }
        });
    }

    var widgetsSpinner = $.ui.spinner;


    /*!
 * jQuery UI Tabs 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Tabs
//>>group: Widgets
//>>description: Transforms a set of container elements into a tab structure.
//>>docs: http://api.jqueryui.com/tabs/
//>>demos: http://jqueryui.com/tabs/
//>>css.structure: ../../themes/base/core.css
//>>css.structure: ../../themes/base/tabs.css
//>>css.theme: ../../themes/base/theme.css


    $.widget("ui.tabs", {
        version: "1.12.1",
        delay: 300,
        options: {
            active: null,
            classes: {
                "ui-tabs": "ui-corner-all",
                "ui-tabs-nav": "ui-corner-all",
                "ui-tabs-panel": "ui-corner-bottom",
                "ui-tabs-tab": "ui-corner-top"
            },
            collapsible: false,
            event: "click",
            heightStyle: "content",
            hide: null,
            show: null,

            // Callbacks
            activate: null,
            beforeActivate: null,
            beforeLoad: null,
            load: null
        },

        _isLocal: (function () {
            var rhash = /#.*$/;

            return function (anchor) {
                var anchorUrl, locationUrl;

                anchorUrl = anchor.href.replace(rhash, "");
                locationUrl = location.href.replace(rhash, "");

                // Decoding may throw an error if the URL isn't UTF-8 (#9518)
                try {
                    anchorUrl = decodeURIComponent(anchorUrl);
                } catch (error) {
                }
                try {
                    locationUrl = decodeURIComponent(locationUrl);
                } catch (error) {
                }

                return anchor.hash.length > 1 && anchorUrl === locationUrl;
            };
        })(),

        _create: function () {
            var that = this,
                options = this.options;

            this.running = false;

            this._addClass("ui-tabs", "ui-widget ui-widget-content");
            this._toggleClass("ui-tabs-collapsible", null, options.collapsible);

            this._processTabs();
            options.active = this._initialActive();

            // Take disabling tabs via class attribute from HTML
            // into account and update option properly.
            if ($.isArray(options.disabled)) {
                options.disabled = $.unique(options.disabled.concat(
                    $.map(this.tabs.filter(".ui-state-disabled"), function (li) {
                        return that.tabs.index(li);
                    })
                )).sort();
            }

            // Check for length avoids error when initializing empty list
            if (this.options.active !== false && this.anchors.length) {
                this.active = this._findActive(options.active);
            } else {
                this.active = $();
            }

            this._refresh();

            if (this.active.length) {
                this.load(options.active);
            }
        },

        _initialActive: function () {
            var active = this.options.active,
                collapsible = this.options.collapsible,
                locationHash = location.hash.substring(1);

            if (active === null) {

                // check the fragment identifier in the URL
                if (locationHash) {
                    this.tabs.each(function (i, tab) {
                        if ($(tab).attr("aria-controls") === locationHash) {
                            active = i;
                            return false;
                        }
                    });
                }

                // Check for a tab marked active via a class
                if (active === null) {
                    active = this.tabs.index(this.tabs.filter(".ui-tabs-active"));
                }

                // No active tab, set to false
                if (active === null || active === -1) {
                    active = this.tabs.length ? 0 : false;
                }
            }

            // Handle numbers: negative, out of range
            if (active !== false) {
                active = this.tabs.index(this.tabs.eq(active));
                if (active === -1) {
                    active = collapsible ? false : 0;
                }
            }

            // Don't allow collapsible: false and active: false
            if (!collapsible && active === false && this.anchors.length) {
                active = 0;
            }

            return active;
        },

        _getCreateEventData: function () {
            return {
                tab: this.active,
                panel: !this.active.length ? $() : this._getPanelForTab(this.active)
            };
        },

        _tabKeydown: function (event) {
            var focusedTab = $($.ui.safeActiveElement(this.document[0])).closest("li"),
                selectedIndex = this.tabs.index(focusedTab),
                goingForward = true;

            if (this._handlePageNav(event)) {
                return;
            }

            switch (event.keyCode) {
                case $.ui.keyCode.RIGHT:
                case $.ui.keyCode.DOWN:
                    selectedIndex++;
                    break;
                case $.ui.keyCode.UP:
                case $.ui.keyCode.LEFT:
                    goingForward = false;
                    selectedIndex--;
                    break;
                case $.ui.keyCode.END:
                    selectedIndex = this.anchors.length - 1;
                    break;
                case $.ui.keyCode.HOME:
                    selectedIndex = 0;
                    break;
                case $.ui.keyCode.SPACE:

                    // Activate only, no collapsing
                    event.preventDefault();
                    clearTimeout(this.activating);
                    this._activate(selectedIndex);
                    return;
                case $.ui.keyCode.ENTER:

                    // Toggle (cancel delayed activation, allow collapsing)
                    event.preventDefault();
                    clearTimeout(this.activating);

                    // Determine if we should collapse or activate
                    this._activate(selectedIndex === this.options.active ? false : selectedIndex);
                    return;
                default:
                    return;
            }

            // Focus the appropriate tab, based on which key was pressed
            event.preventDefault();
            clearTimeout(this.activating);
            selectedIndex = this._focusNextTab(selectedIndex, goingForward);

            // Navigating with control/command key will prevent automatic activation
            if (!event.ctrlKey && !event.metaKey) {

                // Update aria-selected immediately so that AT think the tab is already selected.
                // Otherwise AT may confuse the user by stating that they need to activate the tab,
                // but the tab will already be activated by the time the announcement finishes.
                focusedTab.attr("aria-selected", "false");
                this.tabs.eq(selectedIndex).attr("aria-selected", "true");

                this.activating = this._delay(function () {
                    this.option("active", selectedIndex);
                }, this.delay);
            }
        },

        _panelKeydown: function (event) {
            if (this._handlePageNav(event)) {
                return;
            }

            // Ctrl+up moves focus to the current tab
            if (event.ctrlKey && event.keyCode === $.ui.keyCode.UP) {
                event.preventDefault();
                this.active.trigger("focus");
            }
        },

        // Alt+page up/down moves focus to the previous/next tab (and activates)
        _handlePageNav: function (event) {
            if (event.altKey && event.keyCode === $.ui.keyCode.PAGE_UP) {
                this._activate(this._focusNextTab(this.options.active - 1, false));
                return true;
            }
            if (event.altKey && event.keyCode === $.ui.keyCode.PAGE_DOWN) {
                this._activate(this._focusNextTab(this.options.active + 1, true));
                return true;
            }
        },

        _findNextTab: function (index, goingForward) {
            var lastTabIndex = this.tabs.length - 1;

            function constrain() {
                if (index > lastTabIndex) {
                    index = 0;
                }
                if (index < 0) {
                    index = lastTabIndex;
                }
                return index;
            }

            while ($.inArray(constrain(), this.options.disabled) !== -1) {
                index = goingForward ? index + 1 : index - 1;
            }

            return index;
        },

        _focusNextTab: function (index, goingForward) {
            index = this._findNextTab(index, goingForward);
            this.tabs.eq(index).trigger("focus");
            return index;
        },

        _setOption: function (key, value) {
            if (key === "active") {

                // _activate() will handle invalid values and update this.options
                this._activate(value);
                return;
            }

            this._super(key, value);

            if (key === "collapsible") {
                this._toggleClass("ui-tabs-collapsible", null, value);

                // Setting collapsible: false while collapsed; open first panel
                if (!value && this.options.active === false) {
                    this._activate(0);
                }
            }

            if (key === "event") {
                this._setupEvents(value);
            }

            if (key === "heightStyle") {
                this._setupHeightStyle(value);
            }
        },

        _sanitizeSelector: function (hash) {
            return hash ? hash.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g, "\\$&") : "";
        },

        refresh: function () {
            var options = this.options,
                lis = this.tablist.children(":has(a[href])");

            // Get disabled tabs from class attribute from HTML
            // this will get converted to a boolean if needed in _refresh()
            options.disabled = $.map(lis.filter(".ui-state-disabled"), function (tab) {
                return lis.index(tab);
            });

            this._processTabs();

            // Was collapsed or no tabs
            if (options.active === false || !this.anchors.length) {
                options.active = false;
                this.active = $();

                // was active, but active tab is gone
            } else if (this.active.length && !$.contains(this.tablist[0], this.active[0])) {

                // all remaining tabs are disabled
                if (this.tabs.length === options.disabled.length) {
                    options.active = false;
                    this.active = $();

                    // activate previous tab
                } else {
                    this._activate(this._findNextTab(Math.max(0, options.active - 1), false));
                }

                // was active, active tab still exists
            } else {

                // make sure active index is correct
                options.active = this.tabs.index(this.active);
            }

            this._refresh();
        },

        _refresh: function () {
            this._setOptionDisabled(this.options.disabled);
            this._setupEvents(this.options.event);
            this._setupHeightStyle(this.options.heightStyle);

            this.tabs.not(this.active).attr({
                "aria-selected": "false",
                "aria-expanded": "false",
                tabIndex: -1
            });
            this.panels.not(this._getPanelForTab(this.active))
                .hide()
                .attr({
                    "aria-hidden": "true"
                });

            // Make sure one tab is in the tab order
            if (!this.active.length) {
                this.tabs.eq(0).attr("tabIndex", 0);
            } else {
                this.active
                    .attr({
                        "aria-selected": "true",
                        "aria-expanded": "true",
                        tabIndex: 0
                    });
                this._addClass(this.active, "ui-tabs-active", "ui-state-active");
                this._getPanelForTab(this.active)
                    .show()
                    .attr({
                        "aria-hidden": "false"
                    });
            }
        },

        _processTabs: function () {
            var that = this,
                prevTabs = this.tabs,
                prevAnchors = this.anchors,
                prevPanels = this.panels;

            this.tablist = this._getList().attr("role", "tablist");
            this._addClass(this.tablist, "ui-tabs-nav",
                "ui-helper-reset ui-helper-clearfix ui-widget-header");

            // Prevent users from focusing disabled tabs via click
            this.tablist
                .on("mousedown" + this.eventNamespace, "> li", function (event) {
                    if ($(this).is(".ui-state-disabled")) {
                        event.preventDefault();
                    }
                })

                // Support: IE <9
                // Preventing the default action in mousedown doesn't prevent IE
                // from focusing the element, so if the anchor gets focused, blur.
                // We don't have to worry about focusing the previously focused
                // element since clicking on a non-focusable element should focus
                // the body anyway.
                .on("focus" + this.eventNamespace, ".ui-tabs-anchor", function () {
                    if ($(this).closest("li").is(".ui-state-disabled")) {
                        this.blur();
                    }
                });

            this.tabs = this.tablist.find("> li:has(a[href])")
                .attr({
                    role: "tab",
                    tabIndex: -1
                });
            this._addClass(this.tabs, "ui-tabs-tab", "ui-state-default");

            this.anchors = this.tabs.map(function () {
                return $("a", this)[0];
            })
                .attr({
                    role: "presentation",
                    tabIndex: -1
                });
            this._addClass(this.anchors, "ui-tabs-anchor");

            this.panels = $();

            this.anchors.each(function (i, anchor) {
                var selector, panel, panelId,
                    anchorId = $(anchor).uniqueId().attr("id"),
                    tab = $(anchor).closest("li"),
                    originalAriaControls = tab.attr("aria-controls");

                // Inline tab
                if (that._isLocal(anchor)) {
                    selector = anchor.hash;
                    panelId = selector.substring(1);
                    panel = that.element.find(that._sanitizeSelector(selector));

                    // remote tab
                } else {

                    // If the tab doesn't already have aria-controls,
                    // generate an id by using a throw-away element
                    panelId = tab.attr("aria-controls") || $({}).uniqueId()[0].id;
                    selector = "#" + panelId;
                    panel = that.element.find(selector);
                    if (!panel.length) {
                        panel = that._createPanel(panelId);
                        panel.insertAfter(that.panels[i - 1] || that.tablist);
                    }
                    panel.attr("aria-live", "polite");
                }

                if (panel.length) {
                    that.panels = that.panels.add(panel);
                }
                if (originalAriaControls) {
                    tab.data("ui-tabs-aria-controls", originalAriaControls);
                }
                tab.attr({
                    "aria-controls": panelId,
                    "aria-labelledby": anchorId
                });
                panel.attr("aria-labelledby", anchorId);
            });

            this.panels.attr("role", "tabpanel");
            this._addClass(this.panels, "ui-tabs-panel", "ui-widget-content");

            // Avoid memory leaks (#10056)
            if (prevTabs) {
                this._off(prevTabs.not(this.tabs));
                this._off(prevAnchors.not(this.anchors));
                this._off(prevPanels.not(this.panels));
            }
        },

        // Allow overriding how to find the list for rare usage scenarios (#7715)
        _getList: function () {
            return this.tablist || this.element.find("ol, ul").eq(0);
        },

        _createPanel: function (id) {
            return $("<div>")
                .attr("id", id)
                .data("ui-tabs-destroy", true);
        },

        _setOptionDisabled: function (disabled) {
            var currentItem, li, i;

            if ($.isArray(disabled)) {
                if (!disabled.length) {
                    disabled = false;
                } else if (disabled.length === this.anchors.length) {
                    disabled = true;
                }
            }

            // Disable tabs
            for (i = 0; (li = this.tabs[i]); i++) {
                currentItem = $(li);
                if (disabled === true || $.inArray(i, disabled) !== -1) {
                    currentItem.attr("aria-disabled", "true");
                    this._addClass(currentItem, null, "ui-state-disabled");
                } else {
                    currentItem.removeAttr("aria-disabled");
                    this._removeClass(currentItem, null, "ui-state-disabled");
                }
            }

            this.options.disabled = disabled;

            this._toggleClass(this.widget(), this.widgetFullName + "-disabled", null,
                disabled === true);
        },

        _setupEvents: function (event) {
            var events = {};
            if (event) {
                $.each(event.split(" "), function (index, eventName) {
                    events[eventName] = "_eventHandler";
                });
            }

            this._off(this.anchors.add(this.tabs).add(this.panels));

            // Always prevent the default action, even when disabled
            this._on(true, this.anchors, {
                click: function (event) {
                    event.preventDefault();
                }
            });
            this._on(this.anchors, events);
            this._on(this.tabs, {keydown: "_tabKeydown"});
            this._on(this.panels, {keydown: "_panelKeydown"});

            this._focusable(this.tabs);
            this._hoverable(this.tabs);
        },

        _setupHeightStyle: function (heightStyle) {
            var maxHeight,
                parent = this.element.parent();

            if (heightStyle === "fill") {
                maxHeight = parent.height();
                maxHeight -= this.element.outerHeight() - this.element.height();

                this.element.siblings(":visible").each(function () {
                    var elem = $(this),
                        position = elem.css("position");

                    if (position === "absolute" || position === "fixed") {
                        return;
                    }
                    maxHeight -= elem.outerHeight(true);
                });

                this.element.children().not(this.panels).each(function () {
                    maxHeight -= $(this).outerHeight(true);
                });

                this.panels.each(function () {
                    $(this).height(Math.max(0, maxHeight -
                        $(this).innerHeight() + $(this).height()));
                })
                    .css("overflow", "auto");
            } else if (heightStyle === "auto") {
                maxHeight = 0;
                this.panels.each(function () {
                    maxHeight = Math.max(maxHeight, $(this).height("").height());
                }).height(maxHeight);
            }
        },

        _eventHandler: function (event) {
            var options = this.options,
                active = this.active,
                anchor = $(event.currentTarget),
                tab = anchor.closest("li"),
                clickedIsActive = tab[0] === active[0],
                collapsing = clickedIsActive && options.collapsible,
                toShow = collapsing ? $() : this._getPanelForTab(tab),
                toHide = !active.length ? $() : this._getPanelForTab(active),
                eventData = {
                    oldTab: active,
                    oldPanel: toHide,
                    newTab: collapsing ? $() : tab,
                    newPanel: toShow
                };

            event.preventDefault();

            if (tab.hasClass("ui-state-disabled") ||

                // tab is already loading
                tab.hasClass("ui-tabs-loading") ||

                // can't switch durning an animation
                this.running ||

                // click on active header, but not collapsible
                (clickedIsActive && !options.collapsible) ||

                // allow canceling activation
                (this._trigger("beforeActivate", event, eventData) === false)) {
                return;
            }

            options.active = collapsing ? false : this.tabs.index(tab);

            this.active = clickedIsActive ? $() : tab;
            if (this.xhr) {
                this.xhr.abort();
            }

            if (!toHide.length && !toShow.length) {
                $.error("jQuery UI Tabs: Mismatching fragment identifier.");
            }

            if (toShow.length) {
                this.load(this.tabs.index(tab), event);
            }
            this._toggle(event, eventData);
        },

        // Handles show/hide for selecting tabs
        _toggle: function (event, eventData) {
            var that = this,
                toShow = eventData.newPanel,
                toHide = eventData.oldPanel;

            this.running = true;

            function complete() {
                that.running = false;
                that._trigger("activate", event, eventData);
            }

            function show() {
                that._addClass(eventData.newTab.closest("li"), "ui-tabs-active", "ui-state-active");

                if (toShow.length && that.options.show) {
                    that._show(toShow, that.options.show, complete);
                } else {
                    toShow.show();
                    complete();
                }
            }

            // Start out by hiding, then showing, then completing
            if (toHide.length && this.options.hide) {
                this._hide(toHide, this.options.hide, function () {
                    that._removeClass(eventData.oldTab.closest("li"),
                        "ui-tabs-active", "ui-state-active");
                    show();
                });
            } else {
                this._removeClass(eventData.oldTab.closest("li"),
                    "ui-tabs-active", "ui-state-active");
                toHide.hide();
                show();
            }

            toHide.attr("aria-hidden", "true");
            eventData.oldTab.attr({
                "aria-selected": "false",
                "aria-expanded": "false"
            });

            // If we're switching tabs, remove the old tab from the tab order.
            // If we're opening from collapsed state, remove the previous tab from the tab order.
            // If we're collapsing, then keep the collapsing tab in the tab order.
            if (toShow.length && toHide.length) {
                eventData.oldTab.attr("tabIndex", -1);
            } else if (toShow.length) {
                this.tabs.filter(function () {
                    return $(this).attr("tabIndex") === 0;
                })
                    .attr("tabIndex", -1);
            }

            toShow.attr("aria-hidden", "false");
            eventData.newTab.attr({
                "aria-selected": "true",
                "aria-expanded": "true",
                tabIndex: 0
            });
        },

        _activate: function (index) {
            var anchor,
                active = this._findActive(index);

            // Trying to activate the already active panel
            if (active[0] === this.active[0]) {
                return;
            }

            // Trying to collapse, simulate a click on the current active header
            if (!active.length) {
                active = this.active;
            }

            anchor = active.find(".ui-tabs-anchor")[0];
            this._eventHandler({
                target: anchor,
                currentTarget: anchor,
                preventDefault: $.noop
            });
        },

        _findActive: function (index) {
            return index === false ? $() : this.tabs.eq(index);
        },

        _getIndex: function (index) {

            // meta-function to give users option to provide a href string instead of a numerical index.
            if (typeof index === "string") {
                index = this.anchors.index(this.anchors.filter("[href$='" +
                    $.ui.escapeSelector(index) + "']"));
            }

            return index;
        },

        _destroy: function () {
            if (this.xhr) {
                this.xhr.abort();
            }

            this.tablist
                .removeAttr("role")
                .off(this.eventNamespace);

            this.anchors
                .removeAttr("role tabIndex")
                .removeUniqueId();

            this.tabs.add(this.panels).each(function () {
                if ($.data(this, "ui-tabs-destroy")) {
                    $(this).remove();
                } else {
                    $(this).removeAttr("role tabIndex " +
                        "aria-live aria-busy aria-selected aria-labelledby aria-hidden aria-expanded");
                }
            });

            this.tabs.each(function () {
                var li = $(this),
                    prev = li.data("ui-tabs-aria-controls");
                if (prev) {
                    li
                        .attr("aria-controls", prev)
                        .removeData("ui-tabs-aria-controls");
                } else {
                    li.removeAttr("aria-controls");
                }
            });

            this.panels.show();

            if (this.options.heightStyle !== "content") {
                this.panels.css("height", "");
            }
        },

        enable: function (index) {
            var disabled = this.options.disabled;
            if (disabled === false) {
                return;
            }

            if (index === undefined) {
                disabled = false;
            } else {
                index = this._getIndex(index);
                if ($.isArray(disabled)) {
                    disabled = $.map(disabled, function (num) {
                        return num !== index ? num : null;
                    });
                } else {
                    disabled = $.map(this.tabs, function (li, num) {
                        return num !== index ? num : null;
                    });
                }
            }
            this._setOptionDisabled(disabled);
        },

        disable: function (index) {
            var disabled = this.options.disabled;
            if (disabled === true) {
                return;
            }

            if (index === undefined) {
                disabled = true;
            } else {
                index = this._getIndex(index);
                if ($.inArray(index, disabled) !== -1) {
                    return;
                }
                if ($.isArray(disabled)) {
                    disabled = $.merge([index], disabled).sort();
                } else {
                    disabled = [index];
                }
            }
            this._setOptionDisabled(disabled);
        },

        load: function (index, event) {
            index = this._getIndex(index);
            var that = this,
                tab = this.tabs.eq(index),
                anchor = tab.find(".ui-tabs-anchor"),
                panel = this._getPanelForTab(tab),
                eventData = {
                    tab: tab,
                    panel: panel
                },
                complete = function (jqXHR, status) {
                    if (status === "abort") {
                        that.panels.stop(false, true);
                    }

                    that._removeClass(tab, "ui-tabs-loading");
                    panel.removeAttr("aria-busy");

                    if (jqXHR === that.xhr) {
                        delete that.xhr;
                    }
                };

            // Not remote
            if (this._isLocal(anchor[0])) {
                return;
            }

            this.xhr = $.ajax(this._ajaxSettings(anchor, event, eventData));

            // Support: jQuery <1.8
            // jQuery <1.8 returns false if the request is canceled in beforeSend,
            // but as of 1.8, $.ajax() always returns a jqXHR object.
            if (this.xhr && this.xhr.statusText !== "canceled") {
                this._addClass(tab, "ui-tabs-loading");
                panel.attr("aria-busy", "true");

                this.xhr
                    .done(function (response, status, jqXHR) {

                        // support: jQuery <1.8
                        // http://bugs.jquery.com/ticket/11778
                        setTimeout(function () {
                            panel.html(response);
                            that._trigger("load", event, eventData);

                            complete(jqXHR, status);
                        }, 1);
                    })
                    .fail(function (jqXHR, status) {

                        // support: jQuery <1.8
                        // http://bugs.jquery.com/ticket/11778
                        setTimeout(function () {
                            complete(jqXHR, status);
                        }, 1);
                    });
            }
        },

        _ajaxSettings: function (anchor, event, eventData) {
            var that = this;
            return {

                // Support: IE <11 only
                // Strip any hash that exists to prevent errors with the Ajax request
                url: anchor.attr("href").replace(/#.*$/, ""),
                beforeSend: function (jqXHR, settings) {
                    return that._trigger("beforeLoad", event,
                        $.extend({jqXHR: jqXHR, ajaxSettings: settings}, eventData));
                }
            };
        },

        _getPanelForTab: function (tab) {
            var id = $(tab).attr("aria-controls");
            return this.element.find(this._sanitizeSelector("#" + id));
        }
    });

// DEPRECATED
// TODO: Switch return back to widget declaration at top of file when this is removed
    if ($.uiBackCompat !== false) {

        // Backcompat for ui-tab class (now ui-tabs-tab)
        $.widget("ui.tabs", $.ui.tabs, {
            _processTabs: function () {
                this._superApply(arguments);
                this._addClass(this.tabs, "ui-tab");
            }
        });
    }

    var widgetsTabs = $.ui.tabs;


    /*!
 * jQuery UI Tooltip 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

//>>label: Tooltip
//>>group: Widgets
//>>description: Shows additional information for any element on hover or focus.
//>>docs: http://api.jqueryui.com/tooltip/
//>>demos: http://jqueryui.com/tooltip/
//>>css.structure: ../../themes/base/core.css
//>>css.structure: ../../themes/base/tooltip.css
//>>css.theme: ../../themes/base/theme.css


    $.widget("ui.tooltip", {
        version: "1.12.1",
        options: {
            classes: {
                "ui-tooltip": "ui-corner-all ui-widget-shadow"
            },
            content: function () {

                // support: IE<9, Opera in jQuery <1.7
                // .text() can't accept undefined, so coerce to a string
                var title = $(this).attr("title") || "";

                // Escape title, since we're going from an attribute to raw HTML
                return $("<a>").text(title).html();
            },
            hide: true,

            // Disabled elements have inconsistent behavior across browsers (#8661)
            items: "[title]:not([disabled])",
            position: {
                my: "left top+15",
                at: "left bottom",
                collision: "flipfit flip"
            },
            show: true,
            track: false,

            // Callbacks
            close: null,
            open: null
        },

        _addDescribedBy: function (elem, id) {
            var describedby = (elem.attr("aria-describedby") || "").split(/\s+/);
            describedby.push(id);
            elem
                .data("ui-tooltip-id", id)
                .attr("aria-describedby", $.trim(describedby.join(" ")));
        },

        _removeDescribedBy: function (elem) {
            var id = elem.data("ui-tooltip-id"),
                describedby = (elem.attr("aria-describedby") || "").split(/\s+/),
                index = $.inArray(id, describedby);

            if (index !== -1) {
                describedby.splice(index, 1);
            }

            elem.removeData("ui-tooltip-id");
            describedby = $.trim(describedby.join(" "));
            if (describedby) {
                elem.attr("aria-describedby", describedby);
            } else {
                elem.removeAttr("aria-describedby");
            }
        },

        _create: function () {
            this._on({
                mouseover: "open",
                focusin: "open"
            });

            // IDs of generated tooltips, needed for destroy
            this.tooltips = {};

            // IDs of parent tooltips where we removed the title attribute
            this.parents = {};

            // Append the aria-live region so tooltips announce correctly
            this.liveRegion = $("<div>")
                .attr({
                    role: "log",
                    "aria-live": "assertive",
                    "aria-relevant": "additions"
                })
                .appendTo(this.document[0].body);
            this._addClass(this.liveRegion, null, "ui-helper-hidden-accessible");

            this.disabledTitles = $([]);
        },

        _setOption: function (key, value) {
            var that = this;

            this._super(key, value);

            if (key === "content") {
                $.each(this.tooltips, function (id, tooltipData) {
                    that._updateContent(tooltipData.element);
                });
            }
        },

        _setOptionDisabled: function (value) {
            this[value ? "_disable" : "_enable"]();
        },

        _disable: function () {
            var that = this;

            // Close open tooltips
            $.each(this.tooltips, function (id, tooltipData) {
                var event = $.Event("blur");
                event.target = event.currentTarget = tooltipData.element[0];
                that.close(event, true);
            });

            // Remove title attributes to prevent native tooltips
            this.disabledTitles = this.disabledTitles.add(
                this.element.find(this.options.items).addBack()
                    .filter(function () {
                        var element = $(this);
                        if (element.is("[title]")) {
                            return element
                                .data("ui-tooltip-title", element.attr("title"))
                                .removeAttr("title");
                        }
                    })
            );
        },

        _enable: function () {

            // restore title attributes
            this.disabledTitles.each(function () {
                var element = $(this);
                if (element.data("ui-tooltip-title")) {
                    element.attr("title", element.data("ui-tooltip-title"));
                }
            });
            this.disabledTitles = $([]);
        },

        open: function (event) {
            var that = this,
                target = $(event ? event.target : this.element)

                // we need closest here due to mouseover bubbling,
                // but always pointing at the same event target
                    .closest(this.options.items);

            // No element to show a tooltip for or the tooltip is already open
            if (!target.length || target.data("ui-tooltip-id")) {
                return;
            }

            if (target.attr("title")) {
                target.data("ui-tooltip-title", target.attr("title"));
            }

            target.data("ui-tooltip-open", true);

            // Kill parent tooltips, custom or native, for hover
            if (event && event.type === "mouseover") {
                target.parents().each(function () {
                    var parent = $(this),
                        blurEvent;
                    if (parent.data("ui-tooltip-open")) {
                        blurEvent = $.Event("blur");
                        blurEvent.target = blurEvent.currentTarget = this;
                        that.close(blurEvent, true);
                    }
                    if (parent.attr("title")) {
                        parent.uniqueId();
                        that.parents[this.id] = {
                            element: this,
                            title: parent.attr("title")
                        };
                        parent.attr("title", "");
                    }
                });
            }

            this._registerCloseHandlers(event, target);
            this._updateContent(target, event);
        },

        _updateContent: function (target, event) {
            var content,
                contentOption = this.options.content,
                that = this,
                eventType = event ? event.type : null;

            if (typeof contentOption === "string" || contentOption.nodeType ||
                contentOption.jquery) {
                return this._open(event, target, contentOption);
            }

            content = contentOption.call(target[0], function (response) {

                // IE may instantly serve a cached response for ajax requests
                // delay this call to _open so the other call to _open runs first
                that._delay(function () {

                    // Ignore async response if tooltip was closed already
                    if (!target.data("ui-tooltip-open")) {
                        return;
                    }

                    // JQuery creates a special event for focusin when it doesn't
                    // exist natively. To improve performance, the native event
                    // object is reused and the type is changed. Therefore, we can't
                    // rely on the type being correct after the event finished
                    // bubbling, so we set it back to the previous value. (#8740)
                    if (event) {
                        event.type = eventType;
                    }
                    this._open(event, target, response);
                });
            });
            if (content) {
                this._open(event, target, content);
            }
        },

        _open: function (event, target, content) {
            var tooltipData, tooltip, delayedShow, a11yContent,
                positionOption = $.extend({}, this.options.position);

            if (!content) {
                return;
            }

            // Content can be updated multiple times. If the tooltip already
            // exists, then just update the content and bail.
            tooltipData = this._find(target);
            if (tooltipData) {
                tooltipData.tooltip.find(".ui-tooltip-content").html(content);
                return;
            }

            // If we have a title, clear it to prevent the native tooltip
            // we have to check first to avoid defining a title if none exists
            // (we don't want to cause an element to start matching [title])
            //
            // We use removeAttr only for key events, to allow IE to export the correct
            // accessible attributes. For mouse events, set to empty string to avoid
            // native tooltip showing up (happens only when removing inside mouseover).
            if (target.is("[title]")) {
                if (event && event.type === "mouseover") {
                    target.attr("title", "");
                } else {
                    target.removeAttr("title");
                }
            }

            tooltipData = this._tooltip(target);
            tooltip = tooltipData.tooltip;
            this._addDescribedBy(target, tooltip.attr("id"));
            tooltip.find(".ui-tooltip-content").html(content);

            // Support: Voiceover on OS X, JAWS on IE <= 9
            // JAWS announces deletions even when aria-relevant="additions"
            // Voiceover will sometimes re-read the entire log region's contents from the beginning
            this.liveRegion.children().hide();
            a11yContent = $("<div>").html(tooltip.find(".ui-tooltip-content").html());
            a11yContent.removeAttr("name").find("[name]").removeAttr("name");
            a11yContent.removeAttr("id").find("[id]").removeAttr("id");
            a11yContent.appendTo(this.liveRegion);

            function position(event) {
                positionOption.of = event;
                if (tooltip.is(":hidden")) {
                    return;
                }
                tooltip.position(positionOption);
            }

            if (this.options.track && event && /^mouse/.test(event.type)) {
                this._on(this.document, {
                    mousemove: position
                });

                // trigger once to override element-relative positioning
                position(event);
            } else {
                tooltip.position($.extend({
                    of: target
                }, this.options.position));
            }

            tooltip.hide();

            this._show(tooltip, this.options.show);

            // Handle tracking tooltips that are shown with a delay (#8644). As soon
            // as the tooltip is visible, position the tooltip using the most recent
            // event.
            // Adds the check to add the timers only when both delay and track options are set (#14682)
            if (this.options.track && this.options.show && this.options.show.delay) {
                delayedShow = this.delayedShow = setInterval(function () {
                    if (tooltip.is(":visible")) {
                        position(positionOption.of);
                        clearInterval(delayedShow);
                    }
                }, $.fx.interval);
            }

            this._trigger("open", event, {tooltip: tooltip});
        },

        _registerCloseHandlers: function (event, target) {
            var events = {
                keyup: function (event) {
                    if (event.keyCode === $.ui.keyCode.ESCAPE) {
                        var fakeEvent = $.Event(event);
                        fakeEvent.currentTarget = target[0];
                        this.close(fakeEvent, true);
                    }
                }
            };

            // Only bind remove handler for delegated targets. Non-delegated
            // tooltips will handle this in destroy.
            if (target[0] !== this.element[0]) {
                events.remove = function () {
                    this._removeTooltip(this._find(target).tooltip);
                };
            }

            if (!event || event.type === "mouseover") {
                events.mouseleave = "close";
            }
            if (!event || event.type === "focusin") {
                events.focusout = "close";
            }
            this._on(true, target, events);
        },

        close: function (event) {
            var tooltip,
                that = this,
                target = $(event ? event.currentTarget : this.element),
                tooltipData = this._find(target);

            // The tooltip may already be closed
            if (!tooltipData) {

                // We set ui-tooltip-open immediately upon open (in open()), but only set the
                // additional data once there's actually content to show (in _open()). So even if the
                // tooltip doesn't have full data, we always remove ui-tooltip-open in case we're in
                // the period between open() and _open().
                target.removeData("ui-tooltip-open");
                return;
            }

            tooltip = tooltipData.tooltip;

            // Disabling closes the tooltip, so we need to track when we're closing
            // to avoid an infinite loop in case the tooltip becomes disabled on close
            if (tooltipData.closing) {
                return;
            }

            // Clear the interval for delayed tracking tooltips
            clearInterval(this.delayedShow);

            // Only set title if we had one before (see comment in _open())
            // If the title attribute has changed since open(), don't restore
            if (target.data("ui-tooltip-title") && !target.attr("title")) {
                target.attr("title", target.data("ui-tooltip-title"));
            }

            this._removeDescribedBy(target);

            tooltipData.hiding = true;
            tooltip.stop(true);
            this._hide(tooltip, this.options.hide, function () {
                that._removeTooltip($(this));
            });

            target.removeData("ui-tooltip-open");
            this._off(target, "mouseleave focusout keyup");

            // Remove 'remove' binding only on delegated targets
            if (target[0] !== this.element[0]) {
                this._off(target, "remove");
            }
            this._off(this.document, "mousemove");

            if (event && event.type === "mouseleave") {
                $.each(this.parents, function (id, parent) {
                    $(parent.element).attr("title", parent.title);
                    delete that.parents[id];
                });
            }

            tooltipData.closing = true;
            this._trigger("close", event, {tooltip: tooltip});
            if (!tooltipData.hiding) {
                tooltipData.closing = false;
            }
        },

        _tooltip: function (element) {
            var tooltip = $("<div>").attr("role", "tooltip"),
                content = $("<div>").appendTo(tooltip),
                id = tooltip.uniqueId().attr("id");

            this._addClass(content, "ui-tooltip-content");
            this._addClass(tooltip, "ui-tooltip", "ui-widget ui-widget-content");

            tooltip.appendTo(this._appendTo(element));

            return this.tooltips[id] = {
                element: element,
                tooltip: tooltip
            };
        },

        _find: function (target) {
            var id = target.data("ui-tooltip-id");
            return id ? this.tooltips[id] : null;
        },

        _removeTooltip: function (tooltip) {
            tooltip.remove();
            delete this.tooltips[tooltip.attr("id")];
        },

        _appendTo: function (target) {
            var element = target.closest(".ui-front, dialog");

            if (!element.length) {
                element = this.document[0].body;
            }

            return element;
        },

        _destroy: function () {
            var that = this;

            // Close open tooltips
            $.each(this.tooltips, function (id, tooltipData) {

                // Delegate to close method to handle common cleanup
                var event = $.Event("blur"),
                    element = tooltipData.element;
                event.target = event.currentTarget = element[0];
                that.close(event, true);

                // Remove immediately; destroying an open tooltip doesn't use the
                // hide animation
                $("#" + id).remove();

                // Restore the title
                if (element.data("ui-tooltip-title")) {

                    // If the title attribute has changed since open(), don't restore
                    if (!element.attr("title")) {
                        element.attr("title", element.data("ui-tooltip-title"));
                    }
                    element.removeData("ui-tooltip-title");
                }
            });
            this.liveRegion.remove();
        }
    });

// DEPRECATED
// TODO: Switch return back to widget declaration at top of file when this is removed
    if ($.uiBackCompat !== false) {

        // Backcompat for tooltipClass option
        $.widget("ui.tooltip", $.ui.tooltip, {
            options: {
                tooltipClass: null
            },
            _tooltip: function () {
                var tooltipData = this._superApply(arguments);
                if (this.options.tooltipClass) {
                    tooltipData.tooltip.addClass(this.options.tooltipClass);
                }
                return tooltipData;
            }
        });
    }

    var widgetsTooltip = $.ui.tooltip;


}));
/*!
 * Bootstrap v3.4.1 (https://getbootstrap.com/)
 * Copyright 2011-2019 Twitter, Inc.
 * Licensed under the MIT license
 */
if("undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");!function(t){"use strict";var e=jQuery.fn.jquery.split(" ")[0].split(".");if(e[0]<2&&e[1]<9||1==e[0]&&9==e[1]&&e[2]<1||3<e[0])throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher, but lower than version 4")}(),function(n){"use strict";n.fn.emulateTransitionEnd=function(t){var e=!1,i=this;n(this).one("bsTransitionEnd",function(){e=!0});return setTimeout(function(){e||n(i).trigger(n.support.transition.end)},t),this},n(function(){n.support.transition=function o(){var t=document.createElement("bootstrap"),e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var i in e)if(t.style[i]!==undefined)return{end:e[i]};return!1}(),n.support.transition&&(n.event.special.bsTransitionEnd={bindType:n.support.transition.end,delegateType:n.support.transition.end,handle:function(t){if(n(t.target).is(this))return t.handleObj.handler.apply(this,arguments)}})})}(jQuery),function(s){"use strict";var e='[data-dismiss="alert"]',a=function(t){s(t).on("click",e,this.close)};a.VERSION="3.4.1",a.TRANSITION_DURATION=150,a.prototype.close=function(t){var e=s(this),i=e.attr("data-target");i||(i=(i=e.attr("href"))&&i.replace(/.*(?=#[^\s]*$)/,"")),i="#"===i?[]:i;var o=s(document).find(i);function n(){o.detach().trigger("closed.bs.alert").remove()}t&&t.preventDefault(),o.length||(o=e.closest(".alert")),o.trigger(t=s.Event("close.bs.alert")),t.isDefaultPrevented()||(o.removeClass("in"),s.support.transition&&o.hasClass("fade")?o.one("bsTransitionEnd",n).emulateTransitionEnd(a.TRANSITION_DURATION):n())};var t=s.fn.alert;s.fn.alert=function o(i){return this.each(function(){var t=s(this),e=t.data("bs.alert");e||t.data("bs.alert",e=new a(this)),"string"==typeof i&&e[i].call(t)})},s.fn.alert.Constructor=a,s.fn.alert.noConflict=function(){return s.fn.alert=t,this},s(document).on("click.bs.alert.data-api",e,a.prototype.close)}(jQuery),function(s){"use strict";var n=function(t,e){this.$element=s(t),this.options=s.extend({},n.DEFAULTS,e),this.isLoading=!1};function i(o){return this.each(function(){var t=s(this),e=t.data("bs.button"),i="object"==typeof o&&o;e||t.data("bs.button",e=new n(this,i)),"toggle"==o?e.toggle():o&&e.setState(o)})}n.VERSION="3.4.1",n.DEFAULTS={loadingText:"loading..."},n.prototype.setState=function(t){var e="disabled",i=this.$element,o=i.is("input")?"val":"html",n=i.data();t+="Text",null==n.resetText&&i.data("resetText",i[o]()),setTimeout(s.proxy(function(){i[o](null==n[t]?this.options[t]:n[t]),"loadingText"==t?(this.isLoading=!0,i.addClass(e).attr(e,e).prop(e,!0)):this.isLoading&&(this.isLoading=!1,i.removeClass(e).removeAttr(e).prop(e,!1))},this),0)},n.prototype.toggle=function(){var t=!0,e=this.$element.closest('[data-toggle="buttons"]');if(e.length){var i=this.$element.find("input");"radio"==i.prop("type")?(i.prop("checked")&&(t=!1),e.find(".active").removeClass("active"),this.$element.addClass("active")):"checkbox"==i.prop("type")&&(i.prop("checked")!==this.$element.hasClass("active")&&(t=!1),this.$element.toggleClass("active")),i.prop("checked",this.$element.hasClass("active")),t&&i.trigger("change")}else this.$element.attr("aria-pressed",!this.$element.hasClass("active")),this.$element.toggleClass("active")};var t=s.fn.button;s.fn.button=i,s.fn.button.Constructor=n,s.fn.button.noConflict=function(){return s.fn.button=t,this},s(document).on("click.bs.button.data-api",'[data-toggle^="button"]',function(t){var e=s(t.target).closest(".btn");i.call(e,"toggle"),s(t.target).is('input[type="radio"], input[type="checkbox"]')||(t.preventDefault(),e.is("input,button")?e.trigger("focus"):e.find("input:visible,button:visible").first().trigger("focus"))}).on("focus.bs.button.data-api blur.bs.button.data-api",'[data-toggle^="button"]',function(t){s(t.target).closest(".btn").toggleClass("focus",/^focus(in)?$/.test(t.type))})}(jQuery),function(p){"use strict";var c=function(t,e){this.$element=p(t),this.$indicators=this.$element.find(".carousel-indicators"),this.options=e,this.paused=null,this.sliding=null,this.interval=null,this.$active=null,this.$items=null,this.options.keyboard&&this.$element.on("keydown.bs.carousel",p.proxy(this.keydown,this)),"hover"==this.options.pause&&!("ontouchstart"in document.documentElement)&&this.$element.on("mouseenter.bs.carousel",p.proxy(this.pause,this)).on("mouseleave.bs.carousel",p.proxy(this.cycle,this))};function r(n){return this.each(function(){var t=p(this),e=t.data("bs.carousel"),i=p.extend({},c.DEFAULTS,t.data(),"object"==typeof n&&n),o="string"==typeof n?n:i.slide;e||t.data("bs.carousel",e=new c(this,i)),"number"==typeof n?e.to(n):o?e[o]():i.interval&&e.pause().cycle()})}c.VERSION="3.4.1",c.TRANSITION_DURATION=600,c.DEFAULTS={interval:5e3,pause:"hover",wrap:!0,keyboard:!0},c.prototype.keydown=function(t){if(!/input|textarea/i.test(t.target.tagName)){switch(t.which){case 37:this.prev();break;case 39:this.next();break;default:return}t.preventDefault()}},c.prototype.cycle=function(t){return t||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(p.proxy(this.next,this),this.options.interval)),this},c.prototype.getItemIndex=function(t){return this.$items=t.parent().children(".item"),this.$items.index(t||this.$active)},c.prototype.getItemForDirection=function(t,e){var i=this.getItemIndex(e);if(("prev"==t&&0===i||"next"==t&&i==this.$items.length-1)&&!this.options.wrap)return e;var o=(i+("prev"==t?-1:1))%this.$items.length;return this.$items.eq(o)},c.prototype.to=function(t){var e=this,i=this.getItemIndex(this.$active=this.$element.find(".item.active"));if(!(t>this.$items.length-1||t<0))return this.sliding?this.$element.one("slid.bs.carousel",function(){e.to(t)}):i==t?this.pause().cycle():this.slide(i<t?"next":"prev",this.$items.eq(t))},c.prototype.pause=function(t){return t||(this.paused=!0),this.$element.find(".next, .prev").length&&p.support.transition&&(this.$element.trigger(p.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},c.prototype.next=function(){if(!this.sliding)return this.slide("next")},c.prototype.prev=function(){if(!this.sliding)return this.slide("prev")},c.prototype.slide=function(t,e){var i=this.$element.find(".item.active"),o=e||this.getItemForDirection(t,i),n=this.interval,s="next"==t?"left":"right",a=this;if(o.hasClass("active"))return this.sliding=!1;var r=o[0],l=p.Event("slide.bs.carousel",{relatedTarget:r,direction:s});if(this.$element.trigger(l),!l.isDefaultPrevented()){if(this.sliding=!0,n&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var h=p(this.$indicators.children()[this.getItemIndex(o)]);h&&h.addClass("active")}var d=p.Event("slid.bs.carousel",{relatedTarget:r,direction:s});return p.support.transition&&this.$element.hasClass("slide")?(o.addClass(t),"object"==typeof o&&o.length&&o[0].offsetWidth,i.addClass(s),o.addClass(s),i.one("bsTransitionEnd",function(){o.removeClass([t,s].join(" ")).addClass("active"),i.removeClass(["active",s].join(" ")),a.sliding=!1,setTimeout(function(){a.$element.trigger(d)},0)}).emulateTransitionEnd(c.TRANSITION_DURATION)):(i.removeClass("active"),o.addClass("active"),this.sliding=!1,this.$element.trigger(d)),n&&this.cycle(),this}};var t=p.fn.carousel;p.fn.carousel=r,p.fn.carousel.Constructor=c,p.fn.carousel.noConflict=function(){return p.fn.carousel=t,this};var e=function(t){var e=p(this),i=e.attr("href");i&&(i=i.replace(/.*(?=#[^\s]+$)/,""));var o=e.attr("data-target")||i,n=p(document).find(o);if(n.hasClass("carousel")){var s=p.extend({},n.data(),e.data()),a=e.attr("data-slide-to");a&&(s.interval=!1),r.call(n,s),a&&n.data("bs.carousel").to(a),t.preventDefault()}};p(document).on("click.bs.carousel.data-api","[data-slide]",e).on("click.bs.carousel.data-api","[data-slide-to]",e),p(window).on("load",function(){p('[data-ride="carousel"]').each(function(){var t=p(this);r.call(t,t.data())})})}(jQuery),function(a){"use strict";var r=function(t,e){this.$element=a(t),this.options=a.extend({},r.DEFAULTS,e),this.$trigger=a('[data-toggle="collapse"][href="#'+t.id+'"],[data-toggle="collapse"][data-target="#'+t.id+'"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};function n(t){var e,i=t.attr("data-target")||(e=t.attr("href"))&&e.replace(/.*(?=#[^\s]+$)/,"");return a(document).find(i)}function l(o){return this.each(function(){var t=a(this),e=t.data("bs.collapse"),i=a.extend({},r.DEFAULTS,t.data(),"object"==typeof o&&o);!e&&i.toggle&&/show|hide/.test(o)&&(i.toggle=!1),e||t.data("bs.collapse",e=new r(this,i)),"string"==typeof o&&e[o]()})}r.VERSION="3.4.1",r.TRANSITION_DURATION=350,r.DEFAULTS={toggle:!0},r.prototype.dimension=function(){return this.$element.hasClass("width")?"width":"height"},r.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var t,e=this.$parent&&this.$parent.children(".panel").children(".in, .collapsing");if(!(e&&e.length&&(t=e.data("bs.collapse"))&&t.transitioning)){var i=a.Event("show.bs.collapse");if(this.$element.trigger(i),!i.isDefaultPrevented()){e&&e.length&&(l.call(e,"hide"),t||e.data("bs.collapse",null));var o=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[o](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var n=function(){this.$element.removeClass("collapsing").addClass("collapse in")[o](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!a.support.transition)return n.call(this);var s=a.camelCase(["scroll",o].join("-"));this.$element.one("bsTransitionEnd",a.proxy(n,this)).emulateTransitionEnd(r.TRANSITION_DURATION)[o](this.$element[0][s])}}}},r.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var t=a.Event("hide.bs.collapse");if(this.$element.trigger(t),!t.isDefaultPrevented()){var e=this.dimension();this.$element[e](this.$element[e]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;var i=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};if(!a.support.transition)return i.call(this);this.$element[e](0).one("bsTransitionEnd",a.proxy(i,this)).emulateTransitionEnd(r.TRANSITION_DURATION)}}},r.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},r.prototype.getParent=function(){return a(document).find(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each(a.proxy(function(t,e){var i=a(e);this.addAriaAndCollapsedClass(n(i),i)},this)).end()},r.prototype.addAriaAndCollapsedClass=function(t,e){var i=t.hasClass("in");t.attr("aria-expanded",i),e.toggleClass("collapsed",!i).attr("aria-expanded",i)};var t=a.fn.collapse;a.fn.collapse=l,a.fn.collapse.Constructor=r,a.fn.collapse.noConflict=function(){return a.fn.collapse=t,this},a(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(t){var e=a(this);e.attr("data-target")||t.preventDefault();var i=n(e),o=i.data("bs.collapse")?"toggle":e.data();l.call(i,o)})}(jQuery),function(a){"use strict";var r='[data-toggle="dropdown"]',o=function(t){a(t).on("click.bs.dropdown",this.toggle)};function l(t){var e=t.attr("data-target");e||(e=(e=t.attr("href"))&&/#[A-Za-z]/.test(e)&&e.replace(/.*(?=#[^\s]*$)/,""));var i="#"!==e?a(document).find(e):null;return i&&i.length?i:t.parent()}function s(o){o&&3===o.which||(a(".dropdown-backdrop").remove(),a(r).each(function(){var t=a(this),e=l(t),i={relatedTarget:this};e.hasClass("open")&&(o&&"click"==o.type&&/input|textarea/i.test(o.target.tagName)&&a.contains(e[0],o.target)||(e.trigger(o=a.Event("hide.bs.dropdown",i)),o.isDefaultPrevented()||(t.attr("aria-expanded","false"),e.removeClass("open").trigger(a.Event("hidden.bs.dropdown",i)))))}))}o.VERSION="3.4.1",o.prototype.toggle=function(t){var e=a(this);if(!e.is(".disabled, :disabled")){var i=l(e),o=i.hasClass("open");if(s(),!o){"ontouchstart"in document.documentElement&&!i.closest(".navbar-nav").length&&a(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(a(this)).on("click",s);var n={relatedTarget:this};if(i.trigger(t=a.Event("show.bs.dropdown",n)),t.isDefaultPrevented())return;e.trigger("focus").attr("aria-expanded","true"),i.toggleClass("open").trigger(a.Event("shown.bs.dropdown",n))}return!1}},o.prototype.keydown=function(t){if(/(38|40|27|32)/.test(t.which)&&!/input|textarea/i.test(t.target.tagName)){var e=a(this);if(t.preventDefault(),t.stopPropagation(),!e.is(".disabled, :disabled")){var i=l(e),o=i.hasClass("open");if(!o&&27!=t.which||o&&27==t.which)return 27==t.which&&i.find(r).trigger("focus"),e.trigger("click");var n=i.find(".dropdown-menu li:not(.disabled):visible a");if(n.length){var s=n.index(t.target);38==t.which&&0<s&&s--,40==t.which&&s<n.length-1&&s++,~s||(s=0),n.eq(s).trigger("focus")}}}};var t=a.fn.dropdown;a.fn.dropdown=function e(i){return this.each(function(){var t=a(this),e=t.data("bs.dropdown");e||t.data("bs.dropdown",e=new o(this)),"string"==typeof i&&e[i].call(t)})},a.fn.dropdown.Constructor=o,a.fn.dropdown.noConflict=function(){return a.fn.dropdown=t,this},a(document).on("click.bs.dropdown.data-api",s).on("click.bs.dropdown.data-api",".dropdown form",function(t){t.stopPropagation()}).on("click.bs.dropdown.data-api",r,o.prototype.toggle).on("keydown.bs.dropdown.data-api",r,o.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",o.prototype.keydown)}(jQuery),function(a){"use strict";var s=function(t,e){this.options=e,this.$body=a(document.body),this.$element=a(t),this.$dialog=this.$element.find(".modal-dialog"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.fixedContent=".navbar-fixed-top, .navbar-fixed-bottom",this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,a.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};function r(o,n){return this.each(function(){var t=a(this),e=t.data("bs.modal"),i=a.extend({},s.DEFAULTS,t.data(),"object"==typeof o&&o);e||t.data("bs.modal",e=new s(this,i)),"string"==typeof o?e[o](n):i.show&&e.show(n)})}s.VERSION="3.4.1",s.TRANSITION_DURATION=300,s.BACKDROP_TRANSITION_DURATION=150,s.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},s.prototype.toggle=function(t){return this.isShown?this.hide():this.show(t)},s.prototype.show=function(i){var o=this,t=a.Event("show.bs.modal",{relatedTarget:i});this.$element.trigger(t),this.isShown||t.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',a.proxy(this.hide,this)),this.$dialog.on("mousedown.dismiss.bs.modal",function(){o.$element.one("mouseup.dismiss.bs.modal",function(t){a(t.target).is(o.$element)&&(o.ignoreBackdropClick=!0)})}),this.backdrop(function(){var t=a.support.transition&&o.$element.hasClass("fade");o.$element.parent().length||o.$element.appendTo(o.$body),o.$element.show().scrollTop(0),o.adjustDialog(),t&&o.$element[0].offsetWidth,o.$element.addClass("in"),o.enforceFocus();var e=a.Event("shown.bs.modal",{relatedTarget:i});t?o.$dialog.one("bsTransitionEnd",function(){o.$element.trigger("focus").trigger(e)}).emulateTransitionEnd(s.TRANSITION_DURATION):o.$element.trigger("focus").trigger(e)}))},s.prototype.hide=function(t){t&&t.preventDefault(),t=a.Event("hide.bs.modal"),this.$element.trigger(t),this.isShown&&!t.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),a(document).off("focusin.bs.modal"),this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),a.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",a.proxy(this.hideModal,this)).emulateTransitionEnd(s.TRANSITION_DURATION):this.hideModal())},s.prototype.enforceFocus=function(){a(document).off("focusin.bs.modal").on("focusin.bs.modal",a.proxy(function(t){document===t.target||this.$element[0]===t.target||this.$element.has(t.target).length||this.$element.trigger("focus")},this))},s.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",a.proxy(function(t){27==t.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},s.prototype.resize=function(){this.isShown?a(window).on("resize.bs.modal",a.proxy(this.handleUpdate,this)):a(window).off("resize.bs.modal")},s.prototype.hideModal=function(){var t=this;this.$element.hide(),this.backdrop(function(){t.$body.removeClass("modal-open"),t.resetAdjustments(),t.resetScrollbar(),t.$element.trigger("hidden.bs.modal")})},s.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},s.prototype.backdrop=function(t){var e=this,i=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var o=a.support.transition&&i;if(this.$backdrop=a(document.createElement("div")).addClass("modal-backdrop "+i).appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",a.proxy(function(t){this.ignoreBackdropClick?this.ignoreBackdropClick=!1:t.target===t.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus():this.hide())},this)),o&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!t)return;o?this.$backdrop.one("bsTransitionEnd",t).emulateTransitionEnd(s.BACKDROP_TRANSITION_DURATION):t()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var n=function(){e.removeBackdrop(),t&&t()};a.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",n).emulateTransitionEnd(s.BACKDROP_TRANSITION_DURATION):n()}else t&&t()},s.prototype.handleUpdate=function(){this.adjustDialog()},s.prototype.adjustDialog=function(){var t=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&t?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!t?this.scrollbarWidth:""})},s.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},s.prototype.checkScrollbar=function(){var t=window.innerWidth;if(!t){var e=document.documentElement.getBoundingClientRect();t=e.right-Math.abs(e.left)}this.bodyIsOverflowing=document.body.clientWidth<t,this.scrollbarWidth=this.measureScrollbar()},s.prototype.setScrollbar=function(){var t=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"";var n=this.scrollbarWidth;this.bodyIsOverflowing&&(this.$body.css("padding-right",t+n),a(this.fixedContent).each(function(t,e){var i=e.style.paddingRight,o=a(e).css("padding-right");a(e).data("padding-right",i).css("padding-right",parseFloat(o)+n+"px")}))},s.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad),a(this.fixedContent).each(function(t,e){var i=a(e).data("padding-right");a(e).removeData("padding-right"),e.style.paddingRight=i||""})},s.prototype.measureScrollbar=function(){var t=document.createElement("div");t.className="modal-scrollbar-measure",this.$body.append(t);var e=t.offsetWidth-t.clientWidth;return this.$body[0].removeChild(t),e};var t=a.fn.modal;a.fn.modal=r,a.fn.modal.Constructor=s,a.fn.modal.noConflict=function(){return a.fn.modal=t,this},a(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(t){var e=a(this),i=e.attr("href"),o=e.attr("data-target")||i&&i.replace(/.*(?=#[^\s]+$)/,""),n=a(document).find(o),s=n.data("bs.modal")?"toggle":a.extend({remote:!/#/.test(i)&&i},n.data(),e.data());e.is("a")&&t.preventDefault(),n.one("show.bs.modal",function(t){t.isDefaultPrevented()||n.one("hidden.bs.modal",function(){e.is(":visible")&&e.trigger("focus")})}),r.call(n,s,this)})}(jQuery),function(g){"use strict";var o=["sanitize","whiteList","sanitizeFn"],a=["background","cite","href","itemtype","longdesc","poster","src","xlink:href"],t={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],div:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},r=/^(?:(?:https?|mailto|ftp|tel|file):|[^&:/?#]*(?:[/?#]|$))/gi,l=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+/]+=*$/i;function u(t,e){var i=t.nodeName.toLowerCase();if(-1!==g.inArray(i,e))return-1===g.inArray(i,a)||Boolean(t.nodeValue.match(r)||t.nodeValue.match(l));for(var o=g(e).filter(function(t,e){return e instanceof RegExp}),n=0,s=o.length;n<s;n++)if(i.match(o[n]))return!0;return!1}function n(t,e,i){if(0===t.length)return t;if(i&&"function"==typeof i)return i(t);if(!document.implementation||!document.implementation.createHTMLDocument)return t;var o=document.implementation.createHTMLDocument("sanitization");o.body.innerHTML=t;for(var n=g.map(e,function(t,e){return e}),s=g(o.body).find("*"),a=0,r=s.length;a<r;a++){var l=s[a],h=l.nodeName.toLowerCase();if(-1!==g.inArray(h,n))for(var d=g.map(l.attributes,function(t){return t}),p=[].concat(e["*"]||[],e[h]||[]),c=0,f=d.length;c<f;c++)u(d[c],p)||l.removeAttribute(d[c].nodeName);else l.parentNode.removeChild(l)}return o.body.innerHTML}var m=function(t,e){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("tooltip",t,e)};m.VERSION="3.4.1",m.TRANSITION_DURATION=150,m.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0},sanitize:!0,sanitizeFn:null,whiteList:t},m.prototype.init=function(t,e,i){if(this.enabled=!0,this.type=t,this.$element=g(e),this.options=this.getOptions(i),this.$viewport=this.options.viewport&&g(document).find(g.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var o=this.options.trigger.split(" "),n=o.length;n--;){var s=o[n];if("click"==s)this.$element.on("click."+this.type,this.options.selector,g.proxy(this.toggle,this));else if("manual"!=s){var a="hover"==s?"mouseenter":"focusin",r="hover"==s?"mouseleave":"focusout";this.$element.on(a+"."+this.type,this.options.selector,g.proxy(this.enter,this)),this.$element.on(r+"."+this.type,this.options.selector,g.proxy(this.leave,this))}}this.options.selector?this._options=g.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},m.prototype.getDefaults=function(){return m.DEFAULTS},m.prototype.getOptions=function(t){var e=this.$element.data();for(var i in e)e.hasOwnProperty(i)&&-1!==g.inArray(i,o)&&delete e[i];return(t=g.extend({},this.getDefaults(),e,t)).delay&&"number"==typeof t.delay&&(t.delay={show:t.delay,hide:t.delay}),t.sanitize&&(t.template=n(t.template,t.whiteList,t.sanitizeFn)),t},m.prototype.getDelegateOptions=function(){var i={},o=this.getDefaults();return this._options&&g.each(this._options,function(t,e){o[t]!=e&&(i[t]=e)}),i},m.prototype.enter=function(t){var e=t instanceof this.constructor?t:g(t.currentTarget).data("bs."+this.type);if(e||(e=new this.constructor(t.currentTarget,this.getDelegateOptions()),g(t.currentTarget).data("bs."+this.type,e)),t instanceof g.Event&&(e.inState["focusin"==t.type?"focus":"hover"]=!0),e.tip().hasClass("in")||"in"==e.hoverState)e.hoverState="in";else{if(clearTimeout(e.timeout),e.hoverState="in",!e.options.delay||!e.options.delay.show)return e.show();e.timeout=setTimeout(function(){"in"==e.hoverState&&e.show()},e.options.delay.show)}},m.prototype.isInStateTrue=function(){for(var t in this.inState)if(this.inState[t])return!0;return!1},m.prototype.leave=function(t){var e=t instanceof this.constructor?t:g(t.currentTarget).data("bs."+this.type);if(e||(e=new this.constructor(t.currentTarget,this.getDelegateOptions()),g(t.currentTarget).data("bs."+this.type,e)),t instanceof g.Event&&(e.inState["focusout"==t.type?"focus":"hover"]=!1),!e.isInStateTrue()){if(clearTimeout(e.timeout),e.hoverState="out",!e.options.delay||!e.options.delay.hide)return e.hide();e.timeout=setTimeout(function(){"out"==e.hoverState&&e.hide()},e.options.delay.hide)}},m.prototype.show=function(){var t=g.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(t);var e=g.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(t.isDefaultPrevented()||!e)return;var i=this,o=this.tip(),n=this.getUID(this.type);this.setContent(),o.attr("id",n),this.$element.attr("aria-describedby",n),this.options.animation&&o.addClass("fade");var s="function"==typeof this.options.placement?this.options.placement.call(this,o[0],this.$element[0]):this.options.placement,a=/\s?auto?\s?/i,r=a.test(s);r&&(s=s.replace(a,"")||"top"),o.detach().css({top:0,left:0,display:"block"}).addClass(s).data("bs."+this.type,this),this.options.container?o.appendTo(g(document).find(this.options.container)):o.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var l=this.getPosition(),h=o[0].offsetWidth,d=o[0].offsetHeight;if(r){var p=s,c=this.getPosition(this.$viewport);s="bottom"==s&&l.bottom+d>c.bottom?"top":"top"==s&&l.top-d<c.top?"bottom":"right"==s&&l.right+h>c.width?"left":"left"==s&&l.left-h<c.left?"right":s,o.removeClass(p).addClass(s)}var f=this.getCalculatedOffset(s,l,h,d);this.applyPlacement(f,s);var u=function(){var t=i.hoverState;i.$element.trigger("shown.bs."+i.type),i.hoverState=null,"out"==t&&i.leave(i)};g.support.transition&&this.$tip.hasClass("fade")?o.one("bsTransitionEnd",u).emulateTransitionEnd(m.TRANSITION_DURATION):u()}},m.prototype.applyPlacement=function(t,e){var i=this.tip(),o=i[0].offsetWidth,n=i[0].offsetHeight,s=parseInt(i.css("margin-top"),10),a=parseInt(i.css("margin-left"),10);isNaN(s)&&(s=0),isNaN(a)&&(a=0),t.top+=s,t.left+=a,g.offset.setOffset(i[0],g.extend({using:function(t){i.css({top:Math.round(t.top),left:Math.round(t.left)})}},t),0),i.addClass("in");var r=i[0].offsetWidth,l=i[0].offsetHeight;"top"==e&&l!=n&&(t.top=t.top+n-l);var h=this.getViewportAdjustedDelta(e,t,r,l);h.left?t.left+=h.left:t.top+=h.top;var d=/top|bottom/.test(e),p=d?2*h.left-o+r:2*h.top-n+l,c=d?"offsetWidth":"offsetHeight";i.offset(t),this.replaceArrow(p,i[0][c],d)},m.prototype.replaceArrow=function(t,e,i){this.arrow().css(i?"left":"top",50*(1-t/e)+"%").css(i?"top":"left","")},m.prototype.setContent=function(){var t=this.tip(),e=this.getTitle();this.options.html?(this.options.sanitize&&(e=n(e,this.options.whiteList,this.options.sanitizeFn)),t.find(".tooltip-inner").html(e)):t.find(".tooltip-inner").text(e),t.removeClass("fade in top bottom left right")},m.prototype.hide=function(t){var e=this,i=g(this.$tip),o=g.Event("hide.bs."+this.type);function n(){"in"!=e.hoverState&&i.detach(),e.$element&&e.$element.removeAttr("aria-describedby").trigger("hidden.bs."+e.type),t&&t()}if(this.$element.trigger(o),!o.isDefaultPrevented())return i.removeClass("in"),g.support.transition&&i.hasClass("fade")?i.one("bsTransitionEnd",n).emulateTransitionEnd(m.TRANSITION_DURATION):n(),this.hoverState=null,this},m.prototype.fixTitle=function(){var t=this.$element;(t.attr("title")||"string"!=typeof t.attr("data-original-title"))&&t.attr("data-original-title",t.attr("title")||"").attr("title","")},m.prototype.hasContent=function(){return this.getTitle()},m.prototype.getPosition=function(t){var e=(t=t||this.$element)[0],i="BODY"==e.tagName,o=e.getBoundingClientRect();null==o.width&&(o=g.extend({},o,{width:o.right-o.left,height:o.bottom-o.top}));var n=window.SVGElement&&e instanceof window.SVGElement,s=i?{top:0,left:0}:n?null:t.offset(),a={scroll:i?document.documentElement.scrollTop||document.body.scrollTop:t.scrollTop()},r=i?{width:g(window).width(),height:g(window).height()}:null;return g.extend({},o,a,r,s)},m.prototype.getCalculatedOffset=function(t,e,i,o){return"bottom"==t?{top:e.top+e.height,left:e.left+e.width/2-i/2}:"top"==t?{top:e.top-o,left:e.left+e.width/2-i/2}:"left"==t?{top:e.top+e.height/2-o/2,left:e.left-i}:{top:e.top+e.height/2-o/2,left:e.left+e.width}},m.prototype.getViewportAdjustedDelta=function(t,e,i,o){var n={top:0,left:0};if(!this.$viewport)return n;var s=this.options.viewport&&this.options.viewport.padding||0,a=this.getPosition(this.$viewport);if(/right|left/.test(t)){var r=e.top-s-a.scroll,l=e.top+s-a.scroll+o;r<a.top?n.top=a.top-r:l>a.top+a.height&&(n.top=a.top+a.height-l)}else{var h=e.left-s,d=e.left+s+i;h<a.left?n.left=a.left-h:d>a.right&&(n.left=a.left+a.width-d)}return n},m.prototype.getTitle=function(){var t=this.$element,e=this.options;return t.attr("data-original-title")||("function"==typeof e.title?e.title.call(t[0]):e.title)},m.prototype.getUID=function(t){for(;t+=~~(1e6*Math.random()),document.getElementById(t););return t},m.prototype.tip=function(){if(!this.$tip&&(this.$tip=g(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},m.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},m.prototype.enable=function(){this.enabled=!0},m.prototype.disable=function(){this.enabled=!1},m.prototype.toggleEnabled=function(){this.enabled=!this.enabled},m.prototype.toggle=function(t){var e=this;t&&((e=g(t.currentTarget).data("bs."+this.type))||(e=new this.constructor(t.currentTarget,this.getDelegateOptions()),g(t.currentTarget).data("bs."+this.type,e))),t?(e.inState.click=!e.inState.click,e.isInStateTrue()?e.enter(e):e.leave(e)):e.tip().hasClass("in")?e.leave(e):e.enter(e)},m.prototype.destroy=function(){var t=this;clearTimeout(this.timeout),this.hide(function(){t.$element.off("."+t.type).removeData("bs."+t.type),t.$tip&&t.$tip.detach(),t.$tip=null,t.$arrow=null,t.$viewport=null,t.$element=null})},m.prototype.sanitizeHtml=function(t){return n(t,this.options.whiteList,this.options.sanitizeFn)};var e=g.fn.tooltip;g.fn.tooltip=function i(o){return this.each(function(){var t=g(this),e=t.data("bs.tooltip"),i="object"==typeof o&&o;!e&&/destroy|hide/.test(o)||(e||t.data("bs.tooltip",e=new m(this,i)),"string"==typeof o&&e[o]())})},g.fn.tooltip.Constructor=m,g.fn.tooltip.noConflict=function(){return g.fn.tooltip=e,this}}(jQuery),function(n){"use strict";var s=function(t,e){this.init("popover",t,e)};if(!n.fn.tooltip)throw new Error("Popover requires tooltip.js");s.VERSION="3.4.1",s.DEFAULTS=n.extend({},n.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),((s.prototype=n.extend({},n.fn.tooltip.Constructor.prototype)).constructor=s).prototype.getDefaults=function(){return s.DEFAULTS},s.prototype.setContent=function(){var t=this.tip(),e=this.getTitle(),i=this.getContent();if(this.options.html){var o=typeof i;this.options.sanitize&&(e=this.sanitizeHtml(e),"string"===o&&(i=this.sanitizeHtml(i))),t.find(".popover-title").html(e),t.find(".popover-content").children().detach().end()["string"===o?"html":"append"](i)}else t.find(".popover-title").text(e),t.find(".popover-content").children().detach().end().text(i);t.removeClass("fade top bottom left right in"),t.find(".popover-title").html()||t.find(".popover-title").hide()},s.prototype.hasContent=function(){return this.getTitle()||this.getContent()},s.prototype.getContent=function(){var t=this.$element,e=this.options;return t.attr("data-content")||("function"==typeof e.content?e.content.call(t[0]):e.content)},s.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};var t=n.fn.popover;n.fn.popover=function e(o){return this.each(function(){var t=n(this),e=t.data("bs.popover"),i="object"==typeof o&&o;!e&&/destroy|hide/.test(o)||(e||t.data("bs.popover",e=new s(this,i)),"string"==typeof o&&e[o]())})},n.fn.popover.Constructor=s,n.fn.popover.noConflict=function(){return n.fn.popover=t,this}}(jQuery),function(s){"use strict";function n(t,e){this.$body=s(document.body),this.$scrollElement=s(t).is(document.body)?s(window):s(t),this.options=s.extend({},n.DEFAULTS,e),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",s.proxy(this.process,this)),this.refresh(),this.process()}function e(o){return this.each(function(){var t=s(this),e=t.data("bs.scrollspy"),i="object"==typeof o&&o;e||t.data("bs.scrollspy",e=new n(this,i)),"string"==typeof o&&e[o]()})}n.VERSION="3.4.1",n.DEFAULTS={offset:10},n.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},n.prototype.refresh=function(){var t=this,o="offset",n=0;this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight(),s.isWindow(this.$scrollElement[0])||(o="position",n=this.$scrollElement.scrollTop()),this.$body.find(this.selector).map(function(){var t=s(this),e=t.data("target")||t.attr("href"),i=/^#./.test(e)&&s(e);return i&&i.length&&i.is(":visible")&&[[i[o]().top+n,e]]||null}).sort(function(t,e){return t[0]-e[0]}).each(function(){t.offsets.push(this[0]),t.targets.push(this[1])})},n.prototype.process=function(){var t,e=this.$scrollElement.scrollTop()+this.options.offset,i=this.getScrollHeight(),o=this.options.offset+i-this.$scrollElement.height(),n=this.offsets,s=this.targets,a=this.activeTarget;if(this.scrollHeight!=i&&this.refresh(),o<=e)return a!=(t=s[s.length-1])&&this.activate(t);if(a&&e<n[0])return this.activeTarget=null,this.clear();for(t=n.length;t--;)a!=s[t]&&e>=n[t]&&(n[t+1]===undefined||e<n[t+1])&&this.activate(s[t])},n.prototype.activate=function(t){this.activeTarget=t,this.clear();var e=this.selector+'[data-target="'+t+'"],'+this.selector+'[href="'+t+'"]',i=s(e).parents("li").addClass("active");i.parent(".dropdown-menu").length&&(i=i.closest("li.dropdown").addClass("active")),i.trigger("activate.bs.scrollspy")},n.prototype.clear=function(){s(this.selector).parentsUntil(this.options.target,".active").removeClass("active")};var t=s.fn.scrollspy;s.fn.scrollspy=e,s.fn.scrollspy.Constructor=n,s.fn.scrollspy.noConflict=function(){return s.fn.scrollspy=t,this},s(window).on("load.bs.scrollspy.data-api",function(){s('[data-spy="scroll"]').each(function(){var t=s(this);e.call(t,t.data())})})}(jQuery),function(r){"use strict";var a=function(t){this.element=r(t)};function e(i){return this.each(function(){var t=r(this),e=t.data("bs.tab");e||t.data("bs.tab",e=new a(this)),"string"==typeof i&&e[i]()})}a.VERSION="3.4.1",a.TRANSITION_DURATION=150,a.prototype.show=function(){var t=this.element,e=t.closest("ul:not(.dropdown-menu)"),i=t.data("target");if(i||(i=(i=t.attr("href"))&&i.replace(/.*(?=#[^\s]*$)/,"")),!t.parent("li").hasClass("active")){var o=e.find(".active:last a"),n=r.Event("hide.bs.tab",{relatedTarget:t[0]}),s=r.Event("show.bs.tab",{relatedTarget:o[0]});if(o.trigger(n),t.trigger(s),!s.isDefaultPrevented()&&!n.isDefaultPrevented()){var a=r(document).find(i);this.activate(t.closest("li"),e),this.activate(a,a.parent(),function(){o.trigger({type:"hidden.bs.tab",relatedTarget:t[0]}),t.trigger({type:"shown.bs.tab",relatedTarget:o[0]})})}}},a.prototype.activate=function(t,e,i){var o=e.find("> .active"),n=i&&r.support.transition&&(o.length&&o.hasClass("fade")||!!e.find("> .fade").length);function s(){o.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),t.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),n?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu").length&&t.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),i&&i()}o.length&&n?o.one("bsTransitionEnd",s).emulateTransitionEnd(a.TRANSITION_DURATION):s(),o.removeClass("in")};var t=r.fn.tab;r.fn.tab=e,r.fn.tab.Constructor=a,r.fn.tab.noConflict=function(){return r.fn.tab=t,this};var i=function(t){t.preventDefault(),e.call(r(this),"show")};r(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',i).on("click.bs.tab.data-api",'[data-toggle="pill"]',i)}(jQuery),function(l){"use strict";var h=function(t,e){this.options=l.extend({},h.DEFAULTS,e);var i=this.options.target===h.DEFAULTS.target?l(this.options.target):l(document).find(this.options.target);this.$target=i.on("scroll.bs.affix.data-api",l.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",l.proxy(this.checkPositionWithEventLoop,this)),this.$element=l(t),this.affixed=null,this.unpin=null,this.pinnedOffset=null,this.checkPosition()};function i(o){return this.each(function(){var t=l(this),e=t.data("bs.affix"),i="object"==typeof o&&o;e||t.data("bs.affix",e=new h(this,i)),"string"==typeof o&&e[o]()})}h.VERSION="3.4.1",h.RESET="affix affix-top affix-bottom",h.DEFAULTS={offset:0,target:window},h.prototype.getState=function(t,e,i,o){var n=this.$target.scrollTop(),s=this.$element.offset(),a=this.$target.height();if(null!=i&&"top"==this.affixed)return n<i&&"top";if("bottom"==this.affixed)return null!=i?!(n+this.unpin<=s.top)&&"bottom":!(n+a<=t-o)&&"bottom";var r=null==this.affixed,l=r?n:s.top;return null!=i&&n<=i?"top":null!=o&&t-o<=l+(r?a:e)&&"bottom"},h.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(h.RESET).addClass("affix");var t=this.$target.scrollTop(),e=this.$element.offset();return this.pinnedOffset=e.top-t},h.prototype.checkPositionWithEventLoop=function(){setTimeout(l.proxy(this.checkPosition,this),1)},h.prototype.checkPosition=function(){if(this.$element.is(":visible")){var t=this.$element.height(),e=this.options.offset,i=e.top,o=e.bottom,n=Math.max(l(document).height(),l(document.body).height());"object"!=typeof e&&(o=i=e),"function"==typeof i&&(i=e.top(this.$element)),"function"==typeof o&&(o=e.bottom(this.$element));var s=this.getState(n,t,i,o);if(this.affixed!=s){null!=this.unpin&&this.$element.css("top","");var a="affix"+(s?"-"+s:""),r=l.Event(a+".bs.affix");if(this.$element.trigger(r),r.isDefaultPrevented())return;this.affixed=s,this.unpin="bottom"==s?this.getPinnedOffset():null,this.$element.removeClass(h.RESET).addClass(a).trigger(a.replace("affix","affixed")+".bs.affix")}"bottom"==s&&this.$element.offset({top:n-t-o})}};var t=l.fn.affix;l.fn.affix=i,l.fn.affix.Constructor=h,l.fn.affix.noConflict=function(){return l.fn.affix=t,this},l(window).on("load",function(){l('[data-spy="affix"]').each(function(){var t=l(this),e=t.data();e.offset=e.offset||{},null!=e.offsetBottom&&(e.offset.bottom=e.offsetBottom),null!=e.offsetTop&&(e.offset.top=e.offsetTop),i.call(t,e)})})}(jQuery);
/*!
 * jQuery Cookie Plugin v1.4.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2006, 2014 Klaus Hartl
 * Released under the MIT license
 */
(function (factory) {
    if (typeof define === 'function' && define.amd) {
        // AMD (Register as an anonymous module)
        define(['jquery'], factory);
    } else if (typeof exports === 'object') {
        // Node/CommonJS
        module.exports = factory(require('jquery'));
    } else {
        // Browser globals
        factory(jQuery);
    }
}(function ($) {

    var pluses = /\+/g;

    function encode(s) {
        return config.raw ? s : encodeURIComponent(s);
    }

    function decode(s) {
        return config.raw ? s : decodeURIComponent(s);
    }

    function stringifyCookieValue(value) {
        return encode(config.json ? JSON.stringify(value) : String(value));
    }

    function parseCookieValue(s) {
        if (s.indexOf('"') === 0) {
            // This is a quoted cookie as according to RFC2068, unescape...
            s = s.slice(1, -1).replace(/\\"/g, '"').replace(/\\\\/g, '\\');
        }

        try {
            // Replace server-side written pluses with spaces.
            // If we can't decode the cookie, ignore it, it's unusable.
            // If we can't parse the cookie, ignore it, it's unusable.
            s = decodeURIComponent(s.replace(pluses, ' '));
            return config.json ? JSON.parse(s) : s;
        } catch (e) {
        }
    }

    function read(s, converter) {
        var value = config.raw ? s : parseCookieValue(s);
        return $.isFunction(converter) ? converter(value) : value;
    }

    var config = $.cookie = function (key, value, options) {

        // Write

        if (arguments.length > 1 && !$.isFunction(value)) {
            options = $.extend({}, config.defaults, options);

            if (typeof options.expires === 'number') {
                var days = options.expires, t = options.expires = new Date();
                t.setMilliseconds(t.getMilliseconds() + days * 864e+5);
            }

            return (document.cookie = [
                encode(key), '=', stringifyCookieValue(value),
                options.expires ? '; expires=' + options.expires.toUTCString() : '', // use expires attribute, max-age is not supported by IE
                options.path ? '; path=' + options.path : '',
                options.domain ? '; domain=' + options.domain : '',
                options.secure ? '; secure' : ''
            ].join(''));
        }

        // Read

        var result = key ? undefined : {},
            // To prevent the for loop in the first place assign an empty array
            // in case there are no cookies at all. Also prevents odd result when
            // calling $.cookie().
            cookies = document.cookie ? document.cookie.split('; ') : [],
            i = 0,
            l = cookies.length;

        for (; i < l; i++) {
            var parts = cookies[i].split('='),
                name = decode(parts.shift()),
                cookie = parts.join('=');

            if (key === name) {
                // If second argument (value) is a function it's a converter...
                result = read(cookie, value);
                break;
            }

            // Prevent storing a cookie that we couldn't decode.
            if (!key && (cookie = read(cookie)) !== undefined) {
                result[name] = cookie;
            }
        }

        return result;
    };

    config.defaults = {};

    $.removeCookie = function (key, options) {
        // Must not alter options, thus extending a fresh object...
        $.cookie(key, '', $.extend({}, options, {expires: -1}));
        return !$.cookie(key);
    };

}));

"function"!==typeof Object.create&&(Object.create=function(f){function g(){}g.prototype=f;return new g});
(function(f,g,k){var l={init:function(a,b){this.$elem=f(b);this.options=f.extend({},f.fn.owlCarousel.options,this.$elem.data(),a);this.userOptions=a;this.loadContent()},loadContent:function(){function a(a){var d,e="";if("function"===typeof b.options.jsonSuccess)b.options.jsonSuccess.apply(this,[a]);else{for(d in a.owl)a.owl.hasOwnProperty(d)&&(e+=a.owl[d].item);b.$elem.html(e)}b.logIn()}var b=this,e;"function"===typeof b.options.beforeInit&&b.options.beforeInit.apply(this,[b.$elem]);"string"===typeof b.options.jsonPath?
(e=b.options.jsonPath,f.getJSON(e,a)):b.logIn()},logIn:function(){this.$elem.data("owl-originalStyles",this.$elem.attr("style"));this.$elem.data("owl-originalClasses",this.$elem.attr("class"));this.$elem.css({opacity:0});this.orignalItems=this.options.items;this.checkBrowser();this.wrapperWidth=0;this.checkVisible=null;this.setVars()},setVars:function(){if(0===this.$elem.children().length)return!1;this.baseClass();this.eventTypes();this.$userItems=this.$elem.children();this.itemsAmount=this.$userItems.length;
this.wrapItems();this.$owlItems=this.$elem.find(".owl-item");this.$owlWrapper=this.$elem.find(".owl-wrapper");this.playDirection="next";this.prevItem=0;this.prevArr=[0];this.currentItem=0;this.customEvents();this.onStartup()},onStartup:function(){this.updateItems();this.calculateAll();this.buildControls();this.updateControls();this.response();this.moveEvents();this.stopOnHover();this.owlStatus();!1!==this.options.transitionStyle&&this.transitionTypes(this.options.transitionStyle);!0===this.options.autoPlay&&
(this.options.autoPlay=5E3);this.play();this.$elem.find(".owl-wrapper").css("display","block");this.$elem.is(":visible")?this.$elem.css("opacity",1):this.watchVisibility();this.onstartup=!1;this.eachMoveUpdate();"function"===typeof this.options.afterInit&&this.options.afterInit.apply(this,[this.$elem])},eachMoveUpdate:function(){!0===this.options.lazyLoad&&this.lazyLoad();!0===this.options.autoHeight&&this.autoHeight();this.onVisibleItems();"function"===typeof this.options.afterAction&&this.options.afterAction.apply(this,
[this.$elem])},updateVars:function(){"function"===typeof this.options.beforeUpdate&&this.options.beforeUpdate.apply(this,[this.$elem]);this.watchVisibility();this.updateItems();this.calculateAll();this.updatePosition();this.updateControls();this.eachMoveUpdate();"function"===typeof this.options.afterUpdate&&this.options.afterUpdate.apply(this,[this.$elem])},reload:function(){var a=this;g.setTimeout(function(){a.updateVars()},0)},watchVisibility:function(){var a=this;if(!1===a.$elem.is(":visible"))a.$elem.css({opacity:0}),
g.clearInterval(a.autoPlayInterval),g.clearInterval(a.checkVisible);else return!1;a.checkVisible=g.setInterval(function(){a.$elem.is(":visible")&&(a.reload(),a.$elem.animate({opacity:1},200),g.clearInterval(a.checkVisible))},500)},wrapItems:function(){this.$userItems.wrapAll('<div class="owl-wrapper">').wrap('<div class="owl-item"></div>');this.$elem.find(".owl-wrapper").wrap('<div class="owl-wrapper-outer">');this.wrapperOuter=this.$elem.find(".owl-wrapper-outer");this.$elem.css("display","block")},
baseClass:function(){var a=this.$elem.hasClass(this.options.baseClass),b=this.$elem.hasClass(this.options.theme);a||this.$elem.addClass(this.options.baseClass);b||this.$elem.addClass(this.options.theme)},updateItems:function(){var a,b;if(!1===this.options.responsive)return!1;if(!0===this.options.singleItem)return this.options.items=this.orignalItems=1,this.options.itemsCustom=!1,this.options.itemsDesktop=!1,this.options.itemsDesktopSmall=!1,this.options.itemsTablet=!1,this.options.itemsTabletSmall=
!1,this.options.itemsMobile=!1;a=f(this.options.responsiveBaseWidth).width();a>(this.options.itemsDesktop[0]||this.orignalItems)&&(this.options.items=this.orignalItems);if(!1!==this.options.itemsCustom)for(this.options.itemsCustom.sort(function(a,b){return a[0]-b[0]}),b=0;b<this.options.itemsCustom.length;b+=1)this.options.itemsCustom[b][0]<=a&&(this.options.items=this.options.itemsCustom[b][1]);else a<=this.options.itemsDesktop[0]&&!1!==this.options.itemsDesktop&&(this.options.items=this.options.itemsDesktop[1]),
a<=this.options.itemsDesktopSmall[0]&&!1!==this.options.itemsDesktopSmall&&(this.options.items=this.options.itemsDesktopSmall[1]),a<=this.options.itemsTablet[0]&&!1!==this.options.itemsTablet&&(this.options.items=this.options.itemsTablet[1]),a<=this.options.itemsTabletSmall[0]&&!1!==this.options.itemsTabletSmall&&(this.options.items=this.options.itemsTabletSmall[1]),a<=this.options.itemsMobile[0]&&!1!==this.options.itemsMobile&&(this.options.items=this.options.itemsMobile[1]);this.options.items>this.itemsAmount&&
!0===this.options.itemsScaleUp&&(this.options.items=this.itemsAmount)},response:function(){var a=this,b,e;if(!0!==a.options.responsive)return!1;e=f(g).width();a.resizer=function(){f(g).width()!==e&&(!1!==a.options.autoPlay&&g.clearInterval(a.autoPlayInterval),g.clearTimeout(b),b=g.setTimeout(function(){e=f(g).width();a.updateVars()},a.options.responsiveRefreshRate))};f(g).resize(a.resizer)},updatePosition:function(){this.jumpTo(this.currentItem);!1!==this.options.autoPlay&&this.checkAp()},appendItemsSizes:function(){var a=
this,b=0,e=a.itemsAmount-a.options.items;a.$owlItems.each(function(c){var d=f(this);d.css({width:a.itemWidth}).data("owl-item",Number(c));if(0===c%a.options.items||c===e)c>e||(b+=1);d.data("owl-roundPages",b)})},appendWrapperSizes:function(){this.$owlWrapper.css({width:this.$owlItems.length*this.itemWidth*2,left:0});this.appendItemsSizes()},calculateAll:function(){this.calculateWidth();this.appendWrapperSizes();this.loops();this.max()},calculateWidth:function(){this.itemWidth=Math.round(this.$elem.width()/
this.options.items)},max:function(){var a=-1*(this.itemsAmount*this.itemWidth-this.options.items*this.itemWidth);this.options.items>this.itemsAmount?this.maximumPixels=a=this.maximumItem=0:(this.maximumItem=this.itemsAmount-this.options.items,this.maximumPixels=a);return a},min:function(){return 0},loops:function(){var a=0,b=0,e,c;this.positionsInArray=[0];this.pagesInArray=[];for(e=0;e<this.itemsAmount;e+=1)b+=this.itemWidth,this.positionsInArray.push(-b),!0===this.options.scrollPerPage&&(c=f(this.$owlItems[e]),
c=c.data("owl-roundPages"),c!==a&&(this.pagesInArray[a]=this.positionsInArray[e],a=c))},buildControls:function(){if(!0===this.options.navigation||!0===this.options.pagination)this.owlControls=f('<div class="owl-controls"/>').toggleClass("clickable",!this.browser.isTouch).appendTo(this.$elem);!0===this.options.pagination&&this.buildPagination();!0===this.options.navigation&&this.buildButtons()},buildButtons:function(){var a=this,b=f('<div class="owl-buttons"/>');a.owlControls.append(b);a.buttonPrev=
f("<div/>",{"class":"owl-prev",html:a.options.navigationText[0]||""});a.buttonNext=f("<div/>",{"class":"owl-next",html:a.options.navigationText[1]||""});b.append(a.buttonPrev).append(a.buttonNext);b.on("touchstart.owlControls mousedown.owlControls",'div[class^="owl"]',function(a){a.preventDefault()});b.on("touchend.owlControls mouseup.owlControls",'div[class^="owl"]',function(b){b.preventDefault();f(this).hasClass("owl-next")?a.next():a.prev()})},buildPagination:function(){var a=this;a.paginationWrapper=
f('<div class="owl-pagination"/>');a.owlControls.append(a.paginationWrapper);a.paginationWrapper.on("touchend.owlControls mouseup.owlControls",".owl-page",function(b){b.preventDefault();Number(f(this).data("owl-page"))!==a.currentItem&&a.goTo(Number(f(this).data("owl-page")),!0)})},updatePagination:function(){var a,b,e,c,d,g;if(!1===this.options.pagination)return!1;this.paginationWrapper.html("");a=0;b=this.itemsAmount-this.itemsAmount%this.options.items;for(c=0;c<this.itemsAmount;c+=1)0===c%this.options.items&&
(a+=1,b===c&&(e=this.itemsAmount-this.options.items),d=f("<div/>",{"class":"owl-page"}),g=f("<span></span>",{text:!0===this.options.paginationNumbers?a:"","class":!0===this.options.paginationNumbers?"owl-numbers":""}),d.append(g),d.data("owl-page",b===c?e:c),d.data("owl-roundPages",a),this.paginationWrapper.append(d));this.checkPagination()},checkPagination:function(){var a=this;if(!1===a.options.pagination)return!1;a.paginationWrapper.find(".owl-page").each(function(){f(this).data("owl-roundPages")===
f(a.$owlItems[a.currentItem]).data("owl-roundPages")&&(a.paginationWrapper.find(".owl-page").removeClass("active"),f(this).addClass("active"))})},checkNavigation:function(){if(!1===this.options.navigation)return!1;!1===this.options.rewindNav&&(0===this.currentItem&&0===this.maximumItem?(this.buttonPrev.addClass("disabled"),this.buttonNext.addClass("disabled")):0===this.currentItem&&0!==this.maximumItem?(this.buttonPrev.addClass("disabled"),this.buttonNext.removeClass("disabled")):this.currentItem===
this.maximumItem?(this.buttonPrev.removeClass("disabled"),this.buttonNext.addClass("disabled")):0!==this.currentItem&&this.currentItem!==this.maximumItem&&(this.buttonPrev.removeClass("disabled"),this.buttonNext.removeClass("disabled")))},updateControls:function(){this.updatePagination();this.checkNavigation();this.owlControls&&(this.options.items>=this.itemsAmount?this.owlControls.hide():this.owlControls.show())},destroyControls:function(){this.owlControls&&this.owlControls.remove()},next:function(a){if(this.isTransition)return!1;
this.currentItem+=!0===this.options.scrollPerPage?this.options.items:1;if(this.currentItem>this.maximumItem+(!0===this.options.scrollPerPage?this.options.items-1:0))if(!0===this.options.rewindNav)this.currentItem=0,a="rewind";else return this.currentItem=this.maximumItem,!1;this.goTo(this.currentItem,a)},prev:function(a){if(this.isTransition)return!1;this.currentItem=!0===this.options.scrollPerPage&&0<this.currentItem&&this.currentItem<this.options.items?0:this.currentItem-(!0===this.options.scrollPerPage?
this.options.items:1);if(0>this.currentItem)if(!0===this.options.rewindNav)this.currentItem=this.maximumItem,a="rewind";else return this.currentItem=0,!1;this.goTo(this.currentItem,a)},goTo:function(a,b,e){var c=this;if(c.isTransition)return!1;"function"===typeof c.options.beforeMove&&c.options.beforeMove.apply(this,[c.$elem]);a>=c.maximumItem?a=c.maximumItem:0>=a&&(a=0);c.currentItem=c.owl.currentItem=a;if(!1!==c.options.transitionStyle&&"drag"!==e&&1===c.options.items&&!0===c.browser.support3d)return c.swapSpeed(0),
!0===c.browser.support3d?c.transition3d(c.positionsInArray[a]):c.css2slide(c.positionsInArray[a],1),c.afterGo(),c.singleItemTransition(),!1;a=c.positionsInArray[a];!0===c.browser.support3d?(c.isCss3Finish=!1,!0===b?(c.swapSpeed("paginationSpeed"),g.setTimeout(function(){c.isCss3Finish=!0},c.options.paginationSpeed)):"rewind"===b?(c.swapSpeed(c.options.rewindSpeed),g.setTimeout(function(){c.isCss3Finish=!0},c.options.rewindSpeed)):(c.swapSpeed("slideSpeed"),g.setTimeout(function(){c.isCss3Finish=!0},
c.options.slideSpeed)),c.transition3d(a)):!0===b?c.css2slide(a,c.options.paginationSpeed):"rewind"===b?c.css2slide(a,c.options.rewindSpeed):c.css2slide(a,c.options.slideSpeed);c.afterGo()},jumpTo:function(a){"function"===typeof this.options.beforeMove&&this.options.beforeMove.apply(this,[this.$elem]);a>=this.maximumItem||-1===a?a=this.maximumItem:0>=a&&(a=0);this.swapSpeed(0);!0===this.browser.support3d?this.transition3d(this.positionsInArray[a]):this.css2slide(this.positionsInArray[a],1);this.currentItem=
this.owl.currentItem=a;this.afterGo()},afterGo:function(){this.prevArr.push(this.currentItem);this.prevItem=this.owl.prevItem=this.prevArr[this.prevArr.length-2];this.prevArr.shift(0);this.prevItem!==this.currentItem&&(this.checkPagination(),this.checkNavigation(),this.eachMoveUpdate(),!1!==this.options.autoPlay&&this.checkAp());"function"===typeof this.options.afterMove&&this.prevItem!==this.currentItem&&this.options.afterMove.apply(this,[this.$elem])},stop:function(){this.apStatus="stop";g.clearInterval(this.autoPlayInterval)},
checkAp:function(){"stop"!==this.apStatus&&this.play()},play:function(){var a=this;a.apStatus="play";if(!1===a.options.autoPlay)return!1;g.clearInterval(a.autoPlayInterval);a.autoPlayInterval=g.setInterval(function(){a.next(!0)},a.options.autoPlay)},swapSpeed:function(a){"slideSpeed"===a?this.$owlWrapper.css(this.addCssSpeed(this.options.slideSpeed)):"paginationSpeed"===a?this.$owlWrapper.css(this.addCssSpeed(this.options.paginationSpeed)):"string"!==typeof a&&this.$owlWrapper.css(this.addCssSpeed(a))},
addCssSpeed:function(a){return{"-webkit-transition":"all "+a+"ms ease","-moz-transition":"all "+a+"ms ease","-o-transition":"all "+a+"ms ease",transition:"all "+a+"ms ease"}},removeTransition:function(){return{"-webkit-transition":"","-moz-transition":"","-o-transition":"",transition:""}},doTranslate:function(a){return{"-webkit-transform":"translate3d("+a+"px, 0px, 0px)","-moz-transform":"translate3d("+a+"px, 0px, 0px)","-o-transform":"translate3d("+a+"px, 0px, 0px)","-ms-transform":"translate3d("+
a+"px, 0px, 0px)",transform:"translate3d("+a+"px, 0px,0px)"}},transition3d:function(a){this.$owlWrapper.css(this.doTranslate(a))},css2move:function(a){this.$owlWrapper.css({left:a})},css2slide:function(a,b){var e=this;e.isCssFinish=!1;e.$owlWrapper.stop(!0,!0).animate({left:a},{duration:b||e.options.slideSpeed,complete:function(){e.isCssFinish=!0}})},checkBrowser:function(){var a=k.createElement("div");a.style.cssText="  -moz-transform:translate3d(0px, 0px, 0px); -ms-transform:translate3d(0px, 0px, 0px); -o-transform:translate3d(0px, 0px, 0px); -webkit-transform:translate3d(0px, 0px, 0px); transform:translate3d(0px, 0px, 0px)";
a=a.style.cssText.match(/translate3d\(0px, 0px, 0px\)/g);this.browser={support3d:null!==a&&1===a.length,isTouch:"ontouchstart"in g||g.navigator.msMaxTouchPoints}},moveEvents:function(){if(!1!==this.options.mouseDrag||!1!==this.options.touchDrag)this.gestures(),this.disabledEvents()},eventTypes:function(){var a=["s","e","x"];this.ev_types={};!0===this.options.mouseDrag&&!0===this.options.touchDrag?a=["touchstart.owl mousedown.owl","touchmove.owl mousemove.owl","touchend.owl touchcancel.owl mouseup.owl"]:
!1===this.options.mouseDrag&&!0===this.options.touchDrag?a=["touchstart.owl","touchmove.owl","touchend.owl touchcancel.owl"]:!0===this.options.mouseDrag&&!1===this.options.touchDrag&&(a=["mousedown.owl","mousemove.owl","mouseup.owl"]);this.ev_types.start=a[0];this.ev_types.move=a[1];this.ev_types.end=a[2]},disabledEvents:function(){this.$elem.on("dragstart.owl",function(a){a.preventDefault()});this.$elem.on("mousedown.disableTextSelect",function(a){return f(a.target).is("input, textarea, select, option")})},
gestures:function(){function a(a){if(void 0!==a.touches)return{x:a.touches[0].pageX,y:a.touches[0].pageY};if(void 0===a.touches){if(void 0!==a.pageX)return{x:a.pageX,y:a.pageY};if(void 0===a.pageX)return{x:a.clientX,y:a.clientY}}}function b(a){"on"===a?(f(k).on(d.ev_types.move,e),f(k).on(d.ev_types.end,c)):"off"===a&&(f(k).off(d.ev_types.move),f(k).off(d.ev_types.end))}function e(b){b=b.originalEvent||b||g.event;d.newPosX=a(b).x-h.offsetX;d.newPosY=a(b).y-h.offsetY;d.newRelativeX=d.newPosX-h.relativePos;
"function"===typeof d.options.startDragging&&!0!==h.dragging&&0!==d.newRelativeX&&(h.dragging=!0,d.options.startDragging.apply(d,[d.$elem]));(8<d.newRelativeX||-8>d.newRelativeX)&&!0===d.browser.isTouch&&(void 0!==b.preventDefault?b.preventDefault():b.returnValue=!1,h.sliding=!0);(10<d.newPosY||-10>d.newPosY)&&!1===h.sliding&&f(k).off("touchmove.owl");d.newPosX=Math.max(Math.min(d.newPosX,d.newRelativeX/5),d.maximumPixels+d.newRelativeX/5);!0===d.browser.support3d?d.transition3d(d.newPosX):d.css2move(d.newPosX)}
function c(a){a=a.originalEvent||a||g.event;var c;a.target=a.target||a.srcElement;h.dragging=!1;!0!==d.browser.isTouch&&d.$owlWrapper.removeClass("grabbing");d.dragDirection=0>d.newRelativeX?d.owl.dragDirection="left":d.owl.dragDirection="right";0!==d.newRelativeX&&(c=d.getNewPosition(),d.goTo(c,!1,"drag"),h.targetElement===a.target&&!0!==d.browser.isTouch&&(f(a.target).on("click.disable",function(a){a.stopImmediatePropagation();a.stopPropagation();a.preventDefault();f(a.target).off("click.disable")}),
a=f._data(a.target,"events").click,c=a.pop(),a.splice(0,0,c)));b("off")}var d=this,h={offsetX:0,offsetY:0,baseElWidth:0,relativePos:0,position:null,minSwipe:null,maxSwipe:null,sliding:null,dargging:null,targetElement:null};d.isCssFinish=!0;d.$elem.on(d.ev_types.start,".owl-wrapper",function(c){c=c.originalEvent||c||g.event;var e;if(3===c.which)return!1;if(!(d.itemsAmount<=d.options.items)){if(!1===d.isCssFinish&&!d.options.dragBeforeAnimFinish||!1===d.isCss3Finish&&!d.options.dragBeforeAnimFinish)return!1;
!1!==d.options.autoPlay&&g.clearInterval(d.autoPlayInterval);!0===d.browser.isTouch||d.$owlWrapper.hasClass("grabbing")||d.$owlWrapper.addClass("grabbing");d.newPosX=0;d.newRelativeX=0;f(this).css(d.removeTransition());e=f(this).position();h.relativePos=e.left;h.offsetX=a(c).x-e.left;h.offsetY=a(c).y-e.top;b("on");h.sliding=!1;h.targetElement=c.target||c.srcElement}})},getNewPosition:function(){var a=this.closestItem();a>this.maximumItem?a=this.currentItem=this.maximumItem:0<=this.newPosX&&(this.currentItem=
a=0);return a},closestItem:function(){var a=this,b=!0===a.options.scrollPerPage?a.pagesInArray:a.positionsInArray,e=a.newPosX,c=null;f.each(b,function(d,g){e-a.itemWidth/20>b[d+1]&&e-a.itemWidth/20<g&&"left"===a.moveDirection()?(c=g,a.currentItem=!0===a.options.scrollPerPage?f.inArray(c,a.positionsInArray):d):e+a.itemWidth/20<g&&e+a.itemWidth/20>(b[d+1]||b[d]-a.itemWidth)&&"right"===a.moveDirection()&&(!0===a.options.scrollPerPage?(c=b[d+1]||b[b.length-1],a.currentItem=f.inArray(c,a.positionsInArray)):
(c=b[d+1],a.currentItem=d+1))});return a.currentItem},moveDirection:function(){var a;0>this.newRelativeX?(a="right",this.playDirection="next"):(a="left",this.playDirection="prev");return a},customEvents:function(){var a=this;a.$elem.on("owl.next",function(){a.next()});a.$elem.on("owl.prev",function(){a.prev()});a.$elem.on("owl.play",function(b,e){a.options.autoPlay=e;a.play();a.hoverStatus="play"});a.$elem.on("owl.stop",function(){a.stop();a.hoverStatus="stop"});a.$elem.on("owl.goTo",function(b,e){a.goTo(e)});
a.$elem.on("owl.jumpTo",function(b,e){a.jumpTo(e)})},stopOnHover:function(){var a=this;!0===a.options.stopOnHover&&!0!==a.browser.isTouch&&!1!==a.options.autoPlay&&(a.$elem.on("mouseover",function(){a.stop()}),a.$elem.on("mouseout",function(){"stop"!==a.hoverStatus&&a.play()}))},lazyLoad:function(){var a,b,e,c,d;if(!1===this.options.lazyLoad)return!1;for(a=0;a<this.itemsAmount;a+=1)b=f(this.$owlItems[a]),"loaded"!==b.data("owl-loaded")&&(e=b.data("owl-item"),c=b.find(".lazyOwl"),"string"!==typeof c.data("src")?
b.data("owl-loaded","loaded"):(void 0===b.data("owl-loaded")&&(c.hide(),b.addClass("loading").data("owl-loaded","checked")),(d=!0===this.options.lazyFollow?e>=this.currentItem:!0)&&e<this.currentItem+this.options.items&&c.length&&this.lazyPreload(b,c)))},lazyPreload:function(a,b){function e(){a.data("owl-loaded","loaded").removeClass("loading");b.removeAttr("data-src");"fade"===d.options.lazyEffect?b.fadeIn(400):b.show();"function"===typeof d.options.afterLazyLoad&&d.options.afterLazyLoad.apply(this,
[d.$elem])}function c(){f+=1;d.completeImg(b.get(0))||!0===k?e():100>=f?g.setTimeout(c,100):e()}var d=this,f=0,k;"DIV"===b.prop("tagName")?(b.css("background-image","url("+b.data("src")+")"),k=!0):b[0].src=b.data("src");c()},autoHeight:function(){function a(){var a=f(e.$owlItems[e.currentItem]).height();e.wrapperOuter.css("height",a+"px");e.wrapperOuter.hasClass("autoHeight")||g.setTimeout(function(){e.wrapperOuter.addClass("autoHeight")},0)}function b(){d+=1;e.completeImg(c.get(0))?a():100>=d?g.setTimeout(b,
100):e.wrapperOuter.css("height","")}var e=this,c=f(e.$owlItems[e.currentItem]).find("img"),d;void 0!==c.get(0)?(d=0,b()):a()},completeImg:function(a){return!a.complete||"undefined"!==typeof a.naturalWidth&&0===a.naturalWidth?!1:!0},onVisibleItems:function(){var a;!0===this.options.addClassActive&&this.$owlItems.removeClass("active");this.visibleItems=[];for(a=this.currentItem;a<this.currentItem+this.options.items;a+=1)this.visibleItems.push(a),!0===this.options.addClassActive&&f(this.$owlItems[a]).addClass("active");
this.owl.visibleItems=this.visibleItems},transitionTypes:function(a){this.outClass="owl-"+a+"-out";this.inClass="owl-"+a+"-in"},singleItemTransition:function(){var a=this,b=a.outClass,e=a.inClass,c=a.$owlItems.eq(a.currentItem),d=a.$owlItems.eq(a.prevItem),f=Math.abs(a.positionsInArray[a.currentItem])+a.positionsInArray[a.prevItem],g=Math.abs(a.positionsInArray[a.currentItem])+a.itemWidth/2;a.isTransition=!0;a.$owlWrapper.addClass("owl-origin").css({"-webkit-transform-origin":g+"px","-moz-perspective-origin":g+
"px","perspective-origin":g+"px"});d.css({position:"relative",left:f+"px"}).addClass(b).on("webkitAnimationEnd oAnimationEnd MSAnimationEnd animationend",function(){a.endPrev=!0;d.off("webkitAnimationEnd oAnimationEnd MSAnimationEnd animationend");a.clearTransStyle(d,b)});c.addClass(e).on("webkitAnimationEnd oAnimationEnd MSAnimationEnd animationend",function(){a.endCurrent=!0;c.off("webkitAnimationEnd oAnimationEnd MSAnimationEnd animationend");a.clearTransStyle(c,e)})},clearTransStyle:function(a,
b){a.css({position:"",left:""}).removeClass(b);this.endPrev&&this.endCurrent&&(this.$owlWrapper.removeClass("owl-origin"),this.isTransition=this.endCurrent=this.endPrev=!1)},owlStatus:function(){this.owl={userOptions:this.userOptions,baseElement:this.$elem,userItems:this.$userItems,owlItems:this.$owlItems,currentItem:this.currentItem,prevItem:this.prevItem,visibleItems:this.visibleItems,isTouch:this.browser.isTouch,browser:this.browser,dragDirection:this.dragDirection}},clearEvents:function(){this.$elem.off(".owl owl mousedown.disableTextSelect");
f(k).off(".owl owl");f(g).off("resize",this.resizer)},unWrap:function(){0!==this.$elem.children().length&&(this.$owlWrapper.unwrap(),this.$userItems.unwrap().unwrap(),this.owlControls&&this.owlControls.remove());this.clearEvents();this.$elem.attr("style",this.$elem.data("owl-originalStyles")||"").attr("class",this.$elem.data("owl-originalClasses"))},destroy:function(){this.stop();g.clearInterval(this.checkVisible);this.unWrap();this.$elem.removeData()},reinit:function(a){a=f.extend({},this.userOptions,
a);this.unWrap();this.init(a,this.$elem)},addItem:function(a,b){var e;if(!a)return!1;if(0===this.$elem.children().length)return this.$elem.append(a),this.setVars(),!1;this.unWrap();e=void 0===b||-1===b?-1:b;e>=this.$userItems.length||-1===e?this.$userItems.eq(-1).after(a):this.$userItems.eq(e).before(a);this.setVars()},removeItem:function(a){if(0===this.$elem.children().length)return!1;a=void 0===a||-1===a?-1:a;this.unWrap();this.$userItems.eq(a).remove();this.setVars()}};f.fn.owlCarousel=function(a){return this.each(function(){if(!0===
f(this).data("owl-init"))return!1;f(this).data("owl-init",!0);var b=Object.create(l);b.init(a,this);f.data(this,"owlCarousel",b)})};f.fn.owlCarousel.options={items:5,itemsCustom:!1,itemsDesktop:[1199,4],itemsDesktopSmall:[979,3],itemsTablet:[768,2],itemsTabletSmall:!1,itemsMobile:[479,1],singleItem:!1,itemsScaleUp:!1,slideSpeed:200,paginationSpeed:800,rewindSpeed:1E3,autoPlay:!1,stopOnHover:!1,navigation:!1,navigationText:["prev","next"],rewindNav:!0,scrollPerPage:!1,pagination:!0,paginationNumbers:!1,
responsive:!0,responsiveRefreshRate:200,responsiveBaseWidth:g,baseClass:"owl-carousel",theme:"owl-theme",lazyLoad:!1,lazyFollow:!0,lazyEffect:"fade",autoHeight:!1,jsonPath:!1,jsonSuccess:!1,dragBeforeAnimFinish:!0,mouseDrag:!0,touchDrag:!0,addClassActive:!1,transitionStyle:!1,beforeUpdate:!1,afterUpdate:!1,beforeInit:!1,afterInit:!1,beforeMove:!1,afterMove:!1,afterAction:!1,startDragging:!1,afterLazyLoad:!1}})(jQuery,window,document);
/**
 *  File: jquery.idle.js
 *  Title:  JQuery Idle.
 *  A dead simple jQuery plugin that executes a callback function if the user is idle.
 *  About: Author
 *  Henrique Boaventura (hboaventura@gmail.com).
 *  About: Version
 *  1.2.7
 *  About: License
 *  Copyright (C) 2013, Henrique Boaventura (hboaventura@gmail.com).
 *  MIT License:
 *  Permission is hereby granted, free of charge, to any person obtaining a copy
 *  of this software and associated documentation files (the "Software"), to deal
 *  in the Software without restriction, including without limitation the rights
 *  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 *  copies of the Software, and to permit persons to whom the Software is
 *  furnished to do so, subject to the following conditions:
 *  - The above copyright notice and this permission notice shall be included in all
 *    copies or substantial portions of the Software.
 *  - THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 *    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 *    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 *    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 *    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 *    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 *    SOFTWARE.
 **/
/*jslint browser: true */
/*global jQuery: false */
(function ($) {
    'use strict';

    $.fn.idle = function (options) {
        var defaults = {
                idle: 60000, //idle time in ms
                events: 'mousemove keydown mousedown touchstart', //events that will trigger the idle resetter
                onIdle: function () {}, //callback function to be executed after idle time
                onActive: function () {}, //callback function to be executed after back from idleness
                onHide: function () {}, //callback function to be executed when window is hidden
                onShow: function () {}, //callback function to be executed when window is visible
                keepTracking: true, //set it to false if you want to track only the first time
                startAtIdle: false,
                recurIdleCall: false
            },
            idle = options.startAtIdle || false,
            visible = !options.startAtIdle || true,
            settings = $.extend({}, defaults, options),
            lastId = null,
            resetTimeout,
            timeout;

        //event to clear all idle events
        $(this).on( "idle:stop", {}, function( event) {
            $(this).off(settings.events);
            settings.keepTracking = false;
            resetTimeout(lastId, settings);
        });

        resetTimeout = function (id, settings) {
            if (idle) {
                idle = false;
                settings.onActive.call();
            }
            clearTimeout(id);
            if(settings.keepTracking) {
                return timeout(settings);
            }
        };

        timeout = function (settings) {
            var timer = (settings.recurIdleCall ? setInterval : setTimeout), id;
            id = timer(function () {
                idle = true;
                settings.onIdle.call();
            }, settings.idle);
            return id;
        };

        return this.each(function () {
            lastId = timeout(settings);
            $(this).on(settings.events, function (e) {
                lastId = resetTimeout(lastId, settings);
            });
            if (settings.onShow || settings.onHide) {
                $(document).on("visibilitychange webkitvisibilitychange mozvisibilitychange msvisibilitychange", function () {
                    if (document.hidden || document.webkitHidden || document.mozHidden || document.msHidden) {
                        if (visible) {
                            visible = false;
                            settings.onHide.call();
                        }
                    } else {
                        if (!visible) {
                            visible = true;
                            settings.onShow.call();
                        }
                    }
                });
            }
        });

    };
}(jQuery));

/*
     _ _      _       _
 ___| (_) ___| | __  (_)___
/ __| | |/ __| |/ /  | / __|
\__ \ | | (__|   < _ | \__ \
|___/_|_|\___|_|\_(_)/ |___/
                   |__/

 Version: 1.9.0
  Author: Ken Wheeler
 Website: http://kenwheeler.github.io
    Docs: http://kenwheeler.github.io/slick
    Repo: http://github.com/kenwheeler/slick
  Issues: http://github.com/kenwheeler/slick/issues

 */
(function(i){"use strict";"function"==typeof define&&define.amd?define(["jquery"],i):"undefined"!=typeof exports?module.exports=i(require("jquery")):i(jQuery)})(function(i){"use strict";var e=window.Slick||{};e=function(){function e(e,o){var s,n=this;n.defaults={accessibility:!0,adaptiveHeight:!1,appendArrows:i(e),appendDots:i(e),arrows:!0,asNavFor:null,prevArrow:'<button class="slick-prev" aria-label="Previous" type="button">Previous</button>',nextArrow:'<button class="slick-next" aria-label="Next" type="button">Next</button>',autoplay:!1,autoplaySpeed:3e3,centerMode:!1,centerPadding:"50px",cssEase:"ease",customPaging:function(e,t){return i('<button type="button" />').text(t+1)},dots:!1,dotsClass:"slick-dots",draggable:!0,easing:"linear",edgeFriction:.35,fade:!1,focusOnSelect:!1,focusOnChange:!1,infinite:!0,initialSlide:0,lazyLoad:"ondemand",mobileFirst:!1,pauseOnHover:!0,pauseOnFocus:!0,pauseOnDotsHover:!1,respondTo:"window",responsive:null,rows:1,rtl:!1,slide:"",slidesPerRow:1,slidesToShow:1,slidesToScroll:1,speed:500,swipe:!0,swipeToSlide:!1,touchMove:!0,touchThreshold:5,useCSS:!0,useTransform:!0,variableWidth:!1,vertical:!1,verticalSwiping:!1,waitForAnimate:!0,zIndex:1e3},n.initials={animating:!1,dragging:!1,autoPlayTimer:null,currentDirection:0,currentLeft:null,currentSlide:0,direction:1,$dots:null,listWidth:null,listHeight:null,loadIndex:0,$nextArrow:null,$prevArrow:null,scrolling:!1,slideCount:null,slideWidth:null,$slideTrack:null,$slides:null,sliding:!1,slideOffset:0,swipeLeft:null,swiping:!1,$list:null,touchObject:{},transformsEnabled:!1,unslicked:!1},i.extend(n,n.initials),n.activeBreakpoint=null,n.animType=null,n.animProp=null,n.breakpoints=[],n.breakpointSettings=[],n.cssTransitions=!1,n.focussed=!1,n.interrupted=!1,n.hidden="hidden",n.paused=!0,n.positionProp=null,n.respondTo=null,n.rowCount=1,n.shouldClick=!0,n.$slider=i(e),n.$slidesCache=null,n.transformType=null,n.transitionType=null,n.visibilityChange="visibilitychange",n.windowWidth=0,n.windowTimer=null,s=i(e).data("slick")||{},n.options=i.extend({},n.defaults,o,s),n.currentSlide=n.options.initialSlide,n.originalSettings=n.options,"undefined"!=typeof document.mozHidden?(n.hidden="mozHidden",n.visibilityChange="mozvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(n.hidden="webkitHidden",n.visibilityChange="webkitvisibilitychange"),n.autoPlay=i.proxy(n.autoPlay,n),n.autoPlayClear=i.proxy(n.autoPlayClear,n),n.autoPlayIterator=i.proxy(n.autoPlayIterator,n),n.changeSlide=i.proxy(n.changeSlide,n),n.clickHandler=i.proxy(n.clickHandler,n),n.selectHandler=i.proxy(n.selectHandler,n),n.setPosition=i.proxy(n.setPosition,n),n.swipeHandler=i.proxy(n.swipeHandler,n),n.dragHandler=i.proxy(n.dragHandler,n),n.keyHandler=i.proxy(n.keyHandler,n),n.instanceUid=t++,n.htmlExpr=/^(?:\s*(<[\w\W]+>)[^>]*)$/,n.registerBreakpoints(),n.init(!0)}var t=0;return e}(),e.prototype.activateADA=function(){var i=this;i.$slideTrack.find(".slick-active").attr({"aria-hidden":"false"}).find("a, input, button, select").attr({tabindex:"0"})},e.prototype.addSlide=e.prototype.slickAdd=function(e,t,o){var s=this;if("boolean"==typeof t)o=t,t=null;else if(t<0||t>=s.slideCount)return!1;s.unload(),"number"==typeof t?0===t&&0===s.$slides.length?i(e).appendTo(s.$slideTrack):o?i(e).insertBefore(s.$slides.eq(t)):i(e).insertAfter(s.$slides.eq(t)):o===!0?i(e).prependTo(s.$slideTrack):i(e).appendTo(s.$slideTrack),s.$slides=s.$slideTrack.children(this.options.slide),s.$slideTrack.children(this.options.slide).detach(),s.$slideTrack.append(s.$slides),s.$slides.each(function(e,t){i(t).attr("data-slick-index",e)}),s.$slidesCache=s.$slides,s.reinit()},e.prototype.animateHeight=function(){var i=this;if(1===i.options.slidesToShow&&i.options.adaptiveHeight===!0&&i.options.vertical===!1){var e=i.$slides.eq(i.currentSlide).outerHeight(!0);i.$list.animate({height:e},i.options.speed)}},e.prototype.animateSlide=function(e,t){var o={},s=this;s.animateHeight(),s.options.rtl===!0&&s.options.vertical===!1&&(e=-e),s.transformsEnabled===!1?s.options.vertical===!1?s.$slideTrack.animate({left:e},s.options.speed,s.options.easing,t):s.$slideTrack.animate({top:e},s.options.speed,s.options.easing,t):s.cssTransitions===!1?(s.options.rtl===!0&&(s.currentLeft=-s.currentLeft),i({animStart:s.currentLeft}).animate({animStart:e},{duration:s.options.speed,easing:s.options.easing,step:function(i){i=Math.ceil(i),s.options.vertical===!1?(o[s.animType]="translate("+i+"px, 0px)",s.$slideTrack.css(o)):(o[s.animType]="translate(0px,"+i+"px)",s.$slideTrack.css(o))},complete:function(){t&&t.call()}})):(s.applyTransition(),e=Math.ceil(e),s.options.vertical===!1?o[s.animType]="translate3d("+e+"px, 0px, 0px)":o[s.animType]="translate3d(0px,"+e+"px, 0px)",s.$slideTrack.css(o),t&&setTimeout(function(){s.disableTransition(),t.call()},s.options.speed))},e.prototype.getNavTarget=function(){var e=this,t=e.options.asNavFor;return t&&null!==t&&(t=i(t).not(e.$slider)),t},e.prototype.asNavFor=function(e){var t=this,o=t.getNavTarget();null!==o&&"object"==typeof o&&o.each(function(){var t=i(this).slick("getSlick");t.unslicked||t.slideHandler(e,!0)})},e.prototype.applyTransition=function(i){var e=this,t={};e.options.fade===!1?t[e.transitionType]=e.transformType+" "+e.options.speed+"ms "+e.options.cssEase:t[e.transitionType]="opacity "+e.options.speed+"ms "+e.options.cssEase,e.options.fade===!1?e.$slideTrack.css(t):e.$slides.eq(i).css(t)},e.prototype.autoPlay=function(){var i=this;i.autoPlayClear(),i.slideCount>i.options.slidesToShow&&(i.autoPlayTimer=setInterval(i.autoPlayIterator,i.options.autoplaySpeed))},e.prototype.autoPlayClear=function(){var i=this;i.autoPlayTimer&&clearInterval(i.autoPlayTimer)},e.prototype.autoPlayIterator=function(){var i=this,e=i.currentSlide+i.options.slidesToScroll;i.paused||i.interrupted||i.focussed||(i.options.infinite===!1&&(1===i.direction&&i.currentSlide+1===i.slideCount-1?i.direction=0:0===i.direction&&(e=i.currentSlide-i.options.slidesToScroll,i.currentSlide-1===0&&(i.direction=1))),i.slideHandler(e))},e.prototype.buildArrows=function(){var e=this;e.options.arrows===!0&&(e.$prevArrow=i(e.options.prevArrow).addClass("slick-arrow"),e.$nextArrow=i(e.options.nextArrow).addClass("slick-arrow"),e.slideCount>e.options.slidesToShow?(e.$prevArrow.removeClass("slick-hidden").removeAttr("aria-hidden tabindex"),e.$nextArrow.removeClass("slick-hidden").removeAttr("aria-hidden tabindex"),e.htmlExpr.test(e.options.prevArrow)&&e.$prevArrow.prependTo(e.options.appendArrows),e.htmlExpr.test(e.options.nextArrow)&&e.$nextArrow.appendTo(e.options.appendArrows),e.options.infinite!==!0&&e.$prevArrow.addClass("slick-disabled").attr("aria-disabled","true")):e.$prevArrow.add(e.$nextArrow).addClass("slick-hidden").attr({"aria-disabled":"true",tabindex:"-1"}))},e.prototype.buildDots=function(){var e,t,o=this;if(o.options.dots===!0&&o.slideCount>o.options.slidesToShow){for(o.$slider.addClass("slick-dotted"),t=i("<ul />").addClass(o.options.dotsClass),e=0;e<=o.getDotCount();e+=1)t.append(i("<li />").append(o.options.customPaging.call(this,o,e)));o.$dots=t.appendTo(o.options.appendDots),o.$dots.find("li").first().addClass("slick-active")}},e.prototype.buildOut=function(){var e=this;e.$slides=e.$slider.children(e.options.slide+":not(.slick-cloned)").addClass("slick-slide"),e.slideCount=e.$slides.length,e.$slides.each(function(e,t){i(t).attr("data-slick-index",e).data("originalStyling",i(t).attr("style")||"")}),e.$slider.addClass("slick-slider"),e.$slideTrack=0===e.slideCount?i('<div class="slick-track"/>').appendTo(e.$slider):e.$slides.wrapAll('<div class="slick-track"/>').parent(),e.$list=e.$slideTrack.wrap('<div class="slick-list"/>').parent(),e.$slideTrack.css("opacity",0),e.options.centerMode!==!0&&e.options.swipeToSlide!==!0||(e.options.slidesToScroll=1),i("img[data-lazy]",e.$slider).not("[src]").addClass("slick-loading"),e.setupInfinite(),e.buildArrows(),e.buildDots(),e.updateDots(),e.setSlideClasses("number"==typeof e.currentSlide?e.currentSlide:0),e.options.draggable===!0&&e.$list.addClass("draggable")},e.prototype.buildRows=function(){var i,e,t,o,s,n,r,l=this;if(o=document.createDocumentFragment(),n=l.$slider.children(),l.options.rows>0){for(r=l.options.slidesPerRow*l.options.rows,s=Math.ceil(n.length/r),i=0;i<s;i++){var d=document.createElement("div");for(e=0;e<l.options.rows;e++){var a=document.createElement("div");for(t=0;t<l.options.slidesPerRow;t++){var c=i*r+(e*l.options.slidesPerRow+t);n.get(c)&&a.appendChild(n.get(c))}d.appendChild(a)}o.appendChild(d)}l.$slider.empty().append(o),l.$slider.children().children().children().css({width:100/l.options.slidesPerRow+"%",display:"inline-block"})}},e.prototype.checkResponsive=function(e,t){var o,s,n,r=this,l=!1,d=r.$slider.width(),a=window.innerWidth||i(window).width();if("window"===r.respondTo?n=a:"slider"===r.respondTo?n=d:"min"===r.respondTo&&(n=Math.min(a,d)),r.options.responsive&&r.options.responsive.length&&null!==r.options.responsive){s=null;for(o in r.breakpoints)r.breakpoints.hasOwnProperty(o)&&(r.originalSettings.mobileFirst===!1?n<r.breakpoints[o]&&(s=r.breakpoints[o]):n>r.breakpoints[o]&&(s=r.breakpoints[o]));null!==s?null!==r.activeBreakpoint?(s!==r.activeBreakpoint||t)&&(r.activeBreakpoint=s,"unslick"===r.breakpointSettings[s]?r.unslick(s):(r.options=i.extend({},r.originalSettings,r.breakpointSettings[s]),e===!0&&(r.currentSlide=r.options.initialSlide),r.refresh(e)),l=s):(r.activeBreakpoint=s,"unslick"===r.breakpointSettings[s]?r.unslick(s):(r.options=i.extend({},r.originalSettings,r.breakpointSettings[s]),e===!0&&(r.currentSlide=r.options.initialSlide),r.refresh(e)),l=s):null!==r.activeBreakpoint&&(r.activeBreakpoint=null,r.options=r.originalSettings,e===!0&&(r.currentSlide=r.options.initialSlide),r.refresh(e),l=s),e||l===!1||r.$slider.trigger("breakpoint",[r,l])}},e.prototype.changeSlide=function(e,t){var o,s,n,r=this,l=i(e.currentTarget);switch(l.is("a")&&e.preventDefault(),l.is("li")||(l=l.closest("li")),n=r.slideCount%r.options.slidesToScroll!==0,o=n?0:(r.slideCount-r.currentSlide)%r.options.slidesToScroll,e.data.message){case"previous":s=0===o?r.options.slidesToScroll:r.options.slidesToShow-o,r.slideCount>r.options.slidesToShow&&r.slideHandler(r.currentSlide-s,!1,t);break;case"next":s=0===o?r.options.slidesToScroll:o,r.slideCount>r.options.slidesToShow&&r.slideHandler(r.currentSlide+s,!1,t);break;case"index":var d=0===e.data.index?0:e.data.index||l.index()*r.options.slidesToScroll;r.slideHandler(r.checkNavigable(d),!1,t),l.children().trigger("focus");break;default:return}},e.prototype.checkNavigable=function(i){var e,t,o=this;if(e=o.getNavigableIndexes(),t=0,i>e[e.length-1])i=e[e.length-1];else for(var s in e){if(i<e[s]){i=t;break}t=e[s]}return i},e.prototype.cleanUpEvents=function(){var e=this;e.options.dots&&null!==e.$dots&&(i("li",e.$dots).off("click.slick",e.changeSlide).off("mouseenter.slick",i.proxy(e.interrupt,e,!0)).off("mouseleave.slick",i.proxy(e.interrupt,e,!1)),e.options.accessibility===!0&&e.$dots.off("keydown.slick",e.keyHandler)),e.$slider.off("focus.slick blur.slick"),e.options.arrows===!0&&e.slideCount>e.options.slidesToShow&&(e.$prevArrow&&e.$prevArrow.off("click.slick",e.changeSlide),e.$nextArrow&&e.$nextArrow.off("click.slick",e.changeSlide),e.options.accessibility===!0&&(e.$prevArrow&&e.$prevArrow.off("keydown.slick",e.keyHandler),e.$nextArrow&&e.$nextArrow.off("keydown.slick",e.keyHandler))),e.$list.off("touchstart.slick mousedown.slick",e.swipeHandler),e.$list.off("touchmove.slick mousemove.slick",e.swipeHandler),e.$list.off("touchend.slick mouseup.slick",e.swipeHandler),e.$list.off("touchcancel.slick mouseleave.slick",e.swipeHandler),e.$list.off("click.slick",e.clickHandler),i(document).off(e.visibilityChange,e.visibility),e.cleanUpSlideEvents(),e.options.accessibility===!0&&e.$list.off("keydown.slick",e.keyHandler),e.options.focusOnSelect===!0&&i(e.$slideTrack).children().off("click.slick",e.selectHandler),i(window).off("orientationchange.slick.slick-"+e.instanceUid,e.orientationChange),i(window).off("resize.slick.slick-"+e.instanceUid,e.resize),i("[draggable!=true]",e.$slideTrack).off("dragstart",e.preventDefault),i(window).off("load.slick.slick-"+e.instanceUid,e.setPosition)},e.prototype.cleanUpSlideEvents=function(){var e=this;e.$list.off("mouseenter.slick",i.proxy(e.interrupt,e,!0)),e.$list.off("mouseleave.slick",i.proxy(e.interrupt,e,!1))},e.prototype.cleanUpRows=function(){var i,e=this;e.options.rows>0&&(i=e.$slides.children().children(),i.removeAttr("style"),e.$slider.empty().append(i))},e.prototype.clickHandler=function(i){var e=this;e.shouldClick===!1&&(i.stopImmediatePropagation(),i.stopPropagation(),i.preventDefault())},e.prototype.destroy=function(e){var t=this;t.autoPlayClear(),t.touchObject={},t.cleanUpEvents(),i(".slick-cloned",t.$slider).detach(),t.$dots&&t.$dots.remove(),t.$prevArrow&&t.$prevArrow.length&&(t.$prevArrow.removeClass("slick-disabled slick-arrow slick-hidden").removeAttr("aria-hidden aria-disabled tabindex").css("display",""),t.htmlExpr.test(t.options.prevArrow)&&t.$prevArrow.remove()),t.$nextArrow&&t.$nextArrow.length&&(t.$nextArrow.removeClass("slick-disabled slick-arrow slick-hidden").removeAttr("aria-hidden aria-disabled tabindex").css("display",""),t.htmlExpr.test(t.options.nextArrow)&&t.$nextArrow.remove()),t.$slides&&(t.$slides.removeClass("slick-slide slick-active slick-center slick-visible slick-current").removeAttr("aria-hidden").removeAttr("data-slick-index").each(function(){i(this).attr("style",i(this).data("originalStyling"))}),t.$slideTrack.children(this.options.slide).detach(),t.$slideTrack.detach(),t.$list.detach(),t.$slider.append(t.$slides)),t.cleanUpRows(),t.$slider.removeClass("slick-slider"),t.$slider.removeClass("slick-initialized"),t.$slider.removeClass("slick-dotted"),t.unslicked=!0,e||t.$slider.trigger("destroy",[t])},e.prototype.disableTransition=function(i){var e=this,t={};t[e.transitionType]="",e.options.fade===!1?e.$slideTrack.css(t):e.$slides.eq(i).css(t)},e.prototype.fadeSlide=function(i,e){var t=this;t.cssTransitions===!1?(t.$slides.eq(i).css({zIndex:t.options.zIndex}),t.$slides.eq(i).animate({opacity:1},t.options.speed,t.options.easing,e)):(t.applyTransition(i),t.$slides.eq(i).css({opacity:1,zIndex:t.options.zIndex}),e&&setTimeout(function(){t.disableTransition(i),e.call()},t.options.speed))},e.prototype.fadeSlideOut=function(i){var e=this;e.cssTransitions===!1?e.$slides.eq(i).animate({opacity:0,zIndex:e.options.zIndex-2},e.options.speed,e.options.easing):(e.applyTransition(i),e.$slides.eq(i).css({opacity:0,zIndex:e.options.zIndex-2}))},e.prototype.filterSlides=e.prototype.slickFilter=function(i){var e=this;null!==i&&(e.$slidesCache=e.$slides,e.unload(),e.$slideTrack.children(this.options.slide).detach(),e.$slidesCache.filter(i).appendTo(e.$slideTrack),e.reinit())},e.prototype.focusHandler=function(){var e=this;e.$slider.off("focus.slick blur.slick").on("focus.slick","*",function(t){var o=i(this);setTimeout(function(){e.options.pauseOnFocus&&o.is(":focus")&&(e.focussed=!0,e.autoPlay())},0)}).on("blur.slick","*",function(t){i(this);e.options.pauseOnFocus&&(e.focussed=!1,e.autoPlay())})},e.prototype.getCurrent=e.prototype.slickCurrentSlide=function(){var i=this;return i.currentSlide},e.prototype.getDotCount=function(){var i=this,e=0,t=0,o=0;if(i.options.infinite===!0)if(i.slideCount<=i.options.slidesToShow)++o;else for(;e<i.slideCount;)++o,e=t+i.options.slidesToScroll,t+=i.options.slidesToScroll<=i.options.slidesToShow?i.options.slidesToScroll:i.options.slidesToShow;else if(i.options.centerMode===!0)o=i.slideCount;else if(i.options.asNavFor)for(;e<i.slideCount;)++o,e=t+i.options.slidesToScroll,t+=i.options.slidesToScroll<=i.options.slidesToShow?i.options.slidesToScroll:i.options.slidesToShow;else o=1+Math.ceil((i.slideCount-i.options.slidesToShow)/i.options.slidesToScroll);return o-1},e.prototype.getLeft=function(i){var e,t,o,s,n=this,r=0;return n.slideOffset=0,t=n.$slides.first().outerHeight(!0),n.options.infinite===!0?(n.slideCount>n.options.slidesToShow&&(n.slideOffset=n.slideWidth*n.options.slidesToShow*-1,s=-1,n.options.vertical===!0&&n.options.centerMode===!0&&(2===n.options.slidesToShow?s=-1.5:1===n.options.slidesToShow&&(s=-2)),r=t*n.options.slidesToShow*s),n.slideCount%n.options.slidesToScroll!==0&&i+n.options.slidesToScroll>n.slideCount&&n.slideCount>n.options.slidesToShow&&(i>n.slideCount?(n.slideOffset=(n.options.slidesToShow-(i-n.slideCount))*n.slideWidth*-1,r=(n.options.slidesToShow-(i-n.slideCount))*t*-1):(n.slideOffset=n.slideCount%n.options.slidesToScroll*n.slideWidth*-1,r=n.slideCount%n.options.slidesToScroll*t*-1))):i+n.options.slidesToShow>n.slideCount&&(n.slideOffset=(i+n.options.slidesToShow-n.slideCount)*n.slideWidth,r=(i+n.options.slidesToShow-n.slideCount)*t),n.slideCount<=n.options.slidesToShow&&(n.slideOffset=0,r=0),n.options.centerMode===!0&&n.slideCount<=n.options.slidesToShow?n.slideOffset=n.slideWidth*Math.floor(n.options.slidesToShow)/2-n.slideWidth*n.slideCount/2:n.options.centerMode===!0&&n.options.infinite===!0?n.slideOffset+=n.slideWidth*Math.floor(n.options.slidesToShow/2)-n.slideWidth:n.options.centerMode===!0&&(n.slideOffset=0,n.slideOffset+=n.slideWidth*Math.floor(n.options.slidesToShow/2)),e=n.options.vertical===!1?i*n.slideWidth*-1+n.slideOffset:i*t*-1+r,n.options.variableWidth===!0&&(o=n.slideCount<=n.options.slidesToShow||n.options.infinite===!1?n.$slideTrack.children(".slick-slide").eq(i):n.$slideTrack.children(".slick-slide").eq(i+n.options.slidesToShow),e=n.options.rtl===!0?o[0]?(n.$slideTrack.width()-o[0].offsetLeft-o.width())*-1:0:o[0]?o[0].offsetLeft*-1:0,n.options.centerMode===!0&&(o=n.slideCount<=n.options.slidesToShow||n.options.infinite===!1?n.$slideTrack.children(".slick-slide").eq(i):n.$slideTrack.children(".slick-slide").eq(i+n.options.slidesToShow+1),e=n.options.rtl===!0?o[0]?(n.$slideTrack.width()-o[0].offsetLeft-o.width())*-1:0:o[0]?o[0].offsetLeft*-1:0,e+=(n.$list.width()-o.outerWidth())/2)),e},e.prototype.getOption=e.prototype.slickGetOption=function(i){var e=this;return e.options[i]},e.prototype.getNavigableIndexes=function(){var i,e=this,t=0,o=0,s=[];for(e.options.infinite===!1?i=e.slideCount:(t=e.options.slidesToScroll*-1,o=e.options.slidesToScroll*-1,i=2*e.slideCount);t<i;)s.push(t),t=o+e.options.slidesToScroll,o+=e.options.slidesToScroll<=e.options.slidesToShow?e.options.slidesToScroll:e.options.slidesToShow;return s},e.prototype.getSlick=function(){return this},e.prototype.getSlideCount=function(){var e,t,o,s,n=this;return s=n.options.centerMode===!0?Math.floor(n.$list.width()/2):0,o=n.swipeLeft*-1+s,n.options.swipeToSlide===!0?(n.$slideTrack.find(".slick-slide").each(function(e,s){var r,l,d;if(r=i(s).outerWidth(),l=s.offsetLeft,n.options.centerMode!==!0&&(l+=r/2),d=l+r,o<d)return t=s,!1}),e=Math.abs(i(t).attr("data-slick-index")-n.currentSlide)||1):n.options.slidesToScroll},e.prototype.goTo=e.prototype.slickGoTo=function(i,e){var t=this;t.changeSlide({data:{message:"index",index:parseInt(i)}},e)},e.prototype.init=function(e){var t=this;i(t.$slider).hasClass("slick-initialized")||(i(t.$slider).addClass("slick-initialized"),t.buildRows(),t.buildOut(),t.setProps(),t.startLoad(),t.loadSlider(),t.initializeEvents(),t.updateArrows(),t.updateDots(),t.checkResponsive(!0),t.focusHandler()),e&&t.$slider.trigger("init",[t]),t.options.accessibility===!0&&t.initADA(),t.options.autoplay&&(t.paused=!1,t.autoPlay())},e.prototype.initADA=function(){var e=this,t=Math.ceil(e.slideCount/e.options.slidesToShow),o=e.getNavigableIndexes().filter(function(i){return i>=0&&i<e.slideCount});e.$slides.add(e.$slideTrack.find(".slick-cloned")).attr({"aria-hidden":"true",tabindex:"-1"}).find("a, input, button, select").attr({tabindex:"-1"}),null!==e.$dots&&(e.$slides.not(e.$slideTrack.find(".slick-cloned")).each(function(t){var s=o.indexOf(t);if(i(this).attr({role:"tabpanel",id:"slick-slide"+e.instanceUid+t,tabindex:-1}),s!==-1){var n="slick-slide-control"+e.instanceUid+s;i("#"+n).length&&i(this).attr({"aria-describedby":n})}}),e.$dots.attr("role","tablist").find("li").each(function(s){var n=o[s];i(this).attr({role:"presentation"}),i(this).find("button").first().attr({role:"tab",id:"slick-slide-control"+e.instanceUid+s,"aria-controls":"slick-slide"+e.instanceUid+n,"aria-label":s+1+" of "+t,"aria-selected":null,tabindex:"-1"})}).eq(e.currentSlide).find("button").attr({"aria-selected":"true",tabindex:"0"}).end());for(var s=e.currentSlide,n=s+e.options.slidesToShow;s<n;s++)e.options.focusOnChange?e.$slides.eq(s).attr({tabindex:"0"}):e.$slides.eq(s).removeAttr("tabindex");e.activateADA()},e.prototype.initArrowEvents=function(){var i=this;i.options.arrows===!0&&i.slideCount>i.options.slidesToShow&&(i.$prevArrow.off("click.slick").on("click.slick",{message:"previous"},i.changeSlide),i.$nextArrow.off("click.slick").on("click.slick",{message:"next"},i.changeSlide),i.options.accessibility===!0&&(i.$prevArrow.on("keydown.slick",i.keyHandler),i.$nextArrow.on("keydown.slick",i.keyHandler)))},e.prototype.initDotEvents=function(){var e=this;e.options.dots===!0&&e.slideCount>e.options.slidesToShow&&(i("li",e.$dots).on("click.slick",{message:"index"},e.changeSlide),e.options.accessibility===!0&&e.$dots.on("keydown.slick",e.keyHandler)),e.options.dots===!0&&e.options.pauseOnDotsHover===!0&&e.slideCount>e.options.slidesToShow&&i("li",e.$dots).on("mouseenter.slick",i.proxy(e.interrupt,e,!0)).on("mouseleave.slick",i.proxy(e.interrupt,e,!1))},e.prototype.initSlideEvents=function(){var e=this;e.options.pauseOnHover&&(e.$list.on("mouseenter.slick",i.proxy(e.interrupt,e,!0)),e.$list.on("mouseleave.slick",i.proxy(e.interrupt,e,!1)))},e.prototype.initializeEvents=function(){var e=this;e.initArrowEvents(),e.initDotEvents(),e.initSlideEvents(),e.$list.on("touchstart.slick mousedown.slick",{action:"start"},e.swipeHandler),e.$list.on("touchmove.slick mousemove.slick",{action:"move"},e.swipeHandler),e.$list.on("touchend.slick mouseup.slick",{action:"end"},e.swipeHandler),e.$list.on("touchcancel.slick mouseleave.slick",{action:"end"},e.swipeHandler),e.$list.on("click.slick",e.clickHandler),i(document).on(e.visibilityChange,i.proxy(e.visibility,e)),e.options.accessibility===!0&&e.$list.on("keydown.slick",e.keyHandler),e.options.focusOnSelect===!0&&i(e.$slideTrack).children().on("click.slick",e.selectHandler),i(window).on("orientationchange.slick.slick-"+e.instanceUid,i.proxy(e.orientationChange,e)),i(window).on("resize.slick.slick-"+e.instanceUid,i.proxy(e.resize,e)),i("[draggable!=true]",e.$slideTrack).on("dragstart",e.preventDefault),i(window).on("load.slick.slick-"+e.instanceUid,e.setPosition),i(e.setPosition)},e.prototype.initUI=function(){var i=this;i.options.arrows===!0&&i.slideCount>i.options.slidesToShow&&(i.$prevArrow.show(),i.$nextArrow.show()),i.options.dots===!0&&i.slideCount>i.options.slidesToShow&&i.$dots.show()},e.prototype.keyHandler=function(i){var e=this;i.target.tagName.match("TEXTAREA|INPUT|SELECT")||(37===i.keyCode&&e.options.accessibility===!0?e.changeSlide({data:{message:e.options.rtl===!0?"next":"previous"}}):39===i.keyCode&&e.options.accessibility===!0&&e.changeSlide({data:{message:e.options.rtl===!0?"previous":"next"}}))},e.prototype.lazyLoad=function(){function e(e){i("img[data-lazy]",e).each(function(){var e=i(this),t=i(this).attr("data-lazy"),o=i(this).attr("data-srcset"),s=i(this).attr("data-sizes")||r.$slider.attr("data-sizes"),n=document.createElement("img");n.onload=function(){e.animate({opacity:0},100,function(){o&&(e.attr("srcset",o),s&&e.attr("sizes",s)),e.attr("src",t).animate({opacity:1},200,function(){e.removeAttr("data-lazy data-srcset data-sizes").removeClass("slick-loading")}),r.$slider.trigger("lazyLoaded",[r,e,t])})},n.onerror=function(){e.removeAttr("data-lazy").removeClass("slick-loading").addClass("slick-lazyload-error"),r.$slider.trigger("lazyLoadError",[r,e,t])},n.src=t})}var t,o,s,n,r=this;if(r.options.centerMode===!0?r.options.infinite===!0?(s=r.currentSlide+(r.options.slidesToShow/2+1),n=s+r.options.slidesToShow+2):(s=Math.max(0,r.currentSlide-(r.options.slidesToShow/2+1)),n=2+(r.options.slidesToShow/2+1)+r.currentSlide):(s=r.options.infinite?r.options.slidesToShow+r.currentSlide:r.currentSlide,n=Math.ceil(s+r.options.slidesToShow),r.options.fade===!0&&(s>0&&s--,n<=r.slideCount&&n++)),t=r.$slider.find(".slick-slide").slice(s,n),"anticipated"===r.options.lazyLoad)for(var l=s-1,d=n,a=r.$slider.find(".slick-slide"),c=0;c<r.options.slidesToScroll;c++)l<0&&(l=r.slideCount-1),t=t.add(a.eq(l)),t=t.add(a.eq(d)),l--,d++;e(t),r.slideCount<=r.options.slidesToShow?(o=r.$slider.find(".slick-slide"),e(o)):r.currentSlide>=r.slideCount-r.options.slidesToShow?(o=r.$slider.find(".slick-cloned").slice(0,r.options.slidesToShow),e(o)):0===r.currentSlide&&(o=r.$slider.find(".slick-cloned").slice(r.options.slidesToShow*-1),e(o))},e.prototype.loadSlider=function(){var i=this;i.setPosition(),i.$slideTrack.css({opacity:1}),i.$slider.removeClass("slick-loading"),i.initUI(),"progressive"===i.options.lazyLoad&&i.progressiveLazyLoad()},e.prototype.next=e.prototype.slickNext=function(){var i=this;i.changeSlide({data:{message:"next"}})},e.prototype.orientationChange=function(){var i=this;i.checkResponsive(),i.setPosition()},e.prototype.pause=e.prototype.slickPause=function(){var i=this;i.autoPlayClear(),i.paused=!0},e.prototype.play=e.prototype.slickPlay=function(){var i=this;i.autoPlay(),i.options.autoplay=!0,i.paused=!1,i.focussed=!1,i.interrupted=!1},e.prototype.postSlide=function(e){var t=this;if(!t.unslicked&&(t.$slider.trigger("afterChange",[t,e]),t.animating=!1,t.slideCount>t.options.slidesToShow&&t.setPosition(),t.swipeLeft=null,t.options.autoplay&&t.autoPlay(),t.options.accessibility===!0&&(t.initADA(),t.options.focusOnChange))){var o=i(t.$slides.get(t.currentSlide));o.attr("tabindex",0).focus()}},e.prototype.prev=e.prototype.slickPrev=function(){var i=this;i.changeSlide({data:{message:"previous"}})},e.prototype.preventDefault=function(i){i.preventDefault()},e.prototype.progressiveLazyLoad=function(e){e=e||1;var t,o,s,n,r,l=this,d=i("img[data-lazy]",l.$slider);d.length?(t=d.first(),o=t.attr("data-lazy"),s=t.attr("data-srcset"),n=t.attr("data-sizes")||l.$slider.attr("data-sizes"),r=document.createElement("img"),r.onload=function(){s&&(t.attr("srcset",s),n&&t.attr("sizes",n)),t.attr("src",o).removeAttr("data-lazy data-srcset data-sizes").removeClass("slick-loading"),l.options.adaptiveHeight===!0&&l.setPosition(),l.$slider.trigger("lazyLoaded",[l,t,o]),l.progressiveLazyLoad()},r.onerror=function(){e<3?setTimeout(function(){l.progressiveLazyLoad(e+1)},500):(t.removeAttr("data-lazy").removeClass("slick-loading").addClass("slick-lazyload-error"),l.$slider.trigger("lazyLoadError",[l,t,o]),l.progressiveLazyLoad())},r.src=o):l.$slider.trigger("allImagesLoaded",[l])},e.prototype.refresh=function(e){var t,o,s=this;o=s.slideCount-s.options.slidesToShow,!s.options.infinite&&s.currentSlide>o&&(s.currentSlide=o),s.slideCount<=s.options.slidesToShow&&(s.currentSlide=0),t=s.currentSlide,s.destroy(!0),i.extend(s,s.initials,{currentSlide:t}),s.init(),e||s.changeSlide({data:{message:"index",index:t}},!1)},e.prototype.registerBreakpoints=function(){var e,t,o,s=this,n=s.options.responsive||null;if("array"===i.type(n)&&n.length){s.respondTo=s.options.respondTo||"window";for(e in n)if(o=s.breakpoints.length-1,n.hasOwnProperty(e)){for(t=n[e].breakpoint;o>=0;)s.breakpoints[o]&&s.breakpoints[o]===t&&s.breakpoints.splice(o,1),o--;s.breakpoints.push(t),s.breakpointSettings[t]=n[e].settings}s.breakpoints.sort(function(i,e){return s.options.mobileFirst?i-e:e-i})}},e.prototype.reinit=function(){var e=this;e.$slides=e.$slideTrack.children(e.options.slide).addClass("slick-slide"),e.slideCount=e.$slides.length,e.currentSlide>=e.slideCount&&0!==e.currentSlide&&(e.currentSlide=e.currentSlide-e.options.slidesToScroll),e.slideCount<=e.options.slidesToShow&&(e.currentSlide=0),e.registerBreakpoints(),e.setProps(),e.setupInfinite(),e.buildArrows(),e.updateArrows(),e.initArrowEvents(),e.buildDots(),e.updateDots(),e.initDotEvents(),e.cleanUpSlideEvents(),e.initSlideEvents(),e.checkResponsive(!1,!0),e.options.focusOnSelect===!0&&i(e.$slideTrack).children().on("click.slick",e.selectHandler),e.setSlideClasses("number"==typeof e.currentSlide?e.currentSlide:0),e.setPosition(),e.focusHandler(),e.paused=!e.options.autoplay,e.autoPlay(),e.$slider.trigger("reInit",[e])},e.prototype.resize=function(){var e=this;i(window).width()!==e.windowWidth&&(clearTimeout(e.windowDelay),e.windowDelay=window.setTimeout(function(){e.windowWidth=i(window).width(),e.checkResponsive(),e.unslicked||e.setPosition()},50))},e.prototype.removeSlide=e.prototype.slickRemove=function(i,e,t){var o=this;return"boolean"==typeof i?(e=i,i=e===!0?0:o.slideCount-1):i=e===!0?--i:i,!(o.slideCount<1||i<0||i>o.slideCount-1)&&(o.unload(),t===!0?o.$slideTrack.children().remove():o.$slideTrack.children(this.options.slide).eq(i).remove(),o.$slides=o.$slideTrack.children(this.options.slide),o.$slideTrack.children(this.options.slide).detach(),o.$slideTrack.append(o.$slides),o.$slidesCache=o.$slides,void o.reinit())},e.prototype.setCSS=function(i){var e,t,o=this,s={};o.options.rtl===!0&&(i=-i),e="left"==o.positionProp?Math.ceil(i)+"px":"0px",t="top"==o.positionProp?Math.ceil(i)+"px":"0px",s[o.positionProp]=i,o.transformsEnabled===!1?o.$slideTrack.css(s):(s={},o.cssTransitions===!1?(s[o.animType]="translate("+e+", "+t+")",o.$slideTrack.css(s)):(s[o.animType]="translate3d("+e+", "+t+", 0px)",o.$slideTrack.css(s)))},e.prototype.setDimensions=function(){var i=this;i.options.vertical===!1?i.options.centerMode===!0&&i.$list.css({padding:"0px "+i.options.centerPadding}):(i.$list.height(i.$slides.first().outerHeight(!0)*i.options.slidesToShow),i.options.centerMode===!0&&i.$list.css({padding:i.options.centerPadding+" 0px"})),i.listWidth=i.$list.width(),i.listHeight=i.$list.height(),i.options.vertical===!1&&i.options.variableWidth===!1?(i.slideWidth=Math.ceil(i.listWidth/i.options.slidesToShow),i.$slideTrack.width(Math.ceil(i.slideWidth*i.$slideTrack.children(".slick-slide").length))):i.options.variableWidth===!0?i.$slideTrack.width(5e3*i.slideCount):(i.slideWidth=Math.ceil(i.listWidth),i.$slideTrack.height(Math.ceil(i.$slides.first().outerHeight(!0)*i.$slideTrack.children(".slick-slide").length)));var e=i.$slides.first().outerWidth(!0)-i.$slides.first().width();i.options.variableWidth===!1&&i.$slideTrack.children(".slick-slide").width(i.slideWidth-e)},e.prototype.setFade=function(){var e,t=this;t.$slides.each(function(o,s){e=t.slideWidth*o*-1,t.options.rtl===!0?i(s).css({position:"relative",right:e,top:0,zIndex:t.options.zIndex-2,opacity:0}):i(s).css({position:"relative",left:e,top:0,zIndex:t.options.zIndex-2,opacity:0})}),t.$slides.eq(t.currentSlide).css({zIndex:t.options.zIndex-1,opacity:1})},e.prototype.setHeight=function(){var i=this;if(1===i.options.slidesToShow&&i.options.adaptiveHeight===!0&&i.options.vertical===!1){var e=i.$slides.eq(i.currentSlide).outerHeight(!0);i.$list.css("height",e)}},e.prototype.setOption=e.prototype.slickSetOption=function(){var e,t,o,s,n,r=this,l=!1;if("object"===i.type(arguments[0])?(o=arguments[0],l=arguments[1],n="multiple"):"string"===i.type(arguments[0])&&(o=arguments[0],s=arguments[1],l=arguments[2],"responsive"===arguments[0]&&"array"===i.type(arguments[1])?n="responsive":"undefined"!=typeof arguments[1]&&(n="single")),"single"===n)r.options[o]=s;else if("multiple"===n)i.each(o,function(i,e){r.options[i]=e});else if("responsive"===n)for(t in s)if("array"!==i.type(r.options.responsive))r.options.responsive=[s[t]];else{for(e=r.options.responsive.length-1;e>=0;)r.options.responsive[e].breakpoint===s[t].breakpoint&&r.options.responsive.splice(e,1),e--;r.options.responsive.push(s[t])}l&&(r.unload(),r.reinit())},e.prototype.setPosition=function(){var i=this;i.setDimensions(),i.setHeight(),i.options.fade===!1?i.setCSS(i.getLeft(i.currentSlide)):i.setFade(),i.$slider.trigger("setPosition",[i])},e.prototype.setProps=function(){var i=this,e=document.body.style;i.positionProp=i.options.vertical===!0?"top":"left",
"top"===i.positionProp?i.$slider.addClass("slick-vertical"):i.$slider.removeClass("slick-vertical"),void 0===e.WebkitTransition&&void 0===e.MozTransition&&void 0===e.msTransition||i.options.useCSS===!0&&(i.cssTransitions=!0),i.options.fade&&("number"==typeof i.options.zIndex?i.options.zIndex<3&&(i.options.zIndex=3):i.options.zIndex=i.defaults.zIndex),void 0!==e.OTransform&&(i.animType="OTransform",i.transformType="-o-transform",i.transitionType="OTransition",void 0===e.perspectiveProperty&&void 0===e.webkitPerspective&&(i.animType=!1)),void 0!==e.MozTransform&&(i.animType="MozTransform",i.transformType="-moz-transform",i.transitionType="MozTransition",void 0===e.perspectiveProperty&&void 0===e.MozPerspective&&(i.animType=!1)),void 0!==e.webkitTransform&&(i.animType="webkitTransform",i.transformType="-webkit-transform",i.transitionType="webkitTransition",void 0===e.perspectiveProperty&&void 0===e.webkitPerspective&&(i.animType=!1)),void 0!==e.msTransform&&(i.animType="msTransform",i.transformType="-ms-transform",i.transitionType="msTransition",void 0===e.msTransform&&(i.animType=!1)),void 0!==e.transform&&i.animType!==!1&&(i.animType="transform",i.transformType="transform",i.transitionType="transition"),i.transformsEnabled=i.options.useTransform&&null!==i.animType&&i.animType!==!1},e.prototype.setSlideClasses=function(i){var e,t,o,s,n=this;if(t=n.$slider.find(".slick-slide").removeClass("slick-active slick-center slick-current").attr("aria-hidden","true"),n.$slides.eq(i).addClass("slick-current"),n.options.centerMode===!0){var r=n.options.slidesToShow%2===0?1:0;e=Math.floor(n.options.slidesToShow/2),n.options.infinite===!0&&(i>=e&&i<=n.slideCount-1-e?n.$slides.slice(i-e+r,i+e+1).addClass("slick-active").attr("aria-hidden","false"):(o=n.options.slidesToShow+i,t.slice(o-e+1+r,o+e+2).addClass("slick-active").attr("aria-hidden","false")),0===i?t.eq(t.length-1-n.options.slidesToShow).addClass("slick-center"):i===n.slideCount-1&&t.eq(n.options.slidesToShow).addClass("slick-center")),n.$slides.eq(i).addClass("slick-center")}else i>=0&&i<=n.slideCount-n.options.slidesToShow?n.$slides.slice(i,i+n.options.slidesToShow).addClass("slick-active").attr("aria-hidden","false"):t.length<=n.options.slidesToShow?t.addClass("slick-active").attr("aria-hidden","false"):(s=n.slideCount%n.options.slidesToShow,o=n.options.infinite===!0?n.options.slidesToShow+i:i,n.options.slidesToShow==n.options.slidesToScroll&&n.slideCount-i<n.options.slidesToShow?t.slice(o-(n.options.slidesToShow-s),o+s).addClass("slick-active").attr("aria-hidden","false"):t.slice(o,o+n.options.slidesToShow).addClass("slick-active").attr("aria-hidden","false"));"ondemand"!==n.options.lazyLoad&&"anticipated"!==n.options.lazyLoad||n.lazyLoad()},e.prototype.setupInfinite=function(){var e,t,o,s=this;if(s.options.fade===!0&&(s.options.centerMode=!1),s.options.infinite===!0&&s.options.fade===!1&&(t=null,s.slideCount>s.options.slidesToShow)){for(o=s.options.centerMode===!0?s.options.slidesToShow+1:s.options.slidesToShow,e=s.slideCount;e>s.slideCount-o;e-=1)t=e-1,i(s.$slides[t]).clone(!0).attr("id","").attr("data-slick-index",t-s.slideCount).prependTo(s.$slideTrack).addClass("slick-cloned");for(e=0;e<o+s.slideCount;e+=1)t=e,i(s.$slides[t]).clone(!0).attr("id","").attr("data-slick-index",t+s.slideCount).appendTo(s.$slideTrack).addClass("slick-cloned");s.$slideTrack.find(".slick-cloned").find("[id]").each(function(){i(this).attr("id","")})}},e.prototype.interrupt=function(i){var e=this;i||e.autoPlay(),e.interrupted=i},e.prototype.selectHandler=function(e){var t=this,o=i(e.target).is(".slick-slide")?i(e.target):i(e.target).parents(".slick-slide"),s=parseInt(o.attr("data-slick-index"));return s||(s=0),t.slideCount<=t.options.slidesToShow?void t.slideHandler(s,!1,!0):void t.slideHandler(s)},e.prototype.slideHandler=function(i,e,t){var o,s,n,r,l,d=null,a=this;if(e=e||!1,!(a.animating===!0&&a.options.waitForAnimate===!0||a.options.fade===!0&&a.currentSlide===i))return e===!1&&a.asNavFor(i),o=i,d=a.getLeft(o),r=a.getLeft(a.currentSlide),a.currentLeft=null===a.swipeLeft?r:a.swipeLeft,a.options.infinite===!1&&a.options.centerMode===!1&&(i<0||i>a.getDotCount()*a.options.slidesToScroll)?void(a.options.fade===!1&&(o=a.currentSlide,t!==!0&&a.slideCount>a.options.slidesToShow?a.animateSlide(r,function(){a.postSlide(o)}):a.postSlide(o))):a.options.infinite===!1&&a.options.centerMode===!0&&(i<0||i>a.slideCount-a.options.slidesToScroll)?void(a.options.fade===!1&&(o=a.currentSlide,t!==!0&&a.slideCount>a.options.slidesToShow?a.animateSlide(r,function(){a.postSlide(o)}):a.postSlide(o))):(a.options.autoplay&&clearInterval(a.autoPlayTimer),s=o<0?a.slideCount%a.options.slidesToScroll!==0?a.slideCount-a.slideCount%a.options.slidesToScroll:a.slideCount+o:o>=a.slideCount?a.slideCount%a.options.slidesToScroll!==0?0:o-a.slideCount:o,a.animating=!0,a.$slider.trigger("beforeChange",[a,a.currentSlide,s]),n=a.currentSlide,a.currentSlide=s,a.setSlideClasses(a.currentSlide),a.options.asNavFor&&(l=a.getNavTarget(),l=l.slick("getSlick"),l.slideCount<=l.options.slidesToShow&&l.setSlideClasses(a.currentSlide)),a.updateDots(),a.updateArrows(),a.options.fade===!0?(t!==!0?(a.fadeSlideOut(n),a.fadeSlide(s,function(){a.postSlide(s)})):a.postSlide(s),void a.animateHeight()):void(t!==!0&&a.slideCount>a.options.slidesToShow?a.animateSlide(d,function(){a.postSlide(s)}):a.postSlide(s)))},e.prototype.startLoad=function(){var i=this;i.options.arrows===!0&&i.slideCount>i.options.slidesToShow&&(i.$prevArrow.hide(),i.$nextArrow.hide()),i.options.dots===!0&&i.slideCount>i.options.slidesToShow&&i.$dots.hide(),i.$slider.addClass("slick-loading")},e.prototype.swipeDirection=function(){var i,e,t,o,s=this;return i=s.touchObject.startX-s.touchObject.curX,e=s.touchObject.startY-s.touchObject.curY,t=Math.atan2(e,i),o=Math.round(180*t/Math.PI),o<0&&(o=360-Math.abs(o)),o<=45&&o>=0?s.options.rtl===!1?"left":"right":o<=360&&o>=315?s.options.rtl===!1?"left":"right":o>=135&&o<=225?s.options.rtl===!1?"right":"left":s.options.verticalSwiping===!0?o>=35&&o<=135?"down":"up":"vertical"},e.prototype.swipeEnd=function(i){var e,t,o=this;if(o.dragging=!1,o.swiping=!1,o.scrolling)return o.scrolling=!1,!1;if(o.interrupted=!1,o.shouldClick=!(o.touchObject.swipeLength>10),void 0===o.touchObject.curX)return!1;if(o.touchObject.edgeHit===!0&&o.$slider.trigger("edge",[o,o.swipeDirection()]),o.touchObject.swipeLength>=o.touchObject.minSwipe){switch(t=o.swipeDirection()){case"left":case"down":e=o.options.swipeToSlide?o.checkNavigable(o.currentSlide+o.getSlideCount()):o.currentSlide+o.getSlideCount(),o.currentDirection=0;break;case"right":case"up":e=o.options.swipeToSlide?o.checkNavigable(o.currentSlide-o.getSlideCount()):o.currentSlide-o.getSlideCount(),o.currentDirection=1}"vertical"!=t&&(o.slideHandler(e),o.touchObject={},o.$slider.trigger("swipe",[o,t]))}else o.touchObject.startX!==o.touchObject.curX&&(o.slideHandler(o.currentSlide),o.touchObject={})},e.prototype.swipeHandler=function(i){var e=this;if(!(e.options.swipe===!1||"ontouchend"in document&&e.options.swipe===!1||e.options.draggable===!1&&i.type.indexOf("mouse")!==-1))switch(e.touchObject.fingerCount=i.originalEvent&&void 0!==i.originalEvent.touches?i.originalEvent.touches.length:1,e.touchObject.minSwipe=e.listWidth/e.options.touchThreshold,e.options.verticalSwiping===!0&&(e.touchObject.minSwipe=e.listHeight/e.options.touchThreshold),i.data.action){case"start":e.swipeStart(i);break;case"move":e.swipeMove(i);break;case"end":e.swipeEnd(i)}},e.prototype.swipeMove=function(i){var e,t,o,s,n,r,l=this;return n=void 0!==i.originalEvent?i.originalEvent.touches:null,!(!l.dragging||l.scrolling||n&&1!==n.length)&&(e=l.getLeft(l.currentSlide),l.touchObject.curX=void 0!==n?n[0].pageX:i.clientX,l.touchObject.curY=void 0!==n?n[0].pageY:i.clientY,l.touchObject.swipeLength=Math.round(Math.sqrt(Math.pow(l.touchObject.curX-l.touchObject.startX,2))),r=Math.round(Math.sqrt(Math.pow(l.touchObject.curY-l.touchObject.startY,2))),!l.options.verticalSwiping&&!l.swiping&&r>4?(l.scrolling=!0,!1):(l.options.verticalSwiping===!0&&(l.touchObject.swipeLength=r),t=l.swipeDirection(),void 0!==i.originalEvent&&l.touchObject.swipeLength>4&&(l.swiping=!0,i.preventDefault()),s=(l.options.rtl===!1?1:-1)*(l.touchObject.curX>l.touchObject.startX?1:-1),l.options.verticalSwiping===!0&&(s=l.touchObject.curY>l.touchObject.startY?1:-1),o=l.touchObject.swipeLength,l.touchObject.edgeHit=!1,l.options.infinite===!1&&(0===l.currentSlide&&"right"===t||l.currentSlide>=l.getDotCount()&&"left"===t)&&(o=l.touchObject.swipeLength*l.options.edgeFriction,l.touchObject.edgeHit=!0),l.options.vertical===!1?l.swipeLeft=e+o*s:l.swipeLeft=e+o*(l.$list.height()/l.listWidth)*s,l.options.verticalSwiping===!0&&(l.swipeLeft=e+o*s),l.options.fade!==!0&&l.options.touchMove!==!1&&(l.animating===!0?(l.swipeLeft=null,!1):void l.setCSS(l.swipeLeft))))},e.prototype.swipeStart=function(i){var e,t=this;return t.interrupted=!0,1!==t.touchObject.fingerCount||t.slideCount<=t.options.slidesToShow?(t.touchObject={},!1):(void 0!==i.originalEvent&&void 0!==i.originalEvent.touches&&(e=i.originalEvent.touches[0]),t.touchObject.startX=t.touchObject.curX=void 0!==e?e.pageX:i.clientX,t.touchObject.startY=t.touchObject.curY=void 0!==e?e.pageY:i.clientY,void(t.dragging=!0))},e.prototype.unfilterSlides=e.prototype.slickUnfilter=function(){var i=this;null!==i.$slidesCache&&(i.unload(),i.$slideTrack.children(this.options.slide).detach(),i.$slidesCache.appendTo(i.$slideTrack),i.reinit())},e.prototype.unload=function(){var e=this;i(".slick-cloned",e.$slider).remove(),e.$dots&&e.$dots.remove(),e.$prevArrow&&e.htmlExpr.test(e.options.prevArrow)&&e.$prevArrow.remove(),e.$nextArrow&&e.htmlExpr.test(e.options.nextArrow)&&e.$nextArrow.remove(),e.$slides.removeClass("slick-slide slick-active slick-visible slick-current").attr("aria-hidden","true").css("width","")},e.prototype.unslick=function(i){var e=this;e.$slider.trigger("unslick",[e,i]),e.destroy()},e.prototype.updateArrows=function(){var i,e=this;i=Math.floor(e.options.slidesToShow/2),e.options.arrows===!0&&e.slideCount>e.options.slidesToShow&&!e.options.infinite&&(e.$prevArrow.removeClass("slick-disabled").attr("aria-disabled","false"),e.$nextArrow.removeClass("slick-disabled").attr("aria-disabled","false"),0===e.currentSlide?(e.$prevArrow.addClass("slick-disabled").attr("aria-disabled","true"),e.$nextArrow.removeClass("slick-disabled").attr("aria-disabled","false")):e.currentSlide>=e.slideCount-e.options.slidesToShow&&e.options.centerMode===!1?(e.$nextArrow.addClass("slick-disabled").attr("aria-disabled","true"),e.$prevArrow.removeClass("slick-disabled").attr("aria-disabled","false")):e.currentSlide>=e.slideCount-1&&e.options.centerMode===!0&&(e.$nextArrow.addClass("slick-disabled").attr("aria-disabled","true"),e.$prevArrow.removeClass("slick-disabled").attr("aria-disabled","false")))},e.prototype.updateDots=function(){var i=this;null!==i.$dots&&(i.$dots.find("li").removeClass("slick-active").end(),i.$dots.find("li").eq(Math.floor(i.currentSlide/i.options.slidesToScroll)).addClass("slick-active"))},e.prototype.visibility=function(){var i=this;i.options.autoplay&&(document[i.hidden]?i.interrupted=!0:i.interrupted=!1)},i.fn.slick=function(){var i,t,o=this,s=arguments[0],n=Array.prototype.slice.call(arguments,1),r=o.length;for(i=0;i<r;i++)if("object"==typeof s||"undefined"==typeof s?o[i].slick=new e(o[i],s):t=o[i].slick[s].apply(o[i].slick,n),"undefined"!=typeof t)return t;return o}});
/**
 * Super simple wysiwyg editor v0.8.12
 * https://summernote.org
 *
 * Copyright 2013- Alan Hong. and other contributors
 * summernote may be freely distributed under the MIT license.
 *
 * Date: 2019-05-16T08:16Z
 */
(function (global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined' ? factory(require('jquery')) :
        typeof define === 'function' && define.amd ? define(['jquery'], factory) :
            (global = global || self, factory(global.jQuery));
}(this, function ($$1) { 'use strict';

    $$1 = $$1 && $$1.hasOwnProperty('default') ? $$1['default'] : $$1;

    var Renderer = /** @class */ (function () {
        function Renderer(markup, children, options, callback) {
            this.markup = markup;
            this.children = children;
            this.options = options;
            this.callback = callback;
        }
        Renderer.prototype.render = function ($parent) {
            var $node = $$1(this.markup);
            if (this.options && this.options.contents) {
                $node.html(this.options.contents);
            }
            if (this.options && this.options.className) {
                $node.addClass(this.options.className);
            }
            if (this.options && this.options.data) {
                $$1.each(this.options.data, function (k, v) {
                    $node.attr('data-' + k, v);
                });
            }
            if (this.options && this.options.click) {
                $node.on('click', this.options.click);
            }
            if (this.children) {
                var $container_1 = $node.find('.note-children-container');
                this.children.forEach(function (child) {
                    child.render($container_1.length ? $container_1 : $node);
                });
            }
            if (this.callback) {
                this.callback($node, this.options);
            }
            if (this.options && this.options.callback) {
                this.options.callback($node);
            }
            if ($parent) {
                $parent.append($node);
            }
            return $node;
        };
        return Renderer;
    }());
    var renderer = {
        create: function (markup, callback) {
            return function () {
                var options = typeof arguments[1] === 'object' ? arguments[1] : arguments[0];
                var children = Array.isArray(arguments[0]) ? arguments[0] : [];
                if (options && options.children) {
                    children = options.children;
                }
                return new Renderer(markup, children, options, callback);
            };
        }
    };

    var editor = renderer.create('<div class="note-editor note-frame panel panel-default"/>');
    var toolbar = renderer.create('<div class="note-toolbar panel-heading" role="toolbar"></div></div>');
    var editingArea = renderer.create('<div class="note-editing-area"/>');
    var codable = renderer.create('<textarea class="note-codable" role="textbox" aria-multiline="true"/>');
    var editable = renderer.create('<div class="note-editable" contentEditable="true" role="textbox" aria-multiline="true"/>');
    var statusbar = renderer.create([
        '<output class="note-status-output" aria-live="polite"/>',
        '<div class="note-statusbar" role="status">',
        '  <div class="note-resizebar" role="seperator" aria-orientation="horizontal" aria-label="Resize">',
        '    <div class="note-icon-bar"/>',
        '    <div class="note-icon-bar"/>',
        '    <div class="note-icon-bar"/>',
        '  </div>',
        '</div>',
    ].join(''));
    var airEditor = renderer.create('<div class="note-editor"/>');
    var airEditable = renderer.create([
        '<div class="note-editable" contentEditable="true" role="textbox" aria-multiline="true"/>',
        '<output class="note-status-output" aria-live="polite"/>',
    ].join(''));
    var buttonGroup = renderer.create('<div class="note-btn-group btn-group">');
    var dropdown = renderer.create('<ul class="dropdown-menu" role="list">', function ($node, options) {
        var markup = Array.isArray(options.items) ? options.items.map(function (item) {
            var value = (typeof item === 'string') ? item : (item.value || '');
            var content = options.template ? options.template(item) : item;
            var option = (typeof item === 'object') ? item.option : undefined;
            var dataValue = 'data-value="' + value + '"';
            var dataOption = (option !== undefined) ? ' data-option="' + option + '"' : '';
            return '<li role="listitem" aria-label="' + value + '"><a href="#" ' + (dataValue + dataOption) + '>' + content + '</a></li>';
        }).join('') : options.items;
        $node.html(markup).attr({ 'aria-label': options.title });
    });
    var dropdownButtonContents = function (contents, options) {
        return contents + ' ' + icon(options.icons.caret, 'span');
    };
    var dropdownCheck = renderer.create('<ul class="dropdown-menu note-check" role="list">', function ($node, options) {
        var markup = Array.isArray(options.items) ? options.items.map(function (item) {
            var value = (typeof item === 'string') ? item : (item.value || '');
            var content = options.template ? options.template(item) : item;
            return '<li role="listitem" aria-label="' + item + '"><a href="#" data-value="' + value + '">' + icon(options.checkClassName) + ' ' + content + '</a></li>';
        }).join('') : options.items;
        $node.html(markup).attr({ 'aria-label': options.title });
    });
    var palette = renderer.create('<div class="note-color-palette"/>', function ($node, options) {
        var contents = [];
        for (var row = 0, rowSize = options.colors.length; row < rowSize; row++) {
            var eventName = options.eventName;
            var colors = options.colors[row];
            var colorsName = options.colorsName[row];
            var buttons = [];
            for (var col = 0, colSize = colors.length; col < colSize; col++) {
                var color = colors[col];
                var colorName = colorsName[col];
                buttons.push([
                    '<button type="button" class="note-color-btn"',
                    'style="background-color:', color, '" ',
                    'data-event="', eventName, '" ',
                    'data-value="', color, '" ',
                    'title="', colorName, '" ',
                    'aria-label="', colorName, '" ',
                    'data-toggle="button" tabindex="-1"></button>',
                ].join(''));
            }
            contents.push('<div class="note-color-row">' + buttons.join('') + '</div>');
        }
        $node.html(contents.join(''));
        if (options.tooltip) {
            $node.find('.note-color-btn').tooltip({
                container: options.container,
                trigger: 'hover',
                placement: 'bottom'
            });
        }
    });
    var dialog = renderer.create('<div class="modal" aria-hidden="false" tabindex="-1" role="dialog"/>', function ($node, options) {
        if (options.fade) {
            $node.addClass('fade');
        }
        $node.attr({
            'aria-label': options.title
        });
        $node.html([
            '<div class="modal-dialog">',
            '  <div class="modal-content">',
            (options.title
                ? '    <div class="modal-header">' +
                '      <button type="button" class="close" data-dismiss="modal" aria-label="Close" aria-hidden="true">&times;</button>' +
                '      <h4 class="modal-title">' + options.title + '</h4>' +
                '    </div>' : ''),
            '    <div class="modal-body">' + options.body + '</div>',
            (options.footer
                ? '    <div class="modal-footer">' + options.footer + '</div>' : ''),
            '  </div>',
            '</div>',
        ].join(''));
    });
    var popover = renderer.create([
        '<div class="note-popover popover in">',
        '  <div class="arrow"/>',
        '  <div class="popover-content note-children-container"/>',
        '</div>',
    ].join(''), function ($node, options) {
        var direction = typeof options.direction !== 'undefined' ? options.direction : 'bottom';
        $node.addClass(direction);
        if (options.hideArrow) {
            $node.find('.arrow').hide();
        }
    });
    var checkbox = renderer.create('<div class="checkbox"></div>', function ($node, options) {
        $node.html([
            '<label' + (options.id ? ' for="' + options.id + '"' : '') + '>',
            ' <input role="checkbox" type="checkbox"' + (options.id ? ' id="' + options.id + '"' : ''),
            (options.checked ? ' checked' : ''),
            ' aria-checked="' + (options.checked ? 'true' : 'false') + '"/>',
            (options.text ? options.text : ''),
            '</label>',
        ].join(''));
    });
    var icon = function (iconClassName, tagName) {
        tagName = tagName || 'i';
        return '<' + tagName + ' class="' + iconClassName + '"/>';
    };
    var ui = {
        editor: editor,
        toolbar: toolbar,
        editingArea: editingArea,
        codable: codable,
        editable: editable,
        statusbar: statusbar,
        airEditor: airEditor,
        airEditable: airEditable,
        buttonGroup: buttonGroup,
        dropdown: dropdown,
        dropdownButtonContents: dropdownButtonContents,
        dropdownCheck: dropdownCheck,
        palette: palette,
        dialog: dialog,
        popover: popover,
        checkbox: checkbox,
        icon: icon,
        options: {},
        button: function ($node, options) {
            return renderer.create('<button type="button" class="note-btn btn btn-default btn-sm" role="button" tabindex="-1">', function ($node, options) {
                if (options && options.tooltip) {
                    $node.attr({
                        title: options.tooltip,
                        'aria-label': options.tooltip
                    }).tooltip({
                        container: (options.container !== undefined) ? options.container : 'body',
                        trigger: 'hover',
                        placement: 'bottom'
                    }).on('click', function (e) {
                        $$1(e.currentTarget).tooltip('hide');
                    });
                }
            })($node, options);
        },
        toggleBtn: function ($btn, isEnable) {
            $btn.toggleClass('disabled', !isEnable);
            $btn.attr('disabled', !isEnable);
        },
        toggleBtnActive: function ($btn, isActive) {
            $btn.toggleClass('active', isActive);
        },
        onDialogShown: function ($dialog, handler) {
            $dialog.one('shown.bs.modal', handler);
        },
        onDialogHidden: function ($dialog, handler) {
            $dialog.one('hidden.bs.modal', handler);
        },
        showDialog: function ($dialog) {
            $dialog.modal('show');
        },
        hideDialog: function ($dialog) {
            $dialog.modal('hide');
        },
        createLayout: function ($note, options) {
            var $editor = (options.airMode ? ui.airEditor([
                ui.editingArea([
                    ui.airEditable(),
                ]),
            ]) : ui.editor([
                ui.toolbar(),
                ui.editingArea([
                    ui.codable(),
                    ui.editable(),
                ]),
                ui.statusbar(),
            ])).render();
            $editor.insertAfter($note);
            return {
                note: $note,
                editor: $editor,
                toolbar: $editor.find('.note-toolbar'),
                editingArea: $editor.find('.note-editing-area'),
                editable: $editor.find('.note-editable'),
                codable: $editor.find('.note-codable'),
                statusbar: $editor.find('.note-statusbar')
            };
        },
        removeLayout: function ($note, layoutInfo) {
            $note.html(layoutInfo.editable.html());
            layoutInfo.editor.remove();
            $note.show();
        }
    };

    $$1.summernote = $$1.summernote || {
        lang: {}
    };
    $$1.extend($$1.summernote.lang, {
        'en-US': {
            font: {
                bold: 'Bold',
                italic: 'Italic',
                underline: 'Underline',
                clear: 'Remove Font Style',
                height: 'Line Height',
                name: 'Font Family',
                strikethrough: 'Strikethrough',
                subscript: 'Subscript',
                superscript: 'Superscript',
                size: 'Font Size'
            },
            image: {
                image: 'Picture',
                insert: 'Insert Image',
                resizeFull: 'Resize full',
                resizeHalf: 'Resize half',
                resizeQuarter: 'Resize quarter',
                resizeNone: 'Original size',
                floatLeft: 'Float Left',
                floatRight: 'Float Right',
                floatNone: 'Remove float',
                shapeRounded: 'Shape: Rounded',
                shapeCircle: 'Shape: Circle',
                shapeThumbnail: 'Shape: Thumbnail',
                shapeNone: 'Shape: None',
                dragImageHere: 'Drag image or text here',
                dropImage: 'Drop image or Text',
                selectFromFiles: 'Select from files',
                maximumFileSize: 'Maximum file size',
                maximumFileSizeError: 'Maximum file size exceeded.',
                url: 'Image URL',
                remove: 'Remove Image',
                original: 'Original'
            },
            video: {
                video: 'Video',
                videoLink: 'Video Link',
                insert: 'Insert Video',
                url: 'Video URL',
                providers: '(YouTube, Vimeo, Vine, Instagram, DailyMotion or Youku)'
            },
            link: {
                link: 'Link',
                insert: 'Insert Link',
                unlink: 'Unlink',
                edit: 'Edit',
                textToDisplay: 'Text to display',
                url: 'To what URL should this link go?',
                openInNewWindow: 'Open in new window'
            },
            table: {
                table: 'Table',
                addRowAbove: 'Add row above',
                addRowBelow: 'Add row below',
                addColLeft: 'Add column left',
                addColRight: 'Add column right',
                delRow: 'Delete row',
                delCol: 'Delete column',
                delTable: 'Delete table'
            },
            hr: {
                insert: 'Insert Horizontal Rule'
            },
            style: {
                style: 'Style',
                p: 'Normal',
                blockquote: 'Quote',
                pre: 'Code',
                h1: 'Header 1',
                h2: 'Header 2',
                h3: 'Header 3',
                h4: 'Header 4',
                h5: 'Header 5',
                h6: 'Header 6'
            },
            lists: {
                unordered: 'Unordered list',
                ordered: 'Ordered list'
            },
            options: {
                help: 'Help',
                fullscreen: 'Full Screen',
                codeview: 'Code View'
            },
            paragraph: {
                paragraph: 'Paragraph',
                outdent: 'Outdent',
                indent: 'Indent',
                left: 'Align left',
                center: 'Align center',
                right: 'Align right',
                justify: 'Justify full'
            },
            color: {
                recent: 'Recent Color',
                more: 'More Color',
                background: 'Background Color',
                foreground: 'Foreground Color',
                transparent: 'Transparent',
                setTransparent: 'Set transparent',
                reset: 'Reset',
                resetToDefault: 'Reset to default',
                cpSelect: 'Select'
            },
            shortcut: {
                shortcuts: 'Keyboard shortcuts',
                close: 'Close',
                textFormatting: 'Text formatting',
                action: 'Action',
                paragraphFormatting: 'Paragraph formatting',
                documentStyle: 'Document Style',
                extraKeys: 'Extra keys'
            },
            help: {
                'insertParagraph': 'Insert Paragraph',
                'undo': 'Undoes the last command',
                'redo': 'Redoes the last command',
                'tab': 'Tab',
                'untab': 'Untab',
                'bold': 'Set a bold style',
                'italic': 'Set a italic style',
                'underline': 'Set a underline style',
                'strikethrough': 'Set a strikethrough style',
                'removeFormat': 'Clean a style',
                'justifyLeft': 'Set left align',
                'justifyCenter': 'Set center align',
                'justifyRight': 'Set right align',
                'justifyFull': 'Set full align',
                'insertUnorderedList': 'Toggle unordered list',
                'insertOrderedList': 'Toggle ordered list',
                'outdent': 'Outdent on current paragraph',
                'indent': 'Indent on current paragraph',
                'formatPara': 'Change current block\'s format as a paragraph(P tag)',
                'formatH1': 'Change current block\'s format as H1',
                'formatH2': 'Change current block\'s format as H2',
                'formatH3': 'Change current block\'s format as H3',
                'formatH4': 'Change current block\'s format as H4',
                'formatH5': 'Change current block\'s format as H5',
                'formatH6': 'Change current block\'s format as H6',
                'insertHorizontalRule': 'Insert horizontal rule',
                'linkDialog.show': 'Show Link Dialog'
            },
            history: {
                undo: 'Undo',
                redo: 'Redo'
            },
            specialChar: {
                specialChar: 'SPECIAL CHARACTERS',
                select: 'Select Special characters'
            }
        }
    });

    var isSupportAmd = typeof define === 'function' && define.amd; // eslint-disable-line
    /**
     * returns whether font is installed or not.
     *
     * @param {String} fontName
     * @return {Boolean}
     */
    function isFontInstalled(fontName) {
        var testFontName = fontName === 'Comic Sans MS' ? 'Courier New' : 'Comic Sans MS';
        var testText = 'mmmmmmmmmmwwwww';
        var testSize = '200px';
        var canvas = document.createElement('canvas');
        var context = canvas.getContext('2d');
        context.font = testSize + " '" + testFontName + "'";
        var originalWidth = context.measureText(testText).width;
        context.font = testSize + " '" + fontName + "', '" + testFontName + "'";
        var width = context.measureText(testText).width;
        return originalWidth !== width;
    }
    var userAgent = navigator.userAgent;
    var isMSIE = /MSIE|Trident/i.test(userAgent);
    var browserVersion;
    if (isMSIE) {
        var matches = /MSIE (\d+[.]\d+)/.exec(userAgent);
        if (matches) {
            browserVersion = parseFloat(matches[1]);
        }
        matches = /Trident\/.*rv:([0-9]{1,}[.0-9]{0,})/.exec(userAgent);
        if (matches) {
            browserVersion = parseFloat(matches[1]);
        }
    }
    var isEdge = /Edge\/\d+/.test(userAgent);
    var hasCodeMirror = !!window.CodeMirror;
    var isSupportTouch = (('ontouchstart' in window) ||
        (navigator.MaxTouchPoints > 0) ||
        (navigator.msMaxTouchPoints > 0));
    // [workaround] IE doesn't have input events for contentEditable
    // - see: https://goo.gl/4bfIvA
    var inputEventName = (isMSIE || isEdge) ? 'DOMCharacterDataModified DOMSubtreeModified DOMNodeInserted' : 'input';
    /**
     * @class core.env
     *
     * Object which check platform and agent
     *
     * @singleton
     * @alternateClassName env
     */
    var env = {
        isMac: navigator.appVersion.indexOf('Mac') > -1,
        isMSIE: isMSIE,
        isEdge: isEdge,
        isFF: !isEdge && /firefox/i.test(userAgent),
        isPhantom: /PhantomJS/i.test(userAgent),
        isWebkit: !isEdge && /webkit/i.test(userAgent),
        isChrome: !isEdge && /chrome/i.test(userAgent),
        isSafari: !isEdge && /safari/i.test(userAgent),
        browserVersion: browserVersion,
        jqueryVersion: parseFloat($$1.fn.jquery),
        isSupportAmd: isSupportAmd,
        isSupportTouch: isSupportTouch,
        hasCodeMirror: hasCodeMirror,
        isFontInstalled: isFontInstalled,
        isW3CRangeSupport: !!document.createRange,
        inputEventName: inputEventName
    };

    /**
     * @class core.func
     *
     * func utils (for high-order func's arg)
     *
     * @singleton
     * @alternateClassName func
     */
    function eq(itemA) {
        return function (itemB) {
            return itemA === itemB;
        };
    }
    function eq2(itemA, itemB) {
        return itemA === itemB;
    }
    function peq2(propName) {
        return function (itemA, itemB) {
            return itemA[propName] === itemB[propName];
        };
    }
    function ok() {
        return true;
    }
    function fail() {
        return false;
    }
    function not(f) {
        return function () {
            return !f.apply(f, arguments);
        };
    }
    function and(fA, fB) {
        return function (item) {
            return fA(item) && fB(item);
        };
    }
    function self(a) {
        return a;
    }
    function invoke(obj, method) {
        return function () {
            return obj[method].apply(obj, arguments);
        };
    }
    var idCounter = 0;
    /**
     * generate a globally-unique id
     *
     * @param {String} [prefix]
     */
    function uniqueId(prefix) {
        var id = ++idCounter + '';
        return prefix ? prefix + id : id;
    }
    /**
     * returns bnd (bounds) from rect
     *
     * - IE Compatibility Issue: http://goo.gl/sRLOAo
     * - Scroll Issue: http://goo.gl/sNjUc
     *
     * @param {Rect} rect
     * @return {Object} bounds
     * @return {Number} bounds.top
     * @return {Number} bounds.left
     * @return {Number} bounds.width
     * @return {Number} bounds.height
     */
    function rect2bnd(rect) {
        var $document = $(document);
        return {
            top: rect.top + $document.scrollTop(),
            left: rect.left + $document.scrollLeft(),
            width: rect.right - rect.left,
            height: rect.bottom - rect.top
        };
    }
    /**
     * returns a copy of the object where the keys have become the values and the values the keys.
     * @param {Object} obj
     * @return {Object}
     */
    function invertObject(obj) {
        var inverted = {};
        for (var key in obj) {
            if (obj.hasOwnProperty(key)) {
                inverted[obj[key]] = key;
            }
        }
        return inverted;
    }
    /**
     * @param {String} namespace
     * @param {String} [prefix]
     * @return {String}
     */
    function namespaceToCamel(namespace, prefix) {
        prefix = prefix || '';
        return prefix + namespace.split('.').map(function (name) {
            return name.substring(0, 1).toUpperCase() + name.substring(1);
        }).join('');
    }
    /**
     * Returns a function, that, as long as it continues to be invoked, will not
     * be triggered. The function will be called after it stops being called for
     * N milliseconds. If `immediate` is passed, trigger the function on the
     * leading edge, instead of the trailing.
     * @param {Function} func
     * @param {Number} wait
     * @param {Boolean} immediate
     * @return {Function}
     */
    function debounce(func, wait, immediate) {
        var timeout;
        return function () {
            var context = this;
            var args = arguments;
            var later = function () {
                timeout = null;
                if (!immediate) {
                    func.apply(context, args);
                }
            };
            var callNow = immediate && !timeout;
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
            if (callNow) {
                func.apply(context, args);
            }
        };
    }
    /**
     *
     * @param {String} url
     * @return {Boolean}
     */
    function isValidUrl(url) {
        var expression = /[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/gi;
        return expression.test(url);
    }
    var func = {
        eq: eq,
        eq2: eq2,
        peq2: peq2,
        ok: ok,
        fail: fail,
        self: self,
        not: not,
        and: and,
        invoke: invoke,
        uniqueId: uniqueId,
        rect2bnd: rect2bnd,
        invertObject: invertObject,
        namespaceToCamel: namespaceToCamel,
        debounce: debounce,
        isValidUrl: isValidUrl
    };

    /**
     * returns the first item of an array.
     *
     * @param {Array} array
     */
    function head(array) {
        return array[0];
    }
    /**
     * returns the last item of an array.
     *
     * @param {Array} array
     */
    function last(array) {
        return array[array.length - 1];
    }
    /**
     * returns everything but the last entry of the array.
     *
     * @param {Array} array
     */
    function initial(array) {
        return array.slice(0, array.length - 1);
    }
    /**
     * returns the rest of the items in an array.
     *
     * @param {Array} array
     */
    function tail(array) {
        return array.slice(1);
    }
    /**
     * returns item of array
     */
    function find(array, pred) {
        for (var idx = 0, len = array.length; idx < len; idx++) {
            var item = array[idx];
            if (pred(item)) {
                return item;
            }
        }
    }
    /**
     * returns true if all of the values in the array pass the predicate truth test.
     */
    function all(array, pred) {
        for (var idx = 0, len = array.length; idx < len; idx++) {
            if (!pred(array[idx])) {
                return false;
            }
        }
        return true;
    }
    /**
     * returns true if the value is present in the list.
     */
    function contains(array, item) {
        if (array && array.length && item) {
            return array.indexOf(item) !== -1;
        }
        return false;
    }
    /**
     * get sum from a list
     *
     * @param {Array} array - array
     * @param {Function} fn - iterator
     */
    function sum(array, fn) {
        fn = fn || func.self;
        return array.reduce(function (memo, v) {
            return memo + fn(v);
        }, 0);
    }
    /**
     * returns a copy of the collection with array type.
     * @param {Collection} collection - collection eg) node.childNodes, ...
     */
    function from(collection) {
        var result = [];
        var length = collection.length;
        var idx = -1;
        while (++idx < length) {
            result[idx] = collection[idx];
        }
        return result;
    }
    /**
     * returns whether list is empty or not
     */
    function isEmpty(array) {
        return !array || !array.length;
    }
    /**
     * cluster elements by predicate function.
     *
     * @param {Array} array - array
     * @param {Function} fn - predicate function for cluster rule
     * @param {Array[]}
     */
    function clusterBy(array, fn) {
        if (!array.length) {
            return [];
        }
        var aTail = tail(array);
        return aTail.reduce(function (memo, v) {
            var aLast = last(memo);
            if (fn(last(aLast), v)) {
                aLast[aLast.length] = v;
            }
            else {
                memo[memo.length] = [v];
            }
            return memo;
        }, [[head(array)]]);
    }
    /**
     * returns a copy of the array with all false values removed
     *
     * @param {Array} array - array
     * @param {Function} fn - predicate function for cluster rule
     */
    function compact(array) {
        var aResult = [];
        for (var idx = 0, len = array.length; idx < len; idx++) {
            if (array[idx]) {
                aResult.push(array[idx]);
            }
        }
        return aResult;
    }
    /**
     * produces a duplicate-free version of the array
     *
     * @param {Array} array
     */
    function unique(array) {
        var results = [];
        for (var idx = 0, len = array.length; idx < len; idx++) {
            if (!contains(results, array[idx])) {
                results.push(array[idx]);
            }
        }
        return results;
    }
    /**
     * returns next item.
     * @param {Array} array
     */
    function next(array, item) {
        if (array && array.length && item) {
            var idx = array.indexOf(item);
            return idx === -1 ? null : array[idx + 1];
        }
        return null;
    }
    /**
     * returns prev item.
     * @param {Array} array
     */
    function prev(array, item) {
        if (array && array.length && item) {
            var idx = array.indexOf(item);
            return idx === -1 ? null : array[idx - 1];
        }
        return null;
    }
    /**
     * @class core.list
     *
     * list utils
     *
     * @singleton
     * @alternateClassName list
     */
    var lists = {
        head: head,
        last: last,
        initial: initial,
        tail: tail,
        prev: prev,
        next: next,
        find: find,
        contains: contains,
        all: all,
        sum: sum,
        from: from,
        isEmpty: isEmpty,
        clusterBy: clusterBy,
        compact: compact,
        unique: unique
    };

    var NBSP_CHAR = String.fromCharCode(160);
    var ZERO_WIDTH_NBSP_CHAR = '\ufeff';
    /**
     * @method isEditable
     *
     * returns whether node is `note-editable` or not.
     *
     * @param {Node} node
     * @return {Boolean}
     */
    function isEditable(node) {
        return node && $$1(node).hasClass('note-editable');
    }
    /**
     * @method isControlSizing
     *
     * returns whether node is `note-control-sizing` or not.
     *
     * @param {Node} node
     * @return {Boolean}
     */
    function isControlSizing(node) {
        return node && $$1(node).hasClass('note-control-sizing');
    }
    /**
     * @method makePredByNodeName
     *
     * returns predicate which judge whether nodeName is same
     *
     * @param {String} nodeName
     * @return {Function}
     */
    function makePredByNodeName(nodeName) {
        nodeName = nodeName.toUpperCase();
        return function (node) {
            return node && node.nodeName.toUpperCase() === nodeName;
        };
    }
    /**
     * @method isText
     *
     *
     *
     * @param {Node} node
     * @return {Boolean} true if node's type is text(3)
     */
    function isText(node) {
        return node && node.nodeType === 3;
    }
    /**
     * @method isElement
     *
     *
     *
     * @param {Node} node
     * @return {Boolean} true if node's type is element(1)
     */
    function isElement(node) {
        return node && node.nodeType === 1;
    }
    /**
     * ex) br, col, embed, hr, img, input, ...
     * @see http://www.w3.org/html/wg/drafts/html/master/syntax.html#void-elements
     */
    function isVoid(node) {
        return node && /^BR|^IMG|^HR|^IFRAME|^BUTTON|^INPUT|^AUDIO|^VIDEO|^EMBED/.test(node.nodeName.toUpperCase());
    }
    function isPara(node) {
        if (isEditable(node)) {
            return false;
        }
        // Chrome(v31.0), FF(v25.0.1) use DIV for paragraph
        return node && /^DIV|^P|^LI|^H[1-7]/.test(node.nodeName.toUpperCase());
    }
    function isHeading(node) {
        return node && /^H[1-7]/.test(node.nodeName.toUpperCase());
    }
    var isPre = makePredByNodeName('PRE');
    var isLi = makePredByNodeName('LI');
    function isPurePara(node) {
        return isPara(node) && !isLi(node);
    }
    var isTable = makePredByNodeName('TABLE');
    var isData = makePredByNodeName('DATA');
    function isInline(node) {
        return !isBodyContainer(node) &&
            !isList(node) &&
            !isHr(node) &&
            !isPara(node) &&
            !isTable(node) &&
            !isBlockquote(node) &&
            !isData(node);
    }
    function isList(node) {
        return node && /^UL|^OL/.test(node.nodeName.toUpperCase());
    }
    var isHr = makePredByNodeName('HR');
    function isCell(node) {
        return node && /^TD|^TH/.test(node.nodeName.toUpperCase());
    }
    var isBlockquote = makePredByNodeName('BLOCKQUOTE');
    function isBodyContainer(node) {
        return isCell(node) || isBlockquote(node) || isEditable(node);
    }
    var isAnchor = makePredByNodeName('A');
    function isParaInline(node) {
        return isInline(node) && !!ancestor(node, isPara);
    }
    function isBodyInline(node) {
        return isInline(node) && !ancestor(node, isPara);
    }
    var isBody = makePredByNodeName('BODY');
    /**
     * returns whether nodeB is closest sibling of nodeA
     *
     * @param {Node} nodeA
     * @param {Node} nodeB
     * @return {Boolean}
     */
    function isClosestSibling(nodeA, nodeB) {
        return nodeA.nextSibling === nodeB ||
            nodeA.previousSibling === nodeB;
    }
    /**
     * returns array of closest siblings with node
     *
     * @param {Node} node
     * @param {function} [pred] - predicate function
     * @return {Node[]}
     */
    function withClosestSiblings(node, pred) {
        pred = pred || func.ok;
        var siblings = [];
        if (node.previousSibling && pred(node.previousSibling)) {
            siblings.push(node.previousSibling);
        }
        siblings.push(node);
        if (node.nextSibling && pred(node.nextSibling)) {
            siblings.push(node.nextSibling);
        }
        return siblings;
    }
    /**
     * blank HTML for cursor position
     * - [workaround] old IE only works with &nbsp;
     * - [workaround] IE11 and other browser works with bogus br
     */
    var blankHTML = env.isMSIE && env.browserVersion < 11 ? '&nbsp;' : '<br>';
    /**
     * @method nodeLength
     *
     * returns #text's text size or element's childNodes size
     *
     * @param {Node} node
     */
    function nodeLength(node) {
        if (isText(node)) {
            return node.nodeValue.length;
        }
        if (node) {
            return node.childNodes.length;
        }
        return 0;
    }
    /**
     * returns whether node is empty or not.
     *
     * @param {Node} node
     * @return {Boolean}
     */
    function isEmpty$1(node) {
        var len = nodeLength(node);
        if (len === 0) {
            return true;
        }
        else if (!isText(node) && len === 1 && node.innerHTML === blankHTML) {
            // ex) <p><br></p>, <span><br></span>
            return true;
        }
        else if (lists.all(node.childNodes, isText) && node.innerHTML === '') {
            // ex) <p></p>, <span></span>
            return true;
        }
        return false;
    }
    /**
     * padding blankHTML if node is empty (for cursor position)
     */
    function paddingBlankHTML(node) {
        if (!isVoid(node) && !nodeLength(node)) {
            node.innerHTML = blankHTML;
        }
    }
    /**
     * find nearest ancestor predicate hit
     *
     * @param {Node} node
     * @param {Function} pred - predicate function
     */
    function ancestor(node, pred) {
        while (node) {
            if (pred(node)) {
                return node;
            }
            if (isEditable(node)) {
                break;
            }
            node = node.parentNode;
        }
        return null;
    }
    /**
     * find nearest ancestor only single child blood line and predicate hit
     *
     * @param {Node} node
     * @param {Function} pred - predicate function
     */
    function singleChildAncestor(node, pred) {
        node = node.parentNode;
        while (node) {
            if (nodeLength(node) !== 1) {
                break;
            }
            if (pred(node)) {
                return node;
            }
            if (isEditable(node)) {
                break;
            }
            node = node.parentNode;
        }
        return null;
    }
    /**
     * returns new array of ancestor nodes (until predicate hit).
     *
     * @param {Node} node
     * @param {Function} [optional] pred - predicate function
     */
    function listAncestor(node, pred) {
        pred = pred || func.fail;
        var ancestors = [];
        ancestor(node, function (el) {
            if (!isEditable(el)) {
                ancestors.push(el);
            }
            return pred(el);
        });
        return ancestors;
    }
    /**
     * find farthest ancestor predicate hit
     */
    function lastAncestor(node, pred) {
        var ancestors = listAncestor(node);
        return lists.last(ancestors.filter(pred));
    }
    /**
     * returns common ancestor node between two nodes.
     *
     * @param {Node} nodeA
     * @param {Node} nodeB
     */
    function commonAncestor(nodeA, nodeB) {
        var ancestors = listAncestor(nodeA);
        for (var n = nodeB; n; n = n.parentNode) {
            if (ancestors.indexOf(n) > -1)
                return n;
        }
        return null; // difference document area
    }
    /**
     * listing all previous siblings (until predicate hit).
     *
     * @param {Node} node
     * @param {Function} [optional] pred - predicate function
     */
    function listPrev(node, pred) {
        pred = pred || func.fail;
        var nodes = [];
        while (node) {
            if (pred(node)) {
                break;
            }
            nodes.push(node);
            node = node.previousSibling;
        }
        return nodes;
    }
    /**
     * listing next siblings (until predicate hit).
     *
     * @param {Node} node
     * @param {Function} [pred] - predicate function
     */
    function listNext(node, pred) {
        pred = pred || func.fail;
        var nodes = [];
        while (node) {
            if (pred(node)) {
                break;
            }
            nodes.push(node);
            node = node.nextSibling;
        }
        return nodes;
    }
    /**
     * listing descendant nodes
     *
     * @param {Node} node
     * @param {Function} [pred] - predicate function
     */
    function listDescendant(node, pred) {
        var descendants = [];
        pred = pred || func.ok;
        // start DFS(depth first search) with node
        (function fnWalk(current) {
            if (node !== current && pred(current)) {
                descendants.push(current);
            }
            for (var idx = 0, len = current.childNodes.length; idx < len; idx++) {
                fnWalk(current.childNodes[idx]);
            }
        })(node);
        return descendants;
    }
    /**
     * wrap node with new tag.
     *
     * @param {Node} node
     * @param {Node} tagName of wrapper
     * @return {Node} - wrapper
     */
    function wrap(node, wrapperName) {
        var parent = node.parentNode;
        var wrapper = $$1('<' + wrapperName + '>')[0];
        parent.insertBefore(wrapper, node);
        wrapper.appendChild(node);
        return wrapper;
    }
    /**
     * insert node after preceding
     *
     * @param {Node} node
     * @param {Node} preceding - predicate function
     */
    function insertAfter(node, preceding) {
        var next = preceding.nextSibling;
        var parent = preceding.parentNode;
        if (next) {
            parent.insertBefore(node, next);
        }
        else {
            parent.appendChild(node);
        }
        return node;
    }
    /**
     * append elements.
     *
     * @param {Node} node
     * @param {Collection} aChild
     */
    function appendChildNodes(node, aChild) {
        $$1.each(aChild, function (idx, child) {
            node.appendChild(child);
        });
        return node;
    }
    /**
     * returns whether boundaryPoint is left edge or not.
     *
     * @param {BoundaryPoint} point
     * @return {Boolean}
     */
    function isLeftEdgePoint(point) {
        return point.offset === 0;
    }
    /**
     * returns whether boundaryPoint is right edge or not.
     *
     * @param {BoundaryPoint} point
     * @return {Boolean}
     */
    function isRightEdgePoint(point) {
        return point.offset === nodeLength(point.node);
    }
    /**
     * returns whether boundaryPoint is edge or not.
     *
     * @param {BoundaryPoint} point
     * @return {Boolean}
     */
    function isEdgePoint(point) {
        return isLeftEdgePoint(point) || isRightEdgePoint(point);
    }
    /**
     * returns whether node is left edge of ancestor or not.
     *
     * @param {Node} node
     * @param {Node} ancestor
     * @return {Boolean}
     */
    function isLeftEdgeOf(node, ancestor) {
        while (node && node !== ancestor) {
            if (position(node) !== 0) {
                return false;
            }
            node = node.parentNode;
        }
        return true;
    }
    /**
     * returns whether node is right edge of ancestor or not.
     *
     * @param {Node} node
     * @param {Node} ancestor
     * @return {Boolean}
     */
    function isRightEdgeOf(node, ancestor) {
        if (!ancestor) {
            return false;
        }
        while (node && node !== ancestor) {
            if (position(node) !== nodeLength(node.parentNode) - 1) {
                return false;
            }
            node = node.parentNode;
        }
        return true;
    }
    /**
     * returns whether point is left edge of ancestor or not.
     * @param {BoundaryPoint} point
     * @param {Node} ancestor
     * @return {Boolean}
     */
    function isLeftEdgePointOf(point, ancestor) {
        return isLeftEdgePoint(point) && isLeftEdgeOf(point.node, ancestor);
    }
    /**
     * returns whether point is right edge of ancestor or not.
     * @param {BoundaryPoint} point
     * @param {Node} ancestor
     * @return {Boolean}
     */
    function isRightEdgePointOf(point, ancestor) {
        return isRightEdgePoint(point) && isRightEdgeOf(point.node, ancestor);
    }
    /**
     * returns offset from parent.
     *
     * @param {Node} node
     */
    function position(node) {
        var offset = 0;
        while ((node = node.previousSibling)) {
            offset += 1;
        }
        return offset;
    }
    function hasChildren(node) {
        return !!(node && node.childNodes && node.childNodes.length);
    }
    /**
     * returns previous boundaryPoint
     *
     * @param {BoundaryPoint} point
     * @param {Boolean} isSkipInnerOffset
     * @return {BoundaryPoint}
     */
    function prevPoint(point, isSkipInnerOffset) {
        var node;
        var offset;
        if (point.offset === 0) {
            if (isEditable(point.node)) {
                return null;
            }
            node = point.node.parentNode;
            offset = position(point.node);
        }
        else if (hasChildren(point.node)) {
            node = point.node.childNodes[point.offset - 1];
            offset = nodeLength(node);
        }
        else {
            node = point.node;
            offset = isSkipInnerOffset ? 0 : point.offset - 1;
        }
        return {
            node: node,
            offset: offset
        };
    }
    /**
     * returns next boundaryPoint
     *
     * @param {BoundaryPoint} point
     * @param {Boolean} isSkipInnerOffset
     * @return {BoundaryPoint}
     */
    function nextPoint(point, isSkipInnerOffset) {
        var node, offset;
        if (nodeLength(point.node) === point.offset) {
            if (isEditable(point.node)) {
                return null;
            }
            node = point.node.parentNode;
            offset = position(point.node) + 1;
        }
        else if (hasChildren(point.node)) {
            node = point.node.childNodes[point.offset];
            offset = 0;
        }
        else {
            node = point.node;
            offset = isSkipInnerOffset ? nodeLength(point.node) : point.offset + 1;
        }
        return {
            node: node,
            offset: offset
        };
    }
    /**
     * returns whether pointA and pointB is same or not.
     *
     * @param {BoundaryPoint} pointA
     * @param {BoundaryPoint} pointB
     * @return {Boolean}
     */
    function isSamePoint(pointA, pointB) {
        return pointA.node === pointB.node && pointA.offset === pointB.offset;
    }
    /**
     * returns whether point is visible (can set cursor) or not.
     *
     * @param {BoundaryPoint} point
     * @return {Boolean}
     */
    function isVisiblePoint(point) {
        if (isText(point.node) || !hasChildren(point.node) || isEmpty$1(point.node)) {
            return true;
        }
        var leftNode = point.node.childNodes[point.offset - 1];
        var rightNode = point.node.childNodes[point.offset];
        if ((!leftNode || isVoid(leftNode)) && (!rightNode || isVoid(rightNode))) {
            return true;
        }
        return false;
    }
    /**
     * @method prevPointUtil
     *
     * @param {BoundaryPoint} point
     * @param {Function} pred
     * @return {BoundaryPoint}
     */
    function prevPointUntil(point, pred) {
        while (point) {
            if (pred(point)) {
                return point;
            }
            point = prevPoint(point);
        }
        return null;
    }
    /**
     * @method nextPointUntil
     *
     * @param {BoundaryPoint} point
     * @param {Function} pred
     * @return {BoundaryPoint}
     */
    function nextPointUntil(point, pred) {
        while (point) {
            if (pred(point)) {
                return point;
            }
            point = nextPoint(point);
        }
        return null;
    }
    /**
     * returns whether point has character or not.
     *
     * @param {Point} point
     * @return {Boolean}
     */
    function isCharPoint(point) {
        if (!isText(point.node)) {
            return false;
        }
        var ch = point.node.nodeValue.charAt(point.offset - 1);
        return ch && (ch !== ' ' && ch !== NBSP_CHAR);
    }
    /**
     * @method walkPoint
     *
     * @param {BoundaryPoint} startPoint
     * @param {BoundaryPoint} endPoint
     * @param {Function} handler
     * @param {Boolean} isSkipInnerOffset
     */
    function walkPoint(startPoint, endPoint, handler, isSkipInnerOffset) {
        var point = startPoint;
        while (point) {
            handler(point);
            if (isSamePoint(point, endPoint)) {
                break;
            }
            var isSkipOffset = isSkipInnerOffset &&
                startPoint.node !== point.node &&
                endPoint.node !== point.node;
            point = nextPoint(point, isSkipOffset);
        }
    }
    /**
     * @method makeOffsetPath
     *
     * return offsetPath(array of offset) from ancestor
     *
     * @param {Node} ancestor - ancestor node
     * @param {Node} node
     */
    function makeOffsetPath(ancestor, node) {
        var ancestors = listAncestor(node, func.eq(ancestor));
        return ancestors.map(position).reverse();
    }
    /**
     * @method fromOffsetPath
     *
     * return element from offsetPath(array of offset)
     *
     * @param {Node} ancestor - ancestor node
     * @param {array} offsets - offsetPath
     */
    function fromOffsetPath(ancestor, offsets) {
        var current = ancestor;
        for (var i = 0, len = offsets.length; i < len; i++) {
            if (current.childNodes.length <= offsets[i]) {
                current = current.childNodes[current.childNodes.length - 1];
            }
            else {
                current = current.childNodes[offsets[i]];
            }
        }
        return current;
    }
    /**
     * @method splitNode
     *
     * split element or #text
     *
     * @param {BoundaryPoint} point
     * @param {Object} [options]
     * @param {Boolean} [options.isSkipPaddingBlankHTML] - default: false
     * @param {Boolean} [options.isNotSplitEdgePoint] - default: false
     * @param {Boolean} [options.isDiscardEmptySplits] - default: false
     * @return {Node} right node of boundaryPoint
     */
    function splitNode(point, options) {
        var isSkipPaddingBlankHTML = options && options.isSkipPaddingBlankHTML;
        var isNotSplitEdgePoint = options && options.isNotSplitEdgePoint;
        var isDiscardEmptySplits = options && options.isDiscardEmptySplits;
        if (isDiscardEmptySplits) {
            isSkipPaddingBlankHTML = true;
        }
        // edge case
        if (isEdgePoint(point) && (isText(point.node) || isNotSplitEdgePoint)) {
            if (isLeftEdgePoint(point)) {
                return point.node;
            }
            else if (isRightEdgePoint(point)) {
                return point.node.nextSibling;
            }
        }
        // split #text
        if (isText(point.node)) {
            return point.node.splitText(point.offset);
        }
        else {
            var childNode = point.node.childNodes[point.offset];
            var clone = insertAfter(point.node.cloneNode(false), point.node);
            appendChildNodes(clone, listNext(childNode));
            if (!isSkipPaddingBlankHTML) {
                paddingBlankHTML(point.node);
                paddingBlankHTML(clone);
            }
            if (isDiscardEmptySplits) {
                if (isEmpty$1(point.node)) {
                    remove(point.node);
                }
                if (isEmpty$1(clone)) {
                    remove(clone);
                    return point.node.nextSibling;
                }
            }
            return clone;
        }
    }
    /**
     * @method splitTree
     *
     * split tree by point
     *
     * @param {Node} root - split root
     * @param {BoundaryPoint} point
     * @param {Object} [options]
     * @param {Boolean} [options.isSkipPaddingBlankHTML] - default: false
     * @param {Boolean} [options.isNotSplitEdgePoint] - default: false
     * @return {Node} right node of boundaryPoint
     */
    function splitTree(root, point, options) {
        // ex) [#text, <span>, <p>]
        var ancestors = listAncestor(point.node, func.eq(root));
        if (!ancestors.length) {
            return null;
        }
        else if (ancestors.length === 1) {
            return splitNode(point, options);
        }
        return ancestors.reduce(function (node, parent) {
            if (node === point.node) {
                node = splitNode(point, options);
            }
            return splitNode({
                node: parent,
                offset: node ? position(node) : nodeLength(parent)
            }, options);
        });
    }
    /**
     * split point
     *
     * @param {Point} point
     * @param {Boolean} isInline
     * @return {Object}
     */
    function splitPoint(point, isInline) {
        // find splitRoot, container
        //  - inline: splitRoot is a child of paragraph
        //  - block: splitRoot is a child of bodyContainer
        var pred = isInline ? isPara : isBodyContainer;
        var ancestors = listAncestor(point.node, pred);
        var topAncestor = lists.last(ancestors) || point.node;
        var splitRoot, container;
        if (pred(topAncestor)) {
            splitRoot = ancestors[ancestors.length - 2];
            container = topAncestor;
        }
        else {
            splitRoot = topAncestor;
            container = splitRoot.parentNode;
        }
        // if splitRoot is exists, split with splitTree
        var pivot = splitRoot && splitTree(splitRoot, point, {
            isSkipPaddingBlankHTML: isInline,
            isNotSplitEdgePoint: isInline
        });
        // if container is point.node, find pivot with point.offset
        if (!pivot && container === point.node) {
            pivot = point.node.childNodes[point.offset];
        }
        return {
            rightNode: pivot,
            container: container
        };
    }
    function create(nodeName) {
        return document.createElement(nodeName);
    }
    function createText(text) {
        return document.createTextNode(text);
    }
    /**
     * @method remove
     *
     * remove node, (isRemoveChild: remove child or not)
     *
     * @param {Node} node
     * @param {Boolean} isRemoveChild
     */
    function remove(node, isRemoveChild) {
        if (!node || !node.parentNode) {
            return;
        }
        if (node.removeNode) {
            return node.removeNode(isRemoveChild);
        }
        var parent = node.parentNode;
        if (!isRemoveChild) {
            var nodes = [];
            for (var i = 0, len = node.childNodes.length; i < len; i++) {
                nodes.push(node.childNodes[i]);
            }
            for (var i = 0, len = nodes.length; i < len; i++) {
                parent.insertBefore(nodes[i], node);
            }
        }
        parent.removeChild(node);
    }
    /**
     * @method removeWhile
     *
     * @param {Node} node
     * @param {Function} pred
     */
    function removeWhile(node, pred) {
        while (node) {
            if (isEditable(node) || !pred(node)) {
                break;
            }
            var parent = node.parentNode;
            remove(node);
            node = parent;
        }
    }
    /**
     * @method replace
     *
     * replace node with provided nodeName
     *
     * @param {Node} node
     * @param {String} nodeName
     * @return {Node} - new node
     */
    function replace(node, nodeName) {
        if (node.nodeName.toUpperCase() === nodeName.toUpperCase()) {
            return node;
        }
        var newNode = create(nodeName);
        if (node.style.cssText) {
            newNode.style.cssText = node.style.cssText;
        }
        appendChildNodes(newNode, lists.from(node.childNodes));
        insertAfter(newNode, node);
        remove(node);
        return newNode;
    }
    var isTextarea = makePredByNodeName('TEXTAREA');
    /**
     * @param {jQuery} $node
     * @param {Boolean} [stripLinebreaks] - default: false
     */
    function value($node, stripLinebreaks) {
        var val = isTextarea($node[0]) ? $node.val() : $node.html();
        if (stripLinebreaks) {
            return val.replace(/[\n\r]/g, '');
        }
        return val;
    }
    /**
     * @method html
     *
     * get the HTML contents of node
     *
     * @param {jQuery} $node
     * @param {Boolean} [isNewlineOnBlock]
     */
    function html($node, isNewlineOnBlock) {
        var markup = value($node);
        if (isNewlineOnBlock) {
            var regexTag = /<(\/?)(\b(?!!)[^>\s]*)(.*?)(\s*\/?>)/g;
            markup = markup.replace(regexTag, function (match, endSlash, name) {
                name = name.toUpperCase();
                var isEndOfInlineContainer = /^DIV|^TD|^TH|^P|^LI|^H[1-7]/.test(name) &&
                    !!endSlash;
                var isBlockNode = /^BLOCKQUOTE|^TABLE|^TBODY|^TR|^HR|^UL|^OL/.test(name);
                return match + ((isEndOfInlineContainer || isBlockNode) ? '\n' : '');
            });
            markup = markup.trim();
        }
        return markup;
    }
    function posFromPlaceholder(placeholder) {
        var $placeholder = $$1(placeholder);
        var pos = $placeholder.offset();
        var height = $placeholder.outerHeight(true); // include margin
        return {
            left: pos.left,
            top: pos.top + height
        };
    }
    function attachEvents($node, events) {
        Object.keys(events).forEach(function (key) {
            $node.on(key, events[key]);
        });
    }
    function detachEvents($node, events) {
        Object.keys(events).forEach(function (key) {
            $node.off(key, events[key]);
        });
    }
    /**
     * @method isCustomStyleTag
     *
     * assert if a node contains a "note-styletag" class,
     * which implies that's a custom-made style tag node
     *
     * @param {Node} an HTML DOM node
     */
    function isCustomStyleTag(node) {
        return node && !isText(node) && lists.contains(node.classList, 'note-styletag');
    }
    var dom = {
        /** @property {String} NBSP_CHAR */
        NBSP_CHAR: NBSP_CHAR,
        /** @property {String} ZERO_WIDTH_NBSP_CHAR */
        ZERO_WIDTH_NBSP_CHAR: ZERO_WIDTH_NBSP_CHAR,
        /** @property {String} blank */
        blank: blankHTML,
        /** @property {String} emptyPara */
        emptyPara: "<p>" + blankHTML + "</p>",
        makePredByNodeName: makePredByNodeName,
        isEditable: isEditable,
        isControlSizing: isControlSizing,
        isText: isText,
        isElement: isElement,
        isVoid: isVoid,
        isPara: isPara,
        isPurePara: isPurePara,
        isHeading: isHeading,
        isInline: isInline,
        isBlock: func.not(isInline),
        isBodyInline: isBodyInline,
        isBody: isBody,
        isParaInline: isParaInline,
        isPre: isPre,
        isList: isList,
        isTable: isTable,
        isData: isData,
        isCell: isCell,
        isBlockquote: isBlockquote,
        isBodyContainer: isBodyContainer,
        isAnchor: isAnchor,
        isDiv: makePredByNodeName('DIV'),
        isLi: isLi,
        isBR: makePredByNodeName('BR'),
        isSpan: makePredByNodeName('SPAN'),
        isB: makePredByNodeName('B'),
        isU: makePredByNodeName('U'),
        isS: makePredByNodeName('S'),
        isI: makePredByNodeName('I'),
        isImg: makePredByNodeName('IMG'),
        isTextarea: isTextarea,
        isEmpty: isEmpty$1,
        isEmptyAnchor: func.and(isAnchor, isEmpty$1),
        isClosestSibling: isClosestSibling,
        withClosestSiblings: withClosestSiblings,
        nodeLength: nodeLength,
        isLeftEdgePoint: isLeftEdgePoint,
        isRightEdgePoint: isRightEdgePoint,
        isEdgePoint: isEdgePoint,
        isLeftEdgeOf: isLeftEdgeOf,
        isRightEdgeOf: isRightEdgeOf,
        isLeftEdgePointOf: isLeftEdgePointOf,
        isRightEdgePointOf: isRightEdgePointOf,
        prevPoint: prevPoint,
        nextPoint: nextPoint,
        isSamePoint: isSamePoint,
        isVisiblePoint: isVisiblePoint,
        prevPointUntil: prevPointUntil,
        nextPointUntil: nextPointUntil,
        isCharPoint: isCharPoint,
        walkPoint: walkPoint,
        ancestor: ancestor,
        singleChildAncestor: singleChildAncestor,
        listAncestor: listAncestor,
        lastAncestor: lastAncestor,
        listNext: listNext,
        listPrev: listPrev,
        listDescendant: listDescendant,
        commonAncestor: commonAncestor,
        wrap: wrap,
        insertAfter: insertAfter,
        appendChildNodes: appendChildNodes,
        position: position,
        hasChildren: hasChildren,
        makeOffsetPath: makeOffsetPath,
        fromOffsetPath: fromOffsetPath,
        splitTree: splitTree,
        splitPoint: splitPoint,
        create: create,
        createText: createText,
        remove: remove,
        removeWhile: removeWhile,
        replace: replace,
        html: html,
        value: value,
        posFromPlaceholder: posFromPlaceholder,
        attachEvents: attachEvents,
        detachEvents: detachEvents,
        isCustomStyleTag: isCustomStyleTag
    };

    var Context = /** @class */ (function () {
        /**
         * @param {jQuery} $note
         * @param {Object} options
         */
        function Context($note, options) {
            this.ui = $$1.summernote.ui;
            this.$note = $note;
            this.memos = {};
            this.modules = {};
            this.layoutInfo = {};
            this.options = options;
            this.initialize();
        }
        /**
         * create layout and initialize modules and other resources
         */
        Context.prototype.initialize = function () {
            this.layoutInfo = this.ui.createLayout(this.$note, this.options);
            this._initialize();
            this.$note.hide();
            return this;
        };
        /**
         * destroy modules and other resources and remove layout
         */
        Context.prototype.destroy = function () {
            this._destroy();
            this.$note.removeData('summernote');
            this.ui.removeLayout(this.$note, this.layoutInfo);
        };
        /**
         * destory modules and other resources and initialize it again
         */
        Context.prototype.reset = function () {
            var disabled = this.isDisabled();
            this.code(dom.emptyPara);
            this._destroy();
            this._initialize();
            if (disabled) {
                this.disable();
            }
        };
        Context.prototype._initialize = function () {
            var _this = this;
            // add optional buttons
            var buttons = $$1.extend({}, this.options.buttons);
            Object.keys(buttons).forEach(function (key) {
                _this.memo('button.' + key, buttons[key]);
            });
            var modules = $$1.extend({}, this.options.modules, $$1.summernote.plugins || {});
            // add and initialize modules
            Object.keys(modules).forEach(function (key) {
                _this.module(key, modules[key], true);
            });
            Object.keys(this.modules).forEach(function (key) {
                _this.initializeModule(key);
            });
        };
        Context.prototype._destroy = function () {
            var _this = this;
            // destroy modules with reversed order
            Object.keys(this.modules).reverse().forEach(function (key) {
                _this.removeModule(key);
            });
            Object.keys(this.memos).forEach(function (key) {
                _this.removeMemo(key);
            });
            // trigger custom onDestroy callback
            this.triggerEvent('destroy', this);
        };
        Context.prototype.code = function (html) {
            var isActivated = this.invoke('codeview.isActivated');
            if (html === undefined) {
                this.invoke('codeview.sync');
                return isActivated ? this.layoutInfo.codable.val() : this.layoutInfo.editable.html();
            }
            else {
                if (isActivated) {
                    this.layoutInfo.codable.val(html);
                }
                else {
                    this.layoutInfo.editable.html(html);
                }
                this.$note.val(html);
                this.triggerEvent('change', html, this.layoutInfo.editable);
            }
        };
        Context.prototype.isDisabled = function () {
            return this.layoutInfo.editable.attr('contenteditable') === 'false';
        };
        Context.prototype.enable = function () {
            this.layoutInfo.editable.attr('contenteditable', true);
            this.invoke('toolbar.activate', true);
            this.triggerEvent('disable', false);
        };
        Context.prototype.disable = function () {
            // close codeview if codeview is opend
            if (this.invoke('codeview.isActivated')) {
                this.invoke('codeview.deactivate');
            }
            this.layoutInfo.editable.attr('contenteditable', false);
            this.invoke('toolbar.deactivate', true);
            this.triggerEvent('disable', true);
        };
        Context.prototype.triggerEvent = function () {
            var namespace = lists.head(arguments);
            var args = lists.tail(lists.from(arguments));
            var callback = this.options.callbacks[func.namespaceToCamel(namespace, 'on')];
            if (callback) {
                callback.apply(this.$note[0], args);
            }
            this.$note.trigger('summernote.' + namespace, args);
        };
        Context.prototype.initializeModule = function (key) {
            var module = this.modules[key];
            module.shouldInitialize = module.shouldInitialize || func.ok;
            if (!module.shouldInitialize()) {
                return;
            }
            // initialize module
            if (module.initialize) {
                module.initialize();
            }
            // attach events
            if (module.events) {
                dom.attachEvents(this.$note, module.events);
            }
        };
        Context.prototype.module = function (key, ModuleClass, withoutIntialize) {
            if (arguments.length === 1) {
                return this.modules[key];
            }
            this.modules[key] = new ModuleClass(this);
            if (!withoutIntialize) {
                this.initializeModule(key);
            }
        };
        Context.prototype.removeModule = function (key) {
            var module = this.modules[key];
            if (module.shouldInitialize()) {
                if (module.events) {
                    dom.detachEvents(this.$note, module.events);
                }
                if (module.destroy) {
                    module.destroy();
                }
            }
            delete this.modules[key];
        };
        Context.prototype.memo = function (key, obj) {
            if (arguments.length === 1) {
                return this.memos[key];
            }
            this.memos[key] = obj;
        };
        Context.prototype.removeMemo = function (key) {
            if (this.memos[key] && this.memos[key].destroy) {
                this.memos[key].destroy();
            }
            delete this.memos[key];
        };
        /**
         * Some buttons need to change their visual style immediately once they get pressed
         */
        Context.prototype.createInvokeHandlerAndUpdateState = function (namespace, value) {
            var _this = this;
            return function (event) {
                _this.createInvokeHandler(namespace, value)(event);
                _this.invoke('buttons.updateCurrentStyle');
            };
        };
        Context.prototype.createInvokeHandler = function (namespace, value) {
            var _this = this;
            return function (event) {
                event.preventDefault();
                var $target = $$1(event.target);
                _this.invoke(namespace, value || $target.closest('[data-value]').data('value'), $target);
            };
        };
        Context.prototype.invoke = function () {
            var namespace = lists.head(arguments);
            var args = lists.tail(lists.from(arguments));
            var splits = namespace.split('.');
            var hasSeparator = splits.length > 1;
            var moduleName = hasSeparator && lists.head(splits);
            var methodName = hasSeparator ? lists.last(splits) : lists.head(splits);
            var module = this.modules[moduleName || 'editor'];
            if (!moduleName && this[methodName]) {
                return this[methodName].apply(this, args);
            }
            else if (module && module[methodName] && module.shouldInitialize()) {
                return module[methodName].apply(module, args);
            }
        };
        return Context;
    }());

    $$1.fn.extend({
        /**
         * Summernote API
         *
         * @param {Object|String}
         * @return {this}
         */
        summernote: function () {
            var type = $$1.type(lists.head(arguments));
            var isExternalAPICalled = type === 'string';
            var hasInitOptions = type === 'object';
            var options = $$1.extend({}, $$1.summernote.options, hasInitOptions ? lists.head(arguments) : {});
            // Update options
            options.langInfo = $$1.extend(true, {}, $$1.summernote.lang['en-US'], $$1.summernote.lang[options.lang]);
            options.icons = $$1.extend(true, {}, $$1.summernote.options.icons, options.icons);
            options.tooltip = options.tooltip === 'auto' ? !env.isSupportTouch : options.tooltip;
            this.each(function (idx, note) {
                var $note = $$1(note);
                if (!$note.data('summernote')) {
                    var context = new Context($note, options);
                    $note.data('summernote', context);
                    $note.data('summernote').triggerEvent('init', context.layoutInfo);
                }
            });
            var $note = this.first();
            if ($note.length) {
                var context = $note.data('summernote');
                if (isExternalAPICalled) {
                    return context.invoke.apply(context, lists.from(arguments));
                }
                else if (options.focus) {
                    context.invoke('editor.focus');
                }
            }
            return this;
        }
    });

    /**
     * return boundaryPoint from TextRange, inspired by Andy Na's HuskyRange.js
     *
     * @param {TextRange} textRange
     * @param {Boolean} isStart
     * @return {BoundaryPoint}
     *
     * @see http://msdn.microsoft.com/en-us/library/ie/ms535872(v=vs.85).aspx
     */
    function textRangeToPoint(textRange, isStart) {
        var container = textRange.parentElement();
        var offset;
        var tester = document.body.createTextRange();
        var prevContainer;
        var childNodes = lists.from(container.childNodes);
        for (offset = 0; offset < childNodes.length; offset++) {
            if (dom.isText(childNodes[offset])) {
                continue;
            }
            tester.moveToElementText(childNodes[offset]);
            if (tester.compareEndPoints('StartToStart', textRange) >= 0) {
                break;
            }
            prevContainer = childNodes[offset];
        }
        if (offset !== 0 && dom.isText(childNodes[offset - 1])) {
            var textRangeStart = document.body.createTextRange();
            var curTextNode = null;
            textRangeStart.moveToElementText(prevContainer || container);
            textRangeStart.collapse(!prevContainer);
            curTextNode = prevContainer ? prevContainer.nextSibling : container.firstChild;
            var pointTester = textRange.duplicate();
            pointTester.setEndPoint('StartToStart', textRangeStart);
            var textCount = pointTester.text.replace(/[\r\n]/g, '').length;
            while (textCount > curTextNode.nodeValue.length && curTextNode.nextSibling) {
                textCount -= curTextNode.nodeValue.length;
                curTextNode = curTextNode.nextSibling;
            }
            // [workaround] enforce IE to re-reference curTextNode, hack
            var dummy = curTextNode.nodeValue; // eslint-disable-line
            if (isStart && curTextNode.nextSibling && dom.isText(curTextNode.nextSibling) &&
                textCount === curTextNode.nodeValue.length) {
                textCount -= curTextNode.nodeValue.length;
                curTextNode = curTextNode.nextSibling;
            }
            container = curTextNode;
            offset = textCount;
        }
        return {
            cont: container,
            offset: offset
        };
    }
    /**
     * return TextRange from boundary point (inspired by google closure-library)
     * @param {BoundaryPoint} point
     * @return {TextRange}
     */
    function pointToTextRange(point) {
        var textRangeInfo = function (container, offset) {
            var node, isCollapseToStart;
            if (dom.isText(container)) {
                var prevTextNodes = dom.listPrev(container, func.not(dom.isText));
                var prevContainer = lists.last(prevTextNodes).previousSibling;
                node = prevContainer || container.parentNode;
                offset += lists.sum(lists.tail(prevTextNodes), dom.nodeLength);
                isCollapseToStart = !prevContainer;
            }
            else {
                node = container.childNodes[offset] || container;
                if (dom.isText(node)) {
                    return textRangeInfo(node, 0);
                }
                offset = 0;
                isCollapseToStart = false;
            }
            return {
                node: node,
                collapseToStart: isCollapseToStart,
                offset: offset
            };
        };
        var textRange = document.body.createTextRange();
        var info = textRangeInfo(point.node, point.offset);
        textRange.moveToElementText(info.node);
        textRange.collapse(info.collapseToStart);
        textRange.moveStart('character', info.offset);
        return textRange;
    }
    /**
     * Wrapped Range
     *
     * @constructor
     * @param {Node} sc - start container
     * @param {Number} so - start offset
     * @param {Node} ec - end container
     * @param {Number} eo - end offset
     */
    var WrappedRange = /** @class */ (function () {
        function WrappedRange(sc, so, ec, eo) {
            this.sc = sc;
            this.so = so;
            this.ec = ec;
            this.eo = eo;
            // isOnEditable: judge whether range is on editable or not
            this.isOnEditable = this.makeIsOn(dom.isEditable);
            // isOnList: judge whether range is on list node or not
            this.isOnList = this.makeIsOn(dom.isList);
            // isOnAnchor: judge whether range is on anchor node or not
            this.isOnAnchor = this.makeIsOn(dom.isAnchor);
            // isOnCell: judge whether range is on cell node or not
            this.isOnCell = this.makeIsOn(dom.isCell);
            // isOnData: judge whether range is on data node or not
            this.isOnData = this.makeIsOn(dom.isData);
        }
        // nativeRange: get nativeRange from sc, so, ec, eo
        WrappedRange.prototype.nativeRange = function () {
            if (env.isW3CRangeSupport) {
                var w3cRange = document.createRange();
                w3cRange.setStart(this.sc, this.sc.data && this.so > this.sc.data.length ? 0 : this.so);
                w3cRange.setEnd(this.ec, this.sc.data ? Math.min(this.eo, this.sc.data.length) : this.eo);
                return w3cRange;
            }
            else {
                var textRange = pointToTextRange({
                    node: this.sc,
                    offset: this.so
                });
                textRange.setEndPoint('EndToEnd', pointToTextRange({
                    node: this.ec,
                    offset: this.eo
                }));
                return textRange;
            }
        };
        WrappedRange.prototype.getPoints = function () {
            return {
                sc: this.sc,
                so: this.so,
                ec: this.ec,
                eo: this.eo
            };
        };
        WrappedRange.prototype.getStartPoint = function () {
            return {
                node: this.sc,
                offset: this.so
            };
        };
        WrappedRange.prototype.getEndPoint = function () {
            return {
                node: this.ec,
                offset: this.eo
            };
        };
        /**
         * select update visible range
         */
        WrappedRange.prototype.select = function () {
            var nativeRng = this.nativeRange();
            if (env.isW3CRangeSupport) {
                var selection = document.getSelection();
                if (selection.rangeCount > 0) {
                    selection.removeAllRanges();
                }
                selection.addRange(nativeRng);
            }
            else {
                nativeRng.select();
            }
            return this;
        };
        /**
         * Moves the scrollbar to start container(sc) of current range
         *
         * @return {WrappedRange}
         */
        WrappedRange.prototype.scrollIntoView = function (container) {
            var height = $$1(container).height();
            if (container.scrollTop + height < this.sc.offsetTop) {
                container.scrollTop += Math.abs(container.scrollTop + height - this.sc.offsetTop);
            }
            return this;
        };
        /**
         * @return {WrappedRange}
         */
        WrappedRange.prototype.normalize = function () {
            /**
             * @param {BoundaryPoint} point
             * @param {Boolean} isLeftToRight - true: prefer to choose right node
             *                                - false: prefer to choose left node
             * @return {BoundaryPoint}
             */
            var getVisiblePoint = function (point, isLeftToRight) {
                // Just use the given point [XXX:Adhoc]
                //  - case 01. if the point is on the middle of the node
                //  - case 02. if the point is on the right edge and prefer to choose left node
                //  - case 03. if the point is on the left edge and prefer to choose right node
                //  - case 04. if the point is on the right edge and prefer to choose right node but the node is void
                //  - case 05. if the point is on the left edge and prefer to choose left node but the node is void
                //  - case 06. if the point is on the block node and there is no children
                if (dom.isVisiblePoint(point)) {
                    if (!dom.isEdgePoint(point) ||
                        (dom.isRightEdgePoint(point) && !isLeftToRight) ||
                        (dom.isLeftEdgePoint(point) && isLeftToRight) ||
                        (dom.isRightEdgePoint(point) && isLeftToRight && dom.isVoid(point.node.nextSibling)) ||
                        (dom.isLeftEdgePoint(point) && !isLeftToRight && dom.isVoid(point.node.previousSibling)) ||
                        (dom.isBlock(point.node) && dom.isEmpty(point.node))) {
                        return point;
                    }
                }
                // point on block's edge
                var block = dom.ancestor(point.node, dom.isBlock);
                if (((dom.isLeftEdgePointOf(point, block) || dom.isVoid(dom.prevPoint(point).node)) && !isLeftToRight) ||
                    ((dom.isRightEdgePointOf(point, block) || dom.isVoid(dom.nextPoint(point).node)) && isLeftToRight)) {
                    // returns point already on visible point
                    if (dom.isVisiblePoint(point)) {
                        return point;
                    }
                    // reverse direction
                    isLeftToRight = !isLeftToRight;
                }
                var nextPoint = isLeftToRight ? dom.nextPointUntil(dom.nextPoint(point), dom.isVisiblePoint)
                    : dom.prevPointUntil(dom.prevPoint(point), dom.isVisiblePoint);
                return nextPoint || point;
            };
            var endPoint = getVisiblePoint(this.getEndPoint(), false);
            var startPoint = this.isCollapsed() ? endPoint : getVisiblePoint(this.getStartPoint(), true);
            return new WrappedRange(startPoint.node, startPoint.offset, endPoint.node, endPoint.offset);
        };
        /**
         * returns matched nodes on range
         *
         * @param {Function} [pred] - predicate function
         * @param {Object} [options]
         * @param {Boolean} [options.includeAncestor]
         * @param {Boolean} [options.fullyContains]
         * @return {Node[]}
         */
        WrappedRange.prototype.nodes = function (pred, options) {
            pred = pred || func.ok;
            var includeAncestor = options && options.includeAncestor;
            var fullyContains = options && options.fullyContains;
            // TODO compare points and sort
            var startPoint = this.getStartPoint();
            var endPoint = this.getEndPoint();
            var nodes = [];
            var leftEdgeNodes = [];
            dom.walkPoint(startPoint, endPoint, function (point) {
                if (dom.isEditable(point.node)) {
                    return;
                }
                var node;
                if (fullyContains) {
                    if (dom.isLeftEdgePoint(point)) {
                        leftEdgeNodes.push(point.node);
                    }
                    if (dom.isRightEdgePoint(point) && lists.contains(leftEdgeNodes, point.node)) {
                        node = point.node;
                    }
                }
                else if (includeAncestor) {
                    node = dom.ancestor(point.node, pred);
                }
                else {
                    node = point.node;
                }
                if (node && pred(node)) {
                    nodes.push(node);
                }
            }, true);
            return lists.unique(nodes);
        };
        /**
         * returns commonAncestor of range
         * @return {Element} - commonAncestor
         */
        WrappedRange.prototype.commonAncestor = function () {
            return dom.commonAncestor(this.sc, this.ec);
        };
        /**
         * returns expanded range by pred
         *
         * @param {Function} pred - predicate function
         * @return {WrappedRange}
         */
        WrappedRange.prototype.expand = function (pred) {
            var startAncestor = dom.ancestor(this.sc, pred);
            var endAncestor = dom.ancestor(this.ec, pred);
            if (!startAncestor && !endAncestor) {
                return new WrappedRange(this.sc, this.so, this.ec, this.eo);
            }
            var boundaryPoints = this.getPoints();
            if (startAncestor) {
                boundaryPoints.sc = startAncestor;
                boundaryPoints.so = 0;
            }
            if (endAncestor) {
                boundaryPoints.ec = endAncestor;
                boundaryPoints.eo = dom.nodeLength(endAncestor);
            }
            return new WrappedRange(boundaryPoints.sc, boundaryPoints.so, boundaryPoints.ec, boundaryPoints.eo);
        };
        /**
         * @param {Boolean} isCollapseToStart
         * @return {WrappedRange}
         */
        WrappedRange.prototype.collapse = function (isCollapseToStart) {
            if (isCollapseToStart) {
                return new WrappedRange(this.sc, this.so, this.sc, this.so);
            }
            else {
                return new WrappedRange(this.ec, this.eo, this.ec, this.eo);
            }
        };
        /**
         * splitText on range
         */
        WrappedRange.prototype.splitText = function () {
            var isSameContainer = this.sc === this.ec;
            var boundaryPoints = this.getPoints();
            if (dom.isText(this.ec) && !dom.isEdgePoint(this.getEndPoint())) {
                this.ec.splitText(this.eo);
            }
            if (dom.isText(this.sc) && !dom.isEdgePoint(this.getStartPoint())) {
                boundaryPoints.sc = this.sc.splitText(this.so);
                boundaryPoints.so = 0;
                if (isSameContainer) {
                    boundaryPoints.ec = boundaryPoints.sc;
                    boundaryPoints.eo = this.eo - this.so;
                }
            }
            return new WrappedRange(boundaryPoints.sc, boundaryPoints.so, boundaryPoints.ec, boundaryPoints.eo);
        };
        /**
         * delete contents on range
         * @return {WrappedRange}
         */
        WrappedRange.prototype.deleteContents = function () {
            if (this.isCollapsed()) {
                return this;
            }
            var rng = this.splitText();
            var nodes = rng.nodes(null, {
                fullyContains: true
            });
            // find new cursor point
            var point = dom.prevPointUntil(rng.getStartPoint(), function (point) {
                return !lists.contains(nodes, point.node);
            });
            var emptyParents = [];
            $$1.each(nodes, function (idx, node) {
                // find empty parents
                var parent = node.parentNode;
                if (point.node !== parent && dom.nodeLength(parent) === 1) {
                    emptyParents.push(parent);
                }
                dom.remove(node, false);
            });
            // remove empty parents
            $$1.each(emptyParents, function (idx, node) {
                dom.remove(node, false);
            });
            return new WrappedRange(point.node, point.offset, point.node, point.offset).normalize();
        };
        /**
         * makeIsOn: return isOn(pred) function
         */
        WrappedRange.prototype.makeIsOn = function (pred) {
            return function () {
                var ancestor = dom.ancestor(this.sc, pred);
                return !!ancestor && (ancestor === dom.ancestor(this.ec, pred));
            };
        };
        /**
         * @param {Function} pred
         * @return {Boolean}
         */
        WrappedRange.prototype.isLeftEdgeOf = function (pred) {
            if (!dom.isLeftEdgePoint(this.getStartPoint())) {
                return false;
            }
            var node = dom.ancestor(this.sc, pred);
            return node && dom.isLeftEdgeOf(this.sc, node);
        };
        /**
         * returns whether range was collapsed or not
         */
        WrappedRange.prototype.isCollapsed = function () {
            return this.sc === this.ec && this.so === this.eo;
        };
        /**
         * wrap inline nodes which children of body with paragraph
         *
         * @return {WrappedRange}
         */
        WrappedRange.prototype.wrapBodyInlineWithPara = function () {
            if (dom.isBodyContainer(this.sc) && dom.isEmpty(this.sc)) {
                this.sc.innerHTML = dom.emptyPara;
                return new WrappedRange(this.sc.firstChild, 0, this.sc.firstChild, 0);
            }
            /**
             * [workaround] firefox often create range on not visible point. so normalize here.
             *  - firefox: |<p>text</p>|
             *  - chrome: <p>|text|</p>
             */
            var rng = this.normalize();
            if (dom.isParaInline(this.sc) || dom.isPara(this.sc)) {
                return rng;
            }
            // find inline top ancestor
            var topAncestor;
            if (dom.isInline(rng.sc)) {
                var ancestors = dom.listAncestor(rng.sc, func.not(dom.isInline));
                topAncestor = lists.last(ancestors);
                if (!dom.isInline(topAncestor)) {
                    topAncestor = ancestors[ancestors.length - 2] || rng.sc.childNodes[rng.so];
                }
            }
            else {
                topAncestor = rng.sc.childNodes[rng.so > 0 ? rng.so - 1 : 0];
            }
            // siblings not in paragraph
            var inlineSiblings = dom.listPrev(topAncestor, dom.isParaInline).reverse();
            inlineSiblings = inlineSiblings.concat(dom.listNext(topAncestor.nextSibling, dom.isParaInline));
            // wrap with paragraph
            if (inlineSiblings.length) {
                var para = dom.wrap(lists.head(inlineSiblings), 'p');
                dom.appendChildNodes(para, lists.tail(inlineSiblings));
            }
            return this.normalize();
        };
        /**
         * insert node at current cursor
         *
         * @param {Node} node
         * @return {Node}
         */
        WrappedRange.prototype.insertNode = function (node) {
            var rng = this.wrapBodyInlineWithPara().deleteContents();
            var info = dom.splitPoint(rng.getStartPoint(), dom.isInline(node));
            if (info.rightNode) {
                info.rightNode.parentNode.insertBefore(node, info.rightNode);
            }
            else {
                info.container.appendChild(node);
            }
            return node;
        };
        /**
         * insert html at current cursor
         */
        WrappedRange.prototype.pasteHTML = function (markup) {
            var contentsContainer = $$1('<div></div>').html(markup)[0];
            var childNodes = lists.from(contentsContainer.childNodes);
            var rng = this.wrapBodyInlineWithPara().deleteContents();
            if (rng.so > 0) {
                childNodes = childNodes.reverse();
            }
            childNodes = childNodes.map(function (childNode) {
                return rng.insertNode(childNode);
            });
            if (rng.so > 0) {
                childNodes = childNodes.reverse();
            }
            return childNodes;
        };
        /**
         * returns text in range
         *
         * @return {String}
         */
        WrappedRange.prototype.toString = function () {
            var nativeRng = this.nativeRange();
            return env.isW3CRangeSupport ? nativeRng.toString() : nativeRng.text;
        };
        /**
         * returns range for word before cursor
         *
         * @param {Boolean} [findAfter] - find after cursor, default: false
         * @return {WrappedRange}
         */
        WrappedRange.prototype.getWordRange = function (findAfter) {
            var endPoint = this.getEndPoint();
            if (!dom.isCharPoint(endPoint)) {
                return this;
            }
            var startPoint = dom.prevPointUntil(endPoint, function (point) {
                return !dom.isCharPoint(point);
            });
            /*if(this.isOnAnchor()){
                startPoint.offset = 0;
            }*/
            if (findAfter) {
                endPoint = dom.nextPointUntil(endPoint, function (point) {
                    return !dom.isCharPoint(point);
                });
            }
            return new WrappedRange(startPoint.node, startPoint.offset, endPoint.node, endPoint.offset);
        };
        /**
         * create offsetPath bookmark
         *
         * @param {Node} editable
         */
        WrappedRange.prototype.bookmark = function (editable) {
            return {
                s: {
                    path: dom.makeOffsetPath(editable, this.sc),
                    offset: this.so
                },
                e: {
                    path: dom.makeOffsetPath(editable, this.ec),
                    offset: this.eo
                }
            };
        };
        /**
         * create offsetPath bookmark base on paragraph
         *
         * @param {Node[]} paras
         */
        WrappedRange.prototype.paraBookmark = function (paras) {
            return {
                s: {
                    path: lists.tail(dom.makeOffsetPath(lists.head(paras), this.sc)),
                    offset: this.so
                },
                e: {
                    path: lists.tail(dom.makeOffsetPath(lists.last(paras), this.ec)),
                    offset: this.eo
                }
            };
        };
        /**
         * getClientRects
         * @return {Rect[]}
         */
        WrappedRange.prototype.getClientRects = function () {
            var nativeRng = this.nativeRange();
            return nativeRng.getClientRects();
        };
        return WrappedRange;
    }());
    /**
     * Data structure
     *  * BoundaryPoint: a point of dom tree
     *  * BoundaryPoints: two boundaryPoints corresponding to the start and the end of the Range
     *
     * See to http://www.w3.org/TR/DOM-Level-2-Traversal-Range/ranges.html#Level-2-Range-Position
     */
    var range = {
        /**
         * create Range Object From arguments or Browser Selection
         *
         * @param {Node} sc - start container
         * @param {Number} so - start offset
         * @param {Node} ec - end container
         * @param {Number} eo - end offset
         * @return {WrappedRange}
         */
        create: function (sc, so, ec, eo) {
            if (arguments.length === 4) {
                return new WrappedRange(sc, so, ec, eo);
            }
            else if (arguments.length === 2) { // collapsed
                ec = sc;
                eo = so;
                return new WrappedRange(sc, so, ec, eo);
            }
            else {
                var wrappedRange = this.createFromSelection();
                if (!wrappedRange && arguments.length === 1) {
                    wrappedRange = this.createFromNode(arguments[0]);
                    return wrappedRange.collapse(dom.emptyPara === arguments[0].innerHTML);
                }
                return wrappedRange;
            }
        },
        createFromSelection: function () {
            var sc, so, ec, eo;
            if (env.isW3CRangeSupport) {
                var selection = document.getSelection();
                if (!selection || selection.rangeCount === 0) {
                    return null;
                }
                else if (dom.isBody(selection.anchorNode)) {
                    // Firefox: returns entire body as range on initialization.
                    // We won't never need it.
                    return null;
                }
                var nativeRng = selection.getRangeAt(0);
                sc = nativeRng.startContainer;
                so = nativeRng.startOffset;
                ec = nativeRng.endContainer;
                eo = nativeRng.endOffset;
            }
            else { // IE8: TextRange
                var textRange = document.selection.createRange();
                var textRangeEnd = textRange.duplicate();
                textRangeEnd.collapse(false);
                var textRangeStart = textRange;
                textRangeStart.collapse(true);
                var startPoint = textRangeToPoint(textRangeStart, true);
                var endPoint = textRangeToPoint(textRangeEnd, false);
                // same visible point case: range was collapsed.
                if (dom.isText(startPoint.node) && dom.isLeftEdgePoint(startPoint) &&
                    dom.isTextNode(endPoint.node) && dom.isRightEdgePoint(endPoint) &&
                    endPoint.node.nextSibling === startPoint.node) {
                    startPoint = endPoint;
                }
                sc = startPoint.cont;
                so = startPoint.offset;
                ec = endPoint.cont;
                eo = endPoint.offset;
            }
            return new WrappedRange(sc, so, ec, eo);
        },
        /**
         * @method
         *
         * create WrappedRange from node
         *
         * @param {Node} node
         * @return {WrappedRange}
         */
        createFromNode: function (node) {
            var sc = node;
            var so = 0;
            var ec = node;
            var eo = dom.nodeLength(ec);
            // browsers can't target a picture or void node
            if (dom.isVoid(sc)) {
                so = dom.listPrev(sc).length - 1;
                sc = sc.parentNode;
            }
            if (dom.isBR(ec)) {
                eo = dom.listPrev(ec).length - 1;
                ec = ec.parentNode;
            }
            else if (dom.isVoid(ec)) {
                eo = dom.listPrev(ec).length;
                ec = ec.parentNode;
            }
            return this.create(sc, so, ec, eo);
        },
        /**
         * create WrappedRange from node after position
         *
         * @param {Node} node
         * @return {WrappedRange}
         */
        createFromNodeBefore: function (node) {
            return this.createFromNode(node).collapse(true);
        },
        /**
         * create WrappedRange from node after position
         *
         * @param {Node} node
         * @return {WrappedRange}
         */
        createFromNodeAfter: function (node) {
            return this.createFromNode(node).collapse();
        },
        /**
         * @method
         *
         * create WrappedRange from bookmark
         *
         * @param {Node} editable
         * @param {Object} bookmark
         * @return {WrappedRange}
         */
        createFromBookmark: function (editable, bookmark) {
            var sc = dom.fromOffsetPath(editable, bookmark.s.path);
            var so = bookmark.s.offset;
            var ec = dom.fromOffsetPath(editable, bookmark.e.path);
            var eo = bookmark.e.offset;
            return new WrappedRange(sc, so, ec, eo);
        },
        /**
         * @method
         *
         * create WrappedRange from paraBookmark
         *
         * @param {Object} bookmark
         * @param {Node[]} paras
         * @return {WrappedRange}
         */
        createFromParaBookmark: function (bookmark, paras) {
            var so = bookmark.s.offset;
            var eo = bookmark.e.offset;
            var sc = dom.fromOffsetPath(lists.head(paras), bookmark.s.path);
            var ec = dom.fromOffsetPath(lists.last(paras), bookmark.e.path);
            return new WrappedRange(sc, so, ec, eo);
        }
    };

    var KEY_MAP = {
        'BACKSPACE': 8,
        'TAB': 9,
        'ENTER': 13,
        'SPACE': 32,
        'DELETE': 46,
        // Arrow
        'LEFT': 37,
        'UP': 38,
        'RIGHT': 39,
        'DOWN': 40,
        // Number: 0-9
        'NUM0': 48,
        'NUM1': 49,
        'NUM2': 50,
        'NUM3': 51,
        'NUM4': 52,
        'NUM5': 53,
        'NUM6': 54,
        'NUM7': 55,
        'NUM8': 56,
        // Alphabet: a-z
        'B': 66,
        'E': 69,
        'I': 73,
        'J': 74,
        'K': 75,
        'L': 76,
        'R': 82,
        'S': 83,
        'U': 85,
        'V': 86,
        'Y': 89,
        'Z': 90,
        'SLASH': 191,
        'LEFTBRACKET': 219,
        'BACKSLASH': 220,
        'RIGHTBRACKET': 221
    };
    /**
     * @class core.key
     *
     * Object for keycodes.
     *
     * @singleton
     * @alternateClassName key
     */
    var key = {
        /**
         * @method isEdit
         *
         * @param {Number} keyCode
         * @return {Boolean}
         */
        isEdit: function (keyCode) {
            return lists.contains([
                KEY_MAP.BACKSPACE,
                KEY_MAP.TAB,
                KEY_MAP.ENTER,
                KEY_MAP.SPACE,
                KEY_MAP.DELETE,
            ], keyCode);
        },
        /**
         * @method isMove
         *
         * @param {Number} keyCode
         * @return {Boolean}
         */
        isMove: function (keyCode) {
            return lists.contains([
                KEY_MAP.LEFT,
                KEY_MAP.UP,
                KEY_MAP.RIGHT,
                KEY_MAP.DOWN,
            ], keyCode);
        },
        /**
         * @property {Object} nameFromCode
         * @property {String} nameFromCode.8 "BACKSPACE"
         */
        nameFromCode: func.invertObject(KEY_MAP),
        code: KEY_MAP
    };

    /**
     * @method readFileAsDataURL
     *
     * read contents of file as representing URL
     *
     * @param {File} file
     * @return {Promise} - then: dataUrl
     */
    function readFileAsDataURL(file) {
        return $$1.Deferred(function (deferred) {
            $$1.extend(new FileReader(), {
                onload: function (e) {
                    var dataURL = e.target.result;
                    deferred.resolve(dataURL);
                },
                onerror: function (err) {
                    deferred.reject(err);
                }
            }).readAsDataURL(file);
        }).promise();
    }
    /**
     * @method createImage
     *
     * create `<image>` from url string
     *
     * @param {String} url
     * @return {Promise} - then: $image
     */
    function createImage(url) {
        return $$1.Deferred(function (deferred) {
            var $img = $$1('<img>');
            $img.one('load', function () {
                $img.off('error abort');
                deferred.resolve($img);
            }).one('error abort', function () {
                $img.off('load').detach();
                deferred.reject($img);
            }).css({
                display: 'none'
            }).appendTo(document.body).attr('src', url);
        }).promise();
    }

    var History = /** @class */ (function () {
        function History($editable) {
            this.stack = [];
            this.stackOffset = -1;
            this.$editable = $editable;
            this.editable = $editable[0];
        }
        History.prototype.makeSnapshot = function () {
            var rng = range.create(this.editable);
            var emptyBookmark = { s: { path: [], offset: 0 }, e: { path: [], offset: 0 } };
            return {
                contents: this.$editable.html(),
                bookmark: ((rng && rng.isOnEditable()) ? rng.bookmark(this.editable) : emptyBookmark)
            };
        };
        History.prototype.applySnapshot = function (snapshot) {
            if (snapshot.contents !== null) {
                this.$editable.html(snapshot.contents);
            }
            if (snapshot.bookmark !== null) {
                range.createFromBookmark(this.editable, snapshot.bookmark).select();
            }
        };
        /**
         * @method rewind
         * Rewinds the history stack back to the first snapshot taken.
         * Leaves the stack intact, so that "Redo" can still be used.
         */
        History.prototype.rewind = function () {
            // Create snap shot if not yet recorded
            if (this.$editable.html() !== this.stack[this.stackOffset].contents) {
                this.recordUndo();
            }
            // Return to the first available snapshot.
            this.stackOffset = 0;
            // Apply that snapshot.
            this.applySnapshot(this.stack[this.stackOffset]);
        };
        /**
         *  @method commit
         *  Resets history stack, but keeps current editor's content.
         */
        History.prototype.commit = function () {
            // Clear the stack.
            this.stack = [];
            // Restore stackOffset to its original value.
            this.stackOffset = -1;
            // Record our first snapshot (of nothing).
            this.recordUndo();
        };
        /**
         * @method reset
         * Resets the history stack completely; reverting to an empty editor.
         */
        History.prototype.reset = function () {
            // Clear the stack.
            this.stack = [];
            // Restore stackOffset to its original value.
            this.stackOffset = -1;
            // Clear the editable area.
            this.$editable.html('');
            // Record our first snapshot (of nothing).
            this.recordUndo();
        };
        /**
         * undo
         */
        History.prototype.undo = function () {
            // Create snap shot if not yet recorded
            if (this.$editable.html() !== this.stack[this.stackOffset].contents) {
                this.recordUndo();
            }
            if (this.stackOffset > 0) {
                this.stackOffset--;
                this.applySnapshot(this.stack[this.stackOffset]);
            }
        };
        /**
         * redo
         */
        History.prototype.redo = function () {
            if (this.stack.length - 1 > this.stackOffset) {
                this.stackOffset++;
                this.applySnapshot(this.stack[this.stackOffset]);
            }
        };
        /**
         * recorded undo
         */
        History.prototype.recordUndo = function () {
            this.stackOffset++;
            // Wash out stack after stackOffset
            if (this.stack.length > this.stackOffset) {
                this.stack = this.stack.slice(0, this.stackOffset);
            }
            // Create new snapshot and push it to the end
            this.stack.push(this.makeSnapshot());
        };
        return History;
    }());

    var Style = /** @class */ (function () {
        function Style() {
        }
        /**
         * @method jQueryCSS
         *
         * [workaround] for old jQuery
         * passing an array of style properties to .css()
         * will result in an object of property-value pairs.
         * (compability with version < 1.9)
         *
         * @private
         * @param  {jQuery} $obj
         * @param  {Array} propertyNames - An array of one or more CSS properties.
         * @return {Object}
         */
        Style.prototype.jQueryCSS = function ($obj, propertyNames) {
            if (env.jqueryVersion < 1.9) {
                var result_1 = {};
                $$1.each(propertyNames, function (idx, propertyName) {
                    result_1[propertyName] = $obj.css(propertyName);
                });
                return result_1;
            }
            return $obj.css(propertyNames);
        };
        /**
         * returns style object from node
         *
         * @param {jQuery} $node
         * @return {Object}
         */
        Style.prototype.fromNode = function ($node) {
            var properties = ['font-family', 'font-size', 'text-align', 'list-style-type', 'line-height'];
            var styleInfo = this.jQueryCSS($node, properties) || {};
            styleInfo['font-size'] = parseInt(styleInfo['font-size'], 10);
            return styleInfo;
        };
        /**
         * paragraph level style
         *
         * @param {WrappedRange} rng
         * @param {Object} styleInfo
         */
        Style.prototype.stylePara = function (rng, styleInfo) {
            $$1.each(rng.nodes(dom.isPara, {
                includeAncestor: true
            }), function (idx, para) {
                $$1(para).css(styleInfo);
            });
        };
        /**
         * insert and returns styleNodes on range.
         *
         * @param {WrappedRange} rng
         * @param {Object} [options] - options for styleNodes
         * @param {String} [options.nodeName] - default: `SPAN`
         * @param {Boolean} [options.expandClosestSibling] - default: `false`
         * @param {Boolean} [options.onlyPartialContains] - default: `false`
         * @return {Node[]}
         */
        Style.prototype.styleNodes = function (rng, options) {
            rng = rng.splitText();
            var nodeName = (options && options.nodeName) || 'SPAN';
            var expandClosestSibling = !!(options && options.expandClosestSibling);
            var onlyPartialContains = !!(options && options.onlyPartialContains);
            if (rng.isCollapsed()) {
                return [rng.insertNode(dom.create(nodeName))];
            }
            var pred = dom.makePredByNodeName(nodeName);
            var nodes = rng.nodes(dom.isText, {
                fullyContains: true
            }).map(function (text) {
                return dom.singleChildAncestor(text, pred) || dom.wrap(text, nodeName);
            });
            if (expandClosestSibling) {
                if (onlyPartialContains) {
                    var nodesInRange_1 = rng.nodes();
                    // compose with partial contains predication
                    pred = func.and(pred, function (node) {
                        return lists.contains(nodesInRange_1, node);
                    });
                }
                return nodes.map(function (node) {
                    var siblings = dom.withClosestSiblings(node, pred);
                    var head = lists.head(siblings);
                    var tails = lists.tail(siblings);
                    $$1.each(tails, function (idx, elem) {
                        dom.appendChildNodes(head, elem.childNodes);
                        dom.remove(elem);
                    });
                    return lists.head(siblings);
                });
            }
            else {
                return nodes;
            }
        };
        /**
         * get current style on cursor
         *
         * @param {WrappedRange} rng
         * @return {Object} - object contains style properties.
         */
        Style.prototype.current = function (rng) {
            var $cont = $$1(!dom.isElement(rng.sc) ? rng.sc.parentNode : rng.sc);
            var styleInfo = this.fromNode($cont);
            // document.queryCommandState for toggle state
            // [workaround] prevent Firefox nsresult: "0x80004005 (NS_ERROR_FAILURE)"
            try {
                styleInfo = $$1.extend(styleInfo, {
                    'font-bold': document.queryCommandState('bold') ? 'bold' : 'normal',
                    'font-italic': document.queryCommandState('italic') ? 'italic' : 'normal',
                    'font-underline': document.queryCommandState('underline') ? 'underline' : 'normal',
                    'font-subscript': document.queryCommandState('subscript') ? 'subscript' : 'normal',
                    'font-superscript': document.queryCommandState('superscript') ? 'superscript' : 'normal',
                    'font-strikethrough': document.queryCommandState('strikethrough') ? 'strikethrough' : 'normal',
                    'font-family': document.queryCommandValue('fontname') || styleInfo['font-family']
                });
            }
            catch (e) { }
            // list-style-type to list-style(unordered, ordered)
            if (!rng.isOnList()) {
                styleInfo['list-style'] = 'none';
            }
            else {
                var orderedTypes = ['circle', 'disc', 'disc-leading-zero', 'square'];
                var isUnordered = orderedTypes.indexOf(styleInfo['list-style-type']) > -1;
                styleInfo['list-style'] = isUnordered ? 'unordered' : 'ordered';
            }
            var para = dom.ancestor(rng.sc, dom.isPara);
            if (para && para.style['line-height']) {
                styleInfo['line-height'] = para.style.lineHeight;
            }
            else {
                var lineHeight = parseInt(styleInfo['line-height'], 10) / parseInt(styleInfo['font-size'], 10);
                styleInfo['line-height'] = lineHeight.toFixed(1);
            }
            styleInfo.anchor = rng.isOnAnchor() && dom.ancestor(rng.sc, dom.isAnchor);
            styleInfo.ancestors = dom.listAncestor(rng.sc, dom.isEditable);
            styleInfo.range = rng;
            return styleInfo;
        };
        return Style;
    }());

    var Bullet = /** @class */ (function () {
        function Bullet() {
        }
        /**
         * toggle ordered list
         */
        Bullet.prototype.insertOrderedList = function (editable) {
            this.toggleList('OL', editable);
        };
        /**
         * toggle unordered list
         */
        Bullet.prototype.insertUnorderedList = function (editable) {
            this.toggleList('UL', editable);
        };
        /**
         * indent
         */
        Bullet.prototype.indent = function (editable) {
            var _this = this;
            var rng = range.create(editable).wrapBodyInlineWithPara();
            var paras = rng.nodes(dom.isPara, { includeAncestor: true });
            var clustereds = lists.clusterBy(paras, func.peq2('parentNode'));
            $$1.each(clustereds, function (idx, paras) {
                var head = lists.head(paras);
                if (dom.isLi(head)) {
                    var previousList_1 = _this.findList(head.previousSibling);
                    if (previousList_1) {
                        paras
                            .map(function (para) { return previousList_1.appendChild(para); });
                    }
                    else {
                        _this.wrapList(paras, head.parentNode.nodeName);
                        paras
                            .map(function (para) { return para.parentNode; })
                            .map(function (para) { return _this.appendToPrevious(para); });
                    }
                }
                else {
                    $$1.each(paras, function (idx, para) {
                        $$1(para).css('marginLeft', function (idx, val) {
                            return (parseInt(val, 10) || 0) + 25;
                        });
                    });
                }
            });
            rng.select();
        };
        /**
         * outdent
         */
        Bullet.prototype.outdent = function (editable) {
            var _this = this;
            var rng = range.create(editable).wrapBodyInlineWithPara();
            var paras = rng.nodes(dom.isPara, { includeAncestor: true });
            var clustereds = lists.clusterBy(paras, func.peq2('parentNode'));
            $$1.each(clustereds, function (idx, paras) {
                var head = lists.head(paras);
                if (dom.isLi(head)) {
                    _this.releaseList([paras]);
                }
                else {
                    $$1.each(paras, function (idx, para) {
                        $$1(para).css('marginLeft', function (idx, val) {
                            val = (parseInt(val, 10) || 0);
                            return val > 25 ? val - 25 : '';
                        });
                    });
                }
            });
            rng.select();
        };
        /**
         * toggle list
         *
         * @param {String} listName - OL or UL
         */
        Bullet.prototype.toggleList = function (listName, editable) {
            var _this = this;
            var rng = range.create(editable).wrapBodyInlineWithPara();
            var paras = rng.nodes(dom.isPara, { includeAncestor: true });
            var bookmark = rng.paraBookmark(paras);
            var clustereds = lists.clusterBy(paras, func.peq2('parentNode'));
            // paragraph to list
            if (lists.find(paras, dom.isPurePara)) {
                var wrappedParas_1 = [];
                $$1.each(clustereds, function (idx, paras) {
                    wrappedParas_1 = wrappedParas_1.concat(_this.wrapList(paras, listName));
                });
                paras = wrappedParas_1;
                // list to paragraph or change list style
            }
            else {
                var diffLists = rng.nodes(dom.isList, {
                    includeAncestor: true
                }).filter(function (listNode) {
                    return !$$1.nodeName(listNode, listName);
                });
                if (diffLists.length) {
                    $$1.each(diffLists, function (idx, listNode) {
                        dom.replace(listNode, listName);
                    });
                }
                else {
                    paras = this.releaseList(clustereds, true);
                }
            }
            range.createFromParaBookmark(bookmark, paras).select();
        };
        /**
         * @param {Node[]} paras
         * @param {String} listName
         * @return {Node[]}
         */
        Bullet.prototype.wrapList = function (paras, listName) {
            var head = lists.head(paras);
            var last = lists.last(paras);
            var prevList = dom.isList(head.previousSibling) && head.previousSibling;
            var nextList = dom.isList(last.nextSibling) && last.nextSibling;
            var listNode = prevList || dom.insertAfter(dom.create(listName || 'UL'), last);
            // P to LI
            paras = paras.map(function (para) {
                return dom.isPurePara(para) ? dom.replace(para, 'LI') : para;
            });
            // append to list(<ul>, <ol>)
            dom.appendChildNodes(listNode, paras);
            if (nextList) {
                dom.appendChildNodes(listNode, lists.from(nextList.childNodes));
                dom.remove(nextList);
            }
            return paras;
        };
        /**
         * @method releaseList
         *
         * @param {Array[]} clustereds
         * @param {Boolean} isEscapseToBody
         * @return {Node[]}
         */
        Bullet.prototype.releaseList = function (clustereds, isEscapseToBody) {
            var _this = this;
            var releasedParas = [];
            $$1.each(clustereds, function (idx, paras) {
                var head = lists.head(paras);
                var last = lists.last(paras);
                var headList = isEscapseToBody ? dom.lastAncestor(head, dom.isList) : head.parentNode;
                var parentItem = headList.parentNode;
                if (headList.parentNode.nodeName === 'LI') {
                    paras.map(function (para) {
                        var newList = _this.findNextSiblings(para);
                        if (parentItem.nextSibling) {
                            parentItem.parentNode.insertBefore(para, parentItem.nextSibling);
                        }
                        else {
                            parentItem.parentNode.appendChild(para);
                        }
                        if (newList.length) {
                            _this.wrapList(newList, headList.nodeName);
                            para.appendChild(newList[0].parentNode);
                        }
                    });
                    if (headList.children.length === 0) {
                        parentItem.removeChild(headList);
                    }
                    if (parentItem.childNodes.length === 0) {
                        parentItem.parentNode.removeChild(parentItem);
                    }
                }
                else {
                    var lastList = headList.childNodes.length > 1 ? dom.splitTree(headList, {
                        node: last.parentNode,
                        offset: dom.position(last) + 1
                    }, {
                        isSkipPaddingBlankHTML: true
                    }) : null;
                    var middleList = dom.splitTree(headList, {
                        node: head.parentNode,
                        offset: dom.position(head)
                    }, {
                        isSkipPaddingBlankHTML: true
                    });
                    paras = isEscapseToBody ? dom.listDescendant(middleList, dom.isLi)
                        : lists.from(middleList.childNodes).filter(dom.isLi);
                    // LI to P
                    if (isEscapseToBody || !dom.isList(headList.parentNode)) {
                        paras = paras.map(function (para) {
                            return dom.replace(para, 'P');
                        });
                    }
                    $$1.each(lists.from(paras).reverse(), function (idx, para) {
                        dom.insertAfter(para, headList);
                    });
                    // remove empty lists
                    var rootLists = lists.compact([headList, middleList, lastList]);
                    $$1.each(rootLists, function (idx, rootList) {
                        var listNodes = [rootList].concat(dom.listDescendant(rootList, dom.isList));
                        $$1.each(listNodes.reverse(), function (idx, listNode) {
                            if (!dom.nodeLength(listNode)) {
                                dom.remove(listNode, true);
                            }
                        });
                    });
                }
                releasedParas = releasedParas.concat(paras);
            });
            return releasedParas;
        };
        /**
         * @method appendToPrevious
         *
         * Appends list to previous list item, if
         * none exist it wraps the list in a new list item.
         *
         * @param {HTMLNode} ListItem
         * @return {HTMLNode}
         */
        Bullet.prototype.appendToPrevious = function (node) {
            return node.previousSibling
                ? dom.appendChildNodes(node.previousSibling, [node])
                : this.wrapList([node], 'LI');
        };
        /**
         * @method findList
         *
         * Finds an existing list in list item
         *
         * @param {HTMLNode} ListItem
         * @return {Array[]}
         */
        Bullet.prototype.findList = function (node) {
            return node
                ? lists.find(node.children, function (child) { return ['OL', 'UL'].indexOf(child.nodeName) > -1; })
                : null;
        };
        /**
         * @method findNextSiblings
         *
         * Finds all list item siblings that follow it
         *
         * @param {HTMLNode} ListItem
         * @return {HTMLNode}
         */
        Bullet.prototype.findNextSiblings = function (node) {
            var siblings = [];
            while (node.nextSibling) {
                siblings.push(node.nextSibling);
                node = node.nextSibling;
            }
            return siblings;
        };
        return Bullet;
    }());

    /**
     * @class editing.Typing
     *
     * Typing
     *
     */
    var Typing = /** @class */ (function () {
        function Typing(context) {
            // a Bullet instance to toggle lists off
            this.bullet = new Bullet();
            this.options = context.options;
        }
        /**
         * insert tab
         *
         * @param {WrappedRange} rng
         * @param {Number} tabsize
         */
        Typing.prototype.insertTab = function (rng, tabsize) {
            var tab = dom.createText(new Array(tabsize + 1).join(dom.NBSP_CHAR));
            rng = rng.deleteContents();
            rng.insertNode(tab, true);
            rng = range.create(tab, tabsize);
            rng.select();
        };
        /**
         * insert paragraph
         *
         * @param {jQuery} $editable
         * @param {WrappedRange} rng Can be used in unit tests to "mock" the range
         *
         * blockquoteBreakingLevel
         *   0 - No break, the new paragraph remains inside the quote
         *   1 - Break the first blockquote in the ancestors list
         *   2 - Break all blockquotes, so that the new paragraph is not quoted (this is the default)
         */
        Typing.prototype.insertParagraph = function (editable, rng) {
            rng = rng || range.create(editable);
            // deleteContents on range.
            rng = rng.deleteContents();
            // Wrap range if it needs to be wrapped by paragraph
            rng = rng.wrapBodyInlineWithPara();
            // finding paragraph
            var splitRoot = dom.ancestor(rng.sc, dom.isPara);
            var nextPara;
            // on paragraph: split paragraph
            if (splitRoot) {
                // if it is an empty line with li
                if (dom.isEmpty(splitRoot) && dom.isLi(splitRoot)) {
                    // toogle UL/OL and escape
                    this.bullet.toggleList(splitRoot.parentNode.nodeName);
                    return;
                }
                else {
                    var blockquote = null;
                    if (this.options.blockquoteBreakingLevel === 1) {
                        blockquote = dom.ancestor(splitRoot, dom.isBlockquote);
                    }
                    else if (this.options.blockquoteBreakingLevel === 2) {
                        blockquote = dom.lastAncestor(splitRoot, dom.isBlockquote);
                    }
                    if (blockquote) {
                        // We're inside a blockquote and options ask us to break it
                        nextPara = $$1(dom.emptyPara)[0];
                        // If the split is right before a <br>, remove it so that there's no "empty line"
                        // after the split in the new blockquote created
                        if (dom.isRightEdgePoint(rng.getStartPoint()) && dom.isBR(rng.sc.nextSibling)) {
                            $$1(rng.sc.nextSibling).remove();
                        }
                        var split = dom.splitTree(blockquote, rng.getStartPoint(), { isDiscardEmptySplits: true });
                        if (split) {
                            split.parentNode.insertBefore(nextPara, split);
                        }
                        else {
                            dom.insertAfter(nextPara, blockquote); // There's no split if we were at the end of the blockquote
                        }
                    }
                    else {
                        nextPara = dom.splitTree(splitRoot, rng.getStartPoint());
                        // not a blockquote, just insert the paragraph
                        var emptyAnchors = dom.listDescendant(splitRoot, dom.isEmptyAnchor);
                        emptyAnchors = emptyAnchors.concat(dom.listDescendant(nextPara, dom.isEmptyAnchor));
                        $$1.each(emptyAnchors, function (idx, anchor) {
                            dom.remove(anchor);
                        });
                        // replace empty heading, pre or custom-made styleTag with P tag
                        if ((dom.isHeading(nextPara) || dom.isPre(nextPara) || dom.isCustomStyleTag(nextPara)) && dom.isEmpty(nextPara)) {
                            nextPara = dom.replace(nextPara, 'p');
                        }
                    }
                }
                // no paragraph: insert empty paragraph
            }
            else {
                var next = rng.sc.childNodes[rng.so];
                nextPara = $$1(dom.emptyPara)[0];
                if (next) {
                    rng.sc.insertBefore(nextPara, next);
                }
                else {
                    rng.sc.appendChild(nextPara);
                }
            }
            range.create(nextPara, 0).normalize().select().scrollIntoView(editable);
        };
        return Typing;
    }());

    /**
     * @class Create a virtual table to create what actions to do in change.
     * @param {object} startPoint Cell selected to apply change.
     * @param {enum} where  Where change will be applied Row or Col. Use enum: TableResultAction.where
     * @param {enum} action Action to be applied. Use enum: TableResultAction.requestAction
     * @param {object} domTable Dom element of table to make changes.
     */
    var TableResultAction = function (startPoint, where, action, domTable) {
        var _startPoint = { 'colPos': 0, 'rowPos': 0 };
        var _virtualTable = [];
        var _actionCellList = [];
        /// ///////////////////////////////////////////
        // Private functions
        /// ///////////////////////////////////////////
        /**
         * Set the startPoint of action.
         */
        function setStartPoint() {
            if (!startPoint || !startPoint.tagName || (startPoint.tagName.toLowerCase() !== 'td' && startPoint.tagName.toLowerCase() !== 'th')) {
                console.error('Impossible to identify start Cell point.', startPoint);
                return;
            }
            _startPoint.colPos = startPoint.cellIndex;
            if (!startPoint.parentElement || !startPoint.parentElement.tagName || startPoint.parentElement.tagName.toLowerCase() !== 'tr') {
                console.error('Impossible to identify start Row point.', startPoint);
                return;
            }
            _startPoint.rowPos = startPoint.parentElement.rowIndex;
        }
        /**
         * Define virtual table position info object.
         *
         * @param {int} rowIndex Index position in line of virtual table.
         * @param {int} cellIndex Index position in column of virtual table.
         * @param {object} baseRow Row affected by this position.
         * @param {object} baseCell Cell affected by this position.
         * @param {bool} isSpan Inform if it is an span cell/row.
         */
        function setVirtualTablePosition(rowIndex, cellIndex, baseRow, baseCell, isRowSpan, isColSpan, isVirtualCell) {
            var objPosition = {
                'baseRow': baseRow,
                'baseCell': baseCell,
                'isRowSpan': isRowSpan,
                'isColSpan': isColSpan,
                'isVirtual': isVirtualCell
            };
            if (!_virtualTable[rowIndex]) {
                _virtualTable[rowIndex] = [];
            }
            _virtualTable[rowIndex][cellIndex] = objPosition;
        }
        /**
         * Create action cell object.
         *
         * @param {object} virtualTableCellObj Object of specific position on virtual table.
         * @param {enum} resultAction Action to be applied in that item.
         */
        function getActionCell(virtualTableCellObj, resultAction, virtualRowPosition, virtualColPosition) {
            return {
                'baseCell': virtualTableCellObj.baseCell,
                'action': resultAction,
                'virtualTable': {
                    'rowIndex': virtualRowPosition,
                    'cellIndex': virtualColPosition
                }
            };
        }
        /**
         * Recover free index of row to append Cell.
         *
         * @param {int} rowIndex Index of row to find free space.
         * @param {int} cellIndex Index of cell to find free space in table.
         */
        function recoverCellIndex(rowIndex, cellIndex) {
            if (!_virtualTable[rowIndex]) {
                return cellIndex;
            }
            if (!_virtualTable[rowIndex][cellIndex]) {
                return cellIndex;
            }
            var newCellIndex = cellIndex;
            while (_virtualTable[rowIndex][newCellIndex]) {
                newCellIndex++;
                if (!_virtualTable[rowIndex][newCellIndex]) {
                    return newCellIndex;
                }
            }
        }
        /**
         * Recover info about row and cell and add information to virtual table.
         *
         * @param {object} row Row to recover information.
         * @param {object} cell Cell to recover information.
         */
        function addCellInfoToVirtual(row, cell) {
            var cellIndex = recoverCellIndex(row.rowIndex, cell.cellIndex);
            var cellHasColspan = (cell.colSpan > 1);
            var cellHasRowspan = (cell.rowSpan > 1);
            var isThisSelectedCell = (row.rowIndex === _startPoint.rowPos && cell.cellIndex === _startPoint.colPos);
            setVirtualTablePosition(row.rowIndex, cellIndex, row, cell, cellHasRowspan, cellHasColspan, false);
            // Add span rows to virtual Table.
            var rowspanNumber = cell.attributes.rowSpan ? parseInt(cell.attributes.rowSpan.value, 10) : 0;
            if (rowspanNumber > 1) {
                for (var rp = 1; rp < rowspanNumber; rp++) {
                    var rowspanIndex = row.rowIndex + rp;
                    adjustStartPoint(rowspanIndex, cellIndex, cell, isThisSelectedCell);
                    setVirtualTablePosition(rowspanIndex, cellIndex, row, cell, true, cellHasColspan, true);
                }
            }
            // Add span cols to virtual table.
            var colspanNumber = cell.attributes.colSpan ? parseInt(cell.attributes.colSpan.value, 10) : 0;
            if (colspanNumber > 1) {
                for (var cp = 1; cp < colspanNumber; cp++) {
                    var cellspanIndex = recoverCellIndex(row.rowIndex, (cellIndex + cp));
                    adjustStartPoint(row.rowIndex, cellspanIndex, cell, isThisSelectedCell);
                    setVirtualTablePosition(row.rowIndex, cellspanIndex, row, cell, cellHasRowspan, true, true);
                }
            }
        }
        /**
         * Process validation and adjust of start point if needed
         *
         * @param {int} rowIndex
         * @param {int} cellIndex
         * @param {object} cell
         * @param {bool} isSelectedCell
         */
        function adjustStartPoint(rowIndex, cellIndex, cell, isSelectedCell) {
            if (rowIndex === _startPoint.rowPos && _startPoint.colPos >= cell.cellIndex && cell.cellIndex <= cellIndex && !isSelectedCell) {
                _startPoint.colPos++;
            }
        }
        /**
         * Create virtual table of cells with all cells, including span cells.
         */
        function createVirtualTable() {
            var rows = domTable.rows;
            for (var rowIndex = 0; rowIndex < rows.length; rowIndex++) {
                var cells = rows[rowIndex].cells;
                for (var cellIndex = 0; cellIndex < cells.length; cellIndex++) {
                    addCellInfoToVirtual(rows[rowIndex], cells[cellIndex]);
                }
            }
        }
        /**
         * Get action to be applied on the cell.
         *
         * @param {object} cell virtual table cell to apply action
         */
        function getDeleteResultActionToCell(cell) {
            switch (where) {
                case TableResultAction.where.Column:
                    if (cell.isColSpan) {
                        return TableResultAction.resultAction.SubtractSpanCount;
                    }
                    break;
                case TableResultAction.where.Row:
                    if (!cell.isVirtual && cell.isRowSpan) {
                        return TableResultAction.resultAction.AddCell;
                    }
                    else if (cell.isRowSpan) {
                        return TableResultAction.resultAction.SubtractSpanCount;
                    }
                    break;
            }
            return TableResultAction.resultAction.RemoveCell;
        }
        /**
         * Get action to be applied on the cell.
         *
         * @param {object} cell virtual table cell to apply action
         */
        function getAddResultActionToCell(cell) {
            switch (where) {
                case TableResultAction.where.Column:
                    if (cell.isColSpan) {
                        return TableResultAction.resultAction.SumSpanCount;
                    }
                    else if (cell.isRowSpan && cell.isVirtual) {
                        return TableResultAction.resultAction.Ignore;
                    }
                    break;
                case TableResultAction.where.Row:
                    if (cell.isRowSpan) {
                        return TableResultAction.resultAction.SumSpanCount;
                    }
                    else if (cell.isColSpan && cell.isVirtual) {
                        return TableResultAction.resultAction.Ignore;
                    }
                    break;
            }
            return TableResultAction.resultAction.AddCell;
        }
        function init() {
            setStartPoint();
            createVirtualTable();
        }
        /// ///////////////////////////////////////////
        // Public functions
        /// ///////////////////////////////////////////
        /**
         * Recover array os what to do in table.
         */
        this.getActionList = function () {
            var fixedRow = (where === TableResultAction.where.Row) ? _startPoint.rowPos : -1;
            var fixedCol = (where === TableResultAction.where.Column) ? _startPoint.colPos : -1;
            var actualPosition = 0;
            var canContinue = true;
            while (canContinue) {
                var rowPosition = (fixedRow >= 0) ? fixedRow : actualPosition;
                var colPosition = (fixedCol >= 0) ? fixedCol : actualPosition;
                var row = _virtualTable[rowPosition];
                if (!row) {
                    canContinue = false;
                    return _actionCellList;
                }
                var cell = row[colPosition];
                if (!cell) {
                    canContinue = false;
                    return _actionCellList;
                }
                // Define action to be applied in this cell
                var resultAction = TableResultAction.resultAction.Ignore;
                switch (action) {
                    case TableResultAction.requestAction.Add:
                        resultAction = getAddResultActionToCell(cell);
                        break;
                    case TableResultAction.requestAction.Delete:
                        resultAction = getDeleteResultActionToCell(cell);
                        break;
                }
                _actionCellList.push(getActionCell(cell, resultAction, rowPosition, colPosition));
                actualPosition++;
            }
            return _actionCellList;
        };
        init();
    };
    /**
     *
     * Where action occours enum.
     */
    TableResultAction.where = { 'Row': 0, 'Column': 1 };
    /**
     *
     * Requested action to apply enum.
     */
    TableResultAction.requestAction = { 'Add': 0, 'Delete': 1 };
    /**
     *
     * Result action to be executed enum.
     */
    TableResultAction.resultAction = { 'Ignore': 0, 'SubtractSpanCount': 1, 'RemoveCell': 2, 'AddCell': 3, 'SumSpanCount': 4 };
    /**
     *
     * @class editing.Table
     *
     * Table
     *
     */
    var Table = /** @class */ (function () {
        function Table() {
        }
        /**
         * handle tab key
         *
         * @param {WrappedRange} rng
         * @param {Boolean} isShift
         */
        Table.prototype.tab = function (rng, isShift) {
            var cell = dom.ancestor(rng.commonAncestor(), dom.isCell);
            var table = dom.ancestor(cell, dom.isTable);
            var cells = dom.listDescendant(table, dom.isCell);
            var nextCell = lists[isShift ? 'prev' : 'next'](cells, cell);
            if (nextCell) {
                range.create(nextCell, 0).select();
            }
        };
        /**
         * Add a new row
         *
         * @param {WrappedRange} rng
         * @param {String} position (top/bottom)
         * @return {Node}
         */
        Table.prototype.addRow = function (rng, position) {
            var cell = dom.ancestor(rng.commonAncestor(), dom.isCell);
            var currentTr = $$1(cell).closest('tr');
            var trAttributes = this.recoverAttributes(currentTr);
            var html = $$1('<tr' + trAttributes + '></tr>');
            var vTable = new TableResultAction(cell, TableResultAction.where.Row, TableResultAction.requestAction.Add, $$1(currentTr).closest('table')[0]);
            var actions = vTable.getActionList();
            for (var idCell = 0; idCell < actions.length; idCell++) {
                var currentCell = actions[idCell];
                var tdAttributes = this.recoverAttributes(currentCell.baseCell);
                switch (currentCell.action) {
                    case TableResultAction.resultAction.AddCell:
                        html.append('<td' + tdAttributes + '>' + dom.blank + '</td>');
                        break;
                    case TableResultAction.resultAction.SumSpanCount:
                        if (position === 'top') {
                            var baseCellTr = currentCell.baseCell.parent;
                            var isTopFromRowSpan = (!baseCellTr ? 0 : currentCell.baseCell.closest('tr').rowIndex) <= currentTr[0].rowIndex;
                            if (isTopFromRowSpan) {
                                var newTd = $$1('<div></div>').append($$1('<td' + tdAttributes + '>' + dom.blank + '</td>').removeAttr('rowspan')).html();
                                html.append(newTd);
                                break;
                            }
                        }
                        var rowspanNumber = parseInt(currentCell.baseCell.rowSpan, 10);
                        rowspanNumber++;
                        currentCell.baseCell.setAttribute('rowSpan', rowspanNumber);
                        break;
                }
            }
            if (position === 'top') {
                currentTr.before(html);
            }
            else {
                var cellHasRowspan = (cell.rowSpan > 1);
                if (cellHasRowspan) {
                    var lastTrIndex = currentTr[0].rowIndex + (cell.rowSpan - 2);
                    $$1($$1(currentTr).parent().find('tr')[lastTrIndex]).after($$1(html));
                    return;
                }
                currentTr.after(html);
            }
        };
        /**
         * Add a new col
         *
         * @param {WrappedRange} rng
         * @param {String} position (left/right)
         * @return {Node}
         */
        Table.prototype.addCol = function (rng, position) {
            var cell = dom.ancestor(rng.commonAncestor(), dom.isCell);
            var row = $$1(cell).closest('tr');
            var rowsGroup = $$1(row).siblings();
            rowsGroup.push(row);
            var vTable = new TableResultAction(cell, TableResultAction.where.Column, TableResultAction.requestAction.Add, $$1(row).closest('table')[0]);
            var actions = vTable.getActionList();
            for (var actionIndex = 0; actionIndex < actions.length; actionIndex++) {
                var currentCell = actions[actionIndex];
                var tdAttributes = this.recoverAttributes(currentCell.baseCell);
                switch (currentCell.action) {
                    case TableResultAction.resultAction.AddCell:
                        if (position === 'right') {
                            $$1(currentCell.baseCell).after('<td' + tdAttributes + '>' + dom.blank + '</td>');
                        }
                        else {
                            $$1(currentCell.baseCell).before('<td' + tdAttributes + '>' + dom.blank + '</td>');
                        }
                        break;
                    case TableResultAction.resultAction.SumSpanCount:
                        if (position === 'right') {
                            var colspanNumber = parseInt(currentCell.baseCell.colSpan, 10);
                            colspanNumber++;
                            currentCell.baseCell.setAttribute('colSpan', colspanNumber);
                        }
                        else {
                            $$1(currentCell.baseCell).before('<td' + tdAttributes + '>' + dom.blank + '</td>');
                        }
                        break;
                }
            }
        };
        /*
      * Copy attributes from element.
      *
      * @param {object} Element to recover attributes.
      * @return {string} Copied string elements.
      */
        Table.prototype.recoverAttributes = function (el) {
            var resultStr = '';
            if (!el) {
                return resultStr;
            }
            var attrList = el.attributes || [];
            for (var i = 0; i < attrList.length; i++) {
                if (attrList[i].name.toLowerCase() === 'id') {
                    continue;
                }
                if (attrList[i].specified) {
                    resultStr += ' ' + attrList[i].name + '=\'' + attrList[i].value + '\'';
                }
            }
            return resultStr;
        };
        /**
         * Delete current row
         *
         * @param {WrappedRange} rng
         * @return {Node}
         */
        Table.prototype.deleteRow = function (rng) {
            var cell = dom.ancestor(rng.commonAncestor(), dom.isCell);
            var row = $$1(cell).closest('tr');
            var cellPos = row.children('td, th').index($$1(cell));
            var rowPos = row[0].rowIndex;
            var vTable = new TableResultAction(cell, TableResultAction.where.Row, TableResultAction.requestAction.Delete, $$1(row).closest('table')[0]);
            var actions = vTable.getActionList();
            for (var actionIndex = 0; actionIndex < actions.length; actionIndex++) {
                if (!actions[actionIndex]) {
                    continue;
                }
                var baseCell = actions[actionIndex].baseCell;
                var virtualPosition = actions[actionIndex].virtualTable;
                var hasRowspan = (baseCell.rowSpan && baseCell.rowSpan > 1);
                var rowspanNumber = (hasRowspan) ? parseInt(baseCell.rowSpan, 10) : 0;
                switch (actions[actionIndex].action) {
                    case TableResultAction.resultAction.Ignore:
                        continue;
                    case TableResultAction.resultAction.AddCell:
                        var nextRow = row.next('tr')[0];
                        if (!nextRow) {
                            continue;
                        }
                        var cloneRow = row[0].cells[cellPos];
                        if (hasRowspan) {
                            if (rowspanNumber > 2) {
                                rowspanNumber--;
                                nextRow.insertBefore(cloneRow, nextRow.cells[cellPos]);
                                nextRow.cells[cellPos].setAttribute('rowSpan', rowspanNumber);
                                nextRow.cells[cellPos].innerHTML = '';
                            }
                            else if (rowspanNumber === 2) {
                                nextRow.insertBefore(cloneRow, nextRow.cells[cellPos]);
                                nextRow.cells[cellPos].removeAttribute('rowSpan');
                                nextRow.cells[cellPos].innerHTML = '';
                            }
                        }
                        continue;
                    case TableResultAction.resultAction.SubtractSpanCount:
                        if (hasRowspan) {
                            if (rowspanNumber > 2) {
                                rowspanNumber--;
                                baseCell.setAttribute('rowSpan', rowspanNumber);
                                if (virtualPosition.rowIndex !== rowPos && baseCell.cellIndex === cellPos) {
                                    baseCell.innerHTML = '';
                                }
                            }
                            else if (rowspanNumber === 2) {
                                baseCell.removeAttribute('rowSpan');
                                if (virtualPosition.rowIndex !== rowPos && baseCell.cellIndex === cellPos) {
                                    baseCell.innerHTML = '';
                                }
                            }
                        }
                        continue;
                    case TableResultAction.resultAction.RemoveCell:
                        // Do not need remove cell because row will be deleted.
                        continue;
                }
            }
            row.remove();
        };
        /**
         * Delete current col
         *
         * @param {WrappedRange} rng
         * @return {Node}
         */
        Table.prototype.deleteCol = function (rng) {
            var cell = dom.ancestor(rng.commonAncestor(), dom.isCell);
            var row = $$1(cell).closest('tr');
            var cellPos = row.children('td, th').index($$1(cell));
            var vTable = new TableResultAction(cell, TableResultAction.where.Column, TableResultAction.requestAction.Delete, $$1(row).closest('table')[0]);
            var actions = vTable.getActionList();
            for (var actionIndex = 0; actionIndex < actions.length; actionIndex++) {
                if (!actions[actionIndex]) {
                    continue;
                }
                switch (actions[actionIndex].action) {
                    case TableResultAction.resultAction.Ignore:
                        continue;
                    case TableResultAction.resultAction.SubtractSpanCount:
                        var baseCell = actions[actionIndex].baseCell;
                        var hasColspan = (baseCell.colSpan && baseCell.colSpan > 1);
                        if (hasColspan) {
                            var colspanNumber = (baseCell.colSpan) ? parseInt(baseCell.colSpan, 10) : 0;
                            if (colspanNumber > 2) {
                                colspanNumber--;
                                baseCell.setAttribute('colSpan', colspanNumber);
                                if (baseCell.cellIndex === cellPos) {
                                    baseCell.innerHTML = '';
                                }
                            }
                            else if (colspanNumber === 2) {
                                baseCell.removeAttribute('colSpan');
                                if (baseCell.cellIndex === cellPos) {
                                    baseCell.innerHTML = '';
                                }
                            }
                        }
                        continue;
                    case TableResultAction.resultAction.RemoveCell:
                        dom.remove(actions[actionIndex].baseCell, true);
                        continue;
                }
            }
        };
        /**
         * create empty table element
         *
         * @param {Number} rowCount
         * @param {Number} colCount
         * @return {Node}
         */
        Table.prototype.createTable = function (colCount, rowCount, options) {
            var tds = [];
            var tdHTML;
            for (var idxCol = 0; idxCol < colCount; idxCol++) {
                tds.push('<td>' + dom.blank + '</td>');
            }
            tdHTML = tds.join('');
            var trs = [];
            var trHTML;
            for (var idxRow = 0; idxRow < rowCount; idxRow++) {
                trs.push('<tr>' + tdHTML + '</tr>');
            }
            trHTML = trs.join('');
            var $table = $$1('<table>' + trHTML + '</table>');
            if (options && options.tableClassName) {
                $table.addClass(options.tableClassName);
            }
            return $table[0];
        };
        /**
         * Delete current table
         *
         * @param {WrappedRange} rng
         * @return {Node}
         */
        Table.prototype.deleteTable = function (rng) {
            var cell = dom.ancestor(rng.commonAncestor(), dom.isCell);
            $$1(cell).closest('table').remove();
        };
        return Table;
    }());

    var KEY_BOGUS = 'bogus';
    /**
     * @class Editor
     */
    var Editor = /** @class */ (function () {
        function Editor(context) {
            var _this = this;
            this.context = context;
            this.$note = context.layoutInfo.note;
            this.$editor = context.layoutInfo.editor;
            this.$editable = context.layoutInfo.editable;
            this.options = context.options;
            this.lang = this.options.langInfo;
            this.editable = this.$editable[0];
            this.lastRange = null;
            this.style = new Style();
            this.table = new Table();
            this.typing = new Typing(context);
            this.bullet = new Bullet();
            this.history = new History(this.$editable);
            this.context.memo('help.undo', this.lang.help.undo);
            this.context.memo('help.redo', this.lang.help.redo);
            this.context.memo('help.tab', this.lang.help.tab);
            this.context.memo('help.untab', this.lang.help.untab);
            this.context.memo('help.insertParagraph', this.lang.help.insertParagraph);
            this.context.memo('help.insertOrderedList', this.lang.help.insertOrderedList);
            this.context.memo('help.insertUnorderedList', this.lang.help.insertUnorderedList);
            this.context.memo('help.indent', this.lang.help.indent);
            this.context.memo('help.outdent', this.lang.help.outdent);
            this.context.memo('help.formatPara', this.lang.help.formatPara);
            this.context.memo('help.insertHorizontalRule', this.lang.help.insertHorizontalRule);
            this.context.memo('help.fontName', this.lang.help.fontName);
            // native commands(with execCommand), generate function for execCommand
            var commands = [
                'bold', 'italic', 'underline', 'strikethrough', 'superscript', 'subscript',
                'justifyLeft', 'justifyCenter', 'justifyRight', 'justifyFull',
                'formatBlock', 'removeFormat', 'backColor',
            ];
            for (var idx = 0, len = commands.length; idx < len; idx++) {
                this[commands[idx]] = (function (sCmd) {
                    return function (value) {
                        _this.beforeCommand();
                        document.execCommand(sCmd, false, value);
                        _this.afterCommand(true);
                    };
                })(commands[idx]);
                this.context.memo('help.' + commands[idx], this.lang.help[commands[idx]]);
            }
            this.fontName = this.wrapCommand(function (value) {
                return _this.fontStyling('font-family', "\'" + value + "\'");
            });
            this.fontSize = this.wrapCommand(function (value) {
                return _this.fontStyling('font-size', value + 'px');
            });
            for (var idx = 1; idx <= 6; idx++) {
                this['formatH' + idx] = (function (idx) {
                    return function () {
                        _this.formatBlock('H' + idx);
                    };
                })(idx);
                this.context.memo('help.formatH' + idx, this.lang.help['formatH' + idx]);
            }
            this.insertParagraph = this.wrapCommand(function () {
                _this.typing.insertParagraph(_this.editable);
            });
            this.insertOrderedList = this.wrapCommand(function () {
                _this.bullet.insertOrderedList(_this.editable);
            });
            this.insertUnorderedList = this.wrapCommand(function () {
                _this.bullet.insertUnorderedList(_this.editable);
            });
            this.indent = this.wrapCommand(function () {
                _this.bullet.indent(_this.editable);
            });
            this.outdent = this.wrapCommand(function () {
                _this.bullet.outdent(_this.editable);
            });
            /**
             * insertNode
             * insert node
             * @param {Node} node
             */
            this.insertNode = this.wrapCommand(function (node) {
                if (_this.isLimited($$1(node).text().length)) {
                    return;
                }
                var rng = _this.getLastRange();
                rng.insertNode(node);
                range.createFromNodeAfter(node).select();
                _this.setLastRange();
            });
            /**
             * insert text
             * @param {String} text
             */
            this.insertText = this.wrapCommand(function (text) {
                if (_this.isLimited(text.length)) {
                    return;
                }
                var rng = _this.getLastRange();
                var textNode = rng.insertNode(dom.createText(text));
                range.create(textNode, dom.nodeLength(textNode)).select();
                _this.setLastRange();
            });
            /**
             * paste HTML
             * @param {String} markup
             */
            this.pasteHTML = this.wrapCommand(function (markup) {
                if (_this.isLimited(markup.length)) {
                    return;
                }
                markup = _this.context.invoke('codeview.purify', markup);
                var contents = _this.getLastRange().pasteHTML(markup);
                range.createFromNodeAfter(lists.last(contents)).select();
                _this.setLastRange();
            });
            /**
             * formatBlock
             *
             * @param {String} tagName
             */
            this.formatBlock = this.wrapCommand(function (tagName, $target) {
                var onApplyCustomStyle = _this.options.callbacks.onApplyCustomStyle;
                if (onApplyCustomStyle) {
                    onApplyCustomStyle.call(_this, $target, _this.context, _this.onFormatBlock);
                }
                else {
                    _this.onFormatBlock(tagName, $target);
                }
            });
            /**
             * insert horizontal rule
             */
            this.insertHorizontalRule = this.wrapCommand(function () {
                var hrNode = _this.getLastRange().insertNode(dom.create('HR'));
                if (hrNode.nextSibling) {
                    range.create(hrNode.nextSibling, 0).normalize().select();
                    _this.setLastRange();
                }
            });
            /**
             * lineHeight
             * @param {String} value
             */
            this.lineHeight = this.wrapCommand(function (value) {
                _this.style.stylePara(_this.getLastRange(), {
                    lineHeight: value
                });
            });
            /**
             * create link (command)
             *
             * @param {Object} linkInfo
             */
            this.createLink = this.wrapCommand(function (linkInfo) {
                var linkUrl = linkInfo.url;
                var linkText = linkInfo.text;
                var isNewWindow = linkInfo.isNewWindow;
                var linkClass = linkInfo.class;
                var email=linkInfo.email;
                var edit =linkInfo.editable;
                var doNotHighlight = linkInfo.doNotHighlight;
                var rng = linkInfo.range || _this.getLastRange();
                var additionalTextLength = linkText.length - rng.toString().length;
                if (additionalTextLength > 0 && _this.isLimited(additionalTextLength)) {
                    return;
                }
                var isTextChanged = rng.toString() !== linkText;
                // handle spaced urls from input
                if (typeof linkUrl === 'string') {
                    linkUrl = linkUrl.trim();
                }
                if (_this.options.onCreateLink) {
                    linkUrl = _this.options.onCreateLink(linkUrl);
                }
                else {
                    // if url doesn't have any protocol and not even a relative or a label, use http:// as default
                    linkUrl = /^([A-Za-z][A-Za-z0-9+-.]*\:|#|\/)/.test(linkUrl)
                        ? linkUrl : 'http://' + linkUrl;
                }
                var anchors = [];
                if (isTextChanged) {
                    rng = rng.deleteContents();
                    var anchor = rng.insertNode($$1('<A>' + linkText + '</A>')[0]);
                    anchors.push(anchor);
                }
                else {
                    anchors = _this.style.styleNodes(rng, {
                        nodeName: 'A',
                        expandClosestSibling: true,
                        onlyPartialContains: true
                    });
                }
                $$1.each(anchors, function (idx, anchor) {
                    $$1(anchor).attr('href', linkUrl);
                    if(linkClass) {
                        $$1(anchor).attr('class', linkClass);
                    }
                    if(email){
                        $$1(anchor).attr('data-email', email);
                    }
                    if(!edit){
                        $$1(anchor).attr('contenteditable', edit);
                    }
                    if (isNewWindow) {
                        $$1(anchor).attr('target', '_blank');
                    }
                    else {
                        $$1(anchor).removeAttr('target');
                    }
                });
                var startRange = range.createFromNodeBefore(lists.head(anchors));
                var startPoint = startRange.getStartPoint();
                var endRange = range.createFromNodeAfter(lists.last(anchors));
                var endPoint = endRange.getEndPoint();

                if(doNotHighlight) {
                    range.createFromNodeAfter(lists.last(anchors)).select();
                    _this.setLastRange();
                }else{
                    range.create(startPoint.node, startPoint.offset, endPoint.node, endPoint.offset).select();
                    _this.setLastRange();
                }
            });
            /**
             * setting color
             *
             * @param {Object} sObjColor  color code
             * @param {String} sObjColor.foreColor foreground color
             * @param {String} sObjColor.backColor background color
             */
            this.color = this.wrapCommand(function (colorInfo) {
                var foreColor = colorInfo.foreColor;
                var backColor = colorInfo.backColor;
                if (foreColor) {
                    document.execCommand('foreColor', false, foreColor);
                }
                if (backColor) {
                    document.execCommand('backColor', false, backColor);
                }
            });
            /**
             * Set foreground color
             *
             * @param {String} colorCode foreground color code
             */
            this.foreColor = this.wrapCommand(function (colorInfo) {
                document.execCommand('styleWithCSS', false, true);
                document.execCommand('foreColor', false, colorInfo);
            });
            /**
             * insert Table
             *
             * @param {String} dimension of table (ex : "5x5")
             */
            this.insertTable = this.wrapCommand(function (dim) {
                var dimension = dim.split('x');
                var rng = _this.getLastRange().deleteContents();
                rng.insertNode(_this.table.createTable(dimension[0], dimension[1], _this.options));
            });
            /**
             * remove media object and Figure Elements if media object is img with Figure.
             */
            this.removeMedia = this.wrapCommand(function () {
                var $target = $$1(_this.restoreTarget()).parent();
                if ($target.parent('figure').length) {
                    $target.parent('figure').remove();
                }
                else {
                    $target = $$1(_this.restoreTarget()).detach();
                }
                _this.context.triggerEvent('media.delete', $target, _this.$editable);
            });
            /**
             * float me
             *
             * @param {String} value
             */
            this.floatMe = this.wrapCommand(function (value) {
                var $target = $$1(_this.restoreTarget());
                $target.toggleClass('note-float-left', value === 'left');
                $target.toggleClass('note-float-right', value === 'right');
                $target.css('float', (value === 'none' ? '' : value));
            });
            /**
             * resize overlay element
             * @param {String} value
             */
            this.resize = this.wrapCommand(function (value) {
                var $target = $$1(_this.restoreTarget());
                value = parseFloat(value);
                if (value === 0) {
                    $target.css('width', '');
                }
                else {
                    $target.css({
                        width: value * 100 + '%',
                        height: ''
                    });
                }
            });
        }
        Editor.prototype.initialize = function () {
            var _this = this;
            // bind custom events
            this.$editable.on('keydown', function (event) {
                if (event.keyCode === key.code.ENTER) {
                    _this.context.triggerEvent('enter', event);
                }
                _this.context.triggerEvent('keydown', event);
                if (!event.isDefaultPrevented()) {
                    if (_this.options.shortcuts) {
                        _this.handleKeyMap(event);
                    }
                    else {
                        _this.preventDefaultEditableShortCuts(event);
                    }
                }
                if (_this.isLimited(1, event)) {
                    return false;
                }
            }).on('keyup', function (event) {
                _this.setLastRange();
                _this.context.triggerEvent('keyup', event);
            }).on('focus', function (event) {
                _this.setLastRange();
                _this.context.triggerEvent('focus', event);
            }).on('blur', function (event) {
                _this.context.triggerEvent('blur', event);
            }).on('mousedown', function (event) {
                _this.context.triggerEvent('mousedown', event);
            }).on('mouseup', function (event) {
                _this.setLastRange();
                _this.context.triggerEvent('mouseup', event);
            }).on('scroll', function (event) {
                _this.context.triggerEvent('scroll', event);
            }).on('paste', function (event) {
                _this.setLastRange();
                _this.context.triggerEvent('paste', event);
            });
            this.$editable.attr('spellcheck', this.options.spellCheck);
            // init content before set event
            this.$editable.html(dom.html(this.$note) || dom.emptyPara);
            this.$editable.on(env.inputEventName, func.debounce(function () {
                _this.context.triggerEvent('change', _this.$editable.html(), _this.$editable);
            }, 10));
            this.$editor.on('focusin', function (event) {
                _this.context.triggerEvent('focusin', event);
            }).on('focusout', function (event) {
                _this.context.triggerEvent('focusout', event);
            });
            if (!this.options.airMode) {
                if (this.options.width) {
                    this.$editor.outerWidth(this.options.width);
                }
                if (this.options.height) {
                    this.$editable.outerHeight(this.options.height);
                }
                if (this.options.maxHeight) {
                    this.$editable.css('max-height', this.options.maxHeight);
                }
                if (this.options.minHeight) {
                    this.$editable.css('min-height', this.options.minHeight);
                }
            }
            this.history.recordUndo();
            this.setLastRange();
        };
        Editor.prototype.destroy = function () {
            this.$editable.off();
        };
        Editor.prototype.handleKeyMap = function (event) {
            var keyMap = this.options.keyMap[env.isMac ? 'mac' : 'pc'];
            var keys = [];
            if (event.metaKey) {
                keys.push('CMD');
            }
            if (event.ctrlKey && !event.altKey) {
                keys.push('CTRL');
            }
            if (event.shiftKey) {
                keys.push('SHIFT');
            }
            var keyName = key.nameFromCode[event.keyCode];
            if (keyName) {
                keys.push(keyName);
            }
            var eventName = keyMap[keys.join('+')];
            if (eventName) {
                if (this.context.invoke(eventName) !== false) {
                    event.preventDefault();
                }
            }
            else if (key.isEdit(event.keyCode)) {
                this.afterCommand();
            }
        };
        Editor.prototype.preventDefaultEditableShortCuts = function (event) {
            // B(Bold, 66) / I(Italic, 73) / U(Underline, 85)
            if ((event.ctrlKey || event.metaKey) &&
                lists.contains([66, 73, 85], event.keyCode)) {
                event.preventDefault();
            }
        };
        Editor.prototype.isLimited = function (pad, event) {
            pad = pad || 0;
            if (typeof event !== 'undefined') {
                if (key.isMove(event.keyCode) ||
                    (event.ctrlKey || event.metaKey) ||
                    lists.contains([key.code.BACKSPACE, key.code.DELETE], event.keyCode)) {
                    return false;
                }
            }
            if (this.options.maxTextLength > 0) {
                if ((this.$editable.text().length + pad) >= this.options.maxTextLength) {
                    return true;
                }
            }
            return false;
        };
        /**
         * create range
         * @return {WrappedRange}
         */
        Editor.prototype.createRange = function () {
            this.focus();
            this.setLastRange();
            return this.getLastRange();
        };
        Editor.prototype.setLastRange = function () {
            this.lastRange = range.create(this.editable);
        };
        Editor.prototype.getLastRange = function () {
            if (!this.lastRange) {
                this.setLastRange();
            }
            return this.lastRange;
        };
        /**
         * saveRange
         *
         * save current range
         *
         * @param {Boolean} [thenCollapse=false]
         */
        Editor.prototype.saveRange = function (thenCollapse) {
            if (thenCollapse) {
                this.getLastRange().collapse().select();
            }
        };
        /**
         * restoreRange
         *
         * restore lately range
         */
        Editor.prototype.restoreRange = function () {
            if (this.lastRange) {
                this.lastRange.select();
                this.focus();
            }
        };
        Editor.prototype.saveTarget = function (node) {
            this.$editable.data('target', node);
        };
        Editor.prototype.clearTarget = function () {
            this.$editable.removeData('target');
        };
        Editor.prototype.restoreTarget = function () {
            return this.$editable.data('target');
        };
        /**
         * currentStyle
         *
         * current style
         * @return {Object|Boolean} unfocus
         */
        Editor.prototype.currentStyle = function () {
            var rng = range.create();
            if (rng) {
                rng = rng.normalize();
            }
            return rng ? this.style.current(rng) : this.style.fromNode(this.$editable);
        };
        /**
         * style from node
         *
         * @param {jQuery} $node
         * @return {Object}
         */
        Editor.prototype.styleFromNode = function ($node) {
            return this.style.fromNode($node);
        };
        /**
         * undo
         */
        Editor.prototype.undo = function () {
            this.context.triggerEvent('before.command', this.$editable.html());
            this.history.undo();
            this.context.triggerEvent('change', this.$editable.html(), this.$editable);
        };
        /*
      * commit
      */
        Editor.prototype.commit = function () {
            this.context.triggerEvent('before.command', this.$editable.html());
            this.history.commit();
            this.context.triggerEvent('change', this.$editable.html(), this.$editable);
        };
        /**
         * redo
         */
        Editor.prototype.redo = function () {
            this.context.triggerEvent('before.command', this.$editable.html());
            this.history.redo();
            this.context.triggerEvent('change', this.$editable.html(), this.$editable);
        };
        /**
         * before command
         */
        Editor.prototype.beforeCommand = function () {
            this.context.triggerEvent('before.command', this.$editable.html());
            // keep focus on editable before command execution
            this.focus();
        };
        /**
         * after command
         * @param {Boolean} isPreventTrigger
         */
        Editor.prototype.afterCommand = function (isPreventTrigger) {
            this.normalizeContent();
            this.history.recordUndo();
            if (!isPreventTrigger) {
                this.context.triggerEvent('change', this.$editable.html(), this.$editable);
            }
        };
        /**
         * handle tab key
         */
        Editor.prototype.tab = function () {
            var rng = this.getLastRange();
            if (rng.isCollapsed() && rng.isOnCell()) {
                this.table.tab(rng);
            }
            else {
                if (this.options.tabSize === 0) {
                    return false;
                }
                if (!this.isLimited(this.options.tabSize)) {
                    this.beforeCommand();
                    this.typing.insertTab(rng, this.options.tabSize);
                    this.afterCommand();
                }
            }
        };
        /**
         * handle shift+tab key
         */
        Editor.prototype.untab = function () {
            var rng = this.getLastRange();
            if (rng.isCollapsed() && rng.isOnCell()) {
                this.table.tab(rng, true);
            }
            else {
                if (this.options.tabSize === 0) {
                    return false;
                }
            }
        };
        /**
         * run given function between beforeCommand and afterCommand
         */
        Editor.prototype.wrapCommand = function (fn) {
            return function () {
                this.beforeCommand();
                fn.apply(this, arguments);
                this.afterCommand();
            };
        };
        /**
         * insert image
         *
         * @param {String} src
         * @param {String|Function} param
         * @return {Promise}
         */
        Editor.prototype.insertImage = function (src, param) {
            var _this = this;
            return createImage(src, param).then(function ($image) {
                _this.beforeCommand();
                if (typeof param === 'function') {
                    param($image);
                }
                else {
                    if (typeof param === 'string') {
                        $image.attr('data-filename', param);
                    }
                    $image.css('width', Math.min(_this.$editable.width(), $image.width()));
                }
                $image.show();
                range.create(_this.editable).insertNode($image[0]);
                range.createFromNodeAfter($image[0]).select();
                _this.setLastRange();
                _this.afterCommand();
            }).fail(function (e) {
                _this.context.triggerEvent('image.upload.error', e);
            });
        };
        /**
         * insertImages
         * @param {File[]} files
         */
        Editor.prototype.insertImagesAsDataURL = function (files) {
            var _this = this;
            $$1.each(files, function (idx, file) {
                var filename = file.name;
                if (_this.options.maximumImageFileSize && _this.options.maximumImageFileSize < file.size) {
                    _this.context.triggerEvent('image.upload.error', _this.lang.image.maximumFileSizeError);
                }
                else {
                    readFileAsDataURL(file).then(function (dataURL) {
                        return _this.insertImage(dataURL, filename);
                    }).fail(function () {
                        _this.context.triggerEvent('image.upload.error');
                    });
                }
            });
        };
        /**
         * insertImagesOrCallback
         * @param {File[]} files
         */
        Editor.prototype.insertImagesOrCallback = function (files) {
            var callbacks = this.options.callbacks;
            // If onImageUpload set,
            if (callbacks.onImageUpload) {
                this.context.triggerEvent('image.upload', files);
                // else insert Image as dataURL
            }
            else {
                this.insertImagesAsDataURL(files);
            }
        };
        /**
         * return selected plain text
         * @return {String} text
         */
        Editor.prototype.getSelectedText = function () {
            var rng = this.getLastRange();
            // if range on anchor, expand range with anchor
            if (rng.isOnAnchor()) {
                rng = range.createFromNode(dom.ancestor(rng.sc, dom.isAnchor));
            }
            return rng.toString();
        };
        Editor.prototype.onFormatBlock = function (tagName, $target) {
            // [workaround] for MSIE, IE need `<`
            document.execCommand('FormatBlock', false, env.isMSIE ? '<' + tagName + '>' : tagName);
            // support custom class
            if ($target && $target.length) {
                // find the exact element has given tagName
                if ($target[0].tagName.toUpperCase() !== tagName.toUpperCase()) {
                    $target = $target.find(tagName);
                }
                if ($target && $target.length) {
                    var className = $target[0].className || '';
                    if (className) {
                        var currentRange = this.createRange();
                        var $parent = $$1([currentRange.sc, currentRange.ec]).closest(tagName);
                        $parent.addClass(className);
                    }
                }
            }
        };
        Editor.prototype.formatPara = function () {
            this.formatBlock('P');
        };
        Editor.prototype.fontStyling = function (target, value) {
            var rng = this.getLastRange();
            if (rng) {
                var spans = this.style.styleNodes(rng);
                $$1(spans).css(target, value);
                // [workaround] added styled bogus span for style
                //  - also bogus character needed for cursor position
                if (rng.isCollapsed()) {
                    var firstSpan = lists.head(spans);
                    if (firstSpan && !dom.nodeLength(firstSpan)) {
                        firstSpan.innerHTML = dom.ZERO_WIDTH_NBSP_CHAR;
                        range.createFromNodeAfter(firstSpan.firstChild).select();
                        this.setLastRange();
                        this.$editable.data(KEY_BOGUS, firstSpan);
                    }
                }
            }
        };
        /**
         * unlink
         *
         * @type command
         */
        Editor.prototype.unlink = function () {
            var rng = this.getLastRange();
            if (rng.isOnAnchor()) {
                var anchor = dom.ancestor(rng.sc, dom.isAnchor);
                rng = range.createFromNode(anchor);
                rng.select();
                this.setLastRange();
                this.beforeCommand();
                document.execCommand('unlink');
                this.afterCommand();
            }
        };
        /**
         * returns link info
         *
         * @return {Object}
         * @return {WrappedRange} return.range
         * @return {String} return.text
         * @return {Boolean} [return.isNewWindow=true]
         * @return {String} [return.url=""]
         */
        Editor.prototype.getLinkInfo = function () {
            var rng = this.getLastRange().expand(dom.isAnchor);
            // Get the first anchor on range(for edit).
            var $anchor = $$1(lists.head(rng.nodes(dom.isAnchor)));
            var linkInfo = {
                range: rng,
                text: rng.toString(),
                url: $anchor.length ? $anchor.attr('href') : ''
            };
            // When anchor exists,
            if ($anchor.length) {
                // Set isNewWindow by checking its target.
                linkInfo.isNewWindow = $anchor.attr('target') === '_blank';
            }
            return linkInfo;
        };
        Editor.prototype.addRow = function (position) {
            var rng = this.getLastRange(this.$editable);
            if (rng.isCollapsed() && rng.isOnCell()) {
                this.beforeCommand();
                this.table.addRow(rng, position);
                this.afterCommand();
            }
        };
        Editor.prototype.addCol = function (position) {
            var rng = this.getLastRange(this.$editable);
            if (rng.isCollapsed() && rng.isOnCell()) {
                this.beforeCommand();
                this.table.addCol(rng, position);
                this.afterCommand();
            }
        };
        Editor.prototype.deleteRow = function () {
            var rng = this.getLastRange(this.$editable);
            if (rng.isCollapsed() && rng.isOnCell()) {
                this.beforeCommand();
                this.table.deleteRow(rng);
                this.afterCommand();
            }
        };
        Editor.prototype.deleteCol = function () {
            var rng = this.getLastRange(this.$editable);
            if (rng.isCollapsed() && rng.isOnCell()) {
                this.beforeCommand();
                this.table.deleteCol(rng);
                this.afterCommand();
            }
        };
        Editor.prototype.deleteTable = function () {
            var rng = this.getLastRange(this.$editable);
            if (rng.isCollapsed() && rng.isOnCell()) {
                this.beforeCommand();
                this.table.deleteTable(rng);
                this.afterCommand();
            }
        };
        /**
         * @param {Position} pos
         * @param {jQuery} $target - target element
         * @param {Boolean} [bKeepRatio] - keep ratio
         */
        Editor.prototype.resizeTo = function (pos, $target, bKeepRatio) {
            var imageSize;
            if (bKeepRatio) {
                var newRatio = pos.y / pos.x;
                var ratio = $target.data('ratio');
                imageSize = {
                    width: ratio > newRatio ? pos.x : pos.y / ratio,
                    height: ratio > newRatio ? pos.x * ratio : pos.y
                };
            }
            else {
                imageSize = {
                    width: pos.x,
                    height: pos.y
                };
            }
            $target.css(imageSize);
        };
        /**
         * returns whether editable area has focus or not.
         */
        Editor.prototype.hasFocus = function () {
            return this.$editable.is(':focus');
        };
        /**
         * set focus
         */
        Editor.prototype.focus = function () {
            // [workaround] Screen will move when page is scolled in IE.
            //  - do focus when not focused
            if (!this.hasFocus()) {
                this.$editable.focus();
            }
        };
        /**
         * returns whether contents is empty or not.
         * @return {Boolean}
         */
        Editor.prototype.isEmpty = function () {
            return dom.isEmpty(this.$editable[0]) || dom.emptyPara === this.$editable.html();
        };
        /**
         * Removes all contents and restores the editable instance to an _emptyPara_.
         */
        Editor.prototype.empty = function () {
            this.context.invoke('code', dom.emptyPara);
        };
        /**
         * normalize content
         */
        Editor.prototype.normalizeContent = function () {
            this.$editable[0].normalize();
        };
        return Editor;
    }());

    var Clipboard = /** @class */ (function () {
        function Clipboard(context) {
            this.context = context;
            this.$editable = context.layoutInfo.editable;
        }
        Clipboard.prototype.initialize = function () {
            this.$editable.on('paste', this.pasteByEvent.bind(this));
        };
        /**
         * paste by clipboard event
         *
         * @param {Event} event
         */
        Clipboard.prototype.pasteByEvent = function (event) {
            var clipboardData = event.originalEvent.clipboardData;
            if (clipboardData && clipboardData.items && clipboardData.items.length) {
                // paste img file
                var item = clipboardData.items.length > 1 ? clipboardData.items[1] : lists.head(clipboardData.items);
                if (item.kind === 'file' && item.type.indexOf('image/') !== -1) {
                    this.context.invoke('editor.insertImagesOrCallback', [item.getAsFile()]);
                }
                this.context.invoke('editor.afterCommand');
            }
        };
        return Clipboard;
    }());

    var Dropzone = /** @class */ (function () {
        function Dropzone(context) {
            this.context = context;
            this.$eventListener = $$1(document);
            this.$editor = context.layoutInfo.editor;
            this.$editable = context.layoutInfo.editable;
            this.options = context.options;
            this.lang = this.options.langInfo;
            this.documentEventHandlers = {};
            this.$dropzone = $$1([
                '<div class="note-dropzone">',
                '  <div class="note-dropzone-message"/>',
                '</div>',
            ].join('')).prependTo(this.$editor);
        }
        /**
         * attach Drag and Drop Events
         */
        Dropzone.prototype.initialize = function () {
            if (this.options.disableDragAndDrop) {
                // prevent default drop event
                this.documentEventHandlers.onDrop = function (e) {
                    e.preventDefault();
                };
                // do not consider outside of dropzone
                this.$eventListener = this.$dropzone;
                this.$eventListener.on('drop', this.documentEventHandlers.onDrop);
            }
            else {
                this.attachDragAndDropEvent();
            }
        };
        /**
         * attach Drag and Drop Events
         */
        Dropzone.prototype.attachDragAndDropEvent = function () {
            var _this = this;
            var collection = $$1();
            var $dropzoneMessage = this.$dropzone.find('.note-dropzone-message');
            this.documentEventHandlers.onDragenter = function (e) {
                var isCodeview = _this.context.invoke('codeview.isActivated');
                var hasEditorSize = _this.$editor.width() > 0 && _this.$editor.height() > 0;
                if (!isCodeview && !collection.length && hasEditorSize) {
                    _this.$editor.addClass('dragover');
                    _this.$dropzone.width(_this.$editor.width());
                    _this.$dropzone.height(_this.$editor.height());
                    $dropzoneMessage.text(_this.lang.image.dragImageHere);
                }
                collection = collection.add(e.target);
            };
            this.documentEventHandlers.onDragleave = function (e) {
                collection = collection.not(e.target);
                if (!collection.length) {
                    _this.$editor.removeClass('dragover');
                }
            };
            this.documentEventHandlers.onDrop = function () {
                collection = $$1();
                _this.$editor.removeClass('dragover');
            };
            // show dropzone on dragenter when dragging a object to document
            // -but only if the editor is visible, i.e. has a positive width and height
            this.$eventListener.on('dragenter', this.documentEventHandlers.onDragenter)
                .on('dragleave', this.documentEventHandlers.onDragleave)
                .on('drop', this.documentEventHandlers.onDrop);
            // change dropzone's message on hover.
            this.$dropzone.on('dragenter', function () {
                _this.$dropzone.addClass('hover');
                $dropzoneMessage.text(_this.lang.image.dropImage);
            }).on('dragleave', function () {
                _this.$dropzone.removeClass('hover');
                $dropzoneMessage.text(_this.lang.image.dragImageHere);
            });
            // attach dropImage
            this.$dropzone.on('drop', function (event) {
                var dataTransfer = event.originalEvent.dataTransfer;
                // stop the browser from opening the dropped content
                event.preventDefault();
                if (dataTransfer && dataTransfer.files && dataTransfer.files.length) {
                    _this.$editable.focus();
                    _this.context.invoke('editor.insertImagesOrCallback', dataTransfer.files);
                }
                else {
                    $$1.each(dataTransfer.types, function (idx, type) {
                        var content = dataTransfer.getData(type);
                        if (type.toLowerCase().indexOf('text') > -1) {
                            _this.context.invoke('editor.pasteHTML', content);
                        }
                        else {
                            $$1(content).each(function (idx, item) {
                                _this.context.invoke('editor.insertNode', item);
                            });
                        }
                    });
                }
            }).on('dragover', false); // prevent default dragover event
        };
        Dropzone.prototype.destroy = function () {
            var _this = this;
            Object.keys(this.documentEventHandlers).forEach(function (key) {
                _this.$eventListener.off(key.substr(2).toLowerCase(), _this.documentEventHandlers[key]);
            });
            this.documentEventHandlers = {};
        };
        return Dropzone;
    }());

    var CodeMirror;
    if (env.hasCodeMirror) {
        CodeMirror = window.CodeMirror;
    }
    /**
     * @class Codeview
     */
    var CodeView = /** @class */ (function () {
        function CodeView(context) {
            this.context = context;
            this.$editor = context.layoutInfo.editor;
            this.$editable = context.layoutInfo.editable;
            this.$codable = context.layoutInfo.codable;
            this.options = context.options;
        }
        CodeView.prototype.sync = function () {
            var isCodeview = this.isActivated();
            if (isCodeview && env.hasCodeMirror) {
                this.$codable.data('cmEditor').save();
            }
        };
        /**
         * @return {Boolean}
         */
        CodeView.prototype.isActivated = function () {
            return this.$editor.hasClass('codeview');
        };
        /**
         * toggle codeview
         */
        CodeView.prototype.toggle = function () {
            if (this.isActivated()) {
                this.deactivate();
            }
            else {
                this.activate();
            }
            this.context.triggerEvent('codeview.toggled');
        };
        /**
         * purify input value
         * @param value
         * @returns {*}
         */
        CodeView.prototype.purify = function (value) {
            if (this.options.codeviewFilter) {
                // filter code view regex
                value = value.replace(this.options.codeviewFilterRegex, '');
                // allow specific iframe tag
                if (this.options.codeviewIframeFilter) {
                    var whitelist_1 = this.options.codeviewIframeWhitelistSrc.concat(this.options.codeviewIframeWhitelistSrcBase);
                    value = value.replace(/(<iframe.*?>.*?(?:<\/iframe>)?)/gi, function (tag) {
                        // remove if src attribute is duplicated
                        if (/<.+src(?==?('|"|\s)?)[\s\S]+src(?=('|"|\s)?)[^>]*?>/i.test(tag)) {
                            return '';
                        }
                        for (var _i = 0, whitelist_2 = whitelist_1; _i < whitelist_2.length; _i++) {
                            var src = whitelist_2[_i];
                            // pass if src is trusted
                            if ((new RegExp('src="(https?:)?\/\/' + src.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&') + '\/(.+)"')).test(tag)) {
                                return tag;
                            }
                        }
                        return '';
                    });
                }
            }
            return value;
        };
        /**
         * activate code view
         */
        CodeView.prototype.activate = function () {
            var _this = this;
            this.$codable.val(dom.html(this.$editable, this.options.prettifyHtml));
            this.$codable.height(this.$editable.height());
            this.context.invoke('toolbar.updateCodeview', true);
            this.$editor.addClass('codeview');
            this.$codable.focus();
            // activate CodeMirror as codable
            if (env.hasCodeMirror) {
                var cmEditor_1 = CodeMirror.fromTextArea(this.$codable[0], this.options.codemirror);
                // CodeMirror TernServer
                if (this.options.codemirror.tern) {
                    var server_1 = new CodeMirror.TernServer(this.options.codemirror.tern);
                    cmEditor_1.ternServer = server_1;
                    cmEditor_1.on('cursorActivity', function (cm) {
                        server_1.updateArgHints(cm);
                    });
                }
                cmEditor_1.on('blur', function (event) {
                    _this.context.triggerEvent('blur.codeview', cmEditor_1.getValue(), event);
                });
                cmEditor_1.on('change', function (event) {
                    _this.context.triggerEvent('change.codeview', cmEditor_1.getValue(), cmEditor_1);
                });
                // CodeMirror hasn't Padding.
                cmEditor_1.setSize(null, this.$editable.outerHeight());
                this.$codable.data('cmEditor', cmEditor_1);
            }
            else {
                this.$codable.on('blur', function (event) {
                    _this.context.triggerEvent('blur.codeview', _this.$codable.val(), event);
                });
                this.$codable.on('input', function (event) {
                    _this.context.triggerEvent('change.codeview', _this.$codable.val(), _this.$codable);
                });
            }
        };
        /**
         * deactivate code view
         */
        CodeView.prototype.deactivate = function () {
            // deactivate CodeMirror as codable
            if (env.hasCodeMirror) {
                var cmEditor = this.$codable.data('cmEditor');
                this.$codable.val(cmEditor.getValue());
                cmEditor.toTextArea();
            }
            var value = this.purify(dom.value(this.$codable, this.options.prettifyHtml) || dom.emptyPara);
            var isChange = this.$editable.html() !== value;
            this.$editable.html(value);
            this.$editable.height(this.options.height ? this.$codable.height() : 'auto');
            this.$editor.removeClass('codeview');
            if (isChange) {
                this.context.triggerEvent('change', this.$editable.html(), this.$editable);
            }
            this.$editable.focus();
            this.context.invoke('toolbar.updateCodeview', false);
        };
        CodeView.prototype.destroy = function () {
            if (this.isActivated()) {
                this.deactivate();
            }
        };
        return CodeView;
    }());

    var EDITABLE_PADDING = 24;
    var Statusbar = /** @class */ (function () {
        function Statusbar(context) {
            this.$document = $$1(document);
            this.$statusbar = context.layoutInfo.statusbar;
            this.$editable = context.layoutInfo.editable;
            this.options = context.options;
        }
        Statusbar.prototype.initialize = function () {
            var _this = this;
            if (this.options.airMode || this.options.disableResizeEditor) {
                this.destroy();
                return;
            }
            this.$statusbar.on('mousedown', function (event) {
                event.preventDefault();
                event.stopPropagation();
                var editableTop = _this.$editable.offset().top - _this.$document.scrollTop();
                var onMouseMove = function (event) {
                    var height = event.clientY - (editableTop + EDITABLE_PADDING);
                    height = (_this.options.minheight > 0) ? Math.max(height, _this.options.minheight) : height;
                    height = (_this.options.maxHeight > 0) ? Math.min(height, _this.options.maxHeight) : height;
                    _this.$editable.height(height);
                };
                _this.$document.on('mousemove', onMouseMove).one('mouseup', function () {
                    _this.$document.off('mousemove', onMouseMove);
                });
            });
        };
        Statusbar.prototype.destroy = function () {
            this.$statusbar.off();
            this.$statusbar.addClass('locked');
        };
        return Statusbar;
    }());

    var Fullscreen = /** @class */ (function () {
        function Fullscreen(context) {
            var _this = this;
            this.context = context;
            this.$editor = context.layoutInfo.editor;
            this.$toolbar = context.layoutInfo.toolbar;
            this.$editable = context.layoutInfo.editable;
            this.$codable = context.layoutInfo.codable;
            this.$window = $$1(window);
            this.$scrollbar = $$1('html, body');
            this.onResize = function () {
                _this.resizeTo({
                    h: _this.$window.height() - _this.$toolbar.outerHeight()
                });
            };
        }
        Fullscreen.prototype.resizeTo = function (size) {
            this.$editable.css('height', size.h);
            this.$codable.css('height', size.h);
            if (this.$codable.data('cmeditor')) {
                this.$codable.data('cmeditor').setsize(null, size.h);
            }
        };
        /**
         * toggle fullscreen
         */
        Fullscreen.prototype.toggle = function () {
            this.$editor.toggleClass('fullscreen');
            if (this.isFullscreen()) {
                this.$editable.data('orgHeight', this.$editable.css('height'));
                this.$editable.data('orgMaxHeight', this.$editable.css('maxHeight'));
                this.$editable.css('maxHeight', '');
                this.$window.on('resize', this.onResize).trigger('resize');
                this.$scrollbar.css('overflow', 'hidden');
            }
            else {
                this.$window.off('resize', this.onResize);
                this.resizeTo({ h: this.$editable.data('orgHeight') });
                this.$editable.css('maxHeight', this.$editable.css('orgMaxHeight'));
                this.$scrollbar.css('overflow', 'visible');
            }
            this.context.invoke('toolbar.updateFullscreen', this.isFullscreen());
        };
        Fullscreen.prototype.isFullscreen = function () {
            return this.$editor.hasClass('fullscreen');
        };
        return Fullscreen;
    }());

    var Handle = /** @class */ (function () {
        function Handle(context) {
            var _this = this;
            this.context = context;
            this.$document = $$1(document);
            this.$editingArea = context.layoutInfo.editingArea;
            this.options = context.options;
            this.lang = this.options.langInfo;
            this.events = {
                'summernote.mousedown': function (we, e) {
                    if (_this.update(e.target, e)) {
                        e.preventDefault();
                    }
                },
                'summernote.keyup summernote.scroll summernote.change summernote.dialog.shown': function () {
                    _this.update();
                },
                'summernote.disable': function () {
                    _this.hide();
                },
                'summernote.codeview.toggled': function () {
                    _this.update();
                }
            };
        }
        Handle.prototype.initialize = function () {
            var _this = this;
            this.$handle = $$1([
                '<div class="note-handle">',
                '<div class="note-control-selection">',
                '<div class="note-control-selection-bg"></div>',
                '<div class="note-control-holder note-control-nw"></div>',
                '<div class="note-control-holder note-control-ne"></div>',
                '<div class="note-control-holder note-control-sw"></div>',
                '<div class="',
                (this.options.disableResizeImage ? 'note-control-holder' : 'note-control-sizing'),
                ' note-control-se"></div>',
                (this.options.disableResizeImage ? '' : '<div class="note-control-selection-info"></div>'),
                '</div>',
                '</div>',
            ].join('')).prependTo(this.$editingArea);
            this.$handle.on('mousedown', function (event) {
                if (dom.isControlSizing(event.target)) {
                    event.preventDefault();
                    event.stopPropagation();
                    var $target_1 = _this.$handle.find('.note-control-selection').data('target');
                    var posStart_1 = $target_1.offset();
                    var scrollTop_1 = _this.$document.scrollTop();
                    var onMouseMove_1 = function (event) {
                        _this.context.invoke('editor.resizeTo', {
                            x: event.clientX - posStart_1.left,
                            y: event.clientY - (posStart_1.top - scrollTop_1)
                        }, $target_1, !event.shiftKey);
                        _this.update($target_1[0]);
                    };
                    _this.$document
                        .on('mousemove', onMouseMove_1)
                        .one('mouseup', function (e) {
                            e.preventDefault();
                            _this.$document.off('mousemove', onMouseMove_1);
                            _this.context.invoke('editor.afterCommand');
                        });
                    if (!$target_1.data('ratio')) { // original ratio.
                        $target_1.data('ratio', $target_1.height() / $target_1.width());
                    }
                }
            });
            // Listen for scrolling on the handle overlay.
            this.$handle.on('wheel', function (e) {
                e.preventDefault();
                _this.update();
            });
        };
        Handle.prototype.destroy = function () {
            this.$handle.remove();
        };
        Handle.prototype.update = function (target, event) {
            if (this.context.isDisabled()) {
                return false;
            }
            var isImage = dom.isImg(target);
            var $selection = this.$handle.find('.note-control-selection');
            this.context.invoke('imagePopover.update', target, event);
            if (isImage) {
                var $image = $$1(target);
                var position = $image.position();
                var pos = {
                    left: position.left + parseInt($image.css('marginLeft'), 10),
                    top: position.top + parseInt($image.css('marginTop'), 10)
                };
                // exclude margin
                var imageSize = {
                    w: $image.outerWidth(false),
                    h: $image.outerHeight(false)
                };
                $selection.css({
                    display: 'block',
                    left: pos.left,
                    top: pos.top,
                    width: imageSize.w,
                    height: imageSize.h
                }).data('target', $image); // save current image element.
                var origImageObj = new Image();
                origImageObj.src = $image.attr('src');
                var sizingText = imageSize.w + 'x' + imageSize.h + ' (' + this.lang.image.original + ': ' + origImageObj.width + 'x' + origImageObj.height + ')';
                $selection.find('.note-control-selection-info').text(sizingText);
                this.context.invoke('editor.saveTarget', target);
            }
            else {
                this.hide();
            }
            return isImage;
        };
        /**
         * hide
         *
         * @param {jQuery} $handle
         */
        Handle.prototype.hide = function () {
            this.context.invoke('editor.clearTarget');
            this.$handle.children().hide();
        };
        return Handle;
    }());

    var defaultScheme = 'http://';
    var linkPattern = /^([A-Za-z][A-Za-z0-9+-.]*\:[\/]{2}|mailto:[A-Z0-9._%+-]+@)?(www\.)?(.+)$/i;
    var AutoLink = /** @class */ (function () {
        function AutoLink(context) {
            var _this = this;
            this.context = context;
            this.events = {
                'summernote.keyup': function (we, e) {
                    if (!e.isDefaultPrevented()) {
                        _this.handleKeyup(e);
                    }
                },
                'summernote.keydown': function (we, e) {
                    _this.handleKeydown(e);
                }
            };
        }
        AutoLink.prototype.initialize = function () {
            this.lastWordRange = null;
        };
        AutoLink.prototype.destroy = function () {
            this.lastWordRange = null;
        };
        AutoLink.prototype.replace = function () {
            if (!this.lastWordRange) {
                return;
            }
            var keyword = this.lastWordRange.toString();
            var match = keyword.match(linkPattern);
            if (match && (match[1] || match[2])) {
                var link = match[1] ? keyword : defaultScheme + keyword;
                var node = $$1('<a />').html(keyword).attr('href', link)[0];
                if (this.context.options.linkTargetBlank) {
                    $$1(node).attr('target', '_blank');
                }
                this.lastWordRange.insertNode(node);
                this.lastWordRange = null;
                this.context.invoke('editor.focus');
            }
        };
        AutoLink.prototype.handleKeydown = function (e) {
            if (lists.contains([key.code.ENTER, key.code.SPACE], e.keyCode)) {
                var wordRange = this.context.invoke('editor.createRange').getWordRange();
                this.lastWordRange = wordRange;
            }
        };
        AutoLink.prototype.handleKeyup = function (e) {
            if (lists.contains([key.code.ENTER, key.code.SPACE], e.keyCode)) {
                this.replace();
            }
        };
        return AutoLink;
    }());

    /**
     * textarea auto sync.
     */
    var AutoSync = /** @class */ (function () {
        function AutoSync(context) {
            var _this = this;
            this.$note = context.layoutInfo.note;
            this.events = {
                'summernote.change': function () {
                    _this.$note.val(context.invoke('code'));
                }
            };
        }
        AutoSync.prototype.shouldInitialize = function () {
            return dom.isTextarea(this.$note[0]);
        };
        return AutoSync;
    }());

    var AutoReplace = /** @class */ (function () {
        function AutoReplace(context) {
            var _this = this;
            this.context = context;
            this.options = context.options.replace || {};
            this.keys = [key.code.ENTER, key.code.SPACE, key.code.PERIOD, key.code.COMMA, key.code.SEMICOLON, key.code.SLASH];
            this.previousKeydownCode = null;
            this.events = {
                'summernote.keyup': function (we, e) {
                    if (!e.isDefaultPrevented()) {
                        _this.handleKeyup(e);
                    }
                },
                'summernote.keydown': function (we, e) {
                    _this.handleKeydown(e);
                }
            };
        }
        AutoReplace.prototype.shouldInitialize = function () {
            return !!this.options.match;
        };
        AutoReplace.prototype.initialize = function () {
            this.lastWord = null;
        };
        AutoReplace.prototype.destroy = function () {
            this.lastWord = null;
        };
        AutoReplace.prototype.replace = function () {
            if (!this.lastWord) {
                return;
            }
            var self = this;
            var keyword = this.lastWord.toString();
            this.options.match(keyword, function (match) {
                if (match) {
                    var node = '';
                    if (typeof match === 'string') {
                        node = dom.createText(match);
                    }
                    else if (match instanceof jQuery) {
                        node = match[0];
                    }
                    else if (match instanceof Node) {
                        node = match;
                    }
                    if (!node)
                        return;
                    self.lastWord.insertNode(node);
                    self.lastWord = null;
                    self.context.invoke('editor.focus');
                }
            });
        };
        AutoReplace.prototype.handleKeydown = function (e) {
            // this forces it to remember the last whole word, even if multiple termination keys are pressed
            // before the previous key is let go.
            if (this.previousKeydownCode && lists.contains(this.keys, this.previousKeydownCode)) {
                this.previousKeydownCode = e.keyCode;
                return;
            }
            if (lists.contains(this.keys, e.keyCode)) {
                var wordRange = this.context.invoke('editor.createRange').getWordRange();
                this.lastWord = wordRange;
            }
            this.previousKeydownCode = e.keyCode;
        };
        AutoReplace.prototype.handleKeyup = function (e) {
            if (lists.contains(this.keys, e.keyCode)) {
                this.replace();
            }
        };
        return AutoReplace;
    }());

    var Placeholder = /** @class */ (function () {
        function Placeholder(context) {
            var _this = this;
            this.context = context;
            this.$editingArea = context.layoutInfo.editingArea;
            this.options = context.options;
            this.events = {
                'summernote.init summernote.change': function () {
                    _this.update();
                },
                'summernote.codeview.toggled': function () {
                    _this.update();
                }
            };
        }
        Placeholder.prototype.shouldInitialize = function () {
            return !!this.options.placeholder;
        };
        Placeholder.prototype.initialize = function () {
            var _this = this;
            this.$placeholder = $$1('<div class="note-placeholder">');
            this.$placeholder.on('click', function () {
                _this.context.invoke('focus');
            }).html(this.options.placeholder).prependTo(this.$editingArea);
            this.update();
        };
        Placeholder.prototype.destroy = function () {
            this.$placeholder.remove();
        };
        Placeholder.prototype.update = function () {
            var isShow = !this.context.invoke('codeview.isActivated') && this.context.invoke('editor.isEmpty');
            this.$placeholder.toggle(isShow);
        };
        return Placeholder;
    }());

    var Buttons = /** @class */ (function () {
        function Buttons(context) {
            this.ui = $$1.summernote.ui;
            this.context = context;
            this.$toolbar = context.layoutInfo.toolbar;
            this.options = context.options;
            this.lang = this.options.langInfo;
            this.invertedKeyMap = func.invertObject(this.options.keyMap[env.isMac ? 'mac' : 'pc']);
        }
        Buttons.prototype.representShortcut = function (editorMethod) {
            var shortcut = this.invertedKeyMap[editorMethod];
            if (!this.options.shortcuts || !shortcut) {
                return '';
            }
            if (env.isMac) {
                shortcut = shortcut.replace('CMD', '⌘').replace('SHIFT', '⇧');
            }
            shortcut = shortcut.replace('BACKSLASH', '\\')
                .replace('SLASH', '/')
                .replace('LEFTBRACKET', '[')
                .replace('RIGHTBRACKET', ']');
            return ' (' + shortcut + ')';
        };
        Buttons.prototype.button = function (o) {
            if (!this.options.tooltip && o.tooltip) {
                delete o.tooltip;
            }
            o.container = this.options.container;
            return this.ui.button(o);
        };
        Buttons.prototype.initialize = function () {
            this.addToolbarButtons();
            this.addImagePopoverButtons();
            this.addLinkPopoverButtons();
            this.addTablePopoverButtons();
            this.fontInstalledMap = {};
        };
        Buttons.prototype.destroy = function () {
            delete this.fontInstalledMap;
        };
        Buttons.prototype.isFontInstalled = function (name) {
            if (!this.fontInstalledMap.hasOwnProperty(name)) {
                this.fontInstalledMap[name] = env.isFontInstalled(name) ||
                    lists.contains(this.options.fontNamesIgnoreCheck, name);
            }
            return this.fontInstalledMap[name];
        };
        Buttons.prototype.isFontDeservedToAdd = function (name) {
            var genericFamilies = ['sans-serif', 'serif', 'monospace', 'cursive', 'fantasy'];
            name = name.toLowerCase();
            return (name !== '' && this.isFontInstalled(name) && genericFamilies.indexOf(name) === -1);
        };
        Buttons.prototype.colorPalette = function (className, tooltip, backColor, foreColor) {
            var _this = this;
            return this.ui.buttonGroup({
                className: 'note-color ' + className,
                children: [
                    this.button({
                        className: 'note-current-color-button',
                        contents: this.ui.icon(this.options.icons.font + ' note-recent-color'),
                        tooltip: tooltip,
                        click: function (e) {
                            var $button = $$1(e.currentTarget);
                            if (backColor && foreColor) {
                                _this.context.invoke('editor.color', {
                                    backColor: $button.attr('data-backColor'),
                                    foreColor: $button.attr('data-foreColor')
                                });
                            }
                            else if (backColor) {
                                _this.context.invoke('editor.color', {
                                    backColor: $button.attr('data-backColor')
                                });
                            }
                            else if (foreColor) {
                                _this.context.invoke('editor.color', {
                                    foreColor: $button.attr('data-foreColor')
                                });
                            }
                        },
                        callback: function ($button) {
                            var $recentColor = $button.find('.note-recent-color');
                            if (backColor) {
                                $recentColor.css('background-color', _this.options.colorButton.backColor);
                                $button.attr('data-backColor', _this.options.colorButton.backColor);
                            }
                            if (foreColor) {
                                $recentColor.css('color', _this.options.colorButton.foreColor);
                                $button.attr('data-foreColor', _this.options.colorButton.foreColor);
                            }
                            else {
                                $recentColor.css('color', 'transparent');
                            }
                        }
                    }),
                    this.button({
                        className: 'dropdown-toggle',
                        contents: this.ui.dropdownButtonContents('', this.options),
                        tooltip: this.lang.color.more,
                        data: {
                            toggle: 'dropdown'
                        }
                    }),
                    this.ui.dropdown({
                        items: (backColor ? [
                                '<div class="note-palette">',
                                '  <div class="note-palette-title">' + this.lang.color.background + '</div>',
                                '  <div>',
                                '    <button type="button" class="note-color-reset btn btn-light" data-event="backColor" data-value="inherit">',
                                this.lang.color.transparent,
                                '    </button>',
                                '  </div>',
                                '  <div class="note-holder" data-event="backColor"/>',
                                '  <div>',
                                '    <button type="button" class="note-color-select btn" data-event="openPalette" data-value="backColorPicker">',
                                this.lang.color.cpSelect,
                                '    </button>',
                                '    <input type="color" id="backColorPicker" class="note-btn note-color-select-btn" value="' + this.options.colorButton.backColor + '" data-event="backColorPalette">',
                                '  </div>',
                                '  <div class="note-holder-custom" id="backColorPalette" data-event="backColor"/>',
                                '</div>',
                            ].join('') : '') +
                            (foreColor ? [
                                '<div class="note-palette">',
                                '  <div class="note-palette-title">' + this.lang.color.foreground + '</div>',
                                '  <div>',
                                '    <button type="button" class="note-color-reset btn btn-light" data-event="removeFormat" data-value="foreColor">',
                                this.lang.color.resetToDefault,
                                '    </button>',
                                '  </div>',
                                '  <div class="note-holder" data-event="foreColor"/>',
                                '  <div>',
                                '    <button type="button" class="note-color-select btn" data-event="openPalette" data-value="foreColorPicker">',
                                this.lang.color.cpSelect,
                                '    </button>',
                                '    <input type="color" id="foreColorPicker" class="note-btn note-color-select-btn" value="' + this.options.colorButton.foreColor + '" data-event="foreColorPalette">',
                                '  <div class="note-holder-custom" id="foreColorPalette" data-event="foreColor"/>',
                                '</div>',
                            ].join('') : ''),
                        callback: function ($dropdown) {
                            $dropdown.find('.note-holder').each(function (idx, item) {
                                var $holder = $$1(item);
                                $holder.append(_this.ui.palette({
                                    colors: _this.options.colors,
                                    colorsName: _this.options.colorsName,
                                    eventName: $holder.data('event'),
                                    container: _this.options.container,
                                    tooltip: _this.options.tooltip
                                }).render());
                            });
                            /* TODO: do we have to record recent custom colors within cookies? */
                            var customColors = [
                                ['#FFFFFF', '#FFFFFF', '#FFFFFF', '#FFFFFF', '#FFFFFF', '#FFFFFF', '#FFFFFF', '#FFFFFF'],
                            ];
                            $dropdown.find('.note-holder-custom').each(function (idx, item) {
                                var $holder = $$1(item);
                                $holder.append(_this.ui.palette({
                                    colors: customColors,
                                    colorsName: customColors,
                                    eventName: $holder.data('event'),
                                    container: _this.options.container,
                                    tooltip: _this.options.tooltip
                                }).render());
                            });
                            $dropdown.find('input[type=color]').each(function (idx, item) {
                                $$1(item).change(function () {
                                    var $chip = $dropdown.find('#' + $$1(this).data('event')).find('.note-color-btn').first();
                                    var color = this.value.toUpperCase();
                                    $chip.css('background-color', color)
                                        .attr('aria-label', color)
                                        .attr('data-value', color)
                                        .attr('data-original-title', color);
                                    $chip.click();
                                });
                            });
                        },
                        click: function (event) {
                            event.stopPropagation();
                            var $parent = $$1('.' + className);
                            var $button = $$1(event.target);
                            var eventName = $button.data('event');
                            var value = $button.attr('data-value');
                            if (eventName === 'openPalette') {
                                var $picker = $parent.find('#' + value);
                                var $palette = $$1($parent.find('#' + $picker.data('event')).find('.note-color-row')[0]);
                                // Shift palette chips
                                var $chip = $palette.find('.note-color-btn').last().detach();
                                // Set chip attributes
                                var color = $picker.val();
                                $chip.css('background-color', color)
                                    .attr('aria-label', color)
                                    .attr('data-value', color)
                                    .attr('data-original-title', color);
                                $palette.prepend($chip);
                                $picker.click();
                            }
                            else if (lists.contains(['backColor', 'foreColor'], eventName)) {
                                var key = eventName === 'backColor' ? 'background-color' : 'color';
                                var $color = $button.closest('.note-color').find('.note-recent-color');
                                var $currentButton = $button.closest('.note-color').find('.note-current-color-button');
                                $color.css(key, value);
                                $currentButton.attr('data-' + eventName, value);
                                _this.context.invoke('editor.' + eventName, value);
                            }
                        }
                    }),
                ]
            }).render();
        };
        Buttons.prototype.addToolbarButtons = function () {
            var _this = this;
            this.context.memo('button.style', function () {
                return _this.ui.buttonGroup([
                    _this.button({
                        className: 'dropdown-toggle',
                        contents: _this.ui.dropdownButtonContents(_this.ui.icon(_this.options.icons.magic), _this.options),
                        tooltip: _this.lang.style.style,
                        data: {
                            toggle: 'dropdown'
                        }
                    }),
                    _this.ui.dropdown({
                        className: 'dropdown-style',
                        items: _this.options.styleTags,
                        title: _this.lang.style.style,
                        template: function (item) {
                            if (typeof item === 'string') {
                                item = { tag: item, title: (_this.lang.style.hasOwnProperty(item) ? _this.lang.style[item] : item) };
                            }
                            var tag = item.tag;
                            var title = item.title;
                            var style = item.style ? ' style="' + item.style + '" ' : '';
                            var className = item.className ? ' class="' + item.className + '"' : '';
                            return '<' + tag + style + className + '>' + title + '</' + tag + '>';
                        },
                        click: _this.context.createInvokeHandler('editor.formatBlock')
                    }),
                ]).render();
            });
            var _loop_1 = function (styleIdx, styleLen) {
                var item = this_1.options.styleTags[styleIdx];
                this_1.context.memo('button.style.' + item, function () {
                    return _this.button({
                        className: 'note-btn-style-' + item,
                        contents: '<div data-value="' + item + '">' + item.toUpperCase() + '</div>',
                        tooltip: _this.lang.style[item],
                        click: _this.context.createInvokeHandler('editor.formatBlock')
                    }).render();
                });
            };
            var this_1 = this;
            for (var styleIdx = 0, styleLen = this.options.styleTags.length; styleIdx < styleLen; styleIdx++) {
                _loop_1(styleIdx, styleLen);
            }
            this.context.memo('button.bold', function () {
                return _this.button({
                    className: 'note-btn-bold',
                    contents: _this.ui.icon(_this.options.icons.bold),
                    tooltip: _this.lang.font.bold + _this.representShortcut('bold'),
                    click: _this.context.createInvokeHandlerAndUpdateState('editor.bold')
                }).render();
            });
            this.context.memo('button.italic', function () {
                return _this.button({
                    className: 'note-btn-italic',
                    contents: _this.ui.icon(_this.options.icons.italic),
                    tooltip: _this.lang.font.italic + _this.representShortcut('italic'),
                    click: _this.context.createInvokeHandlerAndUpdateState('editor.italic')
                }).render();
            });
            this.context.memo('button.underline', function () {
                return _this.button({
                    className: 'note-btn-underline',
                    contents: _this.ui.icon(_this.options.icons.underline),
                    tooltip: _this.lang.font.underline + _this.representShortcut('underline'),
                    click: _this.context.createInvokeHandlerAndUpdateState('editor.underline')
                }).render();
            });
            this.context.memo('button.clear', function () {
                return _this.button({
                    contents: _this.ui.icon(_this.options.icons.eraser),
                    tooltip: _this.lang.font.clear + _this.representShortcut('removeFormat'),
                    click: _this.context.createInvokeHandler('editor.removeFormat')
                }).render();
            });
            this.context.memo('button.strikethrough', function () {
                return _this.button({
                    className: 'note-btn-strikethrough',
                    contents: _this.ui.icon(_this.options.icons.strikethrough),
                    tooltip: _this.lang.font.strikethrough + _this.representShortcut('strikethrough'),
                    click: _this.context.createInvokeHandlerAndUpdateState('editor.strikethrough')
                }).render();
            });
            this.context.memo('button.superscript', function () {
                return _this.button({
                    className: 'note-btn-superscript',
                    contents: _this.ui.icon(_this.options.icons.superscript),
                    tooltip: _this.lang.font.superscript,
                    click: _this.context.createInvokeHandlerAndUpdateState('editor.superscript')
                }).render();
            });
            this.context.memo('button.subscript', function () {
                return _this.button({
                    className: 'note-btn-subscript',
                    contents: _this.ui.icon(_this.options.icons.subscript),
                    tooltip: _this.lang.font.subscript,
                    click: _this.context.createInvokeHandlerAndUpdateState('editor.subscript')
                }).render();
            });
            this.context.memo('button.fontname', function () {
                var styleInfo = _this.context.invoke('editor.currentStyle');
                // Add 'default' fonts into the fontnames array if not exist
                $$1.each(styleInfo['font-family'].split(','), function (idx, fontname) {
                    fontname = fontname.trim().replace(/['"]+/g, '');
                    if (_this.isFontDeservedToAdd(fontname)) {
                        if (_this.options.fontNames.indexOf(fontname) === -1) {
                            _this.options.fontNames.push(fontname);
                        }
                    }
                });
                return _this.ui.buttonGroup([
                    _this.button({
                        className: 'dropdown-toggle',
                        contents: _this.ui.dropdownButtonContents('<span class="note-current-fontname"/>', _this.options),
                        tooltip: _this.lang.font.name,
                        data: {
                            toggle: 'dropdown'
                        }
                    }),
                    _this.ui.dropdownCheck({
                        className: 'dropdown-fontname',
                        checkClassName: _this.options.icons.menuCheck,
                        items: _this.options.fontNames.filter(_this.isFontInstalled.bind(_this)),
                        title: _this.lang.font.name,
                        template: function (item) {
                            return '<span style="font-family: \'' + item + '\'">' + item + '</span>';
                        },
                        click: _this.context.createInvokeHandlerAndUpdateState('editor.fontName')
                    }),
                ]).render();
            });
            this.context.memo('button.fontsize', function () {
                return _this.ui.buttonGroup([
                    _this.button({
                        className: 'dropdown-toggle',
                        contents: _this.ui.dropdownButtonContents('<span class="note-current-fontsize"/>', _this.options),
                        tooltip: _this.lang.font.size,
                        data: {
                            toggle: 'dropdown'
                        }
                    }),
                    _this.ui.dropdownCheck({
                        className: 'dropdown-fontsize',
                        checkClassName: _this.options.icons.menuCheck,
                        items: _this.options.fontSizes,
                        title: _this.lang.font.size,
                        click: _this.context.createInvokeHandlerAndUpdateState('editor.fontSize')
                    }),
                ]).render();
            });
            this.context.memo('button.color', function () {
                return _this.colorPalette('note-color-all', _this.lang.color.recent, true, true);
            });
            this.context.memo('button.forecolor', function () {
                return _this.colorPalette('note-color-fore', _this.lang.color.foreground, false, true);
            });
            this.context.memo('button.backcolor', function () {
                return _this.colorPalette('note-color-back', _this.lang.color.background, true, false);
            });
            this.context.memo('button.ul', function () {
                return _this.button({
                    contents: _this.ui.icon(_this.options.icons.unorderedlist),
                    tooltip: _this.lang.lists.unordered + _this.representShortcut('insertUnorderedList'),
                    click: _this.context.createInvokeHandler('editor.insertUnorderedList')
                }).render();
            });
            this.context.memo('button.ol', function () {
                return _this.button({
                    contents: _this.ui.icon(_this.options.icons.orderedlist),
                    tooltip: _this.lang.lists.ordered + _this.representShortcut('insertOrderedList'),
                    click: _this.context.createInvokeHandler('editor.insertOrderedList')
                }).render();
            });
            var justifyLeft = this.button({
                contents: this.ui.icon(this.options.icons.alignLeft),
                tooltip: this.lang.paragraph.left + this.representShortcut('justifyLeft'),
                click: this.context.createInvokeHandler('editor.justifyLeft')
            });
            var justifyCenter = this.button({
                contents: this.ui.icon(this.options.icons.alignCenter),
                tooltip: this.lang.paragraph.center + this.representShortcut('justifyCenter'),
                click: this.context.createInvokeHandler('editor.justifyCenter')
            });
            var justifyRight = this.button({
                contents: this.ui.icon(this.options.icons.alignRight),
                tooltip: this.lang.paragraph.right + this.representShortcut('justifyRight'),
                click: this.context.createInvokeHandler('editor.justifyRight')
            });
            var justifyFull = this.button({
                contents: this.ui.icon(this.options.icons.alignJustify),
                tooltip: this.lang.paragraph.justify + this.representShortcut('justifyFull'),
                click: this.context.createInvokeHandler('editor.justifyFull')
            });
            var outdent = this.button({
                contents: this.ui.icon(this.options.icons.outdent),
                tooltip: this.lang.paragraph.outdent + this.representShortcut('outdent'),
                click: this.context.createInvokeHandler('editor.outdent')
            });
            var indent = this.button({
                contents: this.ui.icon(this.options.icons.indent),
                tooltip: this.lang.paragraph.indent + this.representShortcut('indent'),
                click: this.context.createInvokeHandler('editor.indent')
            });
            this.context.memo('button.justifyLeft', func.invoke(justifyLeft, 'render'));
            this.context.memo('button.justifyCenter', func.invoke(justifyCenter, 'render'));
            this.context.memo('button.justifyRight', func.invoke(justifyRight, 'render'));
            this.context.memo('button.justifyFull', func.invoke(justifyFull, 'render'));
            this.context.memo('button.outdent', func.invoke(outdent, 'render'));
            this.context.memo('button.indent', func.invoke(indent, 'render'));
            this.context.memo('button.paragraph', function () {
                return _this.ui.buttonGroup([
                    _this.button({
                        className: 'dropdown-toggle',
                        contents: _this.ui.dropdownButtonContents(_this.ui.icon(_this.options.icons.alignLeft), _this.options),
                        tooltip: _this.lang.paragraph.paragraph,
                        data: {
                            toggle: 'dropdown'
                        }
                    }),
                    _this.ui.dropdown([
                        _this.ui.buttonGroup({
                            className: 'note-align',
                            children: [justifyLeft, justifyCenter, justifyRight, justifyFull]
                        }),
                        _this.ui.buttonGroup({
                            className: 'note-list',
                            children: [outdent, indent]
                        }),
                    ]),
                ]).render();
            });
            this.context.memo('button.height', function () {
                return _this.ui.buttonGroup([
                    _this.button({
                        className: 'dropdown-toggle',
                        contents: _this.ui.dropdownButtonContents(_this.ui.icon(_this.options.icons.textHeight), _this.options),
                        tooltip: _this.lang.font.height,
                        data: {
                            toggle: 'dropdown'
                        }
                    }),
                    _this.ui.dropdownCheck({
                        items: _this.options.lineHeights,
                        checkClassName: _this.options.icons.menuCheck,
                        className: 'dropdown-line-height',
                        title: _this.lang.font.height,
                        click: _this.context.createInvokeHandler('editor.lineHeight')
                    }),
                ]).render();
            });
            this.context.memo('button.table', function () {
                return _this.ui.buttonGroup([
                    _this.button({
                        className: 'dropdown-toggle',
                        contents: _this.ui.dropdownButtonContents(_this.ui.icon(_this.options.icons.table), _this.options),
                        tooltip: _this.lang.table.table,
                        data: {
                            toggle: 'dropdown'
                        }
                    }),
                    _this.ui.dropdown({
                        title: _this.lang.table.table,
                        className: 'note-table',
                        items: [
                            '<div class="note-dimension-picker">',
                            '  <div class="note-dimension-picker-mousecatcher" data-event="insertTable" data-value="1x1"/>',
                            '  <div class="note-dimension-picker-highlighted"/>',
                            '  <div class="note-dimension-picker-unhighlighted"/>',
                            '</div>',
                            '<div class="note-dimension-display">1 x 1</div>',
                        ].join('')
                    }),
                ], {
                    callback: function ($node) {
                        var $catcher = $node.find('.note-dimension-picker-mousecatcher');
                        $catcher.css({
                            width: _this.options.insertTableMaxSize.col + 'em',
                            height: _this.options.insertTableMaxSize.row + 'em'
                        }).mousedown(_this.context.createInvokeHandler('editor.insertTable'))
                            .on('mousemove', _this.tableMoveHandler.bind(_this));
                    }
                }).render();
            });
            this.context.memo('button.link', function () {
                return _this.button({
                    contents: _this.ui.icon(_this.options.icons.link),
                    tooltip: _this.lang.link.link + _this.representShortcut('linkDialog.show'),
                    click: _this.context.createInvokeHandler('linkDialog.show')
                }).render();
            });
            this.context.memo('button.picture', function () {
                return _this.button({
                    contents: _this.ui.icon(_this.options.icons.picture),
                    tooltip: _this.lang.image.image,
                    click: _this.context.createInvokeHandler('imageDialog.show')
                }).render();
            });
            this.context.memo('button.video', function () {
                return _this.button({
                    contents: _this.ui.icon(_this.options.icons.video),
                    tooltip: _this.lang.video.video,
                    click: _this.context.createInvokeHandler('videoDialog.show')
                }).render();
            });
            this.context.memo('button.hr', function () {
                return _this.button({
                    contents: _this.ui.icon(_this.options.icons.minus),
                    tooltip: _this.lang.hr.insert + _this.representShortcut('insertHorizontalRule'),
                    click: _this.context.createInvokeHandler('editor.insertHorizontalRule')
                }).render();
            });
            this.context.memo('button.fullscreen', function () {
                return _this.button({
                    className: 'btn-fullscreen',
                    contents: _this.ui.icon(_this.options.icons.arrowsAlt),
                    tooltip: _this.lang.options.fullscreen,
                    click: _this.context.createInvokeHandler('fullscreen.toggle')
                }).render();
            });
            this.context.memo('button.codeview', function () {
                return _this.button({
                    className: 'btn-codeview',
                    contents: _this.ui.icon(_this.options.icons.code),
                    tooltip: _this.lang.options.codeview,
                    click: _this.context.createInvokeHandler('codeview.toggle')
                }).render();
            });
            this.context.memo('button.redo', function () {
                return _this.button({
                    contents: _this.ui.icon(_this.options.icons.redo),
                    tooltip: _this.lang.history.redo + _this.representShortcut('redo'),
                    click: _this.context.createInvokeHandler('editor.redo')
                }).render();
            });
            this.context.memo('button.undo', function () {
                return _this.button({
                    contents: _this.ui.icon(_this.options.icons.undo),
                    tooltip: _this.lang.history.undo + _this.representShortcut('undo'),
                    click: _this.context.createInvokeHandler('editor.undo')
                }).render();
            });
            this.context.memo('button.help', function () {
                return _this.button({
                    contents: _this.ui.icon(_this.options.icons.question),
                    tooltip: _this.lang.options.help,
                    click: _this.context.createInvokeHandler('helpDialog.show')
                }).render();
            });
        };
        /**
         * image: [
         *   ['imageResize', ['resizeFull', 'resizeHalf', 'resizeQuarter', 'resizeNone']],
         *   ['float', ['floatLeft', 'floatRight', 'floatNone']],
         *   ['remove', ['removeMedia']],
         * ],
         */
        Buttons.prototype.addImagePopoverButtons = function () {
            var _this = this;
            // Image Size Buttons
            this.context.memo('button.resizeFull', function () {
                return _this.button({
                    contents: '<span class="note-fontsize-10">100%</span>',
                    tooltip: _this.lang.image.resizeFull,
                    click: _this.context.createInvokeHandler('editor.resize', '1')
                }).render();
            });
            this.context.memo('button.resizeHalf', function () {
                return _this.button({
                    contents: '<span class="note-fontsize-10">50%</span>',
                    tooltip: _this.lang.image.resizeHalf,
                    click: _this.context.createInvokeHandler('editor.resize', '0.5')
                }).render();
            });
            this.context.memo('button.resizeQuarter', function () {
                return _this.button({
                    contents: '<span class="note-fontsize-10">25%</span>',
                    tooltip: _this.lang.image.resizeQuarter,
                    click: _this.context.createInvokeHandler('editor.resize', '0.25')
                }).render();
            });
            this.context.memo('button.resizeNone', function () {
                return _this.button({
                    contents: _this.ui.icon(_this.options.icons.rollback),
                    tooltip: _this.lang.image.resizeNone,
                    click: _this.context.createInvokeHandler('editor.resize', '0')
                }).render();
            });
            // Float Buttons
            this.context.memo('button.floatLeft', function () {
                return _this.button({
                    contents: _this.ui.icon(_this.options.icons.floatLeft),
                    tooltip: _this.lang.image.floatLeft,
                    click: _this.context.createInvokeHandler('editor.floatMe', 'left')
                }).render();
            });
            this.context.memo('button.floatRight', function () {
                return _this.button({
                    contents: _this.ui.icon(_this.options.icons.floatRight),
                    tooltip: _this.lang.image.floatRight,
                    click: _this.context.createInvokeHandler('editor.floatMe', 'right')
                }).render();
            });
            this.context.memo('button.floatNone', function () {
                return _this.button({
                    contents: _this.ui.icon(_this.options.icons.rollback),
                    tooltip: _this.lang.image.floatNone,
                    click: _this.context.createInvokeHandler('editor.floatMe', 'none')
                }).render();
            });
            // Remove Buttons
            this.context.memo('button.removeMedia', function () {
                return _this.button({
                    contents: _this.ui.icon(_this.options.icons.trash),
                    tooltip: _this.lang.image.remove,
                    click: _this.context.createInvokeHandler('editor.removeMedia')
                }).render();
            });
        };
        Buttons.prototype.addLinkPopoverButtons = function () {
            var _this = this;
            this.context.memo('button.linkDialogShow', function () {
                return _this.button({
                    contents: _this.ui.icon(_this.options.icons.link),
                    tooltip: _this.lang.link.edit,
                    click: _this.context.createInvokeHandler('linkDialog.show')
                }).render();
            });
            this.context.memo('button.unlink', function () {
                return _this.button({
                    contents: _this.ui.icon(_this.options.icons.unlink),
                    tooltip: _this.lang.link.unlink,
                    click: _this.context.createInvokeHandler('editor.unlink')
                }).render();
            });
        };
        /**
         * table : [
         *  ['add', ['addRowDown', 'addRowUp', 'addColLeft', 'addColRight']],
         *  ['delete', ['deleteRow', 'deleteCol', 'deleteTable']]
         * ],
         */
        Buttons.prototype.addTablePopoverButtons = function () {
            var _this = this;
            this.context.memo('button.addRowUp', function () {
                return _this.button({
                    className: 'btn-md',
                    contents: _this.ui.icon(_this.options.icons.rowAbove),
                    tooltip: _this.lang.table.addRowAbove,
                    click: _this.context.createInvokeHandler('editor.addRow', 'top')
                }).render();
            });
            this.context.memo('button.addRowDown', function () {
                return _this.button({
                    className: 'btn-md',
                    contents: _this.ui.icon(_this.options.icons.rowBelow),
                    tooltip: _this.lang.table.addRowBelow,
                    click: _this.context.createInvokeHandler('editor.addRow', 'bottom')
                }).render();
            });
            this.context.memo('button.addColLeft', function () {
                return _this.button({
                    className: 'btn-md',
                    contents: _this.ui.icon(_this.options.icons.colBefore),
                    tooltip: _this.lang.table.addColLeft,
                    click: _this.context.createInvokeHandler('editor.addCol', 'left')
                }).render();
            });
            this.context.memo('button.addColRight', function () {
                return _this.button({
                    className: 'btn-md',
                    contents: _this.ui.icon(_this.options.icons.colAfter),
                    tooltip: _this.lang.table.addColRight,
                    click: _this.context.createInvokeHandler('editor.addCol', 'right')
                }).render();
            });
            this.context.memo('button.deleteRow', function () {
                return _this.button({
                    className: 'btn-md',
                    contents: _this.ui.icon(_this.options.icons.rowRemove),
                    tooltip: _this.lang.table.delRow,
                    click: _this.context.createInvokeHandler('editor.deleteRow')
                }).render();
            });
            this.context.memo('button.deleteCol', function () {
                return _this.button({
                    className: 'btn-md',
                    contents: _this.ui.icon(_this.options.icons.colRemove),
                    tooltip: _this.lang.table.delCol,
                    click: _this.context.createInvokeHandler('editor.deleteCol')
                }).render();
            });
            this.context.memo('button.deleteTable', function () {
                return _this.button({
                    className: 'btn-md',
                    contents: _this.ui.icon(_this.options.icons.trash),
                    tooltip: _this.lang.table.delTable,
                    click: _this.context.createInvokeHandler('editor.deleteTable')
                }).render();
            });
        };
        Buttons.prototype.build = function ($container, groups) {
            for (var groupIdx = 0, groupLen = groups.length; groupIdx < groupLen; groupIdx++) {
                var group = groups[groupIdx];
                var groupName = Array.isArray(group) ? group[0] : group;
                var buttons = Array.isArray(group) ? ((group.length === 1) ? [group[0]] : group[1]) : [group];
                var $group = this.ui.buttonGroup({
                    className: 'note-' + groupName
                }).render();
                for (var idx = 0, len = buttons.length; idx < len; idx++) {
                    var btn = this.context.memo('button.' + buttons[idx]);
                    if (btn) {
                        $group.append(typeof btn === 'function' ? btn() : btn);
                    }
                }
                $group.appendTo($container);
            }
        };
        /**
         * @param {jQuery} [$container]
         */
        Buttons.prototype.updateCurrentStyle = function ($container) {
            var _this = this;
            var $cont = $container || this.$toolbar;
            var styleInfo = this.context.invoke('editor.currentStyle');
            this.updateBtnStates($cont, {
                '.note-btn-bold': function () {
                    return styleInfo['font-bold'] === 'bold';
                },
                '.note-btn-italic': function () {
                    return styleInfo['font-italic'] === 'italic';
                },
                '.note-btn-underline': function () {
                    return styleInfo['font-underline'] === 'underline';
                },
                '.note-btn-subscript': function () {
                    return styleInfo['font-subscript'] === 'subscript';
                },
                '.note-btn-superscript': function () {
                    return styleInfo['font-superscript'] === 'superscript';
                },
                '.note-btn-strikethrough': function () {
                    return styleInfo['font-strikethrough'] === 'strikethrough';
                }
            });
            if (styleInfo['font-family']) {
                var fontNames = styleInfo['font-family'].split(',').map(function (name) {
                    return name.replace(/[\'\"]/g, '')
                        .replace(/\s+$/, '')
                        .replace(/^\s+/, '');
                });
                var fontName_1 = lists.find(fontNames, this.isFontInstalled.bind(this));
                $cont.find('.dropdown-fontname a').each(function (idx, item) {
                    var $item = $$1(item);
                    // always compare string to avoid creating another func.
                    var isChecked = ($item.data('value') + '') === (fontName_1 + '');
                    $item.toggleClass('checked', isChecked);
                });
                $cont.find('.note-current-fontname').text(fontName_1).css('font-family', fontName_1);
            }
            if (styleInfo['font-size']) {
                var fontSize_1 = styleInfo['font-size'];
                $cont.find('.dropdown-fontsize a').each(function (idx, item) {
                    var $item = $$1(item);
                    // always compare with string to avoid creating another func.
                    var isChecked = ($item.data('value') + '') === (fontSize_1 + '');
                    $item.toggleClass('checked', isChecked);
                });
                $cont.find('.note-current-fontsize').text(fontSize_1);
            }
            if (styleInfo['line-height']) {
                var lineHeight_1 = styleInfo['line-height'];
                $cont.find('.dropdown-line-height li a').each(function (idx, item) {
                    // always compare with string to avoid creating another func.
                    var isChecked = ($$1(item).data('value') + '') === (lineHeight_1 + '');
                    _this.className = isChecked ? 'checked' : '';
                });
            }
        };
        Buttons.prototype.updateBtnStates = function ($container, infos) {
            var _this = this;
            $$1.each(infos, function (selector, pred) {
                _this.ui.toggleBtnActive($container.find(selector), pred());
            });
        };
        Buttons.prototype.tableMoveHandler = function (event) {
            var PX_PER_EM = 18;
            var $picker = $$1(event.target.parentNode); // target is mousecatcher
            var $dimensionDisplay = $picker.next();
            var $catcher = $picker.find('.note-dimension-picker-mousecatcher');
            var $highlighted = $picker.find('.note-dimension-picker-highlighted');
            var $unhighlighted = $picker.find('.note-dimension-picker-unhighlighted');
            var posOffset;
            // HTML5 with jQuery - e.offsetX is undefined in Firefox
            if (event.offsetX === undefined) {
                var posCatcher = $$1(event.target).offset();
                posOffset = {
                    x: event.pageX - posCatcher.left,
                    y: event.pageY - posCatcher.top
                };
            }
            else {
                posOffset = {
                    x: event.offsetX,
                    y: event.offsetY
                };
            }
            var dim = {
                c: Math.ceil(posOffset.x / PX_PER_EM) || 1,
                r: Math.ceil(posOffset.y / PX_PER_EM) || 1
            };
            $highlighted.css({ width: dim.c + 'em', height: dim.r + 'em' });
            $catcher.data('value', dim.c + 'x' + dim.r);
            if (dim.c > 3 && dim.c < this.options.insertTableMaxSize.col) {
                $unhighlighted.css({ width: dim.c + 1 + 'em' });
            }
            if (dim.r > 3 && dim.r < this.options.insertTableMaxSize.row) {
                $unhighlighted.css({ height: dim.r + 1 + 'em' });
            }
            $dimensionDisplay.html(dim.c + ' x ' + dim.r);
        };
        return Buttons;
    }());

    var Toolbar = /** @class */ (function () {
        function Toolbar(context) {
            this.context = context;
            this.$window = $$1(window);
            this.$document = $$1(document);
            this.ui = $$1.summernote.ui;
            this.$note = context.layoutInfo.note;
            this.$editor = context.layoutInfo.editor;
            this.$toolbar = context.layoutInfo.toolbar;
            this.$editable = context.layoutInfo.editable;
            this.$statusbar = context.layoutInfo.statusbar;
            this.options = context.options;
            this.isFollowing = false;
            this.followScroll = this.followScroll.bind(this);
        }
        Toolbar.prototype.shouldInitialize = function () {
            return !this.options.airMode;
        };
        Toolbar.prototype.initialize = function () {
            var _this = this;
            this.options.toolbar = this.options.toolbar || [];
            if (!this.options.toolbar.length) {
                this.$toolbar.hide();
            }
            else {
                this.context.invoke('buttons.build', this.$toolbar, this.options.toolbar);
            }
            if (this.options.toolbarContainer) {
                this.$toolbar.appendTo(this.options.toolbarContainer);
            }
            this.changeContainer(false);
            this.$note.on('summernote.keyup summernote.mouseup summernote.change', function () {
                _this.context.invoke('buttons.updateCurrentStyle');
            });
            this.context.invoke('buttons.updateCurrentStyle');
            if (this.options.followingToolbar) {
                this.$window.on('scroll resize', this.followScroll);
            }
        };
        Toolbar.prototype.destroy = function () {
            this.$toolbar.children().remove();
            if (this.options.followingToolbar) {
                this.$window.off('scroll resize', this.followScroll);
            }
        };
        Toolbar.prototype.followScroll = function () {
            if (this.$editor.hasClass('fullscreen')) {
                return false;
            }
            var editorHeight = this.$editor.outerHeight();
            var editorWidth = this.$editor.width();
            var toolbarHeight = this.$toolbar.height();
            var statusbarHeight = this.$statusbar.height();
            // check if the web app is currently using another static bar
            var otherBarHeight = 0;
            if (this.options.otherStaticBar) {
                otherBarHeight = $$1(this.options.otherStaticBar).outerHeight();
            }
            var currentOffset = this.$document.scrollTop();
            var editorOffsetTop = this.$editor.offset().top;
            var editorOffsetBottom = editorOffsetTop + editorHeight;
            var activateOffset = editorOffsetTop - otherBarHeight;
            var deactivateOffsetBottom = editorOffsetBottom - otherBarHeight - toolbarHeight - statusbarHeight;
            if (!this.isFollowing &&
                (currentOffset > activateOffset) && (currentOffset < deactivateOffsetBottom - toolbarHeight)) {
                this.isFollowing = true;
                this.$toolbar.css({
                    position: 'fixed',
                    top: otherBarHeight,
                    width: editorWidth
                });
                this.$editable.css({
                    marginTop: this.$toolbar.height() + 5
                });
            }
            else if (this.isFollowing &&
                ((currentOffset < activateOffset) || (currentOffset > deactivateOffsetBottom))) {
                this.isFollowing = false;
                this.$toolbar.css({
                    position: 'relative',
                    top: 0,
                    width: '100%'
                });
                this.$editable.css({
                    marginTop: ''
                });
            }
        };
        Toolbar.prototype.changeContainer = function (isFullscreen) {
            if (isFullscreen) {
                this.$toolbar.prependTo(this.$editor);
            }
            else {
                if (this.options.toolbarContainer) {
                    this.$toolbar.appendTo(this.options.toolbarContainer);
                }
            }
            this.followScroll();
        };
        Toolbar.prototype.updateFullscreen = function (isFullscreen) {
            this.ui.toggleBtnActive(this.$toolbar.find('.btn-fullscreen'), isFullscreen);
            this.changeContainer(isFullscreen);
        };
        Toolbar.prototype.updateCodeview = function (isCodeview) {
            this.ui.toggleBtnActive(this.$toolbar.find('.btn-codeview'), isCodeview);
            if (isCodeview) {
                this.deactivate();
            }
            else {
                this.activate();
            }
        };
        Toolbar.prototype.activate = function (isIncludeCodeview) {
            var $btn = this.$toolbar.find('button');
            if (!isIncludeCodeview) {
                $btn = $btn.not('.btn-codeview');
            }
            this.ui.toggleBtn($btn, true);
        };
        Toolbar.prototype.deactivate = function (isIncludeCodeview) {
            var $btn = this.$toolbar.find('button');
            if (!isIncludeCodeview) {
                $btn = $btn.not('.btn-codeview');
            }
            this.ui.toggleBtn($btn, false);
        };
        return Toolbar;
    }());

    var LinkDialog = /** @class */ (function () {
        function LinkDialog(context) {
            this.context = context;
            this.ui = $$1.summernote.ui;
            this.$body = $$1(document.body);
            this.$editor = context.layoutInfo.editor;
            this.options = context.options;
            this.lang = this.options.langInfo;
            context.memo('help.linkDialog.show', this.options.langInfo.help['linkDialog.show']);
        }
        LinkDialog.prototype.initialize = function () {
            var $container = this.options.dialogsInBody ? this.$body : this.$editor;
            var body = [
                '<div class="form-group note-form-group">',
                "<label class=\"note-form-label\">" + this.lang.link.textToDisplay + "</label>",
                '<input class="note-link-text form-control note-form-control note-input" type="text" />',
                '</div>',
                '<div class="form-group note-form-group">',
                "<label class=\"note-form-label\">" + this.lang.link.url + "</label>",
                '<input class="note-link-url form-control note-form-control note-input" type="text" value="http://" />',
                '</div>',
                !this.options.disableLinkTarget
                    ? $$1('<div/>').append(this.ui.checkbox({
                        className: 'sn-checkbox-open-in-new-window',
                        text: this.lang.link.openInNewWindow,
                        checked: true
                    }).render()).html()
                    : '',
            ].join('');
            var buttonClass = 'btn btn-primary note-btn note-btn-primary note-link-btn';
            var footer = "<input type=\"button\" href=\"#\" class=\"" + buttonClass + "\" value=\"" + this.lang.link.insert + "\" disabled>";
            this.$dialog = this.ui.dialog({
                className: 'link-dialog',
                title: this.lang.link.insert,
                fade: this.options.dialogsFade,
                body: body,
                footer: footer
            }).render().appendTo($container);
        };
        LinkDialog.prototype.destroy = function () {
            this.ui.hideDialog(this.$dialog);
            this.$dialog.remove();
        };
        LinkDialog.prototype.bindEnterKey = function ($input, $btn) {
            $input.on('keypress', function (event) {
                if (event.keyCode === key.code.ENTER) {
                    event.preventDefault();
                    $btn.trigger('click');
                }
            });
        };
        /**
         * toggle update button
         */
        LinkDialog.prototype.toggleLinkBtn = function ($linkBtn, $linkText, $linkUrl) {
            this.ui.toggleBtn($linkBtn, $linkText.val() && $linkUrl.val());
        };
        /**
         * Show link dialog and set event handlers on dialog controls.
         *
         * @param {Object} linkInfo
         * @return {Promise}
         */
        LinkDialog.prototype.showLinkDialog = function (linkInfo) {
            var _this = this;
            return $$1.Deferred(function (deferred) {
                var $linkText = _this.$dialog.find('.note-link-text');
                var $linkUrl = _this.$dialog.find('.note-link-url');
                var $linkBtn = _this.$dialog.find('.note-link-btn');
                var $openInNewWindow = _this.$dialog
                    .find('.sn-checkbox-open-in-new-window input[type=checkbox]');
                _this.ui.onDialogShown(_this.$dialog, function () {
                    _this.context.triggerEvent('dialog.shown');
                    // If no url was given and given text is valid URL then copy that into URL Field
                    if (!linkInfo.url && func.isValidUrl(linkInfo.text)) {
                        linkInfo.url = linkInfo.text;
                    }
                    $linkText.on('input paste propertychange', function () {
                        // If linktext was modified by input events,
                        // cloning text from linkUrl will be stopped.
                        linkInfo.text = $linkText.val();
                        _this.toggleLinkBtn($linkBtn, $linkText, $linkUrl);
                    }).val(linkInfo.text);
                    $linkUrl.on('input paste propertychange', function () {
                        // Display same text on `Text to display` as default
                        // when linktext has no text
                        if (!linkInfo.text) {
                            $linkText.val($linkUrl.val());
                        }
                        _this.toggleLinkBtn($linkBtn, $linkText, $linkUrl);
                    }).val(linkInfo.url);
                    if (!env.isSupportTouch) {
                        $linkUrl.trigger('focus');
                    }
                    _this.toggleLinkBtn($linkBtn, $linkText, $linkUrl);
                    _this.bindEnterKey($linkUrl, $linkBtn);
                    _this.bindEnterKey($linkText, $linkBtn);
                    var isNewWindowChecked = linkInfo.isNewWindow !== undefined
                        ? linkInfo.isNewWindow : _this.context.options.linkTargetBlank;
                    $openInNewWindow.prop('checked', isNewWindowChecked);
                    $linkBtn.one('click', function (event) {
                        event.preventDefault();
                        deferred.resolve({
                            range: linkInfo.range,
                            url: $linkUrl.val(),
                            text: $linkText.val(),
                            isNewWindow: $openInNewWindow.is(':checked')
                        });
                        _this.ui.hideDialog(_this.$dialog);
                    });
                });
                _this.ui.onDialogHidden(_this.$dialog, function () {
                    // detach events
                    $linkText.off();
                    $linkUrl.off();
                    $linkBtn.off();
                    if (deferred.state() === 'pending') {
                        deferred.reject();
                    }
                });
                _this.ui.showDialog(_this.$dialog);
            }).promise();
        };
        /**
         * @param {Object} layoutInfo
         */
        LinkDialog.prototype.show = function () {
            var _this = this;
            var linkInfo = this.context.invoke('editor.getLinkInfo');
            this.context.invoke('editor.saveRange');
            this.showLinkDialog(linkInfo).then(function (linkInfo) {
                _this.context.invoke('editor.restoreRange');
                _this.context.invoke('editor.createLink', linkInfo);
            }).fail(function () {
                _this.context.invoke('editor.restoreRange');
            });
        };
        return LinkDialog;
    }());

    var LinkPopover = /** @class */ (function () {
        function LinkPopover(context) {
            var _this = this;
            this.context = context;
            this.ui = $$1.summernote.ui;
            this.options = context.options;
            this.events = {
                'summernote.keyup summernote.mouseup summernote.change summernote.scroll': function () {
                    _this.update();
                },
                'summernote.disable summernote.dialog.shown': function () {
                    _this.hide();
                }
            };
        }
        LinkPopover.prototype.shouldInitialize = function () {
            return !lists.isEmpty(this.options.popover.link);
        };
        LinkPopover.prototype.initialize = function () {
            this.$popover = this.ui.popover({
                className: 'note-link-popover',
                callback: function ($node) {
                    var $content = $node.find('.popover-content,.note-popover-content');
                    $content.prepend('<span><a target="_blank"></a>&nbsp;</span>');
                }
            }).render().appendTo(this.options.container);
            var $content = this.$popover.find('.popover-content,.note-popover-content');
            this.context.invoke('buttons.build', $content, this.options.popover.link);
        };
        LinkPopover.prototype.destroy = function () {
            this.$popover.remove();
        };
        LinkPopover.prototype.update = function () {
            // Prevent focusing on editable when invoke('code') is executed
            if (!this.context.invoke('editor.hasFocus')) {
                this.hide();
                return;
            }
            var rng = this.context.invoke('editor.getLastRange');
            if (rng.isCollapsed() && rng.isOnAnchor()) {
                var anchor = dom.ancestor(rng.sc, dom.isAnchor);
                var href = $$1(anchor).attr('href');
                this.$popover.find('a').attr('href', href).html(href);
                var pos = dom.posFromPlaceholder(anchor);
                this.$popover.css({
                    display: 'block',
                    left: pos.left,
                    top: pos.top
                });
            }
            else {
                this.hide();
            }
        };
        LinkPopover.prototype.hide = function () {
            this.$popover.hide();
        };
        return LinkPopover;
    }());

    var ImageDialog = /** @class */ (function () {
        function ImageDialog(context) {
            this.context = context;
            this.ui = $$1.summernote.ui;
            this.$body = $$1(document.body);
            this.$editor = context.layoutInfo.editor;
            this.options = context.options;
            this.lang = this.options.langInfo;
        }
        ImageDialog.prototype.initialize = function () {
            var $container = this.options.dialogsInBody ? this.$body : this.$editor;
            var imageLimitation = '';
            if (this.options.maximumImageFileSize) {
                var unit = Math.floor(Math.log(this.options.maximumImageFileSize) / Math.log(1024));
                var readableSize = (this.options.maximumImageFileSize / Math.pow(1024, unit)).toFixed(2) * 1 +
                    ' ' + ' KMGTP'[unit] + 'B';
                imageLimitation = "<small>" + (this.lang.image.maximumFileSize + ' : ' + readableSize) + "</small>";
            }
            var body = [
                '<div class="form-group note-form-group note-group-select-from-files">',
                '<label class="note-form-label">' + this.lang.image.selectFromFiles + '</label>',
                '<input class="note-image-input form-control-file note-form-control note-input" ',
                ' type="file" name="files" accept="image/*" multiple="multiple" />',
                imageLimitation,
                '</div>',
                '<div class="form-group note-group-image-url" style="overflow:auto;">',
                '<label class="note-form-label">' + this.lang.image.url + '</label>',
                '<input class="note-image-url form-control note-form-control note-input ',
                ' col-md-12" type="text" />',
                '</div>',
            ].join('');
            var buttonClass = 'btn btn-primary note-btn note-btn-primary note-image-btn';
            var footer = "<input type=\"button\" href=\"#\" class=\"" + buttonClass + "\" value=\"" + this.lang.image.insert + "\" disabled>";
            this.$dialog = this.ui.dialog({
                title: this.lang.image.insert,
                fade: this.options.dialogsFade,
                body: body,
                footer: footer
            }).render().appendTo($container);
        };
        ImageDialog.prototype.destroy = function () {
            this.ui.hideDialog(this.$dialog);
            this.$dialog.remove();
        };
        ImageDialog.prototype.bindEnterKey = function ($input, $btn) {
            $input.on('keypress', function (event) {
                if (event.keyCode === key.code.ENTER) {
                    event.preventDefault();
                    $btn.trigger('click');
                }
            });
        };
        ImageDialog.prototype.show = function () {
            var _this = this;
            this.context.invoke('editor.saveRange');
            this.showImageDialog().then(function (data) {
                // [workaround] hide dialog before restore range for IE range focus
                _this.ui.hideDialog(_this.$dialog);
                _this.context.invoke('editor.restoreRange');
                if (typeof data === 'string') { // image url
                    // If onImageLinkInsert set,
                    if (_this.options.callbacks.onImageLinkInsert) {
                        _this.context.triggerEvent('image.link.insert', data);
                    }
                    else {
                        _this.context.invoke('editor.insertImage', data);
                    }
                }
                else { // array of files
                    _this.context.invoke('editor.insertImagesOrCallback', data);
                }
            }).fail(function () {
                _this.context.invoke('editor.restoreRange');
            });
        };
        /**
         * show image dialog
         *
         * @param {jQuery} $dialog
         * @return {Promise}
         */
        ImageDialog.prototype.showImageDialog = function () {
            var _this = this;
            return $$1.Deferred(function (deferred) {
                var $imageInput = _this.$dialog.find('.note-image-input');
                var $imageUrl = _this.$dialog.find('.note-image-url');
                var $imageBtn = _this.$dialog.find('.note-image-btn');
                _this.ui.onDialogShown(_this.$dialog, function () {
                    _this.context.triggerEvent('dialog.shown');
                    // Cloning imageInput to clear element.
                    $imageInput.replaceWith($imageInput.clone().on('change', function (event) {
                        deferred.resolve(event.target.files || event.target.value);
                    }).val(''));
                    $imageUrl.on('input paste propertychange', function () {
                        _this.ui.toggleBtn($imageBtn, $imageUrl.val());
                    }).val('');
                    if (!env.isSupportTouch) {
                        $imageUrl.trigger('focus');
                    }
                    $imageBtn.click(function (event) {
                        event.preventDefault();
                        deferred.resolve($imageUrl.val());
                    });
                    _this.bindEnterKey($imageUrl, $imageBtn);
                });
                _this.ui.onDialogHidden(_this.$dialog, function () {
                    $imageInput.off();
                    $imageUrl.off();
                    $imageBtn.off();
                    if (deferred.state() === 'pending') {
                        deferred.reject();
                    }
                });
                _this.ui.showDialog(_this.$dialog);
            });
        };
        return ImageDialog;
    }());

    /**
     * Image popover module
     *  mouse events that show/hide popover will be handled by Handle.js.
     *  Handle.js will receive the events and invoke 'imagePopover.update'.
     */
    var ImagePopover = /** @class */ (function () {
        function ImagePopover(context) {
            var _this = this;
            this.context = context;
            this.ui = $$1.summernote.ui;
            this.editable = context.layoutInfo.editable[0];
            this.options = context.options;
            this.events = {
                'summernote.disable': function () {
                    _this.hide();
                }
            };
        }
        ImagePopover.prototype.shouldInitialize = function () {
            return !lists.isEmpty(this.options.popover.image);
        };
        ImagePopover.prototype.initialize = function () {
            this.$popover = this.ui.popover({
                className: 'note-image-popover'
            }).render().appendTo(this.options.container);
            var $content = this.$popover.find('.popover-content,.note-popover-content');
            this.context.invoke('buttons.build', $content, this.options.popover.image);
        };
        ImagePopover.prototype.destroy = function () {
            this.$popover.remove();
        };
        ImagePopover.prototype.update = function (target, event) {
            if (dom.isImg(target)) {
                var pos = dom.posFromPlaceholder(target);
                var posEditor = dom.posFromPlaceholder(this.editable);
                this.$popover.css({
                    display: 'block',
                    left: this.options.popatmouse ? event.pageX - 20 : pos.left,
                    top: this.options.popatmouse ? event.pageY : Math.min(pos.top, posEditor.top)
                });
            }
            else {
                this.hide();
            }
        };
        ImagePopover.prototype.hide = function () {
            this.$popover.hide();
        };
        return ImagePopover;
    }());

    var TablePopover = /** @class */ (function () {
        function TablePopover(context) {
            var _this = this;
            this.context = context;
            this.ui = $$1.summernote.ui;
            this.options = context.options;
            this.events = {
                'summernote.mousedown': function (we, e) {
                    _this.update(e.target);
                },
                'summernote.keyup summernote.scroll summernote.change': function () {
                    _this.update();
                },
                'summernote.disable': function () {
                    _this.hide();
                }
            };
        }
        TablePopover.prototype.shouldInitialize = function () {
            return !lists.isEmpty(this.options.popover.table);
        };
        TablePopover.prototype.initialize = function () {
            this.$popover = this.ui.popover({
                className: 'note-table-popover'
            }).render().appendTo(this.options.container);
            var $content = this.$popover.find('.popover-content,.note-popover-content');
            this.context.invoke('buttons.build', $content, this.options.popover.table);
            // [workaround] Disable Firefox's default table editor
            if (env.isFF) {
                document.execCommand('enableInlineTableEditing', false, false);
            }
        };
        TablePopover.prototype.destroy = function () {
            this.$popover.remove();
        };
        TablePopover.prototype.update = function (target) {
            if (this.context.isDisabled()) {
                return false;
            }
            var isCell = dom.isCell(target);
            if (isCell) {
                var pos = dom.posFromPlaceholder(target);
                this.$popover.css({
                    display: 'block',
                    left: pos.left,
                    top: pos.top
                });
            }
            else {
                this.hide();
            }
            return isCell;
        };
        TablePopover.prototype.hide = function () {
            this.$popover.hide();
        };
        return TablePopover;
    }());

    var VideoDialog = /** @class */ (function () {
        function VideoDialog(context) {
            this.context = context;
            this.ui = $$1.summernote.ui;
            this.$body = $$1(document.body);
            this.$editor = context.layoutInfo.editor;
            this.options = context.options;
            this.lang = this.options.langInfo;
        }
        VideoDialog.prototype.initialize = function () {
            var $container = this.options.dialogsInBody ? this.$body : this.$editor;
            var body = [
                '<div class="form-group note-form-group row-fluid">',
                "<label class=\"note-form-label\">" + this.lang.video.url + " <small class=\"text-muted\">" + this.lang.video.providers + "</small></label>",
                '<input class="note-video-url form-control note-form-control note-input" type="text" />',
                '</div>',
            ].join('');
            var buttonClass = 'btn btn-primary note-btn note-btn-primary note-video-btn';
            var footer = "<input type=\"button\" href=\"#\" class=\"" + buttonClass + "\" value=\"" + this.lang.video.insert + "\" disabled>";
            this.$dialog = this.ui.dialog({
                title: this.lang.video.insert,
                fade: this.options.dialogsFade,
                body: body,
                footer: footer
            }).render().appendTo($container);
        };
        VideoDialog.prototype.destroy = function () {
            this.ui.hideDialog(this.$dialog);
            this.$dialog.remove();
        };
        VideoDialog.prototype.bindEnterKey = function ($input, $btn) {
            $input.on('keypress', function (event) {
                if (event.keyCode === key.code.ENTER) {
                    event.preventDefault();
                    $btn.trigger('click');
                }
            });
        };
        VideoDialog.prototype.createVideoNode = function (url) {
            // video url patterns(youtube, instagram, vimeo, dailymotion, youku, mp4, ogg, webm)
            var ytRegExp = /\/\/(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))([\w|-]{11})(?:(?:[\?&]t=)(\S+))?$/;
            var ytRegExpForStart = /^(?:(\d+)h)?(?:(\d+)m)?(?:(\d+)s)?$/;
            var ytMatch = url.match(ytRegExp);
            var igRegExp = /(?:www\.|\/\/)instagram\.com\/p\/(.[a-zA-Z0-9_-]*)/;
            var igMatch = url.match(igRegExp);
            var vRegExp = /\/\/vine\.co\/v\/([a-zA-Z0-9]+)/;
            var vMatch = url.match(vRegExp);
            var vimRegExp = /\/\/(player\.)?vimeo\.com\/([a-z]*\/)*(\d+)[?]?.*/;
            var vimMatch = url.match(vimRegExp);
            var dmRegExp = /.+dailymotion.com\/(video|hub)\/([^_]+)[^#]*(#video=([^_&]+))?/;
            var dmMatch = url.match(dmRegExp);
            var youkuRegExp = /\/\/v\.youku\.com\/v_show\/id_(\w+)=*\.html/;
            var youkuMatch = url.match(youkuRegExp);
            var qqRegExp = /\/\/v\.qq\.com.*?vid=(.+)/;
            var qqMatch = url.match(qqRegExp);
            var qqRegExp2 = /\/\/v\.qq\.com\/x?\/?(page|cover).*?\/([^\/]+)\.html\??.*/;
            var qqMatch2 = url.match(qqRegExp2);
            var mp4RegExp = /^.+.(mp4|m4v)$/;
            var mp4Match = url.match(mp4RegExp);
            var oggRegExp = /^.+.(ogg|ogv)$/;
            var oggMatch = url.match(oggRegExp);
            var webmRegExp = /^.+.(webm)$/;
            var webmMatch = url.match(webmRegExp);
            var fbRegExp = /(?:www\.|\/\/)facebook\.com\/([^\/]+)\/videos\/([0-9]+)/;
            var fbMatch = url.match(fbRegExp);
            var $video;
            if (ytMatch && ytMatch[1].length === 11) {
                var youtubeId = ytMatch[1];
                var start = 0;
                if (typeof ytMatch[2] !== 'undefined') {
                    var ytMatchForStart = ytMatch[2].match(ytRegExpForStart);
                    if (ytMatchForStart) {
                        for (var n = [3600, 60, 1], i = 0, r = n.length; i < r; i++) {
                            start += (typeof ytMatchForStart[i + 1] !== 'undefined' ? n[i] * parseInt(ytMatchForStart[i + 1], 10) : 0);
                        }
                    }
                }
                $video = $$1('<iframe>')
                    .attr('frameborder', 0)
                    .attr('src', '//www.youtube.com/embed/' + youtubeId + (start > 0 ? '?start=' + start : ''))
                    .attr('width', '640').attr('height', '360');
            }
            else if (igMatch && igMatch[0].length) {
                $video = $$1('<iframe>')
                    .attr('frameborder', 0)
                    .attr('src', 'https://instagram.com/p/' + igMatch[1] + '/embed/')
                    .attr('width', '612').attr('height', '710')
                    .attr('scrolling', 'no')
                    .attr('allowtransparency', 'true');
            }
            else if (vMatch && vMatch[0].length) {
                $video = $$1('<iframe>')
                    .attr('frameborder', 0)
                    .attr('src', vMatch[0] + '/embed/simple')
                    .attr('width', '600').attr('height', '600')
                    .attr('class', 'vine-embed');
            }
            else if (vimMatch && vimMatch[3].length) {
                $video = $$1('<iframe webkitallowfullscreen mozallowfullscreen allowfullscreen>')
                    .attr('frameborder', 0)
                    .attr('src', '//player.vimeo.com/video/' + vimMatch[3])
                    .attr('width', '640').attr('height', '360');
            }
            else if (dmMatch && dmMatch[2].length) {
                $video = $$1('<iframe>')
                    .attr('frameborder', 0)
                    .attr('src', '//www.dailymotion.com/embed/video/' + dmMatch[2])
                    .attr('width', '640').attr('height', '360');
            }
            else if (youkuMatch && youkuMatch[1].length) {
                $video = $$1('<iframe webkitallowfullscreen mozallowfullscreen allowfullscreen>')
                    .attr('frameborder', 0)
                    .attr('height', '498')
                    .attr('width', '510')
                    .attr('src', '//player.youku.com/embed/' + youkuMatch[1]);
            }
            else if ((qqMatch && qqMatch[1].length) || (qqMatch2 && qqMatch2[2].length)) {
                var vid = ((qqMatch && qqMatch[1].length) ? qqMatch[1] : qqMatch2[2]);
                $video = $$1('<iframe webkitallowfullscreen mozallowfullscreen allowfullscreen>')
                    .attr('frameborder', 0)
                    .attr('height', '310')
                    .attr('width', '500')
                    .attr('src', 'http://v.qq.com/iframe/player.html?vid=' + vid + '&amp;auto=0');
            }
            else if (mp4Match || oggMatch || webmMatch) {
                $video = $$1('<video controls>')
                    .attr('src', url)
                    .attr('width', '640').attr('height', '360');
            }
            else if (fbMatch && fbMatch[0].length) {
                $video = $$1('<iframe>')
                    .attr('frameborder', 0)
                    .attr('src', 'https://www.facebook.com/plugins/video.php?href=' + encodeURIComponent(fbMatch[0]) + '&show_text=0&width=560')
                    .attr('width', '560').attr('height', '301')
                    .attr('scrolling', 'no')
                    .attr('allowtransparency', 'true');
            }
            else {
                // this is not a known video link. Now what, Cat? Now what?
                return false;
            }
            $video.addClass('note-video-clip');
            return $video[0];
        };
        VideoDialog.prototype.show = function () {
            var _this = this;
            var text = this.context.invoke('editor.getSelectedText');
            this.context.invoke('editor.saveRange');
            this.showVideoDialog(text).then(function (url) {
                // [workaround] hide dialog before restore range for IE range focus
                _this.ui.hideDialog(_this.$dialog);
                _this.context.invoke('editor.restoreRange');
                // build node
                var $node = _this.createVideoNode(url);
                if ($node) {
                    // insert video node
                    _this.context.invoke('editor.insertNode', $node);
                }
            }).fail(function () {
                _this.context.invoke('editor.restoreRange');
            });
        };
        /**
         * show image dialog
         *
         * @param {jQuery} $dialog
         * @return {Promise}
         */
        VideoDialog.prototype.showVideoDialog = function (text) {
            var _this = this;
            return $$1.Deferred(function (deferred) {
                var $videoUrl = _this.$dialog.find('.note-video-url');
                var $videoBtn = _this.$dialog.find('.note-video-btn');
                _this.ui.onDialogShown(_this.$dialog, function () {
                    _this.context.triggerEvent('dialog.shown');
                    $videoUrl.on('input paste propertychange', function () {
                        _this.ui.toggleBtn($videoBtn, $videoUrl.val());
                    });
                    if (!env.isSupportTouch) {
                        $videoUrl.trigger('focus');
                    }
                    $videoBtn.click(function (event) {
                        event.preventDefault();
                        deferred.resolve($videoUrl.val());
                    });
                    _this.bindEnterKey($videoUrl, $videoBtn);
                });
                _this.ui.onDialogHidden(_this.$dialog, function () {
                    $videoUrl.off();
                    $videoBtn.off();
                    if (deferred.state() === 'pending') {
                        deferred.reject();
                    }
                });
                _this.ui.showDialog(_this.$dialog);
            });
        };
        return VideoDialog;
    }());

    var HelpDialog = /** @class */ (function () {
        function HelpDialog(context) {
            this.context = context;
            this.ui = $$1.summernote.ui;
            this.$body = $$1(document.body);
            this.$editor = context.layoutInfo.editor;
            this.options = context.options;
            this.lang = this.options.langInfo;
        }
        HelpDialog.prototype.initialize = function () {
            var $container = this.options.dialogsInBody ? this.$body : this.$editor;
            var body = [
                '<p class="text-center">',
                '<a href="http://summernote.org/" target="_blank">Summernote 0.8.12</a> · ',
                '<a href="https://github.com/summernote/summernote" target="_blank">Project</a> · ',
                '<a href="https://github.com/summernote/summernote/issues" target="_blank">Issues</a>',
                '</p>',
            ].join('');
            this.$dialog = this.ui.dialog({
                title: this.lang.options.help,
                fade: this.options.dialogsFade,
                body: this.createShortcutList(),
                footer: body,
                callback: function ($node) {
                    $node.find('.modal-body,.note-modal-body').css({
                        'max-height': 300,
                        'overflow': 'scroll'
                    });
                }
            }).render().appendTo($container);
        };
        HelpDialog.prototype.destroy = function () {
            this.ui.hideDialog(this.$dialog);
            this.$dialog.remove();
        };
        HelpDialog.prototype.createShortcutList = function () {
            var _this = this;
            var keyMap = this.options.keyMap[env.isMac ? 'mac' : 'pc'];
            return Object.keys(keyMap).map(function (key) {
                var command = keyMap[key];
                var $row = $$1('<div><div class="help-list-item"/></div>');
                $row.append($$1('<label><kbd>' + key + '</kdb></label>').css({
                    'width': 180,
                    'margin-right': 10
                })).append($$1('<span/>').html(_this.context.memo('help.' + command) || command));
                return $row.html();
            }).join('');
        };
        /**
         * show help dialog
         *
         * @return {Promise}
         */
        HelpDialog.prototype.showHelpDialog = function () {
            var _this = this;
            return $$1.Deferred(function (deferred) {
                _this.ui.onDialogShown(_this.$dialog, function () {
                    _this.context.triggerEvent('dialog.shown');
                    deferred.resolve();
                });
                _this.ui.showDialog(_this.$dialog);
            }).promise();
        };
        HelpDialog.prototype.show = function () {
            var _this = this;
            this.context.invoke('editor.saveRange');
            this.showHelpDialog().then(function () {
                _this.context.invoke('editor.restoreRange');
            });
        };
        return HelpDialog;
    }());

    var AIR_MODE_POPOVER_X_OFFSET = 20;
    var AirPopover = /** @class */ (function () {
        function AirPopover(context) {
            var _this = this;
            this.context = context;
            this.ui = $$1.summernote.ui;
            this.options = context.options;
            this.events = {
                'summernote.keyup summernote.mouseup summernote.scroll': function () {
                    _this.update();
                },
                'summernote.disable summernote.change summernote.dialog.shown': function () {
                    _this.hide();
                },
                'summernote.focusout': function (we, e) {
                    // [workaround] Firefox doesn't support relatedTarget on focusout
                    //  - Ignore hide action on focus out in FF.
                    if (env.isFF) {
                        return;
                    }
                    if (!e.relatedTarget || !dom.ancestor(e.relatedTarget, func.eq(_this.$popover[0]))) {
                        _this.hide();
                    }
                }
            };
        }
        AirPopover.prototype.shouldInitialize = function () {
            return this.options.airMode && !lists.isEmpty(this.options.popover.air);
        };
        AirPopover.prototype.initialize = function () {
            this.$popover = this.ui.popover({
                className: 'note-air-popover'
            }).render().appendTo(this.options.container);
            var $content = this.$popover.find('.popover-content');
            this.context.invoke('buttons.build', $content, this.options.popover.air);
        };
        AirPopover.prototype.destroy = function () {
            this.$popover.remove();
        };
        AirPopover.prototype.update = function () {
            var styleInfo = this.context.invoke('editor.currentStyle');
            if (styleInfo.range && !styleInfo.range.isCollapsed()) {
                var rect = lists.last(styleInfo.range.getClientRects());
                if (rect) {
                    var bnd = func.rect2bnd(rect);
                    this.$popover.css({
                        display: 'block',
                        left: Math.max(bnd.left + bnd.width / 2, 0) - AIR_MODE_POPOVER_X_OFFSET,
                        top: bnd.top + bnd.height
                    });
                    this.context.invoke('buttons.updateCurrentStyle', this.$popover);
                }
            }
            else {
                this.hide();
            }
        };
        AirPopover.prototype.hide = function () {
            this.$popover.hide();
        };
        return AirPopover;
    }());

    var POPOVER_DIST = 5;
    var HintPopover = /** @class */ (function () {
        function HintPopover(context) {
            var _this = this;
            this.context = context;
            this.ui = $$1.summernote.ui;
            this.$editable = context.layoutInfo.editable;
            this.options = context.options;
            this.hint = this.options.hint || [];
            this.direction = this.options.hintDirection || 'bottom';
            this.hints = Array.isArray(this.hint) ? this.hint : [this.hint];
            this.events = {
                'summernote.keyup': function (we, e) {
                    if (!e.isDefaultPrevented()) {
                        _this.handleKeyup(e);
                    }
                },
                'summernote.keydown': function (we, e) {
                    _this.handleKeydown(e);
                },
                'summernote.disable summernote.dialog.shown': function () {
                    _this.hide();
                }
            };
        }
        HintPopover.prototype.shouldInitialize = function () {
            return this.hints.length > 0;
        };
        HintPopover.prototype.initialize = function () {
            var _this = this;
            this.lastWordRange = null;
            this.$popover = this.ui.popover({
                className: 'note-hint-popover',
                hideArrow: true,
                direction: ''
            }).render().appendTo(this.options.container);
            this.$popover.hide();
            this.$content = this.$popover.find('.popover-content,.note-popover-content');
            this.$content.on('click', '.note-hint-item', function (e) {
                _this.$content.find('.active').removeClass('active');
                $$1(e.currentTarget).addClass('active');
                _this.replace();
            });
        };
        HintPopover.prototype.destroy = function () {
            this.$popover.remove();
        };
        HintPopover.prototype.selectItem = function ($item) {
            this.$content.find('.active').removeClass('active');
            $item.addClass('active');
            this.$content[0].scrollTop = $item[0].offsetTop - (this.$content.innerHeight() / 2);
        };
        HintPopover.prototype.moveDown = function () {
            var $current = this.$content.find('.note-hint-item.active');
            var $next = $current.next();
            if ($next.length) {
                this.selectItem($next);
            }
            else {
                var $nextGroup = $current.parent().next();
                if (!$nextGroup.length) {
                    $nextGroup = this.$content.find('.note-hint-group').first();
                }
                this.selectItem($nextGroup.find('.note-hint-item').first());
            }
        };
        HintPopover.prototype.moveUp = function () {
            var $current = this.$content.find('.note-hint-item.active');
            var $prev = $current.prev();
            if ($prev.length) {
                this.selectItem($prev);
            }
            else {
                var $prevGroup = $current.parent().prev();
                if (!$prevGroup.length) {
                    $prevGroup = this.$content.find('.note-hint-group').last();
                }
                this.selectItem($prevGroup.find('.note-hint-item').last());
            }
        };
        HintPopover.prototype.replace = function () {
            var $item = this.$content.find('.note-hint-item.active');
            if ($item.length) {
                var node = this.nodeFromItem($item);
                // XXX: consider to move codes to editor for recording redo/undo.
                this.lastWordRange.insertNode(node);
                range.createFromNode(node).collapse().select();
                this.lastWordRange = null;
                this.hide();
                this.context.triggerEvent('change', this.$editable.html(), this.$editable[0]);
                this.context.invoke('editor.focus');
            }
        };
        HintPopover.prototype.nodeFromItem = function ($item) {
            var hint = this.hints[$item.data('index')];
            var item = $item.data('item');
            var node = hint.content ? hint.content(item) : item;
            if (typeof node === 'string') {
                node = dom.createText(node);
            }
            return node;
        };
        HintPopover.prototype.createItemTemplates = function (hintIdx, items) {
            var hint = this.hints[hintIdx];
            return items.map(function (item, idx) {
                var $item = $$1('<div class="note-hint-item"/>');
                $item.append(hint.template ? hint.template(item) : item + '');
                $item.data({
                    'index': hintIdx,
                    'item': item
                });
                return $item;
            });
        };
        HintPopover.prototype.handleKeydown = function (e) {
            if (!this.$popover.is(':visible')) {
                return;
            }
            if (e.keyCode === key.code.ENTER) {
                e.preventDefault();
                this.replace();
            }
            else if (e.keyCode === key.code.UP) {
                e.preventDefault();
                this.moveUp();
            }
            else if (e.keyCode === key.code.DOWN) {
                e.preventDefault();
                this.moveDown();
            }
        };
        HintPopover.prototype.searchKeyword = function (index, keyword, callback) {
            var hint = this.hints[index];
            if (hint && hint.match.test(keyword) && hint.search) {
                var matches = hint.match.exec(keyword);
                hint.search(matches[1], callback);
            }
            else {
                callback();
            }
        };
        HintPopover.prototype.createGroup = function (idx, keyword) {
            var _this = this;
            var $group = $$1('<div class="note-hint-group note-hint-group-' + idx + '"/>');
            this.searchKeyword(idx, keyword, function (items) {
                items = items || [];
                if (items.length) {
                    $group.html(_this.createItemTemplates(idx, items));
                    _this.show();
                }
            });
            return $group;
        };
        HintPopover.prototype.handleKeyup = function (e) {
            var _this = this;
            if (!lists.contains([key.code.ENTER, key.code.UP, key.code.DOWN], e.keyCode)) {
                var wordRange = this.context.invoke('editor.getLastRange').getWordRange();
                var keyword_1 = wordRange.toString();
                if (this.hints.length && keyword_1) {
                    this.$content.empty();
                    var bnd = func.rect2bnd(lists.last(wordRange.getClientRects()));
                    if (bnd) {
                        this.$popover.hide();
                        this.lastWordRange = wordRange;
                        this.hints.forEach(function (hint, idx) {
                            if (hint.match.test(keyword_1)) {
                                _this.createGroup(idx, keyword_1).appendTo(_this.$content);
                            }
                        });
                        // select first .note-hint-item
                        this.$content.find('.note-hint-item:first').addClass('active');
                        // set position for popover after group is created
                        if (this.direction === 'top') {
                            this.$popover.css({
                                left: bnd.left,
                                top: bnd.top - this.$popover.outerHeight() - POPOVER_DIST
                            });
                        }
                        else {
                            this.$popover.css({
                                left: bnd.left,
                                top: bnd.top + bnd.height + POPOVER_DIST
                            });
                        }
                    }
                }
                else {
                    this.hide();
                }
            }
        };
        HintPopover.prototype.show = function () {
            this.$popover.show();
        };
        HintPopover.prototype.hide = function () {
            this.$popover.hide();
        };
        return HintPopover;
    }());

    $$1.summernote = $$1.extend($$1.summernote, {
        version: '0.8.12',
        plugins: {},
        dom: dom,
        range: range,
        options: {
            langInfo: $$1.summernote.lang['en-US'],
            modules: {
                'editor': Editor,
                'clipboard': Clipboard,
                'dropzone': Dropzone,
                'codeview': CodeView,
                'statusbar': Statusbar,
                'fullscreen': Fullscreen,
                'handle': Handle,
                // FIXME: HintPopover must be front of autolink
                //  - Script error about range when Enter key is pressed on hint popover
                'hintPopover': HintPopover,
                'autoLink': AutoLink,
                'autoSync': AutoSync,
                'autoReplace': AutoReplace,
                'placeholder': Placeholder,
                'buttons': Buttons,
                'toolbar': Toolbar,
                'linkDialog': LinkDialog,
                'linkPopover': LinkPopover,
                'imageDialog': ImageDialog,
                'imagePopover': ImagePopover,
                'tablePopover': TablePopover,
                'videoDialog': VideoDialog,
                'helpDialog': HelpDialog,
                'airPopover': AirPopover
            },
            buttons: {},
            lang: 'en-US',
            followingToolbar: false,
            otherStaticBar: '',
            // toolbar
            toolbar: [
                ['style', ['style']],
                ['font', ['bold', 'underline', 'clear']],
                ['fontname', ['fontname']],
                ['color', ['color']],
                ['para', ['ul', 'ol', 'paragraph']],
                ['table', ['table']],
                ['insert', ['link', 'picture', 'video']],
                ['view', ['fullscreen', 'codeview', 'help']],
            ],
            // popover
            popatmouse: true,
            popover: {
                image: [
                    ['resize', ['resizeFull', 'resizeHalf', 'resizeQuarter', 'resizeNone']],
                    ['float', ['floatLeft', 'floatRight', 'floatNone']],
                    ['remove', ['removeMedia']],
                ],
                link: [
                    ['link', ['linkDialogShow', 'unlink']],
                ],
                table: [
                    ['add', ['addRowDown', 'addRowUp', 'addColLeft', 'addColRight']],
                    ['delete', ['deleteRow', 'deleteCol', 'deleteTable']],
                ],
                air: [
                    ['color', ['color']],
                    ['font', ['bold', 'underline', 'clear']],
                    ['para', ['ul', 'paragraph']],
                    ['table', ['table']],
                    ['insert', ['link', 'picture']],
                ]
            },
            // air mode: inline editor
            airMode: false,
            width: null,
            height: null,
            linkTargetBlank: true,
            focus: false,
            tabSize: 4,
            styleWithSpan: true,
            shortcuts: true,
            textareaAutoSync: true,
            hintDirection: 'bottom',
            tooltip: 'auto',
            container: 'body',
            maxTextLength: 0,
            blockquoteBreakingLevel: 2,
            spellCheck: true,
            styleTags: ['p', 'blockquote', 'pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'],
            fontNames: [
                'Arial', 'Arial Black', 'Comic Sans MS', 'Courier New',
                'Helvetica Neue', 'Helvetica', 'Impact', 'Lucida Grande',
                'Tahoma', 'Times New Roman', 'Verdana',
            ],
            fontNamesIgnoreCheck: [],
            fontSizes: ['8', '9', '10', '11', '12', '14', '18', '24', '36'],
            // pallete colors(n x n)
            colors: [
                ['#000000', '#424242', '#636363', '#9C9C94', '#CEC6CE', '#EFEFEF', '#F7F7F7', '#FFFFFF'],
                ['#FF0000', '#FF9C00', '#FFFF00', '#00FF00', '#00FFFF', '#0000FF', '#9C00FF', '#FF00FF'],
                ['#F7C6CE', '#FFE7CE', '#FFEFC6', '#D6EFD6', '#CEDEE7', '#CEE7F7', '#D6D6E7', '#E7D6DE'],
                ['#E79C9C', '#FFC69C', '#FFE79C', '#B5D6A5', '#A5C6CE', '#9CC6EF', '#B5A5D6', '#D6A5BD'],
                ['#E76363', '#F7AD6B', '#FFD663', '#94BD7B', '#73A5AD', '#6BADDE', '#8C7BC6', '#C67BA5'],
                ['#CE0000', '#E79439', '#EFC631', '#6BA54A', '#4A7B8C', '#3984C6', '#634AA5', '#A54A7B'],
                ['#9C0000', '#B56308', '#BD9400', '#397B21', '#104A5A', '#085294', '#311873', '#731842'],
                ['#630000', '#7B3900', '#846300', '#295218', '#083139', '#003163', '#21104A', '#4A1031'],
            ],
            // http://chir.ag/projects/name-that-color/
            colorsName: [
                ['Black', 'Tundora', 'Dove Gray', 'Star Dust', 'Pale Slate', 'Gallery', 'Alabaster', 'White'],
                ['Red', 'Orange Peel', 'Yellow', 'Green', 'Cyan', 'Blue', 'Electric Violet', 'Magenta'],
                ['Azalea', 'Karry', 'Egg White', 'Zanah', 'Botticelli', 'Tropical Blue', 'Mischka', 'Twilight'],
                ['Tonys Pink', 'Peach Orange', 'Cream Brulee', 'Sprout', 'Casper', 'Perano', 'Cold Purple', 'Careys Pink'],
                ['Mandy', 'Rajah', 'Dandelion', 'Olivine', 'Gulf Stream', 'Viking', 'Blue Marguerite', 'Puce'],
                ['Guardsman Red', 'Fire Bush', 'Golden Dream', 'Chelsea Cucumber', 'Smalt Blue', 'Boston Blue', 'Butterfly Bush', 'Cadillac'],
                ['Sangria', 'Mai Tai', 'Buddha Gold', 'Forest Green', 'Eden', 'Venice Blue', 'Meteorite', 'Claret'],
                ['Rosewood', 'Cinnamon', 'Olive', 'Parsley', 'Tiber', 'Midnight Blue', 'Valentino', 'Loulou'],
            ],
            colorButton: {
                foreColor: '#000000',
                backColor: '#FFFF00'
            },
            lineHeights: ['1.0', '1.2', '1.4', '1.5', '1.6', '1.8', '2.0', '3.0'],
            tableClassName: 'table table-bordered',
            insertTableMaxSize: {
                col: 10,
                row: 10
            },
            dialogsInBody: false,
            dialogsFade: false,
            maximumImageFileSize: null,
            callbacks: {
                onBeforeCommand: null,
                onBlur: null,
                onBlurCodeview: null,
                onChange: null,
                onChangeCodeview: null,
                onDialogShown: null,
                onEnter: null,
                onFocus: null,
                onImageLinkInsert: null,
                onImageUpload: null,
                onImageUploadError: null,
                onInit: null,
                onKeydown: null,
                onKeyup: null,
                onMousedown: null,
                onMouseup: null,
                onPaste: null,
                onScroll: null
            },
            codemirror: {
                mode: 'text/html',
                htmlMode: true,
                lineNumbers: true
            },
            codeviewFilter: false,
            codeviewFilterRegex: /<\/*(?:applet|b(?:ase|gsound|link)|embed|frame(?:set)?|ilayer|l(?:ayer|ink)|meta|object|s(?:cript|tyle)|t(?:itle|extarea)|xml)[^>]*?>/gi,
            codeviewIframeFilter: true,
            codeviewIframeWhitelistSrc: [],
            codeviewIframeWhitelistSrcBase: [
                'www.youtube.com',
                'www.youtube-nocookie.com',
                'www.facebook.com',
                'vine.co',
                'instagram.com',
                'player.vimeo.com',
                'www.dailymotion.com',
                'player.youku.com',
                'v.qq.com',
            ],
            keyMap: {
                pc: {
                    'ENTER': 'insertParagraph',
                    'CTRL+Z': 'undo',
                    'CTRL+Y': 'redo',
                    'TAB': 'tab',
                    'SHIFT+TAB': 'untab',
                    'CTRL+B': 'bold',
                    'CTRL+I': 'italic',
                    'CTRL+U': 'underline',
                    'CTRL+SHIFT+S': 'strikethrough',
                    'CTRL+BACKSLASH': 'removeFormat',
                    'CTRL+SHIFT+L': 'justifyLeft',
                    'CTRL+SHIFT+E': 'justifyCenter',
                    'CTRL+SHIFT+R': 'justifyRight',
                    'CTRL+SHIFT+J': 'justifyFull',
                    'CTRL+SHIFT+NUM7': 'insertUnorderedList',
                    'CTRL+SHIFT+NUM8': 'insertOrderedList',
                    'CTRL+LEFTBRACKET': 'outdent',
                    'CTRL+RIGHTBRACKET': 'indent',
                    'CTRL+NUM0': 'formatPara',
                    'CTRL+NUM1': 'formatH1',
                    'CTRL+NUM2': 'formatH2',
                    'CTRL+NUM3': 'formatH3',
                    'CTRL+NUM4': 'formatH4',
                    'CTRL+NUM5': 'formatH5',
                    'CTRL+NUM6': 'formatH6',
                    'CTRL+ENTER': 'insertHorizontalRule',
                    'CTRL+K': 'linkDialog.show'
                },
                mac: {
                    'ENTER': 'insertParagraph',
                    'CMD+Z': 'undo',
                    'CMD+SHIFT+Z': 'redo',
                    'TAB': 'tab',
                    'SHIFT+TAB': 'untab',
                    'CMD+B': 'bold',
                    'CMD+I': 'italic',
                    'CMD+U': 'underline',
                    'CMD+SHIFT+S': 'strikethrough',
                    'CMD+BACKSLASH': 'removeFormat',
                    'CMD+SHIFT+L': 'justifyLeft',
                    'CMD+SHIFT+E': 'justifyCenter',
                    'CMD+SHIFT+R': 'justifyRight',
                    'CMD+SHIFT+J': 'justifyFull',
                    'CMD+SHIFT+NUM7': 'insertUnorderedList',
                    'CMD+SHIFT+NUM8': 'insertOrderedList',
                    'CMD+LEFTBRACKET': 'outdent',
                    'CMD+RIGHTBRACKET': 'indent',
                    'CMD+NUM0': 'formatPara',
                    'CMD+NUM1': 'formatH1',
                    'CMD+NUM2': 'formatH2',
                    'CMD+NUM3': 'formatH3',
                    'CMD+NUM4': 'formatH4',
                    'CMD+NUM5': 'formatH5',
                    'CMD+NUM6': 'formatH6',
                    'CMD+ENTER': 'insertHorizontalRule',
                    'CMD+K': 'linkDialog.show'
                }
            },
            icons: {
                'align': 'note-icon-align',
                'alignCenter': 'note-icon-align-center',
                'alignJustify': 'note-icon-align-justify',
                'alignLeft': 'note-icon-align-left',
                'alignRight': 'note-icon-align-right',
                'rowBelow': 'note-icon-row-below',
                'colBefore': 'note-icon-col-before',
                'colAfter': 'note-icon-col-after',
                'rowAbove': 'note-icon-row-above',
                'rowRemove': 'note-icon-row-remove',
                'colRemove': 'note-icon-col-remove',
                'indent': 'note-icon-align-indent',
                'outdent': 'note-icon-align-outdent',
                'arrowsAlt': 'note-icon-arrows-alt',
                'bold': 'note-icon-bold',
                'caret': 'note-icon-caret',
                'circle': 'note-icon-circle',
                'close': 'note-icon-close',
                'code': 'note-icon-code',
                'eraser': 'note-icon-eraser',
                'floatLeft': 'note-icon-float-left',
                'floatRight': 'note-icon-float-right',
                'font': 'note-icon-font',
                'frame': 'note-icon-frame',
                'italic': 'note-icon-italic',
                'link': 'note-icon-link',
                'unlink': 'note-icon-chain-broken',
                'magic': 'note-icon-magic',
                'menuCheck': 'note-icon-menu-check',
                'minus': 'note-icon-minus',
                'orderedlist': 'note-icon-orderedlist',
                'pencil': 'note-icon-pencil',
                'picture': 'note-icon-picture',
                'question': 'note-icon-question',
                'redo': 'note-icon-redo',
                'rollback': 'note-icon-rollback',
                'square': 'note-icon-square',
                'strikethrough': 'note-icon-strikethrough',
                'subscript': 'note-icon-subscript',
                'superscript': 'note-icon-superscript',
                'table': 'note-icon-table',
                'textHeight': 'note-icon-text-height',
                'trash': 'note-icon-trash',
                'underline': 'note-icon-underline',
                'undo': 'note-icon-undo',
                'unorderedlist': 'note-icon-unorderedlist',
                'video': 'note-icon-video'
            }
        }
    });

    $$1.summernote = $$1.extend($$1.summernote, {
        ui: ui
    });

}));
//# sourceMappingURL=summernote.js.map
/**
 * Created by sachin on 20/2/17.
 */
(function e(t, n, r) {
    function s(o, u) {
        if (!n[o]) {
            if (!t[o]) {
                var a = typeof require == "function" && require;
                if (!u && a) return a(o, !0);
                if (i) return i(o, !0);
                var f = new Error("Cannot find module '" + o + "'");
                throw f.code = "MODULE_NOT_FOUND", f
            }
            var l = n[o] = {exports: {}};
            t[o][0].call(l.exports, function (e) {
                var n = t[o][1][e];
                return s(n ? n : e)
            }, l, l.exports, e, t, n, r)
        }
        return n[o].exports
    }

    var i = typeof require == "function" && require;
    for (var o = 0; o < r.length; o++) s(r[o]);
    return s
})({
    1: [function (require, module, exports) {
        module.exports = Date.now || now

        function now() {
            return new Date().getTime()
        }

    }, {}], 2: [function (require, module, exports) {

        /**
         * Module dependencies.
         */

        var now = require('date-now');

        /**
         * Returns a function, that, as long as it continues to be invoked, will not
         * be triggered. The function will be called after it stops being called for
         * N milliseconds. If `immediate` is passed, trigger the function on the
         * leading edge, instead of the trailing.
         *
         * @source underscore.js
         * @see http://unscriptable.com/2009/03/20/debouncing-javascript-methods/
         * @param {Function} function to wrap
         * @param {Number} timeout in ms (`100`)
         * @param {Boolean} whether to execute at the beginning (`false`)
         * @api public
         */

        module.exports = function debounce(func, wait, immediate) {
            var timeout, args, context, timestamp, result;
            if (null == wait) wait = 100;

            function later() {
                var last = now() - timestamp;

                if (last < wait && last > 0) {
                    timeout = setTimeout(later, wait - last);
                } else {
                    timeout = null;
                    if (!immediate) {
                        result = func.apply(context, args);
                        if (!timeout) context = args = null;
                    }
                }
            };

            return function debounced() {
                context = this;
                args = arguments;
                timestamp = now();
                var callNow = immediate && !timeout;
                if (!timeout) timeout = setTimeout(later, wait);
                if (callNow) {
                    result = func.apply(context, args);
                    context = args = null;
                }

                return result;
            };
        };

    }, {"date-now": 1}], 3: [function (require, module, exports) {
        (function (global) {
            'use strict';

            var _debounce = require('debounce');

            var _debounce2 = _interopRequireDefault(_debounce);

            var _jquery = (typeof window !== "undefined" ? window['jQuery'] : typeof global !== "undefined" ? global['jQuery'] : null);

            var _jquery2 = _interopRequireDefault(_jquery);

            function _interopRequireDefault(obj) {
                return obj && obj.__esModule ? obj : {default: obj};
            }

            var groupElementsByTop = function groupElementsByTop(groups, element) {
                var top = (0, _jquery2.default)(element).offset().top;
                groups[top] = groups[top] || [];
                groups[top].push(element);
                return groups;
            };

            var groupElementsByZero = function groupElementsByZero(groups, element) {
                groups[0] = groups[0] || [];
                groups[0].push(element);
                return groups;
            };

            var clearHeight = function clearHeight(elements) {
                return (0, _jquery2.default)(elements).css('height', 'auto');
            };

            var getHeight = function getHeight(element) {
                return (0, _jquery2.default)(element).height();
            };

            var applyMaxHeight = function applyMaxHeight(elements) {
                var heights = elements.map(getHeight);
                var maxHeight = Math.max.apply(null, heights);
                (0, _jquery2.default)(elements).height(maxHeight);
            };

            var equalizeHeights = function equalizeHeights(elements, groupByTop) {
                // Sort into groups.
                var groups = groupByTop ? elements.reduce(groupElementsByTop, {}) : elements.reduce(groupElementsByZero, {});
                // Convert to arrays.
                var groupsAsArray = Object.keys(groups).map(function (key) {
                    return groups[key];
                });
                // Apply max height.
                groupsAsArray.forEach(clearHeight);
                groupsAsArray.forEach(applyMaxHeight);
            };

            _jquery2.default.fn.equalHeight = function () {
                var _ref = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

                var _ref$groupByTop = _ref.groupByTop;
                var groupByTop = _ref$groupByTop === undefined ? false : _ref$groupByTop;
                var _ref$resizeTimeout = _ref.resizeTimeout;
                var resizeTimeout = _ref$resizeTimeout === undefined ? 20 : _ref$resizeTimeout;
                var _ref$updateOnDOMReady = _ref.updateOnDOMReady;
                var updateOnDOMReady = _ref$updateOnDOMReady === undefined ? true : _ref$updateOnDOMReady;
                var _ref$updateOnDOMLoad = _ref.updateOnDOMLoad;
                var updateOnDOMLoad = _ref$updateOnDOMLoad === undefined ? false : _ref$updateOnDOMLoad;

                // Convert to native array.
                var elements = this.toArray();
                // Handle resize event.
                if (updateOnDOMLoad) {
                    equalizeHeights(elements, groupByTop);
                }
                (0, _jquery2.default)(window).on('resize', (0, _debounce2.default)(function () {
                    equalizeHeights(elements, groupByTop);
                }, resizeTimeout));
                // Handle load event.
                (0, _jquery2.default)(window).on('load', function () {

                });
                // Handle ready event.
                (0, _jquery2.default)(document).on('ready', function () {
                    if (updateOnDOMReady) {
                        equalizeHeights(elements, groupByTop);
                    }
                });
                return this;
            };

        }).call(this, typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
    }, {"debounce": 2}]
}, {}, [3]);

/* ========================================================================
 * Bootstrap (plugin): validator.js v0.11.9
 * ========================================================================
 * The MIT License (MIT)
 *
 * Copyright (c) 2016 Cina Saffary.
 * Made by @1000hz in the style of Bootstrap 3 era @fat
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 * ======================================================================== */


+function ($) {
    'use strict';

    // VALIDATOR CLASS DEFINITION
    // ==========================

    function getValue($el) {
        return $el.is('[type="checkbox"]') ? $el.prop('checked') :
            $el.is('[type="radio"]') ? !!$('[name="' + $el.attr('name') + '"]:checked').length :
                $el.is('select[multiple]') ? ($el.val() || []).length :
                    $el.val()
    }

    var Validator = function (element, options) {
        this.options = options
        this.validators = $.extend({}, Validator.VALIDATORS, options.custom)
        this.$element = $(element)
        this.$btn = $('button[type="submit"], input[type="submit"]')
            .filter('[form="' + this.$element.attr('id') + '"]')
            .add(this.$element.find('input[type="submit"], button[type="submit"]'))

        this.update()

        this.$element.on('input.bs.validator change.bs.validator focusout.bs.validator', $.proxy(this.onInput, this))
        this.$element.on('submit.bs.validator', $.proxy(this.onSubmit, this))
        this.$element.on('reset.bs.validator', $.proxy(this.reset, this))

        this.$element.find('[data-match]').each(function () {
            var $this = $(this)
            var target = $this.attr('data-match')

            $(target).on('input.bs.validator', function (e) {
                getValue($this) && $this.trigger('input.bs.validator')
            })
        })

        // run validators for fields with values, but don't clobber server-side errors
        this.$inputs.filter(function () {
            return getValue($(this)) && !$(this).closest('.has-error').length
        }).trigger('focusout')

        this.$element.attr('novalidate', true) // disable automatic native validation
    }

    Validator.VERSION = '0.11.9'

    Validator.INPUT_SELECTOR = ':input:not([type="hidden"], [type="submit"], [type="reset"], button)'

    Validator.FOCUS_OFFSET = 20

    Validator.DEFAULTS = {
        delay: 500,
        html: false,
        disable: true,
        focus: true,
        custom: {},
        errors: {
            match: 'Does not match',
            minlength: 'Not long enough'
        },
        feedback: {
            success: 'glyphicon-ok',
            error: 'glyphicon-remove'
        }
    }

    Validator.VALIDATORS = {
        'native': function ($el) {
            var el = $el[0]
            if (el.checkValidity) {
                return !el.checkValidity() && !el.validity.valid && (el.validationMessage || "error!")
            }
        },
        'match': function ($el) {
            var target = $el.attr('data-match')
            return $el.val() !== $(target).val() && Validator.DEFAULTS.errors.match
        },
        'minlength': function ($el) {
            var minlength = $el.attr('data-minlength')
            return $el.val().length < minlength && Validator.DEFAULTS.errors.minlength
        }
    }

    Validator.prototype.update = function () {
        var self = this

        this.$inputs = this.$element.find(Validator.INPUT_SELECTOR)
            .add(this.$element.find('[data-validate="true"]'))
            .not(this.$element.find('[data-validate="false"]')
                .each(function () {
                    self.clearErrors($(this))
                })
            )

        this.toggleSubmit()

        return this
    }

    Validator.prototype.onInput = function (e) {
        var self = this
        var $el = $(e.target)
        var deferErrors = e.type !== 'focusout'

        if (!this.$inputs.is($el)) return

        this.validateInput($el, deferErrors).done(function () {
            self.toggleSubmit()
        })
    }

    Validator.prototype.validateInput = function ($el, deferErrors) {
        var value = getValue($el)
        var prevErrors = $el.data('bs.validator.errors')

        if ($el.is('[type="radio"]')) $el = this.$element.find('input[name="' + $el.attr('name') + '"]')

        var e = $.Event('validate.bs.validator', {relatedTarget: $el[0]})
        this.$element.trigger(e)
        if (e.isDefaultPrevented()) return

        var self = this

        return this.runValidators($el).done(function (errors) {
            $el.data('bs.validator.errors', errors)

            errors.length
                ? deferErrors ? self.defer($el, self.showErrors) : self.showErrors($el)
                : self.clearErrors($el)

            if (!prevErrors || errors.toString() !== prevErrors.toString()) {
                e = errors.length
                    ? $.Event('invalid.bs.validator', {relatedTarget: $el[0], detail: errors})
                    : $.Event('valid.bs.validator', {relatedTarget: $el[0], detail: prevErrors})

                self.$element.trigger(e)
            }

            self.toggleSubmit()

            self.$element.trigger($.Event('validated.bs.validator', {relatedTarget: $el[0]}))
        })
    }


    Validator.prototype.runValidators = function ($el) {
        var errors = []
        var deferred = $.Deferred()

        $el.data('bs.validator.deferred') && $el.data('bs.validator.deferred').reject()
        $el.data('bs.validator.deferred', deferred)

        function getValidatorSpecificError(key) {
            return $el.attr('data-' + key + '-error')
        }

        function getValidityStateError() {
            var validity = $el[0].validity
            return validity.typeMismatch ? $el.attr('data-type-error')
                : validity.patternMismatch ? $el.attr('data-pattern-error')
                    : validity.stepMismatch ? $el.attr('data-step-error')
                        : validity.rangeOverflow ? $el.attr('data-max-error')
                            : validity.rangeUnderflow ? $el.attr('data-min-error')
                                : validity.valueMissing ? $el.attr('data-required-error')
                                    : null
        }

        function getGenericError() {
            return $el.attr('data-error')
        }

        function getErrorMessage(key) {
            return getValidatorSpecificError(key)
                || getValidityStateError()
                || getGenericError()
        }

        $.each(this.validators, $.proxy(function (key, validator) {
            var error = null
            if ((getValue($el) || $el.attr('required')) &&
                ($el.attr('data-' + key) !== undefined || key == 'native') &&
                (error = validator.call(this, $el))) {
                error = getErrorMessage(key) || error
                !~errors.indexOf(error) && errors.push(error)
            }
        }, this))

        if (!errors.length && getValue($el) && $el.attr('data-remote')) {
            this.defer($el, function () {
                var data = {}
                data[$el.attr('name')] = getValue($el)
                $.get($el.attr('data-remote'), data)
                    .fail(function (jqXHR, textStatus, error) {
                        errors.push(getErrorMessage('remote') || error)
                    })
                    .always(function () {
                        deferred.resolve(errors)
                    })
            })
        } else deferred.resolve(errors)

        return deferred.promise()
    }

    Validator.prototype.validate = function () {
        var self = this

        $.when(this.$inputs.map(function (el) {
            return self.validateInput($(this), false)
        })).then(function () {
            self.toggleSubmit()
            self.focusError()
        })

        return this
    }

    Validator.prototype.focusError = function () {
        if (!this.options.focus) return

        var $input = this.$element.find(".has-error:first :input")
        if ($input.length === 0) return

        $('html, body').animate({scrollTop: $input.offset().top - Validator.FOCUS_OFFSET}, 250)
        $input.focus()
    }

    Validator.prototype.showErrors = function ($el) {
        var method = this.options.html ? 'html' : 'text'
        var errors = $el.data('bs.validator.errors')
        var $group = $el.closest('.form-group')
        var $block = $group.find('.help-block.with-errors')
        var $feedback = $group.find('.form-control-feedback')

        if (!errors.length) return

        errors = $('<ul/>')
            .addClass('list-unstyled')
            .append($.map(errors, function (error) {
                return $('<li/>')[method](error)
            }))

        $block.data('bs.validator.originalContent') === undefined && $block.data('bs.validator.originalContent', $block.html())
        $block.empty().append(errors)
        $group.addClass('has-error has-danger')

        $group.hasClass('has-feedback')
        && $feedback.removeClass(this.options.feedback.success)
        && $feedback.addClass(this.options.feedback.error)
        && $group.removeClass('has-success')
    }

    Validator.prototype.clearErrors = function ($el) {
        var $group = $el.closest('.form-group')
        var $block = $group.find('.help-block.with-errors')
        var $feedback = $group.find('.form-control-feedback')

        $block.html($block.data('bs.validator.originalContent'))
        $group.removeClass('has-error has-danger has-success')

        $group.hasClass('has-feedback')
        && $feedback.removeClass(this.options.feedback.error)
        && $feedback.removeClass(this.options.feedback.success)
        && getValue($el)
        && $feedback.addClass(this.options.feedback.success)
        && $group.addClass('has-success')
    }

    Validator.prototype.hasErrors = function () {
        function fieldErrors() {
            return !!($(this).data('bs.validator.errors') || []).length
        }

        return !!this.$inputs.filter(fieldErrors).length
    }

    Validator.prototype.isIncomplete = function () {
        function fieldIncomplete() {
            var value = getValue($(this))
            return !(typeof value == "string" ? $.trim(value) : value)
        }

        return !!this.$inputs.filter('[required]').filter(fieldIncomplete).length
    }

    Validator.prototype.onSubmit = function (e) {
        this.validate()
        if (this.isIncomplete() || this.hasErrors()) {
            e.preventDefault()
        }
    }

    Validator.prototype.toggleSubmit = function () {
        if (!this.options.disable) return
        this.$btn.toggleClass('disabled', this.isIncomplete() || this.hasErrors())
    }

    Validator.prototype.defer = function ($el, callback) {
        callback = $.proxy(callback, this, $el)
        if (!this.options.delay) return callback()
        window.clearTimeout($el.data('bs.validator.timeout'))
        $el.data('bs.validator.timeout', window.setTimeout(callback, this.options.delay))
    }

    Validator.prototype.reset = function () {
        this.$element.find('.form-control-feedback')
            .removeClass(this.options.feedback.error)
            .removeClass(this.options.feedback.success)

        this.$inputs
            .removeData(['bs.validator.errors', 'bs.validator.deferred'])
            .each(function () {
                var $this = $(this)
                var timeout = $this.data('bs.validator.timeout')
                window.clearTimeout(timeout) && $this.removeData('bs.validator.timeout')
            })

        this.$element.find('.help-block.with-errors')
            .each(function () {
                var $this = $(this)
                var originalContent = $this.data('bs.validator.originalContent')

                $this
                    .removeData('bs.validator.originalContent')
                    .html(originalContent)
            })

        this.$btn.removeClass('disabled')

        this.$element.find('.has-error, .has-danger, .has-success').removeClass('has-error has-danger has-success')

        return this
    }

    Validator.prototype.destroy = function () {
        this.reset()

        this.$element
            .removeAttr('novalidate')
            .removeData('bs.validator')
            .off('.bs.validator')

        this.$inputs
            .off('.bs.validator')

        this.options = null
        this.validators = null
        this.$element = null
        this.$btn = null
        this.$inputs = null

        return this
    }

    // VALIDATOR PLUGIN DEFINITION
    // ===========================


    function Plugin(option) {
        return this.each(function () {
            var $this = $(this)
            var options = $.extend({}, Validator.DEFAULTS, $this.data(), typeof option == 'object' && option)
            var data = $this.data('bs.validator')

            if (!data && option == 'destroy') return
            if (!data) $this.data('bs.validator', (data = new Validator(this, options)))
            if (typeof option == 'string') data[option]()
        })
    }

    var old = $.fn.validator

    $.fn.validator = Plugin
    $.fn.validator.Constructor = Validator


    // VALIDATOR NO CONFLICT
    // =====================

    $.fn.validator.noConflict = function () {
        $.fn.validator = old
        return this
    }


    // VALIDATOR DATA-API
    // ==================

    $(window).on('load', function () {
        $('form[data-toggle="validator"]').each(function () {
            var $form = $(this)
            Plugin.call($form, $form.data())
        })
    })

}(jQuery);

/*!

 handlebars v2.0.0

 Copyright (C) 2011-2014 by Yehuda Katz

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.

 @license
 */
/* exported Handlebars */
(function (root, factory) {
    if (typeof define === 'function' && define.amd) {
        define([], factory);
    } else if (typeof exports === 'object') {
        module.exports = factory();
    } else {
        root.Handlebars = root.Handlebars || factory();
    }
}(this, function () {
// handlebars/safe-string.js
    var __module4__ = (function () {
        "use strict";
        var __exports__;

        // Build out our basic SafeString type
        function SafeString(string) {
            this.string = string;
        }

        SafeString.prototype.toString = function () {
            return "" + this.string;
        };

        __exports__ = SafeString;
        return __exports__;
    })();

// handlebars/utils.js
    var __module3__ = (function (__dependency1__) {
        "use strict";
        var __exports__ = {};
        /*jshint -W004 */
        var SafeString = __dependency1__;

        var escape = {
            "&": "&amp;",
            "<": "&lt;",
            ">": "&gt;",
            '"': "&quot;",
            "'": "&#x27;",
            "`": "&#x60;"
        };

        var badChars = /[&<>"'`]/g;
        var possible = /[&<>"'`]/;

        function escapeChar(chr) {
            return escape[chr];
        }

        function extend(obj /* , ...source */) {
            for (var i = 1; i < arguments.length; i++) {
                for (var key in arguments[i]) {
                    if (Object.prototype.hasOwnProperty.call(arguments[i], key)) {
                        obj[key] = arguments[i][key];
                    }
                }
            }

            return obj;
        }

        __exports__.extend = extend;
        var toString = Object.prototype.toString;
        __exports__.toString = toString;
        // Sourced from lodash
        // https://github.com/bestiejs/lodash/blob/master/LICENSE.txt
        var isFunction = function (value) {
            return typeof value === 'function';
        };
        // fallback for older versions of Chrome and Safari
        /* istanbul ignore next */
        if (isFunction(/x/)) {
            isFunction = function (value) {
                return typeof value === 'function' && toString.call(value) === '[object Function]';
            };
        }
        var isFunction;
        __exports__.isFunction = isFunction;
        /* istanbul ignore next */
        var isArray = Array.isArray || function (value) {
            return (value && typeof value === 'object') ? toString.call(value) === '[object Array]' : false;
        };
        __exports__.isArray = isArray;

        function escapeExpression(string) {
            // don't escape SafeStrings, since they're already safe
            if (string instanceof SafeString) {
                return string.toString();
            } else if (string == null) {
                return "";
            } else if (!string) {
                return string + '';
            }

            // Force a string conversion as this will be done by the append regardless and
            // the regex test will do this transparently behind the scenes, causing issues if
            // an object's to string has escaped characters in it.
            string = "" + string;

            if (!possible.test(string)) {
                return string;
            }
            return string.replace(badChars, escapeChar);
        }

        __exports__.escapeExpression = escapeExpression;

        function isEmpty(value) {
            if (!value && value !== 0) {
                return true;
            } else if (isArray(value) && value.length === 0) {
                return true;
            } else {
                return false;
            }
        }

        __exports__.isEmpty = isEmpty;

        function appendContextPath(contextPath, id) {
            return (contextPath ? contextPath + '.' : '') + id;
        }

        __exports__.appendContextPath = appendContextPath;
        return __exports__;
    })(__module4__);

// handlebars/exception.js
    var __module5__ = (function () {
        "use strict";
        var __exports__;

        var errorProps = ['description', 'fileName', 'lineNumber', 'message', 'name', 'number', 'stack'];

        function Exception(message, node) {
            var line;
            if (node && node.firstLine) {
                line = node.firstLine;

                message += ' - ' + line + ':' + node.firstColumn;
            }

            var tmp = Error.prototype.constructor.call(this, message);

            // Unfortunately errors are not enumerable in Chrome (at least), so `for prop in tmp` doesn't work.
            for (var idx = 0; idx < errorProps.length; idx++) {
                this[errorProps[idx]] = tmp[errorProps[idx]];
            }

            if (line) {
                this.lineNumber = line;
                this.column = node.firstColumn;
            }
        }

        Exception.prototype = new Error();

        __exports__ = Exception;
        return __exports__;
    })();

// handlebars/base.js
    var __module2__ = (function (__dependency1__, __dependency2__) {
        "use strict";
        var __exports__ = {};
        var Utils = __dependency1__;
        var Exception = __dependency2__;

        var VERSION = "2.0.0";
        __exports__.VERSION = VERSION;
        var COMPILER_REVISION = 6;
        __exports__.COMPILER_REVISION = COMPILER_REVISION;
        var REVISION_CHANGES = {
            1: '<= 1.0.rc.2', // 1.0.rc.2 is actually rev2 but doesn't report it
            2: '== 1.0.0-rc.3',
            3: '== 1.0.0-rc.4',
            4: '== 1.x.x',
            5: '== 2.0.0-alpha.x',
            6: '>= 2.0.0-beta.1'
        };
        __exports__.REVISION_CHANGES = REVISION_CHANGES;
        var isArray = Utils.isArray,
            isFunction = Utils.isFunction,
            toString = Utils.toString,
            objectType = '[object Object]';

        function HandlebarsEnvironment(helpers, partials) {
            this.helpers = helpers || {};
            this.partials = partials || {};

            registerDefaultHelpers(this);
        }

        __exports__.HandlebarsEnvironment = HandlebarsEnvironment;
        HandlebarsEnvironment.prototype = {
            constructor: HandlebarsEnvironment,

            logger: logger,
            log: log,

            registerHelper: function (name, fn) {
                if (toString.call(name) === objectType) {
                    if (fn) {
                        throw new Exception('Arg not supported with multiple helpers');
                    }
                    Utils.extend(this.helpers, name);
                } else {
                    this.helpers[name] = fn;
                }
            },
            unregisterHelper: function (name) {
                delete this.helpers[name];
            },

            registerPartial: function (name, partial) {
                if (toString.call(name) === objectType) {
                    Utils.extend(this.partials, name);
                } else {
                    this.partials[name] = partial;
                }
            },
            unregisterPartial: function (name) {
                delete this.partials[name];
            }
        };

        function registerDefaultHelpers(instance) {
            instance.registerHelper('helperMissing', function (/* [args, ]options */) {
                if (arguments.length === 1) {
                    // A missing field in a {{foo}} constuct.
                    return undefined;
                } else {
                    // Someone is actually trying to call something, blow up.
                    throw new Exception("Missing helper: '" + arguments[arguments.length - 1].name + "'");
                }
            });

            instance.registerHelper('blockHelperMissing', function (context, options) {
                var inverse = options.inverse,
                    fn = options.fn;

                if (context === true) {
                    return fn(this);
                } else if (context === false || context == null) {
                    return inverse(this);
                } else if (isArray(context)) {
                    if (context.length > 0) {
                        if (options.ids) {
                            options.ids = [options.name];
                        }

                        return instance.helpers.each(context, options);
                    } else {
                        return inverse(this);
                    }
                } else {
                    if (options.data && options.ids) {
                        var data = createFrame(options.data);
                        data.contextPath = Utils.appendContextPath(options.data.contextPath, options.name);
                        options = {data: data};
                    }

                    return fn(context, options);
                }
            });

            instance.registerHelper('each', function (context, options) {
                if (!options) {
                    throw new Exception('Must pass iterator to #each');
                }

                var fn = options.fn, inverse = options.inverse;
                var i = 0, ret = "", data;

                var contextPath;
                if (options.data && options.ids) {
                    contextPath = Utils.appendContextPath(options.data.contextPath, options.ids[0]) + '.';
                }

                if (isFunction(context)) {
                    context = context.call(this);
                }

                if (options.data) {
                    data = createFrame(options.data);
                }

                if (context && typeof context === 'object') {
                    if (isArray(context)) {
                        for (var j = context.length; i < j; i++) {
                            if (data) {
                                data.index = i;
                                data.first = (i === 0);
                                data.last = (i === (context.length - 1));

                                if (contextPath) {
                                    data.contextPath = contextPath + i;
                                }
                            }
                            ret = ret + fn(context[i], {data: data});
                        }
                    } else {
                        for (var key in context) {
                            if (context.hasOwnProperty(key)) {
                                if (data) {
                                    data.key = key;
                                    data.index = i;
                                    data.first = (i === 0);

                                    if (contextPath) {
                                        data.contextPath = contextPath + key;
                                    }
                                }
                                ret = ret + fn(context[key], {data: data});
                                i++;
                            }
                        }
                    }
                }

                if (i === 0) {
                    ret = inverse(this);
                }

                return ret;
            });

            instance.registerHelper('if', function (conditional, options) {
                if (isFunction(conditional)) {
                    conditional = conditional.call(this);
                }

                // Default behavior is to render the positive path if the value is truthy and not empty.
                // The `includeZero` option may be set to treat the condtional as purely not empty based on the
                // behavior of isEmpty. Effectively this determines if 0 is handled by the positive path or negative.
                if ((!options.hash.includeZero && !conditional) || Utils.isEmpty(conditional)) {
                    return options.inverse(this);
                } else {
                    return options.fn(this);
                }
            });

            instance.registerHelper('unless', function (conditional, options) {
                return instance.helpers['if'].call(this, conditional, {
                    fn: options.inverse,
                    inverse: options.fn,
                    hash: options.hash
                });
            });

            instance.registerHelper('with', function (context, options) {
                if (isFunction(context)) {
                    context = context.call(this);
                }

                var fn = options.fn;

                if (!Utils.isEmpty(context)) {
                    if (options.data && options.ids) {
                        var data = createFrame(options.data);
                        data.contextPath = Utils.appendContextPath(options.data.contextPath, options.ids[0]);
                        options = {data: data};
                    }

                    return fn(context, options);
                } else {
                    return options.inverse(this);
                }
            });

            instance.registerHelper('log', function (message, options) {
                var level = options.data && options.data.level != null ? parseInt(options.data.level, 10) : 1;
                instance.log(level, message);
            });

            instance.registerHelper('lookup', function (obj, field) {
                return obj && obj[field];
            });
        }

        var logger = {
            methodMap: {0: 'debug', 1: 'info', 2: 'warn', 3: 'error'},

            // State enum
            DEBUG: 0,
            INFO: 1,
            WARN: 2,
            ERROR: 3,
            level: 3,

            // can be overridden in the host environment
            log: function (level, message) {
                if (logger.level <= level) {
                    var method = logger.methodMap[level];
                    if (typeof console !== 'undefined' && console[method]) {
                        console[method].call(console, message);
                    }
                }
            }
        };
        __exports__.logger = logger;
        var log = logger.log;
        __exports__.log = log;
        var createFrame = function (object) {
            var frame = Utils.extend({}, object);
            frame._parent = object;
            return frame;
        };
        __exports__.createFrame = createFrame;
        return __exports__;
    })(__module3__, __module5__);

// handlebars/runtime.js
    var __module6__ = (function (__dependency1__, __dependency2__, __dependency3__) {
        "use strict";
        var __exports__ = {};
        var Utils = __dependency1__;
        var Exception = __dependency2__;
        var COMPILER_REVISION = __dependency3__.COMPILER_REVISION;
        var REVISION_CHANGES = __dependency3__.REVISION_CHANGES;
        var createFrame = __dependency3__.createFrame;

        function checkRevision(compilerInfo) {
            var compilerRevision = compilerInfo && compilerInfo[0] || 1,
                currentRevision = COMPILER_REVISION;

            if (compilerRevision !== currentRevision) {
                if (compilerRevision < currentRevision) {
                    var runtimeVersions = REVISION_CHANGES[currentRevision],
                        compilerVersions = REVISION_CHANGES[compilerRevision];
                    throw new Exception("Template was precompiled with an older version of Handlebars than the current runtime. " +
                        "Please update your precompiler to a newer version (" + runtimeVersions + ") or downgrade your runtime to an older version (" + compilerVersions + ").");
                } else {
                    // Use the embedded version info since the runtime doesn't know about this revision yet
                    throw new Exception("Template was precompiled with a newer version of Handlebars than the current runtime. " +
                        "Please update your runtime to a newer version (" + compilerInfo[1] + ").");
                }
            }
        }

        __exports__.checkRevision = checkRevision;// TODO: Remove this line and break up compilePartial

        function template(templateSpec, env) {
            /* istanbul ignore next */
            if (!env) {
                throw new Exception("No environment passed to template");
            }
            if (!templateSpec || !templateSpec.main) {
                throw new Exception('Unknown template object: ' + typeof templateSpec);
            }

            // Note: Using env.VM references rather than local var references throughout this section to allow
            // for external users to override these as psuedo-supported APIs.
            env.VM.checkRevision(templateSpec.compiler);

            var invokePartialWrapper = function (partial, indent, name, context, hash, helpers, partials, data, depths) {
                if (hash) {
                    context = Utils.extend({}, context, hash);
                }

                var result = env.VM.invokePartial.call(this, partial, name, context, helpers, partials, data, depths);

                if (result == null && env.compile) {
                    var options = {helpers: helpers, partials: partials, data: data, depths: depths};
                    partials[name] = env.compile(partial, {data: data !== undefined, compat: templateSpec.compat}, env);
                    result = partials[name](context, options);
                }
                if (result != null) {
                    if (indent) {
                        var lines = result.split('\n');
                        for (var i = 0, l = lines.length; i < l; i++) {
                            if (!lines[i] && i + 1 === l) {
                                break;
                            }

                            lines[i] = indent + lines[i];
                        }
                        result = lines.join('\n');
                    }
                    return result;
                } else {
                    throw new Exception("The partial " + name + " could not be compiled when running in runtime-only mode");
                }
            };

            // Just add water
            var container = {
                lookup: function (depths, name) {
                    var len = depths.length;
                    for (var i = 0; i < len; i++) {
                        if (depths[i] && depths[i][name] != null) {
                            return depths[i][name];
                        }
                    }
                },
                lambda: function (current, context) {
                    return typeof current === 'function' ? current.call(context) : current;
                },

                escapeExpression: Utils.escapeExpression,
                invokePartial: invokePartialWrapper,

                fn: function (i) {
                    return templateSpec[i];
                },

                programs: [],
                program: function (i, data, depths) {
                    var programWrapper = this.programs[i],
                        fn = this.fn(i);
                    if (data || depths) {
                        programWrapper = program(this, i, fn, data, depths);
                    } else if (!programWrapper) {
                        programWrapper = this.programs[i] = program(this, i, fn);
                    }
                    return programWrapper;
                },

                data: function (data, depth) {
                    while (data && depth--) {
                        data = data._parent;
                    }
                    return data;
                },
                merge: function (param, common) {
                    var ret = param || common;

                    if (param && common && (param !== common)) {
                        ret = Utils.extend({}, common, param);
                    }

                    return ret;
                },

                noop: env.VM.noop,
                compilerInfo: templateSpec.compiler
            };

            var ret = function (context, options) {
                options = options || {};
                var data = options.data;

                ret._setup(options);
                if (!options.partial && templateSpec.useData) {
                    data = initData(context, data);
                }
                var depths;
                if (templateSpec.useDepths) {
                    depths = options.depths ? [context].concat(options.depths) : [context];
                }

                return templateSpec.main.call(container, context, container.helpers, container.partials, data, depths);
            };
            ret.isTop = true;

            ret._setup = function (options) {
                if (!options.partial) {
                    container.helpers = container.merge(options.helpers, env.helpers);

                    if (templateSpec.usePartial) {
                        container.partials = container.merge(options.partials, env.partials);
                    }
                } else {
                    container.helpers = options.helpers;
                    container.partials = options.partials;
                }
            };

            ret._child = function (i, data, depths) {
                if (templateSpec.useDepths && !depths) {
                    throw new Exception('must pass parent depths');
                }

                return program(container, i, templateSpec[i], data, depths);
            };
            return ret;
        }

        __exports__.template = template;

        function program(container, i, fn, data, depths) {
            var prog = function (context, options) {
                options = options || {};

                return fn.call(container, context, container.helpers, container.partials, options.data || data, depths && [context].concat(depths));
            };
            prog.program = i;
            prog.depth = depths ? depths.length : 0;
            return prog;
        }

        __exports__.program = program;

        function invokePartial(partial, name, context, helpers, partials, data, depths) {
            var options = {partial: true, helpers: helpers, partials: partials, data: data, depths: depths};

            if (partial === undefined) {
                throw new Exception("The partial " + name + " could not be found");
            } else if (partial instanceof Function) {
                return partial(context, options);
            }
        }

        __exports__.invokePartial = invokePartial;

        function noop() {
            return "";
        }

        __exports__.noop = noop;

        function initData(context, data) {
            if (!data || !('root' in data)) {
                data = data ? createFrame(data) : {};
                data.root = context;
            }
            return data;
        }

        return __exports__;
    })(__module3__, __module5__, __module2__);

// handlebars.runtime.js
    var __module1__ = (function (__dependency1__, __dependency2__, __dependency3__, __dependency4__, __dependency5__) {
        "use strict";
        var __exports__;
        /*globals Handlebars: true */
        var base = __dependency1__;

        // Each of these augment the Handlebars object. No need to setup here.
        // (This is done to easily share code between commonjs and browse envs)
        var SafeString = __dependency2__;
        var Exception = __dependency3__;
        var Utils = __dependency4__;
        var runtime = __dependency5__;

        // For compatibility and usage outside of module systems, make the Handlebars object a namespace
        var create = function () {
            var hb = new base.HandlebarsEnvironment();

            Utils.extend(hb, base);
            hb.SafeString = SafeString;
            hb.Exception = Exception;
            hb.Utils = Utils;
            hb.escapeExpression = Utils.escapeExpression;

            hb.VM = runtime;
            hb.template = function (spec) {
                return runtime.template(spec, hb);
            };

            return hb;
        };

        var Handlebars = create();
        Handlebars.create = create;

        Handlebars['default'] = Handlebars;

        __exports__ = Handlebars;
        return __exports__;
    })(__module2__, __module4__, __module5__, __module3__, __module6__);

// handlebars/compiler/ast.js
    var __module7__ = (function (__dependency1__) {
        "use strict";
        var __exports__;
        var Exception = __dependency1__;

        function LocationInfo(locInfo) {
            locInfo = locInfo || {};
            this.firstLine = locInfo.first_line;
            this.firstColumn = locInfo.first_column;
            this.lastColumn = locInfo.last_column;
            this.lastLine = locInfo.last_line;
        }

        var AST = {
            ProgramNode: function (statements, strip, locInfo) {
                LocationInfo.call(this, locInfo);
                this.type = "program";
                this.statements = statements;
                this.strip = strip;
            },

            MustacheNode: function (rawParams, hash, open, strip, locInfo) {
                LocationInfo.call(this, locInfo);
                this.type = "mustache";
                this.strip = strip;

                // Open may be a string parsed from the parser or a passed boolean flag
                if (open != null && open.charAt) {
                    // Must use charAt to support IE pre-10
                    var escapeFlag = open.charAt(3) || open.charAt(2);
                    this.escaped = escapeFlag !== '{' && escapeFlag !== '&';
                } else {
                    this.escaped = !!open;
                }

                if (rawParams instanceof AST.SexprNode) {
                    this.sexpr = rawParams;
                } else {
                    // Support old AST API
                    this.sexpr = new AST.SexprNode(rawParams, hash);
                }

                // Support old AST API that stored this info in MustacheNode
                this.id = this.sexpr.id;
                this.params = this.sexpr.params;
                this.hash = this.sexpr.hash;
                this.eligibleHelper = this.sexpr.eligibleHelper;
                this.isHelper = this.sexpr.isHelper;
            },

            SexprNode: function (rawParams, hash, locInfo) {
                LocationInfo.call(this, locInfo);

                this.type = "sexpr";
                this.hash = hash;

                var id = this.id = rawParams[0];
                var params = this.params = rawParams.slice(1);

                // a mustache is definitely a helper if:
                // * it is an eligible helper, and
                // * it has at least one parameter or hash segment
                this.isHelper = !!(params.length || hash);

                // a mustache is an eligible helper if:
                // * its id is simple (a single part, not `this` or `..`)
                this.eligibleHelper = this.isHelper || id.isSimple;

                // if a mustache is an eligible helper but not a definite
                // helper, it is ambiguous, and will be resolved in a later
                // pass or at runtime.
            },

            PartialNode: function (partialName, context, hash, strip, locInfo) {
                LocationInfo.call(this, locInfo);
                this.type = "partial";
                this.partialName = partialName;
                this.context = context;
                this.hash = hash;
                this.strip = strip;

                this.strip.inlineStandalone = true;
            },

            BlockNode: function (mustache, program, inverse, strip, locInfo) {
                LocationInfo.call(this, locInfo);

                this.type = 'block';
                this.mustache = mustache;
                this.program = program;
                this.inverse = inverse;
                this.strip = strip;

                if (inverse && !program) {
                    this.isInverse = true;
                }
            },

            RawBlockNode: function (mustache, content, close, locInfo) {
                LocationInfo.call(this, locInfo);

                if (mustache.sexpr.id.original !== close) {
                    throw new Exception(mustache.sexpr.id.original + " doesn't match " + close, this);
                }

                content = new AST.ContentNode(content, locInfo);

                this.type = 'block';
                this.mustache = mustache;
                this.program = new AST.ProgramNode([content], {}, locInfo);
            },

            ContentNode: function (string, locInfo) {
                LocationInfo.call(this, locInfo);
                this.type = "content";
                this.original = this.string = string;
            },

            HashNode: function (pairs, locInfo) {
                LocationInfo.call(this, locInfo);
                this.type = "hash";
                this.pairs = pairs;
            },

            IdNode: function (parts, locInfo) {
                LocationInfo.call(this, locInfo);
                this.type = "ID";

                var original = "",
                    dig = [],
                    depth = 0,
                    depthString = '';

                for (var i = 0, l = parts.length; i < l; i++) {
                    var part = parts[i].part;
                    original += (parts[i].separator || '') + part;

                    if (part === ".." || part === "." || part === "this") {
                        if (dig.length > 0) {
                            throw new Exception("Invalid path: " + original, this);
                        } else if (part === "..") {
                            depth++;
                            depthString += '../';
                        } else {
                            this.isScoped = true;
                        }
                    } else {
                        dig.push(part);
                    }
                }

                this.original = original;
                this.parts = dig;
                this.string = dig.join('.');
                this.depth = depth;
                this.idName = depthString + this.string;

                // an ID is simple if it only has one part, and that part is not
                // `..` or `this`.
                this.isSimple = parts.length === 1 && !this.isScoped && depth === 0;

                this.stringModeValue = this.string;
            },

            PartialNameNode: function (name, locInfo) {
                LocationInfo.call(this, locInfo);
                this.type = "PARTIAL_NAME";
                this.name = name.original;
            },

            DataNode: function (id, locInfo) {
                LocationInfo.call(this, locInfo);
                this.type = "DATA";
                this.id = id;
                this.stringModeValue = id.stringModeValue;
                this.idName = '@' + id.stringModeValue;
            },

            StringNode: function (string, locInfo) {
                LocationInfo.call(this, locInfo);
                this.type = "STRING";
                this.original =
                    this.string =
                        this.stringModeValue = string;
            },

            NumberNode: function (number, locInfo) {
                LocationInfo.call(this, locInfo);
                this.type = "NUMBER";
                this.original =
                    this.number = number;
                this.stringModeValue = Number(number);
            },

            BooleanNode: function (bool, locInfo) {
                LocationInfo.call(this, locInfo);
                this.type = "BOOLEAN";
                this.bool = bool;
                this.stringModeValue = bool === "true";
            },

            CommentNode: function (comment, locInfo) {
                LocationInfo.call(this, locInfo);
                this.type = "comment";
                this.comment = comment;

                this.strip = {
                    inlineStandalone: true
                };
            }
        };


        // Must be exported as an object rather than the root of the module as the jison lexer
        // most modify the object to operate properly.
        __exports__ = AST;
        return __exports__;
    })(__module5__);

// handlebars/compiler/parser.js
    var __module9__ = (function () {
        "use strict";
        var __exports__;
        /* jshint ignore:start */
        /* istanbul ignore next */
        /* Jison generated parser */
        var handlebars = (function () {
            var parser = {
                trace: function trace() {
                },
                yy: {},
                symbols_: {
                    "error": 2,
                    "root": 3,
                    "program": 4,
                    "EOF": 5,
                    "program_repetition0": 6,
                    "statement": 7,
                    "mustache": 8,
                    "block": 9,
                    "rawBlock": 10,
                    "partial": 11,
                    "CONTENT": 12,
                    "COMMENT": 13,
                    "openRawBlock": 14,
                    "END_RAW_BLOCK": 15,
                    "OPEN_RAW_BLOCK": 16,
                    "sexpr": 17,
                    "CLOSE_RAW_BLOCK": 18,
                    "openBlock": 19,
                    "block_option0": 20,
                    "closeBlock": 21,
                    "openInverse": 22,
                    "block_option1": 23,
                    "OPEN_BLOCK": 24,
                    "CLOSE": 25,
                    "OPEN_INVERSE": 26,
                    "inverseAndProgram": 27,
                    "INVERSE": 28,
                    "OPEN_ENDBLOCK": 29,
                    "path": 30,
                    "OPEN": 31,
                    "OPEN_UNESCAPED": 32,
                    "CLOSE_UNESCAPED": 33,
                    "OPEN_PARTIAL": 34,
                    "partialName": 35,
                    "param": 36,
                    "partial_option0": 37,
                    "partial_option1": 38,
                    "sexpr_repetition0": 39,
                    "sexpr_option0": 40,
                    "dataName": 41,
                    "STRING": 42,
                    "NUMBER": 43,
                    "BOOLEAN": 44,
                    "OPEN_SEXPR": 45,
                    "CLOSE_SEXPR": 46,
                    "hash": 47,
                    "hash_repetition_plus0": 48,
                    "hashSegment": 49,
                    "ID": 50,
                    "EQUALS": 51,
                    "DATA": 52,
                    "pathSegments": 53,
                    "SEP": 54,
                    "$accept": 0,
                    "$end": 1
                },
                terminals_: {
                    2: "error",
                    5: "EOF",
                    12: "CONTENT",
                    13: "COMMENT",
                    15: "END_RAW_BLOCK",
                    16: "OPEN_RAW_BLOCK",
                    18: "CLOSE_RAW_BLOCK",
                    24: "OPEN_BLOCK",
                    25: "CLOSE",
                    26: "OPEN_INVERSE",
                    28: "INVERSE",
                    29: "OPEN_ENDBLOCK",
                    31: "OPEN",
                    32: "OPEN_UNESCAPED",
                    33: "CLOSE_UNESCAPED",
                    34: "OPEN_PARTIAL",
                    42: "STRING",
                    43: "NUMBER",
                    44: "BOOLEAN",
                    45: "OPEN_SEXPR",
                    46: "CLOSE_SEXPR",
                    50: "ID",
                    51: "EQUALS",
                    52: "DATA",
                    54: "SEP"
                },
                productions_: [0, [3, 2], [4, 1], [7, 1], [7, 1], [7, 1], [7, 1], [7, 1], [7, 1], [10, 3], [14, 3], [9, 4], [9, 4], [19, 3], [22, 3], [27, 2], [21, 3], [8, 3], [8, 3], [11, 5], [11, 4], [17, 3], [17, 1], [36, 1], [36, 1], [36, 1], [36, 1], [36, 1], [36, 3], [47, 1], [49, 3], [35, 1], [35, 1], [35, 1], [41, 2], [30, 1], [53, 3], [53, 1], [6, 0], [6, 2], [20, 0], [20, 1], [23, 0], [23, 1], [37, 0], [37, 1], [38, 0], [38, 1], [39, 0], [39, 2], [40, 0], [40, 1], [48, 1], [48, 2]],
                performAction: function anonymous(yytext, yyleng, yylineno, yy, yystate, $$, _$) {

                    var $0 = $$.length - 1;
                    switch (yystate) {
                        case 1:
                            yy.prepareProgram($$[$0 - 1].statements, true);
                            return $$[$0 - 1];
                            break;
                        case 2:
                            this.$ = new yy.ProgramNode(yy.prepareProgram($$[$0]), {}, this._$);
                            break;
                        case 3:
                            this.$ = $$[$0];
                            break;
                        case 4:
                            this.$ = $$[$0];
                            break;
                        case 5:
                            this.$ = $$[$0];
                            break;
                        case 6:
                            this.$ = $$[$0];
                            break;
                        case 7:
                            this.$ = new yy.ContentNode($$[$0], this._$);
                            break;
                        case 8:
                            this.$ = new yy.CommentNode($$[$0], this._$);
                            break;
                        case 9:
                            this.$ = new yy.RawBlockNode($$[$0 - 2], $$[$0 - 1], $$[$0], this._$);
                            break;
                        case 10:
                            this.$ = new yy.MustacheNode($$[$0 - 1], null, '', '', this._$);
                            break;
                        case 11:
                            this.$ = yy.prepareBlock($$[$0 - 3], $$[$0 - 2], $$[$0 - 1], $$[$0], false, this._$);
                            break;
                        case 12:
                            this.$ = yy.prepareBlock($$[$0 - 3], $$[$0 - 2], $$[$0 - 1], $$[$0], true, this._$);
                            break;
                        case 13:
                            this.$ = new yy.MustacheNode($$[$0 - 1], null, $$[$0 - 2], yy.stripFlags($$[$0 - 2], $$[$0]), this._$);
                            break;
                        case 14:
                            this.$ = new yy.MustacheNode($$[$0 - 1], null, $$[$0 - 2], yy.stripFlags($$[$0 - 2], $$[$0]), this._$);
                            break;
                        case 15:
                            this.$ = {strip: yy.stripFlags($$[$0 - 1], $$[$0 - 1]), program: $$[$0]};
                            break;
                        case 16:
                            this.$ = {path: $$[$0 - 1], strip: yy.stripFlags($$[$0 - 2], $$[$0])};
                            break;
                        case 17:
                            this.$ = new yy.MustacheNode($$[$0 - 1], null, $$[$0 - 2], yy.stripFlags($$[$0 - 2], $$[$0]), this._$);
                            break;
                        case 18:
                            this.$ = new yy.MustacheNode($$[$0 - 1], null, $$[$0 - 2], yy.stripFlags($$[$0 - 2], $$[$0]), this._$);
                            break;
                        case 19:
                            this.$ = new yy.PartialNode($$[$0 - 3], $$[$0 - 2], $$[$0 - 1], yy.stripFlags($$[$0 - 4], $$[$0]), this._$);
                            break;
                        case 20:
                            this.$ = new yy.PartialNode($$[$0 - 2], undefined, $$[$0 - 1], yy.stripFlags($$[$0 - 3], $$[$0]), this._$);
                            break;
                        case 21:
                            this.$ = new yy.SexprNode([$$[$0 - 2]].concat($$[$0 - 1]), $$[$0], this._$);
                            break;
                        case 22:
                            this.$ = new yy.SexprNode([$$[$0]], null, this._$);
                            break;
                        case 23:
                            this.$ = $$[$0];
                            break;
                        case 24:
                            this.$ = new yy.StringNode($$[$0], this._$);
                            break;
                        case 25:
                            this.$ = new yy.NumberNode($$[$0], this._$);
                            break;
                        case 26:
                            this.$ = new yy.BooleanNode($$[$0], this._$);
                            break;
                        case 27:
                            this.$ = $$[$0];
                            break;
                        case 28:
                            $$[$0 - 1].isHelper = true;
                            this.$ = $$[$0 - 1];
                            break;
                        case 29:
                            this.$ = new yy.HashNode($$[$0], this._$);
                            break;
                        case 30:
                            this.$ = [$$[$0 - 2], $$[$0]];
                            break;
                        case 31:
                            this.$ = new yy.PartialNameNode($$[$0], this._$);
                            break;
                        case 32:
                            this.$ = new yy.PartialNameNode(new yy.StringNode($$[$0], this._$), this._$);
                            break;
                        case 33:
                            this.$ = new yy.PartialNameNode(new yy.NumberNode($$[$0], this._$));
                            break;
                        case 34:
                            this.$ = new yy.DataNode($$[$0], this._$);
                            break;
                        case 35:
                            this.$ = new yy.IdNode($$[$0], this._$);
                            break;
                        case 36:
                            $$[$0 - 2].push({part: $$[$0], separator: $$[$0 - 1]});
                            this.$ = $$[$0 - 2];
                            break;
                        case 37:
                            this.$ = [{part: $$[$0]}];
                            break;
                        case 38:
                            this.$ = [];
                            break;
                        case 39:
                            $$[$0 - 1].push($$[$0]);
                            break;
                        case 48:
                            this.$ = [];
                            break;
                        case 49:
                            $$[$0 - 1].push($$[$0]);
                            break;
                        case 52:
                            this.$ = [$$[$0]];
                            break;
                        case 53:
                            $$[$0 - 1].push($$[$0]);
                            break;
                    }
                },
                table: [{
                    3: 1,
                    4: 2,
                    5: [2, 38],
                    6: 3,
                    12: [2, 38],
                    13: [2, 38],
                    16: [2, 38],
                    24: [2, 38],
                    26: [2, 38],
                    31: [2, 38],
                    32: [2, 38],
                    34: [2, 38]
                }, {1: [3]}, {5: [1, 4]}, {
                    5: [2, 2],
                    7: 5,
                    8: 6,
                    9: 7,
                    10: 8,
                    11: 9,
                    12: [1, 10],
                    13: [1, 11],
                    14: 16,
                    16: [1, 20],
                    19: 14,
                    22: 15,
                    24: [1, 18],
                    26: [1, 19],
                    28: [2, 2],
                    29: [2, 2],
                    31: [1, 12],
                    32: [1, 13],
                    34: [1, 17]
                }, {1: [2, 1]}, {
                    5: [2, 39],
                    12: [2, 39],
                    13: [2, 39],
                    16: [2, 39],
                    24: [2, 39],
                    26: [2, 39],
                    28: [2, 39],
                    29: [2, 39],
                    31: [2, 39],
                    32: [2, 39],
                    34: [2, 39]
                }, {
                    5: [2, 3],
                    12: [2, 3],
                    13: [2, 3],
                    16: [2, 3],
                    24: [2, 3],
                    26: [2, 3],
                    28: [2, 3],
                    29: [2, 3],
                    31: [2, 3],
                    32: [2, 3],
                    34: [2, 3]
                }, {
                    5: [2, 4],
                    12: [2, 4],
                    13: [2, 4],
                    16: [2, 4],
                    24: [2, 4],
                    26: [2, 4],
                    28: [2, 4],
                    29: [2, 4],
                    31: [2, 4],
                    32: [2, 4],
                    34: [2, 4]
                }, {
                    5: [2, 5],
                    12: [2, 5],
                    13: [2, 5],
                    16: [2, 5],
                    24: [2, 5],
                    26: [2, 5],
                    28: [2, 5],
                    29: [2, 5],
                    31: [2, 5],
                    32: [2, 5],
                    34: [2, 5]
                }, {
                    5: [2, 6],
                    12: [2, 6],
                    13: [2, 6],
                    16: [2, 6],
                    24: [2, 6],
                    26: [2, 6],
                    28: [2, 6],
                    29: [2, 6],
                    31: [2, 6],
                    32: [2, 6],
                    34: [2, 6]
                }, {
                    5: [2, 7],
                    12: [2, 7],
                    13: [2, 7],
                    16: [2, 7],
                    24: [2, 7],
                    26: [2, 7],
                    28: [2, 7],
                    29: [2, 7],
                    31: [2, 7],
                    32: [2, 7],
                    34: [2, 7]
                }, {
                    5: [2, 8],
                    12: [2, 8],
                    13: [2, 8],
                    16: [2, 8],
                    24: [2, 8],
                    26: [2, 8],
                    28: [2, 8],
                    29: [2, 8],
                    31: [2, 8],
                    32: [2, 8],
                    34: [2, 8]
                }, {17: 21, 30: 22, 41: 23, 50: [1, 26], 52: [1, 25], 53: 24}, {
                    17: 27,
                    30: 22,
                    41: 23,
                    50: [1, 26],
                    52: [1, 25],
                    53: 24
                }, {
                    4: 28,
                    6: 3,
                    12: [2, 38],
                    13: [2, 38],
                    16: [2, 38],
                    24: [2, 38],
                    26: [2, 38],
                    28: [2, 38],
                    29: [2, 38],
                    31: [2, 38],
                    32: [2, 38],
                    34: [2, 38]
                }, {
                    4: 29,
                    6: 3,
                    12: [2, 38],
                    13: [2, 38],
                    16: [2, 38],
                    24: [2, 38],
                    26: [2, 38],
                    28: [2, 38],
                    29: [2, 38],
                    31: [2, 38],
                    32: [2, 38],
                    34: [2, 38]
                }, {12: [1, 30]}, {30: 32, 35: 31, 42: [1, 33], 43: [1, 34], 50: [1, 26], 53: 24}, {
                    17: 35,
                    30: 22,
                    41: 23,
                    50: [1, 26],
                    52: [1, 25],
                    53: 24
                }, {17: 36, 30: 22, 41: 23, 50: [1, 26], 52: [1, 25], 53: 24}, {
                    17: 37,
                    30: 22,
                    41: 23,
                    50: [1, 26],
                    52: [1, 25],
                    53: 24
                }, {25: [1, 38]}, {
                    18: [2, 48],
                    25: [2, 48],
                    33: [2, 48],
                    39: 39,
                    42: [2, 48],
                    43: [2, 48],
                    44: [2, 48],
                    45: [2, 48],
                    46: [2, 48],
                    50: [2, 48],
                    52: [2, 48]
                }, {18: [2, 22], 25: [2, 22], 33: [2, 22], 46: [2, 22]}, {
                    18: [2, 35],
                    25: [2, 35],
                    33: [2, 35],
                    42: [2, 35],
                    43: [2, 35],
                    44: [2, 35],
                    45: [2, 35],
                    46: [2, 35],
                    50: [2, 35],
                    52: [2, 35],
                    54: [1, 40]
                }, {30: 41, 50: [1, 26], 53: 24}, {
                    18: [2, 37],
                    25: [2, 37],
                    33: [2, 37],
                    42: [2, 37],
                    43: [2, 37],
                    44: [2, 37],
                    45: [2, 37],
                    46: [2, 37],
                    50: [2, 37],
                    52: [2, 37],
                    54: [2, 37]
                }, {33: [1, 42]}, {20: 43, 27: 44, 28: [1, 45], 29: [2, 40]}, {
                    23: 46,
                    27: 47,
                    28: [1, 45],
                    29: [2, 42]
                }, {15: [1, 48]}, {
                    25: [2, 46],
                    30: 51,
                    36: 49,
                    38: 50,
                    41: 55,
                    42: [1, 52],
                    43: [1, 53],
                    44: [1, 54],
                    45: [1, 56],
                    47: 57,
                    48: 58,
                    49: 60,
                    50: [1, 59],
                    52: [1, 25],
                    53: 24
                }, {
                    25: [2, 31],
                    42: [2, 31],
                    43: [2, 31],
                    44: [2, 31],
                    45: [2, 31],
                    50: [2, 31],
                    52: [2, 31]
                }, {
                    25: [2, 32],
                    42: [2, 32],
                    43: [2, 32],
                    44: [2, 32],
                    45: [2, 32],
                    50: [2, 32],
                    52: [2, 32]
                }, {
                    25: [2, 33],
                    42: [2, 33],
                    43: [2, 33],
                    44: [2, 33],
                    45: [2, 33],
                    50: [2, 33],
                    52: [2, 33]
                }, {25: [1, 61]}, {25: [1, 62]}, {18: [1, 63]}, {
                    5: [2, 17],
                    12: [2, 17],
                    13: [2, 17],
                    16: [2, 17],
                    24: [2, 17],
                    26: [2, 17],
                    28: [2, 17],
                    29: [2, 17],
                    31: [2, 17],
                    32: [2, 17],
                    34: [2, 17]
                }, {
                    18: [2, 50],
                    25: [2, 50],
                    30: 51,
                    33: [2, 50],
                    36: 65,
                    40: 64,
                    41: 55,
                    42: [1, 52],
                    43: [1, 53],
                    44: [1, 54],
                    45: [1, 56],
                    46: [2, 50],
                    47: 66,
                    48: 58,
                    49: 60,
                    50: [1, 59],
                    52: [1, 25],
                    53: 24
                }, {50: [1, 67]}, {
                    18: [2, 34],
                    25: [2, 34],
                    33: [2, 34],
                    42: [2, 34],
                    43: [2, 34],
                    44: [2, 34],
                    45: [2, 34],
                    46: [2, 34],
                    50: [2, 34],
                    52: [2, 34]
                }, {
                    5: [2, 18],
                    12: [2, 18],
                    13: [2, 18],
                    16: [2, 18],
                    24: [2, 18],
                    26: [2, 18],
                    28: [2, 18],
                    29: [2, 18],
                    31: [2, 18],
                    32: [2, 18],
                    34: [2, 18]
                }, {21: 68, 29: [1, 69]}, {29: [2, 41]}, {
                    4: 70,
                    6: 3,
                    12: [2, 38],
                    13: [2, 38],
                    16: [2, 38],
                    24: [2, 38],
                    26: [2, 38],
                    29: [2, 38],
                    31: [2, 38],
                    32: [2, 38],
                    34: [2, 38]
                }, {21: 71, 29: [1, 69]}, {29: [2, 43]}, {
                    5: [2, 9],
                    12: [2, 9],
                    13: [2, 9],
                    16: [2, 9],
                    24: [2, 9],
                    26: [2, 9],
                    28: [2, 9],
                    29: [2, 9],
                    31: [2, 9],
                    32: [2, 9],
                    34: [2, 9]
                }, {25: [2, 44], 37: 72, 47: 73, 48: 58, 49: 60, 50: [1, 74]}, {25: [1, 75]}, {
                    18: [2, 23],
                    25: [2, 23],
                    33: [2, 23],
                    42: [2, 23],
                    43: [2, 23],
                    44: [2, 23],
                    45: [2, 23],
                    46: [2, 23],
                    50: [2, 23],
                    52: [2, 23]
                }, {
                    18: [2, 24],
                    25: [2, 24],
                    33: [2, 24],
                    42: [2, 24],
                    43: [2, 24],
                    44: [2, 24],
                    45: [2, 24],
                    46: [2, 24],
                    50: [2, 24],
                    52: [2, 24]
                }, {
                    18: [2, 25],
                    25: [2, 25],
                    33: [2, 25],
                    42: [2, 25],
                    43: [2, 25],
                    44: [2, 25],
                    45: [2, 25],
                    46: [2, 25],
                    50: [2, 25],
                    52: [2, 25]
                }, {
                    18: [2, 26],
                    25: [2, 26],
                    33: [2, 26],
                    42: [2, 26],
                    43: [2, 26],
                    44: [2, 26],
                    45: [2, 26],
                    46: [2, 26],
                    50: [2, 26],
                    52: [2, 26]
                }, {
                    18: [2, 27],
                    25: [2, 27],
                    33: [2, 27],
                    42: [2, 27],
                    43: [2, 27],
                    44: [2, 27],
                    45: [2, 27],
                    46: [2, 27],
                    50: [2, 27],
                    52: [2, 27]
                }, {17: 76, 30: 22, 41: 23, 50: [1, 26], 52: [1, 25], 53: 24}, {25: [2, 47]}, {
                    18: [2, 29],
                    25: [2, 29],
                    33: [2, 29],
                    46: [2, 29],
                    49: 77,
                    50: [1, 74]
                }, {
                    18: [2, 37],
                    25: [2, 37],
                    33: [2, 37],
                    42: [2, 37],
                    43: [2, 37],
                    44: [2, 37],
                    45: [2, 37],
                    46: [2, 37],
                    50: [2, 37],
                    51: [1, 78],
                    52: [2, 37],
                    54: [2, 37]
                }, {18: [2, 52], 25: [2, 52], 33: [2, 52], 46: [2, 52], 50: [2, 52]}, {
                    12: [2, 13],
                    13: [2, 13],
                    16: [2, 13],
                    24: [2, 13],
                    26: [2, 13],
                    28: [2, 13],
                    29: [2, 13],
                    31: [2, 13],
                    32: [2, 13],
                    34: [2, 13]
                }, {
                    12: [2, 14],
                    13: [2, 14],
                    16: [2, 14],
                    24: [2, 14],
                    26: [2, 14],
                    28: [2, 14],
                    29: [2, 14],
                    31: [2, 14],
                    32: [2, 14],
                    34: [2, 14]
                }, {12: [2, 10]}, {18: [2, 21], 25: [2, 21], 33: [2, 21], 46: [2, 21]}, {
                    18: [2, 49],
                    25: [2, 49],
                    33: [2, 49],
                    42: [2, 49],
                    43: [2, 49],
                    44: [2, 49],
                    45: [2, 49],
                    46: [2, 49],
                    50: [2, 49],
                    52: [2, 49]
                }, {18: [2, 51], 25: [2, 51], 33: [2, 51], 46: [2, 51]}, {
                    18: [2, 36],
                    25: [2, 36],
                    33: [2, 36],
                    42: [2, 36],
                    43: [2, 36],
                    44: [2, 36],
                    45: [2, 36],
                    46: [2, 36],
                    50: [2, 36],
                    52: [2, 36],
                    54: [2, 36]
                }, {
                    5: [2, 11],
                    12: [2, 11],
                    13: [2, 11],
                    16: [2, 11],
                    24: [2, 11],
                    26: [2, 11],
                    28: [2, 11],
                    29: [2, 11],
                    31: [2, 11],
                    32: [2, 11],
                    34: [2, 11]
                }, {30: 79, 50: [1, 26], 53: 24}, {29: [2, 15]}, {
                    5: [2, 12],
                    12: [2, 12],
                    13: [2, 12],
                    16: [2, 12],
                    24: [2, 12],
                    26: [2, 12],
                    28: [2, 12],
                    29: [2, 12],
                    31: [2, 12],
                    32: [2, 12],
                    34: [2, 12]
                }, {25: [1, 80]}, {25: [2, 45]}, {51: [1, 78]}, {
                    5: [2, 20],
                    12: [2, 20],
                    13: [2, 20],
                    16: [2, 20],
                    24: [2, 20],
                    26: [2, 20],
                    28: [2, 20],
                    29: [2, 20],
                    31: [2, 20],
                    32: [2, 20],
                    34: [2, 20]
                }, {46: [1, 81]}, {18: [2, 53], 25: [2, 53], 33: [2, 53], 46: [2, 53], 50: [2, 53]}, {
                    30: 51,
                    36: 82,
                    41: 55,
                    42: [1, 52],
                    43: [1, 53],
                    44: [1, 54],
                    45: [1, 56],
                    50: [1, 26],
                    52: [1, 25],
                    53: 24
                }, {25: [1, 83]}, {
                    5: [2, 19],
                    12: [2, 19],
                    13: [2, 19],
                    16: [2, 19],
                    24: [2, 19],
                    26: [2, 19],
                    28: [2, 19],
                    29: [2, 19],
                    31: [2, 19],
                    32: [2, 19],
                    34: [2, 19]
                }, {
                    18: [2, 28],
                    25: [2, 28],
                    33: [2, 28],
                    42: [2, 28],
                    43: [2, 28],
                    44: [2, 28],
                    45: [2, 28],
                    46: [2, 28],
                    50: [2, 28],
                    52: [2, 28]
                }, {18: [2, 30], 25: [2, 30], 33: [2, 30], 46: [2, 30], 50: [2, 30]}, {
                    5: [2, 16],
                    12: [2, 16],
                    13: [2, 16],
                    16: [2, 16],
                    24: [2, 16],
                    26: [2, 16],
                    28: [2, 16],
                    29: [2, 16],
                    31: [2, 16],
                    32: [2, 16],
                    34: [2, 16]
                }],
                defaultActions: {
                    4: [2, 1],
                    44: [2, 41],
                    47: [2, 43],
                    57: [2, 47],
                    63: [2, 10],
                    70: [2, 15],
                    73: [2, 45]
                },
                parseError: function parseError(str, hash) {
                    throw new Error(str);
                },
                parse: function parse(input) {
                    var self = this, stack = [0], vstack = [null], lstack = [], table = this.table, yytext = "",
                        yylineno = 0, yyleng = 0, recovering = 0, TERROR = 2, EOF = 1;
                    this.lexer.setInput(input);
                    this.lexer.yy = this.yy;
                    this.yy.lexer = this.lexer;
                    this.yy.parser = this;
                    if (typeof this.lexer.yylloc == "undefined")
                        this.lexer.yylloc = {};
                    var yyloc = this.lexer.yylloc;
                    lstack.push(yyloc);
                    var ranges = this.lexer.options && this.lexer.options.ranges;
                    if (typeof this.yy.parseError === "function")
                        this.parseError = this.yy.parseError;

                    function popStack(n) {
                        stack.length = stack.length - 2 * n;
                        vstack.length = vstack.length - n;
                        lstack.length = lstack.length - n;
                    }

                    function lex() {
                        var token;
                        token = self.lexer.lex() || 1;
                        if (typeof token !== "number") {
                            token = self.symbols_[token] || token;
                        }
                        return token;
                    }

                    var symbol, preErrorSymbol, state, action, a, r, yyval = {}, p, len, newState, expected;
                    while (true) {
                        state = stack[stack.length - 1];
                        if (this.defaultActions[state]) {
                            action = this.defaultActions[state];
                        } else {
                            if (symbol === null || typeof symbol == "undefined") {
                                symbol = lex();
                            }
                            action = table[state] && table[state][symbol];
                        }
                        if (typeof action === "undefined" || !action.length || !action[0]) {
                            var errStr = "";
                            if (!recovering) {
                                expected = [];
                                for (p in table[state])
                                    if (this.terminals_[p] && p > 2) {
                                        expected.push("'" + this.terminals_[p] + "'");
                                    }
                                if (this.lexer.showPosition) {
                                    errStr = "Parse error on line " + (yylineno + 1) + ":\n" + this.lexer.showPosition() + "\nExpecting " + expected.join(", ") + ", got '" + (this.terminals_[symbol] || symbol) + "'";
                                } else {
                                    errStr = "Parse error on line " + (yylineno + 1) + ": Unexpected " + (symbol == 1 ? "end of input" : "'" + (this.terminals_[symbol] || symbol) + "'");
                                }
                                this.parseError(errStr, {
                                    text: this.lexer.match,
                                    token: this.terminals_[symbol] || symbol,
                                    line: this.lexer.yylineno,
                                    loc: yyloc,
                                    expected: expected
                                });
                            }
                        }
                        if (action[0] instanceof Array && action.length > 1) {
                            throw new Error("Parse Error: multiple actions possible at state: " + state + ", token: " + symbol);
                        }
                        switch (action[0]) {
                            case 1:
                                stack.push(symbol);
                                vstack.push(this.lexer.yytext);
                                lstack.push(this.lexer.yylloc);
                                stack.push(action[1]);
                                symbol = null;
                                if (!preErrorSymbol) {
                                    yyleng = this.lexer.yyleng;
                                    yytext = this.lexer.yytext;
                                    yylineno = this.lexer.yylineno;
                                    yyloc = this.lexer.yylloc;
                                    if (recovering > 0)
                                        recovering--;
                                } else {
                                    symbol = preErrorSymbol;
                                    preErrorSymbol = null;
                                }
                                break;
                            case 2:
                                len = this.productions_[action[1]][1];
                                yyval.$ = vstack[vstack.length - len];
                                yyval._$ = {
                                    first_line: lstack[lstack.length - (len || 1)].first_line,
                                    last_line: lstack[lstack.length - 1].last_line,
                                    first_column: lstack[lstack.length - (len || 1)].first_column,
                                    last_column: lstack[lstack.length - 1].last_column
                                };
                                if (ranges) {
                                    yyval._$.range = [lstack[lstack.length - (len || 1)].range[0], lstack[lstack.length - 1].range[1]];
                                }
                                r = this.performAction.call(yyval, yytext, yyleng, yylineno, this.yy, action[1], vstack, lstack);
                                if (typeof r !== "undefined") {
                                    return r;
                                }
                                if (len) {
                                    stack = stack.slice(0, -1 * len * 2);
                                    vstack = vstack.slice(0, -1 * len);
                                    lstack = lstack.slice(0, -1 * len);
                                }
                                stack.push(this.productions_[action[1]][0]);
                                vstack.push(yyval.$);
                                lstack.push(yyval._$);
                                newState = table[stack[stack.length - 2]][stack[stack.length - 1]];
                                stack.push(newState);
                                break;
                            case 3:
                                return true;
                        }
                    }
                    return true;
                }
            };
            /* Jison generated lexer */
            var lexer = (function () {
                var lexer = ({
                    EOF: 1,
                    parseError: function parseError(str, hash) {
                        if (this.yy.parser) {
                            this.yy.parser.parseError(str, hash);
                        } else {
                            throw new Error(str);
                        }
                    },
                    setInput: function (input) {
                        this._input = input;
                        this._more = this._less = this.done = false;
                        this.yylineno = this.yyleng = 0;
                        this.yytext = this.matched = this.match = '';
                        this.conditionStack = ['INITIAL'];
                        this.yylloc = {first_line: 1, first_column: 0, last_line: 1, last_column: 0};
                        if (this.options.ranges) this.yylloc.range = [0, 0];
                        this.offset = 0;
                        return this;
                    },
                    input: function () {
                        var ch = this._input[0];
                        this.yytext += ch;
                        this.yyleng++;
                        this.offset++;
                        this.match += ch;
                        this.matched += ch;
                        var lines = ch.match(/(?:\r\n?|\n).*/g);
                        if (lines) {
                            this.yylineno++;
                            this.yylloc.last_line++;
                        } else {
                            this.yylloc.last_column++;
                        }
                        if (this.options.ranges) this.yylloc.range[1]++;

                        this._input = this._input.slice(1);
                        return ch;
                    },
                    unput: function (ch) {
                        var len = ch.length;
                        var lines = ch.split(/(?:\r\n?|\n)/g);

                        this._input = ch + this._input;
                        this.yytext = this.yytext.substr(0, this.yytext.length - len - 1);
                        //this.yyleng -= len;
                        this.offset -= len;
                        var oldLines = this.match.split(/(?:\r\n?|\n)/g);
                        this.match = this.match.substr(0, this.match.length - 1);
                        this.matched = this.matched.substr(0, this.matched.length - 1);

                        if (lines.length - 1) this.yylineno -= lines.length - 1;
                        var r = this.yylloc.range;

                        this.yylloc = {
                            first_line: this.yylloc.first_line,
                            last_line: this.yylineno + 1,
                            first_column: this.yylloc.first_column,
                            last_column: lines ?
                                (lines.length === oldLines.length ? this.yylloc.first_column : 0) + oldLines[oldLines.length - lines.length].length - lines[0].length :
                                this.yylloc.first_column - len
                        };

                        if (this.options.ranges) {
                            this.yylloc.range = [r[0], r[0] + this.yyleng - len];
                        }
                        return this;
                    },
                    more: function () {
                        this._more = true;
                        return this;
                    },
                    less: function (n) {
                        this.unput(this.match.slice(n));
                    },
                    pastInput: function () {
                        var past = this.matched.substr(0, this.matched.length - this.match.length);
                        return (past.length > 20 ? '...' : '') + past.substr(-20).replace(/\n/g, "");
                    },
                    upcomingInput: function () {
                        var next = this.match;
                        if (next.length < 20) {
                            next += this._input.substr(0, 20 - next.length);
                        }
                        return (next.substr(0, 20) + (next.length > 20 ? '...' : '')).replace(/\n/g, "");
                    },
                    showPosition: function () {
                        var pre = this.pastInput();
                        var c = new Array(pre.length + 1).join("-");
                        return pre + this.upcomingInput() + "\n" + c + "^";
                    },
                    next: function () {
                        if (this.done) {
                            return this.EOF;
                        }
                        if (!this._input) this.done = true;

                        var token,
                            match,
                            tempMatch,
                            index,
                            col,
                            lines;
                        if (!this._more) {
                            this.yytext = '';
                            this.match = '';
                        }
                        var rules = this._currentRules();
                        for (var i = 0; i < rules.length; i++) {
                            tempMatch = this._input.match(this.rules[rules[i]]);
                            if (tempMatch && (!match || tempMatch[0].length > match[0].length)) {
                                match = tempMatch;
                                index = i;
                                if (!this.options.flex) break;
                            }
                        }
                        if (match) {
                            lines = match[0].match(/(?:\r\n?|\n).*/g);
                            if (lines) this.yylineno += lines.length;
                            this.yylloc = {
                                first_line: this.yylloc.last_line,
                                last_line: this.yylineno + 1,
                                first_column: this.yylloc.last_column,
                                last_column: lines ? lines[lines.length - 1].length - lines[lines.length - 1].match(/\r?\n?/)[0].length : this.yylloc.last_column + match[0].length
                            };
                            this.yytext += match[0];
                            this.match += match[0];
                            this.matches = match;
                            this.yyleng = this.yytext.length;
                            if (this.options.ranges) {
                                this.yylloc.range = [this.offset, this.offset += this.yyleng];
                            }
                            this._more = false;
                            this._input = this._input.slice(match[0].length);
                            this.matched += match[0];
                            token = this.performAction.call(this, this.yy, this, rules[index], this.conditionStack[this.conditionStack.length - 1]);
                            if (this.done && this._input) this.done = false;
                            if (token) return token;
                            else return;
                        }
                        if (this._input === "") {
                            return this.EOF;
                        } else {
                            return this.parseError('Lexical error on line ' + (this.yylineno + 1) + '. Unrecognized text.\n' + this.showPosition(),
                                {text: "", token: null, line: this.yylineno});
                        }
                    },
                    lex: function lex() {
                        var r = this.next();
                        if (typeof r !== 'undefined') {
                            return r;
                        } else {
                            return this.lex();
                        }
                    },
                    begin: function begin(condition) {
                        this.conditionStack.push(condition);
                    },
                    popState: function popState() {
                        return this.conditionStack.pop();
                    },
                    _currentRules: function _currentRules() {
                        return this.conditions[this.conditionStack[this.conditionStack.length - 1]].rules;
                    },
                    topState: function () {
                        return this.conditionStack[this.conditionStack.length - 2];
                    },
                    pushState: function begin(condition) {
                        this.begin(condition);
                    }
                });
                lexer.options = {};
                lexer.performAction = function anonymous(yy, yy_, $avoiding_name_collisions, YY_START) {


                    function strip(start, end) {
                        return yy_.yytext = yy_.yytext.substr(start, yy_.yyleng - end);
                    }


                    var YYSTATE = YY_START
                    switch ($avoiding_name_collisions) {
                        case 0:
                            if (yy_.yytext.slice(-2) === "\\\\") {
                                strip(0, 1);
                                this.begin("mu");
                            } else if (yy_.yytext.slice(-1) === "\\") {
                                strip(0, 1);
                                this.begin("emu");
                            } else {
                                this.begin("mu");
                            }
                            if (yy_.yytext) return 12;

                            break;
                        case 1:
                            return 12;
                            break;
                        case 2:
                            this.popState();
                            return 12;

                            break;
                        case 3:
                            yy_.yytext = yy_.yytext.substr(5, yy_.yyleng - 9);
                            this.popState();
                            return 15;

                            break;
                        case 4:
                            return 12;
                            break;
                        case 5:
                            strip(0, 4);
                            this.popState();
                            return 13;
                            break;
                        case 6:
                            return 45;
                            break;
                        case 7:
                            return 46;
                            break;
                        case 8:
                            return 16;
                            break;
                        case 9:
                            this.popState();
                            this.begin('raw');
                            return 18;

                            break;
                        case 10:
                            return 34;
                            break;
                        case 11:
                            return 24;
                            break;
                        case 12:
                            return 29;
                            break;
                        case 13:
                            this.popState();
                            return 28;
                            break;
                        case 14:
                            this.popState();
                            return 28;
                            break;
                        case 15:
                            return 26;
                            break;
                        case 16:
                            return 26;
                            break;
                        case 17:
                            return 32;
                            break;
                        case 18:
                            return 31;
                            break;
                        case 19:
                            this.popState();
                            this.begin('com');
                            break;
                        case 20:
                            strip(3, 5);
                            this.popState();
                            return 13;
                            break;
                        case 21:
                            return 31;
                            break;
                        case 22:
                            return 51;
                            break;
                        case 23:
                            return 50;
                            break;
                        case 24:
                            return 50;
                            break;
                        case 25:
                            return 54;
                            break;
                        case 26:// ignore whitespace
                            break;
                        case 27:
                            this.popState();
                            return 33;
                            break;
                        case 28:
                            this.popState();
                            return 25;
                            break;
                        case 29:
                            yy_.yytext = strip(1, 2).replace(/\\"/g, '"');
                            return 42;
                            break;
                        case 30:
                            yy_.yytext = strip(1, 2).replace(/\\'/g, "'");
                            return 42;
                            break;
                        case 31:
                            return 52;
                            break;
                        case 32:
                            return 44;
                            break;
                        case 33:
                            return 44;
                            break;
                        case 34:
                            return 43;
                            break;
                        case 35:
                            return 50;
                            break;
                        case 36:
                            yy_.yytext = strip(1, 2);
                            return 50;
                            break;
                        case 37:
                            return 'INVALID';
                            break;
                        case 38:
                            return 5;
                            break;
                    }
                };
                lexer.rules = [/^(?:[^\x00]*?(?=(\{\{)))/, /^(?:[^\x00]+)/, /^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/, /^(?:\{\{\{\{\/[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])\}\}\}\})/, /^(?:[^\x00]*?(?=(\{\{\{\{\/)))/, /^(?:[\s\S]*?--\}\})/, /^(?:\()/, /^(?:\))/, /^(?:\{\{\{\{)/, /^(?:\}\}\}\})/, /^(?:\{\{(~)?>)/, /^(?:\{\{(~)?#)/, /^(?:\{\{(~)?\/)/, /^(?:\{\{(~)?\^\s*(~)?\}\})/, /^(?:\{\{(~)?\s*else\s*(~)?\}\})/, /^(?:\{\{(~)?\^)/, /^(?:\{\{(~)?\s*else\b)/, /^(?:\{\{(~)?\{)/, /^(?:\{\{(~)?&)/, /^(?:\{\{!--)/, /^(?:\{\{![\s\S]*?\}\})/, /^(?:\{\{(~)?)/, /^(?:=)/, /^(?:\.\.)/, /^(?:\.(?=([=~}\s\/.)])))/, /^(?:[\/.])/, /^(?:\s+)/, /^(?:\}(~)?\}\})/, /^(?:(~)?\}\})/, /^(?:"(\\["]|[^"])*")/, /^(?:'(\\[']|[^'])*')/, /^(?:@)/, /^(?:true(?=([~}\s)])))/, /^(?:false(?=([~}\s)])))/, /^(?:-?[0-9]+(?:\.[0-9]+)?(?=([~}\s)])))/, /^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)]))))/, /^(?:\[[^\]]*\])/, /^(?:.)/, /^(?:$)/];
                lexer.conditions = {
                    "mu": {
                        "rules": [6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38],
                        "inclusive": false
                    },
                    "emu": {"rules": [2], "inclusive": false},
                    "com": {"rules": [5], "inclusive": false},
                    "raw": {"rules": [3, 4], "inclusive": false},
                    "INITIAL": {"rules": [0, 1, 38], "inclusive": true}
                };
                return lexer;
            })()
            parser.lexer = lexer;

            function Parser() {
                this.yy = {};
            }

            Parser.prototype = parser;
            parser.Parser = Parser;
            return new Parser;
        })();
        __exports__ = handlebars;
        /* jshint ignore:end */
        return __exports__;
    })();

// handlebars/compiler/helpers.js
    var __module10__ = (function (__dependency1__) {
        "use strict";
        var __exports__ = {};
        var Exception = __dependency1__;

        function stripFlags(open, close) {
            return {
                left: open.charAt(2) === '~',
                right: close.charAt(close.length - 3) === '~'
            };
        }

        __exports__.stripFlags = stripFlags;

        function prepareBlock(mustache, program, inverseAndProgram, close, inverted, locInfo) {
            /*jshint -W040 */
            if (mustache.sexpr.id.original !== close.path.original) {
                throw new Exception(mustache.sexpr.id.original + ' doesn\'t match ' + close.path.original, mustache);
            }

            var inverse = inverseAndProgram && inverseAndProgram.program;

            var strip = {
                left: mustache.strip.left,
                right: close.strip.right,

                // Determine the standalone candiacy. Basically flag our content as being possibly standalone
                // so our parent can determine if we actually are standalone
                openStandalone: isNextWhitespace(program.statements),
                closeStandalone: isPrevWhitespace((inverse || program).statements)
            };

            if (mustache.strip.right) {
                omitRight(program.statements, null, true);
            }

            if (inverse) {
                var inverseStrip = inverseAndProgram.strip;

                if (inverseStrip.left) {
                    omitLeft(program.statements, null, true);
                }
                if (inverseStrip.right) {
                    omitRight(inverse.statements, null, true);
                }
                if (close.strip.left) {
                    omitLeft(inverse.statements, null, true);
                }

                // Find standalone else statments
                if (isPrevWhitespace(program.statements)
                    && isNextWhitespace(inverse.statements)) {

                    omitLeft(program.statements);
                    omitRight(inverse.statements);
                }
            } else {
                if (close.strip.left) {
                    omitLeft(program.statements, null, true);
                }
            }

            if (inverted) {
                return new this.BlockNode(mustache, inverse, program, strip, locInfo);
            } else {
                return new this.BlockNode(mustache, program, inverse, strip, locInfo);
            }
        }

        __exports__.prepareBlock = prepareBlock;

        function prepareProgram(statements, isRoot) {
            for (var i = 0, l = statements.length; i < l; i++) {
                var current = statements[i],
                    strip = current.strip;

                if (!strip) {
                    continue;
                }

                var _isPrevWhitespace = isPrevWhitespace(statements, i, isRoot, current.type === 'partial'),
                    _isNextWhitespace = isNextWhitespace(statements, i, isRoot),

                    openStandalone = strip.openStandalone && _isPrevWhitespace,
                    closeStandalone = strip.closeStandalone && _isNextWhitespace,
                    inlineStandalone = strip.inlineStandalone && _isPrevWhitespace && _isNextWhitespace;

                if (strip.right) {
                    omitRight(statements, i, true);
                }
                if (strip.left) {
                    omitLeft(statements, i, true);
                }

                if (inlineStandalone) {
                    omitRight(statements, i);

                    if (omitLeft(statements, i)) {
                        // If we are on a standalone node, save the indent info for partials
                        if (current.type === 'partial') {
                            current.indent = (/([ \t]+$)/).exec(statements[i - 1].original) ? RegExp.$1 : '';
                        }
                    }
                }
                if (openStandalone) {
                    omitRight((current.program || current.inverse).statements);

                    // Strip out the previous content node if it's whitespace only
                    omitLeft(statements, i);
                }
                if (closeStandalone) {
                    // Always strip the next node
                    omitRight(statements, i);

                    omitLeft((current.inverse || current.program).statements);
                }
            }

            return statements;
        }

        __exports__.prepareProgram = prepareProgram;

        function isPrevWhitespace(statements, i, isRoot) {
            if (i === undefined) {
                i = statements.length;
            }

            // Nodes that end with newlines are considered whitespace (but are special
            // cased for strip operations)
            var prev = statements[i - 1],
                sibling = statements[i - 2];
            if (!prev) {
                return isRoot;
            }

            if (prev.type === 'content') {
                return (sibling || !isRoot ? (/\r?\n\s*?$/) : (/(^|\r?\n)\s*?$/)).test(prev.original);
            }
        }

        function isNextWhitespace(statements, i, isRoot) {
            if (i === undefined) {
                i = -1;
            }

            var next = statements[i + 1],
                sibling = statements[i + 2];
            if (!next) {
                return isRoot;
            }

            if (next.type === 'content') {
                return (sibling || !isRoot ? (/^\s*?\r?\n/) : (/^\s*?(\r?\n|$)/)).test(next.original);
            }
        }

        // Marks the node to the right of the position as omitted.
        // I.e. {{foo}}' ' will mark the ' ' node as omitted.
        //
        // If i is undefined, then the first child will be marked as such.
        //
        // If mulitple is truthy then all whitespace will be stripped out until non-whitespace
        // content is met.
        function omitRight(statements, i, multiple) {
            var current = statements[i == null ? 0 : i + 1];
            if (!current || current.type !== 'content' || (!multiple && current.rightStripped)) {
                return;
            }

            var original = current.string;
            current.string = current.string.replace(multiple ? (/^\s+/) : (/^[ \t]*\r?\n?/), '');
            current.rightStripped = current.string !== original;
        }

        // Marks the node to the left of the position as omitted.
        // I.e. ' '{{foo}} will mark the ' ' node as omitted.
        //
        // If i is undefined then the last child will be marked as such.
        //
        // If mulitple is truthy then all whitespace will be stripped out until non-whitespace
        // content is met.
        function omitLeft(statements, i, multiple) {
            var current = statements[i == null ? statements.length - 1 : i - 1];
            if (!current || current.type !== 'content' || (!multiple && current.leftStripped)) {
                return;
            }

            // We omit the last node if it's whitespace only and not preceeded by a non-content node.
            var original = current.string;
            current.string = current.string.replace(multiple ? (/\s+$/) : (/[ \t]+$/), '');
            current.leftStripped = current.string !== original;
            return current.leftStripped;
        }

        return __exports__;
    })(__module5__);

// handlebars/compiler/base.js
    var __module8__ = (function (__dependency1__, __dependency2__, __dependency3__, __dependency4__) {
        "use strict";
        var __exports__ = {};
        var parser = __dependency1__;
        var AST = __dependency2__;
        var Helpers = __dependency3__;
        var extend = __dependency4__.extend;

        __exports__.parser = parser;

        var yy = {};
        extend(yy, Helpers, AST);

        function parse(input) {
            // Just return if an already-compile AST was passed in.
            if (input.constructor === AST.ProgramNode) {
                return input;
            }

            parser.yy = yy;

            return parser.parse(input);
        }

        __exports__.parse = parse;
        return __exports__;
    })(__module9__, __module7__, __module10__, __module3__);

// handlebars/compiler/compiler.js
    var __module11__ = (function (__dependency1__, __dependency2__) {
        "use strict";
        var __exports__ = {};
        var Exception = __dependency1__;
        var isArray = __dependency2__.isArray;

        var slice = [].slice;

        function Compiler() {
        }

        __exports__.Compiler = Compiler;// the foundHelper register will disambiguate helper lookup from finding a
        // function in a context. This is necessary for mustache compatibility, which
        // requires that context functions in blocks are evaluated by blockHelperMissing,
        // and then proceed as if the resulting value was provided to blockHelperMissing.

        Compiler.prototype = {
            compiler: Compiler,

            equals: function (other) {
                var len = this.opcodes.length;
                if (other.opcodes.length !== len) {
                    return false;
                }

                for (var i = 0; i < len; i++) {
                    var opcode = this.opcodes[i],
                        otherOpcode = other.opcodes[i];
                    if (opcode.opcode !== otherOpcode.opcode || !argEquals(opcode.args, otherOpcode.args)) {
                        return false;
                    }
                }

                // We know that length is the same between the two arrays because they are directly tied
                // to the opcode behavior above.
                len = this.children.length;
                for (i = 0; i < len; i++) {
                    if (!this.children[i].equals(other.children[i])) {
                        return false;
                    }
                }

                return true;
            },

            guid: 0,

            compile: function (program, options) {
                this.opcodes = [];
                this.children = [];
                this.depths = {list: []};
                this.options = options;
                this.stringParams = options.stringParams;
                this.trackIds = options.trackIds;

                // These changes will propagate to the other compiler components
                var knownHelpers = this.options.knownHelpers;
                this.options.knownHelpers = {
                    'helperMissing': true,
                    'blockHelperMissing': true,
                    'each': true,
                    'if': true,
                    'unless': true,
                    'with': true,
                    'log': true,
                    'lookup': true
                };
                if (knownHelpers) {
                    for (var name in knownHelpers) {
                        this.options.knownHelpers[name] = knownHelpers[name];
                    }
                }

                return this.accept(program);
            },

            accept: function (node) {
                return this[node.type](node);
            },

            program: function (program) {
                var statements = program.statements;

                for (var i = 0, l = statements.length; i < l; i++) {
                    this.accept(statements[i]);
                }
                this.isSimple = l === 1;

                this.depths.list = this.depths.list.sort(function (a, b) {
                    return a - b;
                });

                return this;
            },

            compileProgram: function (program) {
                var result = new this.compiler().compile(program, this.options);
                var guid = this.guid++, depth;

                this.usePartial = this.usePartial || result.usePartial;

                this.children[guid] = result;

                for (var i = 0, l = result.depths.list.length; i < l; i++) {
                    depth = result.depths.list[i];

                    if (depth < 2) {
                        continue;
                    }
                    else {
                        this.addDepth(depth - 1);
                    }
                }

                return guid;
            },

            block: function (block) {
                var mustache = block.mustache,
                    program = block.program,
                    inverse = block.inverse;

                if (program) {
                    program = this.compileProgram(program);
                }

                if (inverse) {
                    inverse = this.compileProgram(inverse);
                }

                var sexpr = mustache.sexpr;
                var type = this.classifySexpr(sexpr);

                if (type === "helper") {
                    this.helperSexpr(sexpr, program, inverse);
                } else if (type === "simple") {
                    this.simpleSexpr(sexpr);

                    // now that the simple mustache is resolved, we need to
                    // evaluate it by executing `blockHelperMissing`
                    this.opcode('pushProgram', program);
                    this.opcode('pushProgram', inverse);
                    this.opcode('emptyHash');
                    this.opcode('blockValue', sexpr.id.original);
                } else {
                    this.ambiguousSexpr(sexpr, program, inverse);

                    // now that the simple mustache is resolved, we need to
                    // evaluate it by executing `blockHelperMissing`
                    this.opcode('pushProgram', program);
                    this.opcode('pushProgram', inverse);
                    this.opcode('emptyHash');
                    this.opcode('ambiguousBlockValue');
                }

                this.opcode('append');
            },

            hash: function (hash) {
                var pairs = hash.pairs, i, l;

                this.opcode('pushHash');

                for (i = 0, l = pairs.length; i < l; i++) {
                    this.pushParam(pairs[i][1]);
                }
                while (i--) {
                    this.opcode('assignToHash', pairs[i][0]);
                }
                this.opcode('popHash');
            },

            partial: function (partial) {
                var partialName = partial.partialName;
                this.usePartial = true;

                if (partial.hash) {
                    this.accept(partial.hash);
                } else {
                    this.opcode('push', 'undefined');
                }

                if (partial.context) {
                    this.accept(partial.context);
                } else {
                    this.opcode('getContext', 0);
                    this.opcode('pushContext');
                }

                this.opcode('invokePartial', partialName.name, partial.indent || '');
                this.opcode('append');
            },

            content: function (content) {
                if (content.string) {
                    this.opcode('appendContent', content.string);
                }
            },

            mustache: function (mustache) {
                this.sexpr(mustache.sexpr);

                if (mustache.escaped && !this.options.noEscape) {
                    this.opcode('appendEscaped');
                } else {
                    this.opcode('append');
                }
            },

            ambiguousSexpr: function (sexpr, program, inverse) {
                var id = sexpr.id,
                    name = id.parts[0],
                    isBlock = program != null || inverse != null;

                this.opcode('getContext', id.depth);

                this.opcode('pushProgram', program);
                this.opcode('pushProgram', inverse);

                this.ID(id);

                this.opcode('invokeAmbiguous', name, isBlock);
            },

            simpleSexpr: function (sexpr) {
                var id = sexpr.id;

                if (id.type === 'DATA') {
                    this.DATA(id);
                } else if (id.parts.length) {
                    this.ID(id);
                } else {
                    // Simplified ID for `this`
                    this.addDepth(id.depth);
                    this.opcode('getContext', id.depth);
                    this.opcode('pushContext');
                }

                this.opcode('resolvePossibleLambda');
            },

            helperSexpr: function (sexpr, program, inverse) {
                var params = this.setupFullMustacheParams(sexpr, program, inverse),
                    id = sexpr.id,
                    name = id.parts[0];

                if (this.options.knownHelpers[name]) {
                    this.opcode('invokeKnownHelper', params.length, name);
                } else if (this.options.knownHelpersOnly) {
                    throw new Exception("You specified knownHelpersOnly, but used the unknown helper " + name, sexpr);
                } else {
                    id.falsy = true;

                    this.ID(id);
                    this.opcode('invokeHelper', params.length, id.original, id.isSimple);
                }
            },

            sexpr: function (sexpr) {
                var type = this.classifySexpr(sexpr);

                if (type === "simple") {
                    this.simpleSexpr(sexpr);
                } else if (type === "helper") {
                    this.helperSexpr(sexpr);
                } else {
                    this.ambiguousSexpr(sexpr);
                }
            },

            ID: function (id) {
                this.addDepth(id.depth);
                this.opcode('getContext', id.depth);

                var name = id.parts[0];
                if (!name) {
                    // Context reference, i.e. `{{foo .}}` or `{{foo ..}}`
                    this.opcode('pushContext');
                } else {
                    this.opcode('lookupOnContext', id.parts, id.falsy, id.isScoped);
                }
            },

            DATA: function (data) {
                this.options.data = true;
                this.opcode('lookupData', data.id.depth, data.id.parts);
            },

            STRING: function (string) {
                this.opcode('pushString', string.string);
            },

            NUMBER: function (number) {
                this.opcode('pushLiteral', number.number);
            },

            BOOLEAN: function (bool) {
                this.opcode('pushLiteral', bool.bool);
            },

            comment: function () {
            },

            // HELPERS
            opcode: function (name) {
                this.opcodes.push({opcode: name, args: slice.call(arguments, 1)});
            },

            addDepth: function (depth) {
                if (depth === 0) {
                    return;
                }

                if (!this.depths[depth]) {
                    this.depths[depth] = true;
                    this.depths.list.push(depth);
                }
            },

            classifySexpr: function (sexpr) {
                var isHelper = sexpr.isHelper;
                var isEligible = sexpr.eligibleHelper;
                var options = this.options;

                // if ambiguous, we can possibly resolve the ambiguity now
                // An eligible helper is one that does not have a complex path, i.e. `this.foo`, `../foo` etc.
                if (isEligible && !isHelper) {
                    var name = sexpr.id.parts[0];

                    if (options.knownHelpers[name]) {
                        isHelper = true;
                    } else if (options.knownHelpersOnly) {
                        isEligible = false;
                    }
                }

                if (isHelper) {
                    return "helper";
                }
                else if (isEligible) {
                    return "ambiguous";
                }
                else {
                    return "simple";
                }
            },

            pushParams: function (params) {
                for (var i = 0, l = params.length; i < l; i++) {
                    this.pushParam(params[i]);
                }
            },

            pushParam: function (val) {
                if (this.stringParams) {
                    if (val.depth) {
                        this.addDepth(val.depth);
                    }
                    this.opcode('getContext', val.depth || 0);
                    this.opcode('pushStringParam', val.stringModeValue, val.type);

                    if (val.type === 'sexpr') {
                        // Subexpressions get evaluated and passed in
                        // in string params mode.
                        this.sexpr(val);
                    }
                } else {
                    if (this.trackIds) {
                        this.opcode('pushId', val.type, val.idName || val.stringModeValue);
                    }
                    this.accept(val);
                }
            },

            setupFullMustacheParams: function (sexpr, program, inverse) {
                var params = sexpr.params;
                this.pushParams(params);

                this.opcode('pushProgram', program);
                this.opcode('pushProgram', inverse);

                if (sexpr.hash) {
                    this.hash(sexpr.hash);
                } else {
                    this.opcode('emptyHash');
                }

                return params;
            }
        };

        function precompile(input, options, env) {
            if (input == null || (typeof input !== 'string' && input.constructor !== env.AST.ProgramNode)) {
                throw new Exception("You must pass a string or Handlebars AST to Handlebars.precompile. You passed " + input);
            }

            options = options || {};
            if (!('data' in options)) {
                options.data = true;
            }
            if (options.compat) {
                options.useDepths = true;
            }

            var ast = env.parse(input);
            var environment = new env.Compiler().compile(ast, options);
            return new env.JavaScriptCompiler().compile(environment, options);
        }

        __exports__.precompile = precompile;

        function compile(input, options, env) {
            if (input == null || (typeof input !== 'string' && input.constructor !== env.AST.ProgramNode)) {
                throw new Exception("You must pass a string or Handlebars AST to Handlebars.compile. You passed " + input);
            }

            options = options || {};

            if (!('data' in options)) {
                options.data = true;
            }
            if (options.compat) {
                options.useDepths = true;
            }

            var compiled;

            function compileInput() {
                var ast = env.parse(input);
                var environment = new env.Compiler().compile(ast, options);
                var templateSpec = new env.JavaScriptCompiler().compile(environment, options, undefined, true);
                return env.template(templateSpec);
            }

            // Template is only compiled on first use and cached after that point.
            var ret = function (context, options) {
                if (!compiled) {
                    compiled = compileInput();
                }
                return compiled.call(this, context, options);
            };
            ret._setup = function (options) {
                if (!compiled) {
                    compiled = compileInput();
                }
                return compiled._setup(options);
            };
            ret._child = function (i, data, depths) {
                if (!compiled) {
                    compiled = compileInput();
                }
                return compiled._child(i, data, depths);
            };
            return ret;
        }

        __exports__.compile = compile;

        function argEquals(a, b) {
            if (a === b) {
                return true;
            }

            if (isArray(a) && isArray(b) && a.length === b.length) {
                for (var i = 0; i < a.length; i++) {
                    if (!argEquals(a[i], b[i])) {
                        return false;
                    }
                }
                return true;
            }
        }

        return __exports__;
    })(__module5__, __module3__);

// handlebars/compiler/javascript-compiler.js
    var __module12__ = (function (__dependency1__, __dependency2__) {
        "use strict";
        var __exports__;
        var COMPILER_REVISION = __dependency1__.COMPILER_REVISION;
        var REVISION_CHANGES = __dependency1__.REVISION_CHANGES;
        var Exception = __dependency2__;

        function Literal(value) {
            this.value = value;
        }

        function JavaScriptCompiler() {
        }

        JavaScriptCompiler.prototype = {
            // PUBLIC API: You can override these methods in a subclass to provide
            // alternative compiled forms for name lookup and buffering semantics
            nameLookup: function (parent, name /* , type*/) {
                if (JavaScriptCompiler.isValidJavaScriptVariableName(name)) {
                    return parent + "." + name;
                } else {
                    return parent + "['" + name + "']";
                }
            },
            depthedLookup: function (name) {
                this.aliases.lookup = 'this.lookup';

                return 'lookup(depths, "' + name + '")';
            },

            compilerInfo: function () {
                var revision = COMPILER_REVISION,
                    versions = REVISION_CHANGES[revision];
                return [revision, versions];
            },

            appendToBuffer: function (string) {
                if (this.environment.isSimple) {
                    return "return " + string + ";";
                } else {
                    return {
                        appendToBuffer: true,
                        content: string,
                        toString: function () {
                            return "buffer += " + string + ";";
                        }
                    };
                }
            },

            initializeBuffer: function () {
                return this.quotedString("");
            },

            namespace: "Handlebars",
            // END PUBLIC API

            compile: function (environment, options, context, asObject) {
                this.environment = environment;
                this.options = options;
                this.stringParams = this.options.stringParams;
                this.trackIds = this.options.trackIds;
                this.precompile = !asObject;

                this.name = this.environment.name;
                this.isChild = !!context;
                this.context = context || {
                    programs: [],
                    environments: []
                };

                this.preamble();

                this.stackSlot = 0;
                this.stackVars = [];
                this.aliases = {};
                this.registers = {list: []};
                this.hashes = [];
                this.compileStack = [];
                this.inlineStack = [];

                this.compileChildren(environment, options);

                this.useDepths = this.useDepths || environment.depths.list.length || this.options.compat;

                var opcodes = environment.opcodes,
                    opcode,
                    i,
                    l;

                for (i = 0, l = opcodes.length; i < l; i++) {
                    opcode = opcodes[i];

                    this[opcode.opcode].apply(this, opcode.args);
                }

                // Flush any trailing content that might be pending.
                this.pushSource('');

                /* istanbul ignore next */
                if (this.stackSlot || this.inlineStack.length || this.compileStack.length) {
                    throw new Exception('Compile completed with content left on stack');
                }

                var fn = this.createFunctionContext(asObject);
                if (!this.isChild) {
                    var ret = {
                        compiler: this.compilerInfo(),
                        main: fn
                    };
                    var programs = this.context.programs;
                    for (i = 0, l = programs.length; i < l; i++) {
                        if (programs[i]) {
                            ret[i] = programs[i];
                        }
                    }

                    if (this.environment.usePartial) {
                        ret.usePartial = true;
                    }
                    if (this.options.data) {
                        ret.useData = true;
                    }
                    if (this.useDepths) {
                        ret.useDepths = true;
                    }
                    if (this.options.compat) {
                        ret.compat = true;
                    }

                    if (!asObject) {
                        ret.compiler = JSON.stringify(ret.compiler);
                        ret = this.objectLiteral(ret);
                    }

                    return ret;
                } else {
                    return fn;
                }
            },

            preamble: function () {
                // track the last context pushed into place to allow skipping the
                // getContext opcode when it would be a noop
                this.lastContext = 0;
                this.source = [];
            },

            createFunctionContext: function (asObject) {
                var varDeclarations = '';

                var locals = this.stackVars.concat(this.registers.list);
                if (locals.length > 0) {
                    varDeclarations += ", " + locals.join(", ");
                }

                // Generate minimizer alias mappings
                for (var alias in this.aliases) {
                    if (this.aliases.hasOwnProperty(alias)) {
                        varDeclarations += ', ' + alias + '=' + this.aliases[alias];
                    }
                }

                var params = ["depth0", "helpers", "partials", "data"];

                if (this.useDepths) {
                    params.push('depths');
                }

                // Perform a second pass over the output to merge content when possible
                var source = this.mergeSource(varDeclarations);

                if (asObject) {
                    params.push(source);

                    return Function.apply(this, params);
                } else {
                    return 'function(' + params.join(',') + ') {\n  ' + source + '}';
                }
            },
            mergeSource: function (varDeclarations) {
                var source = '',
                    buffer,
                    appendOnly = !this.forceBuffer,
                    appendFirst;

                for (var i = 0, len = this.source.length; i < len; i++) {
                    var line = this.source[i];
                    if (line.appendToBuffer) {
                        if (buffer) {
                            buffer = buffer + '\n    + ' + line.content;
                        } else {
                            buffer = line.content;
                        }
                    } else {
                        if (buffer) {
                            if (!source) {
                                appendFirst = true;
                                source = buffer + ';\n  ';
                            } else {
                                source += 'buffer += ' + buffer + ';\n  ';
                            }
                            buffer = undefined;
                        }
                        source += line + '\n  ';

                        if (!this.environment.isSimple) {
                            appendOnly = false;
                        }
                    }
                }

                if (appendOnly) {
                    if (buffer || !source) {
                        source += 'return ' + (buffer || '""') + ';\n';
                    }
                } else {
                    varDeclarations += ", buffer = " + (appendFirst ? '' : this.initializeBuffer());
                    if (buffer) {
                        source += 'return buffer + ' + buffer + ';\n';
                    } else {
                        source += 'return buffer;\n';
                    }
                }

                if (varDeclarations) {
                    source = 'var ' + varDeclarations.substring(2) + (appendFirst ? '' : ';\n  ') + source;
                }

                return source;
            },

            // [blockValue]
            //
            // On stack, before: hash, inverse, program, value
            // On stack, after: return value of blockHelperMissing
            //
            // The purpose of this opcode is to take a block of the form
            // `{{#this.foo}}...{{/this.foo}}`, resolve the value of `foo`, and
            // replace it on the stack with the result of properly
            // invoking blockHelperMissing.
            blockValue: function (name) {
                this.aliases.blockHelperMissing = 'helpers.blockHelperMissing';

                var params = [this.contextName(0)];
                this.setupParams(name, 0, params);

                var blockName = this.popStack();
                params.splice(1, 0, blockName);

                this.push('blockHelperMissing.call(' + params.join(', ') + ')');
            },

            // [ambiguousBlockValue]
            //
            // On stack, before: hash, inverse, program, value
            // Compiler value, before: lastHelper=value of last found helper, if any
            // On stack, after, if no lastHelper: same as [blockValue]
            // On stack, after, if lastHelper: value
            ambiguousBlockValue: function () {
                this.aliases.blockHelperMissing = 'helpers.blockHelperMissing';

                // We're being a bit cheeky and reusing the options value from the prior exec
                var params = [this.contextName(0)];
                this.setupParams('', 0, params, true);

                this.flushInline();

                var current = this.topStack();
                params.splice(1, 0, current);

                this.pushSource("if (!" + this.lastHelper + ") { " + current + " = blockHelperMissing.call(" + params.join(", ") + "); }");
            },

            // [appendContent]
            //
            // On stack, before: ...
            // On stack, after: ...
            //
            // Appends the string value of `content` to the current buffer
            appendContent: function (content) {
                if (this.pendingContent) {
                    content = this.pendingContent + content;
                }

                this.pendingContent = content;
            },

            // [append]
            //
            // On stack, before: value, ...
            // On stack, after: ...
            //
            // Coerces `value` to a String and appends it to the current buffer.
            //
            // If `value` is truthy, or 0, it is coerced into a string and appended
            // Otherwise, the empty string is appended
            append: function () {
                // Force anything that is inlined onto the stack so we don't have duplication
                // when we examine local
                this.flushInline();
                var local = this.popStack();
                this.pushSource('if (' + local + ' != null) { ' + this.appendToBuffer(local) + ' }');
                if (this.environment.isSimple) {
                    this.pushSource("else { " + this.appendToBuffer("''") + " }");
                }
            },

            // [appendEscaped]
            //
            // On stack, before: value, ...
            // On stack, after: ...
            //
            // Escape `value` and append it to the buffer
            appendEscaped: function () {
                this.aliases.escapeExpression = 'this.escapeExpression';

                this.pushSource(this.appendToBuffer("escapeExpression(" + this.popStack() + ")"));
            },

            // [getContext]
            //
            // On stack, before: ...
            // On stack, after: ...
            // Compiler value, after: lastContext=depth
            //
            // Set the value of the `lastContext` compiler value to the depth
            getContext: function (depth) {
                this.lastContext = depth;
            },

            // [pushContext]
            //
            // On stack, before: ...
            // On stack, after: currentContext, ...
            //
            // Pushes the value of the current context onto the stack.
            pushContext: function () {
                this.pushStackLiteral(this.contextName(this.lastContext));
            },

            // [lookupOnContext]
            //
            // On stack, before: ...
            // On stack, after: currentContext[name], ...
            //
            // Looks up the value of `name` on the current context and pushes
            // it onto the stack.
            lookupOnContext: function (parts, falsy, scoped) {
                /*jshint -W083 */
                var i = 0,
                    len = parts.length;

                if (!scoped && this.options.compat && !this.lastContext) {
                    // The depthed query is expected to handle the undefined logic for the root level that
                    // is implemented below, so we evaluate that directly in compat mode
                    this.push(this.depthedLookup(parts[i++]));
                } else {
                    this.pushContext();
                }

                for (; i < len; i++) {
                    this.replaceStack(function (current) {
                        var lookup = this.nameLookup(current, parts[i], 'context');
                        // We want to ensure that zero and false are handled properly if the context (falsy flag)
                        // needs to have the special handling for these values.
                        if (!falsy) {
                            return ' != null ? ' + lookup + ' : ' + current;
                        } else {
                            // Otherwise we can use generic falsy handling
                            return ' && ' + lookup;
                        }
                    });
                }
            },

            // [lookupData]
            //
            // On stack, before: ...
            // On stack, after: data, ...
            //
            // Push the data lookup operator
            lookupData: function (depth, parts) {
                /*jshint -W083 */
                if (!depth) {
                    this.pushStackLiteral('data');
                } else {
                    this.pushStackLiteral('this.data(data, ' + depth + ')');
                }

                var len = parts.length;
                for (var i = 0; i < len; i++) {
                    this.replaceStack(function (current) {
                        return ' && ' + this.nameLookup(current, parts[i], 'data');
                    });
                }
            },

            // [resolvePossibleLambda]
            //
            // On stack, before: value, ...
            // On stack, after: resolved value, ...
            //
            // If the `value` is a lambda, replace it on the stack by
            // the return value of the lambda
            resolvePossibleLambda: function () {
                this.aliases.lambda = 'this.lambda';

                this.push('lambda(' + this.popStack() + ', ' + this.contextName(0) + ')');
            },

            // [pushStringParam]
            //
            // On stack, before: ...
            // On stack, after: string, currentContext, ...
            //
            // This opcode is designed for use in string mode, which
            // provides the string value of a parameter along with its
            // depth rather than resolving it immediately.
            pushStringParam: function (string, type) {
                this.pushContext();
                this.pushString(type);

                // If it's a subexpression, the string result
                // will be pushed after this opcode.
                if (type !== 'sexpr') {
                    if (typeof string === 'string') {
                        this.pushString(string);
                    } else {
                        this.pushStackLiteral(string);
                    }
                }
            },

            emptyHash: function () {
                this.pushStackLiteral('{}');

                if (this.trackIds) {
                    this.push('{}'); // hashIds
                }
                if (this.stringParams) {
                    this.push('{}'); // hashContexts
                    this.push('{}'); // hashTypes
                }
            },
            pushHash: function () {
                if (this.hash) {
                    this.hashes.push(this.hash);
                }
                this.hash = {values: [], types: [], contexts: [], ids: []};
            },
            popHash: function () {
                var hash = this.hash;
                this.hash = this.hashes.pop();

                if (this.trackIds) {
                    this.push('{' + hash.ids.join(',') + '}');
                }
                if (this.stringParams) {
                    this.push('{' + hash.contexts.join(',') + '}');
                    this.push('{' + hash.types.join(',') + '}');
                }

                this.push('{\n    ' + hash.values.join(',\n    ') + '\n  }');
            },

            // [pushString]
            //
            // On stack, before: ...
            // On stack, after: quotedString(string), ...
            //
            // Push a quoted version of `string` onto the stack
            pushString: function (string) {
                this.pushStackLiteral(this.quotedString(string));
            },

            // [push]
            //
            // On stack, before: ...
            // On stack, after: expr, ...
            //
            // Push an expression onto the stack
            push: function (expr) {
                this.inlineStack.push(expr);
                return expr;
            },

            // [pushLiteral]
            //
            // On stack, before: ...
            // On stack, after: value, ...
            //
            // Pushes a value onto the stack. This operation prevents
            // the compiler from creating a temporary variable to hold
            // it.
            pushLiteral: function (value) {
                this.pushStackLiteral(value);
            },

            // [pushProgram]
            //
            // On stack, before: ...
            // On stack, after: program(guid), ...
            //
            // Push a program expression onto the stack. This takes
            // a compile-time guid and converts it into a runtime-accessible
            // expression.
            pushProgram: function (guid) {
                if (guid != null) {
                    this.pushStackLiteral(this.programExpression(guid));
                } else {
                    this.pushStackLiteral(null);
                }
            },

            // [invokeHelper]
            //
            // On stack, before: hash, inverse, program, params..., ...
            // On stack, after: result of helper invocation
            //
            // Pops off the helper's parameters, invokes the helper,
            // and pushes the helper's return value onto the stack.
            //
            // If the helper is not found, `helperMissing` is called.
            invokeHelper: function (paramSize, name, isSimple) {
                this.aliases.helperMissing = 'helpers.helperMissing';

                var nonHelper = this.popStack();
                var helper = this.setupHelper(paramSize, name);

                var lookup = (isSimple ? helper.name + ' || ' : '') + nonHelper + ' || helperMissing';
                this.push('((' + lookup + ').call(' + helper.callParams + '))');
            },

            // [invokeKnownHelper]
            //
            // On stack, before: hash, inverse, program, params..., ...
            // On stack, after: result of helper invocation
            //
            // This operation is used when the helper is known to exist,
            // so a `helperMissing` fallback is not required.
            invokeKnownHelper: function (paramSize, name) {
                var helper = this.setupHelper(paramSize, name);
                this.push(helper.name + ".call(" + helper.callParams + ")");
            },

            // [invokeAmbiguous]
            //
            // On stack, before: hash, inverse, program, params..., ...
            // On stack, after: result of disambiguation
            //
            // This operation is used when an expression like `{{foo}}`
            // is provided, but we don't know at compile-time whether it
            // is a helper or a path.
            //
            // This operation emits more code than the other options,
            // and can be avoided by passing the `knownHelpers` and
            // `knownHelpersOnly` flags at compile-time.
            invokeAmbiguous: function (name, helperCall) {
                this.aliases.functionType = '"function"';
                this.aliases.helperMissing = 'helpers.helperMissing';
                this.useRegister('helper');

                var nonHelper = this.popStack();

                this.emptyHash();
                var helper = this.setupHelper(0, name, helperCall);

                var helperName = this.lastHelper = this.nameLookup('helpers', name, 'helper');

                this.push(
                    '((helper = (helper = ' + helperName + ' || ' + nonHelper + ') != null ? helper : helperMissing'
                    + (helper.paramsInit ? '),(' + helper.paramsInit : '') + '),'
                    + '(typeof helper === functionType ? helper.call(' + helper.callParams + ') : helper))');
            },

            // [invokePartial]
            //
            // On stack, before: context, ...
            // On stack after: result of partial invocation
            //
            // This operation pops off a context, invokes a partial with that context,
            // and pushes the result of the invocation back.
            invokePartial: function (name, indent) {
                var params = [this.nameLookup('partials', name, 'partial'), "'" + indent + "'", "'" + name + "'", this.popStack(), this.popStack(), "helpers", "partials"];

                if (this.options.data) {
                    params.push("data");
                } else if (this.options.compat) {
                    params.push('undefined');
                }
                if (this.options.compat) {
                    params.push('depths');
                }

                this.push("this.invokePartial(" + params.join(", ") + ")");
            },

            // [assignToHash]
            //
            // On stack, before: value, ..., hash, ...
            // On stack, after: ..., hash, ...
            //
            // Pops a value off the stack and assigns it to the current hash
            assignToHash: function (key) {
                var value = this.popStack(),
                    context,
                    type,
                    id;

                if (this.trackIds) {
                    id = this.popStack();
                }
                if (this.stringParams) {
                    type = this.popStack();
                    context = this.popStack();
                }

                var hash = this.hash;
                if (context) {
                    hash.contexts.push("'" + key + "': " + context);
                }
                if (type) {
                    hash.types.push("'" + key + "': " + type);
                }
                if (id) {
                    hash.ids.push("'" + key + "': " + id);
                }
                hash.values.push("'" + key + "': (" + value + ")");
            },

            pushId: function (type, name) {
                if (type === 'ID' || type === 'DATA') {
                    this.pushString(name);
                } else if (type === 'sexpr') {
                    this.pushStackLiteral('true');
                } else {
                    this.pushStackLiteral('null');
                }
            },

            // HELPERS

            compiler: JavaScriptCompiler,

            compileChildren: function (environment, options) {
                var children = environment.children, child, compiler;

                for (var i = 0, l = children.length; i < l; i++) {
                    child = children[i];
                    compiler = new this.compiler();

                    var index = this.matchExistingProgram(child);

                    if (index == null) {
                        this.context.programs.push('');     // Placeholder to prevent name conflicts for nested children
                        index = this.context.programs.length;
                        child.index = index;
                        child.name = 'program' + index;
                        this.context.programs[index] = compiler.compile(child, options, this.context, !this.precompile);
                        this.context.environments[index] = child;

                        this.useDepths = this.useDepths || compiler.useDepths;
                    } else {
                        child.index = index;
                        child.name = 'program' + index;
                    }
                }
            },
            matchExistingProgram: function (child) {
                for (var i = 0, len = this.context.environments.length; i < len; i++) {
                    var environment = this.context.environments[i];
                    if (environment && environment.equals(child)) {
                        return i;
                    }
                }
            },

            programExpression: function (guid) {
                var child = this.environment.children[guid],
                    depths = child.depths.list,
                    useDepths = this.useDepths,
                    depth;

                var programParams = [child.index, 'data'];

                if (useDepths) {
                    programParams.push('depths');
                }

                return 'this.program(' + programParams.join(', ') + ')';
            },

            useRegister: function (name) {
                if (!this.registers[name]) {
                    this.registers[name] = true;
                    this.registers.list.push(name);
                }
            },

            pushStackLiteral: function (item) {
                return this.push(new Literal(item));
            },

            pushSource: function (source) {
                if (this.pendingContent) {
                    this.source.push(this.appendToBuffer(this.quotedString(this.pendingContent)));
                    this.pendingContent = undefined;
                }

                if (source) {
                    this.source.push(source);
                }
            },

            pushStack: function (item) {
                this.flushInline();

                var stack = this.incrStack();
                this.pushSource(stack + " = " + item + ";");
                this.compileStack.push(stack);
                return stack;
            },

            replaceStack: function (callback) {
                var prefix = '',
                    inline = this.isInline(),
                    stack,
                    createdStack,
                    usedLiteral;

                /* istanbul ignore next */
                if (!this.isInline()) {
                    throw new Exception('replaceStack on non-inline');
                }

                // We want to merge the inline statement into the replacement statement via ','
                var top = this.popStack(true);

                if (top instanceof Literal) {
                    // Literals do not need to be inlined
                    prefix = stack = top.value;
                    usedLiteral = true;
                } else {
                    // Get or create the current stack name for use by the inline
                    createdStack = !this.stackSlot;
                    var name = !createdStack ? this.topStackName() : this.incrStack();

                    prefix = '(' + this.push(name) + ' = ' + top + ')';
                    stack = this.topStack();
                }

                var item = callback.call(this, stack);

                if (!usedLiteral) {
                    this.popStack();
                }
                if (createdStack) {
                    this.stackSlot--;
                }
                this.push('(' + prefix + item + ')');
            },

            incrStack: function () {
                this.stackSlot++;
                if (this.stackSlot > this.stackVars.length) {
                    this.stackVars.push("stack" + this.stackSlot);
                }
                return this.topStackName();
            },
            topStackName: function () {
                return "stack" + this.stackSlot;
            },
            flushInline: function () {
                var inlineStack = this.inlineStack;
                if (inlineStack.length) {
                    this.inlineStack = [];
                    for (var i = 0, len = inlineStack.length; i < len; i++) {
                        var entry = inlineStack[i];
                        if (entry instanceof Literal) {
                            this.compileStack.push(entry);
                        } else {
                            this.pushStack(entry);
                        }
                    }
                }
            },
            isInline: function () {
                return this.inlineStack.length;
            },

            popStack: function (wrapped) {
                var inline = this.isInline(),
                    item = (inline ? this.inlineStack : this.compileStack).pop();

                if (!wrapped && (item instanceof Literal)) {
                    return item.value;
                } else {
                    if (!inline) {
                        /* istanbul ignore next */
                        if (!this.stackSlot) {
                            throw new Exception('Invalid stack pop');
                        }
                        this.stackSlot--;
                    }
                    return item;
                }
            },

            topStack: function () {
                var stack = (this.isInline() ? this.inlineStack : this.compileStack),
                    item = stack[stack.length - 1];

                if (item instanceof Literal) {
                    return item.value;
                } else {
                    return item;
                }
            },

            contextName: function (context) {
                if (this.useDepths && context) {
                    return 'depths[' + context + ']';
                } else {
                    return 'depth' + context;
                }
            },

            quotedString: function (str) {
                return '"' + str
                    .replace(/\\/g, '\\\\')
                    .replace(/"/g, '\\"')
                    .replace(/\n/g, '\\n')
                    .replace(/\r/g, '\\r')
                    .replace(/\u2028/g, '\\u2028')   // Per Ecma-262 7.3 + 7.8.4
                    .replace(/\u2029/g, '\\u2029') + '"';
            },

            objectLiteral: function (obj) {
                var pairs = [];

                for (var key in obj) {
                    if (obj.hasOwnProperty(key)) {
                        pairs.push(this.quotedString(key) + ':' + obj[key]);
                    }
                }

                return '{' + pairs.join(',') + '}';
            },

            setupHelper: function (paramSize, name, blockHelper) {
                var params = [],
                    paramsInit = this.setupParams(name, paramSize, params, blockHelper);
                var foundHelper = this.nameLookup('helpers', name, 'helper');

                return {
                    params: params,
                    paramsInit: paramsInit,
                    name: foundHelper,
                    callParams: [this.contextName(0)].concat(params).join(", ")
                };
            },

            setupOptions: function (helper, paramSize, params) {
                var options = {}, contexts = [], types = [], ids = [], param, inverse, program;

                options.name = this.quotedString(helper);
                options.hash = this.popStack();

                if (this.trackIds) {
                    options.hashIds = this.popStack();
                }
                if (this.stringParams) {
                    options.hashTypes = this.popStack();
                    options.hashContexts = this.popStack();
                }

                inverse = this.popStack();
                program = this.popStack();

                // Avoid setting fn and inverse if neither are set. This allows
                // helpers to do a check for `if (options.fn)`
                if (program || inverse) {
                    if (!program) {
                        program = 'this.noop';
                    }

                    if (!inverse) {
                        inverse = 'this.noop';
                    }

                    options.fn = program;
                    options.inverse = inverse;
                }

                // The parameters go on to the stack in order (making sure that they are evaluated in order)
                // so we need to pop them off the stack in reverse order
                var i = paramSize;
                while (i--) {
                    param = this.popStack();
                    params[i] = param;

                    if (this.trackIds) {
                        ids[i] = this.popStack();
                    }
                    if (this.stringParams) {
                        types[i] = this.popStack();
                        contexts[i] = this.popStack();
                    }
                }

                if (this.trackIds) {
                    options.ids = "[" + ids.join(",") + "]";
                }
                if (this.stringParams) {
                    options.types = "[" + types.join(",") + "]";
                    options.contexts = "[" + contexts.join(",") + "]";
                }

                if (this.options.data) {
                    options.data = "data";
                }

                return options;
            },

            // the params and contexts arguments are passed in arrays
            // to fill in
            setupParams: function (helperName, paramSize, params, useRegister) {
                var options = this.objectLiteral(this.setupOptions(helperName, paramSize, params));

                if (useRegister) {
                    this.useRegister('options');
                    params.push('options');
                    return 'options=' + options;
                } else {
                    params.push(options);
                    return '';
                }
            }
        };

        var reservedWords = (
            "break else new var" +
            " case finally return void" +
            " catch for switch while" +
            " continue function this with" +
            " default if throw" +
            " delete in try" +
            " do instanceof typeof" +
            " abstract enum int short" +
            " boolean export interface static" +
            " byte extends long super" +
            " char final native synchronized" +
            " class float package throws" +
            " const goto private transient" +
            " debugger implements protected volatile" +
            " double import public let yield"
        ).split(" ");

        var compilerWords = JavaScriptCompiler.RESERVED_WORDS = {};

        for (var i = 0, l = reservedWords.length; i < l; i++) {
            compilerWords[reservedWords[i]] = true;
        }

        JavaScriptCompiler.isValidJavaScriptVariableName = function (name) {
            return !JavaScriptCompiler.RESERVED_WORDS[name] && /^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(name);
        };

        __exports__ = JavaScriptCompiler;
        return __exports__;
    })(__module2__, __module5__);

// handlebars.js
    var __module0__ = (function (__dependency1__, __dependency2__, __dependency3__, __dependency4__, __dependency5__) {
        "use strict";
        var __exports__;
        /*globals Handlebars: true */
        var Handlebars = __dependency1__;

        // Compiler imports
        var AST = __dependency2__;
        var Parser = __dependency3__.parser;
        var parse = __dependency3__.parse;
        var Compiler = __dependency4__.Compiler;
        var compile = __dependency4__.compile;
        var precompile = __dependency4__.precompile;
        var JavaScriptCompiler = __dependency5__;

        var _create = Handlebars.create;
        var create = function () {
            var hb = _create();

            hb.compile = function (input, options) {
                return compile(input, options, hb);
            };
            hb.precompile = function (input, options) {
                return precompile(input, options, hb);
            };

            hb.AST = AST;
            hb.Compiler = Compiler;
            hb.JavaScriptCompiler = JavaScriptCompiler;
            hb.Parser = Parser;
            hb.parse = parse;

            return hb;
        };

        Handlebars = create();
        Handlebars.create = create;

        Handlebars['default'] = Handlebars;

        __exports__ = Handlebars;
        return __exports__;
    })(__module1__, __module7__, __module8__, __module11__, __module12__);

    return __module0__;
}));

var INDIA_COUNTRY_ID = "sih:location/india";
var ROLE_PERSONATYPE_MAP = {
    "Individual": "individual",
    "Startup": "startup",
    "Investor": "individual-investor",
    // "Investor": "institutional-investor",
    "Accelerator": "accelerator",
    "Corporate":"corporate",
    "Mentor": "mentor",
    "Incubator": "incubator",
    "GovernmentBody": "government-body",
    "ServiceProvider": "organization-service-provider",
    // "ServiceProvider": "freelancer-service-provider",
    "Academia": "academia"
};
var BUDGET = {
    'LAKH_0_LAKH_25': '0 - 25 Lacs INR',
    'LAKH_25_LAKH_50': '25 Lacs - 50 Lacs INR',
    'LAKH_0_LAKH_50': '0 - 50 Lacs INR',
    'LAKH_50_CRORE_1': '50 Lacs - 1 Crore INR',
    'LAKH_50_CRORE_2': '50 Lacs - 2 Crore INR',
    'CRORE_1_ABOVE': '1 Crore + INR',
    'CRORE_2_CRORE_5': '2 Crore - 5 Crore INR',
    'CRORE_5_ABOVE': '5 Crore + INR'
};

var BADGES = {
    'CIN_CERTIFIED':'Registered Company',
    'DIPP_CERTIFIED':'DIPP Recognized',
    'SEBI_REGISTERED':'SEBI Registered',
    'TIE_REGISTERED':'TiE Charter Member',
    'SIH_VERIFIED':'SIH Recognized',
    'LV_VERIFIED': 'LetsVenture Member'
};


var STARTUP_STAGES = {
    'Prototype' : 'Ideation',
    'Validation' : 'Validation',
    'EarlyTraction' : 'Early Traction',
    'Scaling' : 'Scaling'
};

var PROGRAM_DURATION = {
    '6' : 'Upto 6 Months',
    '12' : '6 to 12 Months',
    '18' : '12 Months and above'
};

Handlebars.registerHelper('showIndex',function (index) {
    return index+1;
});
Handlebars.registerHelper('isLoggedIn',function (options) {
    return store.getItem("token") ? true : false;
});
Handlebars.registerHelper('getBannerImage', function (bannerImage) {
    return new Handlebars.SafeString(SIH.getEndPoint("/api/file/ams/banner/logo?fileName=" + bannerImage))
});
Handlebars.registerHelper('getIncubatorStartupPortfolioLogo', function (logo) {
    var imagePath = SIH.getEndPoint("/api/file/user/image") + "/Incubator" + "?fileName=" + logo;
    return new Handlebars.SafeString(imagePath);
});
Handlebars.registerHelper('getBadgeIconPath', function (bannerImage) {
    return new Handlebars.SafeString(SIH.getEndPoint("/api/file/badge/icon?fileName=" + bannerImage))
});
Handlebars.registerHelper('formatStartupEntryDate', function (startupEntryDate) {
    var m_names = new Array("January", "February", "March",
        "April", "May", "June", "July", "August", "September",
        "October", "November", "December");
    var formattedDate = new Date(startupEntryDate);
    return  m_names[formattedDate.getMonth()] + " " + formattedDate.getFullYear();
});

Handlebars.registerHelper('badgesArraySize', function (badgeDetails) {
    return badgeDetails.length;
});
Handlebars.registerHelper('hiddenBadgesArraySize', function (badgeDetails) {
    return badgeDetails.length - 2;
});

Handlebars.registerHelper('getBadgeImage', function (iconLink) {
    return new Handlebars.SafeString(SIH.getEndPoint("/api/file/badge/icon?fileName="+iconLink))
});

Handlebars.registerHelper('getGalleryImage', function (iconLink) {
    return new Handlebars.SafeString(SIH.getEndPoint("/api/file/user/gallery?fileName="+iconLink))
});

Handlebars.registerHelper('getYoutubeThumbnail', function (path) {
    return new Handlebars.SafeString("https://img.youtube.com/vi/"+getYoutubeVideoId(path)+"/0.jpg");
});

Handlebars.registerHelper('getGalleryTabNames', function (key) {
    return galleryItems[key];
});

Handlebars.registerHelper('getPartnerLogoDetails', function (partnerLogos , partnerLogoName) {
    return partnerLogos[partnerLogoName];
});

Handlebars.registerHelper('getLandingPage', function (status) {
    return status.toLowerCase().replace('_','-');
});

Handlebars.registerHelper('checkForOtherIndustries', function (industry) {
    var otherIndustryIndex = $.inArray("sih:industry/others", industry);
    if(otherIndustryIndex !== -1){
        industry[otherIndustryIndex] = "Others"
    }
    var str = industry.join(", ");
    return str.length > 70 ? str.substr(0,70)+"..." :str;
});

var INVESTOR_TYPE = {
    'ANGEL_GROUP' : 'Angel Group',
    'PRIVATE_COMPANY' : 'Private Company',
    'VENTURE_CAPITAL' : 'Venture Capital',
    'PRIVATE_EQUITY' : 'Private Equity',
    'OTHER' : 'Others'
};

Handlebars.registerHelper('checkfornull', function (picPath, role) {
    picPath = Handlebars.escapeExpression(picPath);
    role = Handlebars.escapeExpression(role);
    if (!picPath)
        return new Handlebars.SafeString("/etc/designs/invest-india/investindialibs/images/user_default_pic.jpeg");
    else {
        if(role === "Entrepreneur"){
            role = "Startup";
        }
        return new Handlebars.SafeString(SIH.getEndPoint("/api/file/user/image/" + role + "?fileName=" + picPath))
    }
});
Handlebars.registerHelper('getcoverimage', function (picPath, role) {
    picPath = Handlebars.escapeExpression(picPath);
    role = Handlebars.escapeExpression(role);
    if(role === "Entrepreneur"){
        role = "Startup";
    }
    return new Handlebars.SafeString(SIH.getEndPoint("/api/file/user/cover/image/" + role + "?fileName=" + picPath))
});

Handlebars.registerHelper('getForumAttachedDoc', function (filename) {
    filename = Handlebars.escapeExpression(filename);

    return new Handlebars.SafeString(SIH.getEndPoint("/api/file/forum/attachments?fileName=" + filename));
});
Handlebars.registerHelper('isTypeOfImage', function (filename) {
    var extension = filename.split(".")[1];
    if(["jpeg","png","tiff","gif","bmp","webp","exif","bpg"].indexOf(extension) >= 0){
        return true;
    }else{
        return false;
    }
});

Handlebars.registerHelper("removeUnderscoreAndCamelCase", function (type) {
    type = type.split("_").join(" ").toLowerCase();
    return type.replace(/\b\w/g, function(l){ return l.toUpperCase() })
});

Handlebars.registerHelper("checkFormType", function (type) {
    if(type !== 'REIMBURSEMENT' && type!== 'INCENTIVE'){
        return true;
    }
    return false;
});

Handlebars.registerHelper("getAmsCategoryQuestion",function(category,root){
    return root.questionList[category];
});
Handlebars.registerHelper("getCategoryLength",function(category,root){
    return root.questionList[category] && root.questionList[category].length;
});

Handlebars.registerHelper('getMemberPic', function (picPath) {
    picPath = Handlebars.escapeExpression(picPath);
    if (picPath == null || picPath == "")
        return new Handlebars.SafeString("/etc/designs/invest-india/investindialibs/images/user_default_pic.jpeg");
    else
        return new Handlebars.SafeString(SIH.getEndPoint("/api/file/member/pic?fileName=" + picPath))
});

Handlebars.registerHelper('getSuccessStoryStartLogo', function (picPath) {
    picPath = Handlebars.escapeExpression(picPath);
    if (picPath == null || picPath == "")
        return new Handlebars.SafeString("/etc/designs/invest-india/investindialibs/images/user_default_pic.jpeg");
    else
        return new Handlebars.SafeString(SIH.getEndPoint("/api/file/user/success-story/startup/logo?fileName=" + picPath));
});

Handlebars.registerHelper('getPartnerLogo', function (picPath) {
    picPath = Handlebars.escapeExpression(picPath);
    if (picPath == null || picPath == "")
        return new Handlebars.SafeString("/etc/designs/invest-india/investindialibs/images/user_default_pic.jpeg");
    else
        return new Handlebars.SafeString(SIH.getEndPoint("/api/file/ams/banner/logo?fileName=" + picPath))
});
Handlebars.registerHelper('getPartnerType', function (partner) {
    switch (partner){
        case 'fundingPartners':
            return 'Funding Partners';
            break;
        case 'incubationPartners':
            return 'Incubation Partners';
            break;
        case 'mediaPartners':
            return 'Media Partners';
            break;
        case 'outReachPartners':
            return 'Outreach Partners';
            break;
        case 'technologyPartners':
            return 'Technology Partners';
            break;
        case 'academicPartners':
            return 'Academic Partners';
            break;
        case 'leadPartners':
            return 'Lead Partners';
            break;
    }
});

Handlebars.registerHelper('is_equal', function (msg, matchMsg, options) {
    return msg === matchMsg;
});

Handlebars.registerHelper('if_or_equal', function(a,b,c,d,e) {
    return a === b||a === c||a === d||a === e;
});

Handlebars.registerHelper('selectOption', function (option,name,options) {
    var selectOptions = [];
    if(option && option[0]){
        if(option[0].indexOf('[') !== 0){
            $.each(option , function (index,val) {
                var o = {"key":val,"value":val,"name":name};
                selectOptions.push(o);
            })
        }
        else{
            option = option[0].substr(1,option[0].length -2).split(",");
            $.each(option,function(index,val){
                var key = val.split("=")[0];
                var value = val.split("=")[1];
                var o = {"key":key,"value":value,"name":name};
                selectOptions.push(o);
            });
        }
    }
    return selectOptions;
});


Handlebars.registerHelper('renderCheckboxData', function (data,name,options) {
    if(data){
        if(data.length > 1){
            return data.join("<br>")
        }else{
            return data;
        }
    }
});

Handlebars.registerPartial('amsForm',$("#ams-applicant-form-template").html());
Handlebars.registerPartial('appList',$("#appList-template").html());
Handlebars.registerPartial('stateStatistics',$("#state-statistics-template").html());

Handlebars.registerPartial('amsQuestionTemplate',$("#ams-question-template").html());
Handlebars.registerPartial('amsSectionTemplate',$("#ams-section-template").html());
Handlebars.registerPartial('amsListTemplate',$("#ams-list-template").html());

Handlebars.registerHelper('getSectionData', function (parentId, mandatory,options) {
    var data = [];
    var token = store.getItem("token");
    if (isPreviewMode) {
        token = $("form[name='ams-application-form']").data("admin-token");
    }
    $.ajax({
        url: SIH.getEndPoint("/api/auth/ams/application/"+parentId+"/childQuestions"),
        type: 'GET',
        async:false,
        contentType: 'application/json',
        headers: {'X-Auth-Token': token, 'Content-Type': 'application/json'},
        success: function (response) {
            data = response;
            if(mandatory){
                $.each(data,function(index,val){
                    val.mandatory = mandatory;
                })
            }
        },
        error: function (response) {
            console.log("Error occurred",response)
        }
    });
    return data;
});

Handlebars.registerHelper('getHeadingData', function (parentId, options) {
    var data = [];
    $.ajax({
        url: SIH.getEndPoint("/api/auth/ams/questionnaire/get/"+parentId),
        type: 'GET',
        async:false,
        contentType: 'application/json',
        beforeSend: setAuthTokenHeader,
        success: function (response) {
            data.push(response);
            data = response
        },
        error: function (response) {
            console.log("Error occurred",response)
        }
    });
    return data;
});

Handlebars.registerHelper('isRowStart', function (field,parent, options) {
    if(field.question.first){
        parent.rowCount = 0;
        return true;
    }else return parent.rowCount === 0;
});

Handlebars.registerHelper('isRowEnd', function (field,root,last, options) {
    if(last || root.rowCount > 1){
        root.rowCount = 0;
        return true;
    }else{
        return false;
    }
});

Handlebars.registerHelper('isFirstEncountered', function (field,root, options) {
    return field.question.first && root.rowCount <= 1;
});
Handlebars.registerHelper('isLessOrEqual', function (msg, matchMsg, options) {
    return msg <= matchMsg;
});
Handlebars.registerHelper('isRemainderZero', function (msg, matchMsg, options) {
    return (msg+1) % matchMsg === 0;
});
Handlebars.registerHelper('sub', function (msg, matchMsg, options) {
    return (msg - matchMsg);
});
Handlebars.registerHelper('incrementAndSet', function(field,val,options){
    if(field.rowCount > 2){
        field.rowCount = 0;
    }else {
        field.rowCount = field.rowCount + 1;
    }
    //return field.index;
});
Handlebars.registerHelper('resetRowCount', function(field,val,options){
    field.rowCount = 0;
});

Handlebars.registerHelper('blankCheck', function(field){
    if(field != ""){
        return true;
    }
    return false;
});
// less than or equal to
Handlebars.registerHelper('socialLink', function( social ){
    if(social === 'Linkedin') {
        return "linkedin-grey";
    } else if (social === 'Twitter') {
        return "twitter-grey";
    } else if (social === 'Facebook') {
        return "fb-gray";
    } else if (social === 'GooglePlus') {
        return "gplus-grey";
    }
});

Handlebars.registerHelper('socialIcons', function( social ){
    if(social === 'Linkedin') {
        return "linkedin-banner";
    } else if (social === 'Twitter') {
        return "twitter-banner";
    } else if (social === 'Facebook') {
        return "fb-banner";
    } else if (social === 'GooglePlus') {
        return "google-plus-banner";
    }
});

Handlebars.registerHelper('getTwitter', function( socialInfos, options){
    var obj;
    $.each(socialInfos, function (i,v) {
        if(v.social === 'Twitter') {
            obj = v;
            return false;
        }
    });
    return options.fn(obj);
});

Handlebars.registerHelper('getLinkedin', function( socialInfos,options ){
    var obj;
    $.each(socialInfos, function (i,v) {
        if(v.social === 'Linkedin') {
            obj = v;
            return false;
        }
    });
    return options.fn(obj);
});

Handlebars.registerHelper('getSocialUrl', function( socialInfo, social ){
    var socialUrl;
    $.each(socialInfo, function(i,v){
        socialUrl = "";
        if(socialInfo[i].social === social){
            socialUrl = socialInfo[i].url;
            return false;
        }
    });
    return socialUrl;
});

Handlebars.registerHelper('toLowerCase', function(str) {
    return str.toLowerCase();
});

Handlebars.registerHelper('ifGreaterThan', function (v1,
                                                     v2, options) {
    if (v1 > v2) {
        return options.fn(this);
    }
    return options.inverse(this);
});

Handlebars.registerHelper('ifLessThan', function (v1,
                                                  v2, options) {
    if (v1 < v2) {
        return options.fn(this);
    }
    return options.inverse(this);
});
Handlebars.registerHelper('isEqualTo', function (v1, v2,
                                                 options) {
    if (v1 == v2) {
        return options.fn(this);
    }
    return options.inverse(this);
});

Handlebars.registerHelper('times', function (n,currentPage, block) {
    var accum = '';
    if(n<=5){
        for (var i = 0; i < n; ++i)
            accum += block.fn(i + 1);
    }  else {
        var lowerLimit=0;
        var upperlimit = currentPage;
        switch (currentPage) {
            case 1:
                lowerLimit = 0;
                upperlimit = currentPage + 4;
                break;
            case 2:
                lowerLimit = 0;
                upperlimit = currentPage + 3;
                break;
            case n:
                lowerLimit = currentPage-5;
                upperlimit = currentPage;
                break;
            case n-1:
                lowerLimit = currentPage-4;
                upperlimit = currentPage+1;
                break;
            default:
                lowerLimit = currentPage-3;
                upperlimit = currentPage+2;
        }
        for ( lowerLimit ;lowerLimit < upperlimit ; ++lowerLimit)
            accum += block.fn(lowerLimit+ 1);
    }
    return accum;
});

Handlebars.registerHelper('getBusinessDoc', function (role, fileName, title) {
    return new Handlebars.SafeString(SIH.getEndPoint("/api/file/user/doc/" + role + "/" + (title ? title : fileName) + "?fileName=" + fileName));
});

Handlebars.registerHelper('getGrievanceDoc', function (fileName) {
    return new Handlebars.SafeString(SIH.getEndPoint("/api/file/grievance/attachments?fileName=" + fileName));
});
Handlebars.registerHelper('getApplicantDoc', function (fileName) {
    return new Handlebars.SafeString(SIH.getEndPoint("/api/file/ams/applicant/doc/get/" + fileName));
});

Handlebars.registerHelper('getEither', function (varOne, varTwo) {
    return (varOne || varTwo);
});

Handlebars.registerHelper('checkBothForTrueCondition', function (varOne, varTwo) {
    return (varOne && varTwo);
});

Handlebars.registerHelper('getInvestmentSize', function (budget) {
    return BUDGET[budget];
});

Handlebars.registerHelper('getValidLink', function (link) {
    return completeLink(link);
});

Handlebars.registerHelper('var',function(name, value, context){
    this[name] = value;
});

Handlebars.registerHelper('requestdays', function(time) {
    var requestDate = new Date(time);
    var currentDate = new Date();
    var diff = dateDiff(currentDate,requestDate);
    return diff;
});

Handlebars.registerHelper('ifBeforeToday', function(time, options) {
    var givenDate = new Date(time);
    var currentDate = new Date();
    if(givenDate < currentDate) {
        return options.fn(this);
    } else {
        return options.inverse(this);
    }
});

Handlebars.registerHelper('formatAMSDate', function (date) {
    var m_names = new Array("JAN", "FEB", "MAR",
        "APR", "MAY", "JUN", "JUL", "AUG", "SEP",
        "OCT", "NOV", "DEC");
    var formattedDate = new Date(date);
    return formattedDate.getDate() + " " + m_names[formattedDate.getMonth()] + ", " + formattedDate.getFullYear();
});

Handlebars.registerHelper('formatMonthDate', function (date) {
    var m_names = new Array("Jan", "Feb", "Mar",
        "Apr", "May", "Jun", "Jul", "Aug", "Sep",
        "Oct", "Nov", "Dec");
    var formattedDate = new Date(date);
    return  m_names[formattedDate.getMonth()] + " " + formattedDate.getDate() + ", " + formattedDate.getFullYear();
});

Handlebars.registerHelper('formatAMSStartDate', function (date) {
    var m_names = new Array("JAN", "FEB", "MAR",
        "APR", "MAY", "JUN", "JUL", "AUG", "SEP",
        "OCT", "NOV", "DEC");
    var formattedDate = new Date(date);
    return formattedDate.getDate() + " " + m_names[formattedDate.getMonth()] + ", " + formattedDate.getFullYear()  + " "+("0" + formattedDate.getHours()).slice(-2)+ ":" + ("0" + formattedDate.getMinutes()).slice(-2)+":"+("0" + formattedDate.getSeconds()).slice(-2)+ " IST";
});

Handlebars.registerHelper('insertSpace', function(value) {
    return value.replace(/([A-Z])/g, ' $1').trim();
});

var dateDiff = function ( d1, d2 ) {
    var diff = Math.abs(d1 - d2);
    if (Math.floor(diff/2592000000)) {
        return d2.getDate()+"/"+d2.getMonth()+"/"+d2.getFullYear();
    } else if (Math.floor(diff/604800000)) {
        return Math.floor(diff / 604800000) + " week(s) ago";
    } else if (Math.floor(diff/86400000)) {
        return Math.floor(diff/86400000) + " day(s) ago";
    } else if (Math.floor(diff/3600000)) {
        return Math.floor(diff/3600000) + " hour(s) ago";
    } else if (Math.floor(diff/60000)) {
        return Math.floor(diff/60000) + " minute(s) ago";
    } else {
        return "Just Now";
    }
};

var completeLink = function(link){
    var result = "";
    var startingUrl = "http://";
    if(link){
        result = (link.startsWith(startingUrl) || link.startsWith("https://")) ? link : (startingUrl + link);
    }
    return result;
};

Handlebars.registerHelper('notificationUrl', function (notificationType, resourceId,navigationLink) {
    var profileUrl = $('#notification').attr('public-profile-url');
    var forumUrl = $('#notification').attr('forum-url');

    switch (notificationType) {
        case "PROFILE_CREATED":
        case "PROFILE_APPROVED":
        case "PROFILE_REJECTED":
        case "QUESTION_MARKED_AS_SPAM":
            notificationUrl = "javascript:void(0)";
            break;
        case "CONNECTION_APPROVED":
            notificationUrl = profileUrl + "." + store.getItem('role') + "." + resourceId + ".html";
            break;
        case "MARKED_AS_ANSWER_OWNER":
        case "MARKED_AS_ANSWER_SUBSCRIBER":
        case "COMMENT_ON_SUBSCRIBED_QUESTION":
        case "COMMENT_ON_MY_QUESTION":
            notificationUrl = forumUrl + "." + resourceId + ".html";
            break;
        default:
            if(navigationLink) {
                notificationUrl = navigationLink;
            }else{
                notificationUrl = "javascript:void(0)";
            }
    }
    return notificationUrl;
});

Handlebars.registerHelper('notificationClass', function (notificationType) {
    var notificationClass = "";

    switch (notificationType) {
        case "PROFILE_CREATED":
        case "PROFILE_APPROVED":
        case "PROFILE_REJECTED":
        case "QUESTION_MARKED_AS_SPAM":
            notificationClass = "default-cursor";
            break;
        case "CONNECTION_APPROVED":
        case "MARKED_AS_ANSWER_OWNER":
        case "MARKED_AS_ANSWER_SUBSCRIBER":
        case "COMMENT_ON_SUBSCRIBED_QUESTION":
        case "COMMENT_ON_MY_QUESTION":
            break;
        default:
            notificationClass = "default-cursor";
    }
    return notificationClass;
});

Handlebars.registerHelper('markRead', function (read) {
    if ( read ) {
        return "read";
    } else {

        return "";
    }
});

Handlebars.registerHelper('isEven',function(index){
    return index % 2 === 0;
});

Handlebars.registerHelper('isNull', function (value) {
    return value === null || value === undefined;
});

Handlebars.registerHelper('isOdd',function(index){
    return !(index % 2 === 0);
});

Handlebars.registerHelper('checkForIndividual',function(role){
    if(role == 'Individual'){
        return true;
    }else{
        return false;
    }
});

Handlebars.registerHelper('addEllipsis',function(description){
    var splitDescription = description.split('</p>');
    if (splitDescription.length > 1) {
        description = splitDescription[0];
        if(description.length < 85 ){
            description = description + "...";
        }
    }
    return description;
});

Handlebars.registerHelper('addEllipsisWithLimit',function(description,length){
    if(description) {
        description = description.replace(/<\/?[^>]+(>|$)/g, "");
    }
    if (description && description.length > length) {
        description = description.substr(0, length) + "...";
    }
    return description;
});

Handlebars.registerHelper('addEllipsesWithWordLimit',function(description, length){
    description = description.replace(new RegExp('<div>', 'gi'), '<p>');
    description = description.replace(new RegExp('</div>', 'gi'), '</p>');
    var words = description.split(" ");
    if (words.length > length) {
        description = words.slice(0, length).join(" ") + "...";
    }
    return description;
});

Handlebars.registerHelper('replaceDivWithPara',function(description) {
    description = description.replace(new RegExp('<div>', 'gi'), '<p>');
    description = description.replace(new RegExp('</div>', 'gi'), '</p>');
    return description;
});

Handlebars.registerHelper('hasMoreWordsThan', function (description, length, options) {
    var words = description.split(" ");
    if(words.length > length ){
        return options.fn(this);
    }
    return options.inverse(this);
});

Handlebars.registerHelper('getTagName', function (tag) {
    return (tag ? (tag.name ? tag.name : tag.text) : '-');
});

Handlebars.registerHelper('parseFloat', function (rating) {
    return parseFloat(rating);
});

Handlebars.registerHelper('roundOff', function (rating) {
    return Math.round(rating);
});

Handlebars.registerHelper('changeCamelCaseToWords', function (text) {
    if(text){
        var str = "";
        for(var i=0; i<text.length; i++) {
            if(text.charCodeAt(i) >= 65 && text.charCodeAt(i) <= 90) {
                str = str + " " + text[i];
            } else {
                str = str + text[i];
            }
        }
        return str;
    } else {
        return text;
    }
});

// this method will replace &lt; and &gt; to < or >
Handlebars.registerHelper('replaceSpecialChar', function (content, isMessage) {
    if(isMessage) {
        return content.replace(new RegExp('&lt;', 'g'), '<').replace(new RegExp('&gt;', 'g'), '>').replace(new RegExp('\n', 'g'), "<br/>");
    } else {
        return content.replace(new RegExp('&lt;', 'g'), '<').replace(new RegExp('&gt;', 'g'), '>');
    }
});

Handlebars.registerHelper('forumDropDown',function(questionOwner,commentOwner,answered, markedCorrect ){
    if(!questionOwner && commentOwner){
        return true;
    }else if(questionOwner && commentOwner && answered){
        return true;
    }else if(questionOwner && !commentOwner && answered && markedCorrect){
        return true;
    }
    else if(!questionOwner && !commentOwner && answered && markedCorrect){
        return true;
    }
    else{
        return false;
    }
});

Handlebars.registerHelper('getBadgeName', function (badge) {
    if(badge){
        return BADGES[badge];
    }
});

Handlebars.registerHelper('searchDirection', function (sort, columnProperty) {
    var sortDirection = 'fa-sort';
    if(sort){
        for (i = 0; i < sort.length; i++) {
            if (sort[i].property == columnProperty) {
                if (sort[i].direction == 'ASC') {
                    sortDirection = 'fa-sort-asc'
                } else if (sort[i].direction == 'DESC') {
                    sortDirection = 'fa-sort-desc'
                } else {
                    sortDirection = 'fa-sort'
                }
            }
        }
    }
    return sortDirection;
});

Handlebars.registerHelper('getFirstItems',function(array, count){
    if(array && count && array.length > count)
    {
        array = array.slice(0,count);
    }
    return array;
});

Handlebars.registerHelper('isCountryIndia', function(country){
    if(country && country.toLowerCase() == "india") {
        return true;
    } else {
        return false;
    }
});


Handlebars.registerHelper('isCinNumber', function(cin){
    var data1;
    if(cin){

        $.ajax({
            type:"POST",
            dataType: "json",
            url: "https://recognition.startupindia.gov.in/webapi/webservice.php?rquest=getincorporation",
            data:{"incorp_no":cin},
            success: function (response) {
                var incorp_date = response.incorpdate;
                if(incorp_date){
                    var incorp_year= incorp_date.split('-');
                    var current_date = new Date();
                    var str_date = current_date.getFullYear();
                    var numOfActiveYears= str_date-incorp_year[2];
                    if(numOfActiveYears=='0'){
                        $(".numberofyears").html("0-1 Years");
                    } else {
                        $(".numberofyears").html(numOfActiveYears+" Years ");
                    }
                }else{
                    $(".numberofyears").html("-");
                }
            },
            error: function (response) {
                console.log("Error occurred",response)
            }
        });

        return true;
    }

    else{

        return false;
    }

});

Handlebars.registerHelper('isDeletedBadge',function(value){

    if(!value){
        return true;
    }
    else{
        return false;
    }

});
Handlebars.registerHelper('isRoleGovernmentBody',function(role){

    return role && role =="GovernmentBody";
});

Handlebars.registerHelper('isStartup', function (role) {
    return role == 'Startup' ? true : false;
});

Handlebars.registerHelper('getStartupStage', function (stage) {
    return Handlebars.helpers.ternary(STARTUP_STAGES[stage], STARTUP_STAGES[stage], "-");
});

Handlebars.registerHelper('getProgramDuration', function (duration) {
    return PROGRAM_DURATION["" + duration];
});

Handlebars.registerHelper('getInvestorType', function (type) {
    return INVESTOR_TYPE[type];
});

Handlebars.registerHelper('getPreferredStartupStages', function (preferredStages) {
    for(var i = 0; i < preferredStages.length; i++){
        if(preferredStages[i] == 'Prototype'){
            preferredStages[i] = STARTUP_STAGES[preferredStages[i]];
            break;
        }
    }
    return preferredStages;
});

Handlebars.registerHelper('formatLineBreaks', function (inputString) {
    if(inputString){
        var newLineForWindowsOS = "\r\n";
        var newLineForUnixOS = "\n";
        var newLineForMacOSX = "\r";
        var htmlLineBreakTag = "";
        if(inputString.indexOf(newLineForWindowsOS) > -1){
            inputString = inputString.replace(new RegExp(newLineForWindowsOS, 'g'),htmlLineBreakTag);
        }
        if(inputString.indexOf(newLineForUnixOS) > -1){
            inputString = inputString.replace(new RegExp(newLineForUnixOS, 'g'),htmlLineBreakTag);
        }
        if(inputString.indexOf(newLineForMacOSX) > -1){
            inputString = inputString.replace(new RegExp(newLineForMacOSX, 'g'),htmlLineBreakTag);
        }
    }
    return inputString || "";
});

Handlebars.registerHelper('contributorUrl', function (contributorType, resourceId) {
    var profileUrl = $('#contributors-list').attr('public-profile-url');
    var contributorUrl = "#";

    switch (contributorType) {
        case "Individual":
        case "GovernmentBody":
        case "ServiceProvider":
        case "Academia":
            contributorUrl = "javascript:void(0)";
            break;
        default:
            contributorUrl = profileUrl + "." + contributorType + "." + resourceId + ".html";
    }
    return contributorUrl;
});

Handlebars.registerHelper('leaderClass', function (contributorType) {
    var leaderClass = "";

    switch (contributorType) {
        case "Individual":
        case "GovernmentBody":
        case "ServiceProvider":
        case "Academia":
            leaderClass = "default-cursor";
            break;
        default:
            leaderClass = "";
    }
    return leaderClass;
});

Handlebars.registerHelper('each_upto', function (ary, max, options) {
    if (!ary || ary.length == 0)
        return options.inverse(this);
    var result = [];
    for (var i = 0; i < max && i < ary.length; ++i)
        result.push(options.fn(ary[i]));
    return result.join('');
});

Handlebars.registerHelper('getEllipsis', function (text, length) {
    return (text && text.length > length) ? text.substring(0, length - 1) + "..." : text;
});

Handlebars.registerHelper('check_highlights', function (name, value, snipplets) {
    if(name == value) {
        return snipplets;
    }
});
Handlebars.registerHelper('substraction', function (totalLength, actualLength) {
    return totalLength-actualLength;
});

Handlebars.registerHelper('loop', function(n, block) {
    var accum = '';
    for(var i = 0; i < n; ++i)
        accum += block.fn(i);
    return accum;
});
Handlebars.registerHelper('isEntrepreneur', function (role) {
    if (store.getItem('country') != 'sih:location/india' && store.getItem('role').toLowerCase() == 'startup') {
        role = "Entrepreneur";
    }
    if(store.getItem('role').toLowerCase() === 'sih_admin'){
        role = "SIH Admin"
    }
    if(store.getItem('role').toLowerCase() === 'governmentbody'){
        role = "Govt Body"
    }
    return role;
});
Handlebars.registerHelper('getRole', function (role) {
    if (role === 'Entrepreneur') {
        return "Startup"
    }
    return role;
});

Handlebars.registerHelper('isContentOverflowing', function (wrapper) {
    var element = $(wrapper);
});

Handlebars.registerHelper('ternary', function(test, option1, option2){
    return test ? option1 : option2;
});

Handlebars.registerHelper('profileEditAllowed', function(){
    return store.getItem("allowProfileEdit");
});

Handlebars.registerHelper('loginUserEqualsProfileUser', function(){
    return store.getItem("profileUniqueId") === store.getItem("uniqueId");
});

Handlebars.registerHelper('stringifyObject', function(obj){
    return JSON.stringify(obj);
});

Handlebars.registerHelper('concatTwoStrings', function(obj1, obj2, delim){
    return obj1 + delim + " " + obj2;
});

Handlebars.registerHelper('updateDashboardCategory',function(val1,val2){
    if(val1 === "Recommendations"){
        return "What to do - " + val1;
    }else{
        return val2 +" - "+val1;
    }

});

Handlebars.registerHelper('resolveTag', function(value){
    var tag;
    if(value){
        $.ajax({
            type:"GET",
            dataType: "json",
            url: "/services/tags/resolve",
            async: false,
            data: {
                path: value,
            },
            success: function (data) {
                if (typeof data == "string") {
                    data = JSON.parse(data);
                }
                tag = data;
            },
            error: function (response) {
                console.log("Error occurred",response);
            }
        });
    }
    return tag.text;
});

Handlebars.registerHelper('getObjectLength', function(obj){
    return Object.keys(obj).length;
});

Handlebars.registerHelper('isFollowed', function(category, categoryType){
    var res = false;
    if(followedCategories) {
        if (categoryType === "Category") {
            res = followedCategories.categories.includes(category);
        } else if (categoryType === 'SubCategory') {
            res = followedCategories.subCategories.includes(category);
        }
    }
    return res;
});
Handlebars.registerHelper('numberLocaleString',function(val){
   return parseInt(val).toLocaleString('en-IN');
});

Handlebars.registerHelper('json', function(context) {
    return JSON.stringify(context);
});

Handlebars.registerHelper('ifSelfProfile', function (options) {
    var selfProfile=store.getItem("uniqueId") === window.location.pathname.split("\.")[2];
    return selfProfile == true ? true : false;
});

Handlebars.registerHelper('ifAnyValue', function (...theArgs) {
    var hasAnyValue = false;
    theArgs = theArgs.slice(0, theArgs.length-1);
    /*var role = theArgs[theArgs.length-1];
    if(["Incubator","Accelerator","Mentor"].indexOf(role) > -1){
        hasAnyValue = true;
    }
    theArgs = theArgs.slice(0, theArgs.length-1);*/
    theArgs.forEach(function (value, index) {
        if(value){
            hasAnyValue = true;
        }
    });
    return hasAnyValue;
});
Handlebars.registerHelper("isEditable", function (lastSubmissionDate, status) {
    var currentDate = new Date().getTime();
    var statusArray = ["DRAFTED","INCOMPLETE"];
    if(statusArray.includes(status) && currentDate <= lastSubmissionDate
        || status === "INCOMPLETE"  && currentDate-lastSubmissionDate == 432000000)
        return "edit-icon";
    else
        return "fa fa-eye";
});
Handlebars.registerHelper("getAppProgress", function (lastSubmissionDate) {
    var currentDate = new Date().getTime();
    return currentDate <= lastSubmissionDate ? "In Progress" : "Expired";
});

Handlebars.registerHelper("getLongDate", function (lastSubmissionDate) {
    return new Date(lastSubmissionDate).toDateString();
});
Handlebars.registerHelper("getLongDate", function (applicantResponseSubmissionDate) {
    return new Date(applicantResponseSubmissionDate).toDateString();
});

Handlebars.registerHelper('reverseArray', function(array){
    return array.reverse();
});

Handlebars.registerHelper('ifIn', function(elem, list, options) {
    return list.indexOf(elem) > -1;

});
Handlebars.registerHelper('ifNotIn', function(elem, list, options) {
    return list.indexOf(elem) < 0;

});
Handlebars.registerHelper('arr', function() {
    // Covnert arguments to array, ommiting the last item, which is the options obect
    return Array.prototype.slice.call(arguments,0,-1);
});
Handlebars.registerHelper('inArray', function(elem, arr, options) {
    var isInArray = $.inArray(elem, arr) > -1 ? true : false;
    if (isInArray) {
        return options.fn(this);
    }
    return options.inverse(this);
});

(function ($) {
    var lastWindowScrollTop = 0,
        userAgent = navigator.userAgent,
        $body = $('body'),
        isIOS = /iPhone|iPad/.test(userAgent),
        NO_SCROLL_CLASS = isIOS
            ? 'ios-noscroll'
            : '';
    function fixedBody() {
        if (isIOS) {
            lastWindowScrollTop = $(window).scrollTop();
            $body.addClass(NO_SCROLL_CLASS);
            $body.css('top', '-' + lastWindowScrollTop + 'px');

        }
    }

    function looseBody() {
        $body.removeClass(NO_SCROLL_CLASS);
        if (isIOS) {
            $body.css('top', '');
            window.scrollTo(0, lastWindowScrollTop);
        }
    }


    $('.mega-menu-wrapper .sub-deviding-container .mega-menu-sub-block').each(function () {
        $(this).find(".mega-menu-duo").wrapAll('<div class="duo-inner-wrap"></div>');
    })
    // $('.mega-menu-wrapper .sub-deviding-container .mega-menu-sub-block .mega-menu-duo').wrapAll('<div class="duo-inner-wrap"></div>');
    $('.header-search-wrap .search-submit').click(function () {
        if ($(window).width() > 1024) {
            $('.mega-menu-wrapper .mega-menu-top-nav-container').hide();
        }
        $(this).closest('.mega-menu-wrapper').addClass('active-search');
        $('#search-here').focus();
    });
    $('.menu-icon.desktop').click(function () {

        $('.mega-menu-wrapper').removeClass('active-search');
        setTimeout(function () {
            $('.mega-menu-wrapper .mega-menu-top-nav-container').fadeIn();
        }, 700);
    })
    $('body').click(function () {
        $('.mega-menu-wrapper').removeClass('active-search');
        if ($(window).width() > 1024) {
            setTimeout(function () {
                $('.mega-menu-wrapper .mega-menu-top-nav-container').fadeIn();
            }, 700);
        }
    })

    $(".header-search-wrap").click(function (e) {
        e.stopPropagation();
    });
    $('.mega-menu-wrapper .menu-icon.mobile').click(function () {
        $('.mega-menu-wrapper').addClass('active-nav');
        $(".mega-menu-top-nav-container").before('<div class="nav-overlay"></div>')

        if (isIOS){
            fixedBody();
        }
        else{
            $("html").css({"overflow": "hidden"});
        }


    });
    $(".mobile-nav-head .nav-close").click(function () {
        $('.mega-menu-wrapper').removeClass('active-nav active-sub-nav-outer');
        $(".dropdown-content-outer").removeClass("active-sub-nav");
        $(".mega-menu-right-side-content .nav-overlay").remove();
        $(".mega-menu-wrapper .mobile-nav-head h3").text("Menu");

        if (isIOS){
            looseBody();
        }
        else{
            $("html").css({"overflow": "initial"});
        }

    });
    $(window).on("load resize", function () {
        if ($(window).width() < 1025) {
            if ($(".mega-menu-wrapper .mega-menu-top-nav-container .header-menu li.dropdown .side-arrow").length <= 0) {
                $(".mega-menu-wrapper .mega-menu-top-nav-container .header-menu li.dropdown > a").append("<i class='side-arrow'></i>");
            }
          }
        else {
            $(".mega-menu-wrapper .mega-menu-top-nav-container .header-menu li.dropdown .side-arrow").remove();

        }
        if ($(window).width() < 768) {
            if ($(".mega-menu-wrapper .header-search-wrap .mo-search-close").length == 0) {
                $(".mega-menu-wrapper .header-search-wrap ").append('<i class="mo-search-close"></i>');
            }
            if ($(".mega-menu-wrapper .sub-deviding-container .mega-menu-sub-block h4 i.fa").length <= 0) {
                $(".mega-menu-wrapper .mega-menu-sub-block h4").append('<i class="fa fa-plus"></i>');
            }
            $(".language-container .header-language .dropdown").hover(function(){

            $(".language-container .header-language .dropdown .dropdown-content").mCustomScrollbar();
            })
        }
        else {
            $(".mega-menu-wrapper .sub-deviding-container .header-search-wrap .mo-search-close").remove();
            $(".mega-menu-wrapper .sub-deviding-container .mega-menu-sub-block h4 i.fa").remove();
            FlagSearch = true;
        }
        $(".mega-menu-wrapper .header-search-wrap .mo-search-close").on("click", function () {
            $('.mega-menu-wrapper').removeClass('active-search');
        });
        $(".mega-menu-wrapper .sub-deviding-container .mega-menu-sub-block h4").click(function(e){
            if ($(window).width() < 768) {
                $(".mega-menu-wrapper .sub-deviding-container .mega-menu-sub-block h4 i").toggleClass("fa-minus fa-plus");
                $(this).siblings(".duo-inner-wrap").slideToggle();
                $(this).closest(".mega-menu-sub-block").siblings(".mega-menu-sub-block").find(".duo-inner-wrap").slideUp();
                $(this).closest(".mega-menu-sub-block").siblings(".mega-menu-sub-block").find("i").removeClass("fa-minus");
                $(this).closest(".mega-menu-sub-block").siblings(".mega-menu-sub-block").find("i").addClass("fa-plus");
            }
            e.preventDefault();
        });
    });
    // sub menu
    $(".mega-menu-wrapper .header-menu li.dropdown > a").click(function () {
        if ($(window).width() < 1025) {
            $('.mega-menu-wrapper').addClass('active-sub-nav-outer');
            $(this).closest("li.dropdown").find(".dropdown-content-outer").addClass("active-sub-nav");
            var activeNavText = $(this).text();
            $(".mega-menu-wrapper .mobile-nav-head h3").text(activeNavText);
        }
    });
    $(".mega-menu-wrapper .mobile-nav-head i.back").click(function () {
        $('.mega-menu-wrapper').removeClass('active-sub-nav-outer');
        $(".dropdown-content-outer").removeClass("active-sub-nav");
        $(".mega-menu-wrapper .mobile-nav-head h3").text("Menu");

    })
    $('.forumFilterContainer').on("select2:open", function(e){
        if($(window).width() < 768){
            $(".main-header.sticky header").css("z-index","9 !important");
        }
    })
    $('.forumFilterContainer').on("select2:close", function(e){
        $(".main-header.sticky header").css("z-index","999 !important");
    })
$('.mega-menu-wrapper li.showActSetting').on("click",function(){
    $(this).toggleClass("active");
    $(this).find(".acc-setting-list").slideToggle();
});
})(jQuery);

$(document).ready(function () {

    $.fn.serializeObject = function () {
        var o = {};
        var a = this.serializeArray();
        $.each(a, function () {
            if (o[this.name] !== undefined) {
                if (!o[this.name].push) {
                    o[this.name] = [o[this.name]];
                }
                o[this.name].push(this.value || '');
            } else {
                o[this.name] = this.value || '';
            }
        });
        return o;
    };


    $.each(queryType, function (key, value) {
        var options = "<option value='" + key + "'>" + key + "</option>";
        $("#queryTypeList").append(options + "<br>")
    });

    $("#stateList").on('change', function () {

        if ($("#cityList option").length > 0) {
            $("#cityList").empty();
        }
        var state_code = $('#stateList option:selected').attr('id');
        $.ajax({
            type: 'GET',
            url: "/services/tags/cities.json",
            data: {
                state: state_code
            }
        }).done(function (data) {
            if ($.trim(data)) {
                $("#cityList").append('<option value="" disabled="" selected="">City / District</option>');
                $.each(data, function (index, result) {
                    var options = "<option id='" + result.id + "' value='" + result.text + "'>" + result.text + "</option>";
                    $("#cityList").append(options + "<br>");
                });
            }
        });
    });

});

$("#queryTypeList").on('change', function () {

    if ($("#subQueryTypeList option").length > 0) {
        $("#subQueryTypeList").empty();
    }
    var queryTypeTitle = $('#queryTypeList option:selected').val();
    var data = queryType[queryTypeTitle];
    if (data && $.trim(data)) {
        $.each(data, function (index, result) {
            var options = "<option value='" + result + "'>" + result + "</option>";
            $("#subQueryTypeList").append(options + "<br>");
            $("#subQueryTypeList").closest(".select-wrapper").removeClass("invisible").addClass("visible");
        });
    } else {
        $("#subQueryTypeList").closest(".select-wrapper").removeClass("visible").addClass("invisible");
    }
});

var validateCaptcha = function ($formContainer, captchaResponseId) {
    var $captchaResponse = $formContainer.find("textarea[name='g-recaptcha-response']");
    if ($captchaResponse && $captchaResponse.val()) {
        return true;
    } else {
        var captchaResponse = grecaptcha.getResponse(captchaResponseId);
        if (captchaResponse) {
            $captchaResponse.val(captchaResponse);
            return true;
        } else {
            if (!$formContainer.find(".g-recaptcha .help-block").length) {
                $formContainer.find(".g-recaptcha").append('<div class="help-block with-errors"><ul class="list-unstyled"><li>Please fill up the captcha.</li></ul></div>')
                    .addClass("has-error has-danger");
            }
            return false;
        }
    }
};

var validateForm = function () {
    var result = true;
    $(".required-field").each(function () {
        if (!$(this).val() || $(this).parents(".has-error").length) {
            result = false;
            return false;
        }
    });
    return result;
};

var contactUsSubmission = function () {
    $('#modal-loader').modal('show');
    var data = JSON.stringify($('.contact-us').serializeObject());
    $.ajax({
        type: "POST",
        url: SIH.getEndPoint("/api/noauth/email/contact-us"),
        contentType: "application/json",
        data: data
    }).done(function (data) {
        $('#modal-loader').modal('hide');
        showThankYouModal('contact-us');
        document.forms['contact-us'].reset();
    }).fail(function (error) {
        $('#modal-loader').modal('hide');
        $('.error-modal .modal-body p').html($('.contact-us').attr('error-message'));
        $('.error-modal').modal();
    });
};

function contactUsSideCardSubmission(resourcePartnerEmail, email, resourcePartnerSupportEmail, redirectPath) {
    var data = $('.contact-sideCard').serializeObject();
    data["resourcePartnerEmail"] = resourcePartnerEmail;
    if(!data.email) {
        data["email"] = email;
    }
    data["resourcePartnerSupportEmail"] = resourcePartnerSupportEmail;
    data = JSON.stringify(data);
    $.ajax({
        type: "POST",
        url: SIH.getEndPoint("/api/noauth/email/contact-sideCard"),
        contentType: "application/json",
        data: data
    }).done(function (data) {
        showThankYouModal('contact-sideCard', redirectPath);
        document.forms["contact-sideCard"].reset();
        $('.contact-sideCard :input').each(function () {
            if ($(this).attr('type') != 'submit') {
                $(this).siblings('label').css('display', 'block');
                $(this).siblings(".placeholder-label").removeClass('display-n');
                $(this).prop('readonly', 'readonly');
            }
            else {
                $(this).prop('disabled', 'disabled');
            }
        });

    }).fail(function (error) {
        $('.error-modal .modal-body p').html($('.contact-us').attr('error-message'));
        $('.error-modal').modal();
    });
}

var contactUsIndoSwedenSubmission = function () {
    var data = JSON.stringify($('.indo-sweden-contactUs').serializeObject());
    $.ajax({
        type: "POST",
        url: SIH.getEndPoint("/api/noauth/email/indo-sweden-contactUs"),
        contentType: "application/json",
        data: data
    }).done(function (data) {
        $('.indoSwedenContactUs').modal('hide');
        showThankYouModal('contact-us');
        document.forms['indo-sweden-contactUs'].reset();
        $('.indo-sweden-contactUs :input').each(function () {
            if ($(this).attr('type') != 'submit') {
                $(this).siblings('label').css('display', 'block');
                $(this).siblings(".placeholder-label").removeClass('display-n');
            }
        });
    }).fail(function (error) {
        $('.indoSwedenContactUs').modal('hide');
        $('.error-modal .modal-body p').html($('.contact-us').attr('error-message'));
        $('.error-modal').modal();
    });
};

function populateContactUsSideCardData(formFields) {
    $.each(formFields, function (index, inputSel) {
        var key = $(inputSel).attr("name");
        if (typeof key != "undefined") {
            if (store.getItem(key)) {
                $(inputSel).val(store.getItem(key));
                $(inputSel).siblings(".placeholder-label").addClass('display-n');
                $(inputSel).prop('readonly', 'readonly');
            }
        }
    });
}

function showThankYouModal(className, redirectPath) {
    var $thankyouModal = $(".thankyou-modal");
    if (className === 'contact-sideCard') {
        $thankyouModal.attr('data-backdrop', 'static').attr('data-keyboard', 'false');
        $(document).on('click', '.close.forum-report-abuse', function (event) {
            location.href = redirectPath;
        });
    }
    //$thankyouModal.find('.heading').html($('.contact-us').attr('thank-you-header'));
    $thankyouModal.find('.modal-body p').html($('.' + className).attr('thank-you-content'));
    $thankyouModal.modal();
}

function showContactUsIndoSwedenModal() {
    $('indo-sweden-contactUs').modal('show');
}

var queryType = {
    "Startup India Scheme": ["Information & Benefits", "Public Procurement", "Application Status"],
    "Tax Exemptions": [],
    "IPR and Patent Support": [],
    "Incubator Support": [],
    "Funding": ["Loan", "Fund of Funds"],
    "Company Incorporation": [],
    "Learning Program": [],
    "Technical Issues on Website": [],
    "Advisory": ["Funding", "Business", "Regulatory", "Others"],
    "Others": []
};
// $(document).ready(function () {
//         $.ajax({
//         type: "GET",
//         url: "/services/tags/countries.json"
//     }).done(function (data) {
//         $.each(data, function (index, result) {
//             var options = "<option  id='" + result.id + "' value='" + result.text + "'>" + result.text + "</option>";
//             $("#indoDutchCountryList").append(options + "<br>")
//         });
//     });
// });
var indoDutchContactUsSubmission = function () {
    var data = JSON.stringify($('.contact-us').serializeObject());
    $.ajax({
        type: "POST",
        url: SIH.getEndPoint("/api/noauth/email/indo-dutch-contact-us"),
        contentType: "application/json",
        data: data
    }).done(function (data) {
        showThankYouModal('contact-us');
        document.forms['contact-us'].reset();
    }).fail(function (error) {
        $('.error-modal .modal-body p').html($('.contact-us').attr('error-message'));
        $('.error-modal').modal();
    });
};

// Linked In Social Integration

function liAuth() {
    IN.User.authorize(function () {
        onLinkedInLoad();
    });
}

function onLinkedInLoad() {
    IN.Event.on(IN, "auth", getProfileData);
}

// Use the API call wrapper to request the member's profile data
function getProfileData() {
    IN.API.Profile("me").fields("id", "first-name", "last-name", "headline", "location", "picture-url", "public-profile-url", "email-address").result(linkedInLogin).error(onError);
}

// Handle the successful return from the API call
function displayProfileData(user) {
    //var user = data.values[0];
    store.setItem('email', user.emailAddress);
    store.setItem('fullName', user.firstName + ' ' + user.lastName);
    if (!store.getItem("sihRegisteredUser")) {
        store.setItem("linkedInSocialLogin", true);
        checkForExistingUser();
    }
}

function linkedInLogin(data) {
    var user = data.values[0];
    if (user.emailAddress) {
        linkedInPostLogin(user);
    } else {
        var socialUser = {
            "id": user.id,
            "accountType": "Linkedin",
            "name": user.firstName + ' ' + user.lastName
        };
        if (!store.getItem('socialId')) {
            checkForExistingEmail(socialUser, user.id, "Linkedin", linkedInPostLogin);
        }
    }
}

function linkedInPostLogin(user) {
    if (!store.getItem("email")) {
        store.setItem('email', user.emailAddress);
        store.setItem('fullName', user.firstName + ' ' + user.lastName);
    }
    if (!store.getItem("sihRegisteredUser")) {
        store.setItem("linkedInSocialLogin", true);
        checkForExistingUser();
    }
}

// Handle an error response from the API call
function onError(error) {
    console.log(error);
}

// Destroy the session of linkedin
function linkedInlogout() {
    IN.User.logout(removeProfileData);
}

// Remove profile data from page
function removeProfileData() {
    document.getElementById('profileData').remove();
}

function checkForExistingUser(d) {
    path = SIH.getEndPoint("/api/noauth/sihLogin/auth/social");
    var socialLoginDTO = {"email": store.getItem('email'), name: store.getItem('fullName')};
    if (d) {
        socialLoginDTO = {"email": store.getItem('email'), name: store.getItem('fullName'), "token": d};
    }
    var currentPage = window.location.href;
    $.ajax({
        type: "POST",
        url: path,
        data: JSON.stringify(socialLoginDTO),
        contentType: "application/json",
        beforeSend: setAuthTokenHeader,
        success: function (data) {
            store.removeItem("international-checkbox");
            store.setItem("socialLogin", true);
            if (data['rejected']) {
                $('.profile-rejected-disabled-modal .modal-body p').html("Your profile has been rejected");
                $('.profile-rejected-disabled-modal').modal();
            } else if (data['disabled'] == false) {
                store.setItem("sihRegisteredUser", true);
                var time = new Date();
                store.setItem("loginTime", time.getTime());
                store.setItem("uid", data['uid']);
                store.setItem("uniqueId", data['uniqueId']);
                store.setItem("fullName", data['fullName']);
                store.setItem("registered", data["registered"]);
                store.setItem("email", data["mail"]);
                if (data['sms_user'] && data['sms_user']['mobileNumber']) {
                    store.setItem('phone', data['sms_user']['mobileNumber']);
                }

                store.setItem("country", data["country"]);
                store.setItem("state", data["state"]);
                if (data['registered'] == false) {
                    $('.redirect-model').modal('show');
                    store.setItem('no-profile', true);
                    var createProfile = $('.notification-container').attr('create-profile');
                    if ($.cookie("countryTag") == "sih:location/portugal") {
                        createProfile = $('.notification-container').attr('create-int-profile') + "?uid=" + data['uid'];
                    }
                    window.location = createProfile;
                } else {
                    store.setItem("token", data['token']);
                    store.setItem('published', data['published']);
                    store.setItem('role', data['role']);

                    var role = ["ServiceProvider", "Academia"];
                    if ($.cookie('countryTag') != "sih:location/india") {
                        /*if($.cookie("countryTag") === "sih:location/sweden"){
                            window.location = $('.notification-container').attr('sweden-landing-page');
                        }else{
                            window.location = $('.notification-container').attr('international-landing-page');
                        }*/
                        window.location = $('.notification-container').attr('dashboard') + "/Int" + data['role'] + ".html";
                    } else if (role.indexOf(data['role']) !== -1) {
                        store.setItem('no-dashboard', true);
                        $('.redirect-model').modal('show');
                        window.location = $('.notification-container').attr('home-page');
                    } else if (currentPage.indexOf($('.notification-container').attr('home-page')) !== -1
                        || currentPage.indexOf($('.notification-container').attr('login-page')) !== -1
                        || currentPage.indexOf($('.notification-container').attr('registration-page')) !== -1) {

                        if (window.location.hostname === $('.notification-container').attr('main-domain')) {
                            $('.redirect-model').modal('show');
                            window.location = $('.notification-container').attr('dashboard') + "/" + data['role'] + ".html";
                        } else if (getCookie("authToken") === "" || !getCookie("authToken")) {
                            $('.redirect-model').modal('show');
                            window.location = $('.notification-container').attr('dashboard') + "/" + data['role'] + ".html";
                        } else {
                            location.reload();
                        }
                    } else {
                        $.cookie("authToken", data['token'], {
                            'expires': 365,
                            'path': '/',
                            'domain': SIH.getSiteDomain()
                        });
                        $('.redirect-model').modal('show');
                        if (store.getItem('secureLinkClicked')) {
                            $.event.trigger({type: "secureApplyClick"})
                        }
                        else {
                            window.location = currentPage.split('?')[0];
                        }

                    }
                }
                $.cookie("authToken", data['token'], {
                    'expires': 365,
                    'path': '/',
                    'domain': SIH.getSiteDomain()
                });
            } else {
                $('.profile-rejected-disabled-modal .modal-body p').html("Your profile has been disabled");
                $('.profile-rejected-disabled-modal').modal();
            }
            $.cookie("loginType", 'socialLogin', {'expires': 365, 'path': '/', 'domain': SIH.getSiteDomain()});
            clearForm(".login-signup-modal #login-form");
        }, error: function (data) {
            store.removeItem("international-checkbox");
            showError(".login-tab", data);
        }
    });
}

// Gmail Social Integration
function onSignIn(googleUser) {
    if (store.getItem("gmailButtonClicked") === true) {
        var profile = googleUser.getBasicProfile();
        store.setItem('email', profile.getEmail());
        store.setItem('fullName', profile.getName());
        if (!store.getItem("sihRegisteredUser")) {
            store.setItem("gmailSocialLogin", true);
            checkForExistingUser();
        }
    }
}

function gmailButtonClicked() {
    store.setItem("gmailButtonClicked", true);
}

function renderButton() {
    gapi.signin2.render('my-signin2', {
        'scope': 'profile email',
        'width': 240,
        'height': 50,
        'longtitle': true,
        'theme': 'dark',
        'data-approvalprompt': "force",
        'onsuccess': onSignIn
    });
    gapi.signin2.render('reg-signin', {
        'scope': 'profile email',
        'width': 240,
        'height': 50,
        'longtitle': true,
        'theme': 'dark',
        'data-approvalprompt': "force",
        'onsuccess': onSignIn
    });
    gapi.signin2.render('google-signin2', {
        'scope': 'profile email',
        'width': 240,
        'height': 50,
        'longtitle': true,
        'theme': 'dark',
        'onsuccess': onSignIn
    });
    gapi.signin2.render('google-signin3', {
        'scope': 'profile email',
        'width': 240,
        'height': 50,
        'longtitle': true,
        'theme': 'dark',
        'onsuccess': onSignIn
    });
    gapi.signin2.render('google-signin4', {
        'scope': 'profile email',
        'width': 240,
        'height': 50,
        'longtitle': true,
        'theme': 'dark',
        'onsuccess': onSignIn
    });
}

function signOut() {
    try {
        if (gapi) {
            if (gapi.auth2) {
                var auth2 = gapi.auth2.getAuthInstance();
                if (auth2) {
                    auth2.signOut();
                    auth2.disconnect();
                }
            }
        }
    } catch (e) {
        console.log("Error in logging out from gmail")
    }
}

//Facebook SDK

// This is called with the results from from FB.getLoginStatus().
function statusChangeCallback(response) {
    // The response object is returned with a status field that lets the
    // app know the current login status of the person.
    // Full docs on the response object can be found in the documentation
    // for FB.getLoginStatus().
    console.log(response);
    if (response.status === 'connected') {
        console.log(response);
        // Logged into your app and Facebook.
        fetchUserInfoFromFB();
    }
}

// This function is called when someone finishes with the Login
// Button.  See the onlogin handler attached to it in the sample
// code below.
function checkLoginState() {
    FB.getLoginStatus(function (response) {
        statusChangeCallback(response);
    });
}

// Load the SDK asynchronously
(function (d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s);
    js.id = id;
    js.src = "https://connect.facebook.net/en_US/sdk.js";
    fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));

// Here we run a very simple test of the Graph API after login is
// successful.  See statusChangeCallback() for when this call is made.
function fb_login() {
    FB.login(function (response) {

        if (response.authResponse) {
            console.log('Welcome!  Fetching your information.... ');
            //console.log(response); // dump complete info
            // access_token = response.authResponse.accessToken; //get access token
            // user_id = response.authResponse.userID; //get FB UID

            fetchUserInfoFromFB();

        } else {
            //user hit cancel button
            console.log('User cancelled login or did not fully authorize.');

        }
    }, {
        scope: 'public_profile,email'
    });
}

function fetchUserInfoFromFB() {
    console.log("Fetch User Info");
    FB.api('/me?fields=name,email', function (response) {
        onFBSignIn(response);
    });
}

function onFBSignIn(fbUser) {
    if (fbUser.email) {
        fbPostLogin(fbUser);
    } else {
        var socialUser = {
            "id": fbUser.id,
            "accountType": "Facebook",
            "name": fbUser.name
        };
        checkForExistingEmail(socialUser, fbUser.id, "Facebook", fbPostLogin);
    }
}

function fbPostLogin(fbUser) {
    if (!store.getItem("email")) {
        store.setItem('email', fbUser.email);
        store.setItem('fullName', fbUser.name);
    }
    if (!store.getItem("sihRegisteredUser")) {
        store.setItem("fbSocialLogin", true);
        checkForExistingUser();
    }
}

function fbLogout() {
    FB.logout(function (response) {
        console.log(response);
    });
}

function redirectEmailVerificationPage() {
    window.location = $('.notification-container').attr('email-verification');
}

function checkForExistingEmail(socialUser, id, type, postLogin) {
    var path = SIH.getEndPoint("/api/noauth/sihUser/socialLogin/email");
    var user = {
        "socialId": id,
        "socialAccountType": type
    };
    $.ajax({
        url: path,
        type: 'POST',
        contentType: "application/json",
        data: JSON.stringify(user),
        success: function (data) {
            store.setItem("email", data.email);
            store.setItem("fullName", data.fullName);
            if (store.getItem("email")) {
                postLogin();
            } else {
                store.setItem("socialAccountType", socialUser.accountType);
                store.setItem('fullName', socialUser.name);
                store.setItem('socialId', socialUser.id);
                redirectEmailVerificationPage(socialUser);
            }
        }, error: function (data) {
            console.log("Otp generation error")
        }
    });
}

function verifyOtp(event) {
    event.preventDefault();
    if (isValid(".otp-handling .social-login-otp-form form")) {
        var path = SIH.getEndPoint("/api/noauth/sihUser/socialLogin/otp/verify");
        var email = $(".email-enter .social-login-email-form #social-login-email-id").val();
        var otp = $(".otp-handling .social-login-otp-form #social-login-email-otp").val();
        var sihSocialUser = {
            "socialId": store.getItem("socialId"),
            "socialAccountType": store.getItem("socialAccountType"),
            "email": email,
            "verificationCode": otp,
            "fullName": store.getItem("fullName")
        };
        $.ajax({
            url: path,
            type: 'POST',
            contentType: "application/json",
            data: JSON.stringify(sihSocialUser),
            success: function (data) {
                $(".otp-handling").addClass("display-n");
                $(".email-verification").removeClass("display-n");
                var user = {
                    "email": email,
                    "fullName": store.getItem("fullName")
                };
                if (store.getItem("socialAccountType") === "Facebook") {
                    setTimeout(fbPostLogin(user), 2000);
                } else if (store.getItem("socialAccountType") === "Twitter") {
                    setTimeout(twitterPostLogin(user), 2000);
                } else if (store.getItem("socialAccountType") === "Linkedin") {
                    setTimeout(linkedInPostLogin(user), 2000);
                }
                return false;
            }, error: function (data) {
                $(".otp-handling .social-login-otp-form .help-block").html(data.responseText).parent().addClass("has-error");
            }
        });
    }
}

function generateOtp(event) {
    event.preventDefault();
    if (isValid(".email-enter .social-login-email-form form")) {
        var path = SIH.getEndPoint("/api/noauth/sihUser/socialLogin/otp/generate");
        var email = $(".email-enter .social-login-email-form #social-login-email-id").val();
        var sihSocialUser = {
            "socialId": store.getItem("socialId"),
            "socialAccountType": store.getItem("socialAccountType"),
            "email": email,
            "fullName": store.getItem('fullName')
        };
        $.ajax({
            url: path,
            type: 'POST',
            contentType: "application/json",
            data: JSON.stringify(sihSocialUser),
            success: function (data) {
                store.setItem("email", email);
                $(".email-enter").addClass("display-n");
                $(".otp-handling").removeClass("display-n");
                showOtpTimer(".otp-handling");
                return false;
            }, error: function (data) {
                var msg = "";
                for (var i = 0; i < data.responseJSON.length; i++) {
                    msg = msg + data.responseJSON[i].defaultMessage + "<br/>";
                }
                $(".email-enter .social-login-email-form .help-block").html(msg).parent().addClass("has-error");
            }
        });
    }
}

$(document).ready(function () {
    $(".email-enter .social-login-email-form .email-btn").click(function (event) {
        generateOtp(event);
    });
    $(".otp-handling .social-login-otp-form .resend-btn").click(function (event) {
        generateOtp(event);
    });
    $(".otp-handling .social-login-otp-form .otp-button").click(function (event) {
        verifyOtp(event);
    })
});

var showOtpTimer = function (parent) {
    $(".resend-btn").attr("disabled", "disabled");
    var twentyFiveSeconds = 30;
    var display = $(parent + ' #time');
    startTimer(twentyFiveSeconds, display);
};

function twitter_login() {
    path = SIH.getEndPoint("/api/noauth/twitter/login");
    var callbackUrl = window.location.protocol + "//" + window.location.host + $('.notification-container').attr('home-page');
    $.ajax({
        type: "POST",
        url: path,
        data: {callbackUrl},
        contentType: "application/json",
        success: function (data) {
            console.log(data);
            store.setItem("auth_token", data['auth_token']);
            store.setItem("auth_token_secret", data['auth_token_secret']);
            window.location.href = data['authUrl'];
        }
    });
}

function twitter_callback() {
    console.log("Calling Twitter Callback...");
    path = SIH.getEndPoint("/api/noauth/twitter/callback");
    var callback_data = JSON.stringify({
        auth_token: getUrlParameter('oauth_token'),
        auth_token_secret: store.getItem('auth_token_secret'),
        oauth_verifier: getUrlParameter("oauth_verifier")
    });
    $.ajax({
        type: "POST",
        url: path,
        data: callback_data,
        contentType: "application/json",
        success: function (data) {
            onTwitterSignIn(data);
        }, error: function (error) {
            console.error(error.responseText)
        }
    });
}

$(document).ready(function () {
    var currentPage = window.location.href;
    if (currentPage.indexOf('oauth_token') > -1 && currentPage.indexOf('oauth_verifier') > -1) {
        twitter_callback();
    }

    if (currentPage.indexOf('sih_auth_token') > -1 && currentPage.indexOf('login_type') > -1) {
        appAutoLogin(getUrlParameter("sih_auth_token"), getUrlParameter("login_type"));
    }
});

function onTwitterSignIn(twitterUser) {
    if (twitterUser.email) {
        twitterPostLogin(twitterUser);
    } else {
        var socialUser = {
            "id": twitterUser.id,
            "accountType": "Twitter",
            "name": twitterUser.name
        };
        checkForExistingEmail(socialUser, twitterUser.id, "Twitter", twitterPostLogin);
    }
}

function twitterPostLogin(twitterUser) {
    if (!store.getItem("email")) {
        store.setItem('email', twitterUser.email);
        store.setItem('fullName', twitterUser.name);
    }
    if (!store.getItem("sihRegisteredUser")) {
        store.setItem("twitterSocialLogin", true);
        checkForExistingUser();
    }
}

function twitterLogout() {
    store.setItem("auth_token", undefined);
    store.setItem("auth_token_secret", undefined);
}

var headerLoginCaptchaId, loginPageCaptchaId, contactPageCaptchaId, indoCaptchaId, logoFormCaptchaId;
var headerCaptchaOnloadCallback = function() {
    //console.log("top-header g-recaptcha is ready");
    var siteKey = $("#header-login-captcha").data("sitekey");
    headerLoginCaptchaId = grecaptcha.render('header-login-captcha', {
        'sitekey' : $("#header-login-captcha").data("sitekey"),
        'callback': filledCaptchaCallback
    });
};
var loginPageCaptchaOnloadCallback = function() {
    console.log("login page g-recaptcha is ready");
    loginPageCaptchaId = grecaptcha.render('main-login-captcha', {
        'sitekey' : $("#main-login-captcha").data("sitekey"),
        'callback': filledCaptchaCallback
    });
};
var contactCaptchaOnloadCallback = function() {
    console.log("contact page g-recaptcha is ready");
    contactPageCaptchaId = grecaptcha.render('contact-captcha', {
        'sitekey' : $("#contact-captcha").data("sitekey"),
        'callback': filledCaptchaCallback
    });
};
var indoContactCaptchaOnloadCallback = function() {
    console.log("indo contact page g-recaptcha is ready");
    indoCaptchaId = grecaptcha.render('indoContact-captcha', {
        'sitekey' : $("#indoContact-captcha").data("sitekey"),
        'callback': filledCaptchaCallback
    });
};
var logoFormCaptchaOnloadCallback = function() {
    console.log("logo page g-recaptcha is ready");
    logoFormCaptchaId = grecaptcha.render('logoForm-captcha', {
        'sitekey' : $("#logoForm-captcha").data("sitekey"),
        'callback': filledCaptchaCallback
    });
};
var filledCaptchaCallback = function() {
    $(".g-recaptcha .help-block").remove();
};

var store = ContextHub.getStore("sih_user"); var loginTime;
var countryMap = {
    "en" : "sih:location/india",
    "pt" : "sih:location/portugal"
};
var urlparts = window.location.pathname.split('/');
var urlCountryId = "en";
$.each( countryMap, function( key, value ) {
    if($.inArray(key, urlparts) != -1)
        urlCountryId = urlparts[$.inArray(key, urlparts)];
});
$.cookie("countryTag", (store.getItem('country') === 'Sweden') ? "sih:location/sweden" : countryMap[urlCountryId]);
//$.cookie("countryTag", countryMap[urlCountryId]);

$(document).on('click',"div.blog, div.card", function (e) {
    var $anchorTag = $(this).find("a.secure");
    if($anchorTag.length > 0 && $anchorTag.attr('href')){
        secureLinksClicked($anchorTag.attr('href'));
    }
});

$(document).on('click',"a.secure,.secure",function(e) {
    e.preventDefault();
    e.stopPropagation();
    var link = $(this).attr('href');
    if(!link){
        link = window.location.href;
    }
    var tar = $(this).attr('target');
    secureLinksClicked(link,tar,$(this));
});

function secureLinksClicked(link,tar,obj) {
    if(store.getItem("token")) {
        $(document).off('secureApplyClick');
        store.removeItem("secureLinkClicked");
        if(link && link.indexOf('/content/dam/invest-india') >= 0) {
            authenticateToken(link);
        }
        else if(link && (link.indexOf('/content/sih/en/reources') >= 0 || link.indexOf('/content/sih/en/resource-partners') >= 0)){
            authenticateToken(link);
        }
        else
        {
            if(!link){
                window.location.reload();
            } else if(tar === '_blank') {
                window.open(link, '_blank');
                window.location.reload();
            }
            else{
                window.location.href = link;
            }

        }
    }
    else {
        if(store.getItem("no-profile")){
            $('.complete-profile-modal').modal('show');
        }else{
            store.setItem('secureLinkClicked',"true");
            $(document).on('secureApplyClick',function(){
                $(obj).trigger('click');
            });
            $(".login .sign-in").trigger('click');
        }
        //$('#secureAssests').modal('show');

    }
}

function checkUserProfileExists() {
    if(store.getItem("no-profile")){
        $('.complete-profile-modal').modal('show');
    }else{
        $(".login .sign-in").trigger('click');
    }
}

$(document).ready(function () {
    showHideMenu();

    if(store.getItem("uid") || store.getItem("sihRegisteredUser")){
        $(".logout-user").hide()
    }
    ////signin-signup

    var _signIn = $('.sign-in').attr('href');
    $('.sign-in').attr('href', _signIn + location.protocol + '//' + location.host + location.pathname);

    var registerUrl = $('.register').attr('href');
    $('.register').attr('href', registerUrl + location.protocol + '//' + location.host + location.pathname);

    var currentPage = window.location.href;
    if (currentPage.indexOf('code') > -1) {
        var code = getUrlParameter('code');
        var redirectUrl = SIH.getEndPoint($('.notification-container').attr('profile-detail-Url') + code);
        $.getJSON(redirectUrl, function (data) {
            store.removeItem("international-checkbox");
            if(data['rejected']){
                $('.profile-rejected-disabled-modal .modal-body p').html("Your profile has been rejected");
                $('.profile-rejected-disabled-modal').modal();

            }else if (data['disabled'] == false) {
                var time = new Date();
                store.setItem("loginTime", time.getTime());
                store.setItem("uid", data['uid']);
                store.setItem("uniqueId", data['uniqueId']);
                store.setItem("fullName", data['fullName']);
                store.setItem("email", data['mail']);
                store.setItem("myGovLogin",true);
                if (data['sms_user'] && data['sms_user']['mobileNumber']) {
                    store.setItem('phone', data['sms_user']['mobileNumber']);
                }
                store.setItem("country", data["country"]);
                store.setItem("state", data["state"]);

                $.cookie("userCountry", $.cookie("countryTag"), {'expires': 365, 'path': '/'});

                if (data['registered'] == false) {
                    $('.redirect-model').modal('show');
                    store.setItem('no-profile', true);
                    var createProfile = $('.notification-container').attr('create-profile') + "?uid=" + data['uid'];
                    if ($.cookie("countryTag") != "sih:location/india") {
                        createProfile = $('.notification-container').attr('create-int-profile') + "?uid=" + data['uid'];
                    }
                    window.location = createProfile;
                } else {
                    store.setItem("token", data['token']);
                    store.setItem('published', data['published']);
                    store.setItem('role', data['role']);
                    var role = ["ServiceProvider", "Academia"];
                    /*if ($.cookie('countryTag') === "sih:location/portugal") {
                     window.location = $('.notification-container').attr('international-landing-page');
                     } else if ($.cookie('countryTag') === "sih:location/sweden") {
                     window.location = $('.notification-container').attr('sweden-landing-page');
                     } else */if (role.indexOf(data['role']) !== -1) {
                        store.setItem('no-dashboard', true);
                        $('.redirect-model').modal('show');
                        window.location = $('.notification-container').attr('home-page');
                    } else if (currentPage.indexOf($('.notification-container').attr('home-page'))) {
                        if(window.location.hostname === $('.notification-container').attr('main-domain')){
                            dashboardPageRedirection(data);
                        }else if(getCookie("authToken") === "" || !getCookie("authToken")){
                            dashboardPageRedirection(data);
                        }else{
                            location.reload();
                        }
                    } else {
                        $('.redirect-model').modal('show');
                        window.location = currentPage.split('?')[0];
                    }
                }
                $.cookie("authToken", data['token'], {
                    'expires': 365,
                    'path': '/',
                    'domain': SIH.getSiteDomain()
                });
            } else {
                $('.profile-rejected-disabled-modal .modal-body p').html("Your profile has been disabled");
                $('.profile-rejected-disabled-modal').modal();

            }
        }, function (error) {
            store.removeItem("international-checkbox");
        });
    }


    if(currentPage.indexOf("en/login.html") > -1 || currentPage.indexOf("en/register.html") > -1){
        var loginLink = $('.login-container #myGovLogin');
        var _signIn = $(loginLink).attr('link');
        $(loginLink).attr('href', _signIn + location.protocol + '//' + location.host + location.pathname);

        if(store.getItem("token")) {
            var role = ["ServiceProvider", "Academia"];
            if (role.indexOf(store.getItem('role')) !== -1) {
                $('.redirect-model').modal('show');
                window.location = $('.notification-container').attr('home-page');
            } else {
                $('.redirect-model').modal('show');
                if (store.getItem('country') === "sih:location/india") {
                    window.location = $('.notification-container').attr('dashboard') + "/" + store.getItem('role') + ".html";
                } else {
                    window.location = $('.notification-container').attr('dashboard') + "/Int-" + store.getItem('role') + ".html";
                }
            }
        }
    }

    $('.error-modal').on('hidden.bs.modal', function () {
        removeQueryParam();
    });
    $('.profile-rejected-disabled-modal').on('hidden.bs.modal', function () {
        logout();
    });

    $(".login-signup-modal #login-form #sih-login-btn, .login-container #login-form #sih-login-btn").click(function (e) {
        cleanError(".login-tab");
        $("#resendMsg").hide();
        e.preventDefault();
        var currentContainer = $(".login-signup-modal").is(":visible") ? $(".login-signup-modal") : $(".login-container");
        var recaptchaContainerId = $(".login-signup-modal").is(":visible") ? headerLoginCaptchaId : loginPageCaptchaId;
        var form = currentContainer.find("#login-form");

        if(window.location.origin.indexOf("www.startupindia.gov.in") > -1) {
            if (validateCaptcha(form, recaptchaContainerId)) {
                if (isValid(form)) {
                    var username = form.find("#username_login").val();
                    var password = form.find("#password_login").val();
                    var captchaResponse = grecaptcha.getResponse(recaptchaContainerId);
                    var d = {
                        "username": username, "password": password, "grantType": "PASSWORD",
                        "captchaResponse": captchaResponse
                    };
                    sihLogin(d, form);
                } else {
                    console.warn("Validation failed")
                }
            }
        }else{
            if (isValid(form)) {
                var username = form.find("#username_login").val();
                var password = form.find("#password_login").val();
                var captchaResponse = null;
                var d = {
                    "username": username, "password": password, "grantType": "PASSWORD",
                    "captchaResponse": captchaResponse
                };
                sihLogin(d, form);
            } else {
                console.warn("Validation failed")
            }
        }
    });

    $(".login .sign-in").click(function (e) {
        var loginLink = $('.login-signup-modal .login-form #myGovLogin');
        var _signIn = $(loginLink).attr('link');
        $(loginLink).attr('href', _signIn + location.protocol + '//' + location.host + location.pathname);

        var regLink = $('.login-signup-modal .login-form #myGovReg');
        var registerUrl = $(regLink).attr('link');
        $(regLink).attr('href', registerUrl + location.protocol + '//' + location.host + location.pathname);
        showDefaultForm();
        $('#login-modal').modal('show');
        e.preventDefault();
    });

    $(".new-register-page .login-btn button:not('.submit-btn')").on('click', function (event) {
        cleanError(".registration-tab");
        $("#resendMsg").hide();
        event.preventDefault();
        var currentContainer =$(".new-register-page");
        var form = currentContainer.find(".register-form form");
        if (isValid($(form))) {
            var fullname = form.find("#fullname").val();
            var email = form.find("#email").val();
            var mobile = form.find("#mobile").val();
            var regpassword = form.find("#reg-password").val();
            var confirmPassword = form.find("#confirm-password").val();
            var d = {
                "fullName": fullname,
                "email": email,
                "mobile": mobile,
                "password": regpassword,
                "confirmPassword": confirmPassword
            };

            $.ajax({
                url: SIH.getEndPoint("/api/noauth/sihUser/register"),
                type: 'POST',
                contentType: "application/json",


                data: JSON.stringify(d),
                success: function (data) {
                    var regOtpForm = $(".new-register-page .registration-otp-form");
                    regOtpForm.find("#email").val(data.email);
                    hideRegistrationForm();
                    showRegistrationOTPForm();
                    clearForm(form);
                }, error: function (data) {
                    showError(".registration-tab", data);
                }
            });
        } else {
            console.warn("Validation failed")

        }
    });

//registration verify call
    $(".new-register-page .registration-otp-form .submit-btn").click(function (event) {
        cleanError(".registration-tab");
        event.preventDefault();
        var currentContainer = $(".new-register-page");
        var form = currentContainer.find(".registration-otp-form form");
        if (isValid(form)) {
            var code = form.find("#otp").val();
            var email = form.find("#email").val();
            var d = {"email": email, "code": code};

            $.ajax({
                url: SIH.getEndPoint("/api/noauth/sihUser/verify"),
                type: 'POST',
                contentType: "application/json",
                data: JSON.stringify(d),
                success: function (data) {
                    if(data.status){
                        $("#resendMsg").hide();
                        hideRegistrationOTPForm();
                        showRegistrationSuccess();
                        clearForm(form);
                        var axel = Math.random() + "";
                        var a = axel * 10000000000000;
                        var iframe = document.createElement('iframe');
                        iframe.frameBorder=0;
                        iframe.width="1";
                        iframe.height="1";
                        iframe.setAttribute("src", 'https://8254596.fls.doubleclick.net/activityi;src=8254596;type=invmedia;cat=fagcfhoh;dc_lat=;dc_rdid=;tag_for_child_directed_treatment=;ord='+a+'?');
                        document.head.appendChild(iframe);
                        cleanError(".registration-tab");
                    }
                    else{
                        showError(".registration-tab", data.message);
                    }

                }, error: function (data) {
                    showError(".registration-tab", data);
                }
            });
        } else {
            console.warn("Validation failed")
        }
    });

//registration resend otp button
    $(".new-register-page .registration-otp-form .resend-btn").on("click", function (event) {
        cleanError(".registration-tab");
        $("#resendMsg").hide();
        event.preventDefault();
        var currentContainer = $(".new-register-page");
        var form = currentContainer.find(".registration-otp-form");
        var email = form.find("#email").val();
        var d = {"email": email};
        $.ajax({
            url: SIH.getEndPoint("/api/noauth/sihUser/otp/generate"),
            type: 'POST',
            contentType: "application/json",
            data: JSON.stringify(d),
            success: function (data) {
                var successMsg = "otp.generate.success";
                if(data === successMsg){
                    $("#resendMsg").show().find(".message").html("OTP Sent Successfully").show();
                    $("#resendMsg").fadeTo(2000, 500).slideUp(500, function(){
                        $("#resendMsg").slideUp(500);
                    });
                }
                showTimer(".new-register-page .registration-otp-form");
            }, error: function (data) {
                $("#resendMsg").hide();
                showError(".registration-tab", data);
            }
        });
    });

//forgot password call
    $(".login-signup-modal .forgot-pwd-form .submit-btn, .forgot-pwd-container .forgot-pwd-form .submit-btn").click(function (event) {
        cleanError(".login-tab");
        event.preventDefault();
        var currentContainer = $(".login-signup-modal").is(":visible") ? $(".login-signup-modal") : $(".forgot-pwd-container");
        var form = currentContainer.find(".forgot-pwd-form");
        if (isValid(form.find("form"))) {
            var email = form.find("form #email").val();
            var d = {"email": email};

            $.ajax({
                url: SIH.getEndPoint("/api/noauth/sihUser/password/forgot"),
                type: 'POST',
                contentType: "application/json",
                data: JSON.stringify(d),
                success: function (data) {
                    var forgotPwdForm = $(".login-signup-modal").is(":visible") ? $(".login-signup-modal .forgot-pwd-otp-form") : $(".otp-form-container .forgot-pwd-otp-form");
                    forgotPwdForm.find("#email").val(email);
                    hideForgotPasswordForm();
                    showForgotPasswordOTPForm();
                    clearForm(form);
                }, error: function (data,txt_status,xhr) {
                    if(data.status === 200){
                        var forgotPwdForm = $(".login-signup-modal").is(":visible") ? $(".login-signup-modal .forgot-pwd-otp-form") : $(".otp-form-container .forgot-pwd-otp-form");
                        forgotPwdForm.find("#email").val(email);
                        hideForgotPasswordForm();
                        showForgotPasswordOTPForm();
                        clearForm(form);
                        showError(".login-tab", data);
                    }else {
                        showError(".login-tab", data);
                    }
                }
            });
        } else {
            console.warn("Validation failed")
        }
    });

//verify forgot password otp
    $(".login-signup-modal .forgot-pwd-otp-form .submit-btn, .otp-form-container .forgot-pwd-otp-form .submit-btn").click(function (event) {
        cleanError(".login-tab");
        event.preventDefault();
        var currentContainer = $(".login-signup-modal").is(":visible") ? $(".login-signup-modal") : $(".otp-form-container");
        var form = currentContainer.find(".forgot-pwd-otp-form form");
        if (isValid(form)) {
            var code = form.find("#otp").val();
            var email = form.find("#email").val();
            var d = {"email": email, "code": code};

            $.ajax({
                url: SIH.getEndPoint("/api/noauth/sihUser/otp/verify"),
                type: 'POST',
                contentType: "application/json",
                data: JSON.stringify(d),
                success: function (data) {
                    if(data.status){
                        var chgPwdForm = $(".login-signup-modal").is(":visible") ? $(".login-signup-modal .change-pwd-form") : $(".change-pwd-container .change-pwd-form");
                        chgPwdForm.find("#email").val(email);
                        chgPwdForm.find("#otp").val(code);
                        hideForgotPasswordOTPForm();
                        showChangePasswordForm();
                        clearForm(form);
                    }
                    else{
                        showError(".login-tab", data.message);
                    }

                }, error: function (data) {
                    showError(".login-tab", data);
                }
            });
        } else {
            console.warn("Validation failed")
        }
    });

//change password otp
    $(".login-signup-modal .change-pwd-form .submit-btn, .change-pwd-container .change-pwd-form .submit-btn").click(function (event) {
        cleanError(".login-tab");
        event.preventDefault();
        var currentContainer = $(".login-signup-modal").is(":visible") ? $(".login-signup-modal") : $(".change-pwd-container");
        var form = currentContainer.find(".change-pwd-form form");
        if (isValid(form)) {
            var code = form.find("#otp").val();
            var email = form.find("#email").val();
            var regpassword = form.find("#reg-password").val();
            var confirmPassword = form.find("#confirm-password").val();
            var d = {"email": email, "code": code, "password": regpassword, "confirmPassword": confirmPassword};

            $.ajax({
                url: SIH.getEndPoint("/api/noauth/sihUser/password/update"),
                type: 'POST',
                contentType: "application/json",
                data: JSON.stringify(d),
                success: function (data) {
                    hideChangePasswordForm();
                    showChangePasswordSuccess();
                    clearForm(form);
                }, error: function (data) {
                    showError(".login-tab", data);
                }
            });
        } else {
            console.warn("Validation failed")
        }
    });

//forgot pwd resend otp btn
    $(".login-signup-modal .forgot-pwd-otp-form .resend-btn, .otp-form-container .forgot-pwd-otp-form .resend-btn").on("click", function (event) {
        cleanError(".login-tab");
        event.preventDefault();
        var currentContainer = $(".login-signup-modal").is(":visible") ? $(".login-signup-modal") : $(".otp-form-container");
        var form = currentContainer.find(".forgot-pwd-otp-form");
        var email = form.find("#email").val();
        var d = {"email": email};
        $.ajax({
            url: SIH.getEndPoint("/api/noauth/sihUser/otp/generate"),
            type: 'POST',
            contentType: "application/json",
            data: JSON.stringify(d),
            success: function (data) {
                showTimer(".login-signup-modal .forgot-pwd-otp-form, .otp-form-container");
            }, error: function (data) {
                showError(".login-tab", data);
            }
        });
    });


    $(".login-signup-modal .static-tabs ul li").click(function (e) {
        cleanError("#loginModal");
        $(this).addClass("active");
        if ($(this).attr("data-tab") == "login-tab-1") {
            $("li[data-tab=login-tab-2]").removeClass("active");
            $(".login-signup-modal div #login-tab-1").addClass("current");
            $(".login-signup-modal div #login-tab-2").removeClass("current");
        } else {
            $("li[data-tab=login-tab-1]").removeClass("active");
            $(".login-signup-modal div #login-tab-2").addClass("current");
            $(".login-signup-modal div #login-tab-1").removeClass("current");
        }
    });
});

function myGovLogin(d) {
    $.ajax({
        url: SIH.getEndPoint("/api/noauth/sihLogin/auth/myGov"),
        type: 'POST',
        contentType: "application/json",
        data: JSON.stringify(d),
        success: function (data) {
            loginSuccessFunction(data);
        }, error: function (data) {
            store.removeItem("international-checkbox");
            showError(".login-tab", data);
        }
    })
}
function logoRedirectionUrl() {
    var role = ["ServiceProvider", "Academia"];
    var loggedInUserRole = store.getItem("role");
    var country = store.getItem("country");
    /*if(loggedInUserRole != null) {
        if (role.indexOf(loggedInUserRole) !== -1) {
            $(".logo").data('page') != 'persona' ? $(".logo").attr("href", $('.notification-container').attr('home-page')) : $(".logo").removeAttr('href');
        }
        else if ((country && ((country === "India") || (country === "sih:location/india")) || (store.getItem('role') === "SIH_Admin"))) {
            $(".logo").attr("href", $('.notification-container').attr('dashboard') + "/" + loggedInUserRole + ".html");
        } else {
            $(".logo").attr("href", $('.notification-container').attr('dashboard') + "/Int-" + loggedInUserRole + ".html");
        }
    } else {
        $(".logo").data('page') != 'persona' ? $(".logo").attr("href", $('.notification-container').attr('home-page')) : $(".logo").removeAttr('href');
    }*/
    /*if($.cookie("countryTag) === "sih:location/sweden"){
        $(".logo").attr("href", $('.notification-container').attr('sweden-landing-page'));
    }*/
    //Redirecting to home page only
    $(".logo").data('page') != 'persona' ? $(".logo").attr("href", $('.notification-container').attr('home-page')) : $(".logo").removeAttr('href');
}

function authenticateToken(link){
    var token = store.getItem("token") ? store.getItem("token") : $.cookie("authToken");
    $.ajax({
        url: link,
        type: 'GET',
        data: {token: token},
        success: function (data,textStatus,jqXHR) {
            if (link.indexOf('/startupindiaPDF') >= 0) {
                PDFObject.embed(link, "#PDFViewer");
                $('#InlinePDFViewer').modal('show');
            }
            else if (link.indexOf('/content/sih/en') >= 0) {
                window.location.href = link;
            }
            else window.open(link, '_blank');
        },error: function(data){
            // $("#loginModal").modal('show');
            if (store.getItem("no-profile")) {
                $('.complete-profile-modal').modal('show');
                e.preventDefault();
                e.stopPropagation();
            }
            else if (!store.getItem("published") && store.getItem("token")) {
                $('.under-moderation-modal').modal('show');
                e.preventDefault();
                e.stopPropagation();
            }
            else {
                //$('#secureAssests').modal('show');
                $(".login .sign-in").trigger('click');
            }
        }
    });
}

var removeQueryParam =function () {
    var currentPage = window.location.href;
    currentPage = currentPage.substring(0,currentPage.indexOf("?"));
    window.location = currentPage;
};

function showHideMenu() {
    logoRedirectionUrl();
    if (store.getItem("uid") || store.getItem("sihRegisteredUser")) {
        $('.login').hide();
        $('.inner-layout').addClass("logged-in-layout");
        $('.mid-header-wrap').addClass("logged-in-home-topnav");
        $('.notification-container').show();
        // $('.pull-right.top-nav-header').addClass("header-after-login");
        // var currentTime = new Date();
        /*  if (store.getItem("loginTime")) {
              $(this).mousemove(function (e) {
                  store.setItem("idleTimer", currentTime.getTime());
              });
              var diff = Math.abs(currentTime.getTime() - store.getItem("loginTime"));
              if (store.getItem("idleTimer")) {
                  var idleDiff = Math.abs(currentTime.getTime() - store.getItem("idleTimer"));
                  if (Math.ceil(idleDiff / 3600000) > 3) {
                      alert("Session is expired. Please Login again.");
                      store.removeItem("idleTimer");
                      logout();
                  }
              }
              if (Math.ceil(diff / 3600000) > 8) {
                  alert("Session is expired. Please Login again.");
                  logout();
              }
          } else {
              logout();
          }*/
    } else {
        var currentPage = window.location.href;
        if (!(currentPage.indexOf('code') > -1)) {
            $('.login').show();
        }
        $('.inner-layout').removeClass("logged-in-layout");
        $('.mid-header-wrap').removeClass("logged-in-home-topnav");
        //$('.pull-right.top-nav-header').removeClass("header-after-login");
        $('.notification-container').hide();
    }

}

function showLogoutModal() {
    $('#logout-modal').modal('show');
}

function logout(param) {
    var uniqueId = store ? store.getItem("uniqueId") : null;
    $.ajax({
        url: SIH.getEndPoint("/api/noauth/sihLogin/logout"),
        type: 'GET',
        contentType: "application/json",
        data: {userId: uniqueId},
        beforeSend: setAuthTokenHeader,
        complete: function () {
            if(store.getItem("socialLogin") && store.getItem("gmailSocialLogin")){
                signOut();
            }
            if(store.getItem("socialLogin") && store.getItem("linkedInSocialLogin")){
                linkedInlogout();
            }
            if(store.getItem("socialLogin") && store.getItem("fbSocialLogin")){
                fbLogout();
            }
            if(store.getItem("socialLogin") && store.getItem("twitterSocialLogin")){
                twitterLogout();
            }
            if(param){
                if ($(param).attr('button-type') == 'yes') {
                    store.clean();
                    sessionStorage.clear();
                    window.localStorage.removeItem("inforparent");
                    $.removeCookie("userCountry", {'expires': -1, path: '/'});
                    $.removeCookie("authToken", {'expires': -1, path: '/', 'domain': SIH.getSiteDomain()});
                    var path = "https://auth.mygov.in/user/logout";
                    if ($('.logout-url').attr('logout-url')) {
                        path = $('.logout-url').attr('logout-url');
                    }
                    window.open(path, 'logoutframe');
                    setTimeout(redirectHomePage,1000);
                }
            }else{
                store.clean();
                sessionStorage.clear();
                window.localStorage.removeItem("inforparent");
                $.removeCookie("userCountry", {'expires': -1, path: '/'});
                $.removeCookie("authToken", {'expires': -1, path: '/', 'domain': SIH.getSiteDomain()});
                redirectHomePage();
            }
        }
    });
}

function redirectHomePage(){
    window.location = $('.notification-container').attr('home-page');
}

$(document).on('click', '#logout-modal .logout-button', function (e) {
    logout(this);
});

var getUrlParameter = function getUrlParameter(sParam,path) {
    var url = "";
    if(path){
        url = path;
    }else{
        url = window.location.search.substring(1);
    }
    var sPageURL = decodeURIComponent(url);
    if (sPageURL) {
        var sURLVariables = sPageURL.split('&'),
            sParameterName,
            i;
        for (i = 0; i < sURLVariables.length; i++) {
            sParameterName = sURLVariables[i].split('=');
            if (sParameterName[0] === sParam) {
                return sParameterName[1] === undefined ? true : sParameterName[1];
            }
        }
    }
};



$(".login .sign-in").click(function (e) {
    var loginLink = $('.login-signup-modal .login-form #myGovLogin');
    var _signIn = $(loginLink).attr('link');
    $(loginLink).attr('href', _signIn + location.protocol + '//' + location.host + location.pathname);

    var regLink = $('.login-signup-modal .login-form #myGovReg');
    var registerUrl = $(regLink).attr('link');
    $(regLink).attr('href', registerUrl + location.protocol + '//' + location.host + location.pathname);
    showDefaultForm();
    $('#login-modal').modal('show');
    e.preventDefault();
});

function showDefaultForm(){
    //login tab
    $(".login-signup-modal .login-tab .forgot-pwd-form").hide();
    $(".login-signup-modal .login-tab .forgot-pwd-otp-form").hide();
    $(".login-signup-modal .login-tab .change-pwd-form").hide();
    $(".login-signup-modal .login-tab .success-registeration").hide();
    $(".login-signup-modal .login-tab .default").show();

    //registration tab
    /*$(".login-signup-modal .registration-tab .registration-otp-form").hide();
    $(".login-signup-modal .registration-tab .success-registeration").hide();
    $(".login-signup-modal .registration-tab .default").show();*/

}

/*
 $(".register").click(function (e) {
 $('#registration-modal').modal('show');
 e.preventDefault();
 });
 */

function sihLogin(d, form) {
    $.ajax({
        url: SIH.getEndPoint("/api/noauth/sihLogin/auth"),
        type: 'POST',
        contentType: "application/json",
        data: JSON.stringify(d),
        success: function (data) {

            fbq('track', 'SubmitApplication');

            loginSuccessFunction(data);
            $.cookie("loginType", 'sihLogin', {'expires': 365, 'path': '/', 'domain': SIH.getSiteDomain()});
            if(form){
                clearForm(form);
            }
        }, error: function (data) {
            store.removeItem("international-checkbox");
            if(window.location.origin.indexOf("www.startupindia.gov.in") > -1) {
                grecaptcha.reset();
            }
            $(".g-recaptcha .help-block").remove();
            showError(".login-tab", data);
        }
    });
}

function loginSuccessFunction(data){
    var currentPage = window.location.href;
    store.removeItem("international-checkbox");
    if (data['rejected']) {
        $('#loginModal').hide();
        $('.profile-rejected-disabled-modal .modal-body p').html("Your profile has been rejected");
        $('.profile-rejected-disabled-modal').modal();
    } else if (data['disabled'] == false) {
        $.cookie("authToken", data['token'], {
            'expires': 365,
            'path': '/',
            'domain': SIH.getSiteDomain()
        });
        store.setItem("sihRegisteredUser", true);
        var time = new Date();
        store.setItem("loginTime", time.getTime());
        store.setItem("uid", data['uid']);
        store.setItem("uniqueId", data['uniqueId']);
        store.setItem("fullName", data['fullName']);
        store.setItem("registered", data["registered"]);
        store.setItem("email", data["mail"]);
        if (data['sms_user'] && data['sms_user']['mobileNumber']) {
            store.setItem('phone', data['sms_user']['mobileNumber']);
        }
        store.setItem("country", data["country"]);
        store.setItem("state", data["state"]);
        store.setItem("city", data["city"]);
        store.setItem("startupName", data["city"]);
        if(data['role'] === 'SIH_Admin'){
            store.setItem("country", "sih:location/india");
        }
        if (data['registered'] == false) {
            $('.redirect-model').modal('show');
            store.setItem('no-profile', true);
            var createProfile = $('.notification-container').attr('create-profile');
            if ($.cookie("countryTag") == "sih:location/portugal") {
                createProfile = $('.notification-container').attr('create-int-profile') + "?uid=" + data['uid'];
            }
            window.location = createProfile;
        } else {
            store.setItem("token", data['token']);
            store.setItem("expiresAt", data['expiresAt']);
            store.setItem("refreshToken", data['refreshToken']);
            store.setItem('published', data['published']);
            store.setItem('role', data['role']);

            var role = ["ServiceProvider", "Academia"];
            /*if ($.cookie('countryTag') != "sih:location/india") {s
             if($.cookie("countryTag") === "sih:location/sweden"){
             window.location = $('.notification-container').attr('sweden-landing-page');
             }else{
             window.location = $('.notification-container').attr('international-landing-page');
             }
             } else*/
            if (role.indexOf(data['role']) !== -1) {
                store.setItem('no-dashboard', true);
                $('.redirect-model').modal('show');
                window.location = $('.notification-container').attr('home-page');
            } else if (currentPage.indexOf($('.notification-container').attr('home-page')) !== -1
                || currentPage.indexOf($('.notification-container').attr('login-page')) !== -1
                || currentPage.indexOf($('.notification-container').attr('registration-page')) !== -1) {

                if(window.location.hostname === $('.notification-container').attr('main-domain')){
                    dashboardPageRedirection(data);
                }else if(getCookie("authToken") === "" || !getCookie("authToken")){
                    dashboardPageRedirection(data);
                }else{
                    location.reload();
                }

                //window.location = $('.notification-container').attr('dashboard') + "/" + data['role'] + ".html";
            } else {
                $.cookie("authToken", data['token'], {
                    'expires': 365,
                    'path': '/',
                    'domain': SIH.getSiteDomain()
                });
                $('.redirect-model').modal('show');
                if(store.getItem('secureLinkClicked')){
                    $.event.trigger({type:"secureApplyClick"})
                }else {
                    window.location = currentPage;
                }
            }
        }

    } else {
        $('#loginModal').hide();
        $('.profile-rejected-disabled-modal .modal-body p').html("Your profile has been disabled");
        $('.profile-rejected-disabled-modal').modal();
    }
}

var showRegistrationOTPForm = function () {
    $(".new-register-page .registration-otp-form").show();
    showTimer(".new-register-page .registration-otp-form");
};

var hideRegistrationOTPForm = function () {
    $(".new-register-page .registration-otp-form").hide()
};

var showForgotPasswordOTPForm = function () {
    $(".login-signup-modal .forgot-pwd-otp-form, .otp-form-container").show();
    showTimer(".login-signup-modal .forgot-pwd-otp-form, .otp-form-container");
};

var hideForgotPasswordOTPForm = function () {
    $(".login-signup-modal .forgot-pwd-otp-form, .otp-form-container").hide()
};

var hideRegistrationForm = function () {
    $(".new-register-page .register-form").hide();
};

var showRegistrationSuccess = function () {
    $(".new-register-page .registration-tab .success-registeration, .success-container").show();
};

var showChangePasswordSuccess = function () {
    $(".login-signup-modal .login-tab .success-registeration, .success-container").show();
};

var showForgotPasswordForm = function () {
    $(".login-signup-modal .forgot-pwd-form, .forgot-pwd-container").show();
};

var hideForgotPasswordForm = function () {
    $(".login-signup-modal .forgot-pwd-form, .forgot-pwd-container").hide();
};

var showChangePasswordForm = function () {
    $(".login-signup-modal .change-pwd-form, .change-pwd-container").show();
};

var hideChangePasswordForm = function () {
    $(".login-signup-modal .change-pwd-form, .change-pwd-container").hide();
};

//forgot password call
$(".login-signup-modal .forgot-pwd-form .submit-btn, .forgot-pwd-container .forgot-pwd-form .submit-btn").click(function (event) {
    cleanError(".login-tab");
    event.preventDefault();
    var currentContainer = $(".login-signup-modal").is(":visible") ? $(".login-signup-modal") : $(".forgot-pwd-container");
    var form = currentContainer.find(".forgot-pwd-form");
    if (isValid(form.find("form"))) {
        var email = form.find("form #email").val();
        var d = {"email": email};

        $.ajax({
            url: SIH.getEndPoint("/api/noauth/sihUser/password/forgot"),
            type: 'POST',
            contentType: "application/json",
            data: JSON.stringify(d),
            success: function (data) {
                var forgotPwdForm = $(".login-signup-modal").is(":visible") ? $(".login-signup-modal .forgot-pwd-otp-form") : $(".otp-form-container .forgot-pwd-otp-form");
                forgotPwdForm.find("#email").val(email);
                hideForgotPasswordForm();
                showForgotPasswordOTPForm();
                clearForm(form);
            }, error: function (data,txt_status,xhr) {
                if(data.status === 500){
                    var forgotPwdForm = $(".login-signup-modal").is(":visible") ? $(".login-signup-modal .forgot-pwd-otp-form") : $(".otp-form-container .forgot-pwd-otp-form");
                    forgotPwdForm.find("#email").val(email);
                    hideForgotPasswordForm();
                    showForgotPasswordOTPForm();
                    clearForm(form);
                    showError(".login-tab", data);
                }else {
                    showError(".login-tab", data);
                }
            }
        });
    } else {
        console.warn("Validation failed")
    }
});

//verify forgot password otp
$(".login-signup-modal .forgot-pwd-otp-form .submit-btn, .otp-form-container .forgot-pwd-otp-form .submit-btn").click(function (event) {
    cleanError(".login-tab");
    event.preventDefault();
    var currentContainer = $(".login-signup-modal").is(":visible") ? $(".login-signup-modal") : $(".otp-form-container");
    var form = currentContainer.find(".forgot-pwd-otp-form form");
    if (isValid(form)) {
        var code = form.find("#otp").val();
        var email = form.find("#email").val();
        var d = {"email": email, "code": code};

        $.ajax({
            url: SIH.getEndPoint("/api/noauth/sihUser/otp/verify"),
            type: 'POST',
            contentType: "application/json",
            data: JSON.stringify(d),
            success: function (data) {
                var chgPwdForm = $(".login-signup-modal").is(":visible") ? $(".login-signup-modal .change-pwd-form") : $(".change-pwd-container .change-pwd-form");
                chgPwdForm.find("#email").val(email);
                chgPwdForm.find("#otp").val(code);
                hideForgotPasswordOTPForm();
                showChangePasswordForm();
                clearForm(form);
            }, error: function (data) {
                showError(".login-tab", data);
            }
        });
    } else {
        console.warn("Validation failed")
    }
});

//change password otp
$(".login-signup-modal .change-pwd-form .submit-btn, .change-pwd-container .change-pwd-form .submit-btn").click(function (event) {
    cleanError(".login-tab");
    event.preventDefault();
    var currentContainer = $(".login-signup-modal").is(":visible") ? $(".login-signup-modal") : $(".change-pwd-container");
    var form = currentContainer.find(".change-pwd-form form");
    if (isValid(form)) {
        var code = form.find("#otp").val();
        var email = form.find("#email").val();
        var regpassword = form.find("#reg-password").val();
        var confirmPassword = form.find("#confirm-password").val();
        var d = {"email": email, "code": code, "password": regpassword, "confirmPassword": confirmPassword};

        $.ajax({
            url: SIH.getEndPoint("/api/noauth/sihUser/password/update"),
            type: 'POST',
            contentType: "application/json",
            data: JSON.stringify(d),
            success: function (data) {
                hideChangePasswordForm();
                showChangePasswordSuccess();
                clearForm(form);
            }, error: function (data,txt_status,xhr) {
                if(xhr.status === 403){
                    var forgotPwdForm = $(".login-signup-modal").is(":visible") ? $(".login-signup-modal .forgot-pwd-otp-form") : $(".otp-form-container .forgot-pwd-otp-form");
                    forgotPwdForm.find("#email").val(email);
                    hideForgotPasswordForm();
                    showForgotPasswordOTPForm();
                    clearForm(form);
                }else {
                    showError(".login-tab", data);
                }
            }
        });
    } else {
        console.warn("Validation failed")
    }
});

//forgot pwd resend otp btn
$(".login-signup-modal .forgot-pwd-otp-form .resend-btn, .otp-form-container .forgot-pwd-otp-form .resend-btn").on("click", function (event) {
    cleanError(".login-tab");
    event.preventDefault();
    var currentContainer = $(".login-signup-modal").is(":visible") ? $(".login-signup-modal") : $(".otp-form-container");
    var form = currentContainer.find(".forgot-pwd-otp-form");
    var email = form.find("#email").val();
    var d = {"email": email};
    $.ajax({
        url: SIH.getEndPoint("/api/noauth/sihUser/otp/generate"),
        type: 'POST',
        contentType: "application/json",
        data: JSON.stringify(d),
        success: function (data) {
            showTimer(".login-signup-modal .forgot-pwd-otp-form, .otp-form-container");
        }, error: function (data) {
            showError(".login-tab", data);
        }
    });
});

var showError = function (parentClass, error) {
    if (error.responseJSON) {
        for (var i = 0; i < error.responseJSON.length; i++) {
            $(parentClass + " div.error-message span.error-content").html(error.responseJSON[i].defaultMessage + "<br/>");
        }
    } else if (error.responseText) {
        $(parentClass + " div.error-message span.error-content").html(error.responseText);
    }
    else if (typeof(error) === "string" || error instanceof String) {
            $(parentClass + " div.error-message span.error-content").html(error);
    }

    else {
        $(parentClass + " div.error-message span.error-content").html("Something went wrong. Please try again later.")
    }
    $(parentClass + " div.error-message").css("display","block");
};

var cleanError = function(parentClass) {
    $(parentClass + " div.error-message span.error-content").html("");
    $(parentClass + " div.error-message").css("display","none");
};

$(".login-signup-modal .static-tabs ul li").click(function (e) {
    cleanError("#loginModal");
    $(this).addClass("active");
    if ($(this).attr("data-tab") == "login-tab-1") {
        $("li[data-tab=login-tab-2]").removeClass("active");
        $(".login-signup-modal div #login-tab-1").addClass("current");
        $(".login-signup-modal div #login-tab-2").removeClass("current");
    } else {
        $("li[data-tab=login-tab-1]").removeClass("active");
        $(".login-signup-modal div #login-tab-2").addClass("current");
        $(".login-signup-modal div #login-tab-1").removeClass("current");
    }
});

var isValid = function (form) {
    var isValid = true;
    $(form).find(".form-control").not(':button').each(function (index, ele) {
        var element = $(ele);
        var parent = element.closest(".form-group");
        isValid = validateField(element, parent, isValid);
    });
    $(form).find(".form-control").unbind("change");
    $(form).find(".form-control").on("change", function () {
        validateField($(this), $(this).closest(".form-group"));
    });
    return isValid;
};

var validateField = function (element, parent, isFormValid) {
    parent.find("span.help-block").html("");
    parent.removeClass("has-error");
    if (element.data("pattern") !== undefined) {
        var pattern = new RegExp(element.data("pattern"), "g");
        if (element.val().match(pattern) === null) {
            parent.addClass("has-error");
            parent.find("span.help-block").html(element.data("pattern-error") + "<br/>");
            isFormValid = false;
        }

    }
    if (element.data("match") !== undefined) {
        var match = $(element.data("match"));
        if (match.val() !== element.val()) {
            parent.addClass("has-error");
            parent.find("span.help-block").html(element.data("match-error") + "<br/>");
            isFormValid = false;
        }
    }
    if (element.attr("required") === "required" || element.attr("requiredField")=="true") {
        if ((element.val() === "" || element.val() === null)) {
            parent.addClass("has-error");
            parent.find("span.help-block").html("This field is required<br/>");
            isFormValid = false;
        }
    }
    return isFormValid;
};

var clearForm = function (form) {
    try {
        form.find('form :input').not(':button, :submit, :reset').removeAttr('checked').removeAttr('selected').not('‌​:checkbox, select').val('').removeAttr('value');
    }catch(e){
        console.error("form not found");
    }
};


$('#loginModal').on('hidden.bs.modal', function () {
    clearForm($(".login-form"));
    cleanError("#loginModal");
});

var openDefaultForm = function() {
    showDefaultForm();
    $("#loginModal .login-form").hide();
    $("#loginModal .login-form.default").show();
    cleanError(".login-form")
};

var forgotPassword = function () {
    $(".login-tab .login-form").hide();
    cleanError(".login-tab");
    showForgotPasswordForm();
};

var openTab = function (tabId) {

    fbq('track', 'Lead');

    $(".login-signup-modal .static-tabs ul li[data-tab=" + tabId + "]").click();
};

function startTimer(duration, display) {
    var time = duration, seconds;
    var timer = setInterval(function () {
        seconds = parseInt(duration);

        seconds = seconds < 10 ? "0" + seconds : seconds;

        display.html(time);

        if (--time < 0) {
            clearInterval(timer);
            $(".resend-btn").removeAttr("disabled");
        }
    }, 1000);
}

var twentyFiveSeconds = 30;
var showTimer = function (parent) {
    $(".resend-btn").attr("disabled","disabled");
    var display = $(parent).find('#time');
    startTimer(twentyFiveSeconds, display);
};

var openLogin = function () {
    openTab("login-tab-1");
    openDefaultForm();
};
var openLoginPopUp = function () {
    openDefaultForm();
};

if (!store.getItem("token") && getCookie("authToken") && !store.getItem("no-profile")) {
    var d = {token: getCookie("authToken")};
    if (getCookie('loginType') === 'socialLogin') {
        checkForExistingUser(getCookie("authToken"));
    }
    else if (getCookie('loginType') === 'sihLogin') {
        sihLogin(d);
    } else {
        myGovLogin(d);
    }
} else if ((store.getItem("token") && !getCookie("authToken")) || ((store.getItem("token") != null || store.getItem("token") != undefined) && (store.getItem("token")  != getCookie("authToken")))) {
    logout();
}

function appAutoLogin(authToken,loginType){
    var d = {token : authToken};
    if(!store.getItem("token") || (store.getItem("token") && (store.getItem("token") !== authToken))){
        if (loginType === 'socialLogin') {
            checkForExistingUser(authToken);
        }
        else if (loginType === 'sihLogin') {
            sihLogin(d);
        } else if(loginType === 'myGovLogin'){
            myGovLogin(d);
        }
    }
}

function dashboardPageRedirection(data) {
    $('.redirect-model').modal('show');
    if (data['country'] === "sih:location/india" || data['role'] === "SIH_Admin") {
        window.location = $('.notification-container').attr('dashboard') + "/" + data['role'] + ".html";
    } else {
        window.location = $('.notification-container').attr('dashboard') + "/Int-" + data['role'] + ".html";
    }
}

function unableToLoginDialog(){
    var dialog = bootbox.dialog({
        message: '<div class="unable-login-modal"><div class="modal-header">\n' +
        '                <h3>Frequently Asked Questions for Log in Issues:</h3>\n' +
        '            </div>\n' +
        '            <div class="modal-body">\n' +
        '                <div class="row">\n' +
        '                    <div class="col-sm-12">\n' +
        '                        <ul class="certification-list">\n' +
        '                            <li>\n' +
        '                                <h4>I had an account on www.startupindia.gov.in but I’m unable to log in now </h4>\n' +
        '                                <p>The quickest way to resolve this is by select the forgot password option. <a href="javascript:void()" class="forgot-password-link">Click here</a> to reset your password and continue with your Startup India journey </p>\n' +
        '                            </li>\n' +
        '                            <li>\n' +
        '                                <h4>I am unable to log in with my CIN</h4>\n' +
        '                                <p>This is probably because you have registered your company with a different email ID. Please use the forgot password option with CIN details to retrieve the email ID which your CIN is mapped to.</p>\n' +
        '                            </li>\n' +
            '                        <li>\n' +
            '                            <h4><b>I made an account previously, but I do not remember my email ID and I don’t have a CIN:</b></h4>\n' +
            '                            <p>Please create a new account OR email us at dipp-startups@nic.in and share your Company Name with us so that we can help you to access your old account.</p>\n' +
            '                        </li>\n' +
        '                        </ul>\n' +
        '                    </div>\n' +
        '                </div>\n' +
        '            </div></div>'
    });
    $('.bootbox .modal-dialog').addClass('unable-login-wrapper');
}
$(document).on('click','.forgot-password-link',function(){
    $('.bootbox.modal').modal('hide');
    forgotPassword();
});




var settingSuccess;
$(document).ready(function () {
    var settingsRole = store.getItem("role");
    if (!(settingsRole && settingsRole == 'Startup')) {
        $('.businessPrivacyList').html('');
    }
    $(".settings-modal .btn-small").click(function () {
        var settingDetails = new Object();
        settingDetails.notificationOn = $(".swipe-btn input[type='checkbox']").prop("checked");
        if (settingDetails.notificationOn) {
            settingDetails.frequency = $("#emailList option:selected").val();
        } else {
            settingDetails.frequency = null;
        }
        settingDetails.contactPrivacy = $("#contactList option:selected").val();
        settingDetails.bussinessDocPrivacy = $("#businessList option:selected").val();

        $.ajax({
            url: SIH.getEndPoint("/api/auth/user/settings"),
            type: 'POST',
            data: JSON.stringify(settingDetails),
            contentType: 'application/json',
            beforeSend: setAuthTokenHeader,
            success: function () {
                $('.settings-modal').modal('hide');
                settingSuccess = "success";
            }, error: function () {
                $('.settings-modal').modal('hide');
                settingSuccess = "failure";
            }
        });
    });
    var roleQueue = ["Individual", "GovernmentBody"];
    if (store.getItem('token') && ($.inArray(store.getItem("role"), roleQueue) == -1)) {
        $.ajax({
            type: "GET",
            async: false,
            url: SIH.getEndPoint("/api/auth/user/message/queue"),
            beforeSend: setAuthTokenHeader
        }).done(function (data) {
            var unreadMsgs = jQuery.grep(data.content, function (element) {
                return (element.unread);
            });
            var $msgNotification = $(".msg-notification");
            if (unreadMsgs.length > 0) {
                $msgNotification.find(".numbers").html(unreadMsgs.length);
                $msgNotification.find(".numbers").css("display", "block");
            } else {
                $msgNotification.find(".numbers").css("display", "none");
            }
            return false;
        });
    }
});

$('.settings-modal').on('hidden.bs.modal', function () {
    if (settingSuccess == "success") {
        $.notify($('.settings-modal').attr('success-meassage'), 'success');
    } else if (settingSuccess == "failure") {
        $.notify($('.settings-modal').attr('error-meassage'));
    }
    settingSuccess = "";
});

function notificationEnable() {
    if ($(".swipe-btn input[type='checkbox']").prop("checked")) {
        $('#emailList').removeAttr('disabled');
    }
    else {
        $('#emailList').attr('disabled', 'disabled');
    }
}

function getSettings(refObj) {
    /*var $refObj = $(refObj);
    $refObj.closest("ul.notification-info").hide();*/
    $.ajax({
        url: SIH.getEndPoint("/api/auth/user/settings"),
        type: 'GET',
        dataType: 'json',
        beforeSend: setAuthTokenHeader,
        success: function (data) {
            $('#emailList option,#contactList option, #businessList option').each(function () {
                $(this).removeAttr('selected')
            });
            var role = store.getItem('role') ? store.getItem('role') : "";
            if (role.toLowerCase() == "individual") $("select#contactList").find("option[value='My Connections']").remove();
            $('#emailList option[value=' + data.frequency + ']').prop("selected", true);
            $('#contactList option[value="' + data.contactPrivacy + '"]').prop("selected", true);
            $('#businessList option[value="' + data.bussinessDocPrivacy + '"]').prop("selected", true);
            $(".swipe-btn input[type='checkbox']").prop("checked", data.notificationOn);
            notificationEnable();
            $('.settings-modal').modal();
        }
    });
}

// Change Password Modal
function showChangePasswordOption(event) {
    $(".changePwd-modal").find("#changePwdSuccess").hide().find(".message").html("").hide();
    $(".changePwd-modal").find("#changePwdError").hide().find(".message").html("").hide();
    $('.changePwd-modal').modal("show");
    return false;
}

function showCreatePasswordOption(event) {
    //event.preventDefault();
    $('.showPwd-modal').modal("show");
    return false;
}

$(document).on('hidden.bs.modal','.showPwd-modal', function () {
    location.reload(true);
});

function createPassword(event) {
    event.preventDefault();
    event.stopPropagation();
    var crtpwd = "createPassword";
    if (validatePasswords(true)) {

        $(".changePwdMsg").hide();
        $("#changePwdBtn").attr("disabled", "disabled");
        $.ajax({
            url: SIH.getEndPoint("/api/auth/user/password/create"),
            type: 'POST',
            beforeSend: setAuthTokenHeader,
            contentType: 'application/json; charset=utf-8',
            dataType: 'json',
            data: JSON.stringify({
                email: store.getItem("email"),
                password: $("#passwordChange").val(), comfirmPassword: $("#confirmPassword").val()
            }),
            success: function (data) {
                if (data.status) {
                    $(".changePwd").val("");
                    $(".createPasswordForm").remove();
                    $("#changePwdSuccess").closest(".col-sm-7").toggleClass("col-sm-7 col-sm-12");
                    $("#changePwdSuccess").show().find(".message").html("Password created successfully").show();
                } else {
                    $("#changePwdError").show().find(".message").html(data.message).show();
                }
                $("#changePwdBtn").attr("disabled", false);

            }, error: function () {
                $("#changePwdError").show().find(".message").html("Error encountered. Please try again.").show();
                $("#changePwdBtn").attr("disabled", false);
            }
        });
    }else{
        $("#changePwdBtn").attr("disabled", false);

    }
}

function changePassword(event) {
    event.preventDefault();
    event.stopPropagation();
    var currentTarget = event.currentTarget;
    var dataAction = $(currentTarget).data("action");
    //console.log(dataAction);
    $(".changePwdMsg").hide();
    //$("#changePwdBtn").attr("disabled", "disabled");
    if (validatePasswords()) {
        $.ajax({
            url: SIH.getEndPoint("/api/auth/user/password/change"),
            type: 'POST',
            beforeSend: setAuthTokenHeader,
            contentType: 'application/json; charset=utf-8',
            dataType: 'json',
            data: JSON.stringify({
                email: store.getItem("email"),
                oldPassword: $("#oldPassword").val(),
                password: dataAction === "changePassword" ? $("#newPassword").val() : $("#passwordChange").val(),
                comfirmPassword: dataAction === "changePassword" ? $("#confirmNewPassword").val() :$("#confirmPassword").val()
            }),
            success: function (data) {
                if (data.status) {
                    $(".changePwd").val("");
                    $(currentTarget).closest("#changePwdForm").find("#changePwdSuccess").show().find(".message").html("Password changed successfully").show();
                    $(currentTarget).find("#changePwdBtn").attr("disabled", true);
                } else {
                    $(currentTarget).closest("#changePwdForm").find("#changePwdError").show().find(".message").html(data.message).show();
                }
            }, error: function () {
                $(currentTarget).closest("#changePwdForm").find("#changePwdError").show().find(".message").html("Error encountered. Please try again.").show();
                $(currentTarget).find("#changePwdBtn").attr("disabled", true);
            }
        });
    } else {
        $("#changePwdBtn").attr("disabled", false);
    }
}

$('.changePwd-modal').on('hidden.bs.modal', function () {
    $('.changePwd-modal').find(".form-group").removeClass("has-error")
        .end().find(".help-block").hide()
        .end().find(".changePwdMsg").hide()
        .end().find(".changePwd").val("");
});

function validatePasswords(isCreatePassword) {

    var newPwdField = isCreatePassword ? "#passwordChange" : "#newPassword";
    var newCfmPwdField = isCreatePassword ? "#confirmPassword" : "#confirmNewPassword";
    var flag = true, newPwd = $(newPwdField).val();
    var pwdRegex = /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[^a-zA-Z0-9])(?!.*\s).{8,15}$/;
    var classValue= "";

    if(isCreatePassword!= '' && isCreatePassword){
        classValue = "crtpwd"
    }else{
        classValue = "changePwd"

    }
    $("."+classValue+":visible").each(function () {
        var el = $(this);
        if (el.val() == "") {
            flag = false;
            el.siblings('.help-block').show();
            el.closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field cannot be left Blank.");
        } else if (!(pwdRegex.test(newPwd)) && el.attr("id") == "passwordChange") {
            flag = false;
            el.siblings('.help-block').show();
            el.closest(".form-group").addClass("has-error").find("span.help-block").first().html("Invalid Password.");
        } else if (($(newPwdField).val() != $(newCfmPwdField).val())
            && (el.attr("id") == "confirmPassword" || el.attr("id") == "confirmNewPassword") ) {

            flag = false;
            el.siblings('.help-block').show();
            el.closest(".form-group").addClass("has-error").find("span.help-block").first().html("New passwords do not match.");
        } else {
            el.closest(".form-group").removeClass("has-error")
                .end().siblings(".help-block").hide();
        }
    });
    return flag;
}
// Change User Name Modal
function showChangeUserNameOption() {
    $('.changeUsr-modal').modal("show");
    $("#changeUsrForm").show();
    $("#changeUsrForm1").hide();
    $("#changeUsrForm").trigger("reset");
    $("#changeUsrError").hide();
    $("#changeUsrSuccess").hide();
    $(".changePwd").val("");
}

$('.changeUsr-modal').on('hidden.bs.modal', function () {
    $('.changeUsr-modal').find(".form-group").removeClass("has-error")
        .end().find(".help-block").hide()
        .end().find(".changeUsrMsg").hide()
        .end().find(".changePwd").val("")
        .end().find(".changeUsr").val("");
});

$('.changeUsrMsg').on('close.bs.alert', toggleAlert);

function toggleAlert() {
    $(".changeUsrMsg").hide();
    $(".changePwd").val("");
    $("#changeUsrForm").trigger("reset");
    return false;
}

function sendOTP(event){
    cleanError(".changeUsrMsg");
    $("#otp").removeAttr("required");
    $("#confirmPasswordUsr").removeAttr("required");
    $("#changeUsrSuccess").hide();
    $("#changeUsrError").hide();
    event.preventDefault();
    event.stopPropagation();
    var currentContainer = $(".changeUsr-modal");
    var form = currentContainer.find("#changeUsrForm");
    if (isValid(form)) {
        var oldEmail = store.getItem('email');
        var email = form.find("#email").val();
        var d = { "oldEmail":oldEmail,"newEmail":email,"otp":'testOTP',"password":"testPwd"};
        $.ajax({
            url: SIH.getEndPoint("/api/noauth/sihUser/emailChange/otp"),
            type: 'POST',
            contentType: "application/json",
            data: JSON.stringify(d),
            success: function (data) {
                if(data.status) {
                    $("#changeUsrSuccess").show().find(".message").html(data.message).show();
                    $("#changeUsrForm").hide();
                    $("#changeUsrForm1").show();
                    $("#enteredEmail").val(email);
                    showTimer("#changeUsrForm1");
                }else {
                    $("#changeUsrSuccess").hide();
                    if (data.responseJSON) {
                        for (var i = 0; i < data.responseJSON.length; i++) {
                            $("#changeUsrError").show().find(".message").html(data.responseJSON[0].defaultMessage).show();
                        }
                    }else if(data.responseText) {
                        $("#changeUsrError").show().find(".message").html(data.responseText).show();
                    }else{
                        $("#changeUsrError").show().find(".message").html(data.message).show();
                    }
                }
            }, error: function (data) {
                $("#changeUsrSuccess").hide();
                if (data.responseJSON) {
                    for (var i = 0; i < data.responseJSON.length; i++) {
                        $("#changeUsrError").show().find(".message").html(data.responseJSON[0].defaultMessage).show();
                    }
                }else if(data.responseText) {
                    $("#changeUsrError").show().find(".message").html(data.responseText).show();
                }else{
                    $("#changeUsrError").show().find(".message").html(data.message).show();
                }
            }
        });
    }
}
function editEmailId(event) {
    event.preventDefault();
    event.stopPropagation();
    $("#changeUsrSuccess").hide();
    $("#changeUsrError").hide();
    $("#changeUsrForm1").hide();
    $("#changeUsrForm1").trigger("reset");
    $("#changeUsrForm").show();
}


function changeUserName(event) {
    $("#changeUsrError").hide();
    $("#otp").attr('required', 'required');
    $("#confirmPasswordUsr").attr('required', 'required');
    cleanError(".changeUsrMsg");
    event.preventDefault();
    event.stopPropagation();
    var currentContainer = $(".changeUsr-modal");
    var form = currentContainer.find("#changeUsrForm1");
    if (isValid(form)) {
        var oldEmail = store.getItem('email');
        var email = form.find("#enteredEmail").val();
        var code = form.find("#otp").val();
        var password = form.find("#confirmPasswordUsr").val();
        var d = { "oldEmail":oldEmail,"newEmail":email,"otp":code,"password":password}
        $.ajax({
            url: SIH.getEndPoint("/api/noauth/sihUser/changeEmail"),
            type: 'POST',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(d),
            success: function (data) {
                if (data.status) {
                    $(".changePwd").val("");
                    $("#changeUsrError").hide();
                    $('.changeUsr-modal').modal("hide");
                    alert("E-mail ID changed successfully, Please login again using new email Id");
                    logout();
                } else {
                    $("#changeUsrSuccess").hide();
                    if (data.responseJSON) {
                        for (var i = 0; i < data.responseJSON.length; i++) {
                            $("#changeUsrError").show().find(".message").html(data.responseJSON[0].defaultMessage).show();
                        }
                    }else if(data.responseText) {
                        $("#changeUsrError").show().find(".message").html(data.responseText).show();
                    }else{
                        $("#changeUsrError").show().find(".message").html(data.message).show();
                    }
                }
            }, error: function (data) {
                $("#changeUsrSuccess").hide();
                if (data.responseJSON) {
                    for (var i = 0; i < data.responseJSON.length; i++) {
                        $("#changeUsrError").show().find(".message").html(data.responseJSON[0].defaultMessage).show();
                    }
                }else if(data.responseText) {
                    $("#changeUsrError").show().find(".message").html(data.responseText).show();
                }else{
                    $("#changeUsrError").show().find(".message").html(data.message).show();
                }
            }
        });
    }
}




var notificationpage = 0;

var handleNotificationData = function (data) {
    if (!(data.content.length == 0)) {
        var source = $("#notification-template").html();
        var template = Handlebars.compile(source);
        $("#notification-list").html(template(data));

        //Pagination
        var pagination = {
            pages: data.totalPages,
            number: data.number + 1,
            last: data.last,
            first: data.first
        }
        var paginationResource = $('#notification-pagination-template').html();
        var paginationTemplate = Handlebars.compile(paginationResource);
        $('#notification-pagination-div').html(paginationTemplate(pagination));
        if (pagination.pages > 5) {
            $('span.first-page,span.last-page').css('display', 'block');
            if ($('#notification-pagination-div .pagination li.active').index() == 0)
                $('span.first-page').css('display', 'none');
            if ($('#notification-pagination-div .pagination li.active').index() == 4)
                $('span.last-page').css('display', 'none');
        } else {
            $('span.first-page, span.last-page').css('display', 'none');
        }
        viewedNotification();
    } else {
        var noNotificationResource = $("#no-notificaton-template").html();
        var noNotificationTemplate = Handlebars.compile(noNotificationResource);
        var noNotificationText = $('#notification-list').attr('no-notification-text');
        $('#notification-list').html(noNotificationTemplate({'data': noNotificationText}));
    }
    addCursorPointer();
}

function addCursorPointer() {
    $('#notification-list li').each(function (index, val) {
        if ($(this).attr("navigation-link")) {
            $(this).css("cursor", "pointer");
            $("a", $(this)).removeClass("default-cursor");
        }
    });
}

var handleNotificationCount = function (data) {
    $('#notification').parents('.tab-container').find('.desktop-tabs.active .count').html(" (" + data + ")");
}

var handleNotificationViewCount = function (data) {
    var source = $("#notification-count-template").html();
    var template = Handlebars.compile(source);
    if (data) {
        if (data > 99) {
            data = "99+"
        }
        $('#notification-link').html(template({'data': data}));
    }
}

var viewedNotification = function () {
    var viewedNotification = new Object();
    viewedNotification.notificationId = $('#notification-list li:first').attr('id');
    viewedNotification.connectionId = $('#connections-request-div li:first').attr('id');
    $.ajax({
        type: "PUT",
        url: SIH.getEndPoint('/api/auth/user/notifications/view'),
        data: JSON.stringify(viewedNotification),
        headers: {
            "X-Auth-Token": store.getItem("token"),
            "Content-Type": 'application/json'
        },
        success: function (data) {
            $('#notification-link').html("");
        }
    });

}

var notificationPrevious = function (elem) {
    var currentPage = parseInt($(elem).siblings('ul').find('li.active').html());
    notificationpage = currentPage - 2;
    notifications();
}

var notificationNext = function (elem) {
    var currentPage = parseInt($(elem).siblings('ul').find('li.active').html());
    notificationpage = currentPage;
    notifications();
}

var notificationFirst = function () {
    notificationpage = 0;
    notifications();
}

var notificationLast = function (pages) {
    notificationpage = pages - 1;
    notifications();
}

var loadNotificationPage = function (page) {
    var pageNumber = parseInt($(page).html());
    notificationpage = pageNumber - 1;
    notifications();
}

var notifications = function () {
    var path = SIH.getEndPoint('/api/auth/user/notifications') + "?offset=" + notificationpage;
    $.ajax({
        type: "GET",
        url: path,
        dataType: "json",
        beforeSend: setAuthTokenHeader,
    }).done(function (data) {
        if ($.trim(data)) {
            handleNotificationData(data);
        }
    });
}

var notificationCount = function () {
    $.ajax({
        type: "GET",
        url: SIH.getEndPoint('/api/auth/user/notifications/unread/count'),
        headers: {
            "X-Auth-Token": store.getItem("token")
        },
        success: function (data) {
            handleNotificationCount(data);
        }
    });
}

$(document).ready(function () {
    $(".notification").on('click', '#notification-list a', function (e) {
        e.preventDefault();
        e.stopPropagation();
        var id = $(this).parents('li').attr('id');
        var notificationPage = $(this).attr('href');
        if (!$(this).parents('li').hasClass('read')) {
            $.ajax({
                type: "PUT",
                url: SIH.getEndPoint('/api/auth/user/notifications/read/' + id),
                headers: {
                    "X-Auth-Token": store.getItem("token")
                },
                success: function () {
                    var element = "#" + id;
                    $(element).addClass('read');
                    notificationCount();
                    if (notificationPage && notificationPage !== "javascript:void(0)") {
                        window.open(notificationPage, "_blank");
                    }
                }
            });
        } else {
            if (notificationPage && notificationPage !== "javascript:void(0)") {
                window.open(notificationPage, "_blank");
            }
        }
    });

    $(".notification").on('click', '#notification-list li', function (e) {
        if ($(this).attr('navigation-link').length > 0) {
            $("a", $(this)).trigger("click");
            e.preventDefault();
            e.stopPropagation();
        }
    });


    if (store.getItem('token')) {
        $.ajax({
            type: "GET",
            url: SIH.getEndPoint('/api/auth/user/notifications/not-viewed/count'),
            dataType: "json",
            headers: {
                "X-Auth-Token": store.getItem("token")
            },
            success: function (data) {
                handleNotificationViewCount(data);
            }
        });
    }
});

$.facilitators = function () {
    var $mainContent = $(".mirsd-section");
    var formData = {};

    function getFormData(alpha, category) {
        formData["name"] = $("input[name='name']").val().trim();
        formData["jurisdiction"] = $("input[name='jurisdiction']").val().trim();
        formData["location"] = $("input[name='location']").val().trim();
        formData["sectors"] = $("select[name='sector']").val();
        formData["rootPage"] = $("#rootPagePath").val().trim();
        formData["alpha"] = alpha;
        formData["category"] = category ? category : "all";
    }

    function getFacilitators() {
        $('#modal-loader').modal('show');
        $(".facilitatorList").html("");
        $.ajax({
            type: "GET",
            async: false,
            dataType: "json",
            data: formData,
            url: "/bin/services/facilitators"
        }).done(function (data) {
            $('#modal-loader').modal('hide');
            if (data.result) {
                var source = $("#facilitator-template").html();
                var template = Handlebars.compile(source);
                $(".facilitatorList").append(template(data.result));
                $(".facilitator-error").addClass("display-n");
                $(".facilitatorList").children(":even").find(".card-table-left").addClass("right");
                lazyloader(null, null, true, "facilitator-list");
            } else {
                $(".facilitator-error").html("");
                $(".facilitator-error").removeClass("display-n");
                $(".facilitator-error").append(data.noData);
            }

        }).fail(function () {
            $('#modal-loader').modal('hide');
        });
    }

    // calling of functions
    getFormData("", "all");
    getFacilitators();

    $mainContent.find(".search-btn").click(function () {
        var f = $(this);
        var e = $(this).parent().siblings(".committee-search");
        if (e.css("display") == 'none') {
            e.css("display", 'block');
            f.find(".search-arrow").html('&#9660');
        }
        else {
            e.css("display", 'none');
            f.find(".search-arrow").html('&#9650');
        }
    });

    $mainContent.find(".btn.a-z").click(function () {
        $(".btn.a-z.darkAlphabet").removeClass('darkAlphabet');
        $(this).addClass('darkAlphabet');
        getFormData($(this).text().toLowerCase(), "filterByAlphabet");
        getFacilitators();
        $mainContent.find(".btn.a-z").removeClass("darkAlphabet");
        $(this).addClass("darkAlphabet");
    });

    $mainContent.find("#goButton").click(function () {
        var alpha = $('.committee-search .darkAlphabet').text().toLowerCase();
        getFormData(alpha, "filterByOthers");
        if (alpha) {
            getFormData(alpha, "filterByAlphabet");
        } else if (formData["name"] || formData["jurisdiction"] || formData["location"] || formData["sectors"]) {
            getFormData(alpha, "filterByOthers");
        } else {
            getFormData("", "all");
        }
        getFacilitators();
        /*if($('.committee-search .darkAlphabet').text().toLowerCase())
        getFormData($('.committee-search .darkAlphabet').text().toLowerCase(), "filterByOthers");

        if(!formData["name"] && !formData["jurisdiction"] && !formData["location"] && !formData["sectors"]) {
          /!*  $(".facilitatorList").html("");
            $(".facilitator-error").html("");
            $(".facilitator-error").removeClass("display-n");
            $(".facilitator-error").append($("#fac-error-message").val());*!/
          if(formData["alpha"]){
              getFormData($('.committee-search .darkAlphabet').text().toLowerCase(), "filterByAlphabet");
              getFacilitators();
          }else{
              getFormData("", "all");
              getFacilitators();
          }
        } else {
            getFacilitators();
            $mainContent.find(".btn.a-z").removeClass("darkAlphabet");
        }*/
    });

    $mainContent.find("#showRecords").click(function () {
        $mainContent.find("input[type='text']").val("");
        $mainContent.find("#sectors").val("");
        $mainContent.find("li.select2-search-choice").remove();
        getFormData("", "all");
        getFacilitators();
        $mainContent.find(".btn.a-z").removeClass("darkAlphabet");
    });
};

var summernoteeditor = {
    max: null,
    placeholderValue: ""
};

// Select and loop the container element of the elements you want to equalise
function eq_heights() {
    $('.grid-wrap').each(function () {
        var highestBox = 0;
        $('li', this).each(function () {
            if ($(this).height() > highestBox) {
                highestBox = $(this).height();
            }
        });
        $('li', this).height(highestBox);

    });
}

$(document).on('click', ".home-banner a.btn-default[href='https://www.indoSwedenContactUs.html']", function (e) {
    e.preventDefault();
    $('.indoSwedenContactUs').modal('show');
});

/*$('body').click(function(){
    $('.notification-info, .top-nav-detail').css('display','none');
});*/

function hideNavItem() {
    if ($.cookie("userCountry") != "sih:location/india") {
        $(".notification-container").find("li a.dashboardLink").parent().hide();
    }
    if ($('.top-nav-detail .content-section').length == 0) {
        $('#button-menu').addClass('display-n');
    }
}

/*Show tab Notification
 * ----------------------------------*/
function showTab(id) {
    $("#bell,#user").hide();
    if (id === 'bell') {
        $('#bell').css('display', 'block');
        $('#bell').find('.notification-info').css('display', 'block');
        return;
    } else if (id === 'user') {
        $('#user').css('display', 'block');
        $('#user').find('.notification-info').css('display', 'block');
        return;
    }
}

//show tab function via data-id attribute
$('.show-tab').click(function (event) {
    showTab($(this).attr("data-id"));
    event.stopPropagation();
});

if ($('.row-container .criteria')) {
    $('.row-container').each(function () {
        $(this).find('.criteria').wrapAll("<div class='container-criteria' />")
    });
}

/*lazy loader
 * -------------------------------*/
function lazyloader(maxValue, currentTime, reload, uriPath) {
    $('.learning-and-development-listing #' + currentTime + ' .card,.newsfeed, .fixed-table-body.card-table, .block-container .blog-card').addClass('display-n');
    var size_li = $('.learning-and-development-listing .card,.newsfeed, .fixed-table-body.card-table, .block-container .blog-card').size();
    var x = 6;
    var y = 6;
    if (maxValue) x = maxValue, y = maxValue;
    var count = 0;
    var lndListing = '.learning-and-development-listing #' + currentTime + ' .card:lt(' + x + ')';
    $('.newsfeed:lt(' + x + '),.fixed-table-body.card-table:lt(' + x + '),.block-container .blog-card:lt(' + x + ')').removeClass('display-n');
    $(lndListing).removeClass('display-n');
    if (reload) {
        sessionStorage.removeItem(uriPath);
    }
    if (size_li > parseInt(x)) {
        $('#loadMore').css('display', 'block');

        if (sessionStorage.getItem(uriPath)) {
            //count = window.location.hash.split('#')[1];
            count = sessionStorage.getItem(uriPath);
            var lastIndex = (y * (parseInt(count) + 1));
            $('.learning-and-development-listing #' + currentTime + ' .card:lt(' + lastIndex + '),.newsfeed:lt(' + lastIndex + '),.fixed-table-body.card-table:lt(' + lastIndex + '),.block-container .blog-card:lt(' + lastIndex + ')').removeClass('display-n');
            if (lastIndex >= size_li) {
                $('#loadMore').css('display', 'none');
            }
        }
    }
    $('#loadMore').off('click').on('click', function () {
        var c = sessionStorage.getItem(uriPath) || 0;
        sessionStorage.setItem(uriPath, ++c);
        var lastIndex = (y * (parseInt(c) + 1));
        //window.history.replaceState(window.location.pathname, "", window.location.pathname.concat("#" + ++count));
        //x = (x + y <= size_li) ? x + y : size_li;
        x = (lastIndex <= size_li) ? lastIndex : size_li;
        $('.newsfeed:lt(' + x + '),.fixed-table-body.card-table:lt(' + x + '),.block-container .blog-card:lt(' + x + ')').removeClass('display-n');
        $('.learning-and-development-listing #' + currentTime + ' .card:lt(' + x + ')').removeClass('display-n');
        (x === size_li) ? showmsg() : '';
        equalHeights();
        try {
            setMinHeight();
        } catch (e) {
            console.error("min height not found")
        }
    });
    $('.blog-image img, .resource-component img').bind('load', function () { // image ready
        equalHeights();
    });
    $('.learning-and-development-listing #' + currentTime + ' .card .img-resources').bind('load', function () { // image ready
        equalHeightsForLnD(currentTime);
    });

    $('.newsfeed .card .img-resources').bind('load', function () { // image ready
        equalHeightsForNewsfeedCards();
    });
    equalHeights();
}

$(window).load(function () {
    equalHeights();
    equalHeightsForSelector(".leading-partners-image");
    $(window).resize(function () {
        equalHeightsForSelector(".new-persona-content .persona-radio-wrap .caption p");
    });
    equalHeightsForSelector(".new-persona-content .persona-radio-wrap .caption p");
});



$(window).load(function(){
    $('.faqs-wrapper.mentor .home-left-quick-tabs ul.dynamicTabs').slick('unslick')
    function tabScroll(){
        $('.faqs-wrapper .home-left-quick-tabs ul.dynamicTabs, .ams-listing-tabs-wrapper ul.dynamicTabs').slick({
            slidesToShow: 2,
            slidesToScroll: 1,
            infinite: false,
            responsive: [
                {
                    breakpoint: 767,
                    settings: {
                        slidesToShow: 3,
                        slidesToScroll: 1
                    }
                },
                {
                    breakpoint: 600,
                    settings: {
                        slidesToShow: 2,
                        slidesToScroll: 1
                    }
                },


            ]
        })
    }

    if ($(window).width() <= 1024) {


        $(document).on('click','.faqs-wrapper .home-left-quick-tabs ul.dynamicTabs li, .ams-listing-tabs-wrapper ul.dynamicTabs li',function () {
            $(this).addClass('active');
            $(this).parents('.slick-slide').siblings().children().children().removeClass('active');
        });
        tabScroll();
    }


    $(window).resize(function(){

        if ($(window).width() <= 1024) {
            tabScroll();
        }
    });
    //
    // if ($(window).width() <= 480) {
    //
    //
    //     $(document).on('click','.faqs-wrapper .home-left-quick-tabs ul.dynamicTabs li, .ams-listing-tabs-wrapper ul.dynamicTabs li',function () {
    //         $(this).addClass('active');
    //         $(this).parents('.slick-slide').siblings().children().children().removeClass('active');
    //     });
    //     tabScroll();
    // }

})




/*card equal height
 * --------------------------------*/
function equalHeights() {
    $('#bloglist-container .blog,.resource,.search-card, .startup-themes-list .startup-content, .learning-and-development-listing .card').equalHeight({
        groupByTop: false,
        resizeTimeout: 20,
        updateOnDOMReady: true,
        updateOnDOMLoad: true
    });
}

function equalHeightsForLnD(currentTime) {
    $('.learning-and-development-listing #' + currentTime + ' .card').equalHeight({
        groupByTop: false,
        resizeTimeout: 20,
        updateOnDOMReady: true,
        updateOnDOMLoad: true
    });
}

function equalHeightsForNewsfeedCards() {
    $('.newsfeed .card').equalHeight({
        groupByTop: false,
        resizeTimeout: 20,
        updateOnDOMReady: true,
        updateOnDOMLoad: true
    });

}

function equalHeightsForSelector(selector) {
    $(selector).equalHeight({
        groupByTop: false,
        resizeTimeout: 20,
        updateOnDOMReady: true,
        updateOnDOMLoad: true
    });
}


/*carousel elements equal height
 * -------------------------------*/
function carouselequalHeights() {
    $('.item .category-card').equalHeight({
        groupByTop: false,
        resizeTimeout: 20,
        updateOnDOMReady: true,
        updateOnDOMLoad: true
    });
}

/*Load more show message
 * --------------------------------*/
function showmsg() {
    $('#loadmoreicon').hide();
    $('#nomore').show();
}

/* Show progress in level achievement */
function showLevelInfo() {
    $('.level-info').show()
}

/* Close dialog showing level info */
function closeLevelInfo() {
    $('.level-info').hide();
}

/* Open filters */
function expandFilter(ele) {
    $(ele).siblings('.search-filters-list,.search-filters-data,.show-read-more,.focus-content').addClass('more');
    $(ele).siblings('.search-filter-less').removeClass('display-n');
    $(ele).addClass('display-n');
    $(ele).siblings('ul').mCustomScrollbar({'autoHideScrollbar': false});
}

/* Close filters */
function contractFilter(ele) {
    $(ele).siblings('.search-filters-list,.search-filters-data,.show-read-more,.focus-content').removeClass('more');
    $(ele).siblings('.search-filter-more').removeClass('display-n');
    $(ele).addClass('display-n');

    $('.search-filters-list,.search-filters-data,.focus-content').animate({scrollTop: 0}, 500);

    $(ele).siblings('ul').mCustomScrollbar('destroy');

}

function scrollFilters() {
    $(".filter-container.search-filters-list, .modal.fade.connection-showing-data.in .modal-content .modal-body").mCustomScrollbar({
        'autoHideScrollbar': false,
        theme: "dark",
        scrollButtons: {
            enable: true
        }
    });
}

/* Display filters for mobile */
/*function displayFilters() {
 $('.filter-menu').toggleClass('display-b');
 }*/

/**/
function moreContent() {
    /*
     var maxLength = 300;
     $(".show-read-more p").each(function(event){

     var myStr = $(this).text();
     if($.trim(myStr).length > maxLength){
     var newStr = myStr.substring(0, maxLength);
     var removedStr = myStr.substring(maxLength, $.trim(myStr).length);
     $(this).empty().html(newStr);
     $(this).append(' <a href="javascript:void(0);" class="read-more">read more...</a>');
     $(this).append('<span class="more-text">' + removedStr + '</span>');
     }
     });
     $(".read-more").click(function(e){
     */
    /**/
    /*$(this).siblings(".more-text").contents().unwrap();*/
    /**/
    /*
     e.stopPropagation();
     $(this).hide();

     $(this).next().css('display','inline');
     $(this).parent('p').next().show();

     });

     $(".less-text").click(function(e){
     e.stopPropagation();

     $(this).hide();
     $(this).prev().children('.more-text').css('display','none');
     $(this).prev().children('.read-more').css('display','block');
     });*/
    $(".focus-content").each(function () {

        var main = $(this).find('p');

        if (main.length > 0 && main.height() > 37) {
            $(this).siblings(".search-filter-more").removeClass('display-n');
        }
    });

    if ($('ul.recognition-list li').size() > 4) {

        $('ul.recognition-list').siblings('.search-filter-more').show();

    }
    if ($('ul.recognition-list li').size() <= 3) {

        $('ul.recognition-list').siblings('.search-filter-more').hide();
    }
    /*  $('#show-details').each(function(){
     if($(this).height() < 60){

     $('#show-details').siblings('.search-filter-more').hide();
     }else{
     $('#show-details').siblings('.search-filter-more').show();
     }
     });*/
    /*$('.read-more').click(function(){
     $(this).siblings('.show-read-more').removeClass('more-content-height-fixed');
     $('.less').removeClass('hidden');
     $('.read-more').addClass('hidden');
     });
     $('.less').click(function(){
     $(this).siblings('.show-read-more').addClass('more-content-height-fixed');
     $('.read-more').removeClass('hidden');
     $('.less').addClass('hidden');
     });*/


    readOrLess();

}


function readOrLess() {

    $(".main-tabs-cards .active").find(".more-content").each(function () {
        var main = $(this);
        var myStr = $(this).html();
        main.empty().html(myStr);

        $(this).removeClass('more-content-height-fixed');
        main.siblings(".read-desc").addClass('hidden');
        main.siblings(".readLess").addClass('hidden');


        if (main.height() >= 150) {
            var _this = $(this);

            $(this).addClass('more-content-height-fixed');
            console.log(_this.siblings(".read-desc"));
            _this.siblings(".read-desc").removeClass('hidden');
            _this.find('.more-content-foot').css("display", "block");

        }
    });

    $(".main-cards.persona-description-container").find(".more-content").each(function () {

        var main = $(this);
        var myStr = $(this).html();
        main.empty().html(myStr);

        $(this).removeClass('more-content-height-fixed');
        main.siblings(".read-desc").addClass('hidden');
        main.siblings(".readLess").addClass('hidden');


        if (main.height() >= 150) {
            var _this = $(this);

            $(this).addClass('more-content-height-fixed');

            _this.siblings(".read-desc").removeClass('hidden');
            _this.find('.more-content-foot').css("display", "block");

        }
    });

    $(".main-cards .allReviews .flat-media").find(".more-content").each(function () {

        var main = $(this);
        var myStr = $(this).html();
        main.empty().html(myStr);

        $(this).removeClass('more-content-height-fixed');
        main.siblings(".read-desc").addClass('hidden');
        main.siblings(".readLess").addClass('hidden');


        if (main.height() >= 150) {
            var _this = $(this);

            $(this).addClass('more-content-height-fixed');

            _this.siblings(".read-desc").removeClass('hidden');
            _this.find('.more-content-foot').css("display", "block");

        }
    });

}

function changeLanguage() {
    var lang = $(this).attr("value");
    $("#P9LngDdl").text(lang);
    if (lang == "English")
        setCookie("lang", '');
    else
        setCookie("lang", lang);
}

function setCookie(cname, cvalue) {
    if (cvalue && cvalue !== "English") {
        $.cookie(cname, cvalue, {domain: '.startupindia.gov.in', path: '/'});
    } else {
        $.cookie(cname, cvalue, {domain: '.startupindia.gov.in', path: '/', expires: -1});
    }
    window.location.reload(true);
}

$(document).on("click", ".desktop-tabs a", function () {
    readOrLess();
});

$(document).on("click", ".read-desc", function (e) {
    e.stopPropagation();
    $(this).addClass('hidden');
    $(this).siblings(".more-content").removeClass('more-content-height-fixed');
    $(this).siblings(".readLess").removeClass('hidden');
    $(this).siblings(".more-content").children('.more-content-foot').css("display", "none");
});

$(document).on("click", ".readLess", function (e) {
    e.stopPropagation();
    $(this).addClass('hidden');
    $(this).siblings(".read-desc").removeClass('hidden');
    $(this).siblings(".more-content").addClass('more-content-height-fixed');
    $(this).siblings(".more-content").children('.more-content-foot').css("display", "block");
    $('html, body').animate({
        scrollTop: $(this).parent().offset().top - 200
    }, 500);
});

$(document).ready(function () {
    var loc = window.location.href;
    if ((loc.indexOf("content/sih/en/reources/government-schemes/") > 0) && $(window).width() <= 768) {
        $('table').wrap("<div class='res-table'></div>");
    }
    if(loc.indexOf("applicationId=5c6b6fd8e4b0ba900e10556b") > 0){
        $('.thankyou-modal .modal-body p')
            .html('First round shortlist of the challenge will notified to the selected startups, via email, on 6th June 2019');
        $('.thankyou-modal').modal('show');
    }
    if(loc.indexOf("applicationId=5c6b64f5e4b0ba900e105542") > 0){
        $('.thankyou-modal .modal-body p')
            .html('Results of the challenge will notified to the winner, via email, on 15th June 2019');
        $('.thankyou-modal').modal('show');
    }
    // if ((window.location.href.indexOf("home-page") === -1) || (window.location.href.indexOf("startup-scheme") === -1)) {
    if ($(".home-banner").length === 0) {
        $('.inner-layout').removeClass("home-layout");
        $('.mid-header-wrap').removeClass("home-topnav");
    } else {
        $('.inner-layout').addClass("home-layout");
        $('.mid-header-wrap').addClass("home-topnav");
    }

    //top navigation toggle
    $(".top-nav-button").click(function (event) {
        $(".top-nav-detail").slideToggle();
        event.stopPropagation();
        $('#user').hide();

    });
    $(".top-nav-detail, .notification-info").click(function (event) {
        event.stopPropagation();
    });

    $(".notification-container .show-tab").click(function (event) {
        $(".top-nav-detail").hide();
    });
    //responsive menu on home page
    $(".responsive-menu").click(function () {
        $("nav").slideToggle();

    });
    $(".dropbtn-responsive").click(function () {
        $(".dropdown-content-responsive").slideToggle();

    });

    if ($(window).width() < 768) {
        $(".dropdown-content .dropdown").click(function () {
            $(this).children(".dropdown-content.sub-submenu").slideToggle('300');
        });
    }
    hideNavItem();

    //for home page grids
    eq_heights();

    summernoteeditor.max = $('textarea.richTextarea').attr("maxlength");
    summernoteeditor.placeholderValue = $('textarea.richTextarea').attr("placeholder");
    //summernote customize code for richtext.
    $('textarea.richTextarea').summernote({
        minHeight: 100,
        disableDragAndDrop: true,
        linkTargetBlank: true,
        placeholder: summernoteeditor.placeholderValue,

        toolbar: [
            ['insert', ['link']]
        ],
        callbacks: {
            onKeydown: function (e) {
                $(".note-placeholder").hide();
                var t = e.currentTarget.innerText;
                if (t.trim().length >= summernoteeditor.max) {
                    //delete key
                    if (e.keyCode != 8)
                        e.preventDefault();
                }
            },
            onKeyup: function (e) {
                var t = e.currentTarget.innerText;
                $('#maxContentPost').text(summernoteeditor.max - t.trim().length);
                if (t.trim().length == 0) {
                    $('.note-editor.note-frame').addClass('note-has-error').removeClass('note-writer-text');
                } else {
                    $('.note-editor.note-frame').removeClass('note-has-error').addClass('note-writer-text');
                }
            },

            onPaste: function (e) {
                equalHeights()
                var t = e.currentTarget.innerText.trim();
                var bufferText = ((e.originalEvent || e).clipboardData || window.clipboardData).getData('Text').trim();
                e.preventDefault();
                document.execCommand('insertText', false, bufferText.substring(0, summernoteeditor.max - t.length));
            },
            onFocus: function (e) {
                var t = e.currentTarget.innerText;
                if (!$('.note-editor.note-frame').hasClass('note-has-error') && t.trim().length == 0) {
                    $('.note-editor.note-frame').addClass('note-writer-text');
                } else if ($('.note-editor.note-frame').hasClass('note-has-error') && t.trim().length == 0) {
                    $('.note-editor.note-frame').addClass('note-has-error').removeClass('note-writer-text');
                } else if (t.trim().length > 0) {
                    $('.note-editor.note-frame').removeClass('note-has-error note-writer-text');
                }
            },
            onBlur: function (e) {
                var t = e.currentTarget.innerText;
                if (!$('.note-editor.note-frame').hasClass('note-has-error') && t.trim().length == 0) {
                    $('.note-editor.note-frame').removeClass('note-writer-text').addClass('note-has-error');
                } else if ($('.note-editor.note-frame').hasClass('note-has-error') && t.trim().length == 0) {
                    $('.note-editor.note-frame').addClass('note-has-error').removeClass('note-writer-text');
                } else if (t.trim().length > 0) {
                    $('.note-editor.note-frame').removeClass('note-has-error note-writer-text');
                }
            }

        }
    });

    /*   $(".note-editable").on("keyup", function(){
     if(!$(".note-editable").html().replace(/<\/?[^>]+(>|$)/g, "").length>0){
     $('.note-editor.note-frame').css('border','1px solid rgb(169, 68, 66)');
     }else{
     $('.note-editor.note-frame').css('border','1px solid rgb(169, 169, 169)');
     }
     });
     */
    window.addEventListener('resize', eq_heights);
    window.addEventListener('scroll', eq_heights);

    // window.onload = eq_heights;

    function close_accordion_section() {
        jQuery('.accordion .accordion-section-title').removeClass('active');
        jQuery('.accordion .accordion-section-content').slideUp(300).removeClass('open');
    }

    jQuery('.accordion-section-title').click(function (e) {
        // Grab current anchor value
        var currentAttrValue = jQuery(this).attr('href');

        if (jQuery(this).is('.active')) {
            close_accordion_section();
        } else {
            close_accordion_section();

            // Add active class to section title
            jQuery(this).addClass('active');
            // Open up the hidden content panel
            //  jQuery('.accordion ' + currentAttrValue).slideDown(300).addClass('open');
            $(this).siblings(".accordion-section-content").slideDown(300).addClass('open');

            // this code auto scroll to 100px for home page FAQs
            setTimeout(function () {
                if ($(e.currentTarget).closest(".accordionitem").is(":last-child")) {
                    $(".faq-home .accordion").mCustomScrollbar("scrollTo", 100);
                }
            }, 350);
            // ----- end -----

        }
        e.preventDefault();
    });

    /*Lazy loader calling on newsfeeds and blog listing page*/
    // lazyloader();

    /*Equal Heights
     * ----------------------------*/
    equalHeights();
    equalHeightsForLnD();

    /*toggle tabs
     * -----------------------------------*/
    function tabsresponsive() {
        var $tabs = $('#horizontalTab');
        $tabs.responsiveTabs({
            startCollapsed: 'accordion',
            collapsible: 'accordion'
        });
        $('.r-tabs-state-default >.r-tabs-anchor').children('i').hide();
        $('.r-tabs-state-active >.r-tabs-anchor').children('i').show();
        $("ul.r-tabs-nav li.r-tabs-tab").click(function () {
            $('.r-tabs-state-default >.r-tabs-anchor').children('i').hide();
            $('.r-tabs-state-active >.r-tabs-anchor').children('i').show();
        });
    }

    tabsresponsive();

    /*customised dropdown
     * ------------------------------------*/
    $(document).on('click', '.customised-dropdown .dropdown-menu', function (e) {
        e.stopPropagation();
    });

    /*carousels
     * ------------------------------------*/
    $(".manual-carousel").owlCarousel({
        items: 4,
        navigation: true,
        navigationText: ["<", ">"],
        itemsTablet: [768, 3],
        itemsMobile: [479, 2],
        itemsCustom: false
    });
    $(".small-carousel").owlCarousel({
        items: 3,
        navigation: true,
        navigationText: ["<", ">"],
        itemsTablet: [768, 3],
        itemsMobile: [479, 2],
        itemsCustom: false
    });
    $(".automatic-carousel").owlCarousel({
        items: 3,
        /* navigation : true,*/
        itemsTablet: [768, 3],
        itemsMobile: [479, 1],
        itemsCustom: false,
        autoPlay: true,
        autoplayTimeout: 5000,
        autoplayHoverPause: false,
        responsiveRefreshRate: 200,
        //stopOnHover: true,
        dots: true
    });
    var owl = $('.automatic-carousel');
    owl.on('click', '.carousel-image-wrap', function () {
        owl.trigger('owl.play', 5000);
    });
    carouselequalHeights();

    /*form popover
     * -------------------------------------*/
    $(function () {
        $('[data-toggle="popover"]').popover()
    });

    /*carousel information close
     * -------------------------------------*/


    /*carousel close
     * --------------------*/
    var infoparent = [], infohidden;
    var item = window.localStorage.getItem('inforparent');
    if (item && item.length > 0) {
        infoparent = item.split(',');
    }

    $('.close').on('click', function () {
        $(this).parents('.item').css('display', 'none');
        infohidden = true;
        infoparent.push($(this).parents('.manual-carousel').attr('id'));
        window.localStorage.setItem('information', infohidden);
        window.localStorage.setItem('inforparent', infoparent);
    });

    /* check if the information is present in storage
     * ------------------------------------------------------------*/
    if (window.localStorage.getItem('information') && window.localStorage.getItem('inforparent')) {
        for (var i = 0; i < infoparent.length; i++) {
            $('#' + infoparent[i]).find('.item:first').css('display', 'none');
        }
    }

    /*form validation
     * -------------------------------------*/
    $('form').validator()
    rules: {
        city: {
            required: true
        }
        state: {
            required: true
        }
    }
//datepicker

    $("#datepicker").datepicker();
    //add link for form
    $('.add').click(function () {
        $('.block:last').before(' <div class="block"><input type="text" class="form-control"/><span class="remove">Remove</span></div>');


    });

    $('body').on('click', '.remove', function () {
        $(this).parent('.block').remove();
    });

    $(".add-form").click(function () {
        $(".form:first").clone().appendTo(".accordion-body").after('<div class="block-form"><span class="remove-form">Remove</span></div>');
    });

    $('body').on('click', '.remove-form', function () {
        $(this).parent('.block-form').prev('.form').remove();
        $(this).parent('.block-form').remove();
    });

    /** Notification panel
     ------------------------------**/
    //hide on body click
    /*$('body').click(function(){
        $('.notification-info, .top-nav-detail').css('display','none');
    });*/

    //show tab function via data-id attribute
    $('.show-tab').click(function (event) {
        console.log($(this).attr("data-id"));
        showTab($(this).attr("data-id"));
        event.stopPropagation();
    })


    $('.level-info').hide();

//uncheck and check all for checkboxes
    /* $(".checkAll").change(function () {
     $("input:checkbox").prop('checked', $(this).prop("checked"));
     });*/


    $('.filter-container :checkbox').bind('click', function () {

        var $chk = $(this), $li = $chk.closest('li'), $ul, $parent;
        if ($li.find('ul')) {
            $li.find(':checkbox').not(this).prop('checked', this.checked)
        }

        do {
            $ul = $li.parent();
            $parent = $ul.siblings('label').find(':checkbox');
            if ($chk.is(':checked')) {
                $parent.prop('checked', $ul.has(':checkbox:not(:checked)').length == 0)
            } else {
                $parent.prop('checked', false)
            }
            $chk = $parent;
            $li = $chk.closest('li');
        } while ($ul.is(':not(.filter-container)'));
    });


    $('.filter').on('click', '.filter-container :checkbox', function () {
        var $chk = $(this), $li = $chk.closest('li'), $ul, $parent;
        if ($li.has('ul')) {
            $li.find(':checkbox').not(this).prop('checked', this.checked)
        }

        do {
            $ul = $li.parent();
            $parent = $ul.siblings('label').find(':checkbox');
            if ($chk.is(':checked')) {
                $parent.prop('checked', $ul.has(':checkbox:not(:checked)').length == 0)
            } else {
                $parent.prop('checked', false)
            }
            $chk = $parent;
            $li = $chk.closest('li');
        } while ($ul.is(':not(.filter-container)'));
    });

    $(document).on('click touchend', function () {
        $('.info.popover').hide();
        $(".more-info").removeClass("active");
    });

    $(document).on('click touchend', '.more-info', function (event) {
        event.stopPropagation();
        var show = false;
        if ($(this).find('.info.popover').is(':hidden')) {
            show = true;
        }
        $('.info.popover').hide();
        $(".more-info").removeClass("active");

        if (show) {
            $(this).addClass("active");
            $(this).find('.info.popover').show();
        }
        return false;

    });

    $('.dynamicTabs a').click(function (e) {
        $(".mobile-tab.active .dropdown-toggle").html($(this).text() + "<span class='caret'></span>");
        e.preventDefault();
        $(this).tab('show');
    });

    /*for home tabs to scroll on click*/
    $('.r-tabs-tab a[href^="#"]').on('click', function (event) {
        var target = $($(this).attr('href'));
        if (target.length) {
            event.preventDefault();
            $('html, body').animate({
                scrollTop: target.offset().top - 200
            }, 500);
        }
    });

    /*    if(!$('footer .iparys_inherited div').hasClass('footer')){
            $('.push').css('display','none');
        }*/

    /*$('.query-not-found').modal({
     backdrop: 'static',
     keyboard: true
     })*/
    $("a[href='/content/sih/en/israel-challenge.html?theme=digital_health'], a[href='/content/sih/en/israel-challenge.html?theme=agriculture'], a[href='/content/sih/en/israel-challenge.html?theme=water'], a[href='/content/sih/en/facebook-application.html']").click(
        function (e) {
            if (!store.getItem("published") && store.getItem("token")) {
                $('.under-moderation-modal').modal('show');
                e.preventDefault();
                e.stopPropagation();
            } else if (store.getItem("no-profile")) {
                $('.complete-profile-modal').modal('show');
                e.preventDefault();
                e.stopPropagation();
            }
        });
    setTimeout(function () {
        $("a[href='/content/sih/en/israel-challenge.html?theme=digital_health'], a[href='/content/sih/en/israel-challenge.html?theme=agriculture'], a[href='/content/sih/en/israel-challenge.html?theme=water']").css('display', 'block')
    }, 2000);

    if ($(window).width() < 768) {
        $('.profile-tabs a[href^="#"]').on('click', function (event) {
            readOrLess();
            var target = $(this.getAttribute('href'));
            if (target.length) {
                event.preventDefault();
                $('html, body').stop().animate({
                    scrollTop: target.offset().top - 30
                }, 1000);
            }
        });
    }
    $(".complete-profile-modal .btn-redirect").click(function () {
        window.location.href = $('.notification-container').attr('create-profile');
    });
    $(".complete-profile-modal").on('hidden.bs.modal', function () {
        window.location.href = $('.notification-container').attr('create-profile');
    });

    function checkRecognitionRequiredField(attrValue, inputSel) {
        var requiredField = $(inputSel).closest(".row").find("sup.required");
        if (requiredField && requiredField.length > 0 && (!attrValue || attrValue === "")) {
            isValidated = false;
            $(inputSel).closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field can't be left Blank.");
        } else {
            $(inputSel).closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
        }
    }

    $(".validateRecognitionCertificate").click(function () {
        var formData = new FormData();
        /*if (!$('input[name=regno]').val()) {
            $('input[name=regno]').closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field can't be left Blank.");
        } else {
            $('input[name=regno]').closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
            formData.append("regno", $('input[name=regno]').val());
        }
        if (!$('input[name=entname]').val()) {
            $('input[name=entname]').closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field can't be left Blank.");
        } else {
            $('input[name=entname]').closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
            formData.append("entname", $('input[name=entname]').val());
        }*/

        if (!$('input[name=regno]').val() && !$('input[name=entname]').val()) {
            $('input[name=regno]').closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field can't be left Blank.");
            $('input[name=entname]').closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field can't be left Blank.");
        } else {
            $('input[name=regno]').closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
            $('input[name=entname]').closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
            if ($('input[name=regno]').val()) {
                formData.append("regno", $('input[name=regno]').val());
            }
            if ($('input[name=entname]').val()) {
                formData.append("entname", $('input[name=entname]').val());
            }
        }

        if (!$("input[name='certificate']:checked").length > 0) {
            $("input[name='certificate']").closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field can't be left Blank.");
            return;
        } else {
            $('input[name=certificate]').closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
            formData.append("certificate", $("input[name='certificate']:checked").val());

        }

        if (!$('input[name=regno]').val() && $('input[name=entname]').val()) {
            var tbl_condition = "entity_name =" + "\'" + $('input[name=entname]').val() + "\'" + " and archive = 0 ";
            fetchTableData("startup_registration", tbl_condition, fetchCertificate)
        } else if ($('input[name=regno]').val()) {
            fetchCertificate(formData);
        }
    });


    function fetchCertificate(data) {
        var formData = new FormData();
        if (data instanceof FormData) {
            formData.append("regno", data.get("regno"));
            if (data.get("entname")) {
                formData.append("entname", data.get("entname"));
            }
        } else {
            if (data && $.isArray(data)) {
                var randumReg = data[0].randum_reg;
                if (randumReg) {
                    formData.append("regno", randumReg);
                } else {
                    $(".validateStartupRecognition").html(" Your application is Pending/Rejected so you are not able to download certificate").removeClass('display-n');
                    $('.viewRecognitionCertificate').addClass('display-n');
                    return;
                }
            } else {
                $(".validateStartupRecognition").html("Invalid Entity name").removeClass('display-n');
                $('.viewRecognitionCertificate').addClass('display-n');
                return;
            }
        }
        formData.append("certificate", $("input[name='certificate']:checked").val());

        if (($('input[name=regno]').val() || $('input[name=entname]').val()) && $("input[name='certificate']:checked").length > 0) {
            $('#modal-loader').modal('show');
            $.ajax({
                type: "POST",
                dataType: "json",
                data: formData,
                contentType: false,
                processData: false,
                url: $('.validateRecognitionCertificate').data('form-action'),
                success: function (data) {
                    if (data._resultflagg == "1") {
                        $('#modal-loader').modal('hide');
                        $('.viewRecognitionCertificate').attr('pdfLink', data[$("input[name='certificate']:checked").val().toLowerCase() + '_certficate']);
                        $('.viewRecognitionCertificate').removeClass('display-n');
                        $(".validateStartupRecognition").addClass('display-n');
                    } else {
                        $('#modal-loader').modal('hide');
                        $(".validateStartupRecognition").html(data.message).removeClass('display-n');
                        $('.viewRecognitionCertificate').addClass('display-n');
                    }
                },
                error: function () {
                    $('#modal-loader').modal('hide');
                    $(".validateStartupRecognition").removeClass('display-n');
                }
            });
        }
    }

    $('.viewRecognitionCertificate').click(function () {
        window.open($('.viewRecognitionCertificate').attr('pdfLink'), "_blank")
    });

    $('.rbl-applyButton1,.rbl-applyButton2').click(function () {
        ga('send', 'event', 'Website-InFinIT20', 'ApplyButton', 'InFinIT20-Apply-button', 1);
    })

    $('.accordion-section-title').bind('click', function () {
        var self = this;
        setTimeout(function () {
            theOffset = $(self).offset();
            $('#mCSB_1_container').mCustomScrollbar({
                axis: 'y',
                setTop: theOffset.top - 100
            });
        }, 310);
    });
    // dialog-ling code
    $(document).on('click', '.note-insert .note-btn', function () {
        $('.modal.link-dialog').before('<div class="link-dialog-overlay"></div>');
    });
    $(document).on('click', '.link-dialog .close, .link-dialog .note-link-btn, .link-dialog', function (e) {
        $('.link-dialog-overlay').remove();
    });
    $(document).on('click', ".modal-dialog", function(e){
      e.stopPropagation();

    })
    $(document).on('click', '.discussion-detail .note-insert .note-btn', function () {
      setTimeout(function(){
        $('.modal-backdrop.in').remove();
      },500);
    });
});

function getCookie(cname) {
    var name = cname + "=";
    var ca = document.cookie.split(';');
    for (var i = 0; i < ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') {
            c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
        }
    }
    return "";
}

function getDippStatesNo(stateName, apiLink) {
    var state = {};
    state["state"] = stateName;
    $.ajax({
        type: "POST",
        data: state,
        url: apiLink
    }).done(function (data) {
        var result = JSON.parse(data);
        if (result._resultflag === "1") {
            $('.dipp-state-no').text(result.homepageCount.startuptilldate.totalapprovedapp + "+");
        }
    }).fail(function () {
        console.log("error");
    });
};
$(document).on("click", ".linked-block", function (e) {
    e.stopPropagation();
    e.preventDefault();
    var linkedBlock = $(e.target).parent().data('id');
    if (linkedBlock) {
        var scrollPos = '.' + linkedBlock;
        $('html, body').animate({
            scrollTop: $(scrollPos).offset().top - 100
        }, 500);
    }
});

$(document).on("click", ".linked-block-row", function (e) {
    e.stopPropagation();
    e.preventDefault();
    var linkedBlock = $(e.target).parent().data('id');
    if (linkedBlock) {
        var $scrollPos = $('.' + linkedBlock).find(".common-heading");
        $('html, body').animate({
            scrollTop: $scrollPos.offset().top - 100
        }, 500);
    }
});

function saveStateRecognized() {
    $.ajax({
        type: "GET",
        url: SIH.getEndPoint("/api/auth/user/recognition/save"),
        data: {'stateRecognized': true},
        headers: {"X-Auth-Token": store.getItem("token")},
        success: function () {
            console.log('State recognition option has been saved successfully');
        }, error: function (data) {
            store.removeItem("stateRecognized");
            console.error("Error in saving state recognition option");
        }
    });
}

$.removeCookie("authToken", {'expires': -1, path: '/'});

$('.shell-btn, .clean-air-btn').on('click', function () {
    window.open($(this).data('form-action'), "_blank")
});

function displayContentListing(param, enableFilterOption, uriPath, noResultMessage, viewType, numberOfBlogListing, classes, currentTime, reload) {
    $('#modal-loader').modal('show');
    var formData = null;
    var templateID = "#learn-and-develop-grid-template";
    var blockDiv = ".learning-and-development-listing #" + currentTime + " .content";

    if (param) {
        formData = param;
        if (viewType == 'true') {
            templateID = "#learn-and-develop-grid-template-popup";
            blockDiv = ".bootbox-body";
        }
    } else if (enableFilterOption) {
        var $filterBlock = $("div.tag-filter-block");
        if ($filterBlock) {
            var $filterForm = $filterBlock.find("form");
            formData = ($filterForm && $filterForm.length > 0) ? $filterForm.serialize() : null;
        }
    }

    if (viewType == 'list') {
        templateID = $("#learn-and-develop-list-template");
    }
    var source = $(templateID).html();
    var template = Handlebars.compile(source);
    var errorMsg = "<div class=\"page404 clearfix\">\n" +
        "        \t<div class=\"page404-image\">\n" +
        "            \t<img src=\"/etc/designs/invest-india/investindialibs/images/no-result.png\">\n" +
        "        \t</div>\n" +
        "        \t<div class=\"page404-message\">\n" +
        "            \t<h2>" + noResultMessage || "Sorry!! we are unable to find any result matching your search criteria." + "</h2>\n" +
        "        \t</div>\n" +
        "    \t</div>";
    $.ajax({
        type: "GET",
        data: formData,
        url: uriPath,
        dataType: "json",
        success: function (data) {
            $(".result-count .stats").text(data.length || 0);

            if (data && $.isArray(data) && data.length > 0) {
                var l = numberOfBlogListing || 6;
                if (data.length > l) {

                    $("#loadMore").show();

                    $('#loadmoreicon').show();
                    $('#nomore').hide();
                } else {
                    $("#loadMore").hide();
                }

                // if (numberOfBlogListing) {
                //     $(blockDiv).html(template(data.slice(0, numberOfBlogListing)));
                // }
                // else {
                //     $(blockDiv).html(template(data));
                // }

                $(blockDiv).html(template(data));

                $(".learning-cols").addClass(classes);
                if(data.length ===1){

                    $('.learningAndDevelopment').css({
                        "margin-right":"auto",
                        "margin-left":"auto",
                        //"float":"none"
                    });
                }

                lazyloader(numberOfBlogListing, currentTime, reload, uriPath);
            } else {
                $(blockDiv).html(errorMsg);
                $("#loadMore").hide();
            }
            //setMinHeight();
            $("a[href='/content/sih/en/international/India_Japan.html']").attr("href","https://www.startupindia.gov.in/japan");
            $('#modal-loader').modal('hide');
        }, error: function (data) {
            $(blockDiv).html(errorMsg);
            $("#loadMore").hide();
            $('#modal-loader').modal('hide');
        }
    });
}

$('.compendium #state').on("change", function (event) {
    var stateSelected = $('.compendium #state option:checked').val();
    var allStatesList = $('.compendiumFilter');
    $(allStatesList).each(function (index, element) {
        var s1 = $('.stateId', element).val();
        if (stateSelected === s1 || s1 === "All States") {
            $(element).show();
        } else if (!stateSelected) {
            $(element).show();
        } else {
            $(element).hide();
        }
    });
    if ($(".compendiumFilter:visible").length) {
        $(".noData").addClass("display-n")
    } else {
        $(".noData").removeClass("display-n")
    }
    $(".compendium").not('.compendium-states').each(function (index, element) {
        if ($(".compendiumFilter:visible", this).length) {
            $(".text", this).removeClass("display-n")
        } else {
            $(".text", this).addClass("display-n")
        }
    })
});

function fetchTableData(tbl_name, tbl_condition_field, callBack, retrievedData) {
    var formData = {};
    formData["tbl_name"] = tbl_name;
    if (tbl_condition_field) {
        formData["tbl_condition_field"] = tbl_condition_field;
    }
    $.ajax({
        type: "POST",
        dataType: "json",
        data: formData,
        url: $("#fetchApiUrl").val() || "https://recognition.startupindia.gov.in/webapi/webservice.php?rquest=retriveData",
        success: function (data) {
            if (data.message) {
                retrievedData ? callBack(data.message, retrievedData) : callBack(data.message);
            }
        },
        error: function () {
            console.log("error while fetching data from server");
        }
    });
}

function checkFileUploadReturn(selectedFormats, fileToValidate, size, isValidated) {
    var validated = isValidated;
    var message = "";
    if ($(fileToValidate).val() !== "") {
        if (fileToValidate.files[0].size > size) {
            message = "File Should not be greater then " + Math.floor(size / 1024000) + " MB.";
        }
        if (jQuery.inArray(fileToValidate.files[0].type, selectedFormats) === -1) {
            var fileTypes = [];
            $.each(selectedFormats, function (i, val) {
                fileTypes.push(" " + val.split("/")[1]);
            });
            message = message + " Please upload" + fileTypes.toString() + " file formats.";
        }
        if (message !== "") {
            validated = false;
            $(fileToValidate).siblings(".help-block").html(message).parents(".form-group").addClass("has-error");
            $(fileToValidate).val("");
            $(fileToValidate).siblings(".fileName").val("");
            $(fileToValidate).siblings(".fileDisplayName").val("");
            $(fileToValidate).siblings("a.presentationLink").addClass("display-n");
        } else {
            $(fileToValidate).siblings("a").html("").addClass("display-n").attr("href", "");
            $(fileToValidate).siblings(".help-block").html("");
            $(fileToValidate).parents(".form-group").removeClass("has-error");
        }
    }
    return validated;
}

function validateRegexFields(regexFields, isValidated) {
    var validated = isValidated;
    $.each(regexFields, function (index, item) {
        var element = $(item);
        var re = new RegExp(element.attr("regex"));
        if ((!element.hasClass('disabled-field') && !element.parents('.disabled-field').length) && element.val() && !re.test(element.val())) {
            validated = false;
            element.closest(".form-group").addClass("has-error");
            element.siblings(".regex-msg").show();
        } else {
            if (!(element.closest(".form-group").has("sup.required") && !element.val())) {
                showErrorState(element, false);
            }
            element.siblings(".regex-msg").hide();
        }
    });
    return validated;
}

function validateFileField(requiredFiles, removeError, isValidated) {
    var validated = isValidated;
    if (removeError) {
        $.each(requiredFiles, function (index, item) {
            var element = $(this).closest('.form-group').find('input[type=file]');
            $(element).closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
        });
    } else {
        if (requiredFiles) {
            $.each(requiredFiles, function (index, item) {
                var element = $(this).closest('.form-group').find('input[type=file]:not(.validate-ignore)');
                if (element && element.length) {
                    var fileExist = $(element)[0].files[0];
                    var fileAlreadyExist = $(element).siblings('a').attr('href');
                    console.log(fileAlreadyExist);
                    if (fileExist || fileAlreadyExist) {
                        $(element).closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
                    } else {
                        validated = false;
                        $(element).closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field cannot be left Blank.");
                    }
                }
            });
        }
    }
    return validated;
}

$(".thankyou-modal").on('hidden.bs.modal', function () {
    var loc = window.location.href;
    if(loc.indexOf("applicationId=5c6b6fd8e4b0ba900e10556b") > 0){
        return;
    }
    if(loc.indexOf("applicationId=5c6b64f5e4b0ba900e105542") > 0){
        return;
    }
    if($(".thankyou-modal").hasClass("no-reload")){
        return;
    }
    window.location.reload();
});

$(function () {

    $(".header-menu .dropdown li").on('mouseenter mouseleave', function (e) {
        if ($('ul', this).length) {
            var elm = $('ul', this);
            var off = elm.offset();
            var l = off.left;
            var w = elm.width();
            var docH = $(".container").height();
            var docW = $(".container").width();

            var isEntirelyVisible = (l + w <= docW);

            if (!isEntirelyVisible && ($(window).width() <= 768)) {
                $('.dropdown-content.sub-submenu').addClass('edge');
            } else {
                $('.dropdown-content.sub-submenu').removeClass('edge');
            }
        }
    });

    $('.modal').on('hidden.bs.modal', function () {
        $('html').css('overflow', 'auto');
    });
    $('.modal').on('show.bs.modal', function () {
        $('html').css('overflow', 'hidden');
    });
});

var suggestionBoxSubmission = function (formSelector, apiPath) {
    var data = JSON.stringify($("." + formSelector).serializeObject());
    $.ajax({
        type: "POST",
        url: SIH.getEndPoint("/api/noauth/email/" + apiPath),
        contentType: "application/json",
        data: data
    }).done(function () {
        var $thankyouModal = $(".suggestion-thank-modal");
        $thankyouModal.find('.modal-body p').html($("form." + formSelector).data('thankContent'));
        $thankyouModal.modal();
        document.forms[formSelector].reset();
    }).fail(function () {
        $('.error-modal .modal-body p').html($("form." + formSelector).attr('errorMsg'));
        $('.error-modal').modal();
    });
};


var setAuthTokenHeader = function (xhr) {
    var token = store.getItem('token');
    if (token) {
        xhr.setRequestHeader('X-Auth-Token', token);
        xhr.setRequestHeader('Content-Type', 'application/json');
    } else {
        xhr.setRequestHeader('Content-Type', 'application/json');
    }
}
$(window).on('load resize', function () {
    winWidth = $(window).width();
    conWidth = $('.container.stats-n-video-section').outerWidth();
    marginR = (winWidth - conWidth) / 2;
    if ($(window).width() > 991) {
        $('.stats-n-video-section .hero-wrapper.home').css('margin-right', '-' + marginR);
        $('.stats-n-video-section .hero-wrapper.home iframe').attr('height', 470);
    }
  if($(window).width() < 1025){
      var twitterWrapWidth = $('.twitter-stack').width();
      $('#twitter-widget-0').css('width',twitterWrapWidth);
  }
  if($(window).width() < 768){
    // twitter section

    // home page slider
    var homeBannerWidth = $('.home-banner.home').width();
    $('.home-banner.home .slick-list.draggable, .home-banner.home .slick-list.draggable .slick-track, .home-banner.home .slick-list.draggable .slick-slide').css('width',homeBannerWidth);
    // $('.home-banner.home .slick-list.draggable .slick-track').css('width',homeBannerWidth);
    var ytIframeWidth = $('.home-banner.home .vid-tag .player-container').height();
    $('.home-banner.home .slick-list.draggable').css('height',ytIframeWidth);
  }
});
(function($){

  $('.table-striped').stackedRows();
  $('.forumFilterContainer').on('select2:open resize', function(e){
    e.stopPropagation();
    e.preventDefault();
    if($(window).width() < 501 && $('.forumFilterContainer').length){
      $("body").addClass("mobile-drop");
      store.setItem("select2",true);
      if(!$(".select2-dropdown .select2-search i.close-drop").length){
        $(".select2-dropdown .select2-search").append('<i class="fa fa-times-circle close-drop" aria-hidden="true"></i>');
      }
    }
    else{
      $("body").removeClass("mobile-drop");
      $(".select2-dropdown .select2-search i.close-drop").remove();
    }
    // $('.mobile-drop .select2-container--default .select2-results > ul.select2-results__options').css("max-height","calc(100% - 60px)");
  });

  $('.forumFilterContainer').on('select2:selecting', function(e){
    if(store.getItem("select2") === true){
      e.stopPropagation();
      e.preventDefault();
      store.removeItem("select2");
    }
    // $('.mobile-drop .select2-container--default .select2-results > ul.select2-results__options').css("max-height","calc(100% - 60px)");
  });

  $('.forumFilterContainer').on('select2:close', function(e){
  store.removeItem("select2");
    // $('.mobile-drop .select2-container--default .select2-results > ul.select2-results__options').css("max-height","calc(100% - 60px)");
  });
  $(document).on("click", ".select2-dropdown .select2-search i.close-drop", function(){
    var targetSelect = $(this).closest('span').siblings('span').find('ul').attr('id');
    var tartgetId = targetSelect.substring(targetSelect.indexOf("-")+1, targetSelect.lastIndexOf("-"));
    tartgetIdNew = `#${tartgetId}`;
    $(".select2-dropdown .select2-search i.close-drop").remove();
    $(tartgetIdNew).select2('close');
    $("body").removeClass("mobile-drop");
  })
})(jQuery);

var recognition = function () {    var cin = "";    var reg_id = "";    var referenceNo = "";    var lastSavedSection = "";    var formData = new FormData();    var isValidated = true;    var validationMsg = "";    var tableContent;    var appStatus;    var saveBtn;    var alLeastInfoRequired = true;    var empWelInfoRequired = true;    var authToken = store.getItem("token");    var $nature_entity = $("select[name='entity_type']");    var $industry_id = $("select[name='industry_id']");    var $section = $("select[name='section']");    var $categories_id = $("select[name='categories_id']");    var $state_id = $('#state_name');    var $incorp_number = $("input[name='incorp_number']");    var $incorp_date = $("input[name='incorp_date']");    var $entity_name = $("input[name='entity_name']");    var $funded_or_bootstrapped_file = $("input[name='upload_funded_or_bootstrapped_file']");    var $upload_award_recognization_entity = $("input[name='upload_award_recognization_entity']");    var $funded_or_bootstrapped = $("input[name='funded_or_bootstrapped']");    var $submitRecognitionForm = $("input[name='submitRecognitionForm']");    $('input[name=upload_funded_or_bootstrapped_file]').closest('.fileuploadMultipurpose.baseformfield').addClass('display-n');    addmoreupload();    fetchTableData("startup_natureof_entity", null, entityNatureCallBack);    function addmoreupload() {        var $uploadRow = $("#moreupload .upload-row");        $(".demo-linkOrDocTemplate").find("a.removeFile").parent().addClass("display-n");        var linknDocTemplate = $(".demo-linkOrDocTemplate").first().html();        $uploadRow.append(linknDocTemplate);        $.each($uploadRow.find(".form-group"), function (index) {            $(this).find("select").attr("name", "selfcertification[" + (index + 1) + "]");            $(this).find(".add_doc_desc input[type='text']").attr("name", "docAsText[" + (index + 1) + "]");            $(this).find(".add_doc_file input[type='file']").attr("name", "docAsFile[" + (index + 1) + "]");            $(this).find(".add_doc_file input[type='text']").attr("name", "docAsFileName[" + (index + 1) + "]");        });    }    $(".accordionitem:first").find(".accordion-section-title").addClass("active");    $(".accordionitem:first").find(".accordion-section-content").addClass("open").show();    $("input[name='saveCertificate']").attr("disabled", "disabled");    $("input[name='SaveEntity']").attr("disabled", "disabled");    $submitRecognitionForm.attr("disabled", "disabled");    $("#no_dir").on("change", function () {        var directorCount = parseInt($(this).val());        var $tableRows = $("#dataTable tbody tr");        var directorLength = $tableRows.length;        if (directorCount > directorLength) {            var td = $(".tableContent").find("td");            for (var i = directorLength + 1; i <= directorCount; i++) {                addDirectorTable(td, i);            }        } else {            $tableRows.slice(directorCount).remove();        }    });    $funded_or_bootstrapped.on("change", function () {        if ($(this).prop("checked") == true) {            $funded_or_bootstrapped_file.parents(".form-group").removeClass("display-n");        } else {            $funded_or_bootstrapped_file.parents(".form-group").addClass("display-n");        }    });    $("input[name='certify']").on("change", function () {        if ($("input[name='certify']:checked").length > 0) {            $("input[name='saveCertificate']").removeAttr("disabled");        } else {            $("input[name='saveCertificate']").attr("disabled", "disabled");        }    });    $("input[name='subsidiary-certify']").on("change", function () {        if ($("input[name='subsidiary-certify']:checked").length > 0) {            $("input[name='SaveEntity']").removeAttr("disabled");        } else {            $("input[name='SaveEntity']").attr("disabled", "disabled");        }    });    $("select[name='state_name']").on("change", function (event, data) {        var state_id = $("select[name=state_name]").val();        if (data && state_id) {            fetchTableData("district_master", "state_id = " + state_id, districtCallBack, data.retrievedData);        } else if (state_id) {            fetchTableData("district_master", "state_id = " + state_id, districtCallBack);        }    });    $("select[name='district_id']").on("change", function (event, data) {        var district_id = $("select[name=district_id]").val();        if (data && district_id) {            fetchTableData("subdistrict_master", "district_id = " + district_id, subDistrictCallBack, data.retrievedData);        } else if (district_id) {            fetchTableData("subdistrict_master", "district_id = " + district_id, subDistrictCallBack);        }    });    $("input[name='terms']").on("change", function () {        if (authToken && $("input[name='terms']:checked").length > 0) {            $submitRecognitionForm.removeAttr("disabled");        } else {            $submitRecognitionForm.attr("disabled", "disabled");        }    });    $industry_id.on("change", function (event, retrievedData) {        var tbl_name = "startup_section";        var industry_id = $("#industry_id option:selected").val();        var tbl_condition_field = "industry_id = " + industry_id;        if (retrievedData) {            fetchTableData(tbl_name, tbl_condition_field, sectorCallBack, retrievedData.sectors);        }        else {            fetchTableData(tbl_name, tbl_condition_field, sectorCallBack);        }    });    function sectorCallBack(data, sector) {        if (data) {            $section.html("<option>Select</option>");            $.each(data, function (i, value) {                $section.append("<option value=" + value.id + ">" + value.section_name + "</option>");            });            if (sector) {                $section.val(sector);            }        }    }    $incorp_number.on("change", function () {        if ($nature_entity.val() != 3) {            var $this = this;            $('#modal-loader').modal('show');            $.ajax({                type: "POST",                dataType: "json",                data: {"incorp_no": $(this).val()},                url: $("#incorporationNoMCA").val(),                success: function (data) {                    if (data._resultflag === "1" && data.message[0].recognization_certi_status != "6") {                        $('#modal-loader').modal('hide');                        if (data.isValidIncorporationNo === "true") {                            $entity_name.val(data.nameEntity).attr("readonly", "readonly").parents(".form-group").removeClass("has-error").find(".help-block").html("");                            var dateSplit = data.incorpdate.split("-");                            if (dateSplit.length === 3) {                                $incorp_date.val(dateSplit[1] + "/" + dateSplit[0] + "/" + dateSplit[2]).attr("readonly", "readonly").parents(".form-group").removeClass("has-error").find(".help-block").html("");                            }                            $($this).parents(".form-group").removeClass("has-error").find(".help-block").html("");                        } else {                            $entity_name.val("").removeAttr("readonly");                            $incorp_date.val("").removeAttr("readonly");                            $($this).parents(".form-group").addClass("has-error").find(".help-block").html("Please enter valid CIN number.")                        }                    }                    else {                        $('#modal-loader').modal('hide');                        if(data.message[0].recognization_certi_status == "6"){                            $($this).parents(".form-group").addClass("has-error").find(".help-block").html("The Recognition of "+data.message[0].entity_name+" has been cancelled " +                                "and the Certificate of Recognition with certificate number "+data.message[0].randum_reg+" has been invalidated.")                        }else {                            $($this).parents(".form-group").addClass("has-error").find(".help-block").html("There is some special character attached with CIN number. Please contact customer care.")                        }                    }                    checkValidity(checkIncorpExists);                },                error: function () {                    $('#modal-loader').modal('hide');                    $($this).parents(".form-group").addClass("has-error").find(".help-block").html("We are facing problems fetching your CIN details. Please try after some time.")                }            });        } else {            checkValidity(checkIncorpExists);        }    });    $("input[name='ipr_type']").on("change", function () {        if ($(this).val() === "1") {            $(".regiFormSection").removeClass("display-n");        } else {            $(".regiFormSection").addClass("display-n");        }    });    $("input[name='patent_type']").on("change, click", function () {        $("input[name='patent_type']").parents("td").removeClass("has-error");        if ($("input[name='patent_type']:checked").length > 0) {            $("input[name='patent_application_no']").parent().removeClass("display-n");        }    });    $("input[name='trademark_type']").on("change, click", function () {        $("input[name='trademark_type']").parents("td").removeClass("has-error");        if ($("input[name='trademark_type']:checked").length > 0) {            $("input[name='trademark_application_no']").parent().removeClass("display-n");        }    });    $("input[name='copyright_type']").on("click", function () {        $("input[name='copyright_type']").parents("td").removeClass("has-error");        if ($("input[name='copyright_type']:checked").length > 0) {            $("input[name='copyright_application_no']").parent().removeClass("display-n");        }    });    $("input[name='design_type']").on("change, click", function () {        $("input[name='design_type']").parents("td").removeClass("has-error");        if ($("input[name='design_type']:checked").length > 0) {            $("input[name='design_application_no']").parent().removeClass("display-n");        }    });    $("input[name='plant_variety_type']").on("click", function () {        $("input[name='plant_variety_type']").parents("td").removeClass("has-error");        if ($("input[name='plant_variety_type']:checked").length > 0) {            $("input[name='plant_variety_application_no']").parent().removeClass("display-n");        }    });    $("input[name='innovative_product_service_type']").on("change", function () {        if ($('input[name=innovative_product_service_type]:checked').val() === "1") {            $(".innovative_product_service_table, #emp_note").removeClass("display-n");            $('span.info-required-error').text("").removeClass("has-error scroll-error");        } else {            if ($('input[name=emp_gen_or_wel_create]:checked').val() === "2") {                $(".innovative_product_service_table, #emp_note").addClass("display-n");            }            $(".innovative_product_service_table").addClass("display-n");        }    });    $("input[name='emp_gen_or_wel_create']").on("change", function () {        if ($('input[name=emp_gen_or_wel_create]:checked').val() === "1") {            $(".business_model_detail #emp_gen_or_wel_create_emp_welth,  #emp_note").removeClass("display-n");            $('span.info-required-error').text("").removeClass("has-error scroll-error");        } else {            if ($('input[name=innovative_product_service_type]:checked').val() === "2") {                $(" #emp_note").addClass("display-n");            }            $(".business_model_detail #emp_gen_or_wel_create_emp_welth").addClass("display-n");        }    });    $("input[name='emp_gen_or_wel_create_emp_welth']").on("change", function () {        if ($("input[name=emp_gen_or_wel_create_emp_welth]:checked").length) {            $('span.emp_wel_error').text("").removeClass("has-error scroll-error");        }    });    $nature_entity.on("change", function () {        $('input[name=incorp_date], input[name=entity_name], input[name=incorp_number]').val('');        if ($(this).val() === "1" || $(this).val() == "2") {            $('input[name=incorp_date]').attr('disabled', 'disabled');            $('input[name=entity_name]').attr({                'disabled': 'disabled',                'readonly': 'true'            });            $('.incorp-cert-2').addClass("display-n");            $('.incorp-cert-1').removeClass("display-n");        } else {            $('input[name=incorp_date]').removeAttr('readonly disabled');            $('input[name=entity_name]').removeAttr('readonly disabled');            $funded_or_bootstrapped.prop("checked", false);            $('.incorp-cert-1').addClass("display-n");            $('.incorp-cert-2').removeClass("display-n");        }        $('input[name=incorp_number]').closest(".form-group").removeClass("has-error").find(".help-block").html("");    });    $(".recognition-self-certification").on('change', "input[type=file][name=incorporation_certificate]", function (event) {        var formats = ["image/jpeg", "image/png", "application/pdf"];        checkFileUpload(formats, this, 5150000);        return false;    });    $(".fileuploadMultipurpose").on('change', "input[type=file]", function (event) {        var formats = ["image/jpeg", "image/png", "application/pdf"];        checkFileUpload(formats, this, 5150000);        return false;    });    $("#moreupload .upload-row").on('change', ".fileUploadField input[type=file]", function (event) {        event.preventDefault();        var formats = ["application/pdf"];        checkFileUpload(formats, this, 5150000);        return false;    });    var saveObject = {        "SaveEntity": {"name": "SaveEntity", "section": 1, "errorMessage": "saveEntityErrorMessage"},        "saveFullAddress": {"name": "saveFullAddress", "section": 2, "errorMessage": "saveAddressErrorMessage"},        "saveAuthorizedReprezentatives": {            "name": "saveAuthorizedReprezentatives",            "section": 3,            "errorMessage": "saveAuthorizedRepErrorMessage"        },        "saveDirectorDetails": {            "name": "saveDirectorDetails",            "section": 4,            "errorMessage": "saveDirectorErrorMessage"        },        "saveRequiredInfo": {"name": "saveRequiredInfo", "section": 5, "errorMessage": "saveRequiredInfoErrorMessage"},        "saveStartupActivity": {            "name": "saveStartupActivity",            "section": 6,            "errorMessage": "saveStartupActivityErrorMessage"        },        "saveCertificate": {"name": "saveCertificate", "section": 7, "errorMessage": "saveCertificateErrorMessage"}    };    var existInRecords = false;    function checkValidity(callback) {        var cin = $('input[name=incorp_number]').val();        checkCINExists(cin);        if (existInRecords) {            console.log("Cin already exists in our database");        }        else {            var tbl_condition_field = "incorporation_no = " + "\'" + $('input[name=incorp_number]').val() + "\'" + " and archive = 0 ";            fetchTableData("startup_registration", tbl_condition_field, callback);        }    }    function checkCINExists(cin) {        $.ajax({            type: "POST",            dataType: "json",            contentType: "application/json",            async: false,            data: JSON.stringify({                "cin": cin            }),            url: SIH.getEndPoint("/api/auth/user/cinValidate"),            headers: {"X-Auth-Token": authToken},            success: function (data) {                if (data.status == false) {                    console.log(data.message);                    $('input[name=incorp_number]').closest(".form-group").addClass("has-error record-error").find(".help-block").html(data.message);                    existInRecords = true;                }            },            error: function () {                console.log("error while fetching data from server");            }        });    }    $("input[value='Save']").click(function () {        isValidated = true;        saveBtn = this;        checkValidity(saveCallback);    });    function submitCallback(data) {        if (Array.isArray(data)) {            checkIncorpExists(data);        } else if ($('input[name=incorp_number]').closest(".form-group").hasClass("has-error")) {            isValidated = false;        }        submitData();    }    function saveCallback(data) {        if (Array.isArray(data)) {            checkIncorpExists(data);        } else if ($('input[name=incorp_number]').closest(".form-group").hasClass("has-error")) {            isValidated = false;        }        saveData();    }    $submitRecognitionForm.click(function () {        isValidated = true;        checkValidity(submitCallback);    });    function saveData() {        var s = saveObject[saveBtn.name];        formData.delete("save_draft");        formData.append("save_draft", "1");        getRecognitionFormData(s.section, s.section, $(saveBtn));        postDataTosilvertouch(saveBtn, s.errorMessage, s.section);    }    function submitData() {        var $this = $submitRecognitionForm;        getRecognitionFormData(0, 0, $("input[name='saveCertificate']"));        formData.delete("incorp_date");        var dateSplit = $incorp_date.val().split("/");        var newDate = dateSplit[2] + "/" + dateSplit[0] + "/" + dateSplit[1];        formData.append("incorp_date", newDate);        formData.delete("terms");        formData.append("terms", ($("input[name='terms']:checked").length > 0) ? 1 : 0);        formData.delete("save_draft");        formData.append("save_draft", "0");        postDataTosilvertouch($this, "submitFormErrorMessage");    }    $("#add-file-field").click(function () {        addmoreupload();    });    $("#moreupload").on("change", ".selectDoc", function (e) {        showHideOption($(this));    });    function getIncorpNo() {        $('#modal-loader').modal('show');        $.ajax({            type: "GET",            async: false,            url: SIH.getEndPoint("/api/auth/user/cin"),            headers: {"X-Auth-Token": authToken}        }).done(function (data) {            if (data || store.getItem("cin")) {                cin = data.cin || store.getItem("cin");                reg_id = data.reg_id;                referenceNo = data.referenceNo;                lastSavedSection = data.lastAccordionSaved;                retrieveRecognitionForm(cin, referenceNo);            }            else {                prepopulateRecognitionForm();            }        });    }    function checkRecognitionApplicationStatus(data) {        $.ajax({            type: "POST",            dataType: "json",            data: {"refno": data[0].reference_no},            url: $("#applicationStatusApi").val(),            success: function (statusData) {                if (statusData._resultflag === "1") {                    var statusCode = statusData.application_status_code;                    console.log("Application Status" + statusData.application_status_code);                    if (statusCode === "4000" || statusCode === "4100" || statusCode === "4020" || statusCode === "4010") {                        appStatus = "Incomplete";                    } else {                        appStatus = "other";                    }                    retrieveFormCallBack(data)                }            }, error: function () {                console.log("error");            }        });    }    function prepopulateRecognitionForm(disableOnly) {        $.ajax({            type: "GET",            async: false,            url: SIH.getEndPoint("/api/auth/user/profile"),            headers: {"X-Auth-Token": store.getItem("token")}        }).done(function (data) {            if (data.user.startup.startupEntity) {                if (disableOnly) {                    $nature_entity.attr("disabled", "disabled").trigger("change");                } else {                    $nature_entity.val(data.user.startup.startupEntity).attr("disabled", "disabled").trigger("change");                }            }            if (data.user.startup.pan) {                $("input[name='pan_number']").val(data.user.startup.pan);            }            if (data.user.startup.cin) {                if (disableOnly) {                    $("input[name='incorp_number']").attr("disabled", "disabled");                } else {                    $("input[name='incorp_number']").val(data.user.startup.cin).trigger("change").attr("disabled", "disabled");                }            }            if (data.user.startup.stage) {                if (disableOnly) {                    $("input[name='dev_of_product_service']").attr("disabled", "disabled");                } else {                    var stage;                    switch (data.user.startup.stage) {                        case "Prototype":                            stage = 1;                            break;                        case "Validation":                            stage = 2;                            break;                        case "EarlyTraction":                            stage = 3;                            break;                        case "Scaling":                            stage = 4;                            break;                    }                    $("input[name='dev_of_product_service'][value=" + stage + "]").prop("checked", true);                    $("input[name='dev_of_product_service']").attr("disabled", "disabled");                }            }        });        $('#modal-loader').modal('hide');    }    function saveFormApplied(applied) {        $.ajax({            type: "GET",            async: false,            url: SIH.getEndPoint("/api/auth/user/cinsave"),            data: {"referenceNo": referenceNo, "reg_id": reg_id, "applied": applied},            headers: {"X-Auth-Token": authToken}        }).done(function (data) {            console.log("record saved");        });    }    function saveIncorpNo(incorpNo, section) {        $.ajax({            type: "POST",            contentType: "application/json",            data: JSON.stringify({                "cin": incorpNo,                "lastAccordionSaved": section,                "reg_id": reg_id,                "referenceNo": referenceNo            }),            url: SIH.getEndPoint("/api/auth/user/cin"),            headers: {"X-Auth-Token": authToken}        }).done(function (data) {            cin = incorpNo;            console.log(incorpNo + " is saved in database.")        });    }    function checkIncorpExists(data) {        if (!$('input[name=incorp_number]').closest(".form-group").hasClass("has-error")) {            validationMsg = "";            if (Array.isArray(data) && ((cin && reg_id && reg_id != data[data.length-1].id) || !cin)) {                $('input[name=incorp_number]').closest(".form-group").addClass("has-error record-error").find(".help-block").html("This CIN already exists. Please enter your CIN in your user profile.");                isValidated = false;            } else {                $('input[name=incorp_number]').closest(".form-group").removeClass("has-error").find(".help-block").html("");            }        } else {            isValidated = false;        }    }    function getRecognitionFormData(tab, section, saveButton) {        alLeastInfoRequired = true;        empWelInfoRequired = true;        var accordianItem = $(saveButton).parents(".accordionitem");        var firstAccordion = $(accordianItem).prevAll().addBack().slice(0, 1);        var firstAccordionFields = $(firstAccordion).find("input.form-control, select.form-control, textarea.form-control");        $.each(firstAccordionFields, function (index, inputSel) {            var key = $(inputSel).attr("name");            if (typeof key !== "undefined") {                var attrValue = $(inputSel).val();                if (attrValue) {                    formData.delete(key);                    formData.append(key, attrValue.toString());                }                if (key != "incorp_number") {                    checkRequiredField(attrValue, inputSel);                } else if (!attrValue || attrValue === "") {                    isValidated = false;                    $(inputSel).closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field can't be left Blank.");                }                if (key === "pan_number") {                    var re = new RegExp($(inputSel).attr("regex"));                    if (attrValue && !re.test(attrValue)) {                        isValidated = false;                        $(inputSel).closest(".form-group").find("span.help-block").first().html("");                        $(inputSel).closest(".form-group").addClass("has-error").find("span.regex-msg").show();                    } else {                        $(inputSel).closest(".form-group").removeClass("has-error").find("span.regex-msg").hide();                    }                    formData.delete(key);                    formData.append(key, attrValue);                }                if (key === "incorp_date") {                    var currentDate = new Date();                    var diffYear = diff_years(new Date(attrValue), currentDate);                    if ($(inputSel).val() && diffYear > 10) {                        $(inputSel).closest(".form-group").addClass("has-error");                        $(inputSel).parents(".accordion-section").find(".button").next().find(".has-error").html("");                        isValidated = false;                        validationMsg = "We regret to inform you that your startup does not match the eligibility criteria of incorporation date. Hence, the entity is not eligible for Startup recognition.";                    } else {                        $(inputSel).closest(".form-group").removeClass("has-error");                    }                    var dateSplit = attrValue.split("/");                    var newDate = dateSplit[2] + "/" + dateSplit[0] + "/" + dateSplit[1];                    formData.delete(key);                    formData.append(key, newDate);                }            }        });        if (section === 2 || section === 3 || tab === 0) {            accordianItem = $("input[name='saveFullAddress']").parents(".accordionitem");            var inputField = $(accordianItem).find("input.form-control, select.form-control, textarea.form-control");            $.each(inputField, function (index, inputSel) {                var key = $(inputSel).attr("name");                if (typeof key != "undefined") {                    var attrValue = $(inputSel).val();                    if (attrValue) {                        if (key == "state_name") {                            attrValue = $(inputSel).find("option:selected").text();                        }                        formData.delete(key);                        formData.append(key, attrValue.toString());                    }                    checkRequiredField(attrValue, inputSel);                }            });        }        if (section === 3 || tab === 0) {            accordianItem = $("input[name='saveAuthorizedReprezentatives']").parents(".accordionitem");            var inputFields = $(accordianItem).find("input.form-control, select.form-control, textarea.form-control");            $.each(inputFields, function (index, inputSel) {                var key = $(inputSel).attr("name");                if (typeof key != "undefined") {                    var attrValue = $(inputSel).val();                    if (attrValue) {                        formData.delete(key);                        formData.append(key, attrValue.toString());                    }                    checkRequiredField(attrValue, inputSel);                }            });        }        if (section === 4 || tab === 0) {            var director;            var directorList = [];            var no_dir = $("select[name='no_dir']").val();            formData.delete("no_dir");            formData.append("no_dir", no_dir);            var partnerTable = $("input[name='saveDirectorDetails']").parents(".accordionitem").find(".partnerTable tr");            var partnerTableRow = partnerTable.slice(1, partnerTable.length);            $.each(partnerTableRow, function (i, value) {                var inputField = $(value).find("input.form-control, select.form-control, textarea.form-control");                director = {};                $.each(inputField, function (index, inputSel) {                    var key = $(inputSel).attr("name");                    if (typeof key != "undefined") {                        var attrValue = $(inputSel).val();                        if (attrValue) {                            director[key.slice(0, key.length - ((i + 1) < 10 ? 3 : 4))] = attrValue.toString();                            $(inputSel).closest("td").removeClass("has-error").find("span.help-block").first().html("");                        } else {                            isValidated = false;                            $(inputSel).closest("td").addClass("has-error").find("span.help-block").first().html("This Field can't be left Blank.");                        }                        if (key.indexOf("email") === 0) {                            var emailReg = new RegExp($(inputSel).attr("regex"));                            if (attrValue && !emailReg.test(attrValue)) {                                isValidated = false;                                $(inputSel).closest("td").addClass("has-error").find("span.regex-msg").show();                            }                        }                    }                });                directorList.push(JSON.stringify(director));            });            if (directorList.length === parseInt(no_dir)) {                formData.delete("directors");                formData.append("directors", ("{\"Directors\": [" + directorList.toString() + "]}").replace(/\\/g, ""));                $(".saveDirectorErrorMessage").html("").removeClass("has-error scroll-error");            } else {                isValidated = false;                $(".saveDirectorErrorMessage").html("Please fill Details of all the Directors.").addClass("scroll-error");            }        }        if (section === 5 || tab === 0) {            accordianItem = $("input[name='saveRequiredInfo']").parents(".accordionitem");            var inputSelection = $(accordianItem).find("input[name='current_no_employee']");            var attrValue = $(inputSelection).val();            checkRequiredField(attrValue, inputSelection);            if (attrValue && $("input[name='current_no_employee']").val() < 1) {                isValidated = false;                inputSelection.closest(".form-group").addClass("has-error").find("span.help-block").first().html("Please enter only number");            }            else if (attrValue) {                formData.delete("current_no_employee");                formData.append("current_no_employee", attrValue.toString());            }            checkAtLeastOneInfoRequired();            checkScalableBusinessModelRequired();            infoRequiredData(accordianItem, "dev_of_product_service");            infoRequiredData(accordianItem, "ipr_type");            if ($("input[name='ipr_type']:checked").val() === "1") {                if ($(".ipr-table input[type='radio']:checked").length === 0) {                    isValidated = false;                    $(".ipr-table").addClass("has-error").find("span.help-block").html("Please fill at least 1 of these fields.");                } else {                    $(".ipr-table").removeClass("has-error").find("span.help-block").html("");                }                //infoRequiredData(accordianItem, "patent_type");                var $patent_application_no = $("input[name='patent_application_no']");                if ($("input[name='patent_type']:checked").length > 0 && $patent_application_no.val() !== "") {                    formData.delete("patent_application_no");                    formData.append("patent_application_no", $patent_application_no.val());                    $patent_application_no.parents("td").removeClass("has-error");                } else if ($("input[name='patent_type']:checked").length === 0 && $patent_application_no.val() === "") {                    $patent_application_no.parents("td").removeClass("has-error");                } else {                    isValidated = false;                    if ($("input[name='patent_type']:checked").length === 0) {                        $("input[name='patent_type']").parents("td").addClass("has-error");                    }                    $patent_application_no.parents("td").addClass("has-error");                }                infoRequiredData(accordianItem, "trademark_type");                var $trademark_application_no = $("input[name='trademark_application_no']");                if ($("input[name='trademark_type']:checked").length > 0 && $trademark_application_no.val() !== "") {                    formData.delete("trademark_application_no");                    formData.append("trademark_application_no", $trademark_application_no.val());                    $trademark_application_no.parents("td").removeClass("has-error");                } else if ($("input[name='trademark_type']:checked").length === 0 && $trademark_application_no.val() === "") {                    $trademark_application_no.parents("td").removeClass("has-error");                } else {                    isValidated = false;                    if ($("input[name='trademark_type']:checked").length === 0) {                        $("input[name='trademark_type']").parents("td").addClass("has-error");                    }                    $("input[name='trademark_application_no']").parents("td").addClass("has-error");                }                infoRequiredData(accordianItem, "copyright_type");                var $copyright_application_no = $("input[name='copyright_application_no']");                if ($("input[name='copyright_type']:checked").length > 0 && $copyright_application_no.val() !== "") {                    formData.delete("copyright_application_no");                    formData.append("copyright_application_no", $copyright_application_no.val());                    $copyright_application_no.parents("td").removeClass("has-error");                } else if (!($("input[name='copyright_type']:checked").length === 0 && $copyright_application_no.val() === "")) {                    isValidated = false;                    if ($("input[name='copyright_type']:checked").length === 0) {                        $("input[name='copyright_type']").parents("td").addClass("has-error");                    }                    $copyright_application_no.parents("td").addClass("has-error");                }                infoRequiredData(accordianItem, "design_type");                var $design_application_no = $("input[name='design_application_no']");                if ($("input[name='design_type']:checked").length > 0 && $design_application_no.val() !== "") {                    formData.delete("design_application_no");                    formData.append("design_application_no", $design_application_no.val());                    $design_application_no.parents("td").removeClass("has-error");                } else if (!($("input[name='design_type']:checked").length === 0 && $design_application_no.val() === "")) {                    isValidated = false;                    if ($("input[name='design_type']:checked").length === 0) {                        $("input[name='design_type']").parents("td").addClass("has-error");                    }                    $design_application_no.parents("td").addClass("has-error");                }                infoRequiredData(accordianItem, "plant_variety_type");                var $plant_variety_application_no = $("input[name='plant_variety_application_no']");                if ($("input[name='plant_variety_type']:checked").length > 0 && $plant_variety_application_no.val() !== "") {                    formData.delete("plant_variety_application_no");                    formData.append("plant_variety_application_no", $plant_variety_application_no.val());                    $plant_variety_application_no.parents("td").removeClass("has-error");                } else if (!($("input[name='plant_variety_type']:checked").length === 0 && $plant_variety_application_no.val() === "")) {                    isValidated = false;                    if ($("input[name='plant_variety_type']:checked").length === 0) {                        $("input[name='plant_variety_type']").parents("td").addClass("has-error");                    }                    $plant_variety_application_no.parents("td").addClass("has-error");                }            }            infoRequiredData(accordianItem, "innovative_product_service_type");            if ($("input[name='innovative_product_service_type']:checked").val() === "1") {                infoRequiredData(accordianItem, "product_type");                infoRequiredData(accordianItem, "service_type");                infoRequiredData(accordianItem, "process_type");                if ($(".innovative_product_service_table input[type='radio']:checked").length === 0) {                    isValidated = false;                    $(".innovative_product_service_table").addClass("has-error").find("span.help-block").html("Please fill at least 1 of these fields.");                } else {                    $(".innovative_product_service_table").removeClass("has-error").find("span.help-block").html("");                }                checkRequiredField($("textarea[name='emp_gen_note']").val(), $("textarea[name='emp_gen_note']"));                formData.delete("emp_gen_note");                formData.append("emp_gen_note", $("textarea[name='emp_gen_note']").val());            }            infoRequiredData(accordianItem, "emp_gen_or_wel_create");            if ($("input[name='emp_gen_or_wel_create']:checked").val() === "1") {                var emp_wel_gen = [];                $.each($("input[name='emp_gen_or_wel_create_emp_welth']:checked"), function (i, value) {                    emp_wel_gen.push($(value).val());                });                if (emp_wel_gen.length > 0) {                    formData.delete("emp_gen_or_wel_create_emp_welth");                    formData.append("emp_gen_or_wel_create_emp_welth", emp_wel_gen.toString());                }                checkRequiredField($("textarea[name='emp_gen_note']").val(), $("textarea[name='emp_gen_note']"));                formData.delete("emp_gen_note");                formData.append("emp_gen_note", $("textarea[name='emp_gen_note']").val());            } else {                formData.delete("emp_gen_or_wel_create_emp_welth");                formData.append("emp_gen_or_wel_create_emp_welth", "");            }            if ($("input[name='innovative_product_service_type']:checked").val() !== "1" && $("input[name='emp_gen_or_wel_create']:checked").val() !== "1") {                formData.delete("emp_gen_note");                formData.append("emp_gen_note", "");            }            infoRequiredData(accordianItem, "funded_or_bootstrapped");            if ($funded_or_bootstrapped.prop("checked") === true) {                if ($funded_or_bootstrapped_file.val() === "") {                    if ($funded_or_bootstrapped_file.parents(".form-group").find('a').html() === "") {                        isValidated = false;                        $funded_or_bootstrapped_file.parents(".form-group").addClass("has-error").find(".help-block").html("This field can't be left Blank.");                    } else {                        formData.delete("file_proof_funding");                        formData.append("file_proof_funding", $funded_or_bootstrapped_file.parents(".form-group").find('a').html());                        $funded_or_bootstrapped_file.parents(".form-group").removeClass("has-error").find(".help-block").html("");                    }                } else {                    formData.delete("file_proof_funding");                    formData.append("file_proof_funding", $funded_or_bootstrapped_file[0].files[0]);                    $funded_or_bootstrapped_file.parents(".form-group").removeClass("has-error").find(".help-block").html("");                }            } else {                formData.delete("file_proof_funding");                formData.delete("funded_or_bootstrapped_file");            }        }        if (section === 6 || tab === 0) {            accordianItem = $("input[name='saveStartupActivity']").parents(".accordionitem");            var sectioninputFields = $(accordianItem).find("textarea.form-control");            $.each(sectioninputFields, function (index, inputSel) {                var key = $(inputSel).attr("name");                if (typeof key != "undefined") {                    var attrValue = $(inputSel).val();                    if (attrValue) {                        formData.delete(key);                        formData.append(key, attrValue.toString());                    }                    checkRequiredField(attrValue, inputSel);                }            });            if ($('textarea[name=award_recognization_entity_name]').val() && $upload_award_recognization_entity.val() === "" && $upload_award_recognization_entity.parents(".form-group").find('a').html() === "") {                isValidated = false;                $upload_award_recognization_entity.closest(".form-group.file-upload").addClass("has-error").find(".help-block").html("Please Upload awards file");            } else {                $upload_award_recognization_entity.parents(".form-group").removeClass("has-error").find(".help-block").html("");            }            if ($upload_award_recognization_entity.val() === "") {                if ($upload_award_recognization_entity.parents(".form-group").find('a').html() != "") {                    formData.delete("award_recognization_entity");                    formData.append("award_recognization_entity", $upload_award_recognization_entity.parents(".form-group").find('a').html());                    $upload_award_recognization_entity.parents(".form-group").removeClass("has-error").find(".help-block").html("");                } else {                    formData.delete("award_recognization_entity")                }            } else {                formData.delete("award_recognization_entity");                formData.append("award_recognization_entity", $upload_award_recognization_entity[0].files[0]);                $upload_award_recognization_entity.parents(".form-group").removeClass("has-error").find(".help-block").html("");            }        }        if (section === 7 || tab === 0) {            accordianItem = $("input[name='saveCertificate']").parents(".accordionitem");            var selfCertificate;            var selfCertificateList = [];            var incorp_certificate = $(accordianItem).find("input[name='incorporation_certificate']");            if ($(incorp_certificate).val() === "" || $(incorp_certificate).parents(".form-group").hasClass("has-error")) {                var incorp_certi_file = $(accordianItem).find(".incorporation_certificate_filename a");                if ($(incorp_certi_file).html() !== "") {                    formData.delete("incorporation_certificate");                    formData.append("incorporation_certificate", $(incorp_certi_file).html());                    $(incorp_certi_file).parents(".form-group").removeClass("has-error").find(".help-block").html("");                } else {                    isValidated = false;                    $(incorp_certificate).parents(".form-group").addClass("has-error").find(".help-block").html("This field can't be left Blank.");                }            } else {                formData.delete("incorporation_certificate");                formData.append("incorporation_certificate", incorp_certificate[0].files[0]);                $(incorp_certificate).parents(".form-group").removeClass("has-error").find(".help-block").html("");            }            checkAdditionalDocsValidation();            var oth = 0;            var docLinksArray = $(accordianItem).find("#moreupload .upload-row").children();            $.each(docLinksArray, function (index, value) {                selfCertificate = {};                var inputDoc = $(value).find("input");                $.each(inputDoc, function (i, val) {                    var $selfCertiDoc = $(val).parents(".selfCertiDoc");                    if (!$selfCertiDoc.hasClass("display-n")) {                        selfCertificate["name"] = $(value).find("select").val();                        if ($selfCertiDoc.hasClass("add_doc_file")) {                            if ($(val).prop("type") === "text" && $(val).val() !== "") {                                selfCertificate["value"] = $(val).val();                            } else if (val.files) {                                if (val.files.length > 0) {                                    oth = oth + 1;                                    selfCertificate["value"] = "Other" + oth;                                    formData.delete("Other" + oth);                                    formData.append("Other" + oth, val.files[0]);                                    $(val).closest('.add_doc_file').removeClass('has-error');                                } else if (!$(val).parent().hasClass('display-n')) {                                    isValidated = false;                                    $(val).closest('.add_doc_file').addClass('has-error');                                }                            }                        } else {                            if (!$(val).val()) {                                isValidated = false;                                $(val).closest('.add_doc_desc').addClass('has-error');                            } else if ($(val).val() && !($(val).val().startsWith("https") || $(val).val().startsWith("http"))) {                                isValidated = false;                                $(val).closest('.add_doc_desc').find('.help-block').html('Link should start with either http or https');                                $(val).closest('.add_doc_desc').addClass('has-error');                            }                            else {                                $(val).closest('.add_doc_desc').removeClass('has-error');                            }                            selfCertificate["value"] = $(val).val();                        }                    }                });                if (!jQuery.isEmptyObject(selfCertificate)) {                    selfCertificateList.push(JSON.stringify(selfCertificate));                }            });            if (selfCertificateList.length > 0) {                formData.delete("selfcertification");                formData.append("selfcertification", ("{\"SelfCertification\" : [" + selfCertificateList.toString() + "]}").replace(/\\/g, ""));            }            if ($("input[name='certify']:checked").val() != "1") {                isValidated = false;                $("input[name='certify']").parents(".form-group").addClass('certify-has-error')            } else {                $("input[name='certify']").parents(".form-group").removeClass("certify-has-error");            }        }        checkTextareaWordLimit();        formData.delete("");    }    function checkTextareaWordLimit() {        $('textarea:not(.director_detail_data_address)').each(function () {            if ($(this).val() && $(this).val().match(/\S+/g).length < 50 && $(this).attr("name") != "award_recognization_entity_name") {                isValidated = false;                $(this).closest(".form-group").addClass('has-error');                $(this).closest(".form-group").find('.help-block').html('Please elaborate further with more information in mininum 50 words.');            } else if ($(this).val() && $(this).val().match(/\S+/g).length > 250) {                isValidated = false;                $(this).closest(".form-group").addClass('has-error');                $(this).closest(".form-group").find('.help-block').html('You have crossed the maximum word limit. Please shorten to under 250 words.');            } else if (isValidated) {                $(this).closest(".form-group").removeClass('has-error');                $(this).closest(".form-group").find('.help-block').html('');            }        });    }    function checkAdditionalDocsValidation() {        if ($("input[name='dev_of_product_service']:checked").val() !== "1") {            var valid = false;            $("#moreupload input, #moreupload select").each(function (id, val) {                if ($(this).val()) {                    valid = true;                }            });            if (!valid) {                if ($("#moreupload").parent().find('.additional-doc-error-span').length === 0) {                    $("#moreupload").parent().append("<span class='help-block additional-doc-error-span'>Additional Document is mandatory</span>");                }                $("#moreupload").closest('.form-group').addClass('has-error');                isValidated = false;            } else {                $("#moreupload").parent().children("span.additional-doc-error-span").remove();                $("#moreupload").closest('.form-group').removeClass('has-error');            }        }    }    function checkScalableBusinessModelRequired() {        var businessModelType = $("input[name=emp_gen_or_wel_create]:checked").val();        if (businessModelType === "1" && $("input[name=emp_gen_or_wel_create_emp_welth]:checked").length === 0) {            empWelInfoRequired = false;            isValidated = false;        } else {            empWelInfoRequired = true;        }    }    function checkAtLeastOneInfoRequired() {        var innovativeProductServiceType = $("input[name=innovative_product_service_type]:checked").val();        var businessModelType = $("input[name=emp_gen_or_wel_create]:checked").val();        if (innovativeProductServiceType === "2" && businessModelType === "2") {            isValidated = false;            alLeastInfoRequired = false;        } else {            alLeastInfoRequired = true;        }    }    function checkRequiredField(attrValue, inputSel) {        var requiredField = $(inputSel).closest(".row").find("sup.required");        var re = new RegExp($(inputSel).attr("regex"));        if (requiredField && requiredField.length > 0 && (!attrValue || attrValue === "")) {            isValidated = false;            $(inputSel).closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field can't be left Blank.");        } else if (attrValue && !re.test(attrValue)) {            isValidated = false;            if (!$(inputSel).closest(".form-group").find("span.help-block").hasClass("ipr-table-block")) {                $(inputSel).closest(".form-group").find("span.help-block").first().html("");                $(inputSel).closest(".form-group").addClass("has-error").find("span.regex-msg").show();            }        } else if (!$(inputSel).closest(".form-group").hasClass("record-error")) {            if (!$(inputSel).closest(".form-group").find("span.help-block").hasClass("ipr-table-block")) {                $(inputSel).closest(".form-group").removeClass("has-error").find("span.help-block, span.regex-msg").first().html("");            }        }    }    function checkFileUpload(selectedFormats, fileToValidate, size) {        var message = "";        if ($(fileToValidate).val() !== "") {            if (fileToValidate.files[0].size > size) {                message = "File Should not be greater then " + Math.floor(size / 1024000) + " MB.";            }            if (jQuery.inArray(fileToValidate.files[0].type, selectedFormats) === -1) {                var fileTypes = [];                $.each(selectedFormats, function (i, val) {                    fileTypes.push(" " + val.split("/")[1]);                });                message = message + " Please upload" + fileTypes.toString() + " file formats.";            }            if (message !== "") {                isValidated = false;                $(fileToValidate).siblings(".help-block").html(message).parents(".form-group").addClass("has-error");                $(fileToValidate).val("");                $(fileToValidate).siblings(".fileName").val("");                $(fileToValidate).siblings(".fileDisplayName").val("");                $(fileToValidate).siblings("a.presentationLink").addClass("display-n");            } else {                $(fileToValidate).closest(".form-group").find('.incorporation_certificate_filename').addClass("display-n");                $(fileToValidate).siblings("a.presentationLink").addClass("display-n");                $(fileToValidate).siblings(".help-block").html("");                $(fileToValidate).parents(".form-group").first().removeClass("has-error");            }        }    }    function infoRequiredData(accordianItem, fieldName) {        var inputSelection = $(accordianItem).find("input[name='" + fieldName + "']:checked");        var attrValue = $(inputSelection).val();        if (attrValue) {            formData.delete(fieldName);            formData.append(fieldName, attrValue.toString());        }        checkRequiredField(attrValue, $(accordianItem).find("input[name='" + fieldName + "']"));    }    $('input[name=dev_of_product_service]').change(function (e) {        var val = $('input[name=dev_of_product_service]:checked').val();        if (val) {            if (val === "1") {                $(this).closest(".form-group").append("<p id='stageCheck' style='color:#a94442'>Startups at Ideation Stage are not eligible for Tax Benefits</p>");            } else {                $('#stageCheck').remove();            }        }    });    /**     * step by step sending message to silvertouch.     * @param $this     * @param errorBlock - error message class where error message from silvertouch is displayed     */    function postDataTosilvertouch($this, errorBlock, section) {        if (isValidated) {            $(".has-error.rec-error").html("&nbsp;");            $('#modal-loader').modal('show');            var url = $("#saveApi").val();            if (reg_id) {                formData.delete("reg_id");                formData.append("reg_id", reg_id);            }            formData.delete("is_edited");            formData.delete("status");            formData.delete("cdate");            var date = new Date();            formData.append("cdate", date.toISOString().split('T')[0] + " " + date.toLocaleTimeString());            if (appStatus === "Incomplete") {                formData.append("status", "0");                formData.append("is_edited", "1");            }            formData.delete("webapi_flag");            formData.append("webapi_flag", "1");            $.ajax({                type: "POST",                dataType: "json",                data: formData,                contentType: false,                processData: false,                url: url,                success: function (data) {                    $('#modal-loader').modal('hide');                    if (data._resultflag === '1') {                        $($this).parents(".accordion-section-content").hide();                        var $accItem = $($this).parents(".accordionitem");                        $accItem.find(".accordion-section-title").removeClass("active");                        $accItem.next().find(".accordion-section-title").addClass("active");                        $accItem.next().find(".accordion-section-content").show();                        if (data.reference_no) {                            referenceNo = data.reference_no;                        }                        if (data.reg_id) {                            reg_id = data.reg_id;                        }                        if (errorBlock === "submitFormErrorMessage") {                            saveFormApplied(true);                            $(".recognition-form-submit-message").modal('show');                        } else {                            saveFormApplied(false);                        }                        $("." + errorBlock).html("&nbsp;").addClass("display-n");                        var incorpNo = $("input[name='incorp_number']").val();                        if (incorpNo) {                            saveIncorpNo(incorpNo, section);                        }                    } else {                        $("." + errorBlock).html(data.message).removeClass("display-n");                    }                },                error: function () {                    $('#modal-loader').modal('hide');                    if (errorBlock === "submitFormErrorMessage") {                        $(".recognition-form-error-message").modal('show');                    }                }            });        } else {            if (($($this).attr('name') === 'saveRequiredInfo' || $($this).attr('name') === "submitRecognitionForm") && !alLeastInfoRequired) {                $('span.info-required-error').text("We regret to inform you that your Startup does not match the criteria. A startup must be working towards innovation, development or improvement of products or processes or services, or must have a scalable business model with a high potential of employment generation or wealth creation. Kindly select at least one of the above options to get recognised with Startup India.").addClass("scroll-error");            } else if (($($this).attr('name') === 'saveRequiredInfo' || $($this).attr('name') === "submitRecognitionForm") && !empWelInfoRequired) {                $('span.emp_wel_error').text("Select atleast one from the above options").addClass("scroll-error");            } else {                $('span.info-required-error , span.emp_wel_error').text("").removeClass("has-error scroll-error");            }            showRecognitionError($this);        }    }    function showRecognitionError(obj, msg) {        if (!msg && validationMsg) {            msg = validationMsg;        } else if (!msg) {            msg = "There might be some error in your form, please recheck and save again.";        }        $(obj).parents(".button").next().find(".has-error").html(msg).removeClass('display-n');        recognitionScrollTop()    }    function recognitionScrollTop() {        $(".accordionitem").find(".accordion-section-title").removeClass("active").end()            .find(".accordion-section-content").hide();        var _firstErrorElem = $(".form-group.has-error,.scroll-error,.certify-has-error,.add_doc_file.has-error, td.has-error:first, .selfCertiDoc.has-error");        if (_firstErrorElem && _firstErrorElem.offset()) {            _firstErrorElem.closest(".accordionitem").find(".accordion-section-title").addClass("active");            $(".form-group.has-error,.scroll-error,.certify-has-error,td.has-error, .add_doc_file.has-error, .selfCertiDoc.has-error").each(function () {                $(this).closest(".accordionitem").find(".accordion-section-content").show();            });            $('html, body').animate({                scrollTop: _firstErrorElem.offset().top - 120            });        }    }    function addDirectorTable(td, i) {        $(td[0]).html(i);        $(td[1]).find("input").attr("name", "name[" + i + "]");        $(td[2]).find("select").attr("name", "gender[" + i + "]");        $(td[3]).find("input.countryCode").attr("name", "c_code[" + i + "]");        $(td[3]).find("input.contactNo").attr("name", "mobile[" + i + "]");        $(td[4]).find("textarea").attr("name", "address[" + i + "]");        $(td[5]).find("input").attr("name", "email[" + i + "]");        tableContent = $(".tableContent table tbody").html();        $("#dataTable tbody").append(tableContent);        $("#dataTable tbody").find("input, select, textarea").addClass("form-control");    }    $(".startupRecognition .upload-row").on("click", ".form-group a.removeFile", function () {        $(this).closest(".form-group").remove();        var $uploadRow = $("#moreupload .upload-row");        $.each($uploadRow.find(".form-group"), function (index) {            $(this).find("select").attr("name", "selfcertification[" + (index + 1) + "]");            $(this).find(".add_doc_desc input[type='text']").attr("name", "docAsText[" + (index + 1) + "]");            $(this).find(".add_doc_file input[type='file']").attr("name", "docAsFile[" + (index + 1) + "]");            $(this).find(".add_doc_file input[type='file']").attr("name", "docAsFileName[" + (index + 1) + "]");        });    });    function showHideOption($this) {        var addDoc = $($this).val();        var docArea = $($this).parent().next().find(".doc_area");        $(docArea).parent().removeClass("display-n");        $(docArea).parents(".form-group").first().find(".removeFile").parent().removeClass("display-n");        if (addDoc === "Website_link") {            $(docArea).find(".add_doc_desc").removeClass("display-n").next().addClass("display-n");        } else if (addDoc === "videos") {            $(docArea).find(".add_doc_desc").removeClass("display-n").next().addClass("display-n");        } else if (addDoc === "pitch_deck") {            $(docArea).find(".add_doc_file").removeClass("display-n").prev().addClass("display-n");        } else if (addDoc === "patents") {            $(docArea).find(".add_doc_file").removeClass("display-n").prev().addClass("display-n");        } else if (addDoc === "others") {            $(docArea).find(".add_doc_file").removeClass("display-n").prev().addClass("display-n");        }    }    function industryCallBack(data) {        if (data) {            $industry_id.html("<option>Select</option>");            $.each(data, function (i, value) {                $industry_id.append("<option value=" + value.id + ">" + value.industry_name + "</option>");            });        }        else {            $industry_id.next().html("There is some problem in fetching industry.").parents(".form-group").addClass("has-error");        }        fetchTableData("startup_service", null, categoryCallBack);    }    function entityNatureCallBack(data) {        if (data) {            $nature_entity.html("<option>Select</option>");            $.each(data, function (i, value) {                $nature_entity.append("<option value=" + value.id + ">" + value.name + "</option>");            });        }        else {            $nature_entity.next().html("There is some problem fetching entity type.").parents(".form-group").addClass("has-error");        }        fetchTableData("startup_industry", null, industryCallBack);    }    function categoryCallBack(data) {        if (data) {            $categories_id.html("<option>Select</option>");            $.each(data, function (i, value) {                $categories_id.append("<option value=" + value.id + ">" + value.service_name + "</option>");            });        }        else {            $categories_id.next().html("There is some problem in fetching category.").parents(".form-group").addClass("has-error");        }        fetchTableData("state_master", null, stateCallBack);    }    function stateCallBack(data) {        if (data) {            $state_id.html("<option>Select State / Union Territory</option>");            $.each(data, function (i, value) {                var opt = document.createElement('option');                opt.textContent = value.state_name;                opt.value = value.state_id;                $state_id.append(opt);            });        }        else {            $state_id.next().html("There is some problem in fetching States.").parents(".form-group").addClass("has-error");        }        if (authToken) {            getIncorpNo();        }    }    function retrieveRecognitionForm(incorp_no, refernceNo) {        if (incorp_no) {            var tbl_condition_field = "incorporation_no = " + "\'" + incorp_no + "\'" + "and archive = 0 ";            fetchTableData("startup_registration", tbl_condition_field, retrieveRecognitionFormData);        }    }    function retrieveRecognitionFormData(data) {        if (!$.isArray(data)) {            cin = "";            reg_id = "";            referenceNo = "";            lastSavedSection = "";            prepopulateRecognitionForm();        } else if (data[0].save_draft === "0") {            checkRecognitionApplicationStatus(data);        } else {            retrieveFormCallBack(data)        }    }    function retrieveFormCallBack(data) {        var imageLink = $("#imageLink").val();        if (data) {            // section - 1            $nature_entity.val(data[0].nature_of_entity).trigger("change");            $industry_id.val(data[0].industry).trigger("change", [{"sectors": data[0].section}]);            data[0].servicedata ? $categories_id.val(data[0].servicedata.split(",")).trigger('change') : $categories_id.val(data[0]).trigger('change');            $incorp_number.val(data[0].incorporation_no).trigger("change");            $entity_name.val(data[0].entity_name).attr("disabled", "disabled");            if (data[0].incorporation_date) {                var regDate = data[0].incorporation_date.replace(new RegExp("-", "g"), "/").split("/");                regDate = regDate[1] + "/" + regDate[2] + "/" + regDate[0];                $incorp_date.val(regDate).attr("disabled", "disabled");                // checkTaxAvail(data[0].incorporation_date.replace(new RegExp("-", "g"), "/"), data[0].nature_of_entity);            }            $("input[name='pan_number']").val(data[0].pan_number);            // section - 2            $("input[name='office_address']").val(data[0].office_address);            $("input[name='office_address1']").val(data[0].address2);            $("input[name='office_address2']").val(data[0].address3);            $("input[name='city_name']").val(data[0].city);            fetchTableData("state_master", "state_name = " + "\'" + data[0].state + "\'", setStateCallBack, data[0]);            $("input[name='pin_code']").val(data[0].pin_code);            // section - 3            $("input[name='rep_name']").val(data[0].representative_name);            $("input[name='desg_rep_name']").val(data[0].designation);            if (data[0].rep_mobile) {                if (data[0].rep_mobile.includes("+91-")) {                    const regex1 = /(\+91-)/g;                    $("input[name='mobile_number']").val(data[0].rep_mobile.replace(regex1, ""));                } else {                    $("input[name='mobile_number']").val(data[0].rep_mobile);                }            }            $("input[name='emailId']").val(data[0].rep_email);            // section - 4            if (data[0].no_of_directors > 0) {                $("select[name='no_dir']").val(data[0].no_of_directors);                fetchTableData("startup_directors", "reg_id = " + data[0].id, directorDataCallBack);            }            // section - 5            $("input[name='current_no_employee']").val(data[0].curr_no_of_employee);            $("input[name='dev_of_product_service'][value='" + data[0].dev_of_product_service + "']").prop('checked', true);            $("input[name='ipr_type'][value='" + data[0].applied_for_ipr + "']").prop('checked', true);            if (data[0].applied_for_ipr === "1") {                $(".regiFormSection").removeClass("display-n");                $("input[name='patent_type'][value='" + data[0].patent + "']").prop('checked', true);                if ($("input[name='patent_type']:checked").length > 0) {                    $("input[name='patent_application_no']").val(data[0].patent_ref_no).parent().removeClass("display-n");                }                $("input[name='trademark_type'][value='" + data[0].trademark + "']").prop('checked', true);                if ($("input[name='trademark_type']:checked").length > 0) {                    $("input[name='trademark_application_no']").val(data[0].trademark_ref_no).parent().removeClass("display-n");                }                $("input[name='copyright_type'][value='" + data[0].copyright + "']").prop('checked', true);                if ($("input[name='copyright_type']:checked").length > 0) {                    $("input[name='copyright_application_no']").val(data[0].copyright_ref_no).parent().removeClass("display-n");                }                $("input[name='design_type'][value='" + data[0].design + "']").prop('checked', true);                if ($("input[name='design_type']:checked").length > 0) {                    $("input[name='design_application_no']").val(data[0].design_ref_no).parent().removeClass("display-n");                }                $("input[name='plant_variety_type'][value='" + data[0].plant_variety + "']").prop('checked', true);                if ($("input[name='plant_variety_type']:checked").length > 0) {                    $("input[name='plant_variety_application_no']").val(data[0].plant_variety_ref_no).parent().removeClass("display-n");                }            }            $("input[name='innovative_product_service_type'][value='" + data[0].improving_existing_project + "']").prop('checked', true).trigger("change");            if (data[0].improving_existing_project === "1") {                $(".innovative_product_service_table").removeClass("display-n");                $("input[name='product_type'][value='" + data[0].product + "']").prop('checked', true);                $("input[name='service_type'][value='" + data[0].services + "']").prop('checked', true);                $("input[name='process_type'][value='" + data[0].process + "']").prop('checked', true);                $("textarea[name='emp_gen_note']").val(data[0].emp_gen_note);            }            $("input[name='emp_gen_or_wel_create'][value='" + data[0].emp_gen_or_wel_create + "']").prop('checked', true).trigger("change");            if (data[0].emp_gen_or_wel_create === "1") {                $(".business_model_detail #emp_gen_or_wel_create_emp_welth").removeClass("display-n");                var emp_wel = data[0].emp_gen_or_wel_create_emp_welth.split(",");                for (var i = 0; i < emp_wel.length; i++) {                    $("input[name='emp_gen_or_wel_create_emp_welth'][value='" + emp_wel[i] + "']").prop('checked', true);                }            }            $("input[name='funded_or_bootstrapped'][value=" + data[0].funded_or_bootstrapped + "]").prop('checked', true).trigger("change");            if (data[0].funded_or_bootstrapped_file && data[0].funded_or_bootstrapped === "1") {                var $file_proof_funding = $("input[name=upload_funded_or_bootstrapped_file]").siblings("a");                $file_proof_funding.html(data[0].funded_or_bootstrapped_file).removeClass("display-n");                $file_proof_funding.prop("href", imageLink + data[0].funded_or_bootstrapped_file);                $file_proof_funding.prop("target", "_blank");            }            //  section - 7            $("textarea[name='award_recognization_entity_name']").val(data[0].award_recognization_entity_name);            $("textarea[name='problem_startup_solving']").val(data[0].problem_startup_solving);            $("textarea[name='startup_propose_to_solve_problem']").val(data[0].startup_propose_to_solve_problem);            $("textarea[name='uniqueness_of_your_solution']").val(data[0].uniqueness_of_your_solution);            $("textarea[name='startup_generate_revenue']").val(data[0].startup_generate_revenue);            if (data[0].award_recognization_entity) {                var $award_recognization_entity = $("input[name=upload_award_recognization_entity]").siblings("a");                $award_recognization_entity.html(data[0].award_recognization_entity).removeClass("display-n");                $award_recognization_entity.prop("href", imageLink + data[0].award_recognization_entity);                $award_recognization_entity.prop("target", "_blank");            }            // section - 8            if (data[0].reg_certificate) {                var $incorp_file_link = $(".incorporation_certificate_filename a");                $incorp_file_link.html(data[0].reg_certificate).parent().removeClass("display-n");                $incorp_file_link.prop("href", imageLink + data[0].reg_certificate);                $incorp_file_link.prop("target", "_blank");            }            var $uploadRow = $("#moreupload .upload-row");            if (data[0].additional_doc_type && data[0].additional_doc_type != "null") {                var docTypeArray = $.parseJSON(data[0].additional_doc_type);                for (i = 0; i < docTypeArray.type.length; i++) {                    if (i > 0) {                        addmoreupload();                    }                    if (docTypeArray.type[i] === "weburl") {                        $uploadRow.find("select[name='selfcertification[" + (i + 1) + "]']").val("Website_link").trigger("change");                    } else {                        $uploadRow.find("select[name='selfcertification[" + (i + 1) + "]']").val(docTypeArray.type[i]).trigger("change");                    }                    var $certificationFileUpload = $uploadRow.find("input[name='docAsText[" + (i + 1) + "]'], input[name='docAsFile[" + (i + 1) + "]']");                    $.each($certificationFileUpload, function (index, inputValue) {                        var $selfCertiDoc = $(inputValue).parents(".selfCertiDoc");                        if (!$selfCertiDoc.hasClass("display-n")) {                            if ($selfCertiDoc.hasClass("add_doc_file")) {                                if (docTypeArray.desc[i] === "") {                                    var $inputDocAsFile = $selfCertiDoc.find("input[name='docAsFile[" + (i + 1) + "]']");                                    $inputDocAsFile.parent().removeClass("display-n").prev().addClass("display-n");                                } else {                                    var $inputDocAsFileName = $selfCertiDoc.find("input[name='docAsFileName[" + (i + 1) + "]']");                                    if (docTypeArray.desc[i]) {                                        var docFile = docTypeArray.desc[i].split("/");                                        $inputDocAsFileName.val(docFile[docFile.length - 1]).prop("readonly", "readonly");                                        $selfCertiDoc.find('a.presentationLink').text("View Document").attr("href", imageLink + docFile[docFile.length - 1]).removeClass("display-n");                                        $inputDocAsFileName.parent().removeClass("display-n").next().addClass("display-n");                                    }                                }                            } else {                                $(inputValue).val(docTypeArray.desc[i]);                            }                        }                    });                }            }            var openAccordian = $incorp_number;            $('.accordionitem .number').each(function (index, val) {                if ($(this).html().trim() === lastSavedSection) {                    openAccordian = $(this);                }            });            $(".accordionitem").find(".accordion-section-content").hide();            $(".accordionitem").find(".accordion-section-title").removeClass("active");            $(openAccordian).parents(".accordionitem").find(".accordion-section-title").addClass("active");            $(openAccordian).parents(".accordionitem").find(".accordion-section-content").show();            if (data[0].nature_of_entity === "3") {                $('input[name=incorp_date]').removeAttr('disabled');                $('input[name=entity_name]').removeAttr('readonly disabled');            }        }        if (appStatus === 'Incomplete') {            $("input[value='Save']").hide();            $('.startupRecognition .accordion-section-content').addClass('open').show();            $('input[name=subsidiary-certify]').closest('div.text').hide();            //prepopulateRecognitionForm(true);            $('#modal-loader').modal('hide');        } else if (appStatus === 'other') {            disableRecognitionForm();        } else {            prepopulateRecognitionForm();        }    }    $(document).on("click", '.info-required-reset a', function () {        $('.regiFormSection').find('.radioInput').prop('checked', false);        $('.regiFormSection').find('.commontext').val("").closest('span').addClass('display-n');    });    $(document).on("click", '.innovative_product-reset a', function () {        $('.innovative_product_service_table').find('.radioInput').prop('checked', false);    });    function setStateCallBack(data, retrievedData) {        if (data) {            $("select[name='state_name']").val(data[0].state_id).trigger("change", [{"retrievedData": retrievedData}]);        }    }    function directorDataCallBack(directorsData) {        var td = $(".tableContent").find("td");        for (var i = 0; i < directorsData.length; i++) {            addDirectorTable(td, i + 1);            var director = directorsData[i];            $("input[name='name[" + (i + 1) + "]']").val(director.director_name);            $("select[name='gender[" + (i + 1) + "]']").val(director.gender);            var contact = director.contact_details.replace(/\+91-/g, '');            $("input[name='mobile[" + (i + 1) + "]']").val(contact);            $("textarea[name='address[" + (i + 1) + "]']").val(director.address);            $("input[name='email[" + (i + 1) + "]']").val(director.email);        }    }    function districtCallBack(data, retrievedData) {        if (data) {            var $district = $('select#district_id');            $district.html("<option>Select</option>");            $.each(data, function (i, value) {                $district.append("<option value=" + value.district_id + ">" + value.district_name + "</option>");            });            if (retrievedData && retrievedData.district_id) {                $('select#district_id').val(retrievedData.district_id).trigger("change", [{"retrievedData": retrievedData.subdistrict_id}]);            }        }    }    function sortByKey(array, key) {        return array.sort(function (a, b) {            var x = a[key];            var y = b[key];            return ((x < y) ? -1 : ((x > y) ? 1 : 0));        });    }    function subDistrictCallBack(data, subdistrict_id) {        if (data) {            data = sortByKey(data, "subdistrict_name");            var $subDistrict = $('select#subdistrict_id');            $subDistrict.html("<option>Select</option>");            $.each(data, function (i, value) {                $subDistrict.append("<option value=" + value.subdistrictid + ">" + value.subdistrict_name + "</option>");            });            $subDistrict.html($subDistrict.find('option').sort(function (x, y) {                // to change to descending order switch "<" for ">"                return $(x).text() > $(y).text() ? 1 : -1;            }));            if (subdistrict_id) {                $('select#subdistrict_id').val(subdistrict_id);            }        }    }    function diff_years(dt2, dt1) {        var diff = (dt2.getTime() - dt1.getTime()) / 1000;        diff /= (60 * 60 * 24);        return Math.abs(Math.round(diff / 365.25));    }    $('input[name=funded_or_bootstrapped]').on("change", function () {        if ($(this).val() === "1") {            $('input[name=upload_funded_or_bootstrapped_file]').closest('.fileuploadMultipurpose.baseformfield').removeClass('display-n');        } else {            $('input[name=upload_funded_or_bootstrapped_file]').closest('.fileuploadMultipurpose.baseformfield').addClass('display-n');        }    });};function disableRecognitionForm() {    $('.startupRecognition .accordion-section-content').addClass('open').show();    $('.startupRecognition input[type=text],.startupRecognition input[type=email],.startupRecognition select.form-control,.startupRecognition input[type=number],.startupRecognition input[type=radio],.startupRecognition input[type=file], .startupRecognition textarea').attr("disabled", "disabled");    $('.startupRecognition input[type=button]').hide();    $('.innovative_product-reset, .info-required-reset').hide();    $('#modal-loader').modal('hide');}
var firstTime = true;

var searchFilter = {
    query: "",
    focusSector:  false,
    industries: [],
    sectors: [],
    states: [],
    cities: [],
    stages: [],
    badges: [],
    roles: ['Startup'],
    page: getParameterByName("page") ? getParameterByName("page") : -1,
    sort: {
        "orders": [
            {"field": "registeredOn", "direction": "DESC"}
        ]
    },
    internationalUser: false
};

var emptySearchFilter = {
    query: "",
    focusSector:  false,
    industries: [],
    sectors: [],
    states: [],
    cities: [],
    stages: [],
    badges: [],
    roles: [],
    page: 0,
    sort: {
        "orders": [
            {"field": "registeredOn", "direction": "DESC"}
        ]
    },
    internationalUser: false
};
var sendSearchQuery = null;

function savedQueryFn() {
    var savedQuery = location.search.substr(1);
    if (savedQuery) {
        savedQuery = savedQuery.trim();
    }
    if (savedQuery && location.href.indexOf('code') < 0) {
        var queryParam = getUrlParameter('query');
        var pageParam = getUrlParameter('page');
        if (queryParam) {
            queryParam = queryParam.trim();
        }
        if ((queryParam != null && savedQuery.split("&").length == 1) || (pageParam && (savedQuery.split("&").length == 1 || (queryParam != null && savedQuery.split("&").length == 2)))) {
            if (queryParam) {
                searchFilter.query = queryParam;
                $("input#search-component").val(queryParam);
            }
        } else {
            var roleParam = getUrlParameter('roles');
            if (roleParam && roleParam.trim()) {
                searchFilter.roles = roleParam.trim().split(' ');
            }
            if (queryParam) {
                searchFilter.query = queryParam;
                $("input#search-component").val(queryParam);
            }
            var industryParam = getUrlParameter('industries');
            if (industryParam && industryParam.length > 0) {
                searchFilter.industries = industryParam.trim().split(' ');
            }
            var sectorParam = getUrlParameter('sectors');
            if (sectorParam && sectorParam.length > 0) {
                searchFilter.sectors = sectorParam.trim().split(' ');
            }
            var stateParam = getUrlParameter('states');
            if (stateParam && stateParam.length > 0) {
                searchFilter.states = stateParam.trim().split(' ');
            }else{
                if(window.location.host.startsWith('goa') && !$('input#international-search').is(':checked')){
                    searchFilter.states[0] = 'sih:location/india/goa';
                }
            }
            var stageParam = getUrlParameter('stages');
            if (stageParam && stageParam.length > 0) {
                searchFilter.stages = stageParam.trim().split(' ');
            }
            var badgeParam = getUrlParameter('badges');
            if (badgeParam && badgeParam.length > 0) {
                searchFilter.badges = badgeParam.trim().split(' ');
            }
            var pageParam = getUrlParameter('page');
            if (pageParam && pageParam.length > 0) {
                searchFilter.page = pageParam;
            }
        }
    }
}

var init = function () {
    savedQueryFn();
    if(store.getItem("international-checkbox") === true){
        $('input#international-search').prop("checked",true);
    }
    setUserTypeList();
    // setBadgesList();
    if($('input#international-search').is(':checked')){
        searchFilter.internationalUser = true;
        $(".search-accordian .location-filter").hide();
        $(".city-filter").hide();
        $("#persona-results").html('');
        // search();
    }

    $(".industry-accordion").on('change', 'input#checkbox-focus-sector', function () {
        searchFilter.focusSector = $(this).is(":checked");
        $("#persona-results").html('');
        searchFilter.page = 0;
        search();
    });

    if (!store.getItem('token') || store.getItem('role') == 'Individual') {
        $('.search-accordian .accordion .accordion-section:eq(0) .accordion-section-content').css('display','block');
    } else {
        $('.filter-main, .focusSector').removeClass('display-n');
        //TODO: trigger My industry checkbox if needed
    }
    if (searchFilter.page > 0) {
        var searchBack = searchFilter.page;
        searchFilter.page = -1;
        for (var i = 0; i <= searchBack; i++) {
            searchNext();
        }
    } else {
        searchFilter.page = 0;
        search(true);
    }
    if(window.location.host.startsWith('goa')){
        $('.location-filter .accordion-section-content').addClass('open').show();
    }
};

var createSearchQuery = function () {
    var queryParamArr = [];
    if (searchFilter.query) {
        queryParamArr.push('query=' + searchFilter.query);
    }
    var industriesStr = spaceSepartedString(searchFilter.industries);
    if (industriesStr && industriesStr.length > 0) {
        queryParamArr.push("industries=" + industriesStr);
    }
    var sectorsStr = spaceSepartedString(searchFilter.sectors);
    if (sectorsStr && sectorsStr.length > 0) {
        queryParamArr.push("sectors=" + sectorsStr);
    }
    var locationsStr = spaceSepartedString(searchFilter.states);
    if (locationsStr && locationsStr.length > 0) {
        queryParamArr.push("states=" + locationsStr);
    }
    var stagesStr = spaceSepartedString(searchFilter.stages);
    if (stagesStr && stagesStr.length > 0) {
        queryParamArr.push("stages=" + stagesStr);
    }
    var badgesStr = spaceSepartedString(searchFilter.badges);
    if (badgesStr && badgesStr.length > 0) {
        queryParamArr.push("badges=" + badgesStr);
    }
    var rolesStr = spaceSepartedString(searchFilter.roles);
    if (rolesStr && rolesStr.length > 0) {
        queryParamArr.push('roles=' + rolesStr);
    }
    queryParamArr.push('page=' + searchFilter.page);
    if(!store.getItem("token")) {
        (sihAuthToken = getUrlParameter("sih_auth_token")) && queryParamArr.push('sih_auth_token=' + sihAuthToken);
        (loginType = getUrlParameter("login_type")) && queryParamArr.push('login_type=' + loginType);
    }
    var sendQuery = '';
    if (queryParamArr.length > 0) {
        for (var i = 0; i < queryParamArr.length; i++) {
            if (i == 0) {
                sendQuery = sendQuery + ('?' + queryParamArr[i]);
            } else {
                sendQuery = sendQuery + ('&' + queryParamArr[i]);
            }
        }
    }
    return sendQuery;
};

var spaceSepartedString = function (arr) {
    var str = '';
    if (arr && arr.length > 0) {
        for (var i = 0; i < arr.length; i++) {
            if (i == arr.length - 1) {
                str += arr[i];
            } else {
                str += (arr[i] + ' ');
            }
        }
    }
    return str;
};

var updateSearchFilter = function (value, filterAttr, isAdd, replaceValue) {
    if (filterAttr != 'personalizedSearch') {
        if (isAdd) {
            if (searchFilter[filterAttr].indexOf(value) == -1) {
                if(replaceValue){
                    searchFilter[filterAttr] = value;
                }else{
                    searchFilter[filterAttr].push(value);
                }
            }
        } else {
            var indexOfElement = searchFilter[filterAttr].indexOf(value);
            if (indexOfElement >= 0) {
                searchFilter[filterAttr].splice(indexOfElement, 1);
            }
        }
    }
    searchFilter.page = 0;
};

var clearSearchFilter = function () {
    searchFilter.states = [];
    searchFilter.industries = [];
    searchFilter.sectors = [];
    searchFilter.roles = [];
    searchFilter.stages = [];
    searchFilter.badges = [];
    searchFilter.page = -1;
};

var getSearchUrl = function () {
    if(store.getItem("token")){
        return SIH.getEndPoint('/api/auth/search/profiles');
    }else{
        return SIH.getEndPoint('/api/noauth/search/profiles');
    }
};

function handleSelectedFilterSpans(filterValue, filterText, addFilter, isMyIndustryComp) {
    if (addFilter) {
        if (!$("span.selected-filter[data-value='" + filterValue + "']").length) {
            if(isMyIndustryComp){
                $("span.selected-filters").append("<span class='selected-filter myIndustryComp' data-value='" + filterValue + "'>" + filterText + "<i class='fa fa-times filterRemove' onclick='removeFilter(this);'></i></span>");
            }else{
                $("span.selected-filters").append("<span class='selected-filter' data-value='" + filterValue + "'>" + filterText + "<i class='fa fa-times filterRemove' onclick='removeFilter(this);'></i></span>");
            }
        }
    } else {
        var $filterSpan = $(".selected-filter[data-value='" + filterValue + "']");
        if($filterSpan.hasClass("myIndustryComp")){
            $("input#checkbox-focus-sector").prop("checked", false);
            searchFilter.focusSector = false;
        }
        $filterSpan.remove();
    }
    if($("span.selected-filters .selected-filter").length > 0){
        $("span.selected-filter.clear-all").removeClass("hidden");
        $(".tag-filter-block.filter-container button.hidden").removeClass("hidden");
    }else{
        $("span.selected-filter.clear-all").addClass("hidden");
        $(".tag-filter-block.filter-container button.hidden").addClass("hidden");
    }
}

var renderSearchData = function(data, setFilter) {
    var url = getSearchUrl();
    $.ajax({
        url: url,
        type: 'POST',
        dataType: 'json',
        data: JSON.stringify(emptySearchFilter),
        beforeSend: setAuthTokenHeader,
        success: function (allData) {
            handleSearchData(data,setFilter,allData)
        },
        error: function (allData) {

            $('#modal-loader').modal('hide');
        }
    });
}

var handleSearchData = function (data, setFilters,allData) {
    //Handle data

    var resource = $("#search-result-template").html();
    var template = Handlebars.compile(resource);
    var header;
    var resultText;
    setFilters = true;
    if (data.content.length == 0) {
        if (searchFilter.page == 0) {
            var noResultResource = $("#no-search-result-template").html();
            var noResultTemplate = Handlebars.compile(noResultResource);
            $('.filter-icon , .filter .search-filters-section, .persona-sector thead').css('display', 'none');
            $('#persona-results').html(noResultTemplate());
            $('#search-result-pagination-div').html("");
            header = "";
            $('#loadMore, #loadMoreNew').hide();
        }
    } else {
        setFilters = true;
        $('#persona-results div.page404').hide();
        var queryText = $('.form-control.search').val();
        resultText = $('.search-result-div').attr('result-text');
        if (queryText && resultText) {
            header = queryText + " " + resultText;
        } else {
            header = "";
        }
        // $('.no-search-result').html("");
        $("#persona-results").append(template(data));
        $('.rating').each(function () {
            var ratingEle = "#star" + $(this).attr('data-value');
            $(this).children(ratingEle).prop('checked', true);
        });
    }


    function setFocusSectorFilters(industryFacets) {
        $.each(industryFacets, function (index, facetObj) {
            /*var isMyIndustry = false;
            if(store.getItem("role") === "Startup" && facetObj.value === store.getItem("focusAreas")){
                isMyIndustry = true;
            }else if(store.getItem("role") != "Startup" && store.getItem("focusAreas").includes(facetObj.value)){
                isMyIndustry = true;
            }*/
            handleSelectedFilterSpans(facetObj.value, facetObj.field.value, true, true);

            $("input[value='"+facetObj.value+"']").prop("checked", true);
        });
    }

    var filterListResource = $("#filter-list-template").html();
    var filterTemplate = Handlebars.compile(filterListResource);

    //Reset filters only on page-load OR international-change
    if(setFilters){

        if (!store.getItem('token') || store.getItem('role') == 'Individual') {
            $('.filter .search-filters-section').not('.personalizedSearch').show();
        } else {
            $('.filter .search-filters-section').show();
        }
        $("#industry-filter-container").html(filterTemplate(allData.allFacets['0'].content));
        $("#location-filter-container").html(filterTemplate(allData.allFacets['3'].content));

        var userResource = $("#user-list-template").html();
        var userTemplate = Handlebars.compile(userResource);
        $("#user-filter-container").html(userTemplate(allData.allFacets['5'].content));
        var selectedRole = searchFilter.roles[0] ? searchFilter.roles[0] : "Startup";
        //setSearchRole($(".searchRoleLink[data-value='" + selectedRole + "']"), false);
        var stageContent = allData.allFacets['6'].content;
        if (stageContent && stageContent.length > 0) {
            $("#stage-filter-container").html(userTemplate(stageSorting(stageContent)));
        } else {
            $('#stage-filter-container').parent().hide();
        }
        //handle mobile filter
        if ($(window).width() < 767) {
            $('.filter-icon').css('display', 'block');
            $("#states").html(filterTemplate(allData.allFacets['3'].content));
            $("#industries").html(filterTemplate(allData.allFacets['0'].content));
            $("#roles").html(userTemplate(allData.allFacets['5'].content));
            $("#stages").html(userTemplate(stageSorting(stageContent)));
            $('.search-filter-more, .search-filter-less').css('display', 'none');
        }
    }

    //Since sectors dependent on industry: reset sectors' filter on industry change
    var sectorsData;
    if ((searchFilter.industries.length || searchFilter.focusSector) && (data.allFacets['1'].content && data.allFacets['1'].content.length)) {
        sectorsData = filterTemplate(data.allFacets['1'].content);
    } else if (setFilters){
        /*var facetContent = allData.allFacets['1'].content;
        facetContent.sort(function(a, b){
            var nameA = a.field.value.toLowerCase(), nameB = b.field.value.toLowerCase();
            if (nameA < nameB) {
                return -1;
            } else if (nameA > nameB) {
                return 1;
            } else {
                return 0;
            }
        });
        console.log(facetContent);*/
        sectorsData = filterTemplate(allData.allFacets['1'].content);
    }

    $("#sector-filter-container").html(sectorsData);
    $("#sectors").html(sectorsData);

    setBadgesList();
    if(searchFilter.focusSector){
        setFocusSectorFilters(data.allFacets['0'].content);
    }else{
        $("span.myIndustryComp").remove();
    }

    $(".stats").text(data.totalElements ? data.totalElements : 0);
    setSearchCities(searchFilter.states.length ? data.allFacets['4'].content : allData.allFacets['4'].content);

    //$('table.persona-table, table.other-table').tablesorter();
    //sorting filter list
    sortSearchFilter();
    //Pagination
    /* var pagination = {
     pages: data.totalPages,
     number: data.number + 1,
     last: data.last,
     first: data.first
     }*/
    /*  var paginationResource = $('#pagination-template').html();
     var paginationTemplate = Handlebars.compile(paginationResource);
     $('#search-result-pagination-div').html(paginationTemplate(pagination));

     if (pagination.pages > 5) {
     $('span.first-page,span.last-page').css('display','block');
     if ($('.pagination li.active').index() == 0)
     $('span.first-page').css('display', 'none');
     if ($('.pagination li.active').index() == 4)
     $('span.last-page').css('display', 'none');
     } else {
     $('span.first-page, span.last-page').css('display', 'none');
     }*/
    if (searchFilter.page < data.totalPages - 1) {
        $('#loadMore, #loadMoreNew').show();
        $('.search-load-more').show();
        $('.search-no-more').hide();
    } else {
        $('.search-load-more').hide();
        $('.search-no-more').show();
        $('#loadMore, #loadMoreNew').hide();
    }
    $(".search-heading h2").text(header);

    equalHeights();
    searchWrapHeight = $('.new-search-wrapper').outerHeight();
    $('.left-search-filter').css('min-height',searchWrapHeight);
    $('.new-eco-card.category-card').each(function(){
        marginTop = $(this).outerHeight() - ($(this).find('.top').outerHeight() + $(this).find('.down-dept').outerHeight());
        $(this).find('.down-dept').css('margin-top',marginTop);
    });

    scrollFilters();
};

function getPersonaRoles() {
    var personaRoles = {};
    personaRoles["national"] = ["Startup", "Mentor", "Investor", "Accelerator","Corporate", "Incubator", "Government Body"];
    personaRoles["international"] = ["Startup", "Accelerator", "Investor","Corporate"];
    return personaRoles;
}
function setUserTypeList() {
    var personaRoles = getPersonaRoles();
    var nationality = $("input[name='internationalUser']:checkbox").is(":checked") ? "international" : "national";
    var $selectionList = $("#searchRole").find(".dropdown-content");
    var $selectionSpan = $("#searchRole").find("#searchRoleName");
    $selectionSpan.text("Select");
    $selectionList.find('li').remove();

    $.each(personaRoles[nationality], function (index, persona) {
        var li = "<li><a class='searchRoleLink' href='#' data-value='" + persona + "'>"
            + (persona === "Government Body" ? "Government Bodies" : persona +"s") + "</a></li>";
        $selectionList.append(li);
    });

    if(searchFilter.roles.length){
        if(searchFilter.roles[0]){
            $(".searchRoleLink[data-value='"
                + (searchFilter.roles[0] === "GovernmentBody" ? "Government Body" : searchFilter.roles[0])
                + "']").hide();
        }
        $selectionSpan.text(searchFilter.roles[0] === "GovernmentBody" ? "Government Bodies" : searchFilter.roles[0] +"s");
    }
    $(".searchRoleLink").click(function () {
        setSearchRole($(this), true);
    });
}

function setBadgesList() {
    var data = {};
    $.ajax({
        url: SIH.getEndPoint("/api/noauth/search/badge/get"),
        data: JSON.stringify(data),
        type: 'POST',
        dataType: "json",
        contentType: "application/json",
        success: function (response) {
            if(response){
                response.sort((badge1, badge2) => { if(badge1.title.toLowerCase() > badge2.title.toLowerCase()) return 1;
                else if(badge1.title.toLowerCase() < badge2.title.toLowerCase()) return -1; else return 0;});
                var badgesSize = response.length;
                var filterHtml = '<ul class="filter-container search-filters-list list-unstyled">';
                $.each(response, function (idx, badgeObj) {
                    filterHtml+= '<li><label class="control control--checkbox">' +
                        badgeObj.title + '<input type="checkbox" value="'+badgeObj.id+'">' +
                        '<div class="control__indicator"></div>' +
                        '</label></li>';
                });
                filterHtml+='</ul>';

                /*if(badgesSize > 5){
                    filterHtml+='<span class="search-filter-more" onclick="expandFilter(this)"> + ' +
                        'View more</span>' +
                        '<span class="search-filter-less display-n" onclick="contractFilter(this)"> - ' +
                        'View less</span>';
                }*/
                $("#badge-filter-container").html(filterHtml);
                scrollFilters();
            }else {
                $(".badgeFilters").hide();
            }
            if(searchFilter.badges.length){
                $.each(searchFilter.badges, function (idx, val) {
                    $("input[type=checkbox][value='"+val+"']").prop("checked",true);
                });

                $("#badge-filter-container .search-filters-list").find('li').sort(function (firstElement, secondElement) {
                    var $firstElement = $(firstElement).find(':checkbox'),
                        $secondElement = $(secondElement).find(':checkbox');

                    if ($firstElement.is(':checked') && !$secondElement.is(':checked'))
                        return -1;
                    else if (!$firstElement.is(':checked') && $secondElement.is(':checked'))
                        return 1;

                    if ($(firstElement).find('label').text().trim().toLowerCase() < $(secondElement).find('label').text().trim().toLowerCase())
                        return -1;
                    else if ($(firstElement).find('label').text().trim().toLowerCase() > $(secondElement).find('label').text().trim().toLowerCase())
                        return 1;

                    return 0;
                }).appendTo("#badge-filter-container .search-filters-list");
                $("#badge-filter-container .search-filters-list").mCustomScrollbar('destroy');

                $("#badge-filter-container .search-filters-list").mCustomScrollbar({
                    theme: "dark",
                    scrollButtons: {
                        enable: true
                    }
                });
            }
        },
        error: function () {
            bootbox.alert("Unable to fetch badge filters.");
        }
    });
}

function sortFacetArray(facetArray, sortOrder) {
    if(facetArray && facetArray.length){
        if (sortOrder === "DESC"){
            return facetArray.sort(function(a, b){
                var facetA = (a["field"]["value"]).toLowerCase();
                var facetB = (b["field"]["value"]).toLowerCase();
                return (facetB < facetA) ? -1 : (facetB > facetA) ? 1 : 0;
            });
        } else {
            return facetArray.sort(function(a, b){
                var facetA = (a["field"]["value"]).toLowerCase();
                var facetB = (b["field"]["value"]).toLowerCase();
                return (facetA < facetB) ? -1 : (facetA > facetB) ? 1 : 0;
            });
        }
    }
}

function setSearchCities(citiesArray) {
    var $citySelect = $("#searchCity");
    $citySelect.empty();
    var defaultOption = new Option("Select", "");
    $(defaultOption).html("Select");
    $citySelect.append(defaultOption);
    citiesArray = sortFacetArray(citiesArray, "ASC");
    $.each(citiesArray, function (index, cityObj) {
        var option = new Option(cityObj["field"]["value"], cityObj["value"]);
        $(option).html(cityObj["field"]["value"]);
        $citySelect.append(option);
    });
    if(searchFilter.cities.length){
        $citySelect.val(searchFilter.cities);
    }
}
function setSearchRole($selectedHeaderRole, loadResults) {
    $(".searchRoleLink").show();
    var role = $selectedHeaderRole.data("value");
    var roleValue = role === "Government Body" ? "GovernmentBody" : role;
    role = (role === "Government Body" ? "Government Bodies" : role+"s");
    $selectedHeaderRole.hide();
    $("#searchRoleName").html(role);
    if (loadResults){
        updateSearchFilter([roleValue], "roles", true, true);
        $('#persona-results').html("");
        search(true);
    }
}
function stageSorting(stageContent) {
    var newContent = [];
    for (var i = 0; i < stageContent.length; i++) {
        switch (stageContent[i].value) {
            case 'Prototype':
                newContent[0] = stageContent[i];
                break;
            case 'Validation' :
                newContent[1] = stageContent[i];
                break;
            case 'EarlyTraction' :
                newContent[2] = stageContent[i];
                break;
            case 'Scaling' :
                newContent[3] = stageContent[i];
                break;
            default:
                newContent[4] = stageContent[i];
        }
    }
    return newContent;
}

var setAuthTokenHeader = function (xhr) {
    var token = store.getItem('token');
    if (token) {
        xhr.setRequestHeader('X-Auth-Token', token);
        xhr.setRequestHeader('Content-Type', 'application/json');
    } else {
        xhr.setRequestHeader('Content-Type', 'application/json');
    }
};

/*
 var searchLoadPage = function (page) {
 var pageNumber = parseInt($(page).html());
 searchFilter.page = pageNumber - 1;
 search();
 }
 */

var searchNext = function () {
    searchFilter.page = parseInt(searchFilter.page) + 1;
    search();
};

/*
 var searchPrevious = function (elem) {
 var currentPage = parseInt($(elem).siblings('ul').find('li.active').html());
 searchFilter.page = currentPage - 2;
 search();
 }

 var searchFirst = function () {
 searchFilter.page = 0;
 search();
 }

 var searchLast = function (pages) {
 searchFilter.page = pages - 1;
 search();
 }
 */

var sortSearchFilter = function () {
    $('.search-filters-section .search-filters-list').each(function () {
        if ($(this).parent('div').attr("id") != 'stage-filter-container') {
            $(this).find('li').sort(function (firstElement, secondElement) {
                var $firstElement = $(firstElement).find(':checkbox'),
                    $secondElement = $(secondElement).find(':checkbox');

                if ($firstElement.is(':checked') && !$secondElement.is(':checked'))
                    return -1;
                else if (!$firstElement.is(':checked') && $secondElement.is(':checked'))
                    return 1;

                if ($(firstElement).find('label').text().trim().toLowerCase() < $(secondElement).find('label').text().trim().toLowerCase())
                    return -1;
                else if ($(firstElement).find('label').text().trim().toLowerCase() > $(secondElement).find('label').text().trim().toLowerCase())
                    return 1;

                return 0;
            }).appendTo(this);
        }
    })
};

var search = function (setFilters) {
    $('#modal-loader').modal('show');
    sendSearchQuery = createSearchQuery();
    var url = getSearchUrl();
    window.history.replaceState(window.location.pathname, "", sendSearchQuery);

    $.ajax({
        url: url,
        type: 'POST',
        dataType: 'json',
        data: JSON.stringify(searchFilter),
        beforeSend: setAuthTokenHeader,
        success: function (data) {
            //handleSearchData(data, setFilters);
            renderSearchData(data, setFilters);
            $('#modal-loader').modal('hide');

        },
        error: function (data) {

            $('#modal-loader').modal('hide');
        }
    });
};

/* Display filters for mobile */
function displayFilters() {
    if (!$('.filter-menu').hasClass('display-b')) {
        $('.filters-tab-content input').each(function () {
            if ($(this).prop("checked")) {
                $(this).addClass('checked-filters')
            }
        });
    } else {
        $('.filters-tab-content input').each(function () {
            if ($(this).hasClass("checked-filters")) {
                $(this).prop('checked', true);
            } else {
                $(this).prop('checked', false);
            }
        });
        $('.filters-tab-content input').removeClass("checked-filters");
    }
    $('.filter-menu').toggleClass('display-b');
}

$(document).ready(function () {

    var searchResultPage = $('.search-path').attr('search-result-path');
    Handlebars.registerHelper('isFilterChecked', function (filterAttr, value, fieldValue,options) {
        if (filterAttr === 'state') {
            var arr = searchFilter['states'];
        } else if (filterAttr === 'role') {
            var arr = searchFilter['roles'];
        }
        else {
            var arr = searchFilter[filterAttr];
        }
        if (arr && arr.length > 0) {
            for (var i = 0; i < arr.length; i++) {
                if (arr[i] === value) {
                    if(filterAttr !== 'role') {
                        handleSelectedFilterSpans(value, fieldValue, true);
                    }
                    return options.fn(this);
                }
            }
        }
        return options.inverse(this);
    });
    Handlebars.registerHelper('getStage', function (stage) {
        return stage == 'Prototype' ? "Ideation" : stage;
    });

    Handlebars.registerHelper('concat', function (role, fileName) {
        return $('.search-path').attr('image-path-api') + role + '?fileName=' + fileName;
    });

    Handlebars.registerHelper('isDisabled', function (options) {
        return options.inverse(this);
    });

    $("span#search-icon").click(function () {
        doSearch();
    });

    $(".apply-button").click(function () {
        $('.filter-menu').toggleClass('display-b');
        $('.filters-tab-content input').each(function () {
            if ($(this).prop("checked")) {
                var checked = true;
            } else {
                checked = false;
            }
            updateSearchFilter($(this).val(), $(this).parents('div.tab-pane').attr('id'), checked);
        });
        search();
    });


    $(".clear-button").click(function () {
        $(".filters-tab-content input[type='checkbox']").removeAttr('checked');
        clearSearchFilter();
    });

    $("input#search-component").keypress(function (event) {
        if (event.which == 13) {
            doSearch();
        }
    });

    function doSearch() {
        if (isForumSearch()) {
            if ($('input.search').val().trim()) {
                if (window.location.pathname != searchResultPage) {
                    window.location = searchResultPage + '?query=' + $('input.search').val();
                } else {
                    forumSearchQuery.page = 0;
                    getForumSearchResults();
                }
            }
        }
        else {
            if (window.location.pathname != searchResultPage) {
                window.location = searchResultPage + '?query=' + $('.search').val();
            } else {
                if (searchFilter.page == -1) {
                    searchFilter.page = 0;
                }
                $('#persona-results').html("");
                search();
            }
        }
    }

    $("input#search-component").keyup(function (event) {
        if (isForumSearch()) {
            forumSearchQuery.query = $("input#search-component").val();
        } else {
            searchFilter.query = $("input#search-component").val();
        }
    });

    function isForumSearch() {
        return $('.search-path').attr('search-type') == 'forum-search';
    }

    $(".search-filters-section").on('change', 'label.control--checkbox', function () {
        var checked = $(this).find('input').is(':checked');
        var value = $(this).find('input').val();
        var text = $(this).text().trim();
        var filterAttr = $(this).parents('ul').parents('.search-filters-section').data('filter');
        updateSearchFilter(value, filterAttr, checked);
        $('#persona-results').html("");
        handleSelectedFilterSpans(value, text, checked);
        search();
    });

    $(".selected-filters").on("click", "i.filterRemove", function () {
        removeFilter(this);
    });

    $("select[name='searchCity']").change(function () {
        var selectedCities = $(this).val();
        selectedCities = selectedCities === null ? [] : selectedCities;
        updateSearchFilter(selectedCities, "cities", true, true);
        $('#persona-results').html("");
        search(false);
    });

    $("ul.search-table").on('click', 'li.sort-header', function () {
        var column = $(this).attr('data-value');
        var currentSortEle = $(this);
        var span = $(this).find("span");
        if (column !== undefined) {
            if ($(currentSortEle).hasClass("active")) {
                currentSortEle.removeClass("active");
                $(span).removeClass('desc-sort asc-sort').addClass('no-sort');
            } else {
                $('.search-table li.active').each(function () {
                    $(this).removeClass('active');
                    $(this).find('span').removeClass('asc-sort desc-sort').addClass('no-sort');
                });
                currentSortEle.addClass("active");
                span.addClass(span.data('order'));
            }
            searchFilter.sort.orders.splice(0, searchFilter.sort.orders.length);
            if (typeof span !== typeof undefined && span !== false) {
                var sortClass = $(span).attr('class').split(' ');
                var columnArray = ['registeredOn','title', 'role', 'city', 'rating'];
                var sortingArray = ['asc-sort', 'desc-sort' , 'no-sort'];
                if (columnArray.indexOf(column) !== -1) {
                    $.grep(sortClass, function (element) {
                        if ($.inArray(element, sortingArray) !== -1) {
                            switch (element) {
                                case "asc-sort":
                                    searchFilter.sort.orders.push({"field": column, "direction": "ASC"});
                                    break;
                                case "desc-sort":
                                    searchFilter.sort.orders.push({"field": column, "direction": "DESC"});
                                    break;
                                case "no-sort":
                                    if (searchFilter.sort.orders.length > 0) {
                                        $.each(searchFilter.sort.orders, function (index, item) {
                                            if (item && item.field == column) {
                                                searchFilter.sort.orders.splice(index, 1);
                                            }
                                        });
                                    }
                                    break;
                            }
                        }
                    });
                }
                searchFilter.page = 0;
                $('#persona-results').html("");
                search();
            }
        }
    });

    $("select#searchSort").change(function () {
        var column = $(this).val();
        if (column) {
            searchFilter.sort.orders.splice(0, searchFilter.sort.orders.length);
            var columnArray = ['rating', 'registeredOn', 'title'];
            switch (column) {
                case "rating":
                    searchFilter.sort.orders.push({"field": column, "direction": "DESC"});
                    break;
                case "registeredOn":
                    searchFilter.sort.orders.push({"field": column, "direction": "DESC"});
                    break;
                case "title":
                    searchFilter.sort.orders.push({"field": column, "direction": "ASC"});
                    break;
                case "no-sort":
                    if (searchFilter.sort.orders.length > 0) {
                        searchFilter.sort.orders.splice(0, searchFilter.sort.orders.length);
                    }
                    break;
            }
            searchFilter.page = 0;
            $('#persona-results').html("");
            search();
        }
    });

    $(".filter-main").on("change", 'input#international-search' , function(){
        if($(this).is(":checked")) {
            $(".search-accordian .location-filter").hide();
            $(".city-filter").hide();
            store.setItem("international-checkbox",true);
        }
        else{
            $(".search-accordian .location-filter").show();
            $(".city-filter").show();
            store.setItem("international-checkbox",false);
        }
        searchFilter.internationalUser = $('input#international-search').is(':checked');
        $("#persona-results").html('');
        searchFilter.page = 0;
        searchFilter.states=[];
        var queryParam = createSearchQuery();
        window.location.href = window.location.origin + window.location.pathname + queryParam;
        // savedQueryFn();
        // search();
    });


});

function more_less() {
    $('ul.filter-container').each(function (index, value) {
        if ($(this).find('li').length < 5) {
            $(this).siblings('.search-filter-more').css('display', 'none');
        } else {
            $(this).siblings('.search-filter-more ').css('display', 'block');
        }
    });
}
$(window).load(function(){

    searchWrapHeight = $('.new-search-wrapper').outerHeight();
    $('.left-search-filter').css('min-height',searchWrapHeight);
    $('.new-eco-card.category-card').each(function(){
        marginTop = $(this).outerHeight() - ($(this).find('.top').outerHeight() + $(this).find('.down-dept').outerHeight());
        $(this).find('.down-dept').css('margin-top',marginTop);
    });
});

function removeFilter(obj, clearAll) {
    if(clearAll){
        $("span.selected-filters").empty();
        $(".scheme-filters-section, .search-filters-section, .industry-accordion," +
            ".international-search").find("input:checkbox").prop("checked", false);
        searchFilter["industries"] = [];
        searchFilter["sectors"] = [];
        searchFilter["states"] = [];
        searchFilter["stages"] = [];
        searchFilter["badges"] = [];
        searchFilter.focusSector = false;
        searchFilter.internationalUser = false;
        search(true);
        $("span.selected-filter.clear-all").addClass("hidden");
    }else{
        var $filter = $(obj).closest("span.selected-filter");
        var filterValue = $filter.data("value");
        // $filter.remove();
        $("input[value='"+filterValue+"']").prop("checked", false).trigger("change");
    }
}
var floatPanel = new McFloatPanel();

/* Float Panel v2016.10.28. Copyright www.menucool.com */
function McFloatPanel() {
    var i = [], s = [], h = "className", t = "getElementsByClassName", d = "length", l = "display", C = "transition",
        m = "style", B = "height", c = "scrollTop", k = "offsetHeight", a = "fixed", e = document,
        b = document.documentElement, j = function (a, c, b) {
            if (a.addEventListener) a.addEventListener(c, b, false); else a.attachEvent && a.attachEvent("on" + c, b)
        }, o = function (c, d) {
            if (typeof getComputedStyle != "undefined") var b = getComputedStyle(c, null); else b = c.currentStyle;
            return b ? b[d] : a
        }, L = function () {
            var a = e.body;
            return Math.max(a.scrollHeight, a[k], b.clientHeight, b.scrollHeight, b[k])
        }, O = function (a, c) {
            var b = a[d];
            while (b--) if (a[b] === c) return true;
            return false
        }, g = function (b, a) {
            return O(b[h].split(" "), a)
        }, q = function (a, b) {
            if (!g(a, b)) if (!a[h]) a[h] = b; else a[h] += " " + b
        }, p = function (a, f) {
            if (a[h] && g(a, f)) {
                for (var e = "", c = a[h].split(" "), b = 0, i = c[d]; b < i; b++) if (c[b] !== f) e += c[b] + " ";
                a[h] = e.replace(/^\s+|\s+$/g, "")
            }
        }, n = function () {
            return window.pageYOffset || b[c]
        }, z = function (a) {
            return a.getBoundingClientRect().top
        }, F = function (b) {
            var c = n();
            if (c > b.oS && !g(b, a)) q(b, a); else g(b, a) && c < b.oS && p(b, a)
        }, x = function () {
            for (var a = 0; a < s[d]; a++) J(s[a])
        }, J = function (a) {
            if (a.oS) {
                a.fT && clearTimeout(a.fT);
                a.fT = setTimeout(function () {
                    if (a.aF) F(a); else y(a)
                }, 50)
            } else y(a)
        }, w = function (d, c, b) {
            p(d, a);
            c[l] = "none";
            b.position = b.top = ""
        }, y = function (c) {
            var j = z(c), f = c[k], e = c[m], d = c.pH[m], h = n();
            if (j < c.oT && h > c.oS && !g(c, a) && (window.innerHeight || b.clientHeight) > f) {
                c.tP = h + j - c.oT;
                var p = L();
                if (f > p - c.tP - f) var i = f; else i = 0;
                d[l] = "block";
                d[C] = "none";
                d[B] = f + 1 + "px";
                c.pH[k];
                d[C] = "height .3s";
                d[B] = i + "px";
                q(c, a);
                e.position = a;
                e.top = c.oT + "px";
                if (o(c, "position") != a) d[l] = "none"
            } else if (g(c, a) && (h < c.tP || h < c.oS)) {
                var s = o(c, "animation");
                if (c.oS && c.classList && s.indexOf("slide-down") != -1) {
                    var r = o(c, "animationDuration");
                    c.classList.remove(a);
                    e.animationDirection = "reverse";
                    e.animationDuration = "1000ms";
                    void c[k];
                    c.classList.add(a);
                    setTimeout(function () {
                        w(c, d, e);
                        e.animationDirection = "normal";
                        e.animationDuration = r
                    }, 300)
                } else w(c, d, e)
            }
        }, I = function () {
            var f = [], c, b;
            if (e[t]) {
                f = e[t]("float-panel");
                i = e[t]("slideanim")
            } else {
                var k = e.getElementsByTagName("*");
                c = k[d];
                while (c--) g(k[c], "float-panel") && f.push(k[c])
            }
            c = f[d];
            for (var h = 0; h < c; h++) {
                b = s[h] = f[h];
                b.oT = parseInt(b.getAttribute("data-top") || 0);
                b.oS = parseInt(b.getAttribute("data-scroll") || 0);
                if (b.oS > 20 && o(b, "position") == a) b.aF = 1;
                b.pH = e.createElement("div");
                b.pH[m].width = b.offsetWidth + "px";
                b.pH[m][l] = "none";
                b.parentNode.insertBefore(b.pH, b.nextSibling)
            }
            if (s[d]) {
                setTimeout(x, 160);
                j(window, "scroll", x)
            }
        }, f, D = 200, E = 0, r, u, H = function () {
            return window.innerWidth || b.clientWidth || e.body.clientWidth
        };

    function K() {
        if (!r) r = setInterval(function () {
            var a = e.body;
            if (a[c] < 3) a[c] = 0; else a[c] = a[c] / 1.3;
            if (b[c] < 3) b[c] = 0; else b[c] = b[c] / 1.3;
            if (!n()) {
                clearInterval(r);
                r = null
            }
        }, 14)
    }

    function A() {
        clearTimeout(u);
        if (n() > D && H() > E) {
            u = setTimeout(function () {
                p(f, "mcOut")
            }, 60);
            f[m][l] = "block"
        } else {
            q(f, "mcOut");
            u = setTimeout(function () {
                f[m][l] = "none"
            }, 500)
        }
    }

    var N = function () {
        f = e.getElementById("backtop");
        if (f) {
            var a = f.getAttribute("data-v-w");
            if (a) {
                a = a.replace(/\s/g, "").split(",");
                D = parseInt(a[0]);
                if (a[d] > 1) E = parseInt(a[1])
            }
            j(f, "click", K);
            j(window, "scroll", A);
            A()
        }
    }, v = function () {
        for (var c = n(), e = c + window.innerHeight, g = i[d], b, f, a = 0; a < g; a++) {
            b = c + z(i[a]), f = b + i[a][k];
            if (b < e) q(i[a], "slide"); else p(i[a], "slide")
        }
    }, G = function () {
        if (i[d]) {
            j(window, "scroll", v);
            v()
        }
    }, M = function () {
        I();
        N();
        G()
    };
    j(window, "load", M);
    j(document, "touchstart", function () {
    })
}
function fetchNewsfeed(source, isRssNewstemplate, noOfTopNews, newsfeedPath, showLoadMore) {
    //var limit = (showLoadMore === "true") ? "" : noOfTopNews;
    var limit = "";
    $.ajax({
        type: "GET",
        url: "/services/newsfeed/show.json" + "?limit=" + limit + "&newsfeedPath=" + newsfeedPath
    }).done(function (data) {
        if (isRssNewstemplate)
            newsfeed(source, data, noOfTopNews, newsfeedPath);
        else
            newsfeedtopListing(source, data, noOfTopNews);
    }).fail(function () {
        console.log("error");
    });
}

// for rss-newsfeed component
function newsfeed(source, data, noOfTopNews, newsfeedPath) {
    var template = Handlebars.compile(source);
    if (noOfTopNews === "3" || noOfTopNews === "4") {
        $('.rss-newsfeed .news').prepend(template(data.slice(0, noOfTopNews)));
    }
    else {
        $('.rss-newsfeed .news').prepend(template(data));
        lazyloader(6, null, null, newsfeedPath);
    }
    equalHeightsForNewsfeedCards();
    return false;
}

// for top-newsfeed component
function newsfeedtopListing(source, data, noOfTopNews) {
    var template = Handlebars.compile(source);
    $('ul.topNewsfeed').append(template(data.slice(0, noOfTopNews)));
    if(data.length > 0){
        $(".topNewsfeedSideCard").removeClass("hidden");
    }else{
        $(".topNewsfeedSideCard").addClass("hidden");
    }
    return false;
}

function fetchNewsfeedStack(source, newsRows, newsColumns, newsfeedPath, stackBackground) {
    var limit = "";
    var numberOfNewsListing = newsRows * newsColumns;
    $.ajax({
        type: "GET",
        url: "/services/newsfeed/show.json" + "?limit=" + limit + "&newsfeedPath=" + newsfeedPath
    }).done(function (data) {
        topNewsStack(source, data, newsRows, newsColumns);
    }).fail(function () {
        console.log("Error in loading news stack");
    });
}

function topNewsStack(source, data, newsRows, newsColumns) {
    var template = Handlebars.compile(source);
    var table = [], newRow;
    var dataIdx = 0;
    for (r = 0; r < newsRows; r++) {
        newRow = [];
        for (c = 0; c < newsColumns; c++) {
            newRow.push(data[dataIdx]);
            dataIdx++;
        }
        table.push(newRow);
    }
    $('.news-stack').append(template(table));
}

/* == jquery mousewheel plugin == Version: 3.1.13, License: MIT License (MIT) */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(a){function b(b){var g=b||window.event,h=i.call(arguments,1),j=0,l=0,m=0,n=0,o=0,p=0;if(b=a.event.fix(g),b.type="mousewheel","detail"in g&&(m=-1*g.detail),"wheelDelta"in g&&(m=g.wheelDelta),"wheelDeltaY"in g&&(m=g.wheelDeltaY),"wheelDeltaX"in g&&(l=-1*g.wheelDeltaX),"axis"in g&&g.axis===g.HORIZONTAL_AXIS&&(l=-1*m,m=0),j=0===m?l:m,"deltaY"in g&&(m=-1*g.deltaY,j=m),"deltaX"in g&&(l=g.deltaX,0===m&&(j=-1*l)),0!==m||0!==l){if(1===g.deltaMode){var q=a.data(this,"mousewheel-line-height");j*=q,m*=q,l*=q}else if(2===g.deltaMode){var r=a.data(this,"mousewheel-page-height");j*=r,m*=r,l*=r}if(n=Math.max(Math.abs(m),Math.abs(l)),(!f||f>n)&&(f=n,d(g,n)&&(f/=40)),d(g,n)&&(j/=40,l/=40,m/=40),j=Math[j>=1?"floor":"ceil"](j/f),l=Math[l>=1?"floor":"ceil"](l/f),m=Math[m>=1?"floor":"ceil"](m/f),k.settings.normalizeOffset&&this.getBoundingClientRect){var s=this.getBoundingClientRect();o=b.clientX-s.left,p=b.clientY-s.top}return b.deltaX=l,b.deltaY=m,b.deltaFactor=f,b.offsetX=o,b.offsetY=p,b.deltaMode=0,h.unshift(b,j,l,m),e&&clearTimeout(e),e=setTimeout(c,200),(a.event.dispatch||a.event.handle).apply(this,h)}}function c(){f=null}function d(a,b){return k.settings.adjustOldDeltas&&"mousewheel"===a.type&&b%120===0}var e,f,g=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],h="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],i=Array.prototype.slice;if(a.event.fixHooks)for(var j=g.length;j;)a.event.fixHooks[g[--j]]=a.event.mouseHooks;var k=a.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var c=h.length;c;)this.addEventListener(h[--c],b,!1);else this.onmousewheel=b;a.data(this,"mousewheel-line-height",k.getLineHeight(this)),a.data(this,"mousewheel-page-height",k.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var c=h.length;c;)this.removeEventListener(h[--c],b,!1);else this.onmousewheel=null;a.removeData(this,"mousewheel-line-height"),a.removeData(this,"mousewheel-page-height")},getLineHeight:function(b){var c=a(b),d=c["offsetParent"in a.fn?"offsetParent":"parent"]();return d.length||(d=a("body")),parseInt(d.css("fontSize"),10)||parseInt(c.css("fontSize"),10)||16},getPageHeight:function(b){return a(b).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})});!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(a){function b(b){var g=b||window.event,h=i.call(arguments,1),j=0,l=0,m=0,n=0,o=0,p=0;if(b=a.event.fix(g),b.type="mousewheel","detail"in g&&(m=-1*g.detail),"wheelDelta"in g&&(m=g.wheelDelta),"wheelDeltaY"in g&&(m=g.wheelDeltaY),"wheelDeltaX"in g&&(l=-1*g.wheelDeltaX),"axis"in g&&g.axis===g.HORIZONTAL_AXIS&&(l=-1*m,m=0),j=0===m?l:m,"deltaY"in g&&(m=-1*g.deltaY,j=m),"deltaX"in g&&(l=g.deltaX,0===m&&(j=-1*l)),0!==m||0!==l){if(1===g.deltaMode){var q=a.data(this,"mousewheel-line-height");j*=q,m*=q,l*=q}else if(2===g.deltaMode){var r=a.data(this,"mousewheel-page-height");j*=r,m*=r,l*=r}if(n=Math.max(Math.abs(m),Math.abs(l)),(!f||f>n)&&(f=n,d(g,n)&&(f/=40)),d(g,n)&&(j/=40,l/=40,m/=40),j=Math[j>=1?"floor":"ceil"](j/f),l=Math[l>=1?"floor":"ceil"](l/f),m=Math[m>=1?"floor":"ceil"](m/f),k.settings.normalizeOffset&&this.getBoundingClientRect){var s=this.getBoundingClientRect();o=b.clientX-s.left,p=b.clientY-s.top}return b.deltaX=l,b.deltaY=m,b.deltaFactor=f,b.offsetX=o,b.offsetY=p,b.deltaMode=0,h.unshift(b,j,l,m),e&&clearTimeout(e),e=setTimeout(c,200),(a.event.dispatch||a.event.handle).apply(this,h)}}function c(){f=null}function d(a,b){return k.settings.adjustOldDeltas&&"mousewheel"===a.type&&b%120===0}var e,f,g=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],h="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],i=Array.prototype.slice;if(a.event.fixHooks)for(var j=g.length;j;)a.event.fixHooks[g[--j]]=a.event.mouseHooks;var k=a.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var c=h.length;c;)this.addEventListener(h[--c],b,!1);else this.onmousewheel=b;a.data(this,"mousewheel-line-height",k.getLineHeight(this)),a.data(this,"mousewheel-page-height",k.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var c=h.length;c;)this.removeEventListener(h[--c],b,!1);else this.onmousewheel=null;a.removeData(this,"mousewheel-line-height"),a.removeData(this,"mousewheel-page-height")},getLineHeight:function(b){var c=a(b),d=c["offsetParent"in a.fn?"offsetParent":"parent"]();return d.length||(d=a("body")),parseInt(d.css("fontSize"),10)||parseInt(c.css("fontSize"),10)||16},getPageHeight:function(b){return a(b).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})});
/* == malihu jquery custom scrollbar plugin == Version: 3.1.5, License: MIT License (MIT) */
!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"undefined"!=typeof module&&module.exports?module.exports=e:e(jQuery,window,document)}(function(e){!function(t){var o="function"==typeof define&&define.amd,a="undefined"!=typeof module&&module.exports,n="https:"==document.location.protocol?"https:":"http:",i="cdnjs.cloudflare.com/ajax/libs/jquery-mousewheel/3.1.13/jquery.mousewheel.min.js";o||(a?require("jquery-mousewheel")(e):e.event.special.mousewheel||e("head").append(decodeURI("%3Cscript src="+n+"//"+i+"%3E%3C/script%3E"))),t()}(function(){var t,o="mCustomScrollbar",a="mCS",n=".mCustomScrollbar",i={setTop:0,setLeft:0,axis:"y",scrollbarPosition:"inside",scrollInertia:950,autoDraggerLength:!0,alwaysShowScrollbar:0,snapOffset:0,mouseWheel:{enable:!0,scrollAmount:"auto",axis:"y",deltaFactor:"auto",disableOver:["select","option","keygen","datalist","textarea"]},scrollButtons:{scrollType:"stepless",scrollAmount:"auto"},keyboard:{enable:!0,scrollType:"stepless",scrollAmount:"auto"},contentTouchScroll:25,documentTouchScroll:!0,advanced:{autoScrollOnFocus:"input,textarea,select,button,datalist,keygen,a[tabindex],area,object,[contenteditable='true']",updateOnContentResize:!0,updateOnImageLoad:"auto",autoUpdateTimeout:60},theme:"light",callbacks:{onTotalScrollOffset:0,onTotalScrollBackOffset:0,alwaysTriggerOffsets:!0}},r=0,l={},s=window.attachEvent&&!window.addEventListener?1:0,c=!1,d=["mCSB_dragger_onDrag","mCSB_scrollTools_onDrag","mCS_img_loaded","mCS_disabled","mCS_destroyed","mCS_no_scrollbar","mCS-autoHide","mCS-dir-rtl","mCS_no_scrollbar_y","mCS_no_scrollbar_x","mCS_y_hidden","mCS_x_hidden","mCSB_draggerContainer","mCSB_buttonUp","mCSB_buttonDown","mCSB_buttonLeft","mCSB_buttonRight"],u={init:function(t){var t=e.extend(!0,{},i,t),o=f.call(this);if(t.live){var s=t.liveSelector||this.selector||n,c=e(s);if("off"===t.live)return void m(s);l[s]=setTimeout(function(){c.mCustomScrollbar(t),"once"===t.live&&c.length&&m(s)},500)}else m(s);return t.setWidth=t.set_width?t.set_width:t.setWidth,t.setHeight=t.set_height?t.set_height:t.setHeight,t.axis=t.horizontalScroll?"x":p(t.axis),t.scrollInertia=t.scrollInertia>0&&t.scrollInertia<17?17:t.scrollInertia,"object"!=typeof t.mouseWheel&&1==t.mouseWheel&&(t.mouseWheel={enable:!0,scrollAmount:"auto",axis:"y",preventDefault:!1,deltaFactor:"auto",normalizeDelta:!1,invert:!1}),t.mouseWheel.scrollAmount=t.mouseWheelPixels?t.mouseWheelPixels:t.mouseWheel.scrollAmount,t.mouseWheel.normalizeDelta=t.advanced.normalizeMouseWheelDelta?t.advanced.normalizeMouseWheelDelta:t.mouseWheel.normalizeDelta,t.scrollButtons.scrollType=g(t.scrollButtons.scrollType),h(t),e(o).each(function(){var o=e(this);if(!o.data(a)){o.data(a,{idx:++r,opt:t,scrollRatio:{y:null,x:null},overflowed:null,contentReset:{y:null,x:null},bindEvents:!1,tweenRunning:!1,sequential:{},langDir:o.css("direction"),cbOffsets:null,trigger:null,poll:{size:{o:0,n:0},img:{o:0,n:0},change:{o:0,n:0}}});var n=o.data(a),i=n.opt,l=o.data("mcs-axis"),s=o.data("mcs-scrollbar-position"),c=o.data("mcs-theme");l&&(i.axis=l),s&&(i.scrollbarPosition=s),c&&(i.theme=c,h(i)),v.call(this),n&&i.callbacks.onCreate&&"function"==typeof i.callbacks.onCreate&&i.callbacks.onCreate.call(this),e("#mCSB_"+n.idx+"_container img:not(."+d[2]+")").addClass(d[2]),u.update.call(null,o)}})},update:function(t,o){var n=t||f.call(this);return e(n).each(function(){var t=e(this);if(t.data(a)){var n=t.data(a),i=n.opt,r=e("#mCSB_"+n.idx+"_container"),l=e("#mCSB_"+n.idx),s=[e("#mCSB_"+n.idx+"_dragger_vertical"),e("#mCSB_"+n.idx+"_dragger_horizontal")];if(!r.length)return;n.tweenRunning&&Q(t),o&&n&&i.callbacks.onBeforeUpdate&&"function"==typeof i.callbacks.onBeforeUpdate&&i.callbacks.onBeforeUpdate.call(this),t.hasClass(d[3])&&t.removeClass(d[3]),t.hasClass(d[4])&&t.removeClass(d[4]),l.css("max-height","none"),l.height()!==t.height()&&l.css("max-height",t.height()),_.call(this),"y"===i.axis||i.advanced.autoExpandHorizontalScroll||r.css("width",x(r)),n.overflowed=y.call(this),M.call(this),i.autoDraggerLength&&S.call(this),b.call(this),T.call(this);var c=[Math.abs(r[0].offsetTop),Math.abs(r[0].offsetLeft)];"x"!==i.axis&&(n.overflowed[0]?s[0].height()>s[0].parent().height()?B.call(this):(G(t,c[0].toString(),{dir:"y",dur:0,overwrite:"none"}),n.contentReset.y=null):(B.call(this),"y"===i.axis?k.call(this):"yx"===i.axis&&n.overflowed[1]&&G(t,c[1].toString(),{dir:"x",dur:0,overwrite:"none"}))),"y"!==i.axis&&(n.overflowed[1]?s[1].width()>s[1].parent().width()?B.call(this):(G(t,c[1].toString(),{dir:"x",dur:0,overwrite:"none"}),n.contentReset.x=null):(B.call(this),"x"===i.axis?k.call(this):"yx"===i.axis&&n.overflowed[0]&&G(t,c[0].toString(),{dir:"y",dur:0,overwrite:"none"}))),o&&n&&(2===o&&i.callbacks.onImageLoad&&"function"==typeof i.callbacks.onImageLoad?i.callbacks.onImageLoad.call(this):3===o&&i.callbacks.onSelectorChange&&"function"==typeof i.callbacks.onSelectorChange?i.callbacks.onSelectorChange.call(this):i.callbacks.onUpdate&&"function"==typeof i.callbacks.onUpdate&&i.callbacks.onUpdate.call(this)),N.call(this)}})},scrollTo:function(t,o){if("undefined"!=typeof t&&null!=t){var n=f.call(this);return e(n).each(function(){var n=e(this);if(n.data(a)){var i=n.data(a),r=i.opt,l={trigger:"external",scrollInertia:r.scrollInertia,scrollEasing:"mcsEaseInOut",moveDragger:!1,timeout:60,callbacks:!0,onStart:!0,onUpdate:!0,onComplete:!0},s=e.extend(!0,{},l,o),c=Y.call(this,t),d=s.scrollInertia>0&&s.scrollInertia<17?17:s.scrollInertia;c[0]=X.call(this,c[0],"y"),c[1]=X.call(this,c[1],"x"),s.moveDragger&&(c[0]*=i.scrollRatio.y,c[1]*=i.scrollRatio.x),s.dur=ne()?0:d,setTimeout(function(){null!==c[0]&&"undefined"!=typeof c[0]&&"x"!==r.axis&&i.overflowed[0]&&(s.dir="y",s.overwrite="all",G(n,c[0].toString(),s)),null!==c[1]&&"undefined"!=typeof c[1]&&"y"!==r.axis&&i.overflowed[1]&&(s.dir="x",s.overwrite="none",G(n,c[1].toString(),s))},s.timeout)}})}},stop:function(){var t=f.call(this);return e(t).each(function(){var t=e(this);t.data(a)&&Q(t)})},disable:function(t){var o=f.call(this);return e(o).each(function(){var o=e(this);if(o.data(a)){o.data(a);N.call(this,"remove"),k.call(this),t&&B.call(this),M.call(this,!0),o.addClass(d[3])}})},destroy:function(){var t=f.call(this);return e(t).each(function(){var n=e(this);if(n.data(a)){var i=n.data(a),r=i.opt,l=e("#mCSB_"+i.idx),s=e("#mCSB_"+i.idx+"_container"),c=e(".mCSB_"+i.idx+"_scrollbar");r.live&&m(r.liveSelector||e(t).selector),N.call(this,"remove"),k.call(this),B.call(this),n.removeData(a),$(this,"mcs"),c.remove(),s.find("img."+d[2]).removeClass(d[2]),l.replaceWith(s.contents()),n.removeClass(o+" _"+a+"_"+i.idx+" "+d[6]+" "+d[7]+" "+d[5]+" "+d[3]).addClass(d[4])}})}},f=function(){return"object"!=typeof e(this)||e(this).length<1?n:this},h=function(t){var o=["rounded","rounded-dark","rounded-dots","rounded-dots-dark"],a=["rounded-dots","rounded-dots-dark","3d","3d-dark","3d-thick","3d-thick-dark","inset","inset-dark","inset-2","inset-2-dark","inset-3","inset-3-dark"],n=["minimal","minimal-dark"],i=["minimal","minimal-dark"],r=["minimal","minimal-dark"];t.autoDraggerLength=e.inArray(t.theme,o)>-1?!1:t.autoDraggerLength,t.autoExpandScrollbar=e.inArray(t.theme,a)>-1?!1:t.autoExpandScrollbar,t.scrollButtons.enable=e.inArray(t.theme,n)>-1?!1:t.scrollButtons.enable,t.autoHideScrollbar=e.inArray(t.theme,i)>-1?!0:t.autoHideScrollbar,t.scrollbarPosition=e.inArray(t.theme,r)>-1?"outside":t.scrollbarPosition},m=function(e){l[e]&&(clearTimeout(l[e]),$(l,e))},p=function(e){return"yx"===e||"xy"===e||"auto"===e?"yx":"x"===e||"horizontal"===e?"x":"y"},g=function(e){return"stepped"===e||"pixels"===e||"step"===e||"click"===e?"stepped":"stepless"},v=function(){var t=e(this),n=t.data(a),i=n.opt,r=i.autoExpandScrollbar?" "+d[1]+"_expand":"",l=["<div id='mCSB_"+n.idx+"_scrollbar_vertical' class='mCSB_scrollTools mCSB_"+n.idx+"_scrollbar mCS-"+i.theme+" mCSB_scrollTools_vertical"+r+"'><div class='"+d[12]+"'><div id='mCSB_"+n.idx+"_dragger_vertical' class='mCSB_dragger' style='position:absolute;'><div class='mCSB_dragger_bar' /></div><div class='mCSB_draggerRail' /></div></div>","<div id='mCSB_"+n.idx+"_scrollbar_horizontal' class='mCSB_scrollTools mCSB_"+n.idx+"_scrollbar mCS-"+i.theme+" mCSB_scrollTools_horizontal"+r+"'><div class='"+d[12]+"'><div id='mCSB_"+n.idx+"_dragger_horizontal' class='mCSB_dragger' style='position:absolute;'><div class='mCSB_dragger_bar' /></div><div class='mCSB_draggerRail' /></div></div>"],s="yx"===i.axis?"mCSB_vertical_horizontal":"x"===i.axis?"mCSB_horizontal":"mCSB_vertical",c="yx"===i.axis?l[0]+l[1]:"x"===i.axis?l[1]:l[0],u="yx"===i.axis?"<div id='mCSB_"+n.idx+"_container_wrapper' class='mCSB_container_wrapper' />":"",f=i.autoHideScrollbar?" "+d[6]:"",h="x"!==i.axis&&"rtl"===n.langDir?" "+d[7]:"";i.setWidth&&t.css("width",i.setWidth),i.setHeight&&t.css("height",i.setHeight),i.setLeft="y"!==i.axis&&"rtl"===n.langDir?"989999px":i.setLeft,t.addClass(o+" _"+a+"_"+n.idx+f+h).wrapInner("<div id='mCSB_"+n.idx+"' class='mCustomScrollBox mCS-"+i.theme+" "+s+"'><div id='mCSB_"+n.idx+"_container' class='mCSB_container' style='position:relative; top:"+i.setTop+"; left:"+i.setLeft+";' dir='"+n.langDir+"' /></div>");var m=e("#mCSB_"+n.idx),p=e("#mCSB_"+n.idx+"_container");"y"===i.axis||i.advanced.autoExpandHorizontalScroll||p.css("width",x(p)),"outside"===i.scrollbarPosition?("static"===t.css("position")&&t.css("position","relative"),t.css("overflow","visible"),m.addClass("mCSB_outside").after(c)):(m.addClass("mCSB_inside").append(c),p.wrap(u)),w.call(this);var g=[e("#mCSB_"+n.idx+"_dragger_vertical"),e("#mCSB_"+n.idx+"_dragger_horizontal")];g[0].css("min-height",g[0].height()),g[1].css("min-width",g[1].width())},x=function(t){var o=[t[0].scrollWidth,Math.max.apply(Math,t.children().map(function(){return e(this).outerWidth(!0)}).get())],a=t.parent().width();return o[0]>a?o[0]:o[1]>a?o[1]:"100%"},_=function(){var t=e(this),o=t.data(a),n=o.opt,i=e("#mCSB_"+o.idx+"_container");if(n.advanced.autoExpandHorizontalScroll&&"y"!==n.axis){i.css({width:"auto","min-width":0,"overflow-x":"scroll"});var r=Math.ceil(i[0].scrollWidth);3===n.advanced.autoExpandHorizontalScroll||2!==n.advanced.autoExpandHorizontalScroll&&r>i.parent().width()?i.css({width:r,"min-width":"100%","overflow-x":"inherit"}):i.css({"overflow-x":"inherit",position:"absolute"}).wrap("<div class='mCSB_h_wrapper' style='position:relative; left:0; width:999999px;' />").css({width:Math.ceil(i[0].getBoundingClientRect().right+.4)-Math.floor(i[0].getBoundingClientRect().left),"min-width":"100%",position:"relative"}).unwrap()}},w=function(){var t=e(this),o=t.data(a),n=o.opt,i=e(".mCSB_"+o.idx+"_scrollbar:first"),r=oe(n.scrollButtons.tabindex)?"tabindex='"+n.scrollButtons.tabindex+"'":"",l=["<a href='#' class='"+d[13]+"' "+r+" />","<a href='#' class='"+d[14]+"' "+r+" />","<a href='#' class='"+d[15]+"' "+r+" />","<a href='#' class='"+d[16]+"' "+r+" />"],s=["x"===n.axis?l[2]:l[0],"x"===n.axis?l[3]:l[1],l[2],l[3]];n.scrollButtons.enable&&i.prepend(s[0]).append(s[1]).next(".mCSB_scrollTools").prepend(s[2]).append(s[3])},S=function(){var t=e(this),o=t.data(a),n=e("#mCSB_"+o.idx),i=e("#mCSB_"+o.idx+"_container"),r=[e("#mCSB_"+o.idx+"_dragger_vertical"),e("#mCSB_"+o.idx+"_dragger_horizontal")],l=[n.height()/i.outerHeight(!1),n.width()/i.outerWidth(!1)],c=[parseInt(r[0].css("min-height")),Math.round(l[0]*r[0].parent().height()),parseInt(r[1].css("min-width")),Math.round(l[1]*r[1].parent().width())],d=s&&c[1]<c[0]?c[0]:c[1],u=s&&c[3]<c[2]?c[2]:c[3];r[0].css({height:d,"max-height":r[0].parent().height()-10}).find(".mCSB_dragger_bar").css({"line-height":c[0]+"px"}),r[1].css({width:u,"max-width":r[1].parent().width()-10})},b=function(){var t=e(this),o=t.data(a),n=e("#mCSB_"+o.idx),i=e("#mCSB_"+o.idx+"_container"),r=[e("#mCSB_"+o.idx+"_dragger_vertical"),e("#mCSB_"+o.idx+"_dragger_horizontal")],l=[i.outerHeight(!1)-n.height(),i.outerWidth(!1)-n.width()],s=[l[0]/(r[0].parent().height()-r[0].height()),l[1]/(r[1].parent().width()-r[1].width())];o.scrollRatio={y:s[0],x:s[1]}},C=function(e,t,o){var a=o?d[0]+"_expanded":"",n=e.closest(".mCSB_scrollTools");"active"===t?(e.toggleClass(d[0]+" "+a),n.toggleClass(d[1]),e[0]._draggable=e[0]._draggable?0:1):e[0]._draggable||("hide"===t?(e.removeClass(d[0]),n.removeClass(d[1])):(e.addClass(d[0]),n.addClass(d[1])))},y=function(){var t=e(this),o=t.data(a),n=e("#mCSB_"+o.idx),i=e("#mCSB_"+o.idx+"_container"),r=null==o.overflowed?i.height():i.outerHeight(!1),l=null==o.overflowed?i.width():i.outerWidth(!1),s=i[0].scrollHeight,c=i[0].scrollWidth;return s>r&&(r=s),c>l&&(l=c),[r>n.height(),l>n.width()]},B=function(){var t=e(this),o=t.data(a),n=o.opt,i=e("#mCSB_"+o.idx),r=e("#mCSB_"+o.idx+"_container"),l=[e("#mCSB_"+o.idx+"_dragger_vertical"),e("#mCSB_"+o.idx+"_dragger_horizontal")];if(Q(t),("x"!==n.axis&&!o.overflowed[0]||"y"===n.axis&&o.overflowed[0])&&(l[0].add(r).css("top",0),G(t,"_resetY")),"y"!==n.axis&&!o.overflowed[1]||"x"===n.axis&&o.overflowed[1]){var s=dx=0;"rtl"===o.langDir&&(s=i.width()-r.outerWidth(!1),dx=Math.abs(s/o.scrollRatio.x)),r.css("left",s),l[1].css("left",dx),G(t,"_resetX")}},T=function(){function t(){r=setTimeout(function(){e.event.special.mousewheel?(clearTimeout(r),W.call(o[0])):t()},100)}var o=e(this),n=o.data(a),i=n.opt;if(!n.bindEvents){if(I.call(this),i.contentTouchScroll&&D.call(this),E.call(this),i.mouseWheel.enable){var r;t()}P.call(this),U.call(this),i.advanced.autoScrollOnFocus&&H.call(this),i.scrollButtons.enable&&F.call(this),i.keyboard.enable&&q.call(this),n.bindEvents=!0}},k=function(){var t=e(this),o=t.data(a),n=o.opt,i=a+"_"+o.idx,r=".mCSB_"+o.idx+"_scrollbar",l=e("#mCSB_"+o.idx+",#mCSB_"+o.idx+"_container,#mCSB_"+o.idx+"_container_wrapper,"+r+" ."+d[12]+",#mCSB_"+o.idx+"_dragger_vertical,#mCSB_"+o.idx+"_dragger_horizontal,"+r+">a"),s=e("#mCSB_"+o.idx+"_container");n.advanced.releaseDraggableSelectors&&l.add(e(n.advanced.releaseDraggableSelectors)),n.advanced.extraDraggableSelectors&&l.add(e(n.advanced.extraDraggableSelectors)),o.bindEvents&&(e(document).add(e(!A()||top.document)).unbind("."+i),l.each(function(){e(this).unbind("."+i)}),clearTimeout(t[0]._focusTimeout),$(t[0],"_focusTimeout"),clearTimeout(o.sequential.step),$(o.sequential,"step"),clearTimeout(s[0].onCompleteTimeout),$(s[0],"onCompleteTimeout"),o.bindEvents=!1)},M=function(t){var o=e(this),n=o.data(a),i=n.opt,r=e("#mCSB_"+n.idx+"_container_wrapper"),l=r.length?r:e("#mCSB_"+n.idx+"_container"),s=[e("#mCSB_"+n.idx+"_scrollbar_vertical"),e("#mCSB_"+n.idx+"_scrollbar_horizontal")],c=[s[0].find(".mCSB_dragger"),s[1].find(".mCSB_dragger")];"x"!==i.axis&&(n.overflowed[0]&&!t?(s[0].add(c[0]).add(s[0].children("a")).css("display","block"),l.removeClass(d[8]+" "+d[10])):(i.alwaysShowScrollbar?(2!==i.alwaysShowScrollbar&&c[0].css("display","none"),l.removeClass(d[10])):(s[0].css("display","none"),l.addClass(d[10])),l.addClass(d[8]))),"y"!==i.axis&&(n.overflowed[1]&&!t?(s[1].add(c[1]).add(s[1].children("a")).css("display","block"),l.removeClass(d[9]+" "+d[11])):(i.alwaysShowScrollbar?(2!==i.alwaysShowScrollbar&&c[1].css("display","none"),l.removeClass(d[11])):(s[1].css("display","none"),l.addClass(d[11])),l.addClass(d[9]))),n.overflowed[0]||n.overflowed[1]?o.removeClass(d[5]):o.addClass(d[5])},O=function(t){var o=t.type,a=t.target.ownerDocument!==document&&null!==frameElement?[e(frameElement).offset().top,e(frameElement).offset().left]:null,n=A()&&t.target.ownerDocument!==top.document&&null!==frameElement?[e(t.view.frameElement).offset().top,e(t.view.frameElement).offset().left]:[0,0];switch(o){case"pointerdown":case"MSPointerDown":case"pointermove":case"MSPointerMove":case"pointerup":case"MSPointerUp":return a?[t.originalEvent.pageY-a[0]+n[0],t.originalEvent.pageX-a[1]+n[1],!1]:[t.originalEvent.pageY,t.originalEvent.pageX,!1];case"touchstart":case"touchmove":case"touchend":var i=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0],r=t.originalEvent.touches.length||t.originalEvent.changedTouches.length;return t.target.ownerDocument!==document?[i.screenY,i.screenX,r>1]:[i.pageY,i.pageX,r>1];default:return a?[t.pageY-a[0]+n[0],t.pageX-a[1]+n[1],!1]:[t.pageY,t.pageX,!1]}},I=function(){function t(e,t,a,n){if(h[0].idleTimer=d.scrollInertia<233?250:0,o.attr("id")===f[1])var i="x",s=(o[0].offsetLeft-t+n)*l.scrollRatio.x;else var i="y",s=(o[0].offsetTop-e+a)*l.scrollRatio.y;G(r,s.toString(),{dir:i,drag:!0})}var o,n,i,r=e(this),l=r.data(a),d=l.opt,u=a+"_"+l.idx,f=["mCSB_"+l.idx+"_dragger_vertical","mCSB_"+l.idx+"_dragger_horizontal"],h=e("#mCSB_"+l.idx+"_container"),m=e("#"+f[0]+",#"+f[1]),p=d.advanced.releaseDraggableSelectors?m.add(e(d.advanced.releaseDraggableSelectors)):m,g=d.advanced.extraDraggableSelectors?e(!A()||top.document).add(e(d.advanced.extraDraggableSelectors)):e(!A()||top.document);m.bind("contextmenu."+u,function(e){e.preventDefault()}).bind("mousedown."+u+" touchstart."+u+" pointerdown."+u+" MSPointerDown."+u,function(t){if(t.stopImmediatePropagation(),t.preventDefault(),ee(t)){c=!0,s&&(document.onselectstart=function(){return!1}),L.call(h,!1),Q(r),o=e(this);var a=o.offset(),l=O(t)[0]-a.top,u=O(t)[1]-a.left,f=o.height()+a.top,m=o.width()+a.left;f>l&&l>0&&m>u&&u>0&&(n=l,i=u),C(o,"active",d.autoExpandScrollbar)}}).bind("touchmove."+u,function(e){e.stopImmediatePropagation(),e.preventDefault();var a=o.offset(),r=O(e)[0]-a.top,l=O(e)[1]-a.left;t(n,i,r,l)}),e(document).add(g).bind("mousemove."+u+" pointermove."+u+" MSPointerMove."+u,function(e){if(o){var a=o.offset(),r=O(e)[0]-a.top,l=O(e)[1]-a.left;if(n===r&&i===l)return;t(n,i,r,l)}}).add(p).bind("mouseup."+u+" touchend."+u+" pointerup."+u+" MSPointerUp."+u,function(){o&&(C(o,"active",d.autoExpandScrollbar),o=null),c=!1,s&&(document.onselectstart=null),L.call(h,!0)})},D=function(){function o(e){if(!te(e)||c||O(e)[2])return void(t=0);t=1,b=0,C=0,d=1,y.removeClass("mCS_touch_action");var o=I.offset();u=O(e)[0]-o.top,f=O(e)[1]-o.left,z=[O(e)[0],O(e)[1]]}function n(e){if(te(e)&&!c&&!O(e)[2]&&(T.documentTouchScroll||e.preventDefault(),e.stopImmediatePropagation(),(!C||b)&&d)){g=K();var t=M.offset(),o=O(e)[0]-t.top,a=O(e)[1]-t.left,n="mcsLinearOut";if(E.push(o),W.push(a),z[2]=Math.abs(O(e)[0]-z[0]),z[3]=Math.abs(O(e)[1]-z[1]),B.overflowed[0])var i=D[0].parent().height()-D[0].height(),r=u-o>0&&o-u>-(i*B.scrollRatio.y)&&(2*z[3]<z[2]||"yx"===T.axis);if(B.overflowed[1])var l=D[1].parent().width()-D[1].width(),h=f-a>0&&a-f>-(l*B.scrollRatio.x)&&(2*z[2]<z[3]||"yx"===T.axis);r||h?(U||e.preventDefault(),b=1):(C=1,y.addClass("mCS_touch_action")),U&&e.preventDefault(),w="yx"===T.axis?[u-o,f-a]:"x"===T.axis?[null,f-a]:[u-o,null],I[0].idleTimer=250,B.overflowed[0]&&s(w[0],R,n,"y","all",!0),B.overflowed[1]&&s(w[1],R,n,"x",L,!0)}}function i(e){if(!te(e)||c||O(e)[2])return void(t=0);t=1,e.stopImmediatePropagation(),Q(y),p=K();var o=M.offset();h=O(e)[0]-o.top,m=O(e)[1]-o.left,E=[],W=[]}function r(e){if(te(e)&&!c&&!O(e)[2]){d=0,e.stopImmediatePropagation(),b=0,C=0,v=K();var t=M.offset(),o=O(e)[0]-t.top,a=O(e)[1]-t.left;if(!(v-g>30)){_=1e3/(v-p);var n="mcsEaseOut",i=2.5>_,r=i?[E[E.length-2],W[W.length-2]]:[0,0];x=i?[o-r[0],a-r[1]]:[o-h,a-m];var u=[Math.abs(x[0]),Math.abs(x[1])];_=i?[Math.abs(x[0]/4),Math.abs(x[1]/4)]:[_,_];var f=[Math.abs(I[0].offsetTop)-x[0]*l(u[0]/_[0],_[0]),Math.abs(I[0].offsetLeft)-x[1]*l(u[1]/_[1],_[1])];w="yx"===T.axis?[f[0],f[1]]:"x"===T.axis?[null,f[1]]:[f[0],null],S=[4*u[0]+T.scrollInertia,4*u[1]+T.scrollInertia];var y=parseInt(T.contentTouchScroll)||0;w[0]=u[0]>y?w[0]:0,w[1]=u[1]>y?w[1]:0,B.overflowed[0]&&s(w[0],S[0],n,"y",L,!1),B.overflowed[1]&&s(w[1],S[1],n,"x",L,!1)}}}function l(e,t){var o=[1.5*t,2*t,t/1.5,t/2];return e>90?t>4?o[0]:o[3]:e>60?t>3?o[3]:o[2]:e>30?t>8?o[1]:t>6?o[0]:t>4?t:o[2]:t>8?t:o[3]}function s(e,t,o,a,n,i){e&&G(y,e.toString(),{dur:t,scrollEasing:o,dir:a,overwrite:n,drag:i})}var d,u,f,h,m,p,g,v,x,_,w,S,b,C,y=e(this),B=y.data(a),T=B.opt,k=a+"_"+B.idx,M=e("#mCSB_"+B.idx),I=e("#mCSB_"+B.idx+"_container"),D=[e("#mCSB_"+B.idx+"_dragger_vertical"),e("#mCSB_"+B.idx+"_dragger_horizontal")],E=[],W=[],R=0,L="yx"===T.axis?"none":"all",z=[],P=I.find("iframe"),H=["touchstart."+k+" pointerdown."+k+" MSPointerDown."+k,"touchmove."+k+" pointermove."+k+" MSPointerMove."+k,"touchend."+k+" pointerup."+k+" MSPointerUp."+k],U=void 0!==document.body.style.touchAction&&""!==document.body.style.touchAction;I.bind(H[0],function(e){o(e)}).bind(H[1],function(e){n(e)}),M.bind(H[0],function(e){i(e)}).bind(H[2],function(e){r(e)}),P.length&&P.each(function(){e(this).bind("load",function(){A(this)&&e(this.contentDocument||this.contentWindow.document).bind(H[0],function(e){o(e),i(e)}).bind(H[1],function(e){n(e)}).bind(H[2],function(e){r(e)})})})},E=function(){function o(){return window.getSelection?window.getSelection().toString():document.selection&&"Control"!=document.selection.type?document.selection.createRange().text:0}function n(e,t,o){d.type=o&&i?"stepped":"stepless",d.scrollAmount=10,j(r,e,t,"mcsLinearOut",o?60:null)}var i,r=e(this),l=r.data(a),s=l.opt,d=l.sequential,u=a+"_"+l.idx,f=e("#mCSB_"+l.idx+"_container"),h=f.parent();f.bind("mousedown."+u,function(){t||i||(i=1,c=!0)}).add(document).bind("mousemove."+u,function(e){if(!t&&i&&o()){var a=f.offset(),r=O(e)[0]-a.top+f[0].offsetTop,c=O(e)[1]-a.left+f[0].offsetLeft;r>0&&r<h.height()&&c>0&&c<h.width()?d.step&&n("off",null,"stepped"):("x"!==s.axis&&l.overflowed[0]&&(0>r?n("on",38):r>h.height()&&n("on",40)),"y"!==s.axis&&l.overflowed[1]&&(0>c?n("on",37):c>h.width()&&n("on",39)))}}).bind("mouseup."+u+" dragend."+u,function(){t||(i&&(i=0,n("off",null)),c=!1)})},W=function(){function t(t,a){if(Q(o),!z(o,t.target)){var r="auto"!==i.mouseWheel.deltaFactor?parseInt(i.mouseWheel.deltaFactor):s&&t.deltaFactor<100?100:t.deltaFactor||100,d=i.scrollInertia;if("x"===i.axis||"x"===i.mouseWheel.axis)var u="x",f=[Math.round(r*n.scrollRatio.x),parseInt(i.mouseWheel.scrollAmount)],h="auto"!==i.mouseWheel.scrollAmount?f[1]:f[0]>=l.width()?.9*l.width():f[0],m=Math.abs(e("#mCSB_"+n.idx+"_container")[0].offsetLeft),p=c[1][0].offsetLeft,g=c[1].parent().width()-c[1].width(),v="y"===i.mouseWheel.axis?t.deltaY||a:t.deltaX;else var u="y",f=[Math.round(r*n.scrollRatio.y),parseInt(i.mouseWheel.scrollAmount)],h="auto"!==i.mouseWheel.scrollAmount?f[1]:f[0]>=l.height()?.9*l.height():f[0],m=Math.abs(e("#mCSB_"+n.idx+"_container")[0].offsetTop),p=c[0][0].offsetTop,g=c[0].parent().height()-c[0].height(),v=t.deltaY||a;"y"===u&&!n.overflowed[0]||"x"===u&&!n.overflowed[1]||((i.mouseWheel.invert||t.webkitDirectionInvertedFromDevice)&&(v=-v),i.mouseWheel.normalizeDelta&&(v=0>v?-1:1),(v>0&&0!==p||0>v&&p!==g||i.mouseWheel.preventDefault)&&(t.stopImmediatePropagation(),t.preventDefault()),t.deltaFactor<5&&!i.mouseWheel.normalizeDelta&&(h=t.deltaFactor,d=17),G(o,(m-v*h).toString(),{dir:u,dur:d}))}}if(e(this).data(a)){var o=e(this),n=o.data(a),i=n.opt,r=a+"_"+n.idx,l=e("#mCSB_"+n.idx),c=[e("#mCSB_"+n.idx+"_dragger_vertical"),e("#mCSB_"+n.idx+"_dragger_horizontal")],d=e("#mCSB_"+n.idx+"_container").find("iframe");d.length&&d.each(function(){e(this).bind("load",function(){A(this)&&e(this.contentDocument||this.contentWindow.document).bind("mousewheel."+r,function(e,o){t(e,o)})})}),l.bind("mousewheel."+r,function(e,o){t(e,o)})}},R=new Object,A=function(t){var o=!1,a=!1,n=null;if(void 0===t?a="#empty":void 0!==e(t).attr("id")&&(a=e(t).attr("id")),a!==!1&&void 0!==R[a])return R[a];if(t){try{var i=t.contentDocument||t.contentWindow.document;n=i.body.innerHTML}catch(r){}o=null!==n}else{try{var i=top.document;n=i.body.innerHTML}catch(r){}o=null!==n}return a!==!1&&(R[a]=o),o},L=function(e){var t=this.find("iframe");if(t.length){var o=e?"auto":"none";t.css("pointer-events",o)}},z=function(t,o){var n=o.nodeName.toLowerCase(),i=t.data(a).opt.mouseWheel.disableOver,r=["select","textarea"];return e.inArray(n,i)>-1&&!(e.inArray(n,r)>-1&&!e(o).is(":focus"))},P=function(){var t,o=e(this),n=o.data(a),i=a+"_"+n.idx,r=e("#mCSB_"+n.idx+"_container"),l=r.parent(),s=e(".mCSB_"+n.idx+"_scrollbar ."+d[12]);s.bind("mousedown."+i+" touchstart."+i+" pointerdown."+i+" MSPointerDown."+i,function(o){c=!0,e(o.target).hasClass("mCSB_dragger")||(t=1)}).bind("touchend."+i+" pointerup."+i+" MSPointerUp."+i,function(){c=!1}).bind("click."+i,function(a){if(t&&(t=0,e(a.target).hasClass(d[12])||e(a.target).hasClass("mCSB_draggerRail"))){Q(o);var i=e(this),s=i.find(".mCSB_dragger");if(i.parent(".mCSB_scrollTools_horizontal").length>0){if(!n.overflowed[1])return;var c="x",u=a.pageX>s.offset().left?-1:1,f=Math.abs(r[0].offsetLeft)-u*(.9*l.width())}else{if(!n.overflowed[0])return;var c="y",u=a.pageY>s.offset().top?-1:1,f=Math.abs(r[0].offsetTop)-u*(.9*l.height())}G(o,f.toString(),{dir:c,scrollEasing:"mcsEaseInOut"})}})},H=function(){var t=e(this),o=t.data(a),n=o.opt,i=a+"_"+o.idx,r=e("#mCSB_"+o.idx+"_container"),l=r.parent();r.bind("focusin."+i,function(){var o=e(document.activeElement),a=r.find(".mCustomScrollBox").length,i=0;o.is(n.advanced.autoScrollOnFocus)&&(Q(t),clearTimeout(t[0]._focusTimeout),t[0]._focusTimer=a?(i+17)*a:0,t[0]._focusTimeout=setTimeout(function(){var e=[ae(o)[0],ae(o)[1]],a=[r[0].offsetTop,r[0].offsetLeft],s=[a[0]+e[0]>=0&&a[0]+e[0]<l.height()-o.outerHeight(!1),a[1]+e[1]>=0&&a[0]+e[1]<l.width()-o.outerWidth(!1)],c="yx"!==n.axis||s[0]||s[1]?"all":"none";"x"===n.axis||s[0]||G(t,e[0].toString(),{dir:"y",scrollEasing:"mcsEaseInOut",overwrite:c,dur:i}),"y"===n.axis||s[1]||G(t,e[1].toString(),{dir:"x",scrollEasing:"mcsEaseInOut",overwrite:c,dur:i})},t[0]._focusTimer))})},U=function(){var t=e(this),o=t.data(a),n=a+"_"+o.idx,i=e("#mCSB_"+o.idx+"_container").parent();i.bind("scroll."+n,function(){0===i.scrollTop()&&0===i.scrollLeft()||e(".mCSB_"+o.idx+"_scrollbar").css("visibility","hidden")})},F=function(){var t=e(this),o=t.data(a),n=o.opt,i=o.sequential,r=a+"_"+o.idx,l=".mCSB_"+o.idx+"_scrollbar",s=e(l+">a");s.bind("contextmenu."+r,function(e){e.preventDefault()}).bind("mousedown."+r+" touchstart."+r+" pointerdown."+r+" MSPointerDown."+r+" mouseup."+r+" touchend."+r+" pointerup."+r+" MSPointerUp."+r+" mouseout."+r+" pointerout."+r+" MSPointerOut."+r+" click."+r,function(a){function r(e,o){i.scrollAmount=n.scrollButtons.scrollAmount,j(t,e,o)}if(a.preventDefault(),ee(a)){var l=e(this).attr("class");switch(i.type=n.scrollButtons.scrollType,a.type){case"mousedown":case"touchstart":case"pointerdown":case"MSPointerDown":if("stepped"===i.type)return;c=!0,o.tweenRunning=!1,r("on",l);break;case"mouseup":case"touchend":case"pointerup":case"MSPointerUp":case"mouseout":case"pointerout":case"MSPointerOut":if("stepped"===i.type)return;c=!1,i.dir&&r("off",l);break;case"click":if("stepped"!==i.type||o.tweenRunning)return;r("on",l)}}})},q=function(){function t(t){function a(e,t){r.type=i.keyboard.scrollType,r.scrollAmount=i.keyboard.scrollAmount,"stepped"===r.type&&n.tweenRunning||j(o,e,t)}switch(t.type){case"blur":n.tweenRunning&&r.dir&&a("off",null);break;case"keydown":case"keyup":var l=t.keyCode?t.keyCode:t.which,s="on";if("x"!==i.axis&&(38===l||40===l)||"y"!==i.axis&&(37===l||39===l)){if((38===l||40===l)&&!n.overflowed[0]||(37===l||39===l)&&!n.overflowed[1])return;"keyup"===t.type&&(s="off"),e(document.activeElement).is(u)||(t.preventDefault(),t.stopImmediatePropagation(),a(s,l))}else if(33===l||34===l){if((n.overflowed[0]||n.overflowed[1])&&(t.preventDefault(),t.stopImmediatePropagation()),"keyup"===t.type){Q(o);var f=34===l?-1:1;if("x"===i.axis||"yx"===i.axis&&n.overflowed[1]&&!n.overflowed[0])var h="x",m=Math.abs(c[0].offsetLeft)-f*(.9*d.width());else var h="y",m=Math.abs(c[0].offsetTop)-f*(.9*d.height());G(o,m.toString(),{dir:h,scrollEasing:"mcsEaseInOut"})}}else if((35===l||36===l)&&!e(document.activeElement).is(u)&&((n.overflowed[0]||n.overflowed[1])&&(t.preventDefault(),t.stopImmediatePropagation()),"keyup"===t.type)){if("x"===i.axis||"yx"===i.axis&&n.overflowed[1]&&!n.overflowed[0])var h="x",m=35===l?Math.abs(d.width()-c.outerWidth(!1)):0;else var h="y",m=35===l?Math.abs(d.height()-c.outerHeight(!1)):0;G(o,m.toString(),{dir:h,scrollEasing:"mcsEaseInOut"})}}}var o=e(this),n=o.data(a),i=n.opt,r=n.sequential,l=a+"_"+n.idx,s=e("#mCSB_"+n.idx),c=e("#mCSB_"+n.idx+"_container"),d=c.parent(),u="input,textarea,select,datalist,keygen,[contenteditable='true']",f=c.find("iframe"),h=["blur."+l+" keydown."+l+" keyup."+l];f.length&&f.each(function(){e(this).bind("load",function(){A(this)&&e(this.contentDocument||this.contentWindow.document).bind(h[0],function(e){t(e)})})}),s.attr("tabindex","0").bind(h[0],function(e){t(e)})},j=function(t,o,n,i,r){function l(e){u.snapAmount&&(f.scrollAmount=u.snapAmount instanceof Array?"x"===f.dir[0]?u.snapAmount[1]:u.snapAmount[0]:u.snapAmount);var o="stepped"!==f.type,a=r?r:e?o?p/1.5:g:1e3/60,n=e?o?7.5:40:2.5,s=[Math.abs(h[0].offsetTop),Math.abs(h[0].offsetLeft)],d=[c.scrollRatio.y>10?10:c.scrollRatio.y,c.scrollRatio.x>10?10:c.scrollRatio.x],m="x"===f.dir[0]?s[1]+f.dir[1]*(d[1]*n):s[0]+f.dir[1]*(d[0]*n),v="x"===f.dir[0]?s[1]+f.dir[1]*parseInt(f.scrollAmount):s[0]+f.dir[1]*parseInt(f.scrollAmount),x="auto"!==f.scrollAmount?v:m,_=i?i:e?o?"mcsLinearOut":"mcsEaseInOut":"mcsLinear",w=!!e;return e&&17>a&&(x="x"===f.dir[0]?s[1]:s[0]),G(t,x.toString(),{dir:f.dir[0],scrollEasing:_,dur:a,onComplete:w}),e?void(f.dir=!1):(clearTimeout(f.step),void(f.step=setTimeout(function(){l()},a)))}function s(){clearTimeout(f.step),$(f,"step"),Q(t)}var c=t.data(a),u=c.opt,f=c.sequential,h=e("#mCSB_"+c.idx+"_container"),m="stepped"===f.type,p=u.scrollInertia<26?26:u.scrollInertia,g=u.scrollInertia<1?17:u.scrollInertia;switch(o){case"on":if(f.dir=[n===d[16]||n===d[15]||39===n||37===n?"x":"y",n===d[13]||n===d[15]||38===n||37===n?-1:1],Q(t),oe(n)&&"stepped"===f.type)return;l(m);break;case"off":s(),(m||c.tweenRunning&&f.dir)&&l(!0)}},Y=function(t){var o=e(this).data(a).opt,n=[];return"function"==typeof t&&(t=t()),t instanceof Array?n=t.length>1?[t[0],t[1]]:"x"===o.axis?[null,t[0]]:[t[0],null]:(n[0]=t.y?t.y:t.x||"x"===o.axis?null:t,n[1]=t.x?t.x:t.y||"y"===o.axis?null:t),"function"==typeof n[0]&&(n[0]=n[0]()),"function"==typeof n[1]&&(n[1]=n[1]()),n},X=function(t,o){if(null!=t&&"undefined"!=typeof t){var n=e(this),i=n.data(a),r=i.opt,l=e("#mCSB_"+i.idx+"_container"),s=l.parent(),c=typeof t;o||(o="x"===r.axis?"x":"y");var d="x"===o?l.outerWidth(!1)-s.width():l.outerHeight(!1)-s.height(),f="x"===o?l[0].offsetLeft:l[0].offsetTop,h="x"===o?"left":"top";switch(c){case"function":return t();case"object":var m=t.jquery?t:e(t);if(!m.length)return;return"x"===o?ae(m)[1]:ae(m)[0];case"string":case"number":if(oe(t))return Math.abs(t);if(-1!==t.indexOf("%"))return Math.abs(d*parseInt(t)/100);if(-1!==t.indexOf("-="))return Math.abs(f-parseInt(t.split("-=")[1]));if(-1!==t.indexOf("+=")){var p=f+parseInt(t.split("+=")[1]);return p>=0?0:Math.abs(p)}if(-1!==t.indexOf("px")&&oe(t.split("px")[0]))return Math.abs(t.split("px")[0]);if("top"===t||"left"===t)return 0;if("bottom"===t)return Math.abs(s.height()-l.outerHeight(!1));if("right"===t)return Math.abs(s.width()-l.outerWidth(!1));if("first"===t||"last"===t){var m=l.find(":"+t);return"x"===o?ae(m)[1]:ae(m)[0]}return e(t).length?"x"===o?ae(e(t))[1]:ae(e(t))[0]:(l.css(h,t),void u.update.call(null,n[0]))}}},N=function(t){function o(){return clearTimeout(f[0].autoUpdate),0===l.parents("html").length?void(l=null):void(f[0].autoUpdate=setTimeout(function(){return c.advanced.updateOnSelectorChange&&(s.poll.change.n=i(),s.poll.change.n!==s.poll.change.o)?(s.poll.change.o=s.poll.change.n,void r(3)):c.advanced.updateOnContentResize&&(s.poll.size.n=l[0].scrollHeight+l[0].scrollWidth+f[0].offsetHeight+l[0].offsetHeight+l[0].offsetWidth,s.poll.size.n!==s.poll.size.o)?(s.poll.size.o=s.poll.size.n,void r(1)):!c.advanced.updateOnImageLoad||"auto"===c.advanced.updateOnImageLoad&&"y"===c.axis||(s.poll.img.n=f.find("img").length,s.poll.img.n===s.poll.img.o)?void((c.advanced.updateOnSelectorChange||c.advanced.updateOnContentResize||c.advanced.updateOnImageLoad)&&o()):(s.poll.img.o=s.poll.img.n,void f.find("img").each(function(){n(this)}))},c.advanced.autoUpdateTimeout))}function n(t){function o(e,t){return function(){
    return t.apply(e,arguments)}}function a(){this.onload=null,e(t).addClass(d[2]),r(2)}if(e(t).hasClass(d[2]))return void r();var n=new Image;n.onload=o(n,a),n.src=t.src}function i(){c.advanced.updateOnSelectorChange===!0&&(c.advanced.updateOnSelectorChange="*");var e=0,t=f.find(c.advanced.updateOnSelectorChange);return c.advanced.updateOnSelectorChange&&t.length>0&&t.each(function(){e+=this.offsetHeight+this.offsetWidth}),e}function r(e){clearTimeout(f[0].autoUpdate),u.update.call(null,l[0],e)}var l=e(this),s=l.data(a),c=s.opt,f=e("#mCSB_"+s.idx+"_container");return t?(clearTimeout(f[0].autoUpdate),void $(f[0],"autoUpdate")):void o()},V=function(e,t,o){return Math.round(e/t)*t-o},Q=function(t){var o=t.data(a),n=e("#mCSB_"+o.idx+"_container,#mCSB_"+o.idx+"_container_wrapper,#mCSB_"+o.idx+"_dragger_vertical,#mCSB_"+o.idx+"_dragger_horizontal");n.each(function(){Z.call(this)})},G=function(t,o,n){function i(e){return s&&c.callbacks[e]&&"function"==typeof c.callbacks[e]}function r(){return[c.callbacks.alwaysTriggerOffsets||w>=S[0]+y,c.callbacks.alwaysTriggerOffsets||-B>=w]}function l(){var e=[h[0].offsetTop,h[0].offsetLeft],o=[x[0].offsetTop,x[0].offsetLeft],a=[h.outerHeight(!1),h.outerWidth(!1)],i=[f.height(),f.width()];t[0].mcs={content:h,top:e[0],left:e[1],draggerTop:o[0],draggerLeft:o[1],topPct:Math.round(100*Math.abs(e[0])/(Math.abs(a[0])-i[0])),leftPct:Math.round(100*Math.abs(e[1])/(Math.abs(a[1])-i[1])),direction:n.dir}}var s=t.data(a),c=s.opt,d={trigger:"internal",dir:"y",scrollEasing:"mcsEaseOut",drag:!1,dur:c.scrollInertia,overwrite:"all",callbacks:!0,onStart:!0,onUpdate:!0,onComplete:!0},n=e.extend(d,n),u=[n.dur,n.drag?0:n.dur],f=e("#mCSB_"+s.idx),h=e("#mCSB_"+s.idx+"_container"),m=h.parent(),p=c.callbacks.onTotalScrollOffset?Y.call(t,c.callbacks.onTotalScrollOffset):[0,0],g=c.callbacks.onTotalScrollBackOffset?Y.call(t,c.callbacks.onTotalScrollBackOffset):[0,0];if(s.trigger=n.trigger,0===m.scrollTop()&&0===m.scrollLeft()||(e(".mCSB_"+s.idx+"_scrollbar").css("visibility","visible"),m.scrollTop(0).scrollLeft(0)),"_resetY"!==o||s.contentReset.y||(i("onOverflowYNone")&&c.callbacks.onOverflowYNone.call(t[0]),s.contentReset.y=1),"_resetX"!==o||s.contentReset.x||(i("onOverflowXNone")&&c.callbacks.onOverflowXNone.call(t[0]),s.contentReset.x=1),"_resetY"!==o&&"_resetX"!==o){if(!s.contentReset.y&&t[0].mcs||!s.overflowed[0]||(i("onOverflowY")&&c.callbacks.onOverflowY.call(t[0]),s.contentReset.x=null),!s.contentReset.x&&t[0].mcs||!s.overflowed[1]||(i("onOverflowX")&&c.callbacks.onOverflowX.call(t[0]),s.contentReset.x=null),c.snapAmount){var v=c.snapAmount instanceof Array?"x"===n.dir?c.snapAmount[1]:c.snapAmount[0]:c.snapAmount;o=V(o,v,c.snapOffset)}switch(n.dir){case"x":var x=e("#mCSB_"+s.idx+"_dragger_horizontal"),_="left",w=h[0].offsetLeft,S=[f.width()-h.outerWidth(!1),x.parent().width()-x.width()],b=[o,0===o?0:o/s.scrollRatio.x],y=p[1],B=g[1],T=y>0?y/s.scrollRatio.x:0,k=B>0?B/s.scrollRatio.x:0;break;case"y":var x=e("#mCSB_"+s.idx+"_dragger_vertical"),_="top",w=h[0].offsetTop,S=[f.height()-h.outerHeight(!1),x.parent().height()-x.height()],b=[o,0===o?0:o/s.scrollRatio.y],y=p[0],B=g[0],T=y>0?y/s.scrollRatio.y:0,k=B>0?B/s.scrollRatio.y:0}b[1]<0||0===b[0]&&0===b[1]?b=[0,0]:b[1]>=S[1]?b=[S[0],S[1]]:b[0]=-b[0],t[0].mcs||(l(),i("onInit")&&c.callbacks.onInit.call(t[0])),clearTimeout(h[0].onCompleteTimeout),J(x[0],_,Math.round(b[1]),u[1],n.scrollEasing),!s.tweenRunning&&(0===w&&b[0]>=0||w===S[0]&&b[0]<=S[0])||J(h[0],_,Math.round(b[0]),u[0],n.scrollEasing,n.overwrite,{onStart:function(){n.callbacks&&n.onStart&&!s.tweenRunning&&(i("onScrollStart")&&(l(),c.callbacks.onScrollStart.call(t[0])),s.tweenRunning=!0,C(x),s.cbOffsets=r())},onUpdate:function(){n.callbacks&&n.onUpdate&&i("whileScrolling")&&(l(),c.callbacks.whileScrolling.call(t[0]))},onComplete:function(){if(n.callbacks&&n.onComplete){"yx"===c.axis&&clearTimeout(h[0].onCompleteTimeout);var e=h[0].idleTimer||0;h[0].onCompleteTimeout=setTimeout(function(){i("onScroll")&&(l(),c.callbacks.onScroll.call(t[0])),i("onTotalScroll")&&b[1]>=S[1]-T&&s.cbOffsets[0]&&(l(),c.callbacks.onTotalScroll.call(t[0])),i("onTotalScrollBack")&&b[1]<=k&&s.cbOffsets[1]&&(l(),c.callbacks.onTotalScrollBack.call(t[0])),s.tweenRunning=!1,h[0].idleTimer=0,C(x,"hide")},e)}}})}},J=function(e,t,o,a,n,i,r){function l(){S.stop||(x||m.call(),x=K()-v,s(),x>=S.time&&(S.time=x>S.time?x+f-(x-S.time):x+f-1,S.time<x+1&&(S.time=x+1)),S.time<a?S.id=h(l):g.call())}function s(){a>0?(S.currVal=u(S.time,_,b,a,n),w[t]=Math.round(S.currVal)+"px"):w[t]=o+"px",p.call()}function c(){f=1e3/60,S.time=x+f,h=window.requestAnimationFrame?window.requestAnimationFrame:function(e){return s(),setTimeout(e,.01)},S.id=h(l)}function d(){null!=S.id&&(window.requestAnimationFrame?window.cancelAnimationFrame(S.id):clearTimeout(S.id),S.id=null)}function u(e,t,o,a,n){switch(n){case"linear":case"mcsLinear":return o*e/a+t;case"mcsLinearOut":return e/=a,e--,o*Math.sqrt(1-e*e)+t;case"easeInOutSmooth":return e/=a/2,1>e?o/2*e*e+t:(e--,-o/2*(e*(e-2)-1)+t);case"easeInOutStrong":return e/=a/2,1>e?o/2*Math.pow(2,10*(e-1))+t:(e--,o/2*(-Math.pow(2,-10*e)+2)+t);case"easeInOut":case"mcsEaseInOut":return e/=a/2,1>e?o/2*e*e*e+t:(e-=2,o/2*(e*e*e+2)+t);case"easeOutSmooth":return e/=a,e--,-o*(e*e*e*e-1)+t;case"easeOutStrong":return o*(-Math.pow(2,-10*e/a)+1)+t;case"easeOut":case"mcsEaseOut":default:var i=(e/=a)*e,r=i*e;return t+o*(.499999999999997*r*i+-2.5*i*i+5.5*r+-6.5*i+4*e)}}e._mTween||(e._mTween={top:{},left:{}});var f,h,r=r||{},m=r.onStart||function(){},p=r.onUpdate||function(){},g=r.onComplete||function(){},v=K(),x=0,_=e.offsetTop,w=e.style,S=e._mTween[t];"left"===t&&(_=e.offsetLeft);var b=o-_;S.stop=0,"none"!==i&&d(),c()},K=function(){return window.performance&&window.performance.now?window.performance.now():window.performance&&window.performance.webkitNow?window.performance.webkitNow():Date.now?Date.now():(new Date).getTime()},Z=function(){var e=this;e._mTween||(e._mTween={top:{},left:{}});for(var t=["top","left"],o=0;o<t.length;o++){var a=t[o];e._mTween[a].id&&(window.requestAnimationFrame?window.cancelAnimationFrame(e._mTween[a].id):clearTimeout(e._mTween[a].id),e._mTween[a].id=null,e._mTween[a].stop=1)}},$=function(e,t){try{delete e[t]}catch(o){e[t]=null}},ee=function(e){return!(e.which&&1!==e.which)},te=function(e){var t=e.originalEvent.pointerType;return!(t&&"touch"!==t&&2!==t)},oe=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},ae=function(e){var t=e.parents(".mCSB_container");return[e.offset().top-t.offset().top,e.offset().left-t.offset().left]},ne=function(){function e(){var e=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var t=0;t<e.length;t++)if(e[t]+"Hidden"in document)return e[t]+"Hidden";return null}var t=e();return t?document[t]:!1};e.fn[o]=function(t){return u[t]?u[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist"):u.init.apply(this,arguments)},e[o]=function(t){return u[t]?u[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist"):u.init.apply(this,arguments)},e[o].defaults=i,window[o]=!0,e(window).bind("load",function(){e(n)[o](),e.extend(e.expr[":"],{mcsInView:e.expr[":"].mcsInView||function(t){var o,a,n=e(t),i=n.parents(".mCSB_container");if(i.length)return o=i.parent(),a=[i[0].offsetTop,i[0].offsetLeft],a[0]+ae(n)[0]>=0&&a[0]+ae(n)[0]<o.height()-n.outerHeight(!1)&&a[1]+ae(n)[1]>=0&&a[1]+ae(n)[1]<o.width()-n.outerWidth(!1)},mcsInSight:e.expr[":"].mcsInSight||function(t,o,a){var n,i,r,l,s=e(t),c=s.parents(".mCSB_container"),d="exact"===a[3]?[[1,0],[1,0]]:[[.9,.1],[.6,.4]];if(c.length)return n=[s.outerHeight(!1),s.outerWidth(!1)],r=[c[0].offsetTop+ae(s)[0],c[0].offsetLeft+ae(s)[1]],i=[c.parent()[0].offsetHeight,c.parent()[0].offsetWidth],l=[n[0]<i[0]?d[0]:d[1],n[1]<i[1]?d[0]:d[1]],r[0]-i[0]*l[0][0]<0&&r[0]+n[0]-i[0]*l[0][1]>=0&&r[1]-i[1]*l[1][0]<0&&r[1]+n[1]-i[1]*l[1][1]>=0},mcsOverflow:e.expr[":"].mcsOverflow||function(t){var o=e(t).data(a);if(o)return o.overflowed[0]||o.overflowed[1]}})})})});
var forum = {
    reportAbuseId: null,
    reportType: null,
    quesId: null,
    page: 0,
    currentTabIndex: 0,
    maxLength: 300,
    textarea: $('#report-abuse-comment'),
    buttonData: null,
    adminToken: null,
    isAuthor: false,
    urlHash: window.location.hash,
    abuseId: null,
    count: 0,

};
var forumSearchQuery = {
    page: 0,
    query: "",
    sort: {}
};
var temp = {};
var emailDetails = [];
var page = 0;
var totalCount;
var liSelected;
var profileUrl;
var forumCategories;
var summmernoteRange;
var li;
var questionTitle;

var getQueryUrl = function (index) {
    if (index == 0) {
        var apiPath = "/api/common/category/questions?offset=" + forum.page
            + "&state=" + (sessionStorage.getItem("state") ? sessionStorage.getItem("state") : "")
            + "&city=" + (sessionStorage.getItem("city") ? sessionStorage.getItem("city") : "");
        var viewAll = getParam("view");
        //console.log(viewAll);
        if (isUserPublishedAndLoggedIn()) {
            apiPath = "/api/auth/forum/category/questions?offset=" + forum.page
                + "&state=" + (sessionStorage.getItem("state") ? sessionStorage.getItem("state") : "")
                + "&city=" + (sessionStorage.getItem("city") ? sessionStorage.getItem("city") : "");
            if (sessionStorage.getItem("subCategory") && !viewAll) {
                apiPath = apiPath + "&category=" + sessionStorage.getItem("subCategory");
                return SIH.getEndPoint(apiPath);
            } else if (sessionStorage.getItem("category")) {
                apiPath = apiPath + "&category=" + sessionStorage.getItem("category");
                return SIH.getEndPoint(apiPath);
            } else {
                return SIH.getEndPoint("/api/auth/forum/questions?offset=" + forum.page);
            }
        } else {
            if (sessionStorage.getItem("subCategory") && !viewAll) {
                apiPath = apiPath + "&category=" + sessionStorage.getItem("subCategory");
                return SIH.getEndPoint(apiPath);
            } else if (sessionStorage.getItem("category")) {
                apiPath = apiPath + "&category=" + sessionStorage.getItem("category");
                return SIH.getEndPoint(apiPath);
            } else {
                return SIH.getEndPoint("/api/common/questions?offset=" + forum.page);
            }
        }
    } else {
        return SIH.getEndPoint("/api/auth/forum/subscriptions?offset=" + forum.page);
    }
}

function getParam(name) {
    if (name = (new RegExp('[?&]' + encodeURIComponent(name) + '=([^&]*)')).exec(location.search))
        return decodeURIComponent(name[1]);
}

function getQueryList(replaceContent) {
    $("#modal-loader").modal("show");
    var path = getQueryUrl(forum.currentTabIndex);
    $.ajax({
        type: "GET",
        url: path,
        contentType: "application/json",
        beforeSend: setAuthTokenHeader
    }).done(function (data) {
        if (data.content.length) {
            handleQueryData(data, replaceContent);
        } else {
            showSnackbar('<i class="fa-2x fa-info-circle"></i>No more discussions are available.', "alert-info");
        }

        if (data.totalPages > 1) {
            $("button[name=loadMoreThreads]").removeClass("hidden");
        }

        $("#modal-loader").modal("hide");
    }).fail(function () {
        $('.pagination').hide();
        $("#modal-loader").modal("hide");
    });
}

function forumPagination(data) {

    var pagination = {
        pages: data.totalPages,
        number: data.number + 1,
        last: data.last,
        first: data.first
    }
    var paginationResource = $('#pagination-template').html();
    if (paginationResource) {
        var paginationTemplate = Handlebars.compile(paginationResource);
        $('#pagination-div').html(paginationTemplate(pagination));
    }

    if (pagination.pages > 5) {
        $('span.first-page,span.last-page').css('display', 'block');
        if ($('.pagination li.active').index() == 0)
            $('span.first-page').css('display', 'none');
        if ($('.pagination li.active').index() == 4)
            $('span.last-page').css('display', 'none');
    } else {
        $('span.first-page, span.last-page').css('display', 'none');
    }
}

$(document).on('click', 'button[name=loadMoreThreads]', function () {
    loadQueryPage();
})

var loadQueryPage = function (page) {
    //var pageNumber = parseInt($(page).html());
    forum.page = forum.page + 1;
    getQueryList();
    //paginationScrollTop();
}

var nextQueryPage = function (elem) {
    var currentPage = parseInt($(elem).siblings('ul').find('li.active').html());
    forum.page = currentPage;
    getQueryList();
    paginationScrollTop();
}

var previousQueryPage = function (elem) {
    var currentPage = parseInt($(elem).siblings('ul').find('li.active').html());
    forum.page = currentPage - 2;
    getQueryList();
    paginationScrollTop();
}

var forumFirst = function () {
    forum.page = 0;
    getQueryList();
    paginationScrollTop();
}

var forumLast = function (pages) {
    forum.page = pages - 1;
    getQueryList();
    paginationScrollTop();
}

function paginationScrollTop() {
    if (forum.currentTabIndex == 0) {
        $('html, body').animate({
            scrollTop: $('#all-list').offset().top - 150
        }, 500);
    }
    else {
        $('html, body').animate({
            scrollTop: $('#subscription-list').offset().top - 150
        }, 500);
    }
}

$(document).on("click", "ul.nav-tabs li.query-tab-pane", function () {
    var tabId = $(this).find('a').data('id');
    if (tabId == 'all') {
        forum.currentTabIndex = 0;
        forum.page = 0;
    } else {
        forum.currentTabIndex = 1;
        forum.page = 0;
    }
    getQueryList();
});

function submitQuery() {
    //$('#post-query-btn').attr('disabled', 'disabled');
    var path = SIH.getEndPoint("/api/auth/forum/question/ask");
    var title = $("#query-title").val();
    var description = $("#query-description").val();//replace(/<[^>]*>/g, "").trim();
    //var note = des.summernote('code').replace(/<\/?[^>]+(>|$)/g, "");
    var category = $("#category").val();
    var subCategory = $("#sub-category").val();
    var attachments = [];
    $.each($("input[name=attachment]"), function (i, v) {
        attachments.push({
            title: $(v).val(),
            fileName: $(v).data("originalname")
        });
    });
    if (validateCreateQuestionForm()) {
        var question = {
            description: description,
            title: title,
            category: category,
            subCategory: subCategory,
            attachment: attachments,
            state: store.getItem("state"),
            city: store.getItem("city"),

        };
        $.ajax({
            type: "POST",
            url: path,
            data: JSON.stringify(question),
            contentType: "application/json",
            beforeSend: setAuthTokenHeader
        }).done(function (data) {
            if (data) {
                //console.log(data);
                //getQueryList();
                $("#query-title").val('');
                $("#query-description").val('');
                $('.note-editor.note-frame').removeClass('note-has-error');
                $("#query-description").summernote('reset');
                $("#category").val('').trigger("change");
                $("#sub-category").val('').trigger("change");
                $(".ask-now-template").hide();

                emailDetails = emailDetails.map(function (v, i, arr) {
                    v.threadUrl = window.location.origin + window.location.pathname.split(".")[0] + "/details." + data + ".html";
                    v.thread = title;
                    return v;
                });

                sendEmail();

                location.href = window.location.pathname.split(".")[0] + "/details." + data + ".html";

                //getForumStats($("button[name=applyFilter]"));
                //getQueryList(true);
            }
        });
        $('.modal-backdrop.in').remove();
    } else {
        if (description.length == 0) {
            $('.note-editor.note-frame').addClass('note-has-error');
            $("#query-description").siblings(".text-danger").removeClass("display-n");
        }
    }

    return false;
}

function validateCreateQuestionForm() {
    var valid = true;
    $(':input.question-field', "form.create-discussion-form").each(function () {

        valid = $(this).val() ? true : false;

        if (!valid) {
            if ($(this).siblings(".text-danger").length) {
                $(this).siblings(".text-danger").removeClass("display-n");
            } else if ($(this).closest('.form-group').siblings(".text-danger")) {
                $(this).closest('.form-group').siblings(".text-danger").removeClass("display-n");
            }
        }
        //return false;
    });
    return valid;
}

function handleBackspaceOnAnchor(e) {
    //var range = $("#comment_box").summernote("createRange");
    var code = e.keyCode ? e.keyCode : e.which;
    if (code == 8 || code == 46) {
        /*range = range.getWordRange();
        //console.log(range);
        if(range.isOnAnchor()) {
            range.insertNode(document.createTextNode( '\u00A0' ));
        }*/
        var target = window.getSelection().focusNode;
        if (target && target.parentNode && $(target.parentNode).hasClass('profile-link')) {
            var email = $(target.parentNode).data('email');
            //var name = $(target.parentNode).text();
            //var removeElem = {"email": email, "name": name};
            emailDetails = emailDetails.filter(function(v, i, arr){
                return v.email != email;
            });
            //emailDetails.pop(removeElem);
            $(target.parentNode).remove();
            range = $("#comment_box").summernote("createRange");
            range = range.getWordRange();
            range.insertNode(document.createTextNode( '\u00A0' ));
        }
    }
}

function handleLeftRightArrow(e) {
    var code = e.keyCode ? e.keyCode : e.which;
    if (code == 37 || code == 39) {

        range = $("#comment_box").summernote("createRange");
        //$("#comment_box").summernote("saveRange");
        range = range.getWordRange();
        if(range.isOnAnchor()){
            e.preventDefault();
            var target = window.getSelection();
            let newrange = document.createRange();
            newrange.setStartBefore(range.nodes()[0]);
            newrange.setEndBefore(range.nodes()[0]);
            target.addRange(newrange);
           // window.getSelection().addRange(range.nativeRange());
            //range.createFromNodeBefore(range.nodes()[0]).select();
            //$("#comment_box").summernote("restoreRange");
        }else{
            return true;
        }
    }
}
var keyFlag = 0;
function  keyEvents(e) {
    var keypressed = e.which || e.keyCode;
    if (keypressed === 40) {
        e.preventDefault();
        keyFlag++;
        if(keyFlag <= 1){
            if (liSelected) {
                liSelected.removeClass('selected');
                var nextElement = liSelected.next("li");
                if (nextElement.length > 0) {
                    liSelected = nextElement.addClass('selected');
                } else {
                    liSelected = li.eq(0).addClass('selected');
                    $('.user-searchbox').animate({
                        scrollTop: 0
                    });
                    scrollAmt = 0;
                }
            } else {
                liSelected = li.eq(0).addClass('selected');
            }
            if (liSelected.position().top > 66) {
                $('.user-searchbox').animate({ scrollTop: liSelected.index() * 22 });
            }else if($('.user-searchbox  ul li:last-child').hasClass("selected")){
                $('.user-searchbox').animate({ scrollTop: 0 });
            }
        }

        // to stop scrolling of page
        e.stopPropagation();
        return false;
    } else if (keypressed === 38) {
        e.preventDefault();
        keyFlag++;
        if(keyFlag <= 1) {
            if (liSelected) {
                liSelected.removeClass('selected');
                var prevElement = liSelected.prev("li");
                if (prevElement.length > 0) {
                    liSelected = prevElement.addClass('selected');
                } else {
                    liSelected = li.last().addClass('selected');
                }
            } else {
                liSelected = li.last().addClass('selected');
            }
            if (liSelected.position().top <= -10) {
                $('.user-searchbox').animate({scrollTop: (liSelected.index() + 1) * 22 - 88});
            } else if ($('.user-searchbox  ul li:last-child').hasClass("selected")) {
                $('.user-searchbox').animate({scrollTop: (li.last().index() + 1) * 22});
            }
        }
        // to stop scrolling of page
        e.stopPropagation();
        return false;
    } else if (keypressed === 13 && $('.user-searchbox li.selected').length > 0) {
        e.preventDefault();
        $('.user-searchbox li.selected').find(".username").trigger("click");
        e.stopPropagation();
        return false;
    }else{
        return true;
    }
}

function summernoteKeyDown(e){

    handleBackspaceOnAnchor(e);
    //handleLeftRightArrow(e);

    var targetTextArea = $(e.currentTarget).closest(".form-group").children("textarea.form-control");
    summmernoteRange = $(targetTextArea).summernote("createRange");
    summmernoteRange = summmernoteRange.getWordRange();
    var name = summmernoteRange.toString().trim();
    var splChar;
    if (name && name.length > 0) {
        splChar = name.lastIndexOf("@");
    }

    if (splChar > -1) {
        keyEvents(e);
    }else{
        return true;
    }
}

function summernoteKeyUp(e) {
    keyFlag = 0;
    var code = e.keyCode ? e.keyCode : e.which;
    //if ((code <= 90 && code>= 48 || code>= 96 && code <= 105)||(code==8) && (code!=24|| code!=25)) {
    var targetTextArea = $(e.currentTarget).closest(".form-group").children("textarea.form-control");

    /*var top;
    var left;*/
    summmernoteRange = $(targetTextArea).summernote("createRange");
    summmernoteRange = summmernoteRange.getWordRange();
    //To get the current cursor position and set to userlist box
    /*if ($(targetTextArea).attr("id") == "query-description") {
        top = range.getClientRects()[0].top - 72;
        left = range.getClientRects()[0].left - e.currentTarget.getBoundingClientRect().left + 22;
    } else {
        top = (range.getClientRects()[0].top - e.currentTarget.getBoundingClientRect().top) + 18;
        left = range.getClientRects()[0].left - e.currentTarget.getBoundingClientRect().left;
    }
    $('.user-searchbox').css({"top": top, "left": left});*/
    //$(targetTextArea).summernote('saveRange');
    var keyTimer = null;

    var name = summmernoteRange.toString().trim();
    var apiPath = SIH.getEndPoint("/api/auth/user/getUsers/" + page);
    var splChar;
    if (name && name.length > 0) {
        splChar = name.lastIndexOf("@");
    }

    if (splChar > -1) {
        if(code === 40 || code === 38 || code === 13){
            e.preventDefault();
            //keyEvents(e);
            return false;
        }
        page = 0;
        user = name;
        user = user.split("@")[1];
        if (user.length > 2 && (code!=37 && code!=39)) {
            apiPath = apiPath + "?name=" + user;
            $('.user-searchbox').data("scrolling", true);
            userListScroller(apiPath, 0, summmernoteRange, targetTextArea);
            $('.user-searchbox').off('scroll').on('scroll', function () {
                var scrollValue = $('.user-searchbox').data("scrolling");
                var scrollBottom = $(".user-searchbox ul").height() - $(".user-searchbox").height() - $(this).scrollTop();

                if (scrollBottom < 35 && String(scrollValue) === 'true') {
                    apiPath = SIH.getEndPoint("/api/auth/user/getUsers/" + ++page);
                    apiPath = apiPath + "?name=" + user;
                    $('.user-searchbox').data("scrolling", "false");
                        if(totalCount > 10) {
                            userListScroller(apiPath, 0, summmernoteRange, targetTextArea);
                        }

                }
            });
        } else if (user.length < 3) {
            $('.user-searchbox ul').html('');
        }
    } else {
        $('.user-searchbox ul').html('');
    }

}

function userListScroller(apiPath, pageNum, range, targetTextArea) {
    $.ajax({
        type: "GET",
        async: false,
        url: apiPath,
        contentType: "application/json",
        headers: {
            "X-Auth-Token": store.getItem("token")
        },
        success: function (data) {
            var source = $("#user-tagging").html();
            if (source) {
                var template = Handlebars.compile(source);
                if (data && data.length > 0) {
                    if ($(".user-searchbox .user-detail").length == 0) {
                        $('.user-searchbox').append("<div class='user-detail'><ul></ul></div>");
                    }

                    totalCount=data[0].total;

                    var userArr = [];
                    $('.user-searchbox ul').addClass('active');
                    $.each(data, function (i, v) {
                        userArr.push(`<li><span class ="username">${data[i].name} (${data[i].role})</span>
                                                         <span class ="user-entityname hidden"> ${data[i].name}</span>                                       
                                                    <span class ="user-email hidden"> ${data[i].emailId}</span>
                                                  <span class="user-role hidden">${data[i].role}</span> 
                                                   <span class ="user-uniqueId hidden">${data[i].id}</span></li>`);
                    });
                    $(this).addClass('hidden');

                    if (page > 0) {
                        $('.user-searchbox  ul').append(userArr);
                        userListIntelligentPosition();
                    } else if (page == 0) {
                        $('.user-searchbox  ul').html(userArr);
                        userListIntelligentPosition();
                    }
                    if (page * 10 + data.length < data[0].total) {
                        $('.user-searchbox').data("scrolling", "true");
                    }
                    //$(".note-editable").blur();
                    li = $('.user-searchbox  ul li');
                    if (page <= 0) {
                        liSelected = li.eq(0).addClass('selected');
                    }

                    $('li .username').css('cursor', 'pointer');

                    $('.user-searchbox li .username').off("click").on('click', function (e) {
                        //$(targetTextArea).summernote('saveRange');
                        var temp = {};
                        var entity_name = $(this).siblings('.user-entityname').text();
                        var role = $(this).siblings('.user-role').text();
                        var username = $(this).siblings('.username').text();
                        var emailId = $(this).siblings('.user-email').text();
                        var uniqueId = $(this).siblings('.user-uniqueId').text();
                        profileUrl = window.location.protocol + "//" + window.location.host + "/content/sih/en/profile" + "." + role + "." + uniqueId + ".html";
                        temp["email"] = emailId.trim();
                        temp["name"] = entity_name;
                        temp["threadUrl"] = window.location.href;
                        temp["thread"] = questionTitle;
                        emailDetails.push(temp);
                        $(targetTextArea).summernote("createLink", {
                            text: "&nbsp;"+entity_name.trim()+"&nbsp;",
                            url: profileUrl,
                            class: 'profile-link',
                            range: range,
                            email: emailId,
                            editable: true,
                            doNotHighlight: true
                        });
                        $(targetTextArea).summernote('restoreRange');
                        range = $(targetTextArea).summernote("createRange");
                        //$(targetTextArea).summernote('saveRange');
                        range.insertNode(document.createTextNode( '\u00A0' ));
                        $(this).addClass('hidden');
                        $('.user-searchbox  ul').empty();
                        page = 0;
                        $(targetTextArea).summernote('restoreRange');
                        //$('.note-editable').trigger('focus');
                    });

                } else {
                    $('.user-searchbox ul').html('');
                    //$(".note-editable").off("keydown").keydown(function(e) {return true;});
                }
            }
        }
    });
}


function userListIntelligentPosition(){

    var boxElement = $('.forum-detail-cta .forum-comment-container .form-group .note-editor, .create-discussion-popup .description .note-editor');
    var boxHeight = boxElement.height();
    var eTop = boxElement.offset().top;

    if((($(window).height() - boxHeight)/2) < (eTop - $(window).scrollTop())){
        // console.log("top");
        $(".user-searchbox").addClass("top");
    }
    else{
        // console.log("down");
        $(".user-searchbox").removeClass("top");

    }
    $(window).scroll(function() { //when window is scrolled
        var boxHeight = boxElement.height();
        if((($(window).height() - boxHeight)/2) < (eTop - $(window).scrollTop())){
            $(".user-searchbox").addClass("top");
        }
        else{
            // console.log("down");
            $(".user-searchbox").removeClass("top");

        }

    });
}
function postComment(questionId) {
    $('.btn-comment').attr('disabled', 'disabled');
    var path = SIH.getEndPoint("/api/auth/forum/question/" + questionId + "/comment");
    var comment_box = $("#comment_box");
    var comment = comment_box.val();
    var note = comment_box.summernote('code').replace(/<\/?[^>]+(>|$)/g, "");
    //comment = comment.replace(/\n/g, '<br>\n');
    if (note.length > 0) {
        var commentJson = {
            comment: comment,
        };
        $.ajax({
            type: "POST",
            url: path,
            data: JSON.stringify(commentJson),
            contentType: "application/json",
            headers: {
                "X-Auth-Token": store.getItem("token")
            }
        }).done(function (data) {
            $('.btn-comment').removeAttr('disabled');
            var jsonArr = [];
            jsonArr.push(data.comments[data.comments.length - 1]);
            addComment({
                "question": {"answered": data.question.answered, "owner": data.question.owner},
                "comments": jsonArr
            });
            $('.forum-response-answer .comments-button').html("(" + data.question.numberOfComments + ")");
            $('.note-editor.note-frame').removeClass('note-has-error');
            $('.forum-replies').show();
            $('.forum-replies').addClass('forum-replies-loggedin');
            sendEmail();
        });
    }
    else {
        $('.btn-comment').removeAttr('disabled');
        if (note.length == 0) {
            $('.note-editor.note-frame').addClass('note-has-error');
        }
    }
}

function sendEmail() {
    var path = SIH.getEndPoint("/api/auth/user/shootMail");
    $.ajax({
        type: "POST",
        url: path,
        data: JSON.stringify(emailDetails),
        contentType: "application/json",
        headers: {
            "X-Auth-Token": store.getItem("token")
        }
    }).success(function (data) {
        console.log("emailSend");
    })

}

function addComment(data) {
    var source = $("#comment-template").html();
    if (source) {
        var template = Handlebars.compile(source);
        $('#comment-detail').append(template(data));
        var comment_box = $("#comment_box");
        comment_box.summernote('reset');
        if (isUserPublishedAndLoggedIn()) {
            $('.forum-comment-share').show();
        }
        //Read More
        forumReadMoreText();
    }
    return false;
}

$(document).on('click', '.like-reply-share .reply', function () {

    $('.note-editable').focus();

});
$(document).on('click', '.like-head .like', function () {
    var question_id = $('.like').attr('data-id');
    if (store.getItem("token") && store.getItem("published")) {
        likeIncrement(question_id);
    } else if (store.getItem("token") && !store.getItem("published")) {
        $(".under-moderation-modal").modal("show");
    } else if (store.getItem("no-profile")) {
        $('.complete-profile-modal').modal('show');
    } else {
        $("#loginModal").modal("show");
    }

})


function likeIncrement(question_id) {

    var path = SIH.getEndPoint("/api/auth/forum/question/like/" + question_id);
    $.ajax({
        type: "POST",
        url: path,
        contentType: "application/json",
        beforeSend: setAuthTokenHeader
    }).done(function (data) {
        if (data) {
            console.log("success status" + data.likes);
            /*var source = $('#comment-template').html();
            if(source){
                var template =Handlebars.compile(source);
                $('#comment-detail').html(template(data));
            }*/
            $('[data-id=' + question_id + ']').html(data.likes + ' Likes');
        }
        else {
            console.log("error while fetching the data");
        }
    })
}

$(document).on("click", ".report-model", function () {
    var reportId = $(this).data('id');
    forum.reportAbuseId = reportId.split('_')[0]
    forum.reportType = reportId.split('_')[1]
    forum.textarea.val('');
    if (forum.textarea.parent().hasClass('has-error')) {
        forum.textarea.parent().removeClass('has-error');
        forum.textarea.parent().removeClass('has-danger');
    }
});

$(document).on("click", ".query-not-found-btn", function () {
    redirectPageOnReportAbuse();
});

function markAsAbuse(abuseHeading, abuseMsg) {
    var path;
    if (forum.reportType == 'question') {
        path = SIH.getEndPoint("/api/auth/forum/question/" + forum.reportAbuseId + "/abuse");
    }
    else {
        path = SIH.getEndPoint("/api/auth/forum/answer/" + forum.reportAbuseId + "/abuse");
    }
    var comment = $("#report-abuse-comment").val();
    var reportAbuse = {
        message: comment
    };
    if (comment) {
        $.ajax({
            type: "POST",
            url: path,
            data: JSON.stringify(reportAbuse),
            contentType: "application/json",
            beforeSend: setAuthTokenHeader
        }).done(function (data) {
            if (data) {
                $('.report-abuse-modal').modal('hide');
                $('.thankyou-modal .modal-body .heading').html(abuseHeading);
                $('.thankyou-modal .modal-body p').html(abuseMsg);
                $('.thankyou-modal').modal('show');
                $(document).on("click", ".forum-report-abuse", function () {
                    if (forum.reportType == 'question') {
                        redirectPageOnReportAbuse();
                    }
                });
                $('#report-abuse-comment').val('');
                if (forum.reportType != 'question') {
                    var commentDiv = "#" + forum.reportAbuseId;
                    $(commentDiv).hide();
                    var noOfComments = $('.forum-response-answer .comments-button').text();
                    $('.forum-response-answer .comments-button').html(noOfComments - 1);
                }
            }
        });
    } else {
        forum.textarea.parent().addClass('has-error');
        forum.textarea.parent().addClass('has-danger');
    }
    return false;
}

var forumSetAuthTokenHeader = function (xhr) {
    var token = store.getItem('token');
    if (token) {
        xhr.setRequestHeader('X-Auth-Token', token);
    } else if (forum.isAuthor == 'true' && forum.adminToken) {
        xhr.setRequestHeader('X-Auth-Token', forum.adminToken);
    }
    xhr.setRequestHeader('Content-Type', 'application/json');
}

function getQueryDetail(questionId, msg, spamMsg, isAuthor, token) {
    var path;
    forum.isAuthor = isAuthor;
    forum.adminToken = token;
    if (!ContextHub.getStore("sih_user").getItem('token') || !ContextHub.getStore("sih_user").getItem('published')) {
        path = SIH.getEndPoint("/api/common/question/" + questionId);
        forum.abuseId = getParameterByName("abuseId");
        if (forum.isAuthor == 'true' && forum.adminToken && forum.abuseId) {
            path = SIH.getEndPoint("/api/auth/admin/question/" + questionId + "?abuseId=" + forum.abuseId);
        }
    }
    else {
        path = SIH.getEndPoint("/api/auth/forum/question/" + questionId);
    }
    $.ajax({
        type: "GET",
        url: path,
        contentType: "application/json",
        beforeSend: forumSetAuthTokenHeader,
    }).done(function (data) {
        forum.quesId = data.question.id;
        queryDetail(data);
        initializeGA(data.question.title);
        questionTitle = data.question.title;
    }).fail(function (data) {
        if (data.status == '404') {
            $('.modal-body p').html(msg);
            $('.query-not-found').modal({
                backdrop: 'static',
                keyboard: true,
            });
        }
        if (data.status == '400') {
            $('.modal-body p').html(spamMsg);
            $('.query-not-found').modal({
                backdrop: 'static',
                keyboard: true,
            });
        }
    });
}

function updateViewCount(questionId) {
    $.ajax({
        type: "GET",
        url: SIH.getEndPoint("/api/auth/forum/updateviews/question/" + questionId),
        contentType: "application/json",
        beforeSend: forumSetAuthTokenHeader
    });
}

function queryDetail(data) {
    populateThreadHeader(data);
    var source = $("#query-detail-template").html();
    var commentSource = $('#comment-template').html();
    if (source) {
        var template = Handlebars.compile(source);
        $('#query-detail').prepend(template(data.question));
        var commentTemplate = Handlebars.compile(commentSource);
        $('#comment-detail').prepend(commentTemplate(data));
        if (data.question.answered) {
            // $('ul#comment-detail li ul.dropdown-menu li a.markAsAnswer').parent().css('display', 'none');
            var answer = $(".forum-replies .forum-item-info .forum-item-mark-answer").parents().eq(0);
            answer.prependTo(answer.parent());
        }
        $('.forum-response-answer .comments-button').html("(" + data.question.numberOfComments + ")");
        if (isUserPublishedAndLoggedIn()) {
            $('.forum-share').show();
            $('.forum-comment-share').show();
            $('#comment_box ~ .note-editor .note-editing-area,#comment_box ~ .note-editor .note-toolbar').wrapAll('<div class="clearfix summernote-query"></div>');
            $('.summernote-query').children('.note-toolbar').addClass('pull-right');
            $('.summernote-query').children('.note-editing-area').addClass('pull-left');

        }

        //Read More
        forumReadMoreText();
        if (forum.isAuthor == 'true' && forum.adminToken && forum.abuseId && !data.reviewed) {
            $('.forum-comment-share').hide();
            $('.forum-share').hide();
            if (forum.urlHash) {
                var scrollPos = $(forum.urlHash + "_comment").parent('li').offset().top;
                $(window).scrollTop(scrollPos);
                $('#comment-detail ' + forum.urlHash + ' .forum-comment-content').append("<p class='text-center'> "
                    + "<button type='button' class='btn btn-success forum-accept-button' data-id='accept_comment' "
                    + "data-toggle='modal' data-target='.admin-app" +
                    "roval-modal'>Accept</button>"
                    + "  <button type='button' class='btn btn-danger forum-reject-button' data-id='reject_comment' "
                    + "data-toggle='modal' data-target='.admin-approval-modal'>Reject</button></p>");
            } else {
                $('#query-detail .forum-question-content').append("<p class='text-center'> "
                    + "<button type='button' class='btn btn-success forum-accept-button' data-id='accept_question' "
                    + "data-toggle='modal' data-target='.admin-approval-modal'>Accept</button>"
                    + "  <button type='button' class='btn btn-danger forum-reject-button' data-id='reject_question' "
                    + "data-toggle='modal' data-target='.admin-approval-modal'>Reject</button></p>");
            }
        }
    }
    return false;
}

$(document).on("click", ".forum-comment-share ul.dropdown-menu li a.markAsAnswer", function () {
    var commentId = $(this).parents().eq(3).siblings('input').val();
    var markedAsAnswer_label = $(this).data('id');
    var path = SIH.getEndPoint("/api/auth/forum/question/" + forum.quesId + "/mark-as-answer/" + commentId);
    $.ajax({
        type: "POST",
        url: path,
        contentType: "application/json",
        beforeSend: setAuthTokenHeader
    }).done(function (data) {
        var commentDiv = "#" + commentId + " .forum-item-body";
        $(commentDiv).append('<span class="forum-item-mark-answer pull-right">' + markedAsAnswer_label + '</span>');
        $(commentDiv).find('li.report-abuse-li').parents('.forum-comment-share').hide();
        var answer = $(".forum-replies .forum-item-info .forum-item-mark-answer").parents().eq(1);
        answer.prependTo(answer.parent());
        $('ul.forum-more-dropdown').each(function () {
            if ($(this).find('li').length > 1) {
                $(this).find('li:first').hide();
            } else {
                $(this).parent().hide();
            }
        });
    }).fail(function (data) {
        $('.modal-body p').html(data.responseText);
        $('.error-modal').modal('show');
    });
});

$(document).on("click", "a.category-follow", function () {
    if (isUserPublishedAndLoggedIn()) {
        //$("#modal-loader").modal("show");
        var subscriptionId = $(this).data('follow');
        var id = subscriptionId.split('_')[0];
        var subscriptionType = subscriptionId.split('_')[1];
        var subscriptionMsg = subscriptionId.split('_')[2];
        var subscriptionHeading = subscriptionId.split('_')[3];
        var subscriptionIdType = subscriptionId.split('_')[4];
        var path;
        if (subscriptionType == 'follow') {
            path = SIH.getEndPoint("/api/auth/forum/question/subscribe?targetId=" + id + "&subscriptionIdType=" + subscriptionIdType);
        } else {
            path = SIH.getEndPoint("/api/auth/forum/question/unsubscribe?targetId=" + id + "&subscriptionIdType=" + subscriptionIdType);
        }
        $.ajax({
            type: "POST",
            url: path,
            contentType: "application/json",
            beforeSend: setAuthTokenHeader
        }).done(function (data) {
            if (data == true) {
                getFollowedCategories();
                getForumStats($("button[name=applyFilter]"));

                $("#modal-loader").modal("hide");
            }
        });
    } else if (store.getItem("token") && !store.getItem("published")) {
        $(".under-moderation-modal").modal("show");
    } else if (store.getItem("no-profile")) {
        $('.complete-profile-modal').modal('show');
    } else {
        $("#loginModal").modal('show');
    }
});

function forumReadMoreText() {
    $(".forum-item-info").find(".more-content").each(function () {
        var myStr = $(this).html();
        $(this).empty().html(myStr);
        $(this).siblings(".read-more").addClass('hidden');
        $(this).siblings(".less").addClass('hidden');
        if ($(this).height() > 150) {
            $(this).addClass('more-content-height-fixed');
            $(this).siblings(".read-more").removeClass('hidden');
            $(this).siblings(".read-more").css('display', 'inline');
            $(this).append('<div class="more-content-foot"></div>');
        }
    });
    $(".read-more").click(function (e) {
        e.stopPropagation();
        $(this).addClass('hidden');
        $(this).siblings(".more-content").removeClass('more-content-height-fixed');
        $(this).siblings(".less").removeClass('hidden');
        $(this).siblings(".more-content").children('.more-content-foot').css('display', 'none');
    });
    $(".less").click(function (e) {
        e.stopPropagation();
        $(this).addClass('hidden');
        $(this).siblings(".read-more").removeClass('hidden');
        $(this).siblings(".more-content").addClass('more-content-height-fixed');
        $(this).siblings(".more-content").children('.more-content-foot').css('display', 'block');
        $('html, body').animate({
            scrollTop: $(this).parent().offset().top - 200
        }, 500);
    });
}

function redirectPageOnReportAbuse() {
    var redirectPage = $('.forum-report-abuse').data('id').split('_')[0]
    var currentPage = $('.forum-report-abuse').data('id').split('_')[1]
    if (redirectPage == currentPage) {
        getQueryList();
    }
    else {
        window.location = redirectPage + ".html";
    }
}

$(document).on("click", ".admin-approval-btn", function () {
    var reportType = forum.buttonData.split('_')[0]
    var abuseType = forum.buttonData.split('_')[1]
    var path;
    var verify = false;
    if (reportType == 'accept') {
        verify = true;
    }
    var comment_box = $("#admin-approval-comment");
    var message = comment_box.val();
    if (message) {
        if (abuseType == 'question') {
            path = SIH.getEndPoint("/api/auth/admin/review/question/" + forum.abuseId);
        }
        else {
            path = SIH.getEndPoint("/api/auth/admin/review/comment/" + forum.abuseId);
        }
        $.ajax({
            type: "GET",
            url: path,
            contentType: "application/json",
            data: {"verify": verify, "message": message},
            headers: {'X-Auth-Token': forum.adminToken}
        }).done(function (data) {
            if (data) {
                $('.admin-approval-modal').modal('hide');
                $('.thankyou-modal .modal-body .heading').html("Thank You!!");
                $('.thankyou-modal .modal-body p').html("Your response has been recorded ");
                $('.thankyou-modal').modal('show');
                $('.forum-accept-button , .forum-reject-button').hide();
            }
        });
    } else {
        comment_box.parent().addClass('has-error');
        comment_box.parent().addClass('has-danger');
    }
});
$(document).on("click", ".forum-accept-button , .forum-reject-button", function () {
    forum.buttonData = $(this).data('id');
    var comment_box = $("#admin-approval-comment");
    comment_box.val('');
    if (comment_box.parent().hasClass('has-error')) {
        comment_box.parent().removeClass('has-error');
        comment_box.parent().removeClass('has-danger');
    }
});

function initializeGA(title) {
    $("title").text(title);
    var $headNoScript = $("noscript#ga-script");
    if ($headNoScript.length) {
        var gaHeadScript = $headNoScript.html();
        var src = $("noscript#ga-body").data("src");
        var $gaIframe = $($("noscript#ga-body").text());
        $gaIframe.attr("src", src);
        $("<script>").text(gaHeadScript).prependTo("head");
        $("<noscript>").append($gaIframe).prependTo("body");
    }
}

var forumInit = function () {
    var savedQuery = location.search.substr(1);
    if (savedQuery) {
        savedQuery = savedQuery.trim();
    }
    if (savedQuery && location.href.indexOf('code') < 0) {
        var queryParam = getUrlParameter('query');
        var pageParam = getUrlParameter('page');
        if (queryParam) {
            queryParam = queryParam.trim();
        }
        if ((queryParam != null && savedQuery.split("&").length == 1) || (pageParam && (savedQuery.split("&").length == 1 || (queryParam != null && savedQuery.split("&").length == 2)))) {
            if (queryParam) {
                forumSearchQuery.query = queryParam;
                $("input#search-component").val(queryParam);
            }
        } else {
            if (queryParam) {
                forumSearchQuery.query = queryParam;
                $("input#search-component").val(queryParam);
            }

            var pageParam = getUrlParameter('page');
            if (pageParam && pageParam.length > 0) {
                forumSearchQuery.page = pageParam;
            }
        }
    }
}

var createForumSearchQuery = function () {
    var queryParamArr = [];
    if (forumSearchQuery.query) {
        queryParamArr.push('query=' + forumSearchQuery.query);
    }
    if (location.href.indexOf('code') < 0) {
        queryParamArr.push('page=' + forumSearchQuery.page);
    }
    var sendQuery = '';
    if (queryParamArr.length > 0) {
        for (var i = 0; i < queryParamArr.length; i++) {
            if (i == 0) {
                sendQuery = sendQuery + ('?' + queryParamArr[i]);
            } else {
                sendQuery = sendQuery + ('&' + queryParamArr[i]);
            }
        }
    }
    return sendQuery;
}

var getForumSearchResults = function () {
    $('#modal-loader').modal('show');
    var sendSearchQuery = createForumSearchQuery();
    window.history.replaceState(window.location.pathname, "", sendSearchQuery);
    var forumQuery = location.search.substr(1);
    if (forumQuery && forumQuery.trim()) {
        $.ajax({
            url: SIH.getEndPoint("/api/noauth/search/forum"),
            type: 'POST',
            dataType: 'json',
            data: JSON.stringify(forumSearchQuery),
            beforeSend: setAuthTokenHeader,
        }).done(function (data) {
            if (data.highlighted && data.highlighted.length > 0) {
                var source = $("#forum-search-template").html();
                if (source) {
                    var template = Handlebars.compile(source);
                    $('.no-search-result').html('');
                    $('#forum-search').html(template(data.highlighted));
                    //Pagination
                    forumPagination(data);
                    $('html, body').animate({
                        scrollTop: 0
                    }, 500);
                }
            }
            else {
                $('#forum-search').html('');
                $('#pagination-div').html('');
                var noResultResource = $("#no-search-result-template").html();
                var noResultTemplate = Handlebars.compile(noResultResource);
                $('.no-search-result').html(noResultTemplate());
            }
            $('#modal-loader').modal('hide');
        }).fail(function (data) {
            $('#modal-loader').modal('hide');
        });
    }
}

var loadForumSearchPage = function (page) {
    var pageNumber = parseInt($(page).html());
    forumSearchQuery.page = pageNumber - 1;
    getForumSearchResults();
}

var forumSearchNext = function (elem) {
    var currentPage = parseInt($(elem).siblings('ul').find('li.active').html());
    forumSearchQuery.page = currentPage;
    getForumSearchResults();
}

var forumSearchPrevious = function (elem) {
    var currentPage = parseInt($(elem).siblings('ul').find('li.active').html());
    forumSearchQuery.page = currentPage - 2;
    getForumSearchResults();
}

var forumSearchFirst = function () {
    forumSearchQuery.page = 0;
    getForumSearchResults();
}

var forumSearchLast = function (pages) {
    forumSearchQuery.page = pages - 1;
    getForumSearchResults();
}

function isUserPublishedAndLoggedIn() {
    return ContextHub.getStore("sih_user").getItem('token') && ContextHub.getStore("sih_user").getItem('published');
}

$(document).ready(function () {

    if (isUserPublishedAndLoggedIn()) {
        $('.ask-now').removeClass('hidden');
    }
    var count = 0;
    $("#query-description").summernote(personaJSON);

    $(document).on('click', '.ask-now,.ask-question-now', function () {
        if (store.getItem("token") && store.getItem("published")) {
            $('.ask-now-template').removeClass('hidden');
            $('<div class="modal-backdrop in">').appendTo('body');
            displayAskNow();
            $('html').css('overflow', 'hidden');
        } else if (store.getItem("token") && !store.getItem("published")) {
            $(".under-moderation-modal").modal('show');
        } else if (store.getItem("no-profile")) {
            $('.complete-profile-modal').modal('show');
        } else {
            $("#loginModal").modal('show');
        }
    });

    $(document).on('click', '.close.fa.fa-times', function () {
        $('.ask-now-template').addClass('hidden');
        $('.ask-now').removeClass('hidden');
        //$("#create-discussion-form").trigger( "reset" );
        // $("#query-description").summernote('reset');
        $("#query-description").siblings(".text-danger").addClass("display-n");
        $('.note-editor').removeClass('note-has-error');
        $("#query-title").siblings(".text-danger").addClass("display-n");
        $('.form-group').siblings('.text-danger').addClass('display-n')
        $('.modal-backdrop.in').remove();
        resetQuestionForm();
        $('html').css('overflow', 'auto');
    });

});

// getFollowedCategories();

var followedCategories;

function getFollowedCategories() {
    $.ajax({
        type: "GET",
        url: SIH.getEndPoint("/api/auth/forum/category/followed"),
        beforeSend: setAuthTokenHeader,
        async: false,
        success: function (data) {
            followedCategories = data;
        },
        error: function (response) {
            console.log("Error occurred", response);
        }
    });
}

function resetQuestionForm() {
    $(':input.question-field', "form.create-discussion-form").each(function () {
        if ($(this).attr("id") === "query-description") {
            $(this).summernote('code', '');
        }
        $(this).val("").trigger("change");
    });
    $(".attachedFile ul li").text("");
}

function displayAskNow() {
    $("#category").on('change', function () {
        var subCategoryId = $("#category").val();

        $("#sub-category").find('option').not(":first").remove();

        $.ajax({
            type: "GET",
            url: "/services/tags/children.json?tag=" + subCategoryId,
        }).done(function (data) {
            $(".sub-category").append('<option value="" disabled="" selected="">SubCategory</option>');
            data.sort(function (a, b) {
                return a.text > b.text ? 1 : a.text < b.text ? -1 : 0
            });

            $.each(data, function (index, item) {
                var o = new Option(item.text, item.value);
                $("#sub-category").append(o);
            });
        });
    });
}


function bindAccordionClickEvent() {
    $('.forum-category-accordion .acc-item').on('click', function () {
        $(this).toggleClass('open');
        $(this).children('.acc-content').slideToggle();
        $(this).siblings('.acc-item').removeClass('open');
        $(this).siblings('.acc-item').find('.acc-content').slideUp('fast');
    });
}

function setForumCategoris() {
    $("#discussion-category").find('option').not(":first").remove();
    var apiPath = $("#discussion-category").data('path') || "/services/tags/children.json";
    if (apiPath) {
        $.ajax({
            url: apiPath,
            type: 'GET',
            data: {
                tag: "sih:forum",
                filterEnabled: false,
                path: "sih:forum"
            },
            async: false,
            success: function (data) {
                if (typeof data == "string") {
                    data = JSON.parse(data);
                }
                data.sort(function (a, b) {
                    return a[1] - b[1]
                });
                data.reverse();
                forumCategories = data;
                $.each(data, function (index, item) {
                    var o = new Option(item.text, item.value);
                    $("#discussion-category").append(o);
                });
            }, error: function (data) {
                console.log("Error while loading options");
            }
        });
    }
}

function populateForumCategoriesThread() {
    getForumStats($("button[name=applyFilter]"));
}

function onStateChange() {
    var targetObj = $(".forum-wrapper #state");
    var value = $(targetObj).val();
    var text = $(targetObj).children(':selected').text().trim();
    handleFilterSpans(value, text, $(targetObj).attr("id"));
}

function onCityChange() {
    var targetObj = $(".forum-wrapper #city");
    var value = $(targetObj).val();
    var text = $(targetObj).children(':selected').text().trim();
    handleFilterSpans(value, text, $(targetObj).attr("id"));
}

function onCategoryChange() {
    var targetObj = $(".forum-wrapper #discussion-category");
    var value = $(targetObj).val();
    var text = $(targetObj).children(':selected').text().trim();
    handleFilterSpans(value, text, $(targetObj).attr("id"));
    //forumSearchQuery.query = text;
}

$(document).on('click', '.forum-filter-wrapper .filterRemove', function () {
    if ($(this).parents('.state-filters').length) {
        $('#state').val("").trigger('change');
        $("#city").val("").trigger('change');
        onStateChange();
        onCityChange();
        sessionStorage.removeItem("state");
        sessionStorage.removeItem("city");
    } else if ($(this).parents('.city-filters').length) {
        $("#city").val("").trigger('change');
        onCityChange();
        sessionStorage.removeItem("city");
    } else if ($(this).parents('.discussion-category-filters').length) {
        $('#discussion-category').val("").trigger('change');
        onCategoryChange();
        sessionStorage.removeItem("category");
    }

    getForumStats($("button[name=applyFilter]"));
});

$(document).on('click', '.forum-filter-wrapper .clear-all', function () {
    $('#state').val("").trigger('change');
    $("#city").val("").trigger('change');
    $('#discussion-category').val("").trigger('change');
    onStateChange();
    onCityChange();
    onCategoryChange();

    sessionStorage.removeItem("state");
    sessionStorage.removeItem("city");
    sessionStorage.removeItem("category");
    sessionStorage.removeItem("subCategory");

    getForumStats($("button[name=applyFilter]"));
});

function handleFilterSpans(filterValue, filterText, target) {
    if (filterValue && !$("." + target + "-filters").children().length) {
        $("span." + target + "-filters").append("<span class='selected-filter' data-value='" + filterValue + "'>" + filterText + "<i class='fa fa-times filterRemove'></i></span>");
    } else if (filterValue) {
        $("." + target + "-filters").children().remove();
        $("span." + target + "-filters").append("<span class='selected-filter' data-value='" + filterValue + "'>" + filterText + "<i class='fa fa-times filterRemove'></i></span>");
    } else {
        $("." + target + "-filters").children().remove();
    }

    if ($(".forum-filter-wrapper .state-filters").children().length
        || $(".forum-filter-wrapper .city-filters").children().length
        || $(".forum-filter-wrapper .discussion-category-filters").children().length) {

        $(".forum-filter-wrapper .clear-all").removeClass("display-n");
    } else {
        $(".forum-filter-wrapper .clear-all").addClass("display-n");
    }
}

function getCategoryThreads() {
    $("#modal-loader").modal("show");
    var path = getQueryUrl(forum.currentTabIndex);
    $.ajax({
        type: "GET",
        url: path,
        contentType: "application/json",
        beforeSend: setAuthTokenHeader
    }).done(function (data) {
        handleQueryData(data);
        $("#modal-loader").modal("hide");
    }).fail(function () {
        $('.pagination').hide();
        $("#modal-loader").modal("hide");
    });
}

function handleQueryData(data, replaceContent) {
    if (forum.currentTabIndex == 0) {
        var source = $("#all-list-template").html();
        if (source) {
            var template = Handlebars.compile(source);
            if (replaceContent) {
                $('#all-list').html(template(data));
            } else {
                $('#all-list').append(template(data));
            }
        }

        source = $("#threads-list-header-template").html();
        if (source) {
            if (getParam("view")) {
                data.heading = "All Threads";
            }
            var template = Handlebars.compile(source);
            $("#threads-list-header").html(template(data));
        }
    }
    else {
        var source = $("#subscription-list-template").html();
        if (source) {
            var template = Handlebars.compile(source);
            $('#subscription-list').html(template(data.content));
        }
    }
    if (isUserPublishedAndLoggedIn()) {
        $('.forum-share').show();
        $('#query-description ~ .note-editor .note-editing-area,#query-description ~ .note-editor .note-toolbar').wrapAll('<div class="clearfix summernote-query"></div>');
        $('.summernote-query').children('.note-toolbar').addClass('pull-right');
        $('.summernote-query').children('.note-editing-area').addClass('pull-left');
    }
    //Read More
    forumReadMoreText();

    //Pagination
    //forumPagination(data);
    return false;
}

function populateThreadHeader(data) {
    var source = $("#threads-header-template").html();
    if (source) {
        var template = Handlebars.compile(source);
        $("#threads-header").html(template(data));
    }
}

$(document).on('click', 'button[name=applyFilter]', function () {
    sessionStorage.setItem("category", $("#discussion-category").val());
    sessionStorage.setItem("state", $("#state").val());
    sessionStorage.setItem("city", $("#city").val());

    onStateChange();
    onCityChange();
    onCategoryChange();

    getForumStats($(this));
});

function getForumStats(apiPathHolder) {
    $("#modal-loader").modal("show");
    var apiPath = $(apiPathHolder).data('path');

    var template = Handlebars.compile($("#list-category-thread-template").html());

    $.ajax({
        type: "GET",
        url: SIH.getEndPoint(apiPath),
        data: {
            "state": $("#state").val() ? $("#state").val() : sessionStorage.getItem("state") ? sessionStorage.getItem("state") : "",
            "city": $("#city").val() ? $("#city").val() : sessionStorage.getItem("city") ? sessionStorage.getItem("city") : "",
            "category": $("#discussion-category").val() ? $("#discussion-category").val() : sessionStorage.getItem("category") ? sessionStorage.getItem("category") : ""
        },
        contentType: "application/json",
        beforeSend: setAuthTokenHeader
    }).done(function (data) {
        if (typeof data == "string") {
            data = JSON.parse(data);
        }
        const orderedData = {};
        Object.keys(data).sort().forEach(function (key) {
            orderedData[key] = data[key];
        });
        $("#list-category-threads").html(template(orderedData));

        bindAccordionClickEvent();

        $("#modal-loader").modal("hide");
    }).fail(function () {

        $("#modal-loader").modal("hide");
    });
}

$(document).on("click", ".forum-sub-category-card .head h3", function () {

    var pageUrl = $(this).closest(".forum-sub-category-card").data("cate-page-url");
    var subCatId = $(this).data("id");
    sessionStorage.setItem("subCategory", subCatId);
    location.href = pageUrl;//+"?wcmmode=disabled";

    //window.history.replaceState(window.location.pathname, "", "cateId="+subCatId);
});

$(document).on('change', '#post-img', function (e) {
    var data = new FormData();
    $.each(e.target.files, function (i, file) {
        data.append("file", file, file.name);
        $('<li/>').text(file.name).appendTo($("#post-img").siblings(".attachedFile").children("ul"));
    });
    $.ajax({
        url: SIH.getEndPoint("/api/file/forum/attachments"),
        type: 'POST',
        data: data,
        cache: false,
        contentType: false,
        processData: false,
        success: function (fileInfos) {
            if (fileInfos) {
                $.each(fileInfos, function (i, fileInfo) {
                    $("<input type='hidden' name='attachment' data-originalname='" + fileInfo.compressedName + "' value='" + fileInfo.name + "'>").insertAfter($("#post-img"));
                });
            }
        }, error: function (data) {
            alert("Error while uploading files");
        }
    });
});

function viewAttachments(e) {
    $(e).siblings(".attachedDocs").removeClass("hidden");
}
$(window).on('load resize',function(){
  searchComp = $('.search-component');
  if($(window).width() < 768){
    $('.forum-wrapper .forum-discussion .col-md-8 .columnizer').prepend(searchComp);
    $('.forum-wrapper .forum-discussion .col-md-4 .search-component').remove();
  }
  else{
    if($('.forum-wrapper .forum-discussion .col-md-8 .columnizer .search-component').length){
      $('.forum-wrapper .forum-discussion .col-md-8 .columnizer .search-component').remove();
      $('.forum-wrapper .forum-discussion .col-md-4').prepend(searchComp);
    }
  }
});

$(document).on('click', $('.comment-content').find('.profile-link'), function (e) {
    var link = $(e.target).data('link');
    if (link) {

        window.location.href = link;
    }
});




$.israel_form = function (challangeDetails) {
    var formData = {};
    var isValidated = true;
    var isUserAplicable = false;

    var $firstChallenge = $("input#challenge1");
    var $secondChallenge = $("input#challenge2");
    var $applicantName = $("input[name='applicantName']");
    var $email = $("input[name='email']");
    var $mobile = $("input[name='mobile']");
    var $qualification = $("input[name='qualification']");
    var $occupation = $("input[name='occupation']");
    var $experience = $("input[name='experience']");
    var $address = $("input[name='address']");
    var $city = $("input[name='city']");
    var $pincode = $("input[name='pincode']");
    var $state = $("input[name='state']");
    var $country = $("input[name='country']");
    var $theme = $("input[name='theme']");

    var $ideaStage = $("input[name='ideaStage']");
    var $fieldTrial = $("input[name='fieldTrial']");

    var $fieldTrialDetail = $("textarea[name='fieldTrialDetail']");
    var $howConducted = $("textarea[name='howConducted']");
    var $challengesFaced = $("textarea[name='challengesFaced']");
    var $successCriteria = $("textarea[name='successCriteria']");
    var $fieldResults = $("textarea[name='fieldResults']");
    var $whatWentRightWrong = $("textarea[name='whatWentRightWrong']");
    var $userFeedback = $("textarea[name='userFeedback']");
    var $learning = $("textarea[name='learning']");
    var $needToModify = $("textarea[name='needToModify']");

    var $fieldTrialPlan = $("textarea[name='fieldTrialPlan']");
    var $ecosystemDetail = $("textarea[name='ecosystemDetail']");
    var $challengeFacedPrototyping = $("textarea[name='challengeFacedPrototyping']");
    var $supportNeededDescription = $("textarea[name='supportNeededDescription']");

    var $problem = $("textarea[name='problem']");
    var $solutionSteps = $("textarea[name='solutionSteps']");
    var $idea = $("textarea[name='idea']");
    var $businessModel = $("textarea[name='businessModel']");
    var $teamInfo = $("textarea[name='teamInfo']");
    var $confidence = $("textarea[name='confidence']");
    var $impact = $("textarea[name='impact']");
    var $videoFileName = $("input[name='videoFileName']");
    var $id = $("input[name='id']");

    var $submitChallengeForm = $("input[name='challengeFormSubmit']");

    $.urlParam = function (name) {
        var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
        return results ? results[1] : 0;
    };

    var theme = $.urlParam('theme');
    if (theme !== "0") {
        $theme.prop("disabled", "disabled");
        $("input[value='" + theme + "']").attr("checked", "checked").removeAttr("disabled");
        var challDetail = challangeDetails[0];
        if (theme === "water") {
            challDetail = challangeDetails[0];
        } else if (theme === "agriculture") {
            challDetail = challangeDetails[1];
        } else if (theme === "digital_health") {
            challDetail = challangeDetails[2];
        }
        $firstChallenge.prop("value", challDetail.value1);
        $firstChallenge.siblings("label").text(challDetail.description1);
        $secondChallenge.prop("value", challDetail.value2);
        $secondChallenge.siblings("label").text(challDetail.description2);
    }

    $ideaStage.on("change", function () {
        var $additionalQuestion = $(".additionalQuestion");
        if ($(this).val() === "ready_for_field_trial") {
            $additionalQuestion.removeClass("display-n");
            $additionalQuestion.find("input[name='fieldTrial']").addClass("form-control");
        } else {
            $additionalQuestion.addClass("display-n");
            $additionalQuestion.find("input[name='fieldTrial']").removeClass("form-control");
            $(".yesFieldTrial").find("input, textarea").removeClass("form-control");
            $(".noFieldTrial").find("input, textarea").removeClass("form-control");
        }
    });

    $fieldTrial.on("change", function () {
        var $yesFieldTrial = $(".yesFieldTrial");
        var $noFieldTrial = $(".noFieldTrial");
        if ($(this).val() === "true") {
            $yesFieldTrial.removeClass("display-n");
            $yesFieldTrial.find("input, textarea").addClass("form-control");
            $noFieldTrial.addClass("display-n");
            $noFieldTrial.find("input, textarea").removeClass("form-control");
        } else {
            $yesFieldTrial.addClass("display-n");
            $yesFieldTrial.find("input, textarea").removeClass("form-control");
            $noFieldTrial.removeClass("display-n");
            $noFieldTrial.find("input, textarea").addClass("form-control");
        }
    });

    if (store.getItem("token")) {
        prePopulateForm();
        getEligible();
    } else {
        //$(".israel-challenge-error-message").modal("show");
        $(".login .sign-in").trigger('click');
    }

    function prePopulateForm() {
        $.ajax({
            type: "GET",
            async: false,
            url: SIH.getEndPoint("/api/auth/user/profile"),
            headers: {"X-Auth-Token": store.getItem("token")}
        }).done(function (data) {
            if (data.user.name) {
                $applicantName.val(data.user.name).attr("readonly", "readonly");
            }
            if (data.user.email) {
                $email.val(data.user.email).attr("readonly", "readonly");
            }
            if (data.user.phone) {
                $mobile.val(data.user.phone).attr("readonly", "readonly");
            }
            if (data.user.startup) {
                var startupData = data.user.startup;

                if (startupData.location.city && startupData.location.city.text) {
                    $city.val(startupData.location.city.text).attr("readonly", "readonly");
                }
                if (startupData.location.state && startupData.location.state.text) {
                    $state.val(startupData.location.state.text).attr("readonly", "readonly");
                }
                if (startupData.location.country && startupData.location.country.text) {
                    $country.val(startupData.location.country.text).attr("readonly", "readonly");
                }
            } else {
                var userData = data.user;

                if (userData.location.city && userData.location.city.text) {
                    $city.val(userData.location.city.text).attr("readonly", "readonly");
                }
                if (userData.location.state && userData.location.state.text) {
                    $state.val(userData.location.state.text).attr("readonly", "readonly");
                }
                if (userData.location.country && userData.location.country.text) {
                    $country.val(userData.location.country.text).attr("readonly", "readonly");
                }
            }
        });
    }

    function getFormData() {
        formData = {};
        isValidated = true;
        var attrValue = "";
        $.each($(".textBoxOut .extraFiles input[type='file']"), function (index, inputSel) {
            if ($(inputSel).val() === "") {
                $(inputSel).parents(".extraFiles").remove();
            }
        });
        var inputField = $("#israelChallengeForm").find(".form-control");
        $.each(inputField, function (index, inputSel) {

            var key = $(inputSel).attr("name");
            if (typeof key != "undefined") {
                attrValue = $(inputSel).attr("type") === "radio" ? $('input[name="' + inputSel.name + '"]:checked').val() : $(inputSel).val();
                if (attrValue) {
                    formData[key] = attrValue.toString();
                }
                checkRequiredField(attrValue, inputSel);
            }
        });
        var $challengeInput = $("input[name='challengeCode']:checked");
        if ($challengeInput.length > 0) {
            formData["challengeDescription"] = $challengeInput.siblings("label").text();
        }
        var $docNames = $(".israel-challenge-form").find(".textBoxOut .fileUploadField input[type='hidden']");
        if ($videoFileName) {
            var videoLinkVal = $videoFileName.val();
            if (videoLinkVal.trim().length > 0) {
                if (videoLinkVal.startsWith("https") || videoLinkVal.startsWith("http")) {
                    $videoFileName.siblings('span.help-block').html("").parents(".form-group").removeClass("has-error");
                }
                else {
                    $videoFileName.siblings('span.help-block').html("Video Link should start with either http or https").parents(".form-group").addClass("has-error");
                    isValidated = false;
                }
            }
        }
        var docfileList = [];
        $.each($docNames, function (index, inputSel) {
            attrValue = $(inputSel).val();
            if (attrValue) {
                docfileList.push(attrValue);
            }
        });
        if (docfileList.length > 0) {
            formData['docFileName'] = docfileList;
            $(".textBoxOut#docFileName").find("span.help-block").html("").parents(".form-group").removeClass("has-error");
        } else {
            isValidated = false;
            $(".textBoxOut#docFileName").find("span.help-block").last().html("Atleast 1 file should be uploaded.").parents(".form-group").addClass("has-error");
        }
    }

    function checkRequiredField(attrValue, inputSel) {
        var requiredField = $(inputSel).closest(".form-group").find("sup.required");
        if (requiredField && requiredField.length > 0 && (!attrValue || attrValue === "")) {
            isValidated = false;
            $(inputSel).closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field cannot be left Blank.");
        } else {
            $(inputSel).closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
        }
    }

    function getEligible() {
        $.ajax({
            type: "GET",
            async: "false",
            url: SIH.getEndPoint("/api/auth/indoIsraelChallenge/applicable"),
            headers: {"X-Auth-Token": store.getItem("token")}
        }).done(function (data) {
            isUserAplicable = data;
            if (isUserAplicable) {
                prepopulateAllForm();
            } else {
                $(".israel-challenge-eligiblity-check").modal("show");
            }
        });
    }

    function prepopulateAllForm() {
        $.ajax({
            type: "GET",
            async: "false",
            url: SIH.getEndPoint("/api/auth/indoIsraelChallenge/get/application"),
            headers: {"X-Auth-Token": store.getItem("token")}
        }).done(function (data) {
            if (data.theme === "water") {
                $firstChallenge.siblings("label").text(challangeDetails[0].description1);
                $secondChallenge.siblings("label").text(challangeDetails[0].description2);
            } else if (data.theme === "agriculture") {
                $firstChallenge.siblings("label").text(challangeDetails[1].description1);
                $secondChallenge.siblings("label").text(challangeDetails[1].description2);
            } else if (data.theme === "digital_health") {
                $firstChallenge.siblings("label").text(challangeDetails[2].description1);
                $secondChallenge.siblings("label").text(challangeDetails[2].description2);
            }
            if (data.challengeCode === "w01" || data.challengeCode === "ag01" || data.challengeCode === "dh01") {
                $("input[name='challengeCode']").prop("disabled", "disabled");
                $firstChallenge.prop("checked", "checked").removeAttr("disabled");
            } else if (data.challengeCode === "w02" || data.challengeCode === "ag02" || data.challengeCode === "dh02") {
                $("input[name='challengeCode']").prop("disabled", "disabled");
                $secondChallenge.prop("checked", "checked").removeAttr("disabled");
            }
            if ($applicantName.attr('readonly') !== "readonly") {
                $applicantName.val(data.applicantName);
            }
            if ($email.attr('readonly') !== "readonly") {
                $email.val(data.email);
            }
            if ($mobile.attr('readonly') !== "readonly") {
                $mobile.val(data.mobile);
            }
            if ($qualification.attr('readonly') !== "readonly") {
                $qualification.val(data.qualification);
            }
            if ($occupation.attr('readonly') !== "readonly") {
                $occupation.val(data.occupation);
            }
            $experience.val(data.experience);
            $address.val(data.address);
            if ($city.attr('readonly') !== "readonly") {
                $city.val(data.city);
            }
            if ($pincode.attr('readonly') !== "readonly") {
                $pincode.val(data.pincode);
            }
            if ($state.attr('readonly') !== "readonly") {
                $state.val(data.state);
            }
            if ($country.attr('readonly') !== "readonly") {
                $country.val(data.country);
            }

            $theme.prop("disabled", "disabled");
            $("input[name='theme'][value='" + data.theme + "']").prop("checked", "checked").removeAttr("disabled");

            $("input[name='ideaStage'][value='" + data.ideaStage + "']").prop("checked", "checked").trigger("change");
            if ("ready_for_field_trial" === data.ideaStage) {
                $(".additionalQuestion").removeClass("display-n");
                $("input[name='fieldTrial'][value='" + data.fieldTrial + "']").prop("checked", "checked").trigger("change");
                if ("true" === data.fieldTrial || true === data.fieldTrial) {

                    $(".yesFieldTrial").removeClass("display-n").find("textarea").addClass("form-control");
                    $fieldTrialDetail.val(data.fieldTrialDetail);
                    $howConducted.val(data.howConducted);
                    $challengesFaced.val(data.challengesFaced);
                    $successCriteria.val(data.successCriteria);
                    $fieldResults.val(data.fieldResults);
                    $whatWentRightWrong.val(data.whatWentRightWrong);
                    $userFeedback.val(data.userFeedback);
                    $learning.val(data.learning);
                    $needToModify.val(data.needToModify);
                } else {

                    $(".noFieldTrial").removeClass("display-n").find("textarea").addClass("form-control");
                    $fieldTrialPlan.val(data.fieldTrialPlan);
                    $ecosystemDetail.val(data.ecosystemDetail);
                    $challengeFacedPrototyping.val(data.challengeFacedPrototyping);
                    $supportNeededDescription.val(data.supportNeededDescription);
                }
            }
            $problem.val(data.problem);
            $solutionSteps.val(data.solutionSteps);
            $idea.val(data.idea);
            $businessModel.val(data.businessModel);
            $teamInfo.val(data.teamInfo);
            $confidence.val(data.confidence);
            $impact.val(data.impact);
            $videoFileName.val(data.videoFileName);
            $id.val(data.id);
        });

    }

    function addmoreupload() {
        var demoLink = $(".docArea");
        var $uploadRow = $("#docFileName");
        var length = parseInt($uploadRow.children().length) + 1;
        var linknDocTemplate = $(demoLink).first().html();

        if (length > 6) {
            $uploadRow.find(".fileUploadField:last span.help-block").html("Only 5 documents can be uploaded.");
            $("#add-file-field").prop("disabled", "disabled");
        } else {
            $uploadRow.append(linknDocTemplate);
            $.each($uploadRow.find(".fileUploadField"), function (index, fileuploadDiv) {
                $(this).find("input[type='file']").attr("name", "docFile[" + (index + 1) + "]").addClass("form-control");
                $(this).find("input[type='hidden']").attr("name", "docFileName[" + (index + 1) + "]");
            })
        }
    }

    function checkFileUpload(selectedFormats, fileToValidate, fileSize, extensions) {

        var message = "";
        if ($(fileToValidate).val() !== "") {
            if (fileToValidate.files[0].size > fileSize) {
                message = "File Should not be greater then " + Math.floor(fileSize / 1000000) + " MB.";
            }
            if (jQuery.inArray(fileToValidate.files[0].type, selectedFormats) === -1) {
                message = message + " Please upload " + extensions.toString() + " file formats.";
            }
            if (message !== "") {
                isValidated = false;
                $(fileToValidate).siblings(".help-block").html(message).parents(".form-group").addClass("has-error");
                $(fileToValidate).val("");
            } else {
                $(fileToValidate).siblings(".help-block").html("").parents(".form-group").removeClass("has-error");
                var data = new FormData();
                data.append("file", fileToValidate.files[0]);
                $(".modal.loader").modal("show");
                $.ajax({
                    type: "POST",
                    data: data,
                    dataType: 'json',
                    contentType: false,
                    processData: false,
                    url: SIH.getEndPoint("/api/file/indoIsraelChallenge/doc"),
                    headers: {"X-Auth-Token": store.getItem("token")}
                }).done(function (data) {
                    $(".modal.loader").modal("hide");
                    $(fileToValidate).siblings("input[type='hidden']").val(data.name);
                }).error(function () {
                    $(".modal.loader").modal("hide");
                    $(".israel-challenge-error-message").modal("show");
                    return false;
                });
            }
        }
        return false;
    }

    $(".israel-challenge-form .textBoxOut").on("change", ".fileUploadField input[type='file']", function () {
        var formats = ["application/vnd.ms-powerpoint", "application/vnd.openxmlformats-officedocument.presentationml.presentation", "application/pdf"];
        var extensions = ["ppt", "pptx", "pdf"];
        checkFileUpload(formats, this, 2062594, extensions);
        return false;
    });

    $submitChallengeForm.on("click", function () {
        getFormData();
        if (isValidated && isUserAplicable) {
            $(this).parents(".form-group").removeClass("has-error").find("span.help-block").addClass("display-n");
            $.ajax({
                type: "POST",
                data: JSON.stringify(formData),
                contentType: "application/json",
                dataType: "json",
                url: SIH.getEndPoint("/api/auth/indoIsraelChallenge/apply"),
                headers: {"X-Auth-Token": store.getItem("token")}
            }).done(function () {
                // $(".israel-challenge-submit-message").modal('show');
                window.location = $submitChallengeForm.attr("data-path") + ".html";
            }).error(function () {
                $(".israel-challenge-error-message").modal("show");
            });
        } else {
            $(this).parents(".form-group").addClass("has-error").find("span.help-block").removeClass("display-n");
        }
    });

    $("#add-file-field").click(function () {
        addmoreupload();
    });

    $(".form-group .textBoxOut").on("click", ".extraFiles a.removeFile", function () {
        $(this).closest(".fileUploadField").remove();
    });
    $("#israelChallengeForm").find('#state').on("change", function (event) {
        event.stopPropagation();
    });
};

$.agriculture_form = function (msg1, msg2, problemPage) {
    var formData = {};
    var isValidated = true;
    var isUserAplicable = false;
    var $applicantName = $("input[name='applicantName']");
    var $email = $("input[name='email']");
    var $mobile = $("input[name='mobile']");
    var $videoFileName = $("input[name='videoLink']");
    var $submitChallengeForm = $("input[name='agricultureFormSubmit']");
    if (store.getItem("token")) {
        /*  if (!store.getItem("published")) {
              disableAGCForm();
              $('.under-moderation-modal').modal('show');
          } else {
              $('#agricultureChallengeForm input[type=text],#agricultureChallengeForm select.form-control,#agricultureChallengeForm input[type=number],#agricultureChallengeForm textarea,#agricultureChallengeForm input[type=radio],#agricultureChallengeForm input[type=button], #agricultureChallengeForm input[type=file]').removeAttr("disabled", "disabled");
              if (!(store.getItem('role') && (store.getItem('role').toLowerCase() == 'startup'|| store.getItem('role').toLowerCase() == 'individual'))){
                  $('.agriculture-error-modal .modal-description').html(msg1 ? msg1 : "You need to be a startup or individual to apply for this challenge");
                  $('.agriculture-error-modal').modal('show');
                  $('.agriculture-error-modal').on('hidden.bs.modal', function () {
                      window.location = $('.logo').attr('href');
                  });
              } else {
                  if (!store.getItem('themeCode')) {
                      $('.agriculture-error-modal .modal-description').html(msg2 ? msg2 : "Please select Problem description to apply for this challenge");
                      $('.agriculture-error-modal').modal('show');
                      $('.agriculture-error-modal').on('hidden.bs.modal', function () {
                          window.location = problemPage;
                      });
                  } else {
                      getEligible();
                  }
              }
          }*/

        getApplicationForm();

    } else {
        disableAGCForm();
        store.getItem("no-profile") ? $('.complete-profile-modal').modal('show') : $(".login .sign-in").trigger('click');
    }

    function getApplicationForm() {
        $.ajax({
            type: "GET",
            url: SIH.getEndPoint("/api/auth/agricultureChallenge/" + store.getItem("uniqueId")),
            headers: {"X-Auth-Token": store.getItem("token")}
        }).done(function (data) {
            if (data) {
                setFormData(data);

            } else {
                disableAGCForm();
            }
        });
    }

    function disableAGCForm() {
        $('#agricultureChallengeForm input[type=text],#agricultureChallengeForm select.form-control,#agricultureChallengeForm input[type=number],#agricultureChallengeForm textarea,#agricultureChallengeForm input[type=radio],#agricultureChallengeForm input[type=button],#agricultureChallengeForm input[type=file]').attr("disabled", "disabled");
    }

    function getChallengeCountryList(d) {
        $.ajax({
            type: "GET",
            url: "/services/tags/countries.json",
        }).done(function (data) {
            $.each(data, function (index, result) {
                var options = "<option  id='" + result.id + "' value='" + result.id + "'>" + result.text + "</option>";
                $("#countryList").append(options + "<br>")
            });
            $('select[name=country]').val(d['country']);
        });
    }

    function getFormData() {
        formData = {};
        isValidated = true;
        var attrValue = "";
        var inputField = $("#agricultureChallengeForm").find(".form-control");
        $.each(inputField, function (index, inputSel) {

            var key = $(inputSel).attr("name");
            if (typeof key != "undefined") {
                attrValue = $(inputSel).attr("type") === "radio" ? $('input[name="' + inputSel.name + '"]:checked').val() : $(inputSel).val();
                if (attrValue) {
                    formData[key] = attrValue.toString();
                }
                checkRequiredField(attrValue, inputSel);
            }
        });
        if ($videoFileName) {
            var videoLinkVal = $videoFileName.val();
            if (videoLinkVal.trim().length > 0) {
                if (videoLinkVal.startsWith("https") || videoLinkVal.startsWith("http")) {
                    $videoFileName.siblings('span.help-block').html("").parents(".form-group").removeClass("has-error");
                }
                else {
                    $videoFileName.siblings('span.help-block').html("Video Link should start with either http or https").parents(".form-group").addClass("has-error");
                    isValidated = false;
                }
            }
        }
        formData['additionalDocuments'] = $('input[type=hidden][name=additionalDocuments]').val();
        formData['problemCode'] = store.getItem('themeCode');
        formData['problemDescription'] = store.getItem('themeTitle');
    }

    function checkRequiredField(attrValue, inputSel) {
        var requiredField = $(inputSel).closest(".form-group").find("sup.required");
        if (requiredField && requiredField.length > 0 && (!attrValue || attrValue === "")) {
            isValidated = false;
            $(inputSel).closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field cannot be left Blank.");
        } else {
            $(inputSel).closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
        }
    }

    function getEligible() {
        $.ajax({
            type: "GET",
            async: "false",
            url: SIH.getEndPoint("/api/auth/agricultureChallenge/applicable"),
            headers: {"X-Auth-Token": store.getItem("token")}
        }).done(function (data) {
            isUserAplicable = data;
            if (isUserAplicable) {
                getChallengeCountryList();
                prepopulateAllForm();
            } else {
                $(".agriculture-challenge-eligiblity-check").modal("show");
            }
        });
    }

    function checkFileUpload(selectedFormats, fileToValidate, fileSize, extensions) {

        var message = "";
        if ($(fileToValidate).val() !== "") {
            if (fileToValidate.files[0].size > fileSize) {
                message = "File Should not be greater then " + Math.floor(fileSize / 1000000) + " MB.";
            }
            if (jQuery.inArray(fileToValidate.files[0].type, selectedFormats) === -1) {
                message = message + " Please upload " + extensions.toString() + " file formats.";
            }
            if (message !== "") {
                isValidated = false;
                $(fileToValidate).siblings(".help-block").html(message).parents(".form-group").addClass("has-error");
                $(fileToValidate).val("");
            } else {
                $(fileToValidate).siblings(".help-block").html("").parents(".form-group").removeClass("has-error");
                var data = new FormData();
                data.append("file", fileToValidate.files[0]);
                $(".modal.loader").modal("show");
                $.ajax({
                    type: "POST",
                    data: data,
                    dataType: 'json',
                    contentType: false,
                    processData: false,
                    url: SIH.getEndPoint("/api/file/agricultureChallenge/doc"),
                    headers: {"X-Auth-Token": store.getItem("token")}
                }).done(function (data) {
                    $(".modal.loader").modal("hide");
                    $(fileToValidate).siblings("input[type='hidden']").val(data.name);
                }).error(function () {
                    $(".modal.loader").modal("hide");
                    $(".agriculture-challenge-error-message").modal("show");
                    return false;
                });
            }
        }
        return false;
    }

    $("#agricultureChallengeForm .textBoxOut").on("change", ".fileUploadField input[type='file']", function () {
        var formats = ["application/vnd.ms-powerpoint", "application/vnd.openxmlformats-officedocument.presentationml.presentation", "application/pdf"];
        var extensions = ["ppt", "pptx", "pdf"];
        checkFileUpload(formats, this, 2062594, extensions);
        return false;
    });

    function prepopulateAllForm() {
        $('#agricultureChallengeForm .problem-statement-wrapper img').attr('src', store.getItem('themeImage'))
        $('#agricultureChallengeForm .problem-statement-wrapper .static-heading').html(store.getItem('themeTitle'));
        $('#agricultureChallengeForm .problem-statement-wrapper .description').html(store.getItem('themeDescription'));
        $.ajax({
            type: "GET",
            async: false,
            url: SIH.getEndPoint("/api/auth/user/profile"),
            headers: {"X-Auth-Token": store.getItem("token")}
        }).done(function (data) {
            if (data.user.name) {
                $applicantName.val(data.user.name).attr("readonly", "readonly");
            }
            if (data.user.email) {
                $email.val(data.user.email).attr("readonly", "readonly");
            }
        });
    }

    $submitChallengeForm.on("click", function () {
        getFormData();
        if (isValidated && isUserAplicable) {
            $(this).parents(".form-group").removeClass("has-error").find("span.help-block").addClass("display-n");
            $.ajax({
                type: "POST",
                data: JSON.stringify(formData),
                contentType: "application/json",
                dataType: "json",
                url: SIH.getEndPoint("/api/auth/agricultureChallenge/apply"),
                headers: {"X-Auth-Token": store.getItem("token")}
            }).done(function () {
                // $(".israel-challenge-submit-message").modal('show');
                window.location = $submitChallengeForm.attr("data-path") + ".html";
            }).error(function () {
                $(".agriculture-error-message").modal("show");
            });
        } else {
            $(this).parents(".form-group").addClass("has-error").find("span.help-block").removeClass("display-n");
        }
    });
    $("#agricultureChallengeForm").find('#state').on("change", function (event) {
        event.stopPropagation();
    });

    function setFormData(data) {
        $.each(data, function (index, val) {
            var field = $('#agricultureChallengeForm input[name=' + index + '], #agricultureChallengeForm select[name=' + index + '], #agricultureChallengeForm textarea[name=' + index + ']');
            var isList = Boolean(field.closest(".repeat-container").length);
            var type = field.attr("type");
            if (type === 'radio') {
                $.each($('input[name=' + index + ']'), function (index, value) {
                    if (val === $(this).val()) {
                        $(this).prop('checked', true);
                        return true;
                    }
                });
            } else if (type === 'checkbox') {
                $.each($('input[name=' + index + ']'), function (index, value) {
                    var inputVal = $(this).val();
                    $.each(val, function (index, value1) {
                        if (value1 === inputVal) {
                            $(value).attr('checked', true);
                        }
                    })
                });
            }
            else if (isList && Array.isArray(val)) {
                val.forEach(function (value, idx) {
                    field = $('#agricultureChallengeForm input[name=' + index + '], #agricultureChallengeForm select[name=' + index + '], #agricultureChallengeForm textarea[name=' + index + ']');
                    var currentField = $(field).eq(idx);
                    currentField.val(value);
                    if (field.length < val.length) {
                        var parent = currentField.closest(".repeat-container");
                        var button = parent.find(".repeat-add");
                        if (button.length > 0) {
                            button.trigger("click");
                        }
                    }
                })
            } else if (type === "file") {
            } else {
                field.val(val)
            }
        });
        getChallengeCountryList(data);
        //$('#agricultureChallengeForm .problem-statement-wrapper img').attr('src', store.getItem('themeImage'))
        // $('#agricultureChallengeForm .problem-statement-wrapper .static-heading').html(store.getItem('themeTitle'));
        $('#agricultureChallengeForm .problem-statement-wrapper .description').html(data['problemDescription']);
        if (data['startupStage']) {
            if (data['startupStage'] === 'Idea Stage') {
                $("#ideaStage").prop("checked", true);
            } else {
                $("#enterpriseStage").prop("checked", true);
            }
        }

        if (data['willingToRelocate'] === true || data['willingToRelocate'] === 'true') {
            $("#relocate-yes").prop("checked", true);
        } else if (data['willingToRelocate'] === false || data['willingToRelocate'] === 'false') {
            $("#relocate-no").prop("checked", true);
        }
        if (data['additionalDocuments']) {
            $('.presentationLink').attr("href", SIH.getEndPoint("/api/file/challenge/doc/agc/" + data['additionalDocuments'] + "/get")).html(data['additionalDocuments']).removeClass("display-n");
        }
        disableAGCForm();
    }
};

$.singapore_form = function (challangeDetails) {
    var formData = {};
    var isValidated = true;
    var isUserAplicable = false;

    var $firstChallenge = $("input#challenge1");
    var $secondChallenge = $("input#challenge2");
    var $applicantName = $("input[name='applicantName']");
    var $email = $("input[name='email']");
    var $mobile = $("input[name='mobile']");
    var $qualification = $("input[name='qualification']");
    var $occupation = $("input[name='occupation']");
    var $experience = $("input[name='experience']");
    var $address = $("input[name='address']");
    var $city = $("input[name='city']");
    var $pincode = $("input[name='pincode']");
    var $state = $("input[name='state']");
    var $country = $("input[name='country']");
    var $theme = $("input[name='theme']");

    var $ideaStage = $("input[name='ideaStage']");
    var $fieldTrial = $("input[name='fieldTrial']");

    var $fieldTrialDetail = $("textarea[name='fieldTrialDetail']");
    var $howConducted = $("textarea[name='howConducted']");
    var $challengesFaced = $("textarea[name='challengesFaced']");
    var $successCriteria = $("textarea[name='successCriteria']");
    var $fieldResults = $("textarea[name='fieldResults']");
    var $whatWentRightWrong = $("textarea[name='whatWentRightWrong']");
    var $userFeedback = $("textarea[name='userFeedback']");
    var $learning = $("textarea[name='learning']");
    var $needToModify = $("textarea[name='needToModify']");

    var $fieldTrialPlan = $("textarea[name='fieldTrialPlan']");
    var $ecosystemDetail = $("textarea[name='ecosystemDetail']");
    var $challengeFacedPrototyping = $("textarea[name='challengeFacedPrototyping']");
    var $supportNeededDescription = $("textarea[name='supportNeededDescription']");

    var $problem = $("textarea[name='problem']");
    var $solutionSteps = $("textarea[name='solutionSteps']");
    var $idea = $("textarea[name='idea']");
    var $businessModel = $("textarea[name='businessModel']");
    var $teamInfo = $("textarea[name='teamInfo']");
    var $confidence = $("textarea[name='confidence']");
    var $impact = $("textarea[name='impact']");
    var $videoFileName = $("input[name='videoFileName']");
    var $id = $("input[name='id']");

    var $submitChallengeForm = $("input[name='challengeFormSubmit']");

    $.urlParam = function (name) {
        var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
        return results ? results[1] : 0;
    };

    $ideaStage.on("change", function () {
        var $additionalQuestion = $(".additionalQuestion");
        if ($(this).val() === "ready_for_field_trial") {
            $additionalQuestion.removeClass("display-n");
            $additionalQuestion.find("input[name='fieldTrial']").addClass("form-control");
        } else {
            $additionalQuestion.addClass("display-n");
            $additionalQuestion.find("input[name='fieldTrial']").removeClass("form-control");
            $(".yesFieldTrial").find("input, textarea").removeClass("form-control");
            $(".noFieldTrial").find("input, textarea").removeClass("form-control");
        }
    });

    $fieldTrial.on("change", function () {
        var $yesFieldTrial = $(".yesFieldTrial");
        var $noFieldTrial = $(".noFieldTrial");
        if ($(this).val() === "true") {
            $yesFieldTrial.removeClass("display-n");
            $yesFieldTrial.find("input, textarea").addClass("form-control");
            $noFieldTrial.addClass("display-n");
            $noFieldTrial.find("input, textarea").removeClass("form-control");
        } else {
            $yesFieldTrial.addClass("display-n");
            $yesFieldTrial.find("input, textarea").removeClass("form-control");
            $noFieldTrial.removeClass("display-n");
            $noFieldTrial.find("input, textarea").addClass("form-control");
        }
    });

    if (!store.getItem("published") && store.getItem("token")) {
        $('.under-moderation-modal').modal('show');
        $submitChallengeForm.attr("disabled", true);
    } else if (store.getItem("no-profile")) {
        $('.complete-profile-modal').modal('show');
        $submitChallengeForm.attr("disabled", true);
    } else if (!store.getItem('token')) {
        $(".login .sign-in").trigger('click');
        $submitChallengeForm.attr("disabled", true);
    } else if (store.getItem("token")) {
        prePopulateForm();
        getEligible();
    } else {
        $($submitChallengeForm).attr("disabled", true);
        $(".login .sign-in").trigger('click');
    }

    function prePopulateForm() {
        $.ajax({
            type: "GET",
            async: false,
            url: SIH.getEndPoint("/api/auth/user/profile"),
            headers: {"X-Auth-Token": store.getItem("token")}
        }).done(function (data) {
            if (data.user.name) {
                $applicantName.val(data.user.name).attr("readonly", "readonly");
            }
            if (data.user.email) {
                $email.val(data.user.email).attr("readonly", "readonly");
            }
            if (data.user.phone) {
                $mobile.val(data.user.phone).attr("readonly", "readonly");
            }
            if (data.user.startup) {
                var startupData = data.user.startup;
                if (startupData.location.city && startupData.location.city.text) {
                    $city.val(startupData.location.city.text).attr("readonly", "readonly");
                }
                if (startupData.location.state && startupData.location.state.text) {
                    $state.val(startupData.location.state.text).attr("readonly", "readonly");
                }
                if (startupData.location.country.text) {
                    $country.val(startupData.location.country.text).attr("readonly", "readonly");
                }
            } else {
                var userData = data.user;
                if (userData.location.city && userData.location.city.text) {
                    $city.val(userData.location.city.text).attr("readonly", "readonly");
                }
                if (userData.location.state && userData.location.state.text) {
                    $state.val(userData.location.state.text).attr("readonly", "readonly");
                }
                if (userData.location.country.text) {
                    $country.val(userData.location.country.text).attr("readonly", "readonly");
                }
            }
        });
    }

    function getFormData() {
        formData = {};
        isValidated = true;
        var attrValue = "";
        $.each($(".textBoxOut .extraFiles input[type='file']"), function (index, inputSel) {
            if ($(inputSel).val() === "") {
                $(inputSel).parents(".extraFiles").remove();
            }
        });
        var inputField = $("#singaporeChallengeForm").find(".form-control");
        $.each(inputField, function (index, inputSel) {

            var key = $(inputSel).attr("name");
            if (typeof key != "undefined") {
                attrValue = $(inputSel).attr("type") === "radio" ? $('input[name="' + inputSel.name + '"]:checked').val() : $(inputSel).val();
                if (attrValue) {
                    formData[key] = attrValue.toString();
                }
                checkRequiredField(attrValue, inputSel);
            }
        });
        var $challengeInput = $("input[name='challengeCode']:checked");
        if ($challengeInput.length > 0) {
            formData["challengeDescription"] = $challengeInput.siblings("label").text();
        }
        var $docNames = $(".singapore-challenge-form").find(".textBoxOut .fileUploadField input[type='hidden']");
        if ($videoFileName) {
            var videoLinkVal = $videoFileName.val();
            if (videoLinkVal.trim().length > 0) {
                if (videoLinkVal.startsWith("https") || videoLinkVal.startsWith("http")) {
                    $videoFileName.siblings('span.help-block').html("").parents(".form-group").removeClass("has-error");
                }
                else {
                    $videoFileName.siblings('span.help-block').html("Video Link should start with either http or https").parents(".form-group").addClass("has-error");
                    isValidated = false;
                }
            }
        }
        var docfileList = [];
        $.each($docNames, function (index, inputSel) {
            attrValue = $(inputSel).val();
            if (attrValue) {
                docfileList.push(attrValue);
            }
        });
        if (docfileList.length > 0) {
            formData['docFileName'] = docfileList;
            $(".textBoxOut#docFileName").find("span.help-block").html("").parents(".form-group").removeClass("has-error");
        } else {
            isValidated = false;
            $(".textBoxOut#docFileName").find("span.help-block").last().html("Atleast 1 file should be uploaded.").parents(".form-group").addClass("has-error");
        }
    }

    function checkRequiredField(attrValue, inputSel) {
        var requiredField = $(inputSel).closest(".form-group").find("sup.required");
        if (requiredField && requiredField.length > 0 && (!attrValue || attrValue === "")) {
            isValidated = false;
            $(inputSel).closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field cannot be left Blank.");
        } else {
            $(inputSel).closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
        }
    }

    function getEligible() {
        $.ajax({
            type: "GET",
            async: "false",
            url: SIH.getEndPoint("/api/auth/indoSingaporeChallenge/applicable"),
            headers: {"X-Auth-Token": store.getItem("token")}
        }).done(function (data) {
            isUserAplicable = data;
            if (isUserAplicable) {
                // prepopulateAllForm();
            } else {
                $(".singapore-challenge-eligiblity-check").modal("show");
            }
        });
    }

    function prepopulateAllForm() {
        $.ajax({
            type: "GET",
            async: "false",
            url: SIH.getEndPoint("/api/auth/indoSingaporeChallenge/get/application"),
            headers: {"X-Auth-Token": store.getItem("token")}
        }).done(function (data) {
            if (data.theme === "water") {
                $firstChallenge.siblings("label").text(challangeDetails[0].description1);
                $secondChallenge.siblings("label").text(challangeDetails[0].description2);
            } else if (data.theme === "agriculture") {
                $firstChallenge.siblings("label").text(challangeDetails[1].description1);
                $secondChallenge.siblings("label").text(challangeDetails[1].description2);
            } else if (data.theme === "digital_health") {
                $firstChallenge.siblings("label").text(challangeDetails[2].description1);
                $secondChallenge.siblings("label").text(challangeDetails[2].description2);
            }
            if (data.challengeCode === "w01" || data.challengeCode === "ag01" || data.challengeCode === "dh01") {
                $("input[name='challengeCode']").prop("disabled", "disabled");
                $firstChallenge.prop("checked", "checked").removeAttr("disabled");
            } else if (data.challengeCode === "w02" || data.challengeCode === "ag02" || data.challengeCode === "dh02") {
                $("input[name='challengeCode']").prop("disabled", "disabled");
                $secondChallenge.prop("checked", "checked").removeAttr("disabled");
            }
            if ($applicantName.attr('readonly') !== "readonly") {
                $applicantName.val(data.applicantName);
            }
            if ($email.attr('readonly') !== "readonly") {
                $email.val(data.email);
            }
            if ($mobile.attr('readonly') !== "readonly") {
                $mobile.val(data.mobile);
            }
            if ($qualification.attr('readonly') !== "readonly") {
                $qualification.val(data.qualification);
            }
            if ($occupation.attr('readonly') !== "readonly") {
                $occupation.val(data.occupation);
            }
            $experience.val(data.experience);
            $address.val(data.address);
            if ($city.attr('readonly') !== "readonly") {
                $city.val(data.city);
            }
            if ($pincode.attr('readonly') !== "readonly") {
                $pincode.val(data.pincode);
            }
            if ($state.attr('readonly') !== "readonly") {
                $state.val(data.state);
            }
            if ($country.attr('readonly') !== "readonly") {
                $country.val(data.country);
            }

            $theme.prop("disabled", "disabled");
            $("input[name='theme'][value='" + data.theme + "']").prop("checked", "checked").removeAttr("disabled");

            $("input[name='ideaStage'][value='" + data.ideaStage + "']").prop("checked", "checked").trigger("change");
            if ("ready_for_field_trial" === data.ideaStage) {
                $(".additionalQuestion").removeClass("display-n");
                $("input[name='fieldTrial'][value='" + data.fieldTrial + "']").prop("checked", "checked").trigger("change");
                if ("true" === data.fieldTrial) {

                    $(".yesFieldTrial").removeClass("display-n").find("textarea").addClass("form-control");
                    $fieldTrialDetail.val(data.fieldTrialDetail);
                    $howConducted.val(data.howConducted);
                    $challengesFaced.val(data.challengesFaced);
                    $successCriteria.val(data.successCriteria);
                    $fieldResults.val(data.fieldResults);
                    $whatWentRightWrong.val(data.whatWentRightWrong);
                    $userFeedback.val(data.userFeedback);
                    $learning.val(data.learning);
                    $needToModify.val(data.needToModify);
                } else {

                    $(".noFieldTrial").removeClass("display-n").find("textarea").addClass("form-control");
                    $fieldTrialPlan.val(data.fieldTrialPlan);
                    $ecosystemDetail.val(data.ecosystemDetail);
                    $challengeFacedPrototyping.val(data.challengeFacedPrototyping);
                    $supportNeededDescription.val(data.supportNeededDescription);
                }
            }
            $problem.val(data.problem);
            $solutionSteps.val(data.solutionSteps);
            $idea.val(data.idea);
            $businessModel.val(data.businessModel);
            $teamInfo.val(data.teamInfo);
            $confidence.val(data.confidence);
            $impact.val(data.impact);
            $videoFileName.val(data.videoFileName);
            $id.val(data.id);
        });

    }

    function addmoreupload() {
        var demoLink = $(".docArea");
        var $uploadRow = $("#docFileName");
        var length = parseInt($uploadRow.children().length) + 1;
        var linknDocTemplate = $(demoLink).first().html();

        if (length > 6) {
            $uploadRow.find(".fileUploadField:last span.help-block").html("Only 5 documents can be uploaded.");
            $("#add-file-field").prop("disabled", "disabled");
        } else {
            $uploadRow.append(linknDocTemplate);
            $.each($uploadRow.find(".fileUploadField"), function (index, fileuploadDiv) {
                $(this).find("input[type='file']").attr("name", "docFile[" + (index + 1) + "]").addClass("form-control");
                $(this).find("input[type='hidden']").attr("name", "docFileName[" + (index + 1) + "]");
            })
        }
    }

    function checkFileUpload(selectedFormats, fileToValidate, fileSize, extensions) {

        var message = "";
        if ($(fileToValidate).val() !== "") {
            if (fileToValidate.files[0].size > fileSize) {
                message = "File Should not be greater then " + Math.floor(fileSize / 1000000) + " MB.";
            }
            if (jQuery.inArray(fileToValidate.files[0].type, selectedFormats) === -1) {
                message = message + " Please upload " + extensions.toString() + " file formats.";
            }
            if (message !== "") {
                isValidated = false;
                $(fileToValidate).siblings(".help-block").html(message).parents(".form-group").addClass("has-error");
                $(fileToValidate).val("");
            } else {
                $(fileToValidate).siblings(".help-block").html("").parents(".form-group").removeClass("has-error");
                var data = new FormData();
                data.append("file", fileToValidate.files[0]);
                $(".modal.loader").modal("show");
                $.ajax({
                    type: "POST",
                    data: data,
                    dataType: 'json',
                    contentType: false,
                    processData: false,
                    url: SIH.getEndPoint("/api/file/indoSingaporeChallenge/doc"),
                    headers: {"X-Auth-Token": store.getItem("token")}
                }).done(function (data) {
                    $(".modal.loader").modal("hide");
                    $(fileToValidate).siblings("input[type='hidden']").val(data.name);
                }).error(function () {
                    $(".modal.loader").modal("hide");
                    $(".singapore-challenge-error-message").modal("show");
                    return false;
                });
            }
        }
        return false;
    }

    $(".singapore-challenge-form .textBoxOut").on("change", ".fileUploadField input[type='file']", function () {
        var formats = ["application/vnd.ms-powerpoint", "application/vnd.openxmlformats-officedocument.presentationml.presentation", "application/pdf"];
        var extensions = ["ppt", "pptx", "pdf"];
        checkFileUpload(formats, this, 2062594, extensions);
        return false;
    });

    $submitChallengeForm.on("click", function () {
        getFormData();
        if (isValidated && isUserAplicable) {
            $(this).parents(".form-group").removeClass("has-error").find("span.help-block").addClass("display-n");
            $.ajax({
                type: "POST",
                data: JSON.stringify(formData),
                contentType: "application/json",
                dataType: "json",
                url: SIH.getEndPoint("/api/auth/indoSingaporeChallenge/apply"),
                headers: {"X-Auth-Token": store.getItem("token")}
            }).done(function () {
                $(".singapore-challenge-submit-message").modal('show');
            }).error(function () {
                $(".singapore-challenge-error-message").modal("show");
            });
        } else {
            $(this).parents(".form-group").addClass("has-error").find("span.help-block").removeClass("display-n");
        }
    });

    $("#add-file-field").click(function () {
        addmoreupload();
    });

    $(".form-group .textBoxOut").on("click", ".extraFiles a.removeFile", function () {
        $(this).closest(".fileUploadField").remove();
    });
    $("#singaporeChallengeForm").find('#state').on("change", function (event) {
        event.stopPropagation();
    });
};

$.fbApplication = function () {
    var formData = {};
    var isValidated = true;

    var $submitApplicationForm = $("input[name='fbApplicationFormSubmit']");

    var $submitSuccessfulModal = $(".fb-application-modals .fb-application-submit-message");
    var $errorModal = $(".fb-application-modals .fb-application-error-message");

    function getFormData() {
        formData = {};
        isValidated = true;
        var attrValue = "";
        var inputField = $("#fbApplicationForm").find(".form-control");
        $.each(inputField, function (index, inputSel) {
            var key = $(inputSel).attr("name");
            var type = $(inputSel).attr("type");
            if (typeof key != "undefined") {
                attrValue = $(inputSel).attr("type") === "radio" ? $('input[name="' + inputSel.name + '"]:checked').val() : $(inputSel).val();
                if (attrValue) {
                    formData[key] = attrValue;
                }
                checkRequiredField(attrValue, inputSel);
            }
            if ($('input[name=firstSourceOfCapital]:checked').val() === 'Other') {
                formData['firstSourceOfCapital'] = $('input[type=text][name=firstSourceOfCapital]').val();
            } else {
                formData['firstSourceOfCapital'] = $('input[name=firstSourceOfCapital]:checked').val();
            }
            if ($('input[name=secondSourceOfCapital]:checked').val() === 'Other') {
                formData['secondSourceOfCapital'] = $('input[type=text][name=secondSourceOfCapital]').val();
            } else {
                formData['secondSourceOfCapital'] = $('input[name=secondSourceOfCapital]:checked').val();
            }
        });
    }

    function checkRequiredField(attrValue, inputSel) {
        var requiredField = $(inputSel).closest(".form-group").find("sup.required");
        var attrName = $(inputSel).attr('name');
        if ((attrName === 'firstSourceOfCapital' || attrName === 'secondSourceOfCapital')) {
            if ($(inputSel).attr('type') === 'text') {
                return;
            } else if (attrValue == 'Other' && $(inputSel).attr('type') === 'radio') {
                if (!$("input[type=text][name=" + attrName + "]").val()) {
                    isValidated = false;
                    $(inputSel).closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field cannot be left Blank.");
                } else {
                    $(inputSel).closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
                }
            } else if (!attrValue) {
                isValidated = false;
                $(inputSel).closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field cannot be left Blank.");
            } else {
                $(inputSel).closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
            }
            return;
        }
        if ((!attrValue || attrValue === "") && requiredField && requiredField.length > 0) {
            isValidated = false;
            $(inputSel).closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field cannot be left Blank.");
        } else {
            if (inputSel.hasAttribute("pattern") && attrValue !== "" && !attrValue.match($(inputSel).attr("pattern"))) {
                isValidated = false;
                $(inputSel).closest(".form-group").addClass("has-error").find("span.help-block").first().html("Please enter valid input.");
            } else {
                $(inputSel).closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
            }
        }
    }

    $submitApplicationForm.on("click", function () {
        getFormData();
        if (isValidated) {
            $(this).parents(".form-group").removeClass("has-error").find("span.help-block").addClass("display-n");
            $.ajax({
                type: "POST",
                data: JSON.stringify(formData),
                contentType: "application/json",
                dataType: "json",
                url: SIH.getEndPoint("/api/noauth/fbApplication/apply")
            }).done(function () {
                $submitApplicationForm.parents(".form-group").find("span.help-block").addClass("display-n");
                $submitSuccessfulModal.modal('show');
            }).error(function (data) {
                $errorModal.find(".modal-body").html(data.responseText);
                $errorModal.modal("show");
            });
        } else {
            $(this).parents(".form-group").addClass("has-error").find("span.help-block").removeClass("display-n");
        }
        return false;
    });

    function checkFileUpload(fileToValidate, fileSize) {

        var message = "";
        if ($(fileToValidate).val() !== "") {
            if (fileToValidate.files[0].size > fileSize) {
                message = "File Should not be greater then " + Math.floor(fileSize / 1000000) + " MB.";
            }
            if (message !== "") {
                isValidated = false;
                $(fileToValidate).siblings(".help-block").html(message).parents(".form-group").addClass("has-error");
                $(fileToValidate).val("");
            } else {
                $(fileToValidate).siblings(".help-block").html("").parents(".form-group").removeClass("has-error");
                var data = new FormData();
                data.append("file", fileToValidate.files[0]);
                $(".modal.loader").modal("show");
                $.ajax({
                    type: "POST",
                    data: data,
                    dataType: 'json',
                    contentType: false,
                    processData: false,
                    url: SIH.getEndPoint("/api/file/fbApplication/doc")
                }).done(function (data) {
                    $(".modal.loader").modal("hide");
                    $(fileToValidate).siblings("input[type='hidden']").val(data.name);
                }).error(function () {
                    $(".modal.loader").modal("hide");
                    $errorModal.find(".modal-body").html("There are some error while uploading file. Please try again later!!!");
                    $errorModal.modal("show");
                    return false;
                });
            }
        }
        return false;
    }

    $("form.fbApplicationForm").on("change", ".textBoxOut input[type='file']", function () {
        checkFileUpload(this, 2062594);
        return false;
    });

};
    var startupFileNames = {};
    var slideWrapWidth = 0;
    var portfolioImages={};
    var images = {};
    var fileuploads = {};
    var profileData = {};
    var role = null;
    var $mentorshipCityTrigger;
    var validatePersona=true;
    var enableTNC;

    var personaMap = {
        "incubator": "Incubator",
        "accelerator": "Accelerator",
        "corporate":"Corporate",
        "institutional-investor": "Investor",
        "individual-investor": "Investor",
        "organization-service-provider": "ServiceProvider",
        "freelancer-service-provider": "ServiceProvider",
        "academia": "Academia",
        "government-body": "GovernmentBody",
        "individual": "Individual",
        "startup": "Startup",
        "mentor": "Mentor"
    };
    var enablerRole = ["Incubator", "Accelerator","Corporate", "Investor", "ServiceProvider", "Academia", "GovernmentBody", "Mentor"];
    var switchProfile = false;
    var personaJSON = {
        dialogsInBody: true,
        dialogsFade: true,
        minHeight: 50,
        disableDragAndDrop: true,
        toolbar: [
            ['insert', ['link']]
        ], callbacks: {
            onKeydown: function (e) {
                var t = e.currentTarget.innerText;
                if (t.trim().length >= $(this).attr("maxlength")) {
                    if (e.keyCode != 8)
                        e.preventDefault();
                }
            },
            onKeyup: function (e) {
                var t = e.currentTarget.innerText;
                $('#maxContentPost').text($(this).attr("maxlength") - t.trim().length);
            },
            onPaste: function (e) {
                var max = parseInt($(this).attr("maxlength"));
                var t = e.currentTarget.innerText.trim();
                var bufferText = ((e.originalEvent || e).clipboardData || window.clipboardData).getData('Text').trim();
                e.preventDefault();
                document.execCommand('insertText', false, bufferText.substring(0, max - t.length + 1));
            },
            onImageUpload: function (data) {
                data.pop();
            }
        },
        dialogsInBody:true
    };
    var errorMappingObj = {};
    $(document).on("ready", function(){
        if($(".persona-body").length){
            $("body").addClass('step-one');
        }
    })

    function doProcessingForTNC() {
        var tncWrapper = $("div.terms-condition-wrapper");
        if (tncWrapper && tncWrapper.length > 0) {
            var $submitCTA = tncWrapper.find("input.submit-cta");
            if (!tncWrapper.find("input[type=checkbox][name=enableTNC]").prop("checked")) {
                $submitCTA.attr("disabled", "disabled");
            } else {
                $submitCTA.removeAttr("disabled");
            }
        }
        //$("div.modal-backdrop.fade").remove();
    }

    function cloneFileUploads() {
        var repeatFileUploads = $(".repeat-container .file-upload");
        $.each(repeatFileUploads, function (index, item) {
            var $item = $(item);
            if (!fileuploads[$item.data('name')]) {
                fileuploads[$item.data('name')] = $item.clone();
            }
        });
    }

    //On change Term and Condition only for startup profile.
    $(document).on("change", "input[type=checkbox][name=enableTNC]", function (event) {
        var $target = $(event.target);
       // var submitBtn = $target.find('.step-next-wrap input.submit-cta');
        if ($target.prop("checked")) {
            enableTNC =true;
            $('.step-next-wrap input.submit-cta').removeAttr("disabled");
        } else {
            enableTNC =false;
            $('.step-next-wrap input.submit-cta').attr("disabled", "disabled");
        }
    });
    //for other persona as per old design
    $(document).on("change", "input[type=checkbox][name=enableTNC]", function (event) {
        var $target = $(event.target);
        var submitBtn = $target.closest("div.terms-condition-wrapper").find("input.submit-cta");
        if ($target.prop("checked")) {
            submitBtn.removeAttr("disabled");
        } else {
            submitBtn.attr("disabled", "disabled");
        }
    });

    $(document).on('change', '#persona-countries', function (event) {
        store.removeItem("startupEntity");
        $('#modal-loader').modal("show");
        $('.international-persona,.indian-persona').parents('.persona-chooser').hide();

        var selectedCountry = $("#persona-countries").val();
        store.setItem("personaCountry", selectedCountry);
        store.setItem("country", selectedCountry);
        if (selectedCountry === INDIA_COUNTRY_ID) {
            $('.international-persona').parents('.persona-chooser').hide();
            $('.indian-persona').parents('.persona-chooser').show().children('.row').removeClass('display-n');
        } else {
            $('.international-persona').parents('.persona-chooser').show().children('.row').removeClass('display-n');
            $('.indian-persona').parents('.persona-chooser').hide();
        }
        setTimeout(function () {
            $('#modal-loader').modal("hide");
        }, 2000);
    });

    //TODO: seems obsolete code - confirm & remove
    function filterPersonaForCountry() {
        if (store.getItem('country') && store.getItem('country').toUpperCase() === 'SWEDEN') {
            $('.persona-profile-form div[data-personatype=individual]').closest('.col-xs-4').find('.thumbnail .caption h3').html("Swedish User");
            $('.persona-profile-form div[data-personatype=individual]').closest('.col-xs-4').find('.thumbnail .caption p').html("Entrepreneurs/Investors/Incubators/Mentors");
            $('.persona-profile-form .accordion-section-title').html("<span class='number'>1</span>Users from Sweden?");
            $('.persona-profile-form div[data-personatype=startup], .persona-profile-form div[data-personatype=enabler]').closest('.col-xs-4').hide()
        }
    }

    function isUpdateProfile() {
        return getSelector(location.pathname, 0) === "update";
    }

    function setHeaderFields() {
        var country = store.getItem("personaCountry") ? store.getItem("personaCountry") : INDIA_COUNTRY_ID;
        setHeaderCountry($(".headerCountryLink[data-value='" + country + "']"));

        setHeaderRolesList(country);
        var role = store.getItem("personatype");
        setHeaderRole($(".headerRoleLink[data-value='" + role + "']"), false, false);
    }

    $(document).ready(function () {


        //TODO: seems obsolete method - confirm & remove
        filterPersonaForCountry();
        var noDashboardPersonas = ["freelancer-service-provider", "organization-service-provider", "academia"];
        var enablers = ["government-body", "academia", "incubator", "accelerator","corporate", "institutional-investor", "individual-investor", "organization-service-provider", "freelancer-service-provider", "mentor"];

        var store = store || ContextHub.getStore("sih_user");
        store.removeItem("startupEntity");
        $(".btn-next-step").attr("disabled", "disabled");
        setHeaderCountryList();
        if (!isUpdateProfile()) setCountryList();

        if(store.getItem("socialLogin") == true && !getParameterByName("applicationId")){
            setTimeout(function () {
                $("input[name=email]").prop("disabled",true);
            },1000);

        }

        function setCountryList() {
            var params = {};
            var $selection = $("#persona-countries");
            if ($selection && $selection.length > 0) {
                setList(params, $selection.data("path"), $selection, countryChangeCallback);
            }
        }

        //Commment the below code to disappear dropdown from the role and country on persona/{role}.html

        /*if (!isUpdateProfile() || (store.getItem("personatype")==="individual" && isUpdateProfile())) {
        $("#headerRole").each(function(){
            $(this).on('mouseover', function(){
                $(this).find(".dropdown-content").show();
            });
            $(this).on('mouseout', function(){
                $(this).find(".dropdown-content").hide();
            });
        });
    }    if(store.getItem("no-profile")==true){
            $("#headerCountry").each(function(){
                $(this).on('mouseover', function(){
                    $(this).find(".dropdown-content").show();
                });
                $(this).on('mouseout', function(){
                    $(this).find(".dropdown-content").hide();
                });
            });
    }*/
        var personaStepsPath;
    //TODO: check if 'triggered' check now needed?
    $(document).on('click', '.persona-radio-wrap', function (event, triggered) {
        if (isUpdateProfile() && store.getItem("role").toLowerCase() === "individual"
            && $(this).children("div.persona-container").data("personatype") === "startup" && !triggered) {
        } else {
            var $target = $(this).children("div.persona-container");
            var personaType = $target.data("personatype");
            personaStepsPath = $target.data("personaStepsPath");
            store.setItem("personatype", personaType);

                // finding for the suboptions
                var $option = $(".persona-chooser select[name=" + personaType + "-option]");
                if ($option && $option.length > 0) {
                    $option.closest("div.row").css("display", "block");
                    $(".btn-next-step").attr("disabled", "disabled");
                } else {
                    $(".row.first-level-category").hide();
                    $(".row.first-level-category .persona-sub-option").find("option:first").prop("selected", true);
                    $(".row.second-level-category").hide().end().find("input[type=radio]").prop('checked', false);
                    $(".btn-next-step").attr("disabled", false);
                }
            }
        });

        $(document).on('change', 'select.persona-sub-option', function (event) {
            store.removeItem('hasStories');
            store.removeItem('TiEOrLetsVenture');
            var $target = $(event.target);
            var $selectedTarget = $target.find("option:selected");
            var persona = $target.val();
            if (persona == "") {
                alert("select Type");
            } else {
                store.setItem("personatype", persona);
                personaStepsPath = $selectedTarget.data("personaStepsPath");

                // check for second level options
                var subOption = $(".persona-chooser input[name=" + persona + "-option]");
                $(".row.second-level-category").hide();
                if (subOption && subOption.length > 0) {
                    subOption.closest("div.row").css("display", "block");
                    $(".btn-next-step").attr("disabled", "disabled");
                } else {
                    $(".btn-next-step").attr("disabled", false);
                }
            }
        });

        $(document).on("change", ".persona-sub-option:radio", function (event) {
            var $target = $(event.target);
            var persona = store.getItem("personatype").toLowerCase();
            if (persona === 'individual-investor' || persona === 'institutional-investor') {
                persona = "investor";
            } else if (persona === "organization-service-provider" || persona === "freelancer-service-provider") {
                persona = "service-provider";
            }
            var value = $(".persona-chooser input[name=" + persona + "-option]:checked").val();
            store.setItem("personatype", value);
            personaStepsPath = $target.data("personaStepsPath");
            $(".btn-next-step").attr("disabled", false);
        });

        $(document).on('click', '.btn-next-step', function (event, triggered) {
            store.setItem("personaStepsPath", personaStepsPath);
            personaSelection(personaStepsPath);
        });

        $(document).on('change', '#header-countries', function (event) {
            store.removeItem("startupEntity");
            $('#modal-loader').modal("show");
            store.setItem("personaCountry", $("#persona-countries").val());
            store.setItem("country", $("#persona-countries").val());
            setTimeout(function () {
                $('#modal-loader').modal("hide");
            }, 2000);
        });

        $(document).on('change', 'input.personalized-content, select.personalized-content', function (event) {
            var $target = $(event.target);
            var type = $target.attr("type");
            var store = ContextHub.getStore('sih_user');
            if (type == "checkbox" || type == "radio") {
                var value = $target.attr("value");
                if (value) {
                    store.setItem($target.attr("name"), value);
                } else {
                    store.setItem($target.attr("name"), $target.is(":checked"));
                }
            } else {
                store.setItem($target.attr("name"), $target.val());
            }
            cloneFileUploads();
            setTimeout(function () {
                cloneFileUploads();
            }, 1000);
        });

        var stageIntervalId;
        function getRedirectPath(formDataAttr, personatype) {
            if (!personaMap[personatype]) {
                return null;
            }
            if (store.getItem("country") === INDIA_COUNTRY_ID) {
                return formDataAttr["redirectPath"] + "/" + personaMap[personatype];
            } else {
                return formDataAttr["redirectPath"] + "/Int-" + personaMap[personatype];
            }
        }

        $(document).on("click", ".persona-profile-form .submit-cta, .skip-cta", function (event) {
            if(validateNext()) {
                   $('#modal-loader').modal('show');
                   var $target = $(event.target);
                   if (isUpdateProfile() || $(this).attr("name").toLowerCase() === "saveprofile") {
                       validateUpdateFlow($target);
                   } else {
                       validate($target, true);
                   }
             }
        });


        $(document).on('click', '.btn-validate-step', function (event) {
            validate($(event.target));
        });

        var isValidated = true;
        function validate($target, submitCta) {
            isValidated = true;
            var currentTarget = $target.closest('div.section-block');
            var validateSections = [];
            validateSections.push($(currentTarget));
            $(currentTarget).attr("validate", "1");
            $(currentTarget).prevAll().each(function () {
                $(this).attr("validate", "1");
                validateSections.push($(this));
            });

            var requiredFields = $('div.section-block sup.required');
            $.each(requiredFields, function (index, item) {
                if (($(item).closest("div.section-block")).attr("validate") === "1") {
                    var element = $(item).closest('.form-group').find(".form-control:not(.richTextarea,.customised-dropdown):visible");
                    if (element && element.length > 0 && !element.closest(".modal").length && !element.hasClass("mentorshipComp-hidden")) {
                        if (element.attr("type") === "radio") {
                            if (element.is(':checked')) {
                                element.closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
                            }
                            else {
                                element.closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field cannot be left Blank.");
                                isValidated = false;
                            }
                        }

                        else if (element.attr("type") === "checkbox") {
                            if (element.is(':checked')) {
                                element.closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
                            }
                            else {
                                element.closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field cannot be left Blank.");
                                isValidated = false;
                            }
                        } else if (!element.val() || element.val() === "") {
                            isValidated = false;
                            showErrorState(element, true);
                        }
                        else {
                            showErrorState(element, false);
                        }
                    }
                }
            });
            var richTextAreas = $('.form-control.richTextarea');
            $.each(richTextAreas, function (index, item) {
                if (($(item).closest("div.section-block")).attr("validate") === "1") {
                    var el = $(item);
                    if (el.closest('.form-group').find('sup.required').length > 0 && el.closest('.form-group').is(":visible")) {
                        var note = el.val().trim();
                        if (note.length > 0 && !el.summernote('isEmpty')) {
                            el.siblings('.note-editor.note-frame').removeClass('note-has-error').addClass('note-writer-text');
                            showErrorState(el, false);
                        } else {
                            isValidated = false;
                            el.siblings('.note-editor.note-frame').addClass('note-has-error').removeClass('note-writer-text');
                            showErrorState(el, true);
                        }
                    }
                }
            });

            var customizedDropDown = $('.form-control.customised-dropdown:visible');
            $.each(customizedDropDown, function (index, item) {
                if (($(item).closest("div.section-block")).attr("validate") === "1") {
                    var el = $(item);
                    var selectedIndustries = $("select[name=industry]").val();
                    if (!selectedIndustries || selectedIndustries.length === 0) {
                        isValidated = false;
                        showErrorState(el, true);
                    } else {
                        $.each(selectedIndustries, function (idx, selectedIndustry) {
                            var selectedIndustryArr = selectedIndustry.split("/");
                            var industryName = selectedIndustryArr[selectedIndustryArr.length - 1];
                            if (el.find("ul#sector").first().find("input[name=" + industryName + "][type=checkbox]:checked").length === 0) {
                                isValidated = false;
                                showErrorState(el, true, $("#sector").data("requiredMessage"));
                            } else {
                                showErrorState(el, false);
                            }
                        });
                    }
                }
            });
            var multiSelect= $('select.multi-select');
            $.each(multiSelect,function (index,item) {
                var el =$(item);
                if(el.is(":visible")) {
                    var value = el.val();
                    if (!value || value.length == '0') {
                        $(el).closest('.form-group').addClass("has-error").find("span.help-block").html('This field cannot be left Blank.');
                        isValidated = false;
                    }
                }
            });

            var regexValidatedfields = $('div.section-block .regex-val:visible');
            $.each(regexValidatedfields, function (index, item) {
                if (($(item).closest("div.section-block")).attr("validate") === "1") {
                    var element = $(item);
                    var re = new RegExp(element.attr("regex"));
                    if (element.val() && !re.test(element.val())) {
                        isValidated = false;
                        //showErrorState(element, true);
                        element.closest(".form-group").addClass("has-error");
                        element.siblings(".regex-msg").show();
                    } else {
                        if (!(element.closest(".form-group").has("sup.required") && !element.val())) {
                            showErrorState(element, false);
                        }
                        element.siblings(".regex-msg").hide();
                    }
                }
            });
            isValidated = validateMentorshipFields(isValidated);
            isValidated = validateTieLvVerifications(isValidated);
            $('div.section-block').removeAttr("validate");
            if (isValidated) {
                var $cin = $target.attr("name").toLowerCase() === "saveprofile" ? $("form.persona-profile-form input[name=cin]") : $target.closest('div.section-block').find("input[name=cin]");
                if ($cin.length !== 0 && $cin.is(":visible") && !$cin.is(":disabled")) {
                    getLegalName($cin, true, $target, submitCta);
                } else {
                    if (submitCta) submitForm($target);
                }
                return true;
            } else {
                submitErrors();
                return false;
            }
        }

        function validateUpdateFlow($target) {
            isValidated = true;
            var requiredFields = $('div.section-block sup.required, div.new-persona-interest sup.required');
            $.each(requiredFields, function (index, item) {
                var element = $(item).closest('.form-group').find(".form-control:not(.richTextarea,.customised-dropdown):visible");
                if (element && element.length > 0 && !element.closest(".modal").length && !element.hasClass("mentorshipComp-hidden")) {
                    if (element.attr("type") === "radio") {
                        if (element.is(':checked')) {
                            element.closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
                        } else {
                            element.closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field cannot be left Blank.");
                            isValidated = false;
                        }
                    } else if (element.attr("type") === "checkbox") {
                        if (element.is(':checked')) {
                            element.closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
                        } else {
                            element.closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field cannot be left Blank.");
                            isValidated = false;
                        }
                    } else if (!element.val() || element.val() === ""){
                        isValidated = false;
                        showErrorState(element, true);
                       }
                       else {
                        showErrorState(element, false);
                    }
                }
            });
            var richTextAreas = $('.form-control.richTextarea');
            $.each(richTextAreas, function (index, item) {
                var el = $(item);
                if (el.closest('.form-group').find('sup.required').length > 0 && el.closest('.form-group').is(":visible")) {
                    var note = el.val().trim();
                    if (note.length > 0 && !el.summernote('isEmpty')) {
                        el.siblings('.note-editor.note-frame').removeClass('note-has-error').addClass('note-writer-text');
                        showErrorState(el, false);
                    } else {
                        isValidated = false;
                        el.siblings('.note-editor.note-frame').addClass('note-has-error').removeClass('note-writer-text');
                        showErrorState(el, true);
                    }
                }
            });

            var customizedDropDown = $('.form-control.customised-dropdown:visible');
            $.each(customizedDropDown, function (index, item) {
                var el = $(item);
                var selectedIndustries = $("select[name=industry]").val();
                if (!selectedIndustries || selectedIndustries.length === 0) {
                    isValidated = false;
                    showErrorState(el, true);
                } else {
                    $.each(selectedIndustries, function (idx, selectedIndustry) {
                        var selectedIndustryArr = selectedIndustry.split("/");
                        var industryName = selectedIndustryArr[selectedIndustryArr.length - 1];
                        if (el.find("ul#sector").first().find("input[name=" + industryName + "][type=checkbox]:checked").length === 0) {
                            isValidated = false;
                            showErrorState(el, true, $("#sector").data("requiredMessage"));
                        } else {
                            showErrorState(el, false);
                        }
                    });
                }
            });

            var regexValidatedfields = $('div.section-block .regex-val:visible');
            $.each(regexValidatedfields, function (index, item) {
                var element = $(item);
                var re = new RegExp(element.attr("regex"));
                if (element.val() && !re.test(element.val())) {
                    isValidated = false;
                    //showErrorState(element, true);
                    element.closest(".form-group").addClass("has-error");
                    element.siblings(".regex-msg").show();
                }
                else {
                    if (!(element.closest(".form-group").has("sup.required") && !element.val())) {
                        showErrorState(element, false);
                    }
                    element.siblings(".regex-msg").hide();
                }
            });
            if (!store.getItem("personaStepsPath").includes("international-persona")) {
                //isValidated = validateMentorshipFields(isValidated, true);
                isValidated = validateTieLvVerifications(isValidated);
            }
            if (isValidated) {
                var $cin = $target.attr("name").toLowerCase() === "saveprofile" ? $("form.persona-profile-form input[name=cin]") : $target.closest('div.section-block').find("input[name=cin]");
                if ($cin.length !== 0 && $cin.is(":visible") && !$cin.is(":disabled")) {
                    getLegalName($cin, true, $target, true);
                } else {
                    submitForm($target);
                }
                return true;
            } else {
                submitErrors();
                return false;
            }
        }

        function submitErrors() {
            var _firstErrorElem = $(".form-group.has-error:first");
            var topOffset = _firstErrorElem.offset().top - 80;
            topOffset = topOffset && topOffset > 0 ? topOffset : 0;
            $('#modal-loader').modal('hide');
            $('html, body').animate({
                scrollTop: topOffset
            }, 500);
        }

        function showErrorState(el, hasError, errorMsg) {
            if (hasError) {
                if (!errorMsg) errorMsg = "This field cannot be left Blank.";
                el.siblings('.help-block').show();
                el.closest(".form-group").addClass("has-error").find("span.help-block").first().html(errorMsg);
            } else {
                el.closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
            }
        }

        function submitForm($target) {
            var store = ContextHub.getStore("sih_user");
            var updateProfile = isUpdateProfile();
            var $formData = $target.closest("form.persona-profile-form").serialize();
            var personatype = store.getItem("personatype");
            var jsonParam = {};
            if (store.getItem('socialLogin')) {
                jsonParam.socialLogin = true
            }

            //Get the form data
            var personaTypeJson = convertSerializeDataToJSON($formData);
            personaTypeJson = addLocation(personaTypeJson);
            personaTypeJson = addLegalName(personaTypeJson);
            personaTypeJson = addDIPPNumber(personaTypeJson);
            personaTypeJson.oldEmail = personaTypeJson.email;
            if (isValidated === false) {
                $('#modal-loader').modal("hide");
                return;
            }
            if (!personaTypeJson["name"] && store) {
                personaTypeJson["name"] = store.getItem("fullName");
            }
            var $services = $("form.persona-profile-form select[name=services]");
            personaTypeJson["services"] = $services.val();
            errorMappingObj["services"] = $services[0];
            errorMappingObj["stage"] = $("form.persona-profile-form input[name=stage]")[0];
            if (personatype === "startup") {
                var jsonObject = addUserData(jsonObject);
                jsonObject["image"] = startupFileNames["image"];
                if (updateProfile) {
                    jsonObject["uniqueId"] = profileData ? profileData["uniqueId"] : "";
                }
                if (!$target.hasClass("skip-cta")) {
                    personaTypeJson = addMembers(personaTypeJson);
                    personaTypeJson = addBusinessPlans(personaTypeJson);
                }
                personaTypeJson = addRequiredFields(personaTypeJson);
                personaTypeJson["lookingToConnectTo"] = getArray("lookingToConnectTo");
                var $startupindustry = $("form.persona-profile-form select[name=startupindustry]");
                var $sector = $("form.persona-profile-form select[name=sector]");
                errorMappingObj["focusArea.industry"] = $startupindustry[0];
                errorMappingObj["focusArea.sector"] = $sector[0];
                personaTypeJson["focusArea"] = getFocusArea($startupindustry, $sector);
                personaTypeJson = addMentorshipProgramDetails(personaTypeJson);
                jsonObject[personatype] = personaTypeJson;
                jsonParam = jsonObject;
                if(profileData && profileData.startup) {
                    if (profileData.startup.members) {
                        jsonParam.startup.members = profileData.startup.members;
                    }
                    if (profileData.startup.businessPlan) {
                        jsonParam.startup.businessPlan = profileData.startup.businessPlan;
                    }
                    if (profileData.startup.socialInfos) {
                        jsonParam.startup.socialInfos = profileData.startup.socialInfos;
                    }
                }

            } else {
                personaTypeJson = addUserData(personaTypeJson);
                if (updateProfile) {
                    personaTypeJson["uniqueId"] = profileData ? profileData["uniqueId"] : "";
                }
                if(personatype==="incubator"||personatype==="accelerator" || personatype==="corporate"){
                    if (profileData.socialInfos) {
                        personaTypeJson.socialInfos = profileData.socialInfos;
                    }
                    if (profileData.members) {
                        personaTypeJson.members = profileData.members;

                    }
                    personaTypeJson=addCenterLocation(personaTypeJson);
                }
                if ($.inArray(personatype, enablers) > -1) {
                    personaTypeJson = addFocusAreas(personaTypeJson);
                }
                personaTypeJson["image"] = images["" + personatype];
                if (!$target.hasClass("skip-cta") && (personatype == "government-body" || personatype == "incubator" || personatype == "accelerator" || personatype==="corporate" || personatype == "academia" || personatype == "institutional-investor")) {
                    personaTypeJson = addContactDetails(personaTypeJson);
                }
              /*  if (personatype == "mentor" || personatype == "incubator" || personatype == "accelerator" || personatype==="corporate" || personatype == "academia" || personatype == "institutional-investor" || personatype == "individual-investor" || personatype == "freelancer-service-provider" || personatype == "organization-service-provider") {
                    var $preferredStartupStages = $("form.persona-profile-form select[name=preferredStartupStages]");
                    personaTypeJson["preferredStartupStages"] = $preferredStartupStages.val();
                }*/
                if (personatype == "mentor" || personatype == "incubator" || personatype == "accelerator" || personatype == "corporate" || personatype == "academia" ||  personatype == "institutional-investor" || personatype == "individual-investor" || personatype == "freelancer-service-provider" || personatype == "organization-service-provider") {
                   var $preferredStartupStages = $("input[name=preferredStartupStages]:checked");
                    // console.log("$preferredStartupStages",$preferredStartupStages);
                    if ($preferredStartupStages && $preferredStartupStages.length > 0) {
                        var inpArr = [];
                        $.each($preferredStartupStages, function (i) {
                            inpArr.push($preferredStartupStages[i].value);

                        });
                        console.log("inpArr", inpArr);
                    }
                    personaTypeJson["preferredStartupStages"] = inpArr;
                    errorMappingObj["preferredStartupStages"] = $preferredStartupStages[0];
                    if (!$target.hasClass("skip-cta")) {
                        personaTypeJson = addPortfolios(personaTypeJson);
                    }
                    personaTypeJson = addMentorshipProgramDetails(personaTypeJson, true);
                }
                if (personatype == "mentor" || personatype == "individual-investor") {
                    if (updateProfile) {
                        var $tieVerified = $("input[type=radio][name=TiEOrLetsVenture][value=isTIE]");
                        var $lvVerified = $("input[type=radio][name=TiEOrLetsVenture][value=isLetsVenture]");
                        // if (store.getItem('otherThanTieLVDescription')) {
                        //     personaTypeJson['otherThanTieLVDescription'] = store.getItem('otherThanTieLVDescription');
                        // }
                        personaTypeJson['otherThanTieLVDescription'] = $("textarea[name='otherThanTieLVDescription']").val();
                        errorMappingObj["$tieVerified"] = $tieVerified;
                        errorMappingObj["lvVerified"] = $lvVerified;
                        personaTypeJson["tieVerified"] = $tieVerified.is(":checked");
                        personaTypeJson["lvVerified"] = $lvVerified.is(":checked");
                    } else {
                        personaTypeJson["tieVerified"] = store.getItem("tieVerified");
                        personaTypeJson["lvVerified"] = store.getItem("letsVentureVerified");

                    }
                }
                if (personatype == "government-body" || personatype == "organization-service-provider" || personatype == "freelancer-service-provider") {
                    if ($("input[name=urls]").length > 0) {
                        var urlValue = $("input[name=urls]").val();
                        if ($("input[name=urls]").length == 1 && urlValue && urlValue.length > 0) {
                            personaTypeJson["urls"] = [urlValue];
                        }
                    }
                }
                if (personatype == "government-body") {
                    personaTypeJson = addAgencyDetails(personaTypeJson);
                }
                if (personatype == "institutional-investor") {
                    personaTypeJson["type"] = $("select[name=type]").val() ? $("select[name=type]").val() : null;
                    errorMappingObj["type"] = $("select[name=type]");
                }
                personaTypeJson["lookingToConnectTo"] = getArray("lookingToConnectTo");
                var stage = $("input[type=radio][name=stage]:checked").val();
                jsonParam = personaTypeJson;
            }

            var path = $target.data()["formAction"];
            var redirectPath = "";
            var homePagePath = "";
            var loginPagePath = "";
            var formDataAttr = $("form.persona-profile-form").data();
            if (formDataAttr) {
                /*  if($.cookie("countryTag") != INDIA_COUNTRY_ID){
                 if($.cookie("countryTag") === "sih:location/sweden"){
                 redirectPath = formDataAttr["swedenLandingPage"];
                 }else{
                 redirectPath = formDataAttr["internationalLandingPage"];
                 }
                 }else{
                 redirectPath = formDataAttr["redirectPath"] + "/" + personaMap[personatype];
                 }*/
                redirectPath = getRedirectPath(formDataAttr, personatype);
                // redirectPath = $.cookie("countryTag") != INDIA_COUNTRY_ID ? formDataAttr["internationalLandingPage"] : formDataAttr["redirectPath"] + "/" + personaMap[personatype];
                homePagePath = formDataAttr["homePath"];
                loginPagePath = formDataAttr["loginPath"];
            }
            var customHeaders = {};
            customHeaders["Content-Type"] = "application/json";
            if (updateProfile && !switchProfile) {
                if (store.getItem("personaCountryEdit") === INDIA_COUNTRY_ID) {
                    path = "/api/auth/user/update/" + store.getItem("personatype");
                } else {
                    path = "/api/auth/user/update/int-" + store.getItem("personatype");
                }
                customHeaders["X-Auth-Token"] = $.cookie("authToken")
            }
            var redirectURIParam = location.protocol + "//" + location.host + homePagePath + ".html";
            if (path && path.length > 0) {
                if (store.getItem('socialLogin')) {
                    jsonParam.socialLogin = true
                }
                if (switchProfile) {
                    path = "/api/noauth/signup/" + (store.getItem("personaCountryEdit") === INDIA_COUNTRY_ID ? store.getItem("personatype") : "int-" + store.getItem("personatype"));
                    jsonParam["switchedUser"] = switchProfile;
                    jsonParam["uniqueId"] = store.getItem("uniqueId");
                }

                jsonParam["oldEmail"]=store.getItem('email');

                $.ajax({
                    url: SIH.getEndPoint(path),
                    data: JSON.stringify(jsonParam),
                    type: 'POST',
                    dataType: 'json',
                    headers: customHeaders,
                    contentType: "application/json",
                    success: function (response) {
                        $('#modal-loader').modal("hide");
                        if (response['token']) {
                            $.cookie("authToken", response['token'], {
                                'expires': 365,
                                'path': '/',
                                'domain': SIH.getSiteDomain()
                            });
                        }
                        var redirectURL = (redirectPath ? redirectPath : homePagePath) + ".html", noDashboard = false;
                        if (!response["token"] && !updateProfile) {
                            noDashboard = true;
                            alert("Your session seems to be expired. Redirecting to MyGov.in to sign in again to complete registration process");
                            redirectURL = loginPagePath ? (loginPagePath + redirectURIParam) : (homePagePath + ".html");
                        }
                        else {
                            store.setItem(personatype, personatype == "startup" ? jsonParam[personatype] : jsonParam);
                            addDataToContextHubPostSuccessfulRegistration(response);
                            if (!updateProfile) store.setItem("state", $("form.persona-profile-form select[name=state]").val());
                            if ($.inArray(personatype, noDashboardPersonas) > -1) {
                                noDashboard = true;
                                store.setItem('no-dashboard', true);
                                redirectURL = homePagePath ? (homePagePath + ".html") : "";
                            }
                            store.removeItem('no-profile');
                            store.removeItem('updateProfile');
                            store.setItem('role', personaMap[personatype]);
                        }
                        if (store.getItem("role").toLowerCase() == "startup" && !noDashboard) {
                            checkForRecognisedStartup(redirectURL);
                        } else if (store.getItem("role") != "Individual" && !noDashboard) {
                            //alert("Your profile changes has been successfully recorded.");
                            successSlide();
                           // window.location.href = redirectURL;
                        } else {
                            successSlide();
                           // window.location.href = redirectURL;
                        }
                    }, error: function (response) {
                        $('#modal-loader').modal("hide");
                        if (response.status == 200) {
                            alert("Changes have been successfully saved.");
                            var redirectURL = (redirectPath ? (redirectPath + "/" + personaMap[personatype]) : homePagePath) + ".html";
                            if (store.getItem("no-dashboard")) {
                                redirectURL = homePagePath ? (homePagePath + ".html") : "";
                            }
                            window.location.href = redirectURL;
                        } else {
                            populateFormErrors(response, updateProfile, $target);
                            var redirectURL = homePagePath + ".html";
                            if (response.status == 400) {
                                $("#registration-error-modal").modal("show");
                                $("input[type=checkbox][name=enableTNC]").prop("checked",false);
                                $('.step-next-wrap input.submit-cta').attr("disabled","disabled");

                            } else if (response.status == 417) {
                                alert("Your session seems to be expired. Redirecting to MyGov.in to sign in again to complete registration process");
                                window.location.href = homePagePath + ".html";
                            } else {
                                alert("Error occurred during registration. Please try later.");
                                window.location.href = redirectURL;
                            }
                        }
                    }
                });
            }
        }

        function checkForRecognisedStartup(redirectURL) {
            //$('#modal-loader').modal("show");
            $.ajax({
                type: "GET",
                async: false,
                url: SIH.getEndPoint("/api/auth/user/cin"),
                beforeSend: setAuthTokenHeader
            }).done(function (data) {
                $('#modal-loader').modal("hide");
                if (data) {
                    //alert("Your profile changes has been successfully recorded.");
                    window.location.href = redirectURL;
                } else {
                    var recLink = $('.notification-container').attr('recognition-page');
                    successSlide();
                   /* bootbox.dialog({
                        message: '<div class="unable-login-modal"><div class="modal-header">\n' +
                        '            </div>\n' +
                        '            <div class="modal-body">\n' +
                        '                <div class="row">\n' +
                        '                    <div class="col-sm-12">\n' +
                        '                        <p><b>Your profile details have been successfully recorded.</b></p>\n' +
                        '                        <ul class="certification-list">\n' +
                        '                            <li>You may also consider getting Startup recognition, a process by which Department of Industrial Policy and Promotion recognizes you as a Startup. A startup recognition allows one to avail a host of benefits put in place by DIPP specially for Startups. These include self certification of certain environment and labor laws, access to taking part in government procurement, patent support and more.</li>\n' +
                        '                            <li>To get recognized, simply click on  the Get Recognized button and furnish some additional information which the form asks for. Ensure you enter essential information like Incorporation number and entity type to apply for recognition.</li>\n' +
                        '                        </ul>\n' +
                        '                    </div>\n' +
                        '                </div>\n' +
                        '                <div class="row">\n' +
                        '                    <div class="col-sm-2"></div>' +
                        '                    <div style="padding-top: 10px;" class="col-sm-4"><a style="text-decoration: underline;" href="' + redirectURL + '">Go to Dashboard</a></div>' +
                        '                    <div class="col-sm-4"><a href="' + recLink + '" class="btn btn-default btn-type2">Get Recognized</a></div>' +
                        '                </div>\n' +
                        '            </div></div>',
                        closeButton: false,
                        backdrop: true,
                        onEscape: false
                    });*/
                    //$('.bootbox .modal-dialog').addClass('unable-login-wrapper startup-persona-recognition');
                }
            }).fail(function () {
                alert("Your profile changes has been successfully recorded.");
                window.location.href = redirectURL;
            });
        }

        function addDataToContextHubPostSuccessfulRegistration(response) {
            for (var key in response) {
                ContextHub.getStore("sih_user").setItem(key, response["" + key]);
            }
        }

        function addLegalName(data) {
            var formData = data || {};
            var $startupEntity = $("form.persona-profile-form select[name=startupEntity]");
            var $cin = $("form.persona-profile-form input[name=cin]");
            var $pan = $("form.persona-profile-form input[name=pan]");
            if ($startupEntity && $startupEntity.length > 0) {
                errorMappingObj["startupEntity"] = $startupEntity[0];
                formData["startupEntity"] = $startupEntity.val();
            }
            if ($pan && $pan.val() && $pan.length > 0) {
                errorMappingObj["pan"] = $pan[0];
                formData["pan"] = $pan.val();
            }
            errorMappingObj["cin"] = $cin[0];
            if ($cin && $cin.length > 0 && $cin.val()) {
                var $legalName = $("form.persona-profile-form input[name=legalName]");
                errorMappingObj["legalName"] = $legalName[0];
                if ($legalName && $legalName.length > 0) {
                    formData["legalName"] = $legalName.val();
                    formData["cin"] = $cin.val();
                }
            }
            return formData;
        }

        function addDIPPNumber(data) {
            var formData = data || {};
            var $dippNumber = $("form.persona-profile-form input[name=dippNumber]");
            errorMappingObj["dippNumber"] = $dippNumber[0];
            if ($dippNumber && $dippNumber.length > 0 && $dippNumber.val()) {
                formData["dippNumber"] = $dippNumber.val();
                formData["dippCertified"] = true;
                isValidated = true;
                $dippNumber.closest(".form-group").removeClass("has-error").find(".help-block").html("");
            } else {
                formData["dippCertified"] = false;
                if ($("form.persona-profile-form input[name='dippCertified']:checked").length > 0) {
                    isValidated = false;
                    $dippNumber.closest(".form-group").addClass("has-error").find(".help-block").html("This field cannot be left Blank");
                }
            }
            return formData;
        }

        function addUserData(data) {
            var formData = data || {};
            var store = ContextHub.getStore("sih_user");
            formData["name"] = $("form.persona-profile-form input[name=fullname]").val() || $("form.persona-profile-form input[name=name]").val();;
            formData["uid"] = store.getItem("uid");
            // formData["email"] = store.getItem("email") ? store.getItem("email") : $("form.persona-profile-form input[name=email]").val();
            formData["email"] = $("form.persona-profile-form input[name=email]").val()  ? $("form.persona-profile-form input[name=email]").val() : store.getItem("email");
            formData["phone"] = $("form.persona-profile-form input[name=phone]").val();
            errorMappingObj["name"] = $("form.persona-profile-form input[name=fullname]")[0];
            errorMappingObj["email"] = $("form.persona-profile-form input[name=email]")[0];
            errorMappingObj["phone"] = $("form.persona-profile-form input[name=phone]")[0];
            return formData;
        }


        function addMembers(data) {
            var formData = data || {};
            var members = [];
            var membersName = $("form.persona-profile-form input[name=members-name]");
            var membersPic = $("form.persona-profile-form input[name=members-pic]");
            var membersProfile = $("form.persona-profile-form textarea[name=members-profile]");
            var membersRole = $("form.persona-profile-form input[name=members-role]");
            var linkedinUrl = $("form.persona-profile-form input[name=linkedin-url]");
            var twitterUrl = $("form.persona-profile-form input[name=twitter-url]");
            for (var index = 0; index < membersName.length; index++) {
                var member = {};
                member.name = membersName[index].value;
                var memberPic = membersPic[index];
                var repeatFieldID = $(memberPic).closest("div.repeat-fields").first().attr("id");
                member.pic = (startupFileNames["memberpic"]) ? startupFileNames["memberpic"]["" + repeatFieldID] : null;
                member.profile = membersProfile[index].value;
                member.role = membersRole[index].value ? membersRole[index].value : null;
                var socialInfos = [];
                var socialInfoL = {};
                socialInfoL.social = "Linkedin";
                socialInfoL.url = linkedinUrl[index].value ? linkedinUrl[index].value : null;
                socialInfos.push(socialInfoL);
                var socialInfoT = {};
                socialInfoT.social = "Twitter";
                socialInfoT.url = twitterUrl[index].value ? twitterUrl[index].value : null;
                socialInfos.push(socialInfoT);
                member.socialInfos = socialInfos;
                members.push(member);
                errorMappingObj["members[" + index + "].name"] = membersName[index];
                errorMappingObj["members[" + index + "].pic"] = memberPic[index];
                errorMappingObj["members[" + index + "].profile"] = membersProfile[index];
                errorMappingObj["members[" + index + "].role"] = membersRole[index];
                errorMappingObj["members[" + index + "].socialInfos[" + 0 + "]linkedin"] = linkedinUrl[index];
                errorMappingObj["members[" + index + "].socialInfos[" + 1 + "]twitter"] = twitterUrl[index];
            }
            formData.members = members;
            return formData;
        }

        function addBusinessPlans(data) {
            var formData = data || {};
            if (startupFileNames["startupDocs"]) {
                var businessPlans = [];
                var files = $("form.persona-profile-form input[name=businessPlan-fileName]");
                $.each(files, function (idx, file) {
                    var i = 0;
                    var businessPlan = {};
                    var repeatFieldID = $(file).closest("div.repeat-fields").first().attr("id");
                    var businessObj = startupFileNames["startupDocs"]["" + repeatFieldID];
                    if (businessObj) {
                        businessPlan["fileName"] = businessObj["fileName"] ? businessObj["fileName"] : null;
                        businessPlan["title"] = businessObj["title"] ? businessObj["title"] : null;
                        businessPlans.push(businessPlan);
                    }
                    errorMappingObj["businessPlan[" + i++ + "]"] = file;
                });
                formData["businessPlan"] = businessPlans;
            } else {
                formData["businessPlan"] = null
            }
            return formData;
        }

        $(document).on('change', 'form.persona-profile-form input[type=file]', function (event) {
            var domain = SIH.getEndPoint("/api/file");
            var personaType = ContextHub.getStore("sih_user").getItem("personatype");
            var target = event.target;
            var targetName = target.name;
            var file = target.files[0];
            validateFile(event, file).then(function (isValid) {
                if(isValid){

            var $target = $(target);
            var fileIcon = $target.parent().siblings(".image-section").find("span.fa-files-o");
            var imgIcon = $target.parent().siblings(".image-section").find('span.camera-image');
            var fileNameSpan = $target.parent().siblings(".image-section").find("span.browse-file-name");
            var imageTag = $target.parent().siblings(".image-section").find("img.browse")[0];
            var apiPath = "/user/doc/" + personaMap["" + personaType];
            var memberPic = false;
            var startupLogo = false;
            var startUpDoc = false;

            if (personaType == "startup") {
                if (targetName.indexOf("members-pic") > -1) {
                    memberPic = true;
                    apiPath = "/member/pic";
                } else if (targetName.indexOf("image") > -1) {
                    startupLogo = true;
                    apiPath = "/user/image/" + personaMap["" + personaType];
                } else if (targetName.indexOf("business") > -1) {
                    startUpDoc = true;
                }
            } else {
                apiPath = "/user/image/" + personaMap["" + personaType];
            }
            apiPath = domain + apiPath;
            if (file) {
                var data = new FormData();
                data.append("file", file);
                $('#modal-loader').modal("show");
                $.ajax({
                    url: apiPath,
                    type: 'POST',
                    data: data,
                    cache: false,
                    contentType: false,
                    processData: false,
                    success: function (data) {
                        $('#modal-loader').modal("hide");
                        if (data && data.name) {

                            if (personaType == "startup") {
                                if (startupLogo) {
                                    startupFileNames["image"] = data.name;
                                }
                                else if (memberPic || startUpDoc) {
                                    var repeatField = $target.closest("div.repeat-fields");
                                    if (repeatField.length > 0) {
                                        var repeatID = repeatField.first().attr("id");

                                        if (memberPic) {
                                            startupFileNames["memberpic"] = startupFileNames["memberpic"] || {};
                                            startupFileNames["memberpic"]["" + repeatID] = data.name;
                                        } else {
                                            startupFileNames["startupDocs"] = startupFileNames["startupDocs"] || {};
                                            startupFileNames["startupDocs"]["" + repeatID] = startupFileNames["startupDocs"]["" + repeatID] ? startupFileNames["startupDocs"]["" + repeatID] : {};
                                            startupFileNames["startupDocs"]["" + repeatID]["fileName"] = data.name;
                                            startupFileNames["startupDocs"]["" + repeatID]["title"] = $target.val().split('\\').pop();
                                        }
                                    }
                                }
                            } else {
                                if(targetName.indexOf("startupLogo") > -1){
                                    var repeatFieldLogo = $target.closest("div.repeat-fields");
                                    if (repeatFieldLogo.length > 0) {
                                        var repeatIDLogo = repeatFieldLogo.first().attr("id");
                                        portfolioImages["startupLogo"] = portfolioImages["startupLogo"] || {};
                                        portfolioImages["startupLogo"]["" + repeatIDLogo] = data.name;
                                    }

                            }
                                else{
                                    images["" + personaType] = data.name;
                                }
                        }  // display the image to user
                            if (!($target.hasClass("file"))) {
                                imageTag.src = window.URL.createObjectURL(target.files[0]);
                                $(imageTag).css("display", "block");
                                $(fileIcon).css('display', 'none');
                                $(imgIcon).css("display", "none");
                            } else {
                                $target.parent().css("top", "0");
                                fileNameSpan.text(target.files[0].name ? target.files[0].name : "");
                                $(imageTag).css("display", "none");
                                $(imgIcon).css("display", "none");
                                $(fileIcon).css('display', 'none');
                            }}
                    }, error: function (data) {
                        $('#modal-loader').modal("hide");
                        alert("Error while uploading files");
                    }
                });
            }
        }})

    })

    function validateFile(event, file) {

            var allowedExtensionsForImage = ["image/png", "image/jpeg", "image/jpg"];
            var allowedExtensionsForFile = ["application/pdf", "application/vnd.ms-excel",
                "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet", "application/vnd.openxmlformats-officedocument.wordprocessingml.document", "application/msword",
                "application/vnd.openxmlformats-officedocument.presentationml.presentation", "application/vnd.ms-powerpoint"];
            var maxFileSizeInBytes = 2097152;
            var maxImageSizeInBytes = 1048576;
            var isValid = true;
            return new Promise(function (resolve, reject) {
                if ($(event.target).hasClass("file")) {
                    if ($.inArray(file.type, allowedExtensionsForFile) < 0) {
                        alert("Supported Formats for file uploads are: " + allowedExtensionsForFile.join(" , "));
                        resolve(false);
                    } else if (file.size > maxFileSizeInBytes) {
                        alert("Maximum file size allowed is 2 MB ");
                        resolve(false);
                    } else {
                        resolve(true);
                    }
                } else {
                    var type = 'unknown';
                    var filereader = new FileReader();
                    filereader.onloadend = function (evt) {
                        if (evt.target.readyState === FileReader.DONE) {
                            var arr = (new Uint8Array(evt.target.result)).subarray(0, 4);
                            var header = '';
                            for (var i = 0; i < arr.length; i++) {
                                header += arr[i].toString(16);
                            }
                            console.log('File header: ' + header);
                            // Check the file signature against known types

                            switch (header) {
                                case '89504e47':
                                    type = 'image/png';
                                    break;
                                case '47494638':
                                    type = 'image/gif';
                                    break;
                                case 'ffd8ffe0':
                                case 'ffd8ffe1':
                                case 'ffd8ffe2':
                                    type = 'image/jpeg';
                                    break;
                                case '25504446':
                                    type = 'application/pdf';
                                    break;
                            }
                        }

                        if ($.inArray(type, allowedExtensionsForImage) < 0) {
                            alert("Supported Formats for file uploads are: " + allowedExtensionsForImage.join(" , "));
                            //isValid = false;
                            resolve(false);
                        } else if (file.size > maxImageSizeInBytes) {
                            alert("Maximum file size allowed is 1 MB ");
                            //isValid = false;
                            resolve(false);
                        } else {
                            resolve(true);
                        }
                    };

                    filereader.readAsArrayBuffer(file);
                }
            });
        }

        function getArray(name) {
            var elements = $("input[name=" + name + "]:checked");
            errorMappingObj[name] = $("input[name=" + name + "]");
            var array = [];
            $.each(elements, function (index, item) {
                array.push(item.value);
            });
            return array;
        }

        function addRequiredFields(data) {
            var formData = data || {};
            var platform = {};
            var $mobileAppLink = $("input[name=mobileAppLink]");
            errorMappingObj["mobileAppLink"] = $mobileAppLink[0];
            if ($mobileAppLink && $mobileAppLink.length > 0) {
                var value = $mobileAppLink.val();
                if (value && value.length > 0) {
                    platform["Android"] = value;
                    formData["mobileAppLink"] = platform;
                } else {
                    formData["mobileAppLink"] = null;
                }
            } else {
                formData["mobileAppLink"] = null;
            }
            return formData;
        }

        $(document).on('change', '#startupindustry', function (event) {
            var $target = $(event.target);
            var params = {};
            params["industry"] = $target.val();
            var $selection = $("#sector");
            setList(params, $selection.data("path"), $selection);
        });

        var industrySectors = [];
        $(document).on('change', '#industry', function (event) {
            industrySectors = [];
            var selectedSectors = $("ul#sector").find("input[type=checkbox]:checked");
            var industries = $("#industry option:selected");
            var $selection = $("#sector");
            $.each(industries, function (index, item) {
                var params = {};
                params["industry"] = item.value;
                getIndustrySectors(params, $selection.data("path"), params["industry"].substring(params["industry"].lastIndexOf('/') + 1, params["industry"].length), item.text);
            });
            var template = Handlebars.compile($("#sectors-template").html());
            $selection.empty();
            $selection.append(template(industrySectors));
            $.each(selectedSectors, function (idx, selectedSector) {
                $("input[value='" + $(selectedSector).val() + "']").prop("checked", true);
            });
            $("div.customised-dropdown .dropdown-menu").trigger("change", ["#industry"]);

        });

        var stateCities = [];
        $(document).on('change', '.selectionwithalloption #states', function (event, parent, data) {
            if (parent === "#industry") {
                return;
            }
            stateCities = [];
            var selectedCities = $("ul#city").find("input[type=checkbox]:checked");
            var previousStateCities = [];
            var previousStateAllCheckedCities = [];
            $("ul#city input[name=addAll]").each(function (i, x) {
                if ($(x).prop('checked')) {
                    previousStateAllCheckedCities.push($(x).data('name'));
                }
                previousStateCities.push($(x).data('name'));
            });
            var $selection = $("#city");
            $.each($("input[name=allstates]"), function (index, item) {
                var params = {};
                if ($(item).is(":checked")) {
                    params["state"] = item.value;
                }
                if (params["state"]) {
                    getStateCities(params, $selection.data("path"), params["state"].substring(params["state"].lastIndexOf('/') + 1, params["state"].length), $(this).parent().text().trim());
                }
            });
            var template = Handlebars.compile($("#city-template").html());
            $selection.empty();
            $selection.append(template(stateCities));
            if (data && data.cities) {
                $.each(data.cities, function (idx, city) {
                    $("input[value='" + city + "']").prop("checked", true).trigger("change");
                });
            } else {
                $.each(selectedCities, function (idx, selectedCities) {
                    $("input[value='" + $(selectedCities).val() + "']").prop("checked", true).trigger("change");
                    ;
                });
                $.each(stateCities, function (idx, item) {
                    if (($.inArray(item.stateName, previousStateCities) >= 0 && $.inArray(item.stateName, previousStateAllCheckedCities) >= 0) || !($.inArray(item.stateName, previousStateCities) >= 0)) {
                        $("input[data-name=" + item.stateName + "]").prop("checked", true).trigger("change");
                    }
                });
            }

            $(".stateCountry div.customised-dropdown .dropdown-menu").trigger("change");

        });

        $(document).on("change", "div.customised-dropdown .dropdown-menu", function (event) {
            var $parent = $(event.target).closest("div.customised-dropdown");
            var checkedSectors = $parent.find("input[type=checkbox]:checked");
            var counter = 0;
            var button = $parent.find("button.dropdown-toggle");
            if (checkedSectors && checkedSectors.length > 0) {
                $.each(checkedSectors, function (idx, sector) {
                    if ($(sector).attr("name") != "addAll") {
                        counter++;
                    }
                });
                if (button.parents('.ams-application-form').length > 0) {
                    if (button.siblings('#relevantIndustry').size() > 0) {
                        button.html(counter + " Industries selected");
                    } else {
                        button.html(counter + " Services selected");
                    }
                } else if (button.parents('.stateConfigForm').length > 0) {
                    button.html(counter + " Type(s) selected");
                } else if (button.parents('#pushNotificationForm').length > 0 && button.siblings('#states').size() > 0) {
                    button.html(counter + " State(s) selected");
                } else if (button.parents('#pushNotificationForm').length > 0 && button.siblings('#city').size() > 0) {
                    if (counter === 1) {
                        button.html(counter + " City selected");
                    } else {
                        button.html(counter + " Citie(s) selected");
                    }
                }
                else {
                    button.html(counter + " Sector(s) selected");
                }
            } else {
                if (button.parents('#pushNotificationForm').length > 0 && button.siblings('#states').size() > 0) {
                    button.html("Select States");
                } else if (button.parents('#pushNotificationForm').length > 0 && button.siblings('#city').size() > 0) {
                    button.html("Select Cities");
                } else {
                    button.html("Select Sectors");
                }
            }
        });

        function getIndustrySectors(params, apiPath, sector_name, name) {
            var industry = {};
            industry["sectorName"] = sector_name;
            industry["name"] = name;
            $.ajax({
                url: apiPath,
                type: 'GET',
                data: params,
                async: false,
                success: function (data) {
                    var sectors = [];
                    $.each(data, function (index, item) {
                        var sector = {};
                        sector["value"] = item.value;
                        sector["name"] = item.text;
                        sectors.push(sector);
                    });
                    industry["sectors"] = sectors;
                    industrySectors.push(industry);
                }, error: function (data) {
                    console.log("Error while loading options");
                }
            });
        }

        function getStateCities(params, apiPath, state_name, name) {
            var states = {};
            states["stateName"] = state_name;
            states["name"] = name;
            $.ajax({
                url: apiPath,
                type: 'GET',
                data: params,
                async: false,
                success: function (data) {
                    var cities = [];
                    $.each(data, function (index, item) {
                        var city = {};
                        city["value"] = item.value;
                        city["name"] = item.text;
                        cities.push(city);
                    });
                    states["cities"] = cities;
                    stateCities.push(states);
                }, error: function (data) {
                    console.log("Error while loading options");
                }
            });
        }

        $(document).on('change', 'form.persona-profile-form select[name=ministry]', function (event) {
            var $target = $(event.target);
            var params = {};
            params["tag"] = $target.val();
            var $selection = $("form.persona-profile-form select[name=department]");
            setList(params, $selection.data("path"), $selection);
        });


        $(document).on("change", ".customised-dropdown input", function (event) {
            var $dropdown = $(event.target).closest(".customised-dropdown");
            var selectedOptions = $dropdown.find("input:checked");
            var list = $dropdown.find(".list-inline");
            list.find('li').remove();
            var len = selectedOptions.length;
            if (len == 0) {
                list.css("display", "none");
            }
            else
                list.css("display", "block");
            $.each(selectedOptions, function (index, item) {
                var text = $(item).data("text") + ((index != len - 1) ? "," : "");
                list.append("<li><span>" + text + "</span></li>");
            });
        });

        function addLocation(data) {
            var formData = data || {};
            var $locationStateId = $("form.persona-profile-form select[name=state]");
            var $locationCityId = $("form.persona-profile-form select[name=city]");
            formData["location"] = {};
            formData["location"]["country"] = {};
            formData["location"]["country"]["id"] = store.getItem("country");
            formData["location"]["state"] = {};
            formData["location"]["state"]["id"] = $locationStateId.val();
            errorMappingObj["location.state"] = $locationStateId[0];
            formData["location"]["city"] = {};
            formData["location"]["city"]["id"] = $locationCityId.val();
            errorMappingObj["location.city"] = $locationCityId[0];

            return formData;
        }

        function addAgencyDetails(data) {
            var formData = data || {};
            var $agencyMinistry = $("form.persona-profile-form select[name=ministry]");
            var $agencyDepartment = $("form.persona-profile-form select[name=department]");
            formData["agency"] = {};
            formData["agency"]["ministry"] = {};
            formData["agency"]["ministry"]["id"] = $agencyMinistry.val();
            errorMappingObj["agency.ministry"] = $agencyMinistry[0];
            formData["agency"]["department"] = {};
            formData["agency"]["department"]["id"] = $agencyDepartment.val();
            errorMappingObj["agency.department"] = $agencyDepartment[0];
            return formData;
        }

        $(document).on('click', '.repeat-container .repeat-remove', function (event) {
            var $target = $(event.target);
            var item = $target.closest('.repeat-container').children('.repeat-fields');
            $target.closest(".repeat-container").find(".repeat-add").removeAttr("disabled").show();
            var newItem;
            if (item && item.length > 1) {
                var repeatField = $target.closest(".repeat-fields");
                if ($target.parents('.ams-application-form').length > 0) {
                    newItem = $.grep(item, function (value) {
                        return $(value).attr('id') != repeatField.attr('id');
                    });
                    if ((newItem.length < item.length) && newItem.length > 0 && $target.closest('.repeat-container').find('.repeat-add').length == 0) {
                        $target.closest('.repeat-container').append('<input type="button" class="repeat-add" value="Add More">');
                    }
                }
                repeatField.remove();
            } else {
                var data = $target.closest(".repeat-fields");
                if (data) {
                    clearElements(data);
                    data.attr("id", $.now());
                    var repeatFileUploads = data.find(".file-upload");
                    $.each(repeatFileUploads, function (index, item) {
                        $item = $(item);
                        $item.replaceWith(fileuploads[$item.data('name')].clone());
                    });
                }
            }
        });

        function addContactDetails(data) {
            var formData = data || {};
            var contacts = [];
            var contact = {};
            var designation = $("form.persona-profile-form input[name=designation]");
            var emailId = $("form.persona-profile-form input[name=emailId]");
            var firstName = $("form.persona-profile-form input[name=firstName]");
            var landlineNumber = $("form.persona-profile-form input[name=landlineNumber]");
            var lastName = $("form.persona-profile-form input[name=lastName]");
            var mobileNumber = $("form.persona-profile-form input[name=mobileNumber]");
            var website = $("form.persona-profile-form input[name=website]");
            var socialMediaAccountURL = $("form.persona-profile-form input[name=socialMediaAccountURL]");

            errorMappingObj["contacts[0].designation"] = designation[0];
            errorMappingObj["contacts[0].emailId"] = emailId[0];
            errorMappingObj["contacts[0].firstName"] = firstName[0];
            errorMappingObj["contacts[0].landlineNumber"] = landlineNumber[0];
            errorMappingObj["contacts[0].lastName"] = lastName[0];
            errorMappingObj["contacts[0].mobileNumber"] = mobileNumber[0];
            errorMappingObj["contacts[0].website"] = website[0];
            errorMappingObj["contacts[0].socialMediaAccountURL"] = socialMediaAccountURL[0];

            contact["designation"] = designation.val() ? designation.val() : null;
            contact["emailId"] = emailId.val() ? emailId.val() : null;
            contact["firstName"] = firstName.val() ? firstName.val() : null;
            contact["landlineNumber"] = landlineNumber.val() ? landlineNumber.val() : null;
            contact["lastName"] = lastName.val() ? lastName.val() : null;
            contact["mobileNumber"] = mobileNumber.val() ? mobileNumber.val() : null;
            contact["website"] = website.val() ? website.val() : null;
            contact["socialMediaAccountURL"] = socialMediaAccountURL.val() ? socialMediaAccountURL.val() : null;
            contacts.push(contact);
            formData["contacts"] = contacts;
            return formData;
        }

        function addPortfolios(data) {
            var formData = data || {};
            var portfolios = null;
            if($("input[type=checkbox][name=hasStories]").is(":checked")){
                var portfolioBriefs = $("form.persona-profile-form textarea[name=brief]");
                var sihProfileURLs = $("form.persona-profile-form input[name=sihProfileUrl]");
                var startupNames = $("form.persona-profile-form input[name=startupName]");
                var urls = $("form.persona-profile-form input[name=url]");
                var startupEntryDates = $("form.persona-profile-form input[name=startupEntryDate]");
                var startupLogos = $("form.persona-profile-form input[name=startupLogo]");
                var guidanceAreass = $("form.persona-profile-form textarea[name=guidanceAreas]");


                if (portfolioBriefs.length > 0) {
                    portfolios = data.portfolios || [];
                    $.each(portfolioBriefs, function (idx, portfolioBrief) {
                        var portfolio = {};
                        portfolio["brief"] = $(portfolioBriefs[idx]).val() ? $(portfolioBriefs[idx]).val() : null;
                        portfolio["sihProfileUrl"] = $(sihProfileURLs[idx]).val() ? $(sihProfileURLs[idx]).val() : null;
                        portfolio["startupName"] = $(startupNames[idx]).val() ? $(startupNames[idx]).val() : null;
                        portfolio["url"] = $(urls[idx]).val() ? $(urls[idx]).val() : null;
                        portfolio["startupEntryDate"] = $(startupEntryDates[idx]).val() ? $(startupEntryDates[idx]).val() : null;
                        if (startupLogos.length && portfolioImages["startupLogo"] && portfolioImages["startupLogo"][$(startupLogos[idx]).closest("div.repeat-fields").first().attr("id")]){
                            portfolio["startupLogo"] = portfolioImages["startupLogo"][$(startupLogos[idx]).closest("div.repeat-fields").first().attr("id")];
                        }
                        portfolio["guidanceAreas"] = $(guidanceAreass[idx]).val() ? $(guidanceAreass[idx]).val() : null;
                        portfolios.push(portfolio);
                    });
                }
                errorMappingObj["portfolios.brief"] = portfolioBriefs[0];
                errorMappingObj["portfolios.sihProfileUrl"] = sihProfileURLs[0];
                errorMappingObj["portfolios.startupName"] = startupNames[0];
                errorMappingObj["portfolios.url"] = urls[0];
                errorMappingObj["portfolios.startupEntryDate"] = startupEntryDates[0];
                errorMappingObj["portfolios.startupLogo"] = startupLogos[0];
                errorMappingObj["portfolios.guidanceAreas"] = guidanceAreass[0];

            }
            formData["portfolios"] = portfolios;
            return formData;
        }

        function addCenterLocation(data){
            var formData = data || {};
            var centerLocations = null;
            if($("input[type=checkbox][name=hasStories]").is(":checked")){
                var incubatorCenterLocationAddresses = $("form.persona-profile-form input[name=incubatorCenterLocationAddress]");
                var incubationCenterLocations = $("form.persona-profile-form input[name=incubationCenterLocation]");


                if (incubationCenterLocations.length > 0) {
                    centerLocations = data.centerLocations || [];
                    $.each(incubationCenterLocations, function (idx, incubationCenterLocation) {
                        var centerLocation = {};
                        centerLocation["incubatorCenterLocationAddress"] = $(incubatorCenterLocationAddresses[idx]).val() ? $(incubatorCenterLocationAddresses[idx]).val() : null;
                        centerLocation["incubationCenterLocation"] = $(incubationCenterLocations[idx]).val() ? $(incubationCenterLocations[idx]).val() : null;
                        centerLocations.push(centerLocation);
                    });
                }
                errorMappingObj["portfolios.incubatorCenterLocationAddress"] = incubatorCenterLocationAddresses[0];
                errorMappingObj["portfolios.incubationCenterLocation"] = incubationCenterLocations[0];

            }
            formData["centerLocations"] = centerLocations;
            return formData;

        }

        $(document).on("click", ".add", function (event) {
            var $target = $(event.target);
            var clone = $target.closest(".optionBox").find(".block:first").clone();
            clone.find("input,textarea").val("");
            clone.append("<span class='remove'>Remove</span></div>");
            $target.closest(".optionBox").find(".block:last").before(clone);
            $(document).on('click', '.remove', function () {
                $(this).parent('.block').remove();
            });
        });

        $(document).on("click", "select.multi-select", function (event) {
            var $target = $(event.target);
            var $select = $target.siblings(".select2");
            if (!$select.hasClass("select2-container--open")) {
                $select.find(".select2-selection--multiple").trigger("click");
            }
        });

        $(document).on("keyup", "form.persona-profile-form input[type=number]", function (event) {
            var $target = $(event.target);
            var value = parseInt($target.val());
            var min = $target.attr("min");
            var max = $target.attr("max");
            if (!$.isNumeric(value)) {
                $target.val("");
            }
            else if (min && value < parseInt(min)) {
                $target.val(min);
            }
            else if (max && value > parseInt(max)) {
                $target.val(max);
            }
        });

        $(document).on("click", ".cinSearch", function () {
            var $target = $("form.persona-profile-form input[name=cin]");
            if (!$target.is(":disabled")) getLegalName($target);
        });

        var legalName = false;

        function getLegalName($target, matchLegalName, $ctaTarget, submitCta) {
            if ($target.val()) {
                verifyCIN($target, matchLegalName, $ctaTarget, submitCta);
            }
            else {
                showErrorState($target, true);
                isValidated = false;
                $("form.persona-profile-form input[name=legalName]").val("");
            }
        }

        function verifyCIN($target, matchLegalName, $ctaTarget, submitCta) {
            $('#modal-loader').modal("show");
            $.ajax({
                type: "POST",
                dataType: "json",
                url: "https://recognition.startupindia.gov.in/webapi/webservice.php?rquest=getincorporation",
                data: {"incorp_no": $target.val().trim()},
                success: function (response) {
                    legalName = response.nameEntity;
                    if (legalName) {
                        var updatedLegalName = $("form.persona-profile-form input[name=legalName]").val();
                        if (matchLegalName && updatedLegalName != "" && updatedLegalName.trim() != legalName.trim()) {
                            $target.closest(".form-group").addClass("has-error");
                            $target.closest(".form-group").find('.help-block')
                                .html("Legal-names do not match. Please check and validate CIN.");
                            isValidated = false;
                            if ($ctaTarget) submitErrors();
                        } else {
                            $target.closest(".form-group").removeClass("has-error");
                            $target.closest(".form-group").find('.help-block').html("");
                            $("form.persona-profile-form input[name=legalName]").val(legalName);
                            isValidated = true;
                            if ($ctaTarget) {
                                if (submitCta) submitForm($ctaTarget);
                            }
                        }
                    }
                    else {
                        var erroMsg = "";
                        if(response._resultflag == "0"){
                            erroMsg = "We are not able to validate CIN right now. Please try again after some time."
                        }else{
                            erroMsg = "Incorrect CIN";
                        }
                        $target.closest(".form-group").addClass("has-error");
                        $target.closest(".form-group").find('.help-block').html("Incorrect CIN");
                        $("form.persona-profile-form input[name=legalName]").val("");
                        isValidated = false;
                        if ($ctaTarget) submitErrors();
                    }
                    $('#modal-loader').modal("hide");
                },
                error: function (response) {
                    legalName = false;
                    $target.closest(".form-group").addClass("has-error");
                    $target.closest(".form-group").find('.help-block').html("We are facing problems fetching your CIN details. Please try after some time.");
                    $("form.persona-profile-form input[name=legalName]").val("");
                    isValidated = false;
                    if ($ctaTarget) submitErrors();
                    $('#modal-loader').modal("hide");
                }
            });
        }

        $(document).on("click", "input[name=TiEOrLetsVenture]", function (event) {
            var $tieEl = $("input[name=TiEOrLetsVenture]");
            var radioVal = $tieEl.filter(':checked').val();
            var $linkedInField = $("input[name='linkedInUrl']").closest(".row").find("label.text-md-right");
            if (radioVal == "others" && $tieEl) {
                $("textarea[name='otherThanTieLVDescription'].richTextArea").summernote("code", store.getItem("otherThanTieLVDescription"));
                $("input[name='linkedInUrl']").prop('required', true);
                if ($linkedInField.children("sup.required").length == 0) {
                    $linkedInField.html($linkedInField.text() + "<sup class='required'>*</sup>")
                }
                tieOrlvSpecificMessage(null, null, false);
            } else {
                var supTag = $linkedInField.find('sup');
                if (supTag) {
                    supTag.remove();
                }
            }
        });

        $(document).on("click", "input[type=button][name=verify-tie-btn]", function (event) {
            if (validate($(event.target))) {
                var $buttonFormGroup = $(event.target).closest(".form-group");
                var formData = {};
                formData["email"] = $("input[name=tie_email]").val();
                formData["password"] = $("input[name=tie_password]").val();
                $.ajax({
                    url: SIH.getEndPoint("/api/common/tie"),
                    async: false,
                    type: "POST",
                    headers: {"Content-Type": "application/json"},
                    data: JSON.stringify(formData),
                    contentType: "application/json",
                    dataType: 'json',
                    success: function (response) {
                        var store = ContextHub.getStore("sih_user");
                        if (response && !response.error && store) {
                            store.setItem("tieVerified", true);
                            store.setItem("letsVentureVerified", false);
                            $("input[name=next]").removeAttr("disabled");
                            tieOrlvSpecificMessage($buttonFormGroup, null, false);
                            $('.step-next-wrap input.step-next').show();
                        } else {
                            tieOrlvSpecificMessage($buttonFormGroup, "TiE unverified", true);
                            bootbox.alert(response.error);
                            store.setItem("tieVerified", false);
                        }
                    }, error: function (response) {
                        tieOrlvSpecificMessage($buttonFormGroup, "TiE unverified", true);
                        bootbox.alert("Error in verification from TIE");
                        store.setItem("tieVerified", false);
                    }
                })
            }
        });

        $(document).on("click", "input[type=button][name=verify-venture-btn]", function (event) {
            var email = $("input[name=ventureEmail]").val();
            store.setItem("letsVentureVerified", false);
            if (validate($(event.target))) {
                $('#modal-loader').modal("show");
                var $buttonFormGroup = $(event.target).closest(".form-group");
                $.ajax({
                    url: SIH.getEndPoint("/api/common/lv/otp/generate"),
                    async: false,
                    type: "POST",
                    data: email,
                    contentType: "application/json",
                    dataType: 'json',
                    success: function (response) {
                        $('#modal-loader').modal("hide");
                        var store = ContextHub.getStore("sih_user");
                        store.setItem("otpSent", true);
                        tieOrlvSpecificMessage($buttonFormGroup, null, false);
                        bootbox.alert("OTP has been sent.");
                    }, error: function (response) {
                        $('#modal-loader').modal("hide");
                        if (response.responseJSON) {
                            bootbox.alert(response.responseJSON.message);
                        }
                        else {
                            bootbox.alert("Error from LetsVenture. Please try later.");
                        }
                        tieOrlvSpecificMessage($buttonFormGroup, "LV unverified", true);
                        store.setItem("otpSent", false);
                    }
                });
            }
        });

        $(document).on("click", "input[type=button][name=verify-otp-btn]", function (event) {
            var otp = $("input[name=otp]").val();
            if (otp) {
                $('#modal-loader').modal("show");
                $.ajax({
                    url: SIH.getEndPoint("/api/common/lv/otp/verify"),
                    async: false,
                    type: "POST",
                    data: otp,
                    contentType: "application/json",
                    dataType: 'json',
                    success: function (response) {
                        $('#modal-loader').modal("hide");
                        var store = ContextHub.getStore("sih_user");
                        store.setItem("letsVentureVerified", true);
                        store.setItem("tieVerified", false);
                        alert("OTP is successfully verified.");
                        $("input[name=next]").removeAttr("disabled");
                    },
                    error: function (response) {
                        $('#modal-loader').modal("hide");
                        if (response.responseJSON) {
                            alert(response.responseJSON.message);
                        }
                        else {
                            alert("Unable to verify OTP. Please try later.");
                        }
                        store.setItem("letsVentureVerified", false);
                    }
                });
            }
        });
        updateProfileSpecific();
    });

     function updateProfileSpecific() {
            if(isUpdateProfile()){
                $('.to-first-step').addClass('hidden');
                $("input[type=checkbox][name=enableTNC]").prop("checked",false);
                $('.step-next-wrap input.submit-cta').attr("disabled","disabled");
            }
        }
    function setState(country) {
        var params = {};
        params["country"] = country;
        var $selection = $("#state");
        var currentDomain = window.location.hostname;
        setList(params, $selection.data("path"), $selection);
        if (currentDomain != $('.notification-container').attr('main-domain')) {
            //TODO: getStateDomains() not available here
            var stateTag = SIH.getStateDomains()[currentDomain];
            if (stateTag) {
                $selection.val(stateTag).attr('disabled', 'true');
            }
        }

        $(document).on('change', '#state', function (event, triggered) {
            var $target = $(event.target);
            var params = {};
            var state = $target.val(), previousState = store.getItem("state");
            if (isUpdateProfile() && state != previousState && !triggered && !switchProfile) {
                var stateAlertMsg = $("#new-persona-content").data("statemessage");
                if (stateAlertMsg) bootbox.alert(stateAlertMsg);
            }
            params["state"] = state;
            var $selection = $("#city");
            setList(params, $selection.data("path"), $selection);
        });

        $(".carousel-indicators li").click(function () {
            $(".ytvideo").each(function () {
                var playerId = $(this).attr("id");
                var player = YT.get(playerId);
                player.pauseVideo();
            });
            $(".htmlvideo").each(function () {
                $(this).trigger("pause");
            });
        });
    }

    function showErrorState(el, hasError) {
        if (hasError) {
            el.siblings('.help-block').show();
            el.closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field cannot be left Blank.");
        } else {
            el.closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
        }
    }

    function reload() {
        var scripts = $("script");
        if (typeof scripts === "string") {
            scripts = JSON.parse(scripts);
        }
        $.each(scripts, function (index, item) {
            var src = $(item).attr("src");
            if (!src) {
                if (!$(item).attr("id")) {
                    var text = $(item).text();
                    $(item).remove();
                    $("<script>").text(text).appendTo("head");
                }
            }
        });
    }

    function countryChangeCallback(selection) {
        if (window.location.hostname != $('.notification-container').attr('main-domain')) {
            $(selection).val(INDIA_COUNTRY_ID).attr('disabled', 'true');
        }
        $(selection).trigger("change");
    }

    var jsonData = [];
    function setList(params, apiPath, $selection, callback) {

        if (apiPath) {

            apiPath.indexOf("stakeholders") > -1
                ? $selection.find('option').remove()
                : $selection.find('option').not(":first").remove();

            $.ajax({
                url: apiPath,
                type: 'GET',
                data: params,
                async: false,
                success: function (data) {
                    if (typeof data == "string") {
                        data = JSON.parse(data);

                    }
                    data.sort(function(a,b){return a[1] - b[1]});

                    var targetKey = $selection.attr('id');
                    var obj = {};

                    obj[targetKey] = data;
                    var isExist = false;
                    $.each(jsonData, function(index, current){
                        if(current[targetKey]){
                            jsonData[index] = obj;
                            isExist = true;
                        }
                    });
                    if(!isExist){
                        jsonData.push(obj);
                    }

                    $.each(data, function (index, item) {
                        var o = new Option(item.text, item.value);
                        $selection.append(o);
                    });
                    if (callback) {
                        callback($selection);
                    }
                }, error: function (data) {
                    console.log("Error while loading options");
                }
            });
        }
    }

    function setHeaderCountryList() {
        var params = {};
        var apiPath = "/services/tags/countries.json";
        var $selectionList = $("#headerCountry").find(".dropdown-content");
        var $selectionSpan = $("#headerCountry").find("#headerCountryName");
        $selectionList.find('li').remove();
        if (apiPath && $("#headerCountry").length) {
            $.ajax({
                url: apiPath,
                type: 'GET',
                data: params,
                async: false,
                success: function (data) {
                    if (typeof data == "string") {
                        data = JSON.parse(data);
                    }
                    $.each(data, function (index, item) {
                        var li = "<li><a class='headerCountryLink' href='#' data-value='" + item.value + "'>" + item.text + "</a></li>";
                        $selectionList.append(li);
                    });
                    if (!isUpdateProfile()) {
                        var stepsPath = store.getItem("personaStepsPath");
                        if (stepsPath) personaSelection(stepsPath);
                    }
                    $(".headerCountryLink").click(function () {
                        setHeaderCountry($(this), true);
                        $("#inner-content-container").html("<div class='persona-form-message'><h2>Please select your Role</h2></div>");
                        setHeaderRolesList($(this).data("value"));
                    });
                }, error: function (data) {
                    console.log("Error while loading countries");
                }
            });
        }
    }


    function setHeaderRolesList(country) {
        var nationality = country === INDIA_COUNTRY_ID ? "persona" : "international-persona";
        var params = {"rootPath": "/content/sih/en/" + nationality};
        var apiPath = "/bin/services/personaChooser";
        var $selectionList = $("#headerRole").find(".dropdown-content");
        var $selectionSpan = $("#headerRole").find("#headerRoleName");
        $selectionSpan.text("Select");
        $selectionList.find('li').remove();
        if (apiPath && $("#headerRole").length) {
            $.ajax({
                url: apiPath,
                type: 'GET',
                data: params,
                async: false,
                success: function (data) {
                    if (typeof data == "string") {
                        data = JSON.parse(data);
                    }
                    $.each(data, function (index, personaBlock) {
                        if (!personaBlock.options.length) {
                            var li = "<li><a class='headerRoleLink' href='#' data-persona-steps-path='" + personaBlock.path + "' " +
                                "data-value='" + personaBlock.name + "'>" + personaBlock.title + "</a></li>";
                            $selectionList.append(li);
                        } else {
                            $.each(personaBlock.options, function (index, option) {
                                if (!option.options.length) {
                                    li = "<li><a class='headerRoleLink' href='#' data-persona-steps-path='" + option.contentPath + "' " +
                                        "data-value='" + option.value + "'>" + option.text + "</a></li>";
                                    $selectionList.append(li);
                                } else {
                                    $.each(option.options, function (index, subOption) {
                                        li = "<li><a class='headerRoleLink' href='#' data-persona-steps-path='" + subOption.contentPath + "' " +
                                            "data-value='" + subOption.value + "'>" + subOption.text + "</a></li>";
                                        $selectionList.append(li);
                                    });
                                }
                            });
                        }
                    });
                    $(".headerRoleLink").click(function () {
                        if(isUpdateProfile() && $(this).data("switch") == "1"){
                            if(confirm("Please note that previous forms will not be accessible anymore.")){
                                switchProfile = true;
                                setHeaderRole($(this), true, true);
                                $(".persona-header-dropdown .header-language .dropdown").css({'pointer-events': 'none'});
                                $(".persona-header-title").append('<button class="btn btn-danger" id="switchButton"><i class="fa fa-arrow-left"></i>Revert to Individual profile</button>');
                                $("#switchButton").click(function () {
                                    window.location.reload();
                                });
                            }
                        }else {
                            setHeaderRole($(this), true, true);
                        }
                    });
                    // form slider

                    formSlider();
                    nextButtonValidation();
                    previousButton();
                    otherButtonValidation();

                }, error: function (data) {
                    console.log("Error while loading roles");
                }
            });
        }
    }

    function setHeaderCountry($selectedHeaderCountry, triggered) {
        $(".headerCountryLink").show();
        $selectedHeaderCountry.hide();
        $("#headerCountryName").html($selectedHeaderCountry.text());
        if (triggered) {
            store.setItem("personaCountry", $selectedHeaderCountry.data("value"));
            store.setItem("country", $selectedHeaderCountry.data("value"));
        }
        // var countryImg = "/etc/designs/invest-india/investindialibs/images/persona-country/" + country + ".png";
        // $("#headerCountryImg").attr("src", countryImg);
    }

    function showMinMaxErrorState(el, hasError) {
        if (hasError) {
            el.siblings('.help-block').show();
            el.closest(".form-group").addClass("has-error").find("span.help-block").first()
                .html("This field value must have length between "+el.attr("minlength") + " to " + el.attr("maxlength"));
        } else {
            el.closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
        }
    }

    function validateNext() {
        var requiredfiled = $('.form-slide-container .row-container.active').find('.required');
        var validFlag = true;
        $.each(requiredfiled, function (index, item) {
            var element = $(item).closest('.form-group').find(".form-control:not(.richTextarea,.customised-dropdown):visible");
            if (element && element.length > 0 && !element.closest(".modal").length && !element.hasClass("mentorshipComp-hidden")) {
                if (element.attr("type") === "radio") {
                    if (element.is(':checked')) {
                        element.closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
                    }
                    else {
                        element.closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field cannot be left Blank.");
                        validFlag = false;
                    }
                }
                else if (element.attr("type") === "checkbox") {
                    if (element.is(':checked')) {
                        element.closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
                    }
                    else {
                        element.closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field cannot be left Blank.");
                        validFlag = false;
                    }
                }
                else if (!element.val()){
                    validFlag = false;
                    showErrorState(element, true);
                }
                else if (element.attr("minlength") > element.val().length || element.val().length > element.attr("maxlength")){
                    validFlag = false;
                    showMinMaxErrorState(element, true);
                }
                else {
                    showErrorState(element, false);
                }
            }

        });

        if(isUpdateProfile()){
            var updateProfileTNC= $('.form-slide-container .row-container').find("input[name=enableTNC]");
            if(updateProfileTNC && updateProfileTNC.length>0){
                updateProfileTNC.prop("checked",false);
            }
        }

       var multiSelect= $('.form-slide-container .row-container.active').find('select.multi-select');
            $.each(multiSelect,function (index,item) {
                    var el =$(item);
                    if(el.is(":visible")) {
                        var value = el.val();
                          if (!value || value.length == '0') {
                              $(el).closest('.form-group').addClass("has-error").find("span.help-block").html('This field cannot be left Blank.');
                            validFlag = false;
                        }
                    }
            });

        var richTextAreas = $('.form-control.richTextarea');
        $.each(richTextAreas, function (index, item) {
                var el = $(item);
                if (el.closest('.form-group').find('sup.required').length > 0 && el.closest('.form-group').is(":visible")) {
                    var note = el.val().trim();
                    var tempStr = el.val().replace(/<p>*/g,'').replace(/<\/p>*/g,'').replace(/(&nbsp;)*/g, "").replace(/<br>*/g, "");
                    if (el.attr("minlength") > tempStr.length || tempStr.length > el.attr("maxlength")){
                        validFlag = false;
                        showMinMaxErrorState(el, true);
                    } else if (note.length > 0 && !el.summernote('isEmpty') && tempStr.trim().length > 0) {
                        el.siblings('.note-editor.note-frame').removeClass('note-has-error').addClass('note-writer-text');
                        showErrorState(el, false);
                    } else {
                        validFlag = false;
                        el.siblings('.note-editor.note-frame').addClass('note-has-error').removeClass('note-writer-text');
                        showErrorState(el, true);
                    }
                }
        });

        var regexValidatedfields = $('div.section-block .regex-val:visible');
        $.each(regexValidatedfields, function (index, item) {
                var element = $(item);
                var re = new RegExp(element.attr("regex"));
                if (element.val() && !re.test(element.val())) {
                    validFlag = false;
                    //showErrorState(element, true);
                    element.closest(".form-group").addClass("has-error");
                    element.siblings(".regex-msg").show();
                } else {
                    if (!(element.closest(".form-group").has("sup.required") && !element.val())) {
                        showErrorState(element, false);
                    }
                    element.siblings(".regex-msg").hide();
                }
        });

        var customizedDropDown = $('.form-control.customised-dropdown:visible');
        $.each(customizedDropDown, function (index, item) {
                var el = $(item);
                var selectedIndustries = $("select[name=industry]").val();

                if (!selectedIndustries || selectedIndustries.length === 0) {
                    isValidated = false;
                    showErrorState(el, true);
                } else {
                    $.each(selectedIndustries, function (idx, selectedIndustry) {
                        var selectedIndustryArr = selectedIndustry.split("/");
                        var industryName = selectedIndustryArr[selectedIndustryArr.length - 1];
                        if (el.find("ul#sector").first().find("input[name=" + industryName + "][type=checkbox]:checked").length === 0) {
                            isValidated = false;
                            showErrorState(el, true, $("#sector").data("requiredMessage"));
                        } else {
                            showErrorState(el, false);
                        }
                    });
                }
        });

        return validFlag;
    }
    function setHeaderRole($selectedHeaderRole, headerRoleChanged, loadPersona) {
        $(".headerRoleLink").show();
        var personaStepsPath = $selectedHeaderRole.data("personaStepsPath");
        var role = $selectedHeaderRole.data("value");
        var country = store.getItem('')
        $selectedHeaderRole.hide();
        $("#headerRoleName").html($selectedHeaderRole.text());
        store.setItem("personatype", role);
        if (loadPersona){
            store.setItem("personaStepsPath", personaStepsPath);
            personaSelection(personaStepsPath);
        }
        // var roleImg = "/etc/designs/invest-india/investindialibs/images/persona-role/" + role + ".png";
        // $("#headerRoleImg").attr("src", roleImg);
    }

    function personaSelection(stepsPath) {
        store.setItem("isThereBusinessPlan", false);
        store.setItem("dippCertified", false);
        if (isUpdateProfile() && !store.getItem("sihRegisteredUser")) {
            var loginTime = store.getItem("loginTime");
            var noProfile = store.getItem("no-profile");
            store.reset();
            store.setItem("loginTime", loginTime);
            store.setItem("no-profile", noProfile);
            fetchOAuthData();
        }
        postPersonaSelection(stepsPath);
    }

    function fetchOAuthData() {
        var codeParam = getParameterByName("uid");
        if (codeParam) {
            var oauthApi = SIH.getEndPoint("/api/noauth/oauth2/details?code=" + codeParam);
            $.ajax({
                url: oauthApi,
                async: false,
                type: 'GET',
                success: function (data) {
                    addOAuthDataToContextHub(data);
                },
                error: function (data) {
                    console.log("Error while adding data to ContextHub");
                }

            });
        }
    }

    function addOAuthDataToContextHub(data) {
        if (data) {
            var store = ContextHub.getStore("sih_user");
            var obj = {};
            obj["uid"] = data["uid"];
            obj["dobYear"] = data["field_dob_year"];
            obj["dobMonth"] = data["field_dob_month"];
            obj["dobDate"] = data["field_dob_date"];
            obj["fullName"] = data["fullName"];
            obj["email"] = data["mail"];
            obj["registered"] = data["registered"];
            if (data["sms_user"]) {
                obj["phone"] = data["sms_user"]["mobileNumber"];
            }
            obj["country"] = $.cookie("countryTag") ? $.cookie("countryTag") : INDIA_COUNTRY_ID;
            obj["state"] = data["state"];

            for (var key in obj) {
                store.setItem(key, obj["" + key]);
            }
        }
    }

    function postPersonaSelection(personaStepsPath) {
        getPersonaSteps(personaStepsPath);
    }
    function getPersonaSteps(path) {
        $('#modal-loader').modal("show");
        $.ajax({
            url: path + "/_jcr_content.html?wcmmode=disabled",
            type: 'GET',
            async: false,
            success: function (data) {
                var doc = (new DOMParser()).parseFromString(data, "text/html");
                $("#inner-content-container").html(doc.body.getElementsByClassName("inner-content"));
                if(!isUpdateProfile()) {
                    //$("#persona-header-title-container").html(doc.body.getElementsByClassName("persona-header-title"));
                    var personatype = store.getItem('personatype');
                    $('#headerRole').find('.user-type').addClass(personatype);
                }
                countryTag = $.cookie("countryTag") ? $.cookie("countryTag") : INDIA_COUNTRY_ID;
                $(".persona-dropdown-wrapper").show();
                if (!isUpdateProfile()) setHeaderFields();
                if (store.getItem('country') == 'India' || store.getItem('country') == 'sih:location/india') {
                    setState(store.getItem("country"));
                    $("#state").trigger("change", true);
                }
                if (store && store.getItem("personatype") == "government-body") {
                    var $selection = $("form.persona-profile-form select[name=ministry]");
                    setList(null, $selection.data("path"), $selection);
                    $selection.trigger("change");
                }
//                if(store &&store.getItem("personatype") === 'mentor'){
//                    $('.step-next-wrap input.step-next').hide();
//                }
                handleRoleRelatedChanges();
                mentorshipFormEvents();
                $("input[name=fullname]").val(store.getItem("fullName"));
                var emailStoreValue = store.getItem("email");
                if (!emailStoreValue || emailStoreValue == null) {
                    $("input[name=email]").parents(".baseformfield").hide();
                } else {
                    $("input[name=email]").val(emailStoreValue);
                }
                if (store.getItem("phone")) {
                    var $phone = $("input[name=phone]");
                    $phone.val(store.getItem("phone"));
                   // $phone.attr("disabled", "disabled")
                }

                doProcessingForTNC();
                moreInfoEvents();
                $('body').addClass('step-two');

                $('.new-persona-content .persona-profile-form .form-section-block').each(function(i){
                  if(i==0){
                  $(this).find('.section-block').slideDown();
                  $(this).find('.section-block-title').addClass('active');
                  $(this).find('.section-block-title').find('i').addClass('fa-minus');
                  $(this).find('.section-block-title').find('i').removeClass('fa-plus');
                }else{
                  return;
                }
                });
                $('.step-two .new-persona-content .persona-profile-form .section-block-title').click(function(){
                  $(this).toggleClass('active');
                  $(this).find('i').toggleClass('fa-minus fa-plus');
                  $(this).siblings('.section-block').slideToggle();
                  $(this).closest('.baseformfield').siblings('.baseformfield').find('.section-block-title').removeClass('active');
                  $(this).closest('.baseformfield').siblings('.baseformfield').find('.section-block-title').find('i').addClass('fa-plus');
                  $(this).closest('.baseformfield').siblings('.baseformfield').find('.section-block-title').find('i').removeClass('fa-minus');
                  $(this).closest('.baseformfield').siblings('.baseformfield').find('.section-block').slideUp();
                });
                $("body").removeClass('step-one');
            }, error: function (data) {
                console.log(data);
            }
        });
        reload();
        fileuploads = {};
        cloneFileUploads();

        setTimeout(function () {
            $('#modal-loader').modal("hide");
        }, 500);
    }

    $(document).on('click','.to-first-step',function (e) {
        if(!isUpdateProfile()) {
            store.setItem('personatype', '');
            store.setItem('personaStepsPath', '');
            location.reload(true);
        }
    });

    function moreInfoEvents(){
        $('.more-info').hover(function(event){
            $(this).addClass("active");
            $(this).find('.info.popover').show();
        },function(event){
            $('.info.popover').hide();
            $(".more-info").removeClass("active");
        });
    }
    function customUIHandling() {
        if((store.getItem("personatype") === 'startup')||(store.getItem("personatype") === 'individual')||(store.getItem("personatype") === 'individual-investor')||(store.getItem("personatype") === 'institutional-investor')||(store.getItem("personatype") === 'mentor')||(store.getItem("personatype") === 'incubator')||(store.getItem("personatype") === 'accelerator')||(store.getItem("personatype") === 'corporate')||(store.getItem("personatype") === 'government-body')){
            $('.persona-profile-form .note-editable.panel-body').css({'height':'204px'});
        }
    }
    $(document).on('change', 'input[name=addAll]', function (event) {
        var $target = $(event.target);
        var name = $target.data("name");
        var checkboxes = $("input[name=" + name + "]");
        if ($target.is(":checked")) {
            checkboxes.prop('checked', true);
        }
        else {
            checkboxes.prop('checked', false);
        }
    });
    $(document).on('change', '.addAll', function (event) {
        var $target = $(event.target);
        var allSelection = $target.closest(".addContainer").find("input[name=addAll]");
        if (!$target.is(":checked")) {
            allSelection.prop('checked', false);
        }
        var allCheckedInputs = $target.closest(".addContainer").find('input.addAll:checked').length;
        if (allCheckedInputs && (allCheckedInputs == $target.closest(".addContainer").find('input.addAll').length)) {
            allSelection.prop('checked', true);
        }
    });

    function getFocusArea(industry, sectors) {
        var focusArea = {};
        focusArea["industry"] = {};
        focusArea["industry"]["id"] = $(industry).val();
        focusArea["sectors"] = [];
        $.each(sectors, function (index, item) {
            var sector = {};
            sector["id"] = $(item).val();
            focusArea["sectors"].push(sector);
        });
        return focusArea;
    }

    function getLocationDetail(state, cities) {
        var location = {};
        location["state"] = {};
        location["state"]["id"] = $(state).val();
        location["cities"] = [];
        $.each(cities, function (index, item) {
            var city = {};
            city["id"] = $(item).val();
            location["cities"].push(city);
        });
        return location;
    }

    function addFocusAreas(data) {
        var formData = data || {};
        var focusAreas = [];
        var industries = $("#industry option:selected");
        errorMappingObj["focusArea.industry"] = $("#industry");
        errorMappingObj["focusArea.sector"] = $("#sector").siblings("button");
        $.each(industries, function (index, industry) {
            var indystryVal = industry.value;
            var sectorName = indystryVal.substring(indystryVal.lastIndexOf('/') + 1, indystryVal.length);
            var sectors = $("input[name=" + sectorName + "]:checked");
            var focusArea = getFocusArea(industry, sectors);
            focusAreas.push(focusArea);
        });
        formData["focusAreas"] = focusAreas;
        return formData;
    }

    function addLocationDetails(data) {
        var formData = data || {};
        var locations = [];
        errorMappingObj["locations.state"] = $("#states");
        errorMappingObj["location.city"] = $("#city").siblings("button");
        $.each($("input[name=allstates]"), function (index, item) {
            if ($(item).is(":checked")) {
                var stateVal = item.value;
                var stateName = stateVal.substring(stateVal.lastIndexOf('/') + 1, stateVal.length);
                var city = $("input[name=" + stateName + "]:checked");
                var location = getLocationDetail(item, city);
                locations.push(location);
            }
        });
        formData["locations"] = locations;
        return formData;
    }

    function populateFormErrors(response, updateProfile, $target, applicantErrorObj) {

        cleanErrorBlock();
        var responseJSON = response.responseJSON;
        $("div.form-group").removeClass("has-error");
        if (responseJSON) {
            var errorBlockUnOrderedList = $("div.error-block ul").first();
            errorBlockUnOrderedList.empty();
            $.each(responseJSON, function (idx, error) {
                var fieldName = error.field;
                if (fieldName && fieldName.indexOf("startup.") > -1) {
                    fieldName = fieldName.replace("startup.", "");
                }
                var liErrorMessage = "<li>" + error.defaultMessage + "</li>";
                if (fieldName) {
                    var $field;
                    if ($target.parents('.ams-application-form').length > 0) {
                        $field = amsApplication.errorMappingObj[fieldName];
                    } else if (applicantErrorObj) {
                        $field = applicantErrorObj[fieldName];
                    } else {
                        $field = errorMappingObj[fieldName];
                    }
                    if ($field) {
                        var formGroup = $($field).closest(".form-group");
                        if ($($field).is('textarea')) {
                            $($field).siblings('.note-editor').addClass('note-has-error');
                        }
                        if (formGroup && formGroup.length > 0) {
                            formGroup.addClass("has-error");
                            var $helpBlock = formGroup.find("span.help-block");
                            if ($helpBlock && $helpBlock.length > 0) {
                                $helpBlock.first().html(error.defaultMessage);
                            } else {
                                errorBlockUnOrderedList.append(liErrorMessage);
                            }
                        } else {
                            errorBlockUnOrderedList.append(liErrorMessage);
                        }
                    } else {
                        errorBlockUnOrderedList.append(liErrorMessage);
                    }
                } else {
                    errorBlockUnOrderedList.append(liErrorMessage);
                }
            });

            if ($("div.error-block ul li") && $("div.error-block ul li").length > 0) {
                var $errors = $("div.error-block").html();
                if ($target.hasClass('skip-cta') && $("div.error-block-skip-cta").length == 0) {
                    var $insertBefore = $(".columncontrol input.skip-cta").parents(".columncontrol")
                    $("<div class='error-block-skip-cta'>" + $errors + "</div>").insertBefore($insertBefore);
                }
                else if ($target.hasClass('skip-cta') && $("div.error-block-skip-cta").length > 0) {
                    $("div.error-block-skip-cta").html($errors);
                }
                else {
                    $("div.error-block").css("display", "block");
                }
            }
        }
    }

    var cleanErrorBlock = function () {
        var errorList = $("div.error-block ul");
        errorList.remove("li");
        errorList.append("<li></li>");
        $("div.error-block").hide();
    };

    function convertSerializeDataToJSON(formData) {
        var jsonObject = {};
        if (formData) {
            var keyValuePair = formData.split("&");
            if (keyValuePair && keyValuePair.length > 0) {
                for (var i = 0; i < keyValuePair.length; i++) {
                    var keyValueArr = keyValuePair[i];
                    var key = keyValueArr.split("=")[0];
                    var value = unescape(keyValueArr.split("=")[1].replace(/\+/g, ' '));
                    if (value && value.length > 0) {
                        if (value == "on" || value == "off") {
                            value = value == "on" ? true : false;
                        }
                        if (jsonObject["" + key] != null) {
                            if (Array.isArray(jsonObject["" + key])) {
                                jsonObject["" + key].push(value);
                            } else {
                                var valueArr = [];
                                valueArr.push(jsonObject["" + key]);
                                valueArr.push(value);
                                jsonObject["" + key] = valueArr;
                            }
                        } else {
                            jsonObject["" + key] = value;
                        }
                    }
                    errorMappingObj["" + key + ""] = $("input[name=" + key + "]")[0] || $("select[name=" + key + "]")[0] || $("textarea[name=" + key + "]")[0];
                }
            }
        }
        if (jsonObject["description"]) {
            var $description = $("textarea[name=description]");
            jsonObject["description"] = $description.val();
            errorMappingObj["description"] = $description[0];
        }
        if (jsonObject["ideaBrief"]) {
            var $ideaBrief = $("textarea[name=ideaBrief]");
            jsonObject["ideaBrief"] = $ideaBrief.val();
            errorMappingObj["ideaBrief"] = $ideaBrief[0];
        }
        if (jsonObject["companyLogo"]) {
            jsonObject["companyLogo"] = $("input[type=checkbox][name=companyLogo]").prop("checked");
        }
        return jsonObject;
    }

    $(document).on('click', '.repeat-container .repeat-add', function (event) {
        var $target = $(event.target);
        var limit = $target.data("limit");
        var parent = $target.closest(".repeat-container");
        if (limit && parent.children(".repeat-fields").length >= limit) {
            $target.attr("disabled", "disabled");
            return false;
        }
        var toRepeat = parent.find(".repeat-fields").first();
        var clone = toRepeat.clone();
        var nowId = $.now();
        if (!$target.parents('.ams-application-form').length) {
            clone.prepend('<div class="row">\n' +
                '<div class="col-md-3 col-sm-3 col-xs-3 pull-right text-right" style="margin-right: 0.25em">\n' +
                '<span class="close-repeat-fields btn btn-primary personaOrangeCTA" data-close-id="' + nowId + '">Remove</span>\n' +
                '</div>\n' +
                '</div>');
        }
        $(clone).find('.multiimage-label').text('Select Partner');
        $(clone).find('.wrapper-add-logo img.browse').attr("src", "/etc/designs/invest-india/investindialibs/images/camera.png");
        clone.attr("id", nowId);
        clone = clearElements(clone);
        var repeatFileUploads = clone.find(".file-upload");
        $.each(repeatFileUploads, function (index, item) {
            $item = $(item);
            $item.replaceWith(fileuploads[$item.data('name')].clone());
        });
        /* if ($target.parents('.ams-application-form').length > 0 && $target.find('.multipleimageupload')) {
                 var array1=[];
                 $(parent).find('select.multiimage-select').each(function(){
                     array1.push($(this).val());
                 });
                 $(clone.find('select.multiimage-select option')).each(function(){
                     if($.inArray($(this).val(),array1) > -1){
                         $(this).remove();
                     }
                 });
                 var selectionVar = clone.find('select.multiimage-select').val();
                 clone.find('.multiimage-label').text(clone.find('select.multiimage-select option[value=' + selectionVar + ']').text());
         }*/
        if ($target.parents('#ams-application-form').length
            || $target.parents('.ams-application-form').length
            || $target.parents('.stateRecognitionForm').length) {
            clone.append('<input type="button" class="repeat-remove" value="Remove">');
        }
        // clone.append("<input type='button' class='repeat-remove' value='remove'/>");
        var textTarget = clone.find("textarea.richTextarea");
        $(textTarget).siblings(".note-editor").remove();
        $(textTarget).summernote(personaJSON);
        clone.insertBefore($target);
        if (clone.find('select.multiimage-select option').length == 1) {
            $target.remove();
        }
        if (limit && parent.children(".repeat-fields").length >= limit) {
            parent.find(".repeat-add").hide();
        }
        $.event.trigger({type: 'addRepeatButton', cloneElem: clone, targetElem: $target});

        moreInfoEvents();
    });

    function clearElements(container) {
        container.find(':input').each(function () {
            switch (this.type) {
                case 'password':
                case 'textarea':
                case 'number':
                case 'select-one':
                case 'select-multiple':
                case 'email':
                    jQuery(this).val('');
                    break;
                case 'text':
                    jQuery(this).val('');
                    if (jQuery(this).hasClass("hasDatepicker")) {
                        jQuery(this).val('').attr("id", $.now() + 10);
                        if (jQuery(this).attr("restrictcurrent") && jQuery(this).attr("restrictcurrent") === "true") {
                            jQuery(this).removeClass('hasDatepicker').datepicker({'maxDate': new Date()});
                        } else if (jQuery(this).hasClass("ams-form-date")) {
                            jQuery(this).removeClass('hasDatepicker').datepicker({dateFormat: 'dd/mm/yy'});
                        } else {
                            jQuery(this).removeClass('hasDatepicker').datepicker();
                        }
                    }
                    break;
                case 'date':
                case 'checkbox':
                case 'radio':
                    this.checked = false;
                    break;
                case 'file':
                    var imageUploadRow = this.closest('.row');
                    $(imageUploadRow).find("img.browse").hide();
                    $(imageUploadRow).find(".camera-image").css('display', 'block');
                    $(imageUploadRow).find('.multi-image-heading span').text('0');
                    $(imageUploadRow).find('.preview-partners-logo').html('');
                    break;

            }
        });
        return container;
    }

    function handleRoleRelatedChanges() {
        $(".personalized-content-target").closest(".baseformfield").addClass("display-n");
        $("#startupEntity").closest(".baseformfield").addClass("display-n");

        $("input[type=radio][name=stage]").click(function () {
            var val = $("input[type=radio][name=stage]:checked").val();
            if (val ==="Prototype"||val==="Validation"|| val === "EarlyTraction" || val === "Scaling") {
                if (val =="Prototype"||val=="Validation") {
                    $("input[name=cin]").closest('.col-md-7').siblings('.col-md-3').find('sup').removeClass('required');
                    $("input[name=cin]").closest('.col-md-7').siblings('.col-md-3').find('sup').hide();
                    $("input[name=cin]").closest('.col-md-7').find('.help-block').addClass('hidden');
                    $("input[name=pan]").closest('.col-md-7').siblings('.col-md-3').find('sup').removeClass('required');
                    $("input[name=pan]").closest('.col-md-7').siblings('.col-md-3').find('sup').hide();
                    $("input[name=pan]").closest('.col-md-7').find('.help-block').addClass('hidden');
                    $('#startupEntity').parent().siblings('.col-md-3').find('sup').removeClass('required');
                    $('#startupEntity').parent().siblings('.col-md-3').find('sup').hide();
                     }
                     else{
                    $("input[name=cin]").closest('.col-md-7').find('.help-block').removeClass('hidden');
                    $("input[name=pan]").closest('.col-md-7').find('.help-block').removeClass('hidden');
                    $("input[name=cin]").closest('.col-md-7').siblings('.col-md-3').find('sup').show();
                    $("input[name=pan]").closest('.col-md-7').siblings('.col-md-3').find('sup').show();
                    $("input[name=cin]").closest('.col-md-7').siblings('.col-md-3').find('sup').addClass('required');
                    $("input[name=pan]").closest('.col-md-7').siblings('.col-md-3').find('sup').addClass('required');
                    $('#startupEntity').parent().siblings('.col-md-3').find('sup').addClass('required');
                    $('#startupEntity').parent().siblings('.col-md-3').find('sup').show();
                }
                $("input.skip-cta").closest(".baseformfield").hide();
                $(".skip-msg-text").closest(".text").hide();
                $("#startupEntity").closest(".baseformfield").removeClass("display-n");
                if (store.getItem("startupEntity") && (store.getItem("cin") || store.getItem("pan")) && isUpdateProfile()) {
                    stageIntervalId = setInterval(checkAndPopulateCINOnStageChange, 500);
                }
            } else {
                $("#startupEntity").closest(".baseformfield").addClass("display-n");
                if($("#startupEntity").closest(".baseformfield").hasClass("display-n")){
                    $("input[name=cin],input[name=legalName],input[name=pan]").closest(".baseformfield").addClass("display-n");
                }
                $("input.skip-cta").closest(".baseformfield").show();
                $(".skip-msg-text").closest(".text").show();
            }
        });

        $(document).on('change', '#startupEntity', function () {
            var startupEntity = $(this).val();
            $("input[name='cin']").val("");
            if (startupEntity) {
                if (startupEntity === "1" || startupEntity === "2") {
                    $("input[name=cin],input[name=legalName]").closest(".baseformfield").removeClass("display-n");
                    $("input[name=pan]").closest(".baseformfield").addClass("display-n");
                } else if (startupEntity === "3") {
                    $("input[name=pan]").closest(".baseformfield").removeClass("display-n");
                    $("input[name=cin],input[name=legalName]").closest(".baseformfield").addClass("display-n");
                }
            } else {
                $("input[name='cin']").hide();
                $("input[name='legalName']").hide();
                $("input[name='pan']").hide();
            }
            store.setItem("startupEntity", startupEntity);
        });

        $("input[name=dippCertified]").change(function () {
            $("input[name=dippNumber]").closest(".baseformfield").toggleClass("display-n", !this.checked);
        });

        $("input[name=isThereBusinessPlan]").change(function () {
            $(".repeat-businessPlan").closest(".baseformfield").toggleClass("display-n", !this.checked);
        });
    }

    $(document).on('click','.go-to-dash',function (e) {

            console.log('call');
         goToRoleDashboard();
    });
    $(document).on('click','.update-profile',function (e) {
        e.preventDefault();
        goToUpdateProfile();
    });

    function goToUpdateProfile () {
       // editProfile(e);
        window.open(window.location.origin +'/content/sih/en/profile.'+store.getItem('role')+'.'+store.getItem('uniqueId')+'.html','_self');
    }
    function goToRoleDashboard(){
        if (store.getItem('country') === "sih:location/india") {
            window.open(window.location.origin +'/content/sih/en/user/my-dashboard/'+store.getItem('role')+'.html','_self');
        } else {
            window.open(window.location.origin +'/content/sih/en/user/my-dashboard/'+'Int-'+store.getItem('role')+'.html','_self');
        }
    }
    function checkAndPopulateCINOnStageChange() {
        var $startUpEntity = $("select[name=startupEntity]");
        var $cinEl = $("input[name=cin]");
        var $pan = $("input[name=pan]");
        var $legalName = $("input[name=legalName]");
        if ($startUpEntity.length && (($cinEl.length && $legalName.length) || $pan.length)) {
            clearInterval(stageIntervalId);
            $startUpEntity.val(store.getItem("startupEntity")).attr("disabled", "disabled");
            if (profileData["startup"]["startupEntity"] === "3") {
                $pan.val(store.getItem("pan"));
                $pan.attr("disabled", "disabled");
            } else {
                var cinVal = store.getItem("cin");
                if (cinVal) {
                    $cinEl.val(cinVal).attr("disabled", "disabled");
                    $("input[type=checkbox][name=isRegistered]").attr("disabled", "disabled");
                    $("input[name=legalName]").val(store.getItem("legalName")).attr("disabled", "disabled");
                    $("span.cinSearch").addClass("disabled");
                }
            }
        }
    }

    function tieOrlvSpecificMessage($container, msg, addMsg) {
        if (addMsg) {
            $container.addClass("has-error").append("<div class='tieOrlvSpecificMessage help-block'>" + msg + "</div>");
        } else {
            if($(".tieOrlvSpecificMessage").length){
                $(".tieOrlvSpecificMessage").closest(".form-group").removeClass("has-error")
                    .end().remove();
            }
        }
    }


    //Form slider as per new design of persona
    function formSlider(){
        $('.form-slide-container').closest(".row-container").addClass('form-slide-outer-container clearfix');
        $('.persona-steps-form-wrap .step-previous').closest(".button").addClass('step-previous-wrap');
        $('.persona-steps-form-wrap .step-next').closest(".button").addClass('step-next-wrap');
        slideWidth = $(".form-slide-container").outerWidth();

        $(".form-slide-container .row-container").each(function(){
            slideWrapWidth = slideWrapWidth + slideWidth;
        })

// $(".form-slide-container").css("width",slideWrapWidth);
        $(".form-slide-container .row-container:first-child").addClass('active');
        $('.form-slide-container .row-container.active').show();
        var stepPosition = 0;
        $(".form-slide-container .row-container").each(function(i){
            rowIndex = `tab-index-${i}`;
            $(this).addClass(rowIndex);
            $(this).attr('data-ti',i);

        });
        $(".persona-timeline-wrap .time-stamp-outer").each(function(i){
            rowIndex = `tab-index-${i}`;
            $(this).addClass(rowIndex);
            $(this).attr('data-ti',i);
            if (i == 0) {
                $(this).addClass("active");
            }

        });
        switch ($(".time-line-outer .time-stamp-outer").length) {
            case 2:
                $(".time-line-outer").addClass("total-two");
                $(".presona-timeline-mobile .total-steps").html(`2`);
                break;
            case 3:
                $(".time-line-outer").addClass("total-three");
                $(".presona-timeline-mobile .total-steps").html(`3`);
                break;
            case 4:
                $(".time-line-outer").addClass("total-four");
                $(".presona-timeline-mobile .total-steps").html(`4`);
                break;
            case 5:
                $(".time-line-outer").addClass("total-five");
                $(".presona-timeline-mobile .total-steps").html(`5`);
                break;

        }
        if($('.form-slide-container .tab-index-0.active').length){
            $('.step-previous-wrap').hide();
        }
        else{
            $('.step-previous-wrap').show();
        }
            let saveProfile = $('.terms-condition-wrapper input[name="saveprofile"]');
            $('.terms-condition-wrapper input[name="saveprofile"]').remove();
            $('.step-next-wrap .text-center-mob').append(saveProfile);
            // responsive code
        $(".presona-timeline-mobile .current-title h3").html($(".time-stamp-outer.active .step-title span").text());
    }


     /* function mentorShipStartup(){
        var check= $('.form-slide-container .row-container').find("input[type=checkbox][name=mentorshipParticipant]");
         $mentorshipCityTrigger = $(".mentor_selection_offline:checkbox:first");
         if(!check.prop("checked")){
             $(".mentorshipComp").addClass("hidden");
         }
        $('.form-slide-container .row-container').find('.mentorevent').addClass('hidden');
            if (!$mentorshipCityTrigger.is(":checked")) {
                $(".mentorCityStartup").addClass("hidden");
            }
        }*/

    $(document).on('change','#One-to-many-masterclass',function (event) {
        var $target = $(event.target);
        if($target.val()) {
            $(".mentorCityStartup").toggleClass("hidden");
        }
        if($('.mentorCityStartup').hasClass('hidden')){

            $('.mentorCityStartup').parent().siblings('.help-block').addClass('hidden');
        }
        else{
            $('.mentorCityStartup').parent().siblings('.help-block').removeClass('hidden');
        }
    });
    $(document).on('change','input[type=checkbox][name=mentorshipParticipant]',function(event){
        var $target = $(event.target);
        if($target.val())
       {
           console.log($target.val());
           $(".mentorshipComp").toggleClass("hidden");
           if($("#One-to-many-masterclass").prop("checked")){
               $("#One-to-many-masterclass").prop("checked",false);
               $('.mentorCityStartup').addClass('hidden');

               $('.mentorCityStartup').parent().siblings('.help-block').addClass('hidden');
           }

           if ($('.mentorshipComp').hasClass('hidden')){

               $('.mentorshipComp').parent().siblings('.help-block').addClass('hidden');
            }
            else{
               $('.mentorshipComp').parent().siblings('.help-block').removeClass('hidden');
           }

           $('.form-slide-container .row-container').find('.mentorevent').toggleClass('hidden');
       }
    });
    //Next button for validating the form sliding.
    function nextButtonValidation(){

        $(".persona-steps-form-wrap input[name='next']").off('click').on('click',function(){
            if(validateNext()) {
                let currentIndex = $('.form-slide-container .row-container.active').attr('data-ti');
                let nextIndex = parseInt(currentIndex) + 1;
                let nextTwoIndex = nextIndex + 2;
                let nextTabSelector = `.form-slide-container .row-container.tab-index-${nextIndex}`;
                let nextTwoTabSelector = `.form-slide-container .row-container.tab-index-${nextTwoIndex}`;
                let currentTabSelector = `.form-slide-container .row-container.tab-index-${currentIndex}`;
                let currentStampIndex = $('.persona-timeline-wrap .time-stamp-outer.active').attr('data-ti');
                let nextStampIndex = parseInt(currentStampIndex) + 1;
                let nextStampSelector = `.persona-timeline-wrap .time-stamp-outer.tab-index-${nextStampIndex}`;
                let currentStampSelector = `.persona-timeline-wrap .time-stamp-outer.tab-index-${currentStampIndex}`;

                if($(nextTabSelector).length){
                    $('.form-slide-container .row-container.active').hide('slide', {direction: 'left'}, 0 , function(){
                        $(nextTabSelector).show('slide', {direction: 'right'}, 0, function () {
                            if($(nextTwoTabSelector).length){
                                $('.step-next-wrap input.step-next').show();
                                $('.step-next-wrap input.submit-cta').hide();
                            }else{
                                $('.step-next-wrap input.step-next').hide();
                                $('.step-next-wrap input.submit-cta').show();
                            }
                            if(!enableTNC)
                            {
                                $('.step-next-wrap input.submit-cta').attr("disabled","disabled");
                            }
                            else{
                                $('.step-next-wrap input.submit-cta').removeAttr("disabled","disabled");
                            }
                            $(nextTabSelector).addClass('active');
                            $(currentTabSelector).removeClass('active');
                            $(nextStampSelector).addClass('active');
                            $(currentStampSelector).removeClass('active');
                            $(currentStampSelector).addClass('done');
                            var wrapHeight = $(".form-slide-container .row-container.active").outerHeight();
                          //  $(".form-slide-container").css("height", wrapHeight);

                            if($('.form-slide-container .tab-index-0.active').length){
                                $('.step-previous-wrap').hide();
                            }
                            else{
                                $('.step-previous-wrap').show();
                            }
                            $(".presona-timeline-mobile .current-title h3").html($(".time-stamp-outer.active .step-title span").text());
                            $(".presona-timeline-mobile .current-step").html($(".time-stamp-outer.active .time-stamp-count i").text());
                        });

                    });
                }

            }
        });
    }
    //successslide calling when Saveprofile sucessfully
    const successSlide = () =>
    {
            if (isUpdateProfile()) {
                goToRoleDashboard();
            }
        else {
            $('body.persona-body').addClass('persona-successful');
            $('.persona-registration-header, .persona-steps-form-wrap .personatimeline').hide();
            let currentIndex = $('.form-slide-container .row-container.active').attr('data-ti');
            let nextIndex = parseInt(currentIndex) + 1;
            let nextTabSelector = `.form-slide-container .row-container.tab-index-${nextIndex}`;
            let currentTabSelector = `.form-slide-container .row-container.tab-index-${currentIndex}`;
            $('.step-form-footer-outer').hide();
            if ($(nextTabSelector).length) {

                $('.form-slide-container .row-container.active').hide('slide', {direction: 'left'}, 200, function () {
                    $(nextTabSelector).show('slide', {direction: 'right'}, 200, function () {
                        $(nextTabSelector).addClass('active');
                        $(currentTabSelector).removeClass('active');
                        var wrapHeight = $(".form-slide-container .row-container.active").outerHeight();
                        setTimeout(function () {
                            $(".form-slide-container").css("height", wrapHeight);
                        }, 200);
                    });

                });
            }
        }
    }
    //previous button code on persona form slider
    function previousButton(){


        $(".persona-steps-form-wrap input[name='previous']").off('click').on('click',function(){
            let currentIndex = $('.form-slide-container .row-container.active').attr('data-ti');
            let prevIndex = parseInt(currentIndex) - 1;
            let prevTabSelector = `.form-slide-container .row-container.tab-index-${prevIndex}`;
            let currentTabSelector = `.form-slide-container .row-container.tab-index-${currentIndex}`;
            let currentStampIndex = $('.persona-timeline-wrap .time-stamp-outer.active').attr('data-ti');
            let prevStampIndex = parseInt(currentStampIndex) - 1;
            let prevStampSelector = `.persona-timeline-wrap .time-stamp-outer.tab-index-${prevStampIndex}`;
            let currentStampSelector = `.persona-timeline-wrap .time-stamp-outer.tab-index-${currentStampIndex}`;

            if($(prevTabSelector).length){
                $('.form-slide-container .row-container.active').hide('slide', {direction: 'right'}, 200, function(){
                    $(prevTabSelector).show('slide', {direction: 'left'}, 200, function(){
                    $(prevTabSelector).addClass('active');
                    $(currentTabSelector).removeClass('active');
                    $(prevStampSelector).addClass('active');
                    $(currentStampSelector).removeClass('active');
                    $(currentStampSelector).removeClass('done');
                    var wrapHeight = $(".form-slide-container .row-container.active").outerHeight();
                    //$(".form-slide-container").css("height",wrapHeight);

                        if($('.form-slide-container .tab-index-0.active').length){
                            $('.step-previous-wrap').hide();
                        }
                        else{
                            $('.step-previous-wrap').show();
                        }
                        $(".presona-timeline-mobile .current-title h3").html($(".time-stamp-outer.active .step-title span").text());
                        $(".presona-timeline-mobile .current-step").html($(".time-stamp-outer.active .time-stamp-count i").text());
                    });
                });
            }
            $('.step-next-wrap input.step-next').show();
            $('.step-next-wrap input.submit-cta').hide();
        });
    }

    $('#registration-error-modal').off().on('hidden.bs.modal', function () {
        $("span.help-block").each(function () {
            if($(this).text()){
                $(window).scrollTop($(this).offset().top - 200);
                return false;
            }
        });
    });
    $(document).on('paste, keydown', "input[name='cin']", function() {
        $(this).val($(this).val().split(" ").join(""));
    });
    $(document).on('click', '.repeat-fields .close-repeat-fields', function(){
            var closeId= $(this).data('close-id');
            $('#'+closeId).remove();
    });
    function otherButtonValidation(){
        var personatype = store.getItem("personatype");
        if (personatype == "mentor" || personatype == "individual-investor") {
            $("input[name=next]").attr("disabled", "disabled");
        }
        if (store.getItem("personaStepsPath") && store.getItem("personaStepsPath").includes("international-persona")) {
            $("input[name=next]").removeAttr("disabled");
        }
        $('input[name=TiEOrLetsVenture]').on("change",function(){
            if($('input[name=TiEOrLetsVenture]:checked').val() === 'others'){
                 $("input[name=next]").removeAttr("disabled");
                 store.setItem("tieVerified",true);
            } else {
                $("input[name=next]").attr("disabled", "disabled");
            }
        });

    }
   $(document).on('change', 'select[name=startupEntity]',function(){
        $('input[name=legalName]').val('');
        $('input[name=pan]').val('');
    });
$(document).ready(function () {
    var businessPlanIntervalID = -1;
    var dippCertifiedIntervalID = -1;
    var cinIntervalID = -1;
    var cinToggleID = -1;
    var portfoliosID = -1;
    var updateProfileAPI = SIH.getEndPoint("/api/auth/user/edit/profile");
    var getUserImageAPI = SIH.getEndPoint("/api/file/user/image");
    var getMemberPicAPI = SIH.getEndPoint("/api/file/member/pic");

    var store = ContextHub.getStore("sih_user");
    if (isUpdateProfile()) {
        if (!store || !store.getItem("token")) {
            alert("Please log in to edit your profile.");
            window.location = $('.notification-container').attr('home-page');
        } else {
            store.setItem("updateProfile", true);
            preProcessingBeforeProfileEdit();
        }
    } else if (location.pathname.indexOf("persona.html") > -1) {
        if (store.getItem("uniqueId") != null && store.getItem("country") != null) {
            //Its an existing user..
            window.location = $('.notification-container').attr('update-profile');
        }
    }

    function getPersonalizedCountryAndRole(country, userData) {
        $(".persona-dropdown-wrapper").show();
        var country = country ? country : store.getItem("country");
        setHeaderCountry($(".headerCountryLink[data-value='" + country + "']"));
        //$(".persona-header-dropdown .header-language .dropdown").css({'pointer-events': 'none'});

        setHeaderRolesList(country);
        var role = userData.role, personatype;
        if (role == "ServiceProvider") {
            personatype = userData["organization"] ? "organization-service-provider" : "freelancer-service-provider";
        } else if (role == "Investor") {
            personatype = userData["institution"] ? "institutional-investor" : "individual-investor";
        } else {
            personatype = ROLE_PERSONATYPE_MAP[role];
        }
        setHeaderRole($(".headerRoleLink[data-value='" + personatype + "']"), false, true);

        //Individual-to-Startup switch profile event
        if (isUpdateProfile() && personatype === "individual") {
            $(".headerRoleLink").hide();
            $(".headerRoleLink[data-value='startup']").attr("data-switch", "1").show();
            $("#headerRole  .header-language .dropdown").css({'pointer-events': 'all'});
        }
    }

    function preProcessingBeforeProfileEdit() {
        $("#inner-content-container").empty();
        $("#persona-header-title-container").empty();
        var updateHtml = "<div class=\"text parbase\">\n" +
            "    <h1>Update Profile</h1>\n" +
            "    <h5>It is recommended to update your profile details for best search results</h5>\n" +
            "</div>"
        $("#persona-header-title-container").html(updateHtml);
        $("#modal-loader").modal("show");
        $.ajax({
            url: updateProfileAPI,
            type: "GET",
            headers: {"X-Auth-Token": store.getItem("token")},
            datatype: "json",
            success: function (response) {
                profileData = response;
                var userData = response;
                if (userData) {
                    $(document).on('change', 'input[name=isThereBusinessPlan]', function () {
                        if ($(this).is(':checked')) {
                            if (userData.businessPlan && userData.businessPlan.length > 0) {
                                businessPlanIntervalID = setInterval(checkAndPopulateBusinessPlans, 500);
                            }
                        }
                    });
                    $(document).on('change', 'input[name=dippCertified]', function () {
                        if ($(this).is(':checked') && userData.dippCertified) {
                            dippCertifiedIntervalID = setTimeout(populateDIPPNumber, 500);
                        }
                    });
                    store.setItem("email", userData.email);
                    getPersonalizedCountryAndRole(store.getItem("personaCountryEdit"), userData);
                    //populateTNC();
                    if (userData.role == "Startup") {
                        populateDataForStartup(userData);
                        userData = userData["startup"];
                    }
                    var ignoreFields = ["role", "uniqueId"];
                    for (var field in userData) {
                        if ($.inArray(field, ignoreFields) > -1) {
                            continue;
                        }
                        var fieldValue = userData["" + field];
                        if (field == "image" && profileData.role != "Startup" && fieldValue && fieldValue.length > 0) {
                            var imagePath = getUserImageAPI + "/" + personaMap[store.getItem("personatype")] + "?fileName=" + fieldValue;
                            setImage(field, imagePath);
                            images = images || {};
                            images[store.getItem("personatype")] = fieldValue;
                        }
                        else if (field == "name") {
                            if (profileData.role != "Startup") {
                                $("input[name=fullname]").val(fieldValue);
                            }
                        }
                        else if (field == "tieVerified" || field == "lvVerified") {
                            if (field == "lvVerified") {
                                continue;
                            }
                            var $el = null;
                            if (userData["lvVerified"]) {
                                $el = $("input[type=radio][name=TiEOrLetsVenture][value=isLetsVenture]");
                            } else {
                                if (!fieldValue) {
                                    $el = $("input[type=radio][name=TiEOrLetsVenture][value=others]");
                                    store.setItem("TiEOrLetsVenture", "others");
                                } else {
                                    $el = $("input[type=radio][name=TiEOrLetsVenture][value=isTIE]");
                                }
                            }
                            if ($el) {
                                $el.prop("checked", true).trigger("click");
                            }
                            if ($el && $el.length > 0) {
                                // $el.closest("div.accordion-section-content").hide();
                            }
                        }
                        else if (field == "otherThanTieLVDescription" && fieldValue) {
                            if (fieldValue) {
                                store.setItem('otherThanTieLVDescription', fieldValue);
                                $("textarea[name=" + field + "].richTextArea").summernote("code", fieldValue);
                            }
                        }
                        else if (field == "type" || field == "profession" || field == "programDuration" || field == "budget") {
                            populateSingleSelect(field, fieldValue);
                        }
                        else if (field == "funded") {
                            fieldValue ? $("input[type=radio][name=funded][value=on]").prop("checked", true) : $("input[type=radio][name=funded][value=off]").prop("checked", true);
                        }
                        else if (field == "focusAreas" || field == "focusArea") {
                            populateFocusAreas(field, fieldValue);
                        }
                        else if (field == "dippCertified" || field == "dippNumber") {
                            if (fieldValue) {
                                checkAndPopulateDIPPNumber(field, fieldValue);
                            } else {
                                store.setItem("dippCertified", false);
                            }
                        }
                        else if (field == "phone" && fieldValue) {
                            $("input[name=" + field + "]").val(fieldValue);
                        }
                        else if ((field == "startupEntity" && fieldValue && fieldValue.length > 0)) {
                            /*if(field == "legalName"){
                                continue;
                            }*/
                            store.setItem("startupEntity", profileData["startup"]["startupEntity"]);
                            if (userData["stage"] == "Validation" || userData["stage"] == "Prototype") {
                                cinToggleID = setInterval(checkForCINToggle, 500);
                            } else {
                                cinIntervalID = setInterval(checkAndPopulateCIN, 500);
                            }
                        }
                        else if (field == "location") {
                            $.each(fieldValue, function (key, value) {
                                $field = $("select[name=" + key + "]");
                                if ($field) {
                                    if (value) {
                                        $field.val(value["id"]);
                                    }
                                    if (key == "state") {
                                        $field.trigger("change");
                                    }
                                }
                            });
                        }
                        else if (field == "ideaBrief" || field == "description") {
                            $("textarea[name=" + field + "].richTextArea").summernote({
                                toolbar: [
                                    //[groupname, [button list]]
                                    ['insert', ['link']],
                                ],
                            });
                            $("textarea[name=" + field + "].richTextArea").summernote("code", fieldValue);
                        }
                        else if (field == "stage") {
                            var $field = $("input[type=radio][name=" + field + "][value='" + fieldValue + "']");
                            $field.prop("checked", true);
                            $field.trigger("click");
                        }
                        else if (field == "portfolios" && fieldValue && fieldValue.length > 0) {
                            $("input[type=checkbox][name=hasStories]").prop("checked", true);
                            $("input[type=checkbox][name=hasStories]").trigger("change");
                            portfoliosID = setInterval(populatePortfolios, 500);
                        }
                        else if (field == "mentorshipParticipant" && fieldValue) {
                            $("input[type=checkbox][name=mentorshipParticipant]").trigger("click");
                        }
                        else if (field == "mentorship") {
                            populateMentorshipProgramDetails(fieldValue);
                        }
                        else if (field == "services" || field == "preferredStartupStages" || field == "mentorDomains") {
                            populateMultiSelectOption(field, fieldValue);
                        }
                        else if (field == "members") {
                            populateMembers(fieldValue);
                        }
                        else if(field=="centerLocations"){
                            populateCenterLocations(fieldValue);
                        }
                        else if (field == "contacts") {
                            if (fieldValue && $.isArray(fieldValue) && fieldValue.length > 0) {
                                populateFieldsUsingKeyAsNameInObject(fieldValue[0]);
                            }
                        }
                        else if (field == "mobileAppLink" && fieldValue) {
                            $("input[name=" + field + "]").val(fieldValue["Android"]);
                        }
                        else if (field == "urls") {
                            populateArrayValuesInRepeatField(field, fieldValue);
                        }
                        else if (field == "agency") {
                            populateAgencyDetails(fieldValue);
                        }
                        else if (field == "businessPlan") {
                            if (fieldValue && fieldValue.length > 0) {
                                $("input[name=isThereBusinessPlan]").prop("checked", true);
                                $("input[name=isThereBusinessPlan]").trigger("change");
                                // businessPlanIntervalID = setInterval(checkAndPopulateBusinessPlans, 500);
                            } else if (store.getItem("isThereBusinessPlan")) {
                                store.setItem("isThereBusinessPlan", false);
                            }
                        } else if (field == "companyLogo") {
                            $("input[type=checkbox][name=companyLogo]").prop("checked", fieldValue);
                        }
                        else if ($.isArray(fieldValue)) {
                            $.each(fieldValue, function (idx, val) {
                                if (typeof val === 'object') {
                                    return false;
                                }
                                $("input[type=checkbox][value='" + val + "']").prop("checked", true);
                            });
                        }
                        else if (fieldValue === true || fieldValue === false) {
                            var $field = $("input[type=checkbox][name=" + field + "]");
                            if ($field) {
                                $field.prop("checked", fieldValue);
                                if ($field.hasClass("personalized-content")) {
                                    $field.trigger("change");
                                }
                            }
                        }
                        else if (fieldValue) {
                            $("input[name=" + field + "]").val(fieldValue);
                        }
                    }
                    hideCTAs();
                    doProcessingForTNC();
                }
                $('.addContainer').each(function () {
                    var checkedInputs = $(this).find('input.addAll:checked').length;
                    if (checkedInputs && (checkedInputs == $(this).find('input.addAll').length)) {
                        $(this).find("input[name=addAll]").prop('checked', true);
                    }
                });

                //if(store.getItem('personatype')=='startup'){
                    formSlider();
                    nextButtonValidation();
                    previousButton();
                //}

                $("#modal-loader").modal("hide");
            }, error: function (response) {
                if (response.status == 403) {
                    bootbox.alert("Your profile is under moderation. Please try later once your profile is active.", function () {
                        window.location = $('.notification-container').attr('home-page');
                    });
                } else {
                    bootbox.alert("Something went wrong. We are unable to fetch the profile. Please try later.", function () {
                        window.location = $('.notification-container').attr('home-page');
                    });
                }
            }
        });
    }

    function hideCTAs() {
        $(".btn-validate-step").hide();
        $(".skip-cta").hide();
        $(".btn-validate-step").closest("div.columncontrol").hide();
        $(".skip-msg-text").closest(".text").hide();
    }

    function populateTNC() {
        var tncWrapper = $("div.terms-condition-wrapper");
        if (tncWrapper && tncWrapper.length > 0) {
            tncWrapper.find("input[type=checkbox][name=enableTNC]").prop("checked", true);
        }
    }

    function populateDataForStartup(userData) {
        $.each(userData, function (key, value) {
            if (typeof  value === 'object') {
                return;
            }
            if (key == "image") {
                startupFileNames[key] = value;
                var imagePath = getUserImageAPI + "/Startup?fileName=" + value;
                setImage(key, imagePath);
            } else if (key == "companyLogo") {
                $("input[type=checkbox][name=companyLogo]").prop("checked", value);
            } else if (key == "name") {
                var elem = document.createElement('textarea');
                elem.innerHTML = value;
                $("input[name=fullname]").val(elem.value);
                $("input[name=" + key + "]").val(elem.value);
            } else {
                $("input[name=" + key + "]").val(value);
            }
        });
        store.removeItem("startupEntity");
    }

    function checkForCINToggle() {
        var $CINRegisteredToggle = $("input[type=checkbox][name=isRegistered]");
        if ($CINRegisteredToggle && $CINRegisteredToggle.length > 0) {
            clearInterval(cinToggleID);
            $CINRegisteredToggle.prop("checked", true);
            $("input[type=checkbox][name=isRegistered]").trigger("change");
            cinIntervalID = setInterval(checkAndPopulateCIN, 500);
        }
    }

    function populateAgencyDetails(fieldValue) {
        $.each(fieldValue, function (key, value) {
            var $fieldEl = $("select[name=" + key + "]");
            $fieldEl.val(value.id);
            if (key == "ministry") {
                $fieldEl.trigger("change");
            }
        });
    }

    function populateMembers(values) {
        if (values && values.length > 0) {
            var memberNameInputs = $("input[name=members-name]");
            startupFileNames["memberpic"] = {};
            if (values.length > 1) {
                repeatElements("members-name", values.length);
                memberNameInputs = $("input[name=members-name]");
                $.each(values, function (idx, value) {
                    populateMemberProperties(value, $(memberNameInputs[idx]).closest("div.repeat-fields"));
                });
            }
            else {
                populateMemberProperties(values[0], $(memberNameInputs[0]).closest("div.repeat-fields"));
            }
        }
    }

    function populateCenterLocations(values){
        if(values && values.length>0){
            repeatElements("incubationCenterLocation",values.length);
            var incubatorCenterLocation = $("input[name=incubationCenterLocation]");
            $.each(incubatorCenterLocation, function (idx, loc) {
                $(loc).closest("div.repeat-fields").find("[name=incubationCenterLocation]").val(values[idx].incubationCenterLocation)
                $(loc).closest("div.repeat-fields").find("[name=incubatorCenterLocationAddress]").val(values[idx].incubatorCenterLocationAddress)
            });
        }
    }

    function populateMemberProperties(obj, $parent) {
        for (var key in obj) {
            var value = obj[key];
            if (key == "pic") {
                startupFileNames["memberpic"] = startupFileNames["memberpic"] || {};
                startupFileNames["memberpic"]["" + $parent.attr("id")] = value;
                if (value && value.length > 0) {
                    var imagePath = getMemberPicAPI + "?fileName=" + value;
                    $parent.find("img.browse").attr("src", imagePath).show();
                    $parent.find("div.image-section").find("span").hide();
                }
            } else if (key == "profile") {
                $parent.find("textarea[name=members-profile].richTextArea").summernote("code", value);
            } else if (key == "socialInfos" && ($.isArray(value))) {
                $.each(value, function (idx, socialInfo) {
                    var socialKey = socialInfo.social.toLowerCase();
                    $parent.find("input[name=" + socialKey + "-url]").val(socialInfo.url);
                });
            } else {
                $parent.find("input[name=members-" + key + "]").val(value);
            }
        }
    }

    function checkAndPopulateBusinessPlans() {
        if ($("input[name=businessPlan-fileName]").length > 0) {
            clearInterval(businessPlanIntervalID);
            cloneFileUploads();
            populateBusinessPlans(profileData["startup"]["businessPlan"]);
        }
    }

    function populateBusinessPlans(businessPlans) {
        if (businessPlans && $.isArray(businessPlans) && businessPlans.length > 0) {
            var businessPlanInputs = $("input[name=businessPlan-fileName]");
            startupFileNames["startupDocs"] = {};
            if (businessPlans.length > 1) {
                repeatElements("businessPlan-fileName", businessPlans.length);
                businessPlanInputs = $("input[name=businessPlan-fileName]");
                $.each(businessPlans, function (idx, businessPan) {
                    populateBusinessPlanProperties(businessPan, $(businessPlanInputs[idx]).closest("div.repeat-fields"));
                });
            } else {
                populateBusinessPlanProperties(businessPlans[0], $(businessPlanInputs[0]).closest("div.repeat-fields"));
            }
        }
    }

    function populateBusinessPlanProperties(obj, $parent) {
        startupFileNames["startupDocs"] = startupFileNames["startupDocs"] || {};
        startupFileNames["startupDocs"]["" + $parent.attr("id")] = {};
        startupFileNames["startupDocs"]["" + $parent.attr("id")]["fileName"] = obj.fileName;
        startupFileNames["startupDocs"]["" + $parent.attr("id")]["title"] = obj.title;
        $parent.find("div.image-section span").hide();
        $parent.find("img.browse").hide();
        $parent.find(".image-body").hide();
        var $fileTextBlock = $parent.find("span.browse-file-name");
        $fileTextBlock.text(obj.title ? obj.title : "");
        $fileTextBlock.show();
        $parent.find("div.btn-primary").css("top", 0);
    }

    function populateDIPPNumber() {
        var $dippEl = $("input[name=dippNumber]");
        if ($dippEl.length > 0) {
            clearInterval(dippCertifiedIntervalID);
            var dippNumber = profileData ? profileData["startup"]["dippNumber"] : null;
            if (dippNumber) {
                $dippEl.val(dippNumber);
                /* $("input[type=checkbox][name=dippCertified]").attr("disabled", "disabled");
                 $dippEl.attr("disabled", "disabled");*/
            }
        }
    }

    function checkAndPopulateDIPPNumber(field, fieldValue) {
        if (field == "dippNumber") {
            return;
        }
        if (fieldValue) {
            var $field = $("input[type=checkbox][name=dippCertified]");
            $field.prop("checked", fieldValue);
            if ($field.hasClass("personalized-content")) {
                $field.trigger("change");
                dippCertifiedIntervalID = setInterval(populateDIPPNumber, 500);
            }
        }
    }

    function checkAndPopulateCIN() {
        var $startUpEntity = $("select[name=startupEntity]");
        var $cinEl = $("input[name=cin]");
        var $pan = $("input[name=pan]");
        if ($startUpEntity.length && ($cinEl.length || $pan.length)) {
            clearInterval(cinIntervalID);
            $startUpEntity.val(profileData["startup"]["startupEntity"]).trigger("change").attr("disabled", "disabled");
            if (profileData["startup"]["startupEntity"] === "3") {
                $pan.val(profileData["startup"]["pan"]);
                $pan.attr("disabled", "disabled");
                store.setItem("pan", profileData["startup"]["pan"]);
            } else {
                var cinVal = profileData["startup"]["cin"];
                if (cinVal) {
                    $cinEl.val(cinVal).attr("disabled", "disabled");
                    $("input[type=checkbox][name=isRegistered]").attr("disabled", "disabled");
                    $("input[name=legalName]").val(profileData["startup"]["legalName"]).attr("disabled", "disabled");
                    store.setItem("cin", cinVal);
                    store.setItem("legalName", profileData["startup"]["legalName"]);
                    $("span.cinSearch").addClass("disabled");
                }
            }
        }
        /*  if($cinEl.length > 0){
              clearInterval(cinIntervalID);
              var cinVal = profileData["startup"]["cin"];
              if(cinVal){
                  $cinEl.val(cinVal);
                  $("input[type=checkbox][name=isRegistered]").attr("disabled", "disabled");
                  $cinEl.attr("disabled", "disabled");
                  $("input[name=legalName]").val(profileData["startup"]["legalName"]);
              }
          }*/
    }

    function populatePortfolios() {
        var startupNameInputs = $("input[name=startupName]");
        if (startupNameInputs && startupNameInputs.length > 0) {
            clearInterval(portfoliosID);
            var values = profileData["portfolios"];
            if (values.length > 1) {
                repeatElements("startupName", values.length);
                startupNameInputs = $("input[name=startupName]");
                $.each(values, function (idx, value) {
                    populatePortfolioProperties(value, $(startupNameInputs[idx]).closest("div.repeat-fields"));
                });
            }
            else {
                populatePortfolioProperties(values[0], $(startupNameInputs[0]).closest("div.repeat-fields"));
            }
        }
    }

    function populatePortfolioProperties(obj, $parent) {
        $.each(obj, function (key, value) {
            if (key === "brief" || key === "guidanceAreas") {
                $parent.find("textarea[name=" + key + "].richTextArea").summernote("code", value);
                return;
            }
            if(key === "startupLogo"){
                var imagePath = getUserImageAPI + "/" + personaMap[store.getItem("personatype")] + "?fileName=" + value;
                $parent.find("img.browse").attr("src", imagePath).show();
                $parent.find("div.image-section").find("span").hide();
                var repeatIDLogo = $parent.first().attr("id");
                portfolioImages["startupLogo"] = portfolioImages["startupLogo"] || {};
                portfolioImages["startupLogo"]["" + repeatIDLogo] = value;
                return;
            }
            $parent.find("input[name=" + key + "]").val(value);
        });
    }
});

function populateFocusAreas(field, fieldValue) {
    var sectors = [];
    if ("focusArea" == field) {
        // case for startup
        $("select[name=startupindustry]").val(fieldValue["industry"].id).trigger("change");
        sectors = fieldValue["sectors"];
        if (sectors && sectors.length > 0) {
            $("select[name=sector]").val(sectors[0].id);
        }
    } else {
        if (fieldValue && $.isArray(fieldValue)) {
            var selectedSectors = [];
            var industries = [];
            $.each(fieldValue, function (idx, value) {
                industries.push(value["industry"]["id"]);
                sectors = value["sectors"];
                $.each(sectors, function (index, sector) {
                    selectedSectors.push(sector["id"]);
                });
            });
            populateMultiSelectOption("industry", industries);
            $.each(selectedSectors, function (idx, selectedSector) {
                $("input[value='" + selectedSector + "']").prop("checked", true);
            });
            $("div.customised-dropdown .dropdown-menu").trigger("change");
        }
    }
}
$(document).ready(function(){

    $(document).on("click","#connections-main-div .btn-message, button[name=message-cta]",function(event){
        var $target = $(event.target);
        var id = $target.data("id") ? $target.data("id") : uniqueProfileId;
        var path = $target.data("path");
        window.location.href = path + "?uniqueId=" + id;
    });

    $(document).on("click","button[name=accept-cta], button[name=reject-cta]",function(event){
        var $target = $(event.target);
        $target.append("<i class='fa fa-spinner fa-spin'></i>");
        var path = $target.data("path");
        if(path){
            var requestId = $target.data("requestid") ? $target.data("requestid") : store.getItem("connectTo/requestId");
            path = path + "/" + requestId;
            var connectToKey = "";
            if(!$target.data("requestid")){
                connectToKey = $target.attr("name") == "accept-cta" ? "connectTo/connected" : "connectTo/connectionAllowed";
            }
            refreshConnection(path, connectToKey, $target);
        }
    });

    $(document).on("click","button[name=connect-cta]",function(event){
        var $target = $(event.target);
        var path = $target.data("path");
        $target.append("<i class='fa fa-spinner fa-spin'></i>");
        if(path){
            path = path + "/" + uniqueProfileId;
            if(applicationLink){
                window.open(applicationLink, '_blank');
            }
            var enablers = ["Mentor","Incubator","Accelerator","Corporate","Investor"];
            if(enablers.indexOf(store.getItem("role")) > -1){
                refreshConnection(path, "connectTo/connected", $target);
            }else{
                refreshConnection(path, "connectTo/connectionSent", $target);
            }
        }
    });

    $(document).on("change","div#connections-user",function(event){
        var $target = $(event.target);
        var $parent = $target.closest("div#connections-user");
        var filters = $parent.find("input[name='connections-user']:checked");
        filteredValues = [];
        $.each(filters, function(idx, filter){
            filteredValues.push(filter.value);
        });
        connectionsPage = 0;
        displayConnectionMainCard();
    });

});

var connectionsPage = 0;
var filteredValues = [];

function displayConnectionMainCard(uniqueProfileId){
    displayConnectionCard("connections-main","connections-main-div","pagination-template","connections-pagination", uniqueProfileId);
}

function displayConnectionRequestCard(){
    displayConnectionCard("connection-request-template","connections-request-div","request-pagination-template","connections-request-pagination");
}

function displaySendRequestCard(){
    displayRequestsCard("connection-send-request-template","connections-send-request-div","send-request-pagination-template","connections-send-request-pagination");
}

function displayConnectionCard(cardId,displayCardId,paginationId,displayPaginationId, puid){
    var connectionCard = $("#" + cardId).html();
    if(connectionCard) {
        var template = Handlebars.compile(connectionCard);
        var mainDiv = $("#" + displayCardId);
        var uid = store.getItem("uid");
        var path = mainDiv.data("path");

        if(puid){
            path = path + "/" + puid;
        }
        if ((uid || store.getItem('sihRegisteredUser')) && path) {
            var data = {};
            data["page"] = connectionsPage;
            data["roles"] = (filteredValues && filteredValues.length) ? filteredValues.join(' ') : [];
            $.ajax({
                type: "GET",
                url: SIH.getEndPoint(path),
                data: data,
                headers: {"X-Auth-Token": store.getItem("token")}
            }).done(function (response) {
                if(response.content.length > 0 ){
                    mainDiv.html(template(response));
                }
                if(paginationId) {
                    var pagination = {
                        pages: response.totalPages,
                        number: response.number + 1,
                        last: response.last,
                        first: response.first,
                        numberOfElements: response.numberOfElements
                    }
                    var paginationResource = $("#" + paginationId).html();
                    var paginationTemplate = Handlebars.compile(paginationResource);
                    $("#" + displayPaginationId).html(paginationTemplate(pagination));

                    if (pagination.pages > 5) {
                        $('span.first-connection-page, span.last-connection-page ').css('display', 'block');
                        if ($('#connections-request-pagination .pagination li.active').index() == 0)
                            $('span.first-connection-page').css('display', 'none');
                        if ($('#connections-request-pagination .pagination li.active').index() == 4)
                            $('span.last-connection-page').css('display', 'none');
                    } else {
                        $('span.first-connection-page, span.last-connection-page').css('display', 'none');
                    }

                    var requestPanel = mainDiv.closest(".tab-pane");
                    if (requestPanel.length > 0) {
                        var id = requestPanel.attr("id");
                        var tab = $("a[href='#" + id + "']");
                        if (tab) {
                            tab.find(".count").html(" (" + response.numberOfElements + ")");
                        }
                    }
                }
            });
        }
    }
}

function displayRequestsCard(cardId,displayCardId,paginationId,displayPaginationId){
    var connectionCard = $("#" + cardId).html();
    var template = Handlebars.compile(connectionCard);
    var mainDiv = $("#" + displayCardId);
    var uid = store.getItem("uid");
    var path = mainDiv.data("path");
    if(uid && path){
        var data = {};
        data["page"] = connectionsPage;
        data["roles"] = filteredValues.join(' ');;
        $.ajax({
            type: "GET",
            url: SIH.getEndPoint(path),
            data: data,
            headers: {"X-Auth-Token": store.getItem("token")}
        }).done(function (response) {
            mainDiv.html(template(response));
            var pagination = {
                pages:response.totalPages,
                number:response.number+1,
                last:response.last,
                first:response.first,
                numberOfElements:response.numberOfElements
            }
            var paginationResource = $("#" + paginationId).html();
            var paginationTemplate = Handlebars.compile(paginationResource);
            $("#" + displayPaginationId).html(paginationTemplate(pagination));

            if (pagination.pages > 5) {
                $('span.first-connection-page, span.last-connection-page ').css('display','block');
                if ($('#connections-request-pagination .pagination li.active').index() == 0)
                    $('span.first-connection-page').css('display', 'none');
                if ($('#connections-request-pagination .pagination li.active').index() == 4)
                    $('span.last-connection-page').css('display', 'none');
            } else {
                $('span.first-connection-page, span.last-connection-page').css('display', 'none');
            }

            var requestPanel = mainDiv.closest(".tab-pane");
            if(requestPanel.length > 0){
                var id = requestPanel.attr("id");
                var tab = $("a[href='#" + id + "']");
                if(tab){
                    tab.find(".count").html(" (" + response.numberOfElements + ")");
                }
            }
        });
    }
}

function displayConnectionSideCard(connectionsSidecard){
    var template = Handlebars.compile(connectionsSidecard);
    var sideDiv = $("#connections-side-div");
    var uid = store.getItem("uid");
    var path = sideDiv.data("path");
    if(uid && path){
        $.ajax({
            type: "GET",
            url: SIH.getEndPoint(path),
            headers: {"X-Auth-Token": store.getItem("token")}
        }).done(function (response) {
            sideDiv.html(template(response));
        });
    }
}

function conResult(page){
    connectionsPage = parseInt($(page).html()) - 1;
    displayConnectionMainCard();
}

function conNext(elem){
    connectionsPage = parseInt($(elem).siblings('ul').find('li.active').html());
    displayConnectionMainCard();
}

function conPrevious(elem){
    connectionsPage = parseInt($(elem).siblings('ul').find('li.active').html()) - 2;
    displayConnectionMainCard();
}

function connectionFirst() {
    connectionsPage  = 0;
    displayConnectionMainCard();
}

function connectionLast(pages) {
    connectionsPage = pages - 1;
    displayConnectionMainCard();
}

function refreshConnection(path, connectToKey, targetElement){
    $.ajax({
        type: "GET",
        url: SIH.getEndPoint(path),
        headers: {"X-Auth-Token": store.getItem("token")}
    }).done(function (response) {
        if(targetElement){
            $(targetElement).find("i").remove();
        }
        if(connectToKey){
            store.removeItem("connectTo");
            store.setItem(connectToKey,true);
            //toggleConnectWithUs();
        }
        else{
            displayConnectionRequestCard();
        }
    }).fail(function (error) {
        //console.log(error);
        if(targetElement){
            $(targetElement).find("i").remove();
        }
        showSnackbar('<i class="fa-2x fa-exclamation-triangle">'+error.responseText+'</i>',"alert-danger");
    });
}

function conReqResult(page){
    connectionsPage = parseInt($(page).html()) - 1;
    displayConnectionRequestCard();
}

function conReqNext(elem){
    connectionsPage = parseInt($(elem).siblings('ul').find('li.active').html());
    displayConnectionRequestCard();
}

function conReqPrevious(elem){
    connectionsPage = parseInt($(elem).siblings('ul').find('li.active').html()) - 2;
    displayConnectionRequestCard();
}


function roleConnectionData(cardId, displayCardId, role) {
    console.log("inside roleConnectionData");
    invokeOnce = false;
    var connectionCard = $("#" + cardId).html();
    if (connectionCard) {
        var template = Handlebars.compile(connectionCard);
        var mainDiv = $("#" + displayCardId);
        var path = mainDiv.data("path");
        var data = {};
        var roles = [];
        roles.push(role);
        data.roles = roles;
        $.ajax({
            type: "POST",
            url: SIH.getEndPoint(path),
            contentType: "application/json",
            data: JSON.stringify(data)
        }).done(function (response) {
            response.connectionAllowed = true;
            mainDiv.html(template(response));
        });
    }
}
$.fn.messages = function () {
    var windowSize = $(window).width();
    var chatMessageUser = 0;
    var chatMessagePage = 0;
    var $tab = $(".tab-container .tab-content .static-content-section");
    var $searchInput = $tab.find(".small-banner-search input.chat-search-component");
    var $messageNotification = $('.notification-container ul').find('li.msg-notification');
    var userName;

    $('[rel="popover"]').popover({
        container: 'body',
        html: true,
        content: function () {
            var clone = $($(this).data('popover-content')).clone(true).removeClass('hide');
            return clone;
        }
    }).click(function (e) {
        e.preventDefault();
    });

    $.urlParam = function (name) {
        var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
        var result = results ? results[1] : 0;
        return result;
    };

    var uniqueId = $.urlParam('uniqueId');
    var xTokenHeader = {"X-Auth-Token": store.getItem("token")};

    populateChatQueue();
    if (!$tab.find(".chat-list ul.chatTabs li").length && uniqueId === 0) {
        $tab.find(".noChatMessage").removeClass("displayNone");
        $tab.find('.chat-component .main-cards').css("display", "none");
        $tab.find('.chat-current-profile .side-cards').removeClass("desktop-display-block").css("display", "none");
    }

    if (windowSize >= 768) {
        selectFirstUser();
    } else {
        $tab.find(".chat-component .main-cards").css("display", "none");
    }
    if (uniqueId !== 0) {
        populateNewUser(uniqueId);
    }
    $(".chat-text").scrollTop($(".chat-text")[0].scrollHeight);

    function selectFirstUser() {
        $.each($(".chat-list ul.chatTabs"), function (index, item) {
            var $firstChatUser = $(item).find("li:first");
            var userId = $firstChatUser.find("input[name='userId']").val();
            var messageId = $firstChatUser.find("input[name='messageId']").val();
            $firstChatUser.addClass('active');
            $firstChatUser.find('.chat-tab-content.fa-circle').removeClass('active');
            if ($firstChatUser.find('i.fa-circle').hasClass('active')) {
                var unread = $messageNotification.find('numbers').html() - 1;
                $messageNotification.find('numbers').html(unread);
                if (unread == 0) {
                    $messageNotification.find('numbers').css("display", "none");
                }
            }
            populateProfile(userId);
            populateMessages(messageId);
        });
    }

    function populateChatQueue() {
        var chat_tabs_source = $('.chat-list-template').html();
        var chat_tabs_template = Handlebars.compile(chat_tabs_source);
        $.ajax({
            type: "GET",
            async: false,
            url: SIH.getEndPoint("/api/auth/user/message/queue?page=" + chatMessageUser),
            headers: xTokenHeader
        }).done(function (data) {
            if (data.last) {
                $(".chat-list").find(".addMoreUser").remove();
            }
            if (chatMessageUser == 0) {
                $('.chat-list ul.chatTabs').html('');
            }
            $('.chat-list ul.chatTabs').append(chat_tabs_template(data.content));
            return false;
        });

        if(sessionStorage.getItem("messageToUniqueId")){
            $.ajax({
                type: "GET",
                data: {"toUserId": sessionStorage.getItem("messageToUniqueId")},
                url: SIH.getEndPoint("/api/auth/user/message/queue/user"),
                headers: xTokenHeader
            }).done(function (data) {
                console.log("-------------------------");
                console.log(data);
                console.log("-------------------------");

                $('.chat-list ul.chatTabs').prepend(chat_tabs_template([data]));

                return false;
            });
        }
    }

    function populateProfile(userID) {
        var current_profile_source = $('.chatCurrentProfileTemplate').html();
        var current_profile_template = Handlebars.compile(current_profile_source);
        $.ajax({
            type: "GET",
            async: false,
            url: SIH.getEndPoint("/api/auth/user/profile/" + userID),
            headers: xTokenHeader
        }).done(function (data) {
            var $profile = $tab.find('.side-cards.desktop-display-block');

            $profile.html('');
            $profile.append(current_profile_template(data.user));
            $profile.find('a').attr("href", $profile.siblings('input[name="profilePagePath"]').val() + "." + data.user.role + "." + data.user.uniqueId + ".html");
            userName = data.user.name;
            return false;
        });
    }

    function populateMessages(messageID) {
        var current_messages_source = $('.chatComponentTemplate').html();
        var current_messages_template = Handlebars.compile(current_messages_source);
        $.ajax({
            type: "GET",
            async: false,
            url: SIH.getEndPoint("/api/auth/user/message/queue/" + messageID + "?page=" + chatMessagePage),
            headers: xTokenHeader
        }).done(function (data) {
            var $currentChat = $tab.find('.main-cards .tab-pane-message .chat-text');
            if (chatMessagePage == 0)
                $currentChat.html('');
            $currentChat.prepend(current_messages_template(data.content.reverse()));
            $tab.find(".chat-others h5").html(userName);
            $tab.find(".chat-date input[name='chatMessageId']").val(messageID);
            return false;
        });
    }


    function sendMessage(userID, msg, isNewUser) {
        $.ajax({
            type: "POST",
            data: msg,
            async: false,
            contentType: "application/json",
            url: SIH.getEndPoint("/api/auth/user/message/send/" + userID),
            headers: xTokenHeader
        }).done(function (data) {
            if (data) {
                if (isNewUser) {
                    $tab.find('.chat-component .main-cards').css("display", "block");
                    $tab.find('.chat-component .new-user').css("display", "none");
                    var messageId = $tab.find("li.active .chat-tab-heading input[name='messageId']").val();
                    populateMessages(messageId);
                    $tab.find(".chat-others h5").html(userName);
                } else {
                    var currentTime = new Date().getTime();
                    var html = "<div class='chat-own chat-panes clearfix'><div class='chat-container'><p>" + msg.replace(new RegExp('\n', 'g'), "<br/>")
                        + "</p></div><div class='chat-time clearfix'><span>Just Now</span><input type='hidden' name='time' value='" + currentTime + "'/></div></div>";
                    $tab.find('.main-cards .tab-pane-message .chat-text').append(html);
                }
                $(".chat-text").scrollTop($(".chat-text")[0].scrollHeight);

                // deleting uniqueId when enabler has sent message to non-connected user
                if(sessionStorage.getItem("messageToUniqueId")) {
                    sessionStorage.removeItem("messageToUniqueId");
                }
            }
            return false;
        });
    }

    $(document).on('click', '.chat-list ul li', function () {
        chatMessagePage = 0;
        $('.chat-list ul li').removeClass("active");
        $(this).addClass("active");
        var userID = $(this).find("input[name='userId']").val();
        var messageID = $(this).find("input[name='messageId']").val();
        $tab.find('textarea.form-control').val('');
        $tab.find('.chat-component .main-cards').css("display", "block");
        $tab.find('.chat-component .new-user').css("display", "none");
        populateProfile(userID, $(this));
        populateMessages(messageID);
        $tab.find(".chat-others h5").html(userName);
        if ($(this).find('i.fa-circle').hasClass('active')) {
            var unread = $messageNotification.find('numbers').html() - 1;
            $messageNotification.find('numbers').html(unread);
            if (unread == 0) {
                $messageNotification.find('numbers').css("display", "none");
            }
        }
        $(this).find("i.fa-circle").removeClass('active');
        if (windowSize < 768) {
            $tab.find(".chat-tabs .side-cards.chat-list").css("display", "none");
            $tab.find(".chat-component .main-cards").css("display", "block");
            $tab.find(".chat-component .list-chat-user").css("display", "block");
        }
    });

    $("div#list-popover").find('ul.result-list').on('click', 'li', function () {
        chatMessagePage = 0;
        $tab.find(".noChatMessage").addClass("displayNone");
        $tab.find('.chat-current-profile .side-cards').addClass("desktop-display-block");
        var uId = $(this).find('input').val();
        populateNewUser(uId);
        $searchInput.val(userName);
    });

    $(".main-cards").find("textarea.form-control").keyup(function (event) {
        if (event.which == 13) {
            if (event.shiftKey) {
                event.stopPropagation();
            } else {
                this.value = this.value.trim();
                var userID = $(".chatTabs > li.active").find("input[name='userId']");
                if (this.value) {
                    sendMessage($(userID).val(), this.value, false);
                    var $activeUser = $tab.find("ul.chatTabs li.active");
                    $activeUser.prependTo($activeUser.parent());
                    $activeUser.find('.chat-tab-status').html(this.value);
                    $activeUser.find('.pull-right').html('Just Now');
                    var timeInput = $activeUser.find('.chat-tab-heading').find('input[name="time"]');
                    if (timeInput.length === 1) {
                        $(timeInput).val(new Date().getTime());
                    } else {
                        var time = new Date().getTime();
                        $activeUser.find('.chat-tab-heading').append('<input type="hidden" name="time" value="' + time + '">');
                    }

                }
                this.value = '';
            }
        }
    });
    $(".new-user").find("textarea.form-control").keyup(function (event) {
        if (event.which == 13) {
            if (event.shiftKey) {
                event.stopPropagation();
            } else {
                var userID = $(".new-user").find("input[name='userId']");
                this.value = this.value.trim();
                if (this.value) {
                    sendMessage($(userID).val(), this.value, true);
                    populateChatQueue();
                    selectFirstUser();
                }
                this.value = '';
            }
        }
    });

    $searchInput.keyup(function (event) {
        searchChatConnection();
    });

    function searchChatConnection() {
        var source = $('#chatListPopoverTemplate').html();
        var template = Handlebars.compile(source);
        var url = SIH.getEndPoint('/api/auth/user/connections?query=') + $tab.find('.search').val();
        $.ajax({
            url: url,
            type: 'GET',
            dataType: 'json',
            beforeSend: setAuthTokenHeader,
            success: function (data) {
                if (data.content.length > 0) {
                    $('div#list-popover ul').html('');
                    $('div#list-popover ul').append(template(data.content));
                } else {
                    $('div#list-popover ul').html('<li>No Suggestions!!</li>');
                }
            }
        });
    }

    $searchInput.click(function (event) {
        searchChatConnection();
    });

    function populateNewUser(uId) {
        var userInput = $tab.find(".chatTabs input[name='userId']");
        var $userAlreadyMessaged;
        $.each(userInput, function (index, item) {
            if ($(item).val() == uId) {
                $userAlreadyMessaged = $(item).parents().eq(3);
                $userAlreadyMessaged.siblings().removeClass("active");
                $userAlreadyMessaged.addClass("active");
                $userAlreadyMessaged.find("i.fa-circle").removeClass('active');
                populateProfile(uId);
                $tab.find('.chat-component .main-cards').css("display", "block");
                $tab.find('.chat-component .new-user').css("display", "none");
                populateMessages($($(item).siblings("input[name='messageId']")).val());
            }
        });
        if (!$userAlreadyMessaged) {
            $(".chat-list ul li").removeClass('active');
            $tab.find('.chat-component .main-cards').css("display", "none");
            $tab.find('.chat-component .new-user').css("display", "block");
            populateProfile(uId);
            $(".new-user").find('.mail-to span.toUserName').html(userName);
            $(".new-user").find("input[name='userId']").val(uId);
        }
    }

    setInterval(function () {
        var timeinMilliSec;
        var time;
        var date = new Date();
        $.each($('.tab-pane-message .chat-text').find("input[name='time']"), function (index, item) {
            timeinMilliSec = $(item).val();
            time = dateDiff(date, timeinMilliSec);
            $(item).siblings('span').html(time);
        });
        $.each($('ul#chatTabsList li').find("input[name='time']"), function (index, item) {
            timeinMilliSec = $(item).val();
            time = dateDiff(date, timeinMilliSec);
            $(item).siblings('span').html(time);
        });
    }, 1000);

    $(".tab-pane-message").on('click', '.chat-date a', function () {
        var messageId = $tab.find(".chat-date input[name='chatMessageId']").val();
        chatMessagePage = chatMessagePage + 1;
        populateMessages(messageId);
        $(this).parent().remove();
    });

    $(".chat-list").find("#loadMoreIcon").click(function () {
        var $loader = $tab.find(".chat-list .chat-loader");
        $loader.show();
        chatMessageUser = chatMessageUser + 1;
        populateChatQueue();
        var $chatList = $tab.find("ul#chatTabsList");
        $chatList.scrollTop($chatList[0].scrollHeight);
        $loader.hide();
    });

    $tab.find(".chat-component").on('click', '.list-chat-user', function () {
        $tab.find(".chat-component .main-cards").css("display", "none");
        $tab.find(".chat-tabs .side-cards.chat-list").css("display", "block");
        $(this).css("display", "none");

    });
};



$.logoRequest = function () {
    var formData = new FormData();
    var isValidated;
    $("#event_date").datepicker({minDate: 0, dateFormat: 'dd-mm-yy'});

    var $previewModal = $(".logo-request-preview-modal");
    var $thankyouModal = $(".logo-request-submit-message");
    var $errorModal = $(".logo-request-error-message");

    getState0rUnionPopulated();

    function getState0rUnionPopulated() {


        $.ajax({
            type: "GET",
            dataType: "json",
            url: $("#stateOrUnionApi").val(),
            success: function (data) {
                $('#state_name').html("<option>Select State / Union Territory</option>");
                $.each(data.states, function (i, value) {
                    $('#state_name').append("<option value=" + value.state_id + ">" + value.state_name + "</option>");
                });
            },
            error: function () {
                $errorModal.modal('show');
            }
        });
    }

    function clearFields() {
        $("form#registrationApp")[0].reset();
        if (grecaptcha) {
            grecaptcha.reset();
        }
    }

    function getLogoFormData() {
        isValidated = true;
        var inputField = $("form#registrationApp").find(".textBoxOut .form-control");
        $.each(inputField, function (index, inputSel) {
            var key = $(inputSel).attr("name");
            if (typeof key != "undefined" && $(inputSel).parents('.additional-doc-full').length == 0) {
                var attrValue = $(inputSel).val();
                if (key === 'event_date' && attrValue) {
                    var dateParts = attrValue.split('-');
                    attrValue = dateParts[2] + "/" + dateParts[1] + "/" + dateParts[0];
                }
                if (key === "self_certification") {
                    if (attrValue === "on") {
                        attrValue = "1";
                    } else {
                        attrValue = "2"
                    }
                }
                if (attrValue) {
                    formData.delete(key);
                    formData.append(key, attrValue.toString());
                }
            }
            else {
                var additional_documents;
                var selfCertificateList = [];
                var oth = 0;
                var docLinksArray = $('#add-file-field').closest('.row').find("#moreupload .upload-row").children();
                $.each(docLinksArray, function (index, value) {
                    additional_documents = {};
                    var inputDoc = $(value).find("input");
                    $.each(inputDoc, function (i, val) {
                        var $selfCertiDoc = $(val).parents(".selfCertiDoc");
                        if (!$selfCertiDoc.hasClass("display-n")) {
                            additional_documents["name"] = $(value).find("select").val();
                            if ($selfCertiDoc.hasClass("add_doc_file")) {
                                if ($(val).prop("type") === "text" && $(val).val() !== "") {
                                    additional_documents["value"] = $(val).val();
                                } else if (val.files) {
                                    if (val.files.length > 0) {
                                        oth = oth + 1;
                                        additional_documents["value"] = "Other" + oth;
                                        formData.delete("Other" + oth);
                                        formData.append("Other" + oth, val.files[0]);
                                        $(val).closest('.add_doc_file').removeClass('has-error');
                                    } else if (!$(val).parent().hasClass('display-n')) {
                                        isValidated = false;
                                        $(val).closest('.add_doc_file').addClass('has-error');
                                    }

                                }
                            } else {
                                if (!$(val).val()) {
                                    isValidated = false;
                                    $(val).closest('.add_doc_desc').addClass('has-error');
                                } else if ($(val).val() && !($(val).val().startsWith("https") || $(val).val().startsWith("http"))) {
                                    isValidated = false;
                                    $(val).closest('.add_doc_desc').find('.help-block').html('Link should start with either http or https');
                                    $(val).closest('.add_doc_desc').addClass('has-error');
                                }
                                else {
                                    $(val).closest('.add_doc_desc').removeClass('has-error');
                                }
                                additional_documents["value"] = $(val).val();
                            }
                        }
                    });

                    if (!jQuery.isEmptyObject(additional_documents)) {
                        selfCertificateList.push(JSON.stringify(additional_documents));
                    }
                });
                if (selfCertificateList.length > 0) {
                    formData.delete("additional_documents");
                    formData.append("additional_documents", ("{\"SelfCertification\" : [" + selfCertificateList.toString() + "]}").replace(/\\/g, ""));
                }
            }
            checkRequiredField(attrValue, inputSel);
        });
        checkLogoAdditionalDocsValidation();
        isValidated = validateRegexFields($(".regex-val"), isValidated);
        checkTextareaWordLimit();
    }

    function checkRequiredField(attrValue, inputSel) {
        var requiredField = $(inputSel).closest(".form-group").find("sup.required:visible");
        if (requiredField && $(inputSel).attr("type") === "checkbox") {
            if (!$(inputSel).prop('checked')) {
                isValidated = false;
                $(inputSel).closest(".form-group").addClass("has-error").find("div.help-block").first().html("This field can't be left Blank.");
            } else {
                $(inputSel).closest(".form-group").removeClass("has-error").find("div.help-block").first().html("");
            }
        } else if (requiredField && requiredField.length > 0 && (!attrValue || attrValue === "")) {
            isValidated = false;
            $(inputSel).closest(".form-group").addClass("has-error").find("div.help-block").first().html("This field can't be left Blank.");
        } else {
            $(inputSel).closest(".form-group").removeClass("has-error").find("div.help-block").first().html("");
        }
    }

    $('#organized_startup_events').on('change', function () {
        if ($(this).val() === '1') {
            $('#previous_event_details').closest('.form-group').removeClass('display-n');
        } else {
            $('#previous_event_details').closest('.form-group').addClass('display-n');
        }
    });
    $('#organization_entity_category').on('change', function () {
        if ($(this).val() === '1') {
            $('.govt-psus').removeClass('display-n');
            $('.industry-bodies').addClass('display-n');

        } else if ($(this).val() === '2') {
            $('.industry-bodies').removeClass('display-n');
            $('.govt-psus').addClass('display-n');
        } else {
            $('.industry-bodies,.govt-psus').addClass('display-n');
        }
        $("[name=organization_entity_subcategory]").val("");
        $('.other-industry').addClass('display-n');
        $('input[name=organization_other_subcategory]').val("");
    });
    $("#moreupload").on("change", ".selectDoc", function (e) {
        showHideOption($(this));
    });

    function showHideOption($this) {
        var addDoc = $($this).val();
        var docArea = $($this).parent().next().find(".doc_area");
        $(docArea).parent().removeClass("display-n");
        $(docArea).parents(".form-group").first().find(".removeFile").parent().removeClass("display-n");
        if (addDoc === "weburl") {
            $(docArea).find(".add_doc_desc").removeClass("display-n").next().addClass("display-n");
        } else if (addDoc === "flyer") {
            $(docArea).find(".add_doc_file").removeClass("display-n").prev().addClass("display-n");
        } else if (addDoc === "pamphlet") {
            $(docArea).find(".add_doc_file").removeClass("display-n").prev().addClass("display-n");
        } else if (addDoc === "others") {
            $(docArea).find(".add_doc_file").removeClass("display-n").prev().addClass("display-n");
        }
        $($("#moreupload .upload-row .form-group")[0]).find(".removeFile").remove();
    }

    function addmoreupload() {
        var $uploadRow = $("#moreupload .upload-row");
        $(".demo-linkOrDocTemplate").find("a.removeFile").parent().addClass("display-n");
        var linknDocTemplate = $(".demo-linkOrDocTemplate").first().html();
        $uploadRow.append(linknDocTemplate);
        $.each($uploadRow.find(".form-group"), function (index) {
            $(this).find("select").attr("name", "selfcertification[" + (index + 1) + "]");
            $(this).find(".add_doc_desc input[type='text']").attr("name", "docAsText[" + (index + 1) + "]");
            $(this).find(".add_doc_file input[type='file']").attr("name", "docAsFile[" + (index + 1) + "]");
            $(this).find(".add_doc_file input[type='text']").attr("name", "docAsFileName[" + (index + 1) + "]");
        });
    }

    $(".logo-request-form .upload-row").on("click", ".form-group a.removeFile", function () {
        $(this).closest(".form-group").remove();
        var $uploadRow = $("#moreupload .upload-row");
        $.each($uploadRow.find(".form-group"), function (index) {
            $(this).find("select").attr("name", "selfcertification[" + (index + 1) + "]");
            $(this).find(".add_doc_desc input[type='text']").attr("name", "docAsText[" + (index + 1) + "]");
            $(this).find(".add_doc_file input[type='file']").attr("name", "docAsFile[" + (index + 1) + "]");
            $(this).find(".add_doc_file input[type='file']").attr("name", "docAsFileName[" + (index + 1) + "]");
        });
    });

    $('.industry-subcategory').on('change', function () {
        if ($(this).val() === '5') {
            $('.other-industry').removeClass('display-n');
        } else {
            $('.other-industry').addClass('display-n');
            $('input[name=organization_other_subcategory]').val("");
        }
    });

    $(".logo-request-form #add-file-field").on('click', function () {
        addmoreupload();
    });

    $("#logoFormSubmit").click(function (e) {
        // e.preventDefault();
        //  e.stopPropagation();
        getLogoFormData();
        if (isValidated && !e.isDefaultPrevented() && validateCaptcha($("form#registrationApp"), logoFormCaptchaId)) {
            $('#modal-loader').modal('show');
            $.ajax({
                type: "POST",
                dataType: "json",
                data: formData,
                contentType: false,
                processData: false,
                url: $("#logoRequestApi").val(),
                success: function (data) {
                    $('#modal-loader').modal('hide');
                    if (data._resultflag === '1') {
                        $thankyouModal.modal('show');
                        $("div.error-block span").html('');
                        $("div.error-block").hide();
                        clearFields();

                    } else {
                        $("div.error-block").show();
                        $("div.error-block span").html(data.message);
                    }
                },
                error: function () {
                    $('#modal-loader').modal('hide');
                    $errorModal.modal('show');
                }
            });
        } else {
            logoErrorScrollTop();
        }
        return false;
    });

    function logoErrorScrollTop() {
        var _firstErrorElem = $(".form-group.has-error,.scroll-error,.certify-has-error,.add_doc_file.has-error, td.has-error:first, .selfCertiDoc.has-error").first();
        if (_firstErrorElem && _firstErrorElem.offset()) {
            $('html, body').animate({
                scrollTop: _firstErrorElem.offset().top - 120
            });
        }
    }

    $(".registrationAppForm input[type='number']").keypress(function (e) {
        var a = [];
        var k = e.which;
        for (var i = 48; i < 58; i++)
            a.push(i);

        if (!(a.indexOf(k) >= 0))
            e.preventDefault();
    });

    $("#cmdpreview").click(function () {
        $previewModal.find("#popupname").html($("input[name='applicant_name']").val());
        $previewModal.find("#tele").html($("input[name='std_code']").val() + " - " + $("input[name='telephone_no']").val());
        $previewModal.find("#mob").html($("input[name='mobile']").val());
        $previewModal.find("#ema").html($("input[name='email']").val());
        $previewModal.find("#org").html($("input[name='applicant_organization']").val());
        $previewModal.find("#desig").html($("input[name='designation']").val());
        $("select[name='organized_startup_events'] option:selected").val() ? $previewModal.find("#startupEve").html($("select[name='organized_startup_events'] option:selected").text()) : $previewModal.find("#startupEve").html('');

        $("select[name='organization_entity_category'] option:selected").val() ? $previewModal.find("#entityCateg").html($("select[name='organization_entity_category'] option:selected").text()) : $previewModal.find("#entityCateg").html('');
        if ($("select[name='organization_entity_category'] option:selected").val() === "1") {
            $($("select[name='organization_entity_subcategory']")[0]).find("option:selected").val() ?
                $previewModal.find("#entityCateg").append("<br>" + $($("select[name='organization_entity_subcategory']")[0]).find("option:selected").text()) : "";
        }
        if ($("select[name='organization_entity_category'] option:selected").val() === "2") {
            $($("select[name='organization_entity_subcategory']")[1]).find("option:selected").val() ?
                $previewModal.find("#entityCateg").append("<br>" + $($("select[name='organization_entity_subcategory']")[1]).find("option:selected").text()) : "";
        }
        $previewModal.find("#entityCateg").append("<br>" + $("input[name='organization_other_subcategory']").val());
        $previewModal.find("#previousEvent").html($("textarea[name='previous_event_details']").val());
        $previewModal.find("#cit").html($("input[name='city']").val());
        $previewModal.find("#eventVenue").html($("input[name='event_venue']").val());
        $("select[name='state'] option:selected").val() ? $previewModal.find("#stat").html($("select[name='state'] option:selected").text()) : $previewModal.find("#stat").html('');
        $previewModal.find("#pin").html($("input[name='pincode']").val());
        $previewModal.find("#organizeraddress").html($("textarea[name='organizer_address']").val());
        $previewModal.find("#eventname").html($("input[name='event_name']").val());
        $previewModal.find("#dateevent").html($("input[name='event_date']").val());
        $("select[name='nature_of_entity'] option:selected").val() ? $previewModal.find("#nat").html($("select[name='nature_of_entity'] option:selected").text()) : $previewModal.find("#nat").html('');
        $previewModal.find("#organisename").html($("input[name='organisation_entity']").val());
        $previewModal.find("#detail").html($("textarea[name='detail_participant_entity']").val());
        $previewModal.find("#partner").html($("textarea[name='partnering_entity_details']").val());
        $previewModal.find("#pur").html($("textarea[name='logo_used_purpose']").val());
        var usage = "";
        $("select[name='logo_usage'] option:selected").each(function (index, val) {
            usage = usage + $(this).text() + ",";
        });
        // $("select[name='logo_usage'] option:selected").val() ? $previewModal.find("#logoUsage").html($) : $previewModal.find("#logoUsage").html('');
        $previewModal.find("#logoUsage").html(usage.substr(0, usage.length - 1));
        $previewModal.find("#rele").html($("textarea[name='relevance_text']").val());
        $previewModal.find("#spe").html($("textarea[name='request_speaker']").val());
        $previewModal.find("#com").html($("textarea[name='additional_comment']").val());
        $previewModal.modal('show');
    });

    function checkLogoAdditionalDocsValidation() {
        var valid = true;
        $("#moreupload input:visible, #moreupload select:visible").each(function (id, val) {
            if (!$(this).val()) {
                valid = false;
            }
        });
        if (!valid) {
            if ($("#moreupload").parent().find('.additional-doc-error-span').length === 0) {
                $("#moreupload").parent().append("<span class='help-block additional-doc-error-span'>Additional Document is mandatory</span>");
            }
            $("#moreupload").closest('.form-group').addClass('has-error');
            isValidated = false;
        } else {
            $("#moreupload").parent().children("span.additional-doc-error-span").remove();
            $("#moreupload").closest('.form-group').removeClass('has-error');
        }
    }

    $("#moreupload .upload-row").on('change', ".fileUploadField input[type=file]", function (event) {
        event.preventDefault();
        var formats = ["application/pdf"];
        checkFileUpload(formats, this, 5150000);
        return false;
    });


    function checkFileUpload(selectedFormats, fileToValidate, size) {

        var message = "";
        if ($(fileToValidate).val() !== "") {
            if (fileToValidate.files[0].size > size) {
                message = "File Should not be greater then " + Math.floor(size / 1024000) + " MB.";
            }
            if (jQuery.inArray(fileToValidate.files[0].type, selectedFormats) === -1) {
                var fileTypes = [];
                $.each(selectedFormats, function (i, val) {
                    fileTypes.push(" " + val.split("/")[1]);
                });
                message = message + " Please upload" + fileTypes.toString() + " file formats.";
            }
            if (message !== "") {
                isValidated = false;
                $(fileToValidate).siblings(".help-block").html(message).parents(".form-group").addClass("has-error");
                $(fileToValidate).val("");
                $(fileToValidate).siblings(".fileName").val("");
                $(fileToValidate).siblings(".fileDisplayName").val("");
                $(fileToValidate).siblings("a.presentationLink").addClass("display-n");
            } else {
                $(fileToValidate).closest(".form-group").find('.incorporation_certificate_filename').addClass("display-n");
                $(fileToValidate).siblings("a.presentationLink").addClass("display-n");
                $(fileToValidate).siblings(".help-block").html("");
                $(fileToValidate).parents(".form-group").first().removeClass("has-error");
            }
        }
    }

    function infoRequiredData(accordianItem, fieldName) {
        var inputSelection = $(accordianItem).find("input[name='" + fieldName + "']:checked");
        var attrValue = $(inputSelection).val();
        if (attrValue) {
            formData.delete(fieldName);
            formData.append(fieldName, attrValue.toString());
        }
        checkRequiredField(attrValue, $(accordianItem).find("input[name='" + fieldName + "']"));
    }


    function checkTextareaWordLimit() {
        $('textarea').each(function () {
            if ($(this).val() && $(this).val().match(/\S+/g).length < 50 && ($(this).attr("name") == "detail_participant_entity" || $(this).attr("name") == "previous_event_details")) {
                isValidated = false;
                $(this).closest(".form-group").addClass('has-error');
                $(this).closest(".form-group").find('.help-block').html('Please elaborate further with more information in mininum 50 words.');
            } else if ($(this).val() && $(this).val().match(/\S+/g).length > 250) {
                isValidated = false;
                $(this).closest(".form-group").addClass('has-error');
                $(this).closest(".form-group").find('.help-block').html('You have crossed the maximum word limit of 250 words.');
            } else if (isValidated) {
                $(this).closest(".form-group").removeClass('has-error');
                $(this).closest(".form-group").find('.help-block').html('');
            }
        });
    }

    $("#add-file-field").trigger("click");
    $(".regex-msg").hide();
};

(function (root, factory) {
    if (typeof define === 'function' && define.amd) {
        // AMD. Register as an anonymous module.
        define([], factory);
    } else if (typeof module === 'object' && module.exports) {
        // Node. Does not work with strict CommonJS, but
        // only CommonJS-like environments that support module.exports,
        // like Node.
        module.exports = factory();
    } else {
        // Browser globals (root is window)
        root.PDFObject = factory();
    }
}(this, function () {

    "use strict";
    //jshint unused:true

    //PDFObject is designed for client-side (browsers), not server-side (node)
    //Will choke on undefined navigator and window vars when run on server
    //Return boolean false and exit function when running server-side

    if (typeof window === "undefined" || typeof navigator === "undefined") {
        return false;
    }

    var pdfobjectversion = "2.0.201604172",
        supportsPDFs,

        //declare functions
        createAXO,
        isIE,
        supportsPdfMimeType = (typeof navigator.mimeTypes['application/pdf'] !== "undefined"),
        supportsPdfActiveX,
        buildFragmentString,
        log,
        embedError,
        embed,
        getTargetElement,
        generatePDFJSiframe,
        isIOS = (function () {
            return (/iphone|ipad|ipod/i.test(navigator.userAgent.toLowerCase()));
        })(),
        generateEmbedElement;


    /* ----------------------------------------------------
       Supporting functions
       ---------------------------------------------------- */

    createAXO = function (type) {
        var ax;
        try {
            ax = new ActiveXObject(type);
        } catch (e) {
            ax = null; //ensure ax remains null
        }
        return ax;
    };

    //IE11 still uses ActiveX for Adobe Reader, but IE 11 doesn't expose
    //window.ActiveXObject the same way previous versions of IE did
    //window.ActiveXObject will evaluate to false in IE 11, but "ActiveXObject" in window evaluates to true
    //so check the first one for older IE, and the second for IE11
    //FWIW, MS Edge (replacing IE11) does not support ActiveX at all, both will evaluate false
    //Constructed as a method (not a prop) to avoid unneccesarry overhead -- will only be evaluated if needed
    isIE = function () {
        return !!(window.ActiveXObject || "ActiveXObject" in window);
    };

    //If either ActiveX support for "AcroPDF.PDF" or "PDF.PdfCtrl" are found, return true
    //Constructed as a method (not a prop) to avoid unneccesarry overhead -- will only be evaluated if needed
    supportsPdfActiveX = function () {
        return !!(createAXO("AcroPDF.PDF") || createAXO("PDF.PdfCtrl"));
    };

    //Determines whether PDF support is available
    supportsPDFs = (supportsPdfMimeType || (isIE() && supportsPdfActiveX()));

    //Create a fragment identifier for using PDF Open parameters when embedding PDF
    buildFragmentString = function (pdfParams) {

        var string = "",
            prop;

        if (pdfParams) {

            for (prop in pdfParams) {
                if (pdfParams.hasOwnProperty(prop)) {
                    string += encodeURIComponent(prop) + "=" + encodeURIComponent(pdfParams[prop]) + "&";
                }
            }

            //The string will be empty if no PDF Params found
            if (string) {

                string = "#" + string;

                //Remove last ampersand
                string = string.slice(0, string.length - 1);

            }

        }

        return string;

    };

    log = function (msg) {
        if (typeof console !== "undefined" && console.log) {
            console.log("[PDFObject] " + msg);
        }
    };

    embedError = function (msg) {
        log(msg);
        return false;
    };

    getTargetElement = function (targetSelector) {

        //Default to body for full-browser PDF
        var targetNode = document.body;

        //If a targetSelector is specified, check to see whether
        //it's passing a selector, jQuery object, or an HTML element

        if (typeof targetSelector === "string") {

            //Is CSS selector
            targetNode = document.querySelector(targetSelector);

        } else if (typeof jQuery !== "undefined" && targetSelector instanceof jQuery && targetSelector.length) {

            //Is jQuery element. Extract HTML node
            targetNode = targetSelector.get(0);

        } else if (typeof targetSelector.nodeType !== "undefined" && targetSelector.nodeType === 1) {

            //Is HTML element
            targetNode = targetSelector;

        }

        return targetNode;

    };

    generatePDFJSiframe = function (targetNode, url, pdfOpenFragment, PDFJS_URL, id) {

        var fullURL = PDFJS_URL + "?file=" + encodeURIComponent(url) + pdfOpenFragment;
        var scrollfix = (isIOS) ? "-webkit-overflow-scrolling: touch; overflow-y: scroll; " : "overflow: hidden; ";
        var iframe = "<div style='" + scrollfix + "position: absolute; top: 0; right: 0; bottom: 0; left: 0;'><iframe  " + id + " src='" + fullURL + "' style='border: none; width: 100%; height: 100%;' frameborder='0'></iframe></div>";
        targetNode.className += " pdfobject-container";
        targetNode.style.position = "relative";
        targetNode.style.overflow = "auto";
        targetNode.innerHTML = iframe;
        return targetNode.getElementsByTagName("iframe")[0];

    };

    generateEmbedElement = function (targetNode, targetSelector, url, pdfOpenFragment, width, height, id) {

        var style = "";

        if (targetSelector && targetSelector !== document.body) {
            style = "width: " + width + "; height: " + height + ";";
        } else {
            style = "position: absolute; top: 0; right: 0; bottom: 0; left: 0; width: 100%; height: 100%;";
        }

        targetNode.className += " pdfobject-container";
        targetNode.innerHTML = "<embed " + id + " class='pdfobject' src='" + url + pdfOpenFragment + "' type='application/pdf' style='overflow: auto; " + style + "'/>";

        return targetNode.getElementsByTagName("embed")[0];

    };

    embed = function (url, targetSelector, options) {

        //Ensure URL is available. If not, exit now.
        if (typeof url !== "string") {
            return embedError("URL is not valid");
        }

        //If targetSelector is not defined, convert to boolean
        targetSelector = (typeof targetSelector !== "undefined") ? targetSelector : false;

        //Ensure options object is not undefined -- enables easier error checking below
        options = (typeof options !== "undefined") ? options : {};

        //Get passed options, or set reasonable defaults
        var id = (options.id && typeof options.id === "string") ? "id='" + options.id + "'" : "",
            page = (options.page) ? options.page : false,
            pdfOpenParams = (options.pdfOpenParams) ? options.pdfOpenParams : {},
            fallbackLink = (typeof options.fallbackLink !== "undefined") ? options.fallbackLink : true,
            width = (options.width) ? options.width : "100%",
            height = (options.height) ? options.height : "100%",
            forcePDFJS = (typeof options.forcePDFJS === "boolean") ? options.forcePDFJS : false,
            PDFJS_URL = (options.PDFJS_URL) ? options.PDFJS_URL : false,
            targetNode = getTargetElement(targetSelector),
            fallbackHTML = "",
            pdfOpenFragment = "",
            fallbackHTML_default = "<p>This browser does not support inline PDFs. Please download the PDF to view it: <a href='[url]'>Download PDF</a></p>";

        //If target element is specified but is not valid, exit without doing anything
        if (!targetNode) {
            return embedError("Target element cannot be determined");
        }


        //page option overrides pdfOpenParams, if found
        if (page) {
            pdfOpenParams.page = page;
        }

        //Stringify optional Adobe params for opening document (as fragment identifier)
        pdfOpenFragment = buildFragmentString(pdfOpenParams);

        //Do the dance
        if (forcePDFJS && PDFJS_URL) {

            return generatePDFJSiframe(targetNode, url, pdfOpenFragment, PDFJS_URL, id);

        } else if (supportsPDFs) {

            return generateEmbedElement(targetNode, targetSelector, url, pdfOpenFragment, width, height, id);

        } else {

            if (PDFJS_URL) {

                return generatePDFJSiframe(targetNode, url, pdfOpenFragment, PDFJS_URL, id);

            } else if (fallbackLink) {

                fallbackHTML = (typeof fallbackLink === "string") ? fallbackLink : fallbackHTML_default;
                targetNode.innerHTML = fallbackHTML.replace(/\[url\]/g, url);

            }

            return embedError("This browser does not support embedded PDFs");

        }

    };

    return {
        embed: function (a, b, c) {
            return embed(a, b, c);
        },
        pdfobjectversion: (function () {
            return pdfobjectversion;
        })(),
        supportsPDFs: (function () {
            return supportsPDFs;
        })()
    };

}));

$.championSpeaker = function () {
    var $answer = $(".champions-main .show-read-more");

    $.each($answer, function (index, answer) {
        var height = 0;
        $(answer).find('p').each(function () {
            height += parseInt($(this).outerHeight(true));
        });
        if (70 < height) {
            $(answer).siblings(".read-desc").removeClass("hidden");
        }
    });
};

$(".startup-themes a").click(function () {
    var $startupThemes = $(this).parents(".startup-themes");
    store.setItem("themeCode", $startupThemes.find(".themeCode").html());
    store.setItem("themeTitle", $startupThemes.find("h2").html());
    store.setItem("themeImage", $startupThemes.find("img").attr("src"));
    store.setItem("themeDescription", $startupThemes.find(".themeDescription").html());
    // window.location = $(this).attr("href");
});

var amsApplication = {
    getImageAPI: SIH.getEndPoint("/api/file/ams/banner/logo"),
    images: {},
    compressedImages: {},
    isValidated: false,
    logoSelect: "",
    errorMappingObj: {}
};

$('form.ams-application-form .multiCheck-selection-all').each(function () {
    var checkedInputs = $(this).find('input.addAll:checked').length;
    if (checkedInputs && (checkedInputs == $(this).find('input.addAll').length)) {
        $(this).find("input[name=addAll]").prop('checked', true);
    }
});

$(document).on("change", ".ams-application-form select[name=userType]", function (event) {
    if ($(".ams-application-form #userType option[value=individual]:selected").length > 0) {
        if (!$('.ams-application-form #educationalCriteria').closest('.row').find('.required').length > 0) {
            $('.ams-application-form #educationalCriteria').closest('.row').find('.control-label').append('<sup class="required">*</sup>');
        }
    } else {
        $('.ams-application-form #educationalCriteria').closest('.row').find('.required').remove()
    }
});
$(document).on('change', ".ams-application-form select[name=incentiveType]", function (event) {
    var $target = $(event.target);
    $target.find("option:selected").each(function () {
        var field = $('textarea[name=' + $(this).val() + ']').closest('.baseformfield');
        var label = field.find('.control-label');
        if (field.hasClass('display-n')) {
            field.removeClass('display-n');
            label.append('<sup class="required">*</sup>');
        }
    });
    $target.find("option:not(:selected)").each(function () {
        var field = $('textarea[name=' + $(this).val() + ']').closest('.baseformfield');
        var supRequired = field.find('.control-label sup');
        if (!field.hasClass('display-n') && supRequired) {
            field.addClass('display-n');
            $("textarea[name=" + $(this).val() + "].richTextArea").summernote("code", "");
            supRequired.remove();
        }
    });

});
$(document).on('change', 'input[name=emailSubscribed]', function (event) {
    if ($(event.target).val() == "true") {
        if (!$('input[name=receipientEmail]').val()) {
            $('input[name=receipientEmail]').val(store.getItem('email'));
        }
        $('input[name=receipientEmail]').closest('.form-group').removeClass('display-n');
        $("[name=receipientEmail]").removeClass("display-n")
    } else {
        $('input[name=receipientEmail]').closest('.form-group').addClass('display-n');
        $("[name=receipientEmail]").addClass("display-n")
    }
});


function setStakeHoldersList() {
    var params = {};
    var $selection = $(".ams-application-form #stakeHolders");
    setList(params, $selection.data("path"), $selection);
}

function setSelectionList(params, apiPath, $selection, name) {
    $selection.find('option').remove();
    $.ajax({
        url: apiPath,
        type: 'GET',
        data: params,
        async: false,
        success: function (data) {
            if (typeof data == "string") {
                data = JSON.parse(data);
            }
            var jsonObject = {};
            jsonObject["data"] = data;
            jsonObject["type"] = name;
            var template = Handlebars.compile($("#selection-template").html());
            $selection.empty();
            $selection.html("");
            $selection.html(template(jsonObject));
        }, error: function (data) {
            console.log("Error while loading options");
        }
    });
}

$(document).on('focusout input', 'form.ams-application-form .regex-val', function (event) {
    event.preventDefault();
    event.stopPropagation();
    var target = event.target;
    var element = $(target);
    var re = new RegExp(element.attr("regex"));
    if (element.val() && !re.test(element.val())) {
        amsApplication.isValidated = false;
        //showErrorState(element, true);
        element.closest(".form-group").addClass("has-error");
        element.siblings('.help-block').hide();
        element.siblings(".regex-msg").show();
    } else {
        element.closest(".form-group").removeClass("has-error");
        element.siblings(".regex-msg").hide();
    }
});
$(document).on('change', '.ams-application-form input[type=file]', function (event) {
    var target = event.target;
    var $target = $(target);
    var file, img;
    var _URL = window.URL || window.webkitURL;
    if ((file = this.files[0])) {
        if (!validateAMSApplicationFile(event, file)) {
            return false;
        } else {
            img = new Image();
            img.onload = function () {
                if (file) {
                    var apiPath = SIH.getEndPoint($target.closest('.form-group').data('name') === 'bannerImage' ? "/api/file/ams/banner/image" : "/api/file/ams/banner/logo");
                    var imgIcon = $target.closest('.row').find('span.camera-image');
                    var imageTag = $target.closest('.row').find("img.browse")[0];
                    if (file) {
                        var data = new FormData();
                        data.append("file", file);
                        $('#modal-loader').modal("show");
                        $.ajax({
                            url: apiPath,
                            type: 'POST',
                            data: data,
                            cache: false,
                            contentType: false,
                            processData: false,
                            success: function (data) {
                                $('#modal-loader').modal("hide");
                                if (data && data.name) {
                                    // display the image to user
                                    if (!($target.hasClass("file"))) {
                                        imageTag.src = window.URL.createObjectURL(target.files[0]);
                                        var bannerWrapper = $target.closest('.row').find('.banner-image-wrapper');
                                        bannerWrapper.length ? bannerWrapper.css("display", "block") : $(imageTag).css("display", "block");
                                        $(imgIcon).css("display", "none");
                                        if ($target.parents('.multipleimageupload').length == 0) {
                                            amsApplication.images["" + $(target).attr('name')] = data.name;
                                            if (data.compressedName) {
                                                amsApplication.compressedImages["" + $(target).attr('name')] = data.compressedName;
                                            }
                                        } else {
                                            $(imageTag).attr('filename', data.name);
                                            if ($(target).closest('.form-group').find('.multiimage-select').val()) {
                                                $target.closest('.form-group').find("span.logo-added-check").removeClass('logoadded-disabled');
                                            }
                                        }

                                    }
                                }
                            }, error: function (data) {
                                $('#modal-loader').modal("hide");
                                $('.ams-error-modal .modal-body p').html("Error while uploading files");
                                $('.ams-error-modal').modal('show');
                            }
                        });
                    } else {
                        $target.closest('.form-group').find("span.logo-added-check").addClass('logoadded-disabled');
                    }
                }
            };
            img.src = _URL.createObjectURL(file);
        }
    }
});

function checkMimetype(event, file) {
    var uploads = [];
    var fileReader = new FileReader();
    var ext = "";
    fileReader.onloadend = function(evt) {
        if (evt.target.readyState === FileReader.DONE) {
            var uint = new Uint8Array(evt.target.result);
            var bytes = [];
            uint.forEach(function(byte) {
                bytes.push(byte.toString(16));
            });
            var hex = bytes.join('').toUpperCase();

            ext = getMimetype(hex);
            var allowedExtensionsForImage = ["image/png", "image/jpeg", "image/jpg"];
            if(!allowedExtensionsForImage.includes(ext)) {
                $('.ams-error-modal .modal-body p').html("Supported Formats for file uploads are: " + allowedExtensionsForImage.join(" , "));
                $('.ams-error-modal').modal('show');
                $(".banner-image-wrapper").css('display',"none");
                $(".camera-image").css('display',"block");
                event.target.value = null;
                return false;
            }
        }
    }

    var blob = file.slice(0, 4);
    fileReader.readAsArrayBuffer(blob);

    var getMimetype = function(signature) {
        switch (signature) {
            case '89504E47':
                return 'image/png'
            case '47494638':
                return 'image/gif'
            case '25504446':
                return 'application/pdf'
            case 'FFD8FFDB':
            case 'FFD8FFE0':
                return 'image/jpeg'
            case '504B0304':
                return 'application/zip'
            default:
                return 'Unknown filetype'
        }
    }
}

function validateAMSApplicationFile(event, file) {
    var allowedExtensionsForImage = ["image/png", "image/jpeg", "image/jpg"];
    var maxImageSizeInBytes = 1048576;
    if ($.inArray(file.type, allowedExtensionsForImage) < 0) {
        $('.ams-error-modal .modal-body p').html("Supported Formats for file uploads are: " + allowedExtensionsForImage.join(" , "));
        $('.ams-error-modal').modal('show');
        $(".banner-image-wrapper").css('display',"none");
        $(".camera-image").css('display',"block");
        event.target.value = null;
        return false;
    }
    if (file.size > maxImageSizeInBytes) {
        $('.ams-error-modal .modal-body p').html("Maximum file size allowed is 1 MB ");
        $('.ams-error-modal').modal('show');
        $(".banner-image-wrapper").css('display',"none");
        $(".camera-image").css('display',"block");
        event.target.value = null;
        return false;
    }
    checkMimetype(event, file);
    return true;
}

function cleanAMSErrors() {
    $('.ams-app-container .error-message').addClass('display-n');
    $('.ams-app-container .error-message .success-content,.ams-app-container .error-message .err-content').addClass('display-n');
}

$(document).on('click', '.ams-application-form input[name=program-accelerator-next]', function (event) {
    cleanAMSErrors();
    $('#modal-loader').modal("show");
    var $target = $(event.target);
    if (validateAMSForm($('div.ams-app-container sup.required'))) {
        var programJson = mappingProgramFields($('form.ams-application-form'));
        var path = $target.data()["formAction"];
        var redirectPath = $('div.ams-app-container').data('redirect-path');
        var programType = setAMSProgramType($target);
        if (programType === 'REIMBURSEMENT') {
            programJson = getStateFormDate(programJson);
            sessionStorage.setItem('appIncentiveType', programJson["reimbursementType"]["id"]);
            sessionStorage.setItem('appIncentiveTitle', programJson["reimbursementType"]["text"]);
        }
        if (programType === 'INCENTIVE') {
            programJson = getStateFormDate(programJson);
            sessionStorage.setItem('appIncentiveType', programJson["fiscalIncentiveType"]["id"]);
            sessionStorage.setItem('appIncentiveTitle', programJson["fiscalIncentiveType"]["text"]);
        }
        programJson["type"] = programType;
        programJson["formType"] = programType;
        programJson["status"] = "DETAILS_SAVED";
        programJson["id"] = sessionStorage.getItem('amsApplicationId');
        if (path) {
            if (document.getElementById("new_form_multiplePSAllowed-0")) {
                if (document.getElementById("new_form_multiplePSAllowed-0").checked == true) {
                    programJson["multiplePSAllowed"] = true;
                }
                else {
                    programJson["multiplePSAllowed"] = false;
                }
            }
            $.ajax({
                url: SIH.getEndPoint(path),
                data: JSON.stringify(programJson),
                type: 'POST',
                dataType: 'json',
                contentType: "application/json",
                beforeSend: setAuthTokenHeader,
                success: function (response) {
                    if (response && response.id) {
                        $('#modal-loader').modal('hide');
                        $('.ams-app-container .error-message').addClass('alert-success').removeClass('alert-danger');
                        $('.ams-app-container .error-message , .ams-app-container .error-message .success-content').removeClass('display-n');
                        sessionStorage.setItem('amsApplicationId', response.id);
                        window.location = redirectPath + "?applicationId=" + response.id;
                    }
                    amsFormScrollTop();
                },
                error: function (response) {
                    if (response && response.status === 400) {
                        populateFormErrors(response, null, $target);
                        amsErrorBlockScroll();
                    } else if (response && response.status === 403) {
                        $('.ams-error-modal .modal-body p').html("You are not authorized to perform the action");
                        $('.ams-error-modal').modal('show');
                    }
                    else {
                        $('.ams-app-container .error-message').addClass('alert-danger').removeClass('alert-success');
                        if (response && response.responseText) {
                            $('.ams-app-container .error-message .err-content').text(response.responseText);
                        }
                        $('.ams-app-container .error-message , .ams-app-container .error-message .err-content').removeClass('display-n');
                        amsFormScrollTop();
                    }
                    $('#modal-loader').modal('hide');
                }
            });
        }
    } else {
        $('#modal-loader').modal("hide");
        amsErrorBlockScroll();
        return false;
    }
});

function setAMSProgramType($target) {
    if ($target.hasClass('program-incubator')) {
        return "INCUBATOR_PROGRAM";
    } else if ($target.hasClass('program-accelerator')) {
        return "ACCELERATOR_PROGRAM";
    } else if ($target.hasClass('challenge')) {
        return "CHALLENGE";
    } else if ($target.hasClass('program-reimbursement')) {
        return "REIMBURSEMENT";
    } else if ($target.hasClass('program-incentive')) {
        return "INCENTIVE";
    } else {
        return "WORKSHOP";
    }
}

function amsErrorBlockScroll() {
    $('.has-error').length ? $('html, body').animate({scrollTop: $('.has-error').offset().top - 200}, 500) : amsFormScrollTop();
}

function amsFormScrollTop() {
    $('html, body').animate({
        scrollTop: $('.ams-app-container').offset().top - 200
    }, 500);
}

function getStateFormDate(programJson) {
    var startDate = new Date();
    var endDate = new Date(3050, 5, 24, 18, 30);
    programJson["startDate"] = startDate.getMonth() + 1 + '/' + startDate.getDate() + '/' + startDate.getFullYear() + " " + startDate.getHours() + ":" + startDate.getMinutes() + ":" + startDate.getSeconds();
    programJson["endDate"] = endDate.getMonth() + 1 + '/' + endDate.getDate() + '/' + endDate.getFullYear();
    return programJson;
}

$(document).on('click', '.ams-application-form input[name=program-accelerator-draft]', function (event) {
    cleanAMSErrors();
    if ($('input[name=title]').val().trim()) {
        $('#modal-loader').modal("show");
        var $target = $(event.target);
        var programJson = mappingProgramFields($('form.ams-application-form'));
        var path = $target.data()["formAction"];
        var programType = setAMSProgramType($target);
        if (programType === 'REIMBURSEMENT') {
            programJson = getStateFormDate(programJson);
            sessionStorage.setItem('reimbursementType', programJson["reimbursementType"]);
        }
        if (programType === 'INCENTIVE') {
            programJson = getStateFormDate(programJson);
            sessionStorage.setItem('fiscalIncentiveType', programJson["fiscalIncentiveType"]);
        }
        programJson["type"] = programType;
        programJson["formType"] = programType;
        programJson["status"] = "DETAILS_DRAFTED";
        programJson["id"] = sessionStorage.getItem('amsApplicationId');
        if (path) {
            if (document.getElementById("new_form_multiplePSAllowed-0")) {
                if (document.getElementById("new_form_multiplePSAllowed-0").checked == true) {
                    programJson["multiplePSAllowed"] = true;
                }
                else {
                    programJson["multiplePSAllowed"] = false;
                }
            }
            $.ajax({
                url: SIH.getEndPoint(path),
                data: JSON.stringify(programJson),
                type: 'POST',
                dataType: 'json',
                contentType: 'application/json',
                beforeSend: setAuthTokenHeader,
                success: function (response) {
                    if (response && response.id) {
                        $('#modal-loader').modal('hide');
                        $('.ams-app-container .error-message').addClass('alert-success').removeClass('alert-danger');
                        $('.ams-app-container .error-message , .ams-app-container .error-message .success-content').removeClass('display-n');
                        sessionStorage.setItem("amsApplicationId", response.id);
                    }
                    amsFormScrollTop();
                },
                error: function (response) {
                    if (response && response.status == 400) {
                        populateFormErrors(response, null, $target);
                        amsErrorBlockScroll();
                    } else {
                        $('.ams-app-container .error-message').addClass('alert-danger').removeClass('alert-success');
                        $('.ams-app-container .error-message , .ams-app-container .error-message .err-content').removeClass('display-n');
                        amsFormScrollTop();
                    }
                    $('#modal-loader').modal('hide');
                }
            });
        }
    } else {
        $('input[name=title]').closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field cannot be left Blank.");
        amsErrorBlockScroll();
    }
});

function mappingProgramFields($form) {
    var jsonObject = {};
    if ($form) {
        $form.find('.form-control').each(function () {
            var key = $(this).attr('name');
            var value = $(this).val();
            var type = $(this).attr('type');
            var selectTypes = ["state", "city", "reimbursementType", "fiscalIncentiveType"];
            if (key && value && value.length > 0 && !$(this).hasClass("multiimage-text") && !$(this).hasClass("multiimage-link") && key != 'problemStatementDescription' && !$(this).hasClass("multiimage-select") && !$(this).parents('.ams-faq-question').length > 0) {
                if (type == 'radio') {
                    var radioValue = $('input[name=' + key + ']:checked').val();
                    jsonObject["" + key] = radioValue;
                    if (key === "emailSubscribed" && radioValue === "false") {
                        $('input[name=receipientEmail]').val('');
                    }
                } else {
                    if (key == "bannerImage") {
                        if (!jsonObject[key]) {
                            jsonObject[key] = {};
                        }
                        jsonObject["" + key]['info'] = value;
                    } else if ($('#' + key).is('select') && key === 'stakeHolders') {
                        var valueArr = [];
                        $('#' + key).find('option:selected').each(function () {
                            var tagObject = {};
                            tagObject["id"] = $(this).val();
                            tagObject["name"] = $(this).text();
                            tagObject["text"] = $(this).text();
                            valueArr.push(tagObject);
                        });
                        jsonObject["" + key] = valueArr;
                    } else if ($.inArray(key, selectTypes) != -1) {
                        var selectedOption = $('#' + key).find('option:selected');
                        var tagObject = {};
                        tagObject["id"] = selectedOption.val();
                        tagObject["name"] = selectedOption.text();
                        tagObject["text"] = selectedOption.text();
                        jsonObject["" + key] = tagObject;
                    } else if (key === 'problemStatementTitle') {
                        addProblemStatements(jsonObject);
                    } else if (key === 'sectors') {
                        addChallengeThemes(jsonObject);
                    }
                    else {
                        jsonObject["" + key] = value;
                    }
                }
            } else if ($(this).hasClass('customised-dropdown')) {
                var dropdownValues = [];
                if ($(this).find('select').length > 0) {
                    var selectBox = $(this).find('select');
                    selectBox.find('option:selected').each(function () {
                        var tagObject = {};
                        tagObject["id"] = $(this).val();
                        tagObject["name"] = $(this).text();
                        tagObject["text"] = $(this).text();
                        dropdownValues.push(tagObject);
                    });
                    jsonObject["" + selectBox.attr("name")] = dropdownValues;
                } else if ($(this).find('input[type=checkbox]:checked').length > 0) {
                    $(this).find('input[type=checkbox]:checked').each(function () {
                        if ($(this).val().indexOf('sih') == 0) {
                            var tagObject = {};
                            tagObject["id"] = $(this).val();
                            tagObject["name"] = $(this).closest('label').text().trim();
                            tagObject["text"] = $(this).closest('label').text().trim();
                            dropdownValues.push(tagObject);
                        }
                    });
                    jsonObject["" + $(this).children('.multiCheck-selection-all').attr('id')] = dropdownValues;
                }
            }
            else if ($(this).hasClass('multiimage-select')) {
                jsonObject = addMultipleLogos($(this), jsonObject);
            }
            else if ($(this).parents('.ams-faq-question').length > 0) {
                jsonObject = addFaqs($(this), jsonObject);
            }
            amsApplication.errorMappingObj["" + key + ""] = $("input[name=" + key + "]")[0] || $("select[name=" + key + "]")[0] || $("textarea[name=" + key + "]")[0];
        });
        if (amsApplication.images) {
            $.each(amsApplication.images, function (key, value) {
                if (!jsonObject[key]) {
                    jsonObject[key] = {};
                }
                jsonObject[key]['fileName'] = value;
                amsApplication.errorMappingObj["" + key + ""] = value;
            });
        }
        if (amsApplication.compressedImages) {
            $.each(amsApplication.compressedImages, function (key, value) {
                if (!jsonObject[key]) {
                    jsonObject[key] = {};
                }
                jsonObject[key]['compressedFileName'] = value;
                amsApplication.errorMappingObj["" + key + ""] = value;
            });
        }
    }
    if (jsonObject["" + "partnersLogo" + ""]) {
        var logoArray = [];
        $('.multiimage-select').each(function () {
            if ($(this).closest('.form-group').find('ul.preview-partners-logo li').length) {
                logoArray.push($(this).val());
            }
        });
        jsonObject["" + "partnersLogo" + ""]["logosOrder"] = logoArray;
    }
    return jsonObject;
}

function addProblemStatements(jsonObject) {
    var problemStatements = [];
    var title = $("form.ams-application-form input[name=problemStatementTitle]");
    var descriptions = $("form.ams-application-form textarea[name=problemStatementDescription]");
    for (var index = 0; index < title.length; index++) {
        var problemStatement = {};
        problemStatement.problemStatementTitle = title[index].value;
        problemStatement.problemStatementDescription = descriptions[index].value;
        problemStatements.push(problemStatement);
        errorMappingObj["problemStatements[" + index + "].problemStatementTitle"] = title[index];
        errorMappingObj["problemStatements[" + index + "].problemStatementDescription"] = descriptions[index];
    }
    return jsonObject["problemStatements"] = problemStatements;
}

function addChallengeThemes(jsonObject) {
    var sectors = [];
    var title = $("form.ams-application-form input[name=sectors]");
    for (var index = 0; index < title.length; index++) {
        sectors.push(title[index].value);
        errorMappingObj["sectors[" + index + "]"] = title[index];
    }
    return jsonObject["sectors"] = sectors;
}

function fetchAMSApplicationDetails(fetchApi, errorMsg, dashboardPage, applicationId, isAuthor) {
    $('#modal-loader').modal("show");
    if (sessionStorage.getItem('amsApplicationId')) {
        applicationId = sessionStorage.getItem('amsApplicationId');
    }
    var token = store.getItem('token');
    var isAdmin = false;
    var adminToken = $('.accelerators-programs').data('admin-token');
    if (dashboardPage && !token && adminToken && isAuthor === "true") {
        fetchApi = $('.accelerators-programs').data('admin-api');
        isAdmin = true;
    } else if (!token && !(isAuthor === "true")) {
        fetchApi = "/api/noauth/ams/application";
    }
    $('.ams-application-form span.green-text.ams-application-text,.ams-application-form span.red-text.ams-application-text').addClass('display-n')
    $.ajax({
        url: SIH.getEndPoint(fetchApi) + "/" + applicationId,
        type: 'GET',
        beforeSend: setAMSAuthTokenHeader

    }).done(function (userData) {
        if (userData && !dashboardPage) {
            userData.type != setAMSProgramType($('.next-btn.submit-cta')) ? sessionStorage.removeItem("amsApplicationId") : handleApplicationData(userData);
        } else {
            var allowedStatuses = ['SUBMITTED', 'APPROVED', 'REJECTED', 'INCOMPLETE', 'COMPLETED'];
            var currentUserIsAuthor = userData.createdBy === store.getItem("uniqueId");
            console.log(currentUserIsAuthor, userData.status);
            if (currentUserIsAuthor) {
                userData["isAuthor"] = true;
            }
            if (userData && ($.inArray(userData.status, allowedStatuses) !== -1 || (userData.status === 'QUESTIONS_DRAFTED' && currentUserIsAuthor))) {
                userData["emailSubscribedString"] = userData.emailSubscribed ? "Yes" : "No";
                if (userData.bannerImage) {
                    $('.bannerimage .state-banner').addClass('custom-banner');
                    if ($('.bannerimage .state-banner img').length) {
                        $('.bannerimage .state-banner img').attr('src', amsApplication.getImageAPI + "?fileName=" + userData.bannerImage.fileName);
                    } else {
                        $('.bannerimage .state-banner ').prepend('<img src = ' + amsApplication.getImageAPI + "?fileName=" + userData.bannerImage.fileName + '>')
                    }
                }
                if (userData.workshopStartDate || userData.workshopEndDate) {
                    userData["workshopDates"] = true;
                }

                if (userData.linkedinSocialLink || userData.twitterSocialLink || userData.facebookSocialLink || userData.websiteSocialLink) {
                    userData['socialLinks'] = true;
                }
                if (userData.fiscalIncentive || userData.nonFiscalIncentive || userData.specialIncentive || userData.specialCategoryIncentive) {
                    userData['incentive'] = true;
                }
                if (isAdmin && isAuthor === "true") {
                    userData["isAdmin"] = isAdmin;
                    if (userData.status === 'SUBMITTED') {
                        userData["showActionButtons"] = true;
                    }
                }
                if (userData["reimbursementType"]) userData["incentiveText"] = userData["reimbursementType"].text;
                if (userData["fiscalIncentiveType"]) userData["incentiveText"] = userData["fiscalIncentiveType"].text;
                if ($('#challenge-problem-statements').length) {
                    var template = Handlebars.compile($("#challenge-statements-template").html());
                    problemStatements = userData.problemStatements;
                    if(store.getItem("token")){
                        userData.isLoggedIn = true;
                    }else{
                        userData.isLoggedIn = false;
                    }
                    $("div#challenge-problem-statements").html(template(userData));
                } else {
                    if (userData.title) {
                        $('.static-heading').text(userData.title);
                    }
                    var dashboardTemplate = Handlebars.compile($("#application-dashboard-template").html());
                    $("div.accelerators-programs").html(dashboardTemplate(userData));
                    /*if (userData.endDate) {
	                    var endDate = new Date(userData.endDate);
	                    endDate.setDate(endDate.getDate() + 1);
	                    var currentDate = new Date();
	                    if (currentDate > endDate) {
	                        $('.apply-btn').hide();
	                        $('.ams-application-dashboard').append(' <div class="center-aligned alert alert-warning">Refer to Application Timeline for Start Date and End Date.</div>')
	                    }
	                    if(store.getItem("token")) {
	                        fetchSavedApplicationData(applicationId)
	                    }
	                }*/
	                if (userData.endDate) {
	                    if (userData.applicationExpired) {
	                        $('.apply-btn').hide();
	                        $('.ams-application-dashboard').append(' <div class="center-aligned alert alert-warning">Refer to Application Timeline for Start Date and End Date.</div>')
	                    }
	                    if(store.getItem("token")) {
	                        fetchSavedApplicationData(applicationId)
	                    }
	                }
                }

            } else {
                $('.ams-error-modal .modal-body p').html(errorMsg);
                $('.ams-error-modal').modal('show');
            }
        }
    }).fail(function (response) {
        if (response && response.status === 401) {
            $("#loginModal").modal("show");
        }
        else if (response && response.responseText) {
            $('.ams-error-modal .modal-body p').html(response.responseText);
            $('.ams-error-modal').modal('show');
        }
    }).complete(function () {
        equalHeightsForSelector(".leading-partners-image");
    });
    $('#modal-loader').modal("hide");
}

var setAMSAuthTokenHeader = function (xhr) {
    var adminToken = $('.accelerators-programs').data('admin-token');
    var token = store.getItem('token');
    if (token) {
        xhr.setRequestHeader('X-Auth-Token', token);
    } else if (adminToken) {
        xhr.setRequestHeader('X-Auth-Token', adminToken);
    }
    xhr.setRequestHeader('Content-Type', 'application/json');

};

function handleApplicationData(userData) {
    for (var field in userData) {
        var fieldValue = userData["" + field];
        var selectTypes = ["state", "city", "reimbursementType", "fiscalIncentiveType"];
        if (fieldValue != null) {
            if (field === "sectors") {
                populateChallengeThemes(fieldValue, field)
            }
            else if (field == "problemStatements") {
                populateProblemStatements(fieldValue, field);
            }
            else if (field == "faqs") {
                populateFaqs(fieldValue, field);
            }
            else if (field == 'startDate') {
                $('#scheduledTime').datetimepicker('setDate', fieldValue);
            }
            else if ($('[name=' + field + ']').is('textarea')) {
                $("textarea[name=" + field + "].richTextArea").summernote("code", fieldValue);
            } else if (field == "partnersLogo" || field == "socialMediaImage") {
                populateMultipleLogos(fieldValue, field);
            }
            else if ($('#' + field).is('select')) {
                if (field == "stakeHolders") {
                    var stakeholders = [];
                    $(fieldValue).each(function () {
                        stakeholders.push(this.id);
                    });
                    $('#' + field).val(stakeholders);
                } else if (field == 'relevantIndustry' || field == 'relevantServiceType') {
                    $("select#" + field).multipleSelect("setSelects", fieldValue.map(function (ele) {
                        return ele.id;
                    }))
                } else if ($.inArray(field, selectTypes) != -1) {
                    $('#' + field).val(fieldValue.id);
                } else {
                    $('#' + field).val(fieldValue);
                }
                $('#' + field).trigger("change");
            }
            else if ($.isArray(fieldValue)) {
                $.each(fieldValue, function (idx, val) {
                    $("input[type=checkbox][value='" + val.id + "']").prop("checked", true);
                });
                if (field == 'relevantIndustry') {
                    $("#" + field).siblings('button').html(fieldValue.length + " Industries selected");
                } else {
                    $("#" + field).siblings('button').html(fieldValue.length + " Services selected");
                }

            } else if (field == 'emailSubscribed') {
                $('input[name=emailSubscribed][value=' + fieldValue + ']').trigger('change').attr('checked', 'checked');
            } else if (field == "bannerImage") {
                amsApplication.images[field] = fieldValue.fileName;
                amsApplication.compressedImages[field] = fieldValue.compressedFileName;
                var imagePath = amsApplication.getImageAPI + "?fileName=" + fieldValue.fileName;
                setApplicationFormImage(field, imagePath, fieldValue.info);
            } else {
                $("input[name=" + field + "]").val(fieldValue);
            }
        }
    }
}

function setApplicationFormImage(elName, imagePath, imgInfo) {
    var fileUploadEl = $("input[type=file][name=" + elName + "]").closest("div.file-upload");
    var imageEl = fileUploadEl.find("img.browse");
    fileUploadEl.find("input[type=text][name=" + elName + "]").val(imgInfo);
    if (imageEl && imageEl.length > 0 && imagePath) {
        imageEl.attr("src", imagePath);
        fileUploadEl.find('.banner-image-wrapper').show();
        fileUploadEl.find("div.image-section").find("span").hide();
    }
}

function addMultipleLogos(element, jsonObject) {
    var row = $(element).closest('.row');
    var logoImage = row.find('.preview-partners-logo li');
    var logos = [];
    logoImage.each(function () {
        var logoObject = {};
        logoObject["fileName"] = $(this).find('img').attr('filename');
        logoObject["info"] = $(this).find('.logo-text').text();
        logoObject["link"] = $(this).find('.logo-link').attr('href');
        logos.push(logoObject);
    });
    if (logos.length > 0) {
        if (element.parents('.repeat-container').length > 0) {
            if (!jsonObject["" + $(element).attr('name')]) {
                jsonObject["" + $(element).attr('name')] = {};
            }
            jsonObject["" + $(element).attr('name')]["" + row.find('.multiimage-select').val()] = logos;
        } else {
            jsonObject["" + $(element).attr('name')] = logos;
        }
    }
    return jsonObject;
}

function addFaqs(element, jsonObject) {
    var row = $(element).closest('.row');
    var faqs = [];
    var question = $("form.ams-application-form input[name=faqQuestion]");
    var answer = $("form.ams-application-form textarea[name=faqAnswer]");
    for (var index = 0; index < question.length; index++) {
        var faq = {};
        faq.faqQuestion = question[index].value;
        faq.faqAnswer = answer[index].value;
        faqs.push(faq);
        errorMappingObj["faqs[" + index + "].faqQuestion"] = question[index];
        errorMappingObj["members[" + index + "].faqAanswer"] = answer[index];
    }
    jsonObject.faqs = faqs;
    return jsonObject;
}


function populateChallengeThemes(values, field) {
    if (values && values.length > 0) {
        var titleInputs = $("input[name=sectors]");
        repeatElements(field, values.length);
        titleInputs = $("input[name=sectors]");
        $.each(values, function (idx, value) {
            $(titleInputs[idx]).val(value);
        });
    }
}

function populateProblemStatements(values, field) {
    if (values && values.length > 0) {
        var titleInputs = $("input[name=problemStatementTitle]");
        repeatElements("problemStatementTitle", values.length);
        titleInputs = $("input[name=problemStatementTitle]");
        $.each(values, function (idx, value) {
            populateProblemStatementsProperties(value, $(titleInputs[idx]).closest("div.repeat-fields"));
        });
    }
}

function populateFaqs(values) {
    if (values && values.length > 0) {
        var question = $("input[name=faqQuestion]");
        if (values.length > 1) {
            repeatElements("faqQuestion", values.length);
            question = $("input[name=faqQuestion]");
            $.each(values, function (idx, value) {
                populateFaqProperties(value, $(question[idx]).closest("div.repeat-fields"));
            });
        }
        else {
            populateFaqProperties(values[0], $(question[0]).closest("div.repeat-fields"));
        }
    }
}

function populateFaqProperties(obj, $parent) {
    for (var key in obj) {
        var value = obj[key];
        if (key == "faqAnswer") {
            $parent.find("textarea[name=faqAnswer].richTextArea").summernote("code", value);
        } else {
            $parent.find("input[name=" + key + "]").val(value);
        }
    }
}

function populateProblemStatementsProperties(obj, $parent) {
    for (var key in obj) {
        var value = obj[key];
        if ($('[name=' + key + ']').is('textarea')) {
            $parent.find("textarea[name=" + key + "].richTextArea").summernote("code", value);
        } else {
            $parent.find("input[name=" + key + "]").val(value);
        }
    }
}

function populateMultipleLogos(values, field) {
    if (field == "partnersLogo") {
        $('form.ams-application-form .repeat-add').show();
        var partnerLogosNo = Object.keys(values).length;
        if (values && partnerLogosNo > 0) {
            repeatElements(field, Object.keys(values).length - 1);
            var selectPartnerLogos = $("select[name=" + field + "]");
            (values.logosOrder).forEach(function (element, index, array) {
                var $parent = $(selectPartnerLogos[index]).closest("div.repeat-fields");
                var multiSelect = $parent.find('select.multiimage-select');
                multiSelect.val(element);
                $parent.find(".multiimage-label").text(multiSelect.find('option:selected').text());
                populateLogosProperties($parent, values[element]);
            });
        }
    } else {
        populateLogosProperties($("input[type=text][name=" + field + "]").closest("div.multipleimageupload"), values);
    }

}

function populateLogosProperties($parent, obj) {
    $parent.find(".multi-image-heading span").html(Object.keys(obj).length);
    $.each(obj, function (idx, value) {
        var imageObject = {};
        imageObject["src"] = amsApplication.getImageAPI + "?fileName=" + value["fileName"];
        imageObject["filename"] = value["fileName"];
        imageObject["text"] = value["info"];
        imageObject["link"] = value["link"];
        var template = Handlebars.compile($parent.find("#multi-image-template").html());
        $parent.find("ul.preview-partners-logo").append(template(imageObject));
    });
}

$(document).on('click', 'form.ams-application-form input[name=addPartnerLogo]', function () {
    $(this).remove();
    $('form.ams-application-form .repeat-fields .multipleimageupload').show();
    $('form.ams-application-form .repeat-add').show();
});

// Functions for multiple image upload
$(document).on('click', '.multipleimageupload .logo-added-check', function (event) {
    var target = event.target;
    var imageObject = {};
    var row = $(target).closest('.row');
    var imageLink = row.find(".multiimage-link").val();
    if (imageLink && !(imageLink.startsWith("https://") || imageLink.startsWith("http://"))) {
        row.find(".multiimage-link").closest(".image-link-block").find(".help-block").removeClass("display-n");
        row.find(".multiimage-link").closest(".image-link-block").addClass("has-error");
    } else {
        row.find(".multiimage-link").closest(".image-link-block").find(".help-block").addClass("display-n");
        row.find(".multiimage-link").closest(".image-link-block").removeClass("has-error");
        imageObject["src"] = row.find("img.browse").attr('src');
        imageObject["filename"] = row.find("img.browse").attr('filename');
        imageObject["text"] = row.find(".multiimage-text").val();
        imageObject["link"] = imageLink;
        var template = Handlebars.compile($(target).parents('.multipleimageupload').find("#multi-image-template").html());
        row.find("ul.preview-partners-logo").prepend(template(imageObject));
        $(target).closest('.form-group').find('.image-input').val("");
        row.find(".multiimage-text, .multiimage-link").val("");
        row.find("img.browse").attr("src", "/etc/designs/invest-india/investindialibs/images/camera.png");
        row.find("img.browse").hide();
        row.find(".camera-image").show();
        var logoSpan = row.find('.multi-image-heading span');
        logoSpan.text(parseInt(logoSpan.text()) + 1);
        $(target).addClass('logoadded-disabled');
    }
});
$(document).on('focus', '.multipleimageupload .multiimage-select', function (event) {
    amsApplication.logoSelect = $(event.currentTarget).val();
}).on('change', '.multipleimageupload .multiimage-select', function (event) {
    var target = event.currentTarget;
    if ($('select#partnersLogo').not(target).find('option:selected[value=' + $(target).val() + ']').length > 0) {
        $('.ams-error-modal .modal-body p').html("Duplicate Partner Type. Please select another value.");
        $('.ams-error-modal').modal("show");
        $(target).val(amsApplication.logoSelect);
    } else {
        $(target).closest('.col-sm-6').find('.multiimage-label').text($(target).find('option:selected').text());
        var formGroup = $(target).closest('.form-group');
        if (formGroup.find('span.logo-added-check').hasClass('logoadded-disabled') && formGroup.find('.browse').attr('src').indexOf('blob') > -1) {
            formGroup.find('span.logo-added-check').removeClass('logoadded-disabled');
        }
    }
});

$(document).on('click', '.multipleimageupload .preview-partners-logo .remove-icon', function (event) {
    var target = event.target;
    var logoSpan = $(target).closest('.wrapper-add-logo').find('.multi-image-heading span');
    logoSpan.text(parseInt(logoSpan.text()) - 1);
    $(target).closest('.form-group').find('.image-input').val("");
    $(target).parents('li').remove();
});

function validateAMSForm(requiredFields) {
    amsApplication.isValidated = true;
    $.each(requiredFields, function (index, item) {
        var element = $(item).closest('.form-group').find(".form-control:not(.richTextarea,.customised-dropdown)");
        if(element.is(":visible")) {
            if (element && element.length > 0 && !element.closest(".modal").length) {
                if (element.attr("type") === "radio") {
                    if (element.is(':checked')) {
                        element.closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
                    } else {
                        element.closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field cannot be left Blank.");
                        amsApplication.isValidated = false;
                    }
                } else if (!element.val() || (element.val() && element.is('input') && element.val().trim() === "")) {
                    amsApplication.isValidated = false;
                    showErrorState(element, true);
                } else {
                    showErrorState(element, false);
                }
            }
        }
    });
    var richTextAreas = $('.form-control.richTextarea');
    $.each(richTextAreas, function (index, item) {
        var el = $(item);
        if (el.closest('.form-group').find('sup.required').length > 0) {
        	var tempStr = el.val().replace(/<p>*/g,'').replace(/<\/p>*/g,'').replace(/(&nbsp;)*/g, "").replace(/<br>*/g, "");
            if ((el.val() && el.val().replace(/(&nbsp;)*/g, "").trim().length > 0) && !el.summernote('isEmpty') && tempStr.trim().length > 0) {
                el.siblings('.note-editor.note-frame').removeClass('note-has-error').addClass('note-writer-text');
                showErrorState(el, false);
            } else {
                amsApplication.isValidated = false;
                el.siblings('.note-editor.note-frame').addClass('note-has-error').removeClass('note-writer-text');
                showErrorState(el, true);
            }
        }
    });
    var customizedDropDown = $('.form-control.customised-dropdown');
    $.each(customizedDropDown, function (index, item) {
        var el = $(item);
        if (el.closest('.form-group').find('sup.required').length > 0) {
            var selectedFields = el.find('select').length > 0 ? el.find('select option:selected') : el.find('input[type=checkbox]:checked');
            if (!selectedFields || selectedFields.length === 0) {
                amsApplication.isValidated = false;
                showErrorState(el, true);
            }
        }
    });

    var select2fields = $('.form-control.multi-select');
    $.each(select2fields, function (index, item) {
    	var element = $(item).siblings(".select2-container");
    	if(element.find('.select2-selection__rendered').find('.select2-selection__choice').length<=0){
    		amsApplication.isValidated = false;
    		showErrorState(element, true);
    	}
    });
    
    var regexValidatedfields = $('form.ams-application-form .regex-val');
    $.each(regexValidatedfields, function (index, item) {
        var element = $(item);
        var re = new RegExp(element.attr("regex"));
        if (element.val() && !re.test(element.val())) {
            amsApplication.isValidated = false;
            //showErrorState(element, true);
            element.closest(".form-group").addClass("has-error");
            element.siblings(".regex-msg").show();
        }
        else {
            if (!(element.closest(".form-group").has("sup.required") && !element.val())) {
                showErrorState(element, false);
            }
            element.siblings(".regex-msg").hide();
        }
    });
    return amsApplication.isValidated;
}

function showRemainingTags(shId) {
    if ($('.' + shId)) {
        $('#' + shId + '-show').toggleClass('display-n');
        $('.' + shId).toggleClass('display-n');
        $('#' + shId + '-hide').toggleClass('display-n');
    }
}

function toggleContent(shId, element) {
    var parent = $(element).closest('.' + shId);
    if (parent) {
        parent.find('#' + shId + '-show').toggleClass('display-n');
        parent.find(".ellipsis-content").toggleClass('display-n');
        parent.find('#' + shId + '-hide').toggleClass('display-n');
    }
}


function adminActionsOnPrograms(jsonObject) {
    jsonObject["id"] = $('.ams-error-modal').data("id");
    $.ajax({
        url: SIH.getEndPoint($('.accelerators-programs').data('admin-action')),
        data: JSON.stringify(jsonObject),
        type: 'POST',
        contentType: 'application/json',
        headers: {'X-Auth-Token': $('.accelerators-programs').data('admin-token'), 'Content-Type': 'application/json'},
        success: function (response) {
            if (response) {
                window.location = $('.accelerators-programs').data('dashboard-url');
            }
        },
        error: function (response) {
            $('.ams-admin-modal').modal("hide");
            if (response && response.responseText) {
                $('.ams-error-modal .modal-body p').html(response.responseText);
            } else {
                $('.ams-error-modal .modal-body p').html($('.accelerators-programs').data('error-msg'));
            }
            $('.ams-error-modal').modal("show");
        }
    });
}

$(document).on("click", ".accelerators-programs .accept-button , .accelerators-programs .reject-button, .accelerators-programs .incomplete-button, .ams-approve-modal .accept-button", function () {
    $('.ams-admin-modal textarea#ams-approval-comment').val('');
    var status = $(this).data('status');
    var formType = $(this).parent().data('form-type');
    if (status === "REJECTED" || status === "INCOMPLETE") {
        $('.ams-admin-modal .ams-approval-btn').attr('status', status).attr('formType', formType);
        $('.ams-admin-modal').modal('show');
        $('.ams-admin-modal .modal-heading').text(status === "REJECTED" ? "REJECTED" : "MARK AS INCOMPLETE");
    }
    else {
        $(this).attr("disabled", "disabled");
        var jsonObject = {};
        jsonObject["status"] = status;
        jsonObject["formType"] = formType;
        adminActionsOnPrograms(jsonObject);
        $('.ams-approve-modal').modal('hide');
    }
});

$(document).on('click', '.ams-admin-modal .ams-approval-btn', function () {
    $('.ams-approval-btn').attr('disabled', 'disabled');
    var jsonObject = {};
    var status = $('.ams-admin-modal .ams-approval-btn').attr('status');
    var formType = $('.ams-admin-modal .ams-approval-btn').attr('formType');
    var comment = $(this).closest('form').find('textarea#ams-approval-comment').val();
    jsonObject[status === "REJECTED" ? "rejectionComment" : "incompletionReason"] = comment;
    jsonObject["status"] = status;
    jsonObject["formType"] = formType;
    adminActionsOnPrograms(jsonObject);
});

$("#ams-approval-comment").keyup(function(){
    var isDisabled = $(this).val() ? false : true;
    $(".ams-admin-modal .ams-approval-btn").prop("disabled", isDisabled);
});

function fetchAllAMSApplications(getAll, programNo, userId) {
    var userType = $('.select-filter[name=stakeHolders]').val();
    var industryType = $('.select-filter[name=industry]').val();
    var state = $('.select-filter[name=state]').val();
    var jsonObject = {};
    jsonObject["applicationType"] = getAll ? null : $('.applicant-types-heading .ams-application-tabs').find('li.active').attr('type');
    if (userType) {
        jsonObject["userType"] = userType;
    }
    if (industryType) {
        jsonObject["industryType"] = industryType;
    }
    if (state) {
        jsonObject["state"] = state;
    }
    if(userId){
        jsonObject.userId = userId;
    }
    if (jsonObject["applicationType"] !== "MARKET ACCESS PROGRAM") {
        $.ajax({
            url: SIH.getEndPoint("/api/noauth/ams/application/getApplicantApplicationList"),
            data: JSON.stringify(jsonObject),
            type: 'POST',
            async: false,
            headers: {'Content-Type': 'application/json'}
        }).done(function (userData) {
            if (getAll) {
                mergeAuthoredApplications(userData, programNo);
            } else {
                var template = Handlebars.compile($("#application-listing-template").html());
                console.log("userData",userData);
                $('#ams-application-listing .tab-pane.active').html(template(userData));
                $.each($(".manual-carousel"), function (index, val) {
                    $(this).owlCarousel({
                        items: 3,
                        autoPlay:true,
                        loop:true,
                        navigation: true,
                        navigationText: ["<", ">"],
                        itemsTablet: [768, 3],
                        itemsMobile: [479, 2],
                        itemsCustom: false
                    })
                });
            }
        }).fail(function () {
            $('.ams-error-modal .modal-body p').html($('#ams-application-listing').closest('.row').data('error-msg'));
            $('.ams-error-modal').modal('show');
        });
    }
    return true;
}

function mergeAuthoredApplications(userData, programNo) {
    userData.active.map((obj)=> {obj.currentStatus="Current Program"});
    userData.upcoming.map((obj)=> {obj.currentStatus="Upcoming Program"});
    userData.completed.map((obj)=> {obj.currentStatus="Past Program"});
    var template = Handlebars.compile($("#ams-dashboard-template").html());
    var allData;
    $.ajax({
        url: "/bin/services/authoredApplications",
        data: {listRoot: "/content/sih/en/ams-application/application-listing"},
        type: 'GET',
        async: false,
        headers: {'Content-Type': 'application/json'}
    }).success(function (map) {
        var active = map.active != undefined ? sorted(userData.active, map.active, "endDate", "asc") : userData.active;
        var upcoming = map.upcoming != undefined ? sorted(userData.upcoming, map.upcoming, "startDate", "asc") : userData.upcoming;
        var completed = map.completed != undefined ? sorted(userData.completed, map.completed, "endDate", "desc") : userData.completed;
        allData = $.merge($.merge($.merge([], active), upcoming), completed);
    }).error(function () {
        allData = $.merge($.merge($.merge([], userData.active), userData.upcoming), userData.completed);
    }).complete(function () {
        $('#ams-programs-content').html(template(allData));
        if (allData.length >= programNo) {
            $('.all-dashboard-programs').removeClass('display-n');
        }
    });
}

function sorted(array1, array2, sortDate, sortOrder) {
    array1 = array1 != null && array1.length > 0 ? array1 : [];
    array2 = array2 != null && array2.length > 0 ? array2 : [];
    return $.merge(array1, array2).sort(function (a, b) {
        return sortOrder === "asc" ? (new Date(a[sortDate]) - new Date(b[sortDate])) :
            (new Date(b[sortDate]) - new Date(a[sortDate]));
    });
}

function fetchAllEnablerApplications(userId) {
    var jsonObject = {};
    jsonObject["userId"] = userId;
    $.ajax({
        url: SIH.getEndPoint("/api/noauth/ams/application/getApplicantApplicationList"),
        data: JSON.stringify(jsonObject),
        type: 'POST',
        async: false,
        headers: {'Content-Type': 'application/json'}
    }).done(function (userData) {
        var template = Handlebars.compile($("#enabler-application-listing-template").html());
        $("#enabler-application-listing").html(template(userData));
        $.each($(".manual-carousel"), function (index, val) {
            $(this).owlCarousel({
                items: 3,
                navigation: true,
                navigationText: ["<", ">"],
                itemsTablet: [768, 3],
                itemsMobile: [479, 2],
                itemsCustom: false
            })
        });
    }).fail(function () {
        $('.ams-error-modal .modal-body p').html($('#enabler-application-listing').closest('.row').data('error-msg'));
        $('.ams-error-modal').modal('show');
    });
}

$(document).on('shown.bs.tab', 'ul.ams-application-tabs a', function (e) {
    var type = $(e.target).closest('li').attr('type');
    if (type !== "MARKET ACCESS PROGRAM") {
        fetchAllAMSApplications(false);
    }
});

$(document).on("change", '.applicant-filter select', function () {
    fetchAllAMSApplications(false);
});

var fetchWinners = function (applicationId) {
    $.ajax({
        url: SIH.getEndPoint("/api/noauth/ams/application/winners/" + applicationId),
        type: 'GET',
        async: false,
        headers: {'Content-Type': 'application/json'}
    }).done(function (userData) {
        var template = Handlebars.compile($("#ams-winners-template").html());
        $(".winner-wrapper").html(template(userData));
    }).fail(function (error) {
        if (error.status === 400 && error.responseText) {
            showErrorModal(error.responseText, goToDashboard);
        } else {
            showErrorModal("Something bad happened. Please contact help-desk.", goToDashboard);
        }
    });
};
$.amsApplicationContainer = function () {
    $('.app-timeline .select-type-icon').parents('li').addClass('application-completed');
    setStakeHoldersList();
    $('select#incentiveType').closest('.columncontrol').next().find('.baseformfield').addClass('display-n incentive-textarea');
    $("span.logo-added-check").addClass('logoadded-disabled');
    $('.ams-datepicker .hasDatepicker').bind('paste', function () {
        return false;
    }).attr('readonly');
    $('.multiimage-label').each(function (index, val) {
        $(val).text($(val).closest('.form-group').find('.multiimage-select').find('option:selected').text());
    });
    $('form.ams-application-form .regex-msg').each(function () {
        if (!$(this).parents('.form-group').find('input').val()) {
            $(this).css('display', 'none');
        }
    })
    if (store.getItem('country') == 'India' || store.getItem('country') == 'sih:location/india') {
        if ($("#state") && $("#state").length) {
            setState(store.getItem("country"));
            $("#state").trigger("change");
            $('.reimbursement-state').val(store.getItem('state')).attr('disabled', 'true');
        }
    }
    /*if (store && store.getItem("role") == "GovernmentBody") {
        var $reimbursementSelection = $("form.ams-application-form select[name=reimbursementType]");
        if($reimbursementSelection.length>0) {
            setStateConfigList({stateId: store.getItem("state")}, SIH.getEndPoint($reimbursementSelection.data("path")), $reimbursementSelection);
        }
        var $incentiveSelection = $("form.ams-application-form select[name=fiscalIncentiveType]");
        if($incentiveSelection.length>0){
            setStateConfigList({stateId: store.getItem("state")}, SIH.getEndPoint($incentiveSelection.data("path")), $incentiveSelection);
        }
    }*/
    if (store.getItem("token")) {
        if (store.getItem('published')) {
            if (sessionStorage.getItem('amsApplicationId')) {
                fetchAMSApplicationDetails($('div.ams-app-container').data('fetch-api'), $('div.ams-app-container').data('errorMsg'));
            }
        } else {
            disableAMSApplicationForm();
            $('.under-moderation-modal').modal('show');
        }
    } else {
        disableAMSApplicationForm();
        $("#loginModal").modal("show");
    }
};

/*function setStateConfigList(params, apiPath, $selection) {
    var stateConfigs;
    if (apiPath) {
        $.ajax({
            url: apiPath,
            type: 'GET',
            data: params,
            async: false,
            beforeSend: setAuthTokenHeader,
            success: function (data) {
                if (typeof data == "string") {
                    data = JSON.parse(data);
                }
                if ($selection) {
                    $selection.find('option').remove();
                    $.each(data, function (index, item) {
                        var o = new Option(item.text, item.id);
                        $selection.append(o);
                    });
                } else {
                    stateConfigs = data;
                }
            },error: function (response) {
                if (response && response.responseText) {
                    disableAMSApplicationForm();
                    $('.ams-error-modal .modal-body p').html(response.responseText);
                    $('.ams-error-modal').modal('show');
                }
            }
    });
    }
    return stateConfigs;
}*/
function setStateConfigList(apiPath) {
    var stateConfigs = {};
    if (apiPath) {
        $.ajax({
            url: apiPath,
            type: 'GET',
            async: false,
            success: function (data) {
                stateConfigs = data;
            }, error: function (data) {
                console.log("Error while loading options");
            }
        });
    }
    return stateConfigs;
}

function disableAMSApplicationForm() {
    $(".ams-application-form input, .ams-application-form select").prop("disabled", true);
    $(".ams-application-form textarea").each(function () {
        $(this).next().find(".note-editable").attr("contenteditable", false);
    });
}

function fetchSavedApplicationData(applicationId) {
    $.ajax({
        url: SIH.getEndPoint("/api/auth/ams/application/applicationApplicantResponse/" + applicationId),
        type: 'GET',
        async: false,
        contentType: 'application/json',
        headers: {'X-Auth-Token': store.getItem("token"), 'Content-Type': 'application/json'}
    }).done(function (response) {
        if (response && response.status) {
            $(".form-button.apply-btn.submitted-btn").show();
        }
    }).error(function (response) {
    });
}
var applicationObj = {};

Handlebars.registerHelper("addOne", function (index) {
    return index + 1;
});

Handlebars.registerHelper("isRowRemovable", function () {
    return applicationObj.additionalQuestion.length > 1 ? "ams-remove-row" : "";
});

Handlebars.registerHelper("disable", function (isLast, options) {
    if (isLast && applicationObj.additionalQuestion.length < maxAdditionalQuestion)
        return options.fn(this);
    else
        return ""
});

Handlebars.registerHelper("isChecked", function (index) {
    return isMandatoryAdditionalQuestion(index) ? "checked='checked'" : "";
});

var isMandatoryAdditionalQuestion = function (index) {
    return applicationObj.additionalQuestion[index].mandatory;
};

var toggleMandatory = function (index) {
    applicationObj.additionalQuestion[index].mandatory = !applicationObj.additionalQuestion[index].mandatory;
};

var setQuestionTitle = function (index, element) {
    applicationObj.additionalQuestion[index].question.questionTitle = $(element).val();
};
var setQuestionValueType = function (index, element) {
    applicationObj.additionalQuestion[index].question.valueType = $(element).val();
};

var getAmsQuestionnaire = function (amsApplicationId) {
    getExistingApplication(amsApplicationId);
};

function getAMSQuestions(amsApplicationId, applicationData) {
    var type = sessionStorage.getItem('appIncentiveType');
    var url = SIH.getEndPoint("/api/auth/ams/questionnaire/list");
    if (type && type !== "undefined") {
        url = url + "?category=" + type;
    } else {
        type = undefined;
    }
    $.ajax({
        url: url,
        type: 'GET',
        contentType: "application/json",
        headers: {
            "X-Auth-Token": store.getItem("token")
        },
        body: {"category": sessionStorage.getItem('appIncentiveType')},
        success: function (data) {
            applicationObj = applicationData;
            var questionList = {
                'Personal and team Details': [],
                'General Questions': [],
                'Solution Details': [],
                'Revenue Model': [],
                'Competition': [],
                'Road Map Ahead': []
            };
            var excludedList = [];
            if (sessionStorage.getItem('appIncentiveType')) {
                var reimbursementConfigs = setStateConfigList("/services/tags/reimbursements.json");
                $.each(reimbursementConfigs, function (index, item) {
                    questionList[item.id] = [];
                    excludedList.push(item.id);
                });
                var incentiveConfigs = setStateConfigList("/services/tags/incentives.json");
                $.each(incentiveConfigs, function (index, item) {
                    questionList[item.id] = [];
                    excludedList.push(item.id);
                });
            }
            $.each(questionList, function (index, val) {
                questionList[index] = data[index];
            });
            var categoryCount = 1;
            $.each(questionList, function (key, val) {
                if (val && ((!type && $.inArray(key, excludedList) === -1) || type)) {
                    var currentTab = "categoryTab" + categoryCount;
                    if ($.inArray(key, excludedList) != -1) {
                        key = sessionStorage.getItem("appIncentiveTitle");
                    }
                    $(".dynamicTabs").append("<li role=\"presentation\" class=\"desktop-tabs " + (categoryCount === 1 ? "active" : "") + "\">\n" +
                        "                <a href=\"#" + currentTab + "\" role=\"tab\" data-toggle=\"tab\">" + key + "</a>\n" +
                        "            </li>");
                    $(".question-tab-content").append("<div id=\"" + currentTab + "\" role=\"tabpanel\" class=\"tab-pane question-content-section table-responsive " + (categoryCount === 1 ? "active" : "") + "\">\n" +
                        "            <table class=\"parentTable table\">\n" +
                        "                <tr>\n" +
                        "                    <th class=\"small-column\">No.</th>\n" +
                        "                    <th class=\"question-list\">Question</th>\n" +
                        "                    <th class=\"small-column column-align\">Include</th>\n" +
                        "                    <th class=\"small-column column-align\">Mandatory</th>\n" +
                        "                </tr>\n" +
                        "            </table>\n" +
                        "        </div>");
                    var rowCount = 1;
                    $.each(val, function (k, v) {
                        var html;
                        if (!v.parentId) {
                            switch (v.attributeType) {
                                case "SECTION":
                                    html = populateSection(v, val, rowCount);
                                    break;
                                case "LIST":
                                    html = populateSection(v, val, rowCount);
                                    break;
                                case "HEADING":
                                    html = populateHeadingContainer(v, val, rowCount);
                                    break;
                                default:
                                    html = populateDefaultRow(v, rowCount);
                                    break;
                            }
                            $("#" + currentTab + " table.parentTable").append(html);
                            rowCount++;
                        }
                    });
                    categoryCount++;
                }
            });
            var typeTitleCase = typeToTitleCase(applicationObj.application.formType);
            $('.select-prog-container .event-details-icon').siblings('.application-list-title').text("Add Your " + typeTitleCase + " Details");
            applicationObj.applicationQuestionDetailsList.forEach(function (element) {
                $("#" + element.question.name + "-include").prop("checked", true);
                if (element.mandatory) {
                    $("#" + element.question.name + "-mandatory").prop("checked", true);
                }
            });
            markCategoryAsDone();
            createAdditionalQuestionTab("categoryTab" + categoryCount, "Additional Questions");
            addAdditionQuestionIfBlank();
            renderAdditionalQuestionData();
            registerAddQuestionEvent();
            changeBtnList();
            registerTabChangedEvent();

        }, error: function (error) {
            console.error("Something bad happened at Server while fetching the question list. Please check the following error log.");
            console.error(error);
            if (error.responseJSON) {
                showErrorModal("Something went wrong. Please try again later.", goToDashboard);
            } else if (error.responseText) {
                showErrorModal(error.responseText, goToDashboard);
            } else {
                showErrorModal("Something went wrong. Please try again later.", goToDashboard);
            }
        }
    });
}

function addTabLink(context) {
    var source = document.getElementById("additional-question-tab-link").innerHTML;
    var template = Handlebars.compile(source);
    $(".dynamicTabs").append(template(context));
}

function addTabBody(context) {
    var source = document.getElementById("additional-question-tab").innerHTML;
    var template = Handlebars.compile(source);
    $(".question-tab-content").append(template(context));
}

var createAdditionalQuestionTab = function (currentTab, key) {
    var context = {currentTab: currentTab, heading: key};
    addTabLink(context);
    addTabBody(context);
};

var Question = function (title, attributeType, valueType, category) {
    this.questionTitle = title;
    this.attributeType = attributeType;
    this.valueType = valueType;
    this.category = category;

};

function renderAdditionalQuestionData() {
    var source = document.getElementById("additional-question-tab-data").innerHTML;
    var template = Handlebars.compile(source);
    $("#additional-question-table tbody").html(template({additionalQuestion: applicationObj.additionalQuestion}));
    $('.additional-question-value-type,.additional-question-value-type-doc').each(function () {
        if ($(this).data("value")) {
            $(this).val($(this).data("value"));
        }
        console.log("value"+$(this).data("value"))
        if ($(this).data("value") && $(this).data("value") === "SELECTION") {
            $(this).closest('td').find('.ams-question-option').removeClass('display-n');
            $(this).closest('td').find('.additional-question-value-type').addClass('display-n');


        }
        if($(this).data("value") && ($(this).data("value") === "IMAGE" || $(this).data("value") === "DOCUMENT"|| $(this).data("value") ==="VIDEO")){
            $(this).closest('td').find('.ams-question-option').addClass('display-n');
            $(this).closest('td').find('.additional-question-value-type').addClass('display-n');
            $(this).closest('td').find('.additional-question-value-type-doc').removeClass('display-n');
            $(this).closest('td').find('.additional-question-value-type-doc').removeAttr('disabled');

        }
        else {
            //$(this).closest('td').find('.ams-question-option').addClass('display-n');
            //$(this).closest('td').find('.additional-question-value-type').removeClass('display-n')
            //$(this).closest('td').find('.additional-question-value-type-doc').removeClass('display-n');
        }
    });
    $('.additional-question-type').each(function () {
        var questionTypeArray = ["RADIO", "DROPDOWN", "CHECKBOX", "TEXTAREA"];
        if ($(this).data("value")) {
            $(this).val($(this).data("value"));
            if ($.inArray($(this).data("value"), questionTypeArray) < 0) {
                $(this).closest('td').find(".additional-question-value-type").removeAttr('disabled');
            }
        }
    });
}

function addAdditionQuestionIfBlank() {
    applicationObj.additionalQuestion = applicationObj.additionalQuestion && applicationObj.additionalQuestion.length ?
        applicationObj.additionalQuestion : [{
            question: new Question("", "", "", ""),
            mandatory: false
        }];
}

var getExistingApplication = function (amsApplicationId) {
    //getting existing data if any.
    $('#modal-loader').modal('show');
    $.ajax({
        url: SIH.getEndPoint("/api/auth/ams/application/" + amsApplicationId + "/questions"),
        type: 'GET',
        contentType: "application/json",
        headers: {
            "X-Auth-Token": store.getItem("token")
        },
        success: function (data) {
            if (data) {
                applicationObj = data;
                if (['APPROVED', 'SUBMITTED', 'REJECTED'].indexOf(applicationObj.application.status) > -1) {
                    showErrorModal("You cannot change an application under review. Please contact support team for any concerns!", goToDashboard);
                }
                if (['DETAILS_DRAFTED'].indexOf(applicationObj.application.status) > -1) {
                    showErrorModal("Please fill the application details first!", goToDashboard);
                }
                if (data.application.reimbursementType) {
                    sessionStorage.setItem('appIncentiveType', data.application.reimbursementType.id);
                    sessionStorage.setItem('appIncentiveTitle', data.application.reimbursementType.text);
                }
                if (data.application.fiscalIncentiveType) {
                    sessionStorage.setItem('appIncentiveType', data.application.fiscalIncentiveType.id);
                    sessionStorage.setItem('appIncentiveTitle', data.application.fiscalIncentiveType.text);
                }
                getAMSQuestions(amsApplicationId, data);
            }
            $('#modal-loader').modal('hide');
        },
        error: function (error) {
            console.error("Something bad happened at Server while fetching the existing application. Please check the following error log.");
            console.error(error);
            $('#modal-loader').modal('hide');
            if (error.responseJSON) {
                showErrorModal("Something went wrong. Please try again later.", goToDashboard);
            } else if (error.responseText) {
                showErrorModal(error.responseText, goToDashboard);
            } else {
                showErrorModal("Something went wrong. Please try again later.", goToDashboard);
            }

        }
    })
};

var typeToTitleCase = function (str) {
    str = str.toLowerCase().split('_');
    for (var i = 0; i < str.length; i++) {
        str[i] = str[i].charAt(0).toUpperCase() + str[i].slice(1);
    }
    return str.join(' ');
};


var populateDefaultRow = function (question, rowCount) {
    return "<tr>\n" +
        "                    <td class='snoCol'>" + rowCount + ".</td>\n" +
        "                    <td class='questionCol'>" + question.questionTitle + "</td>\n" +
        "                    <td class='includeCol'>\n" +
        "                        <label class=\"control control--checkbox\" for=\"" + question.name + "-include\">\n" +
        "                            <input type=\"checkbox\" class=\"form-control addAll include\" id=\"" + question.name + "-include\" name=\"include\" value=\"" + question.name + "\" onclick=\"markIncluded(this)\" >\n" +
        "                            <div class=\"control__indicator\"></div>\n" +
        "                        </label>\n" +
        "                    </td>\n" +
        "                    <td class='mandatoryCol'>\n" +
        "                        <label class=\"control control--checkbox\" for=\"" + question.name + "-mandatory\">\n" +
        "                            <input type=\"checkbox\" class=\"form-control addAll mandatory\" id=\"" + question.name + "-mandatory\" name=\"mandatory\" value=\"" + question.name + "\" onclick=\"markMandatory(this)\" >\n" +
        "                            <div class=\"control__indicator\"></div>\n" +
        "                        </label>\n" +
        "                    </td>\n" +
        "                </tr>"
};

var populateSection = function (question, allQuestions, rowCount) {
    var childrenQuestions = allQuestions.filter(function (que) {
        return que.parentId === question.name
    });

    var trElement = $(populateDefaultRow(question, rowCount));
    trElement.find("td.questionCol").append("<ul></ul>");
    $.each(childrenQuestions, function (index, value) {
        trElement.find("td.questionCol ul").append("<li>" + value.questionTitle + "</li>");
    });
    return "<tr>" + trElement.html() + "</tr>";     // because .html() returns innerHTML
};

var populateHeadingContainer = function (question, allQuestions, rowCount) {
    var childrenQuestions = allQuestions.filter(function (que) {
        return que.parentId === question.name
    });

    var parentHtml = "<tr id=" + question.name + ">\n" +
        "                    <td class='snoCol'>" + rowCount + ".</td>\n" +
        "                    <td class='questionCol' colspan='3'><b>" + question.questionTitle + "</b></td>\n" +
        "               </tr>";

    var trElement = $(parentHtml);
    trElement.find("td.questionCol").append("<table class=\"inner-table\"><tbody></tbody></table>");

    $.each(childrenQuestions, function (index, child) {
        var childHtml = "<tr>\n" +
            "                    <td>" + child.questionTitle + "</td>\n" +
            "                     <td>\n" +
            "                        <label class=\"control control--checkbox\" for=\"" + child.name + "-include\">\n" +
            "                            <input type=\"checkbox\" class=\"form-control addAll include\" id=\"" + child.name + "-include\" name=\"include\" value=\"" + child.name + "\" onclick=\"markIncluded(this)\" >\n" +
            "                            <div class=\"control__indicator\"></div>\n" +
            "                        </label>\n" +
            "                    </td>\n" +
            "                    <td>\n" +
            "                        <label class=\"control control--checkbox\" for=\"" + child.name + "-mandatory\">\n" +
            "                            <input type=\"checkbox\" class=\"form-control addAll mandatory\" id=\"" + child.name + "-mandatory\" name=\"mandatory\" value=\"" + child.name + "\" onclick=\"markMandatory(this)\" >\n" +
            "                            <div class=\"control__indicator\"></div>\n" +
            "                        </label>\n" +
            "                    </td>\n" +
            "                </tr>";
        trElement.find("td.questionCol table.inner-table tbody").append(childHtml);
    });
    return "<tr>" + trElement.html() + "</tr>";     // because .html() returns innerHTML

};

var markMandatory = function (element) {
    cleanMessages();
    var isChecked = $(element).is(":checked");
    var existingElement = applicationObj.applicationQuestionDetailsList.find(function (ele) {
        return ele.question.name === element.value;
    });
    if (existingElement) {
        existingElement.mandatory = isChecked;
    } else if (isChecked) {
        applicationObj.applicationQuestionDetailsList.push({
            "question": {"name": element.value},
            "mandatory": isChecked
        });
        $("#amsQuestionnaire").find("#" + element.value + "-include").prop('checked', true);
    }
};


var markIncluded = function (element) {
    cleanMessages();
    var isChecked = $(element).is(":checked");
    if (isChecked) {
        applicationObj.applicationQuestionDetailsList.push({"question": {"name": element.value}, "mandatory": false});
    } else {
        var existingElement = applicationObj.applicationQuestionDetailsList.find(function (ele) {
            return ele.question.name === element.value;
        });
        var index = applicationObj.applicationQuestionDetailsList.indexOf(existingElement);
        applicationObj.applicationQuestionDetailsList.splice(index, 1);
        $("#amsQuestionnaire").find("#" + element.value + "-mandatory").prop('checked', false);
    }
};

var validateAdditionalQuestionSelection = function () {
    var isAdditionalQuestionPopulated = applicationObj && applicationObj.additionalQuestion.length;
    var isFirstAdditionalQuestionPopulated = isAdditionalQuestionPopulated && applicationObj.additionalQuestion[0].question.questionTitle;
    if (isAdditionalQuestionPopulated && applicationObj.additionalQuestion.length === 1 && !isFirstAdditionalQuestionPopulated) {
        applicationObj.additionalQuestion = [];
    }
    var isAllAdditionalQuestionPopulated = true;
    if (isAdditionalQuestionPopulated) {
        isAllAdditionalQuestionPopulated = !Boolean(applicationObj.additionalQuestion.filter(function (questionMapping) {
            return !questionMapping.question.questionTitle;
        }).length);
    }
    if (!isAllAdditionalQuestionPopulated) {
        showErrorMessage("Additional Question should not be left blank.");
    }
    return isAllAdditionalQuestionPopulated;
};

function validateAMSAdditionalQuestion() {
    var isValid = true;
    var questionTypeArray = ["RADIO", "DROPDOWN", "CHECKBOX"];
    var additionalQuestions = $('#additional-question-table .additinal-question-section');
    var additionalQuestionsLen = additionalQuestions.length;
    var additinalQuestionFlag = true;
    if (additionalQuestions.length === 1) {
        var addQ = additionalQuestions[0];
        if (!$(addQ).find('.ams-question-field').val()
            && !$(addQ).find('.ams-question-field').val().trim()
            && !$(addQ).find('.additional-question-type').val()
            && !$(addQ).find('.additional-question-value-type').val()
            && !$(addQ).find('.additional-question-value-type-doc').val()){
            additinalQuestionFlag = false;
        }
    }
    if (additinalQuestionFlag) {
        $(additionalQuestions).each(function (index, ele) {
            console.log("valueElement"+ele);
            var errorMsg = "";
            if (!$(ele).find('.ams-question-field').val() || ($(ele).find('.ams-question-field').val() && $(ele).find('.ams-question-field').val().trim().length === 0)) {
                $(ele).find('.additional-question-container').addClass("has-error");
                isValid = false;
                errorMsg = "Question Title is Mandatory";
            } else {
                $(ele).find('.additional-question-container').removeClass("has-error");
            }
            if (!$(ele).find('.additional-question-type').val()) {
                $(ele).find('.additional-attribute-type').addClass("has-error");
                isValid = false;
                errorMsg += "<br/>Question Type is Mandatory";
            } else {
                $(ele).find('.additional-attribute-type').removeClass("has-error");
            }
            if ((!$(ele).find('.additional-question-value-type').val() && !$(ele).find('.additional-question-value-type-doc').val())) {
                $(ele).find('.additional-value').addClass("has-error");
                isValid = false;
                errorMsg += "<br/>Value Type is Mandatory";
            } else {
                $(ele).find('.additional-value').removeClass("has-error");
            }
            if (!isValid) {
                showErrorMessage("Issues in Additional Questions - " + errorMsg);
            }
        });
        $('.ams-question-option').each(function (index, val) {
            var flag = false;
            var options = [];
            if ($(val).find('.ams-question-option-field').length > 0) {

                $.each($(val).find('.ams-question-option-field'), function () {

                    if ($(this).val().trim() && $(this).val().length > 0) {
                        flag = true;
                        options.push($(this).val().trim());
                        if($(val).hasClass("has-error")){

                            $(val).removeClass("has-error");
                        }
                    }
                    else{
                        flag =false;
                        if (!flag && $.inArray($(val).closest('td').find('.additional-question-type').val(), questionTypeArray) >= 0) {
                            showErrorMessage("Please Add Value in Option field");
                            isValid = false;
                            $(val).addClass("has-error");
                        }
                    }

                });
                applicationObj.additionalQuestion[index].question.options = options;
            }
        });
    }
    return isValid;
}


function validateAdditionalQuestionOptions(flag,isValid,val,questionTypeArray){


}
var submitApplication = function (status, callback) {
    applicationObj.status = status;
    var isValid = validateAMSAdditionalQuestion();
    if (isValid) {
        var isAdditionQuestionValid = validateAdditionalQuestionSelection();
        if (isAdditionQuestionValid && (applicationObj && applicationObj.application && applicationObj.applicationQuestionDetailsList.length)) {
            $('#modal-loader').modal('show');
            var saveSuccess = function (data) {
                if (data) {
                    applicationObj = data;
                    addAdditionQuestionIfBlank();
                    if (status === 'QUESTIONS_DRAFTED') {
                        renderAdditionalQuestionData();
                        showSuccessMessage("Application saved successfully.")
                    } else if (status === 'SUBMITTED') {
                        showSuccessMessage("Application saved successfully. Complete application sent for moderation from SIH.");
                        sessionStorage.removeItem("amsApplicationId");
                        goToDashboard();
                    }
                }
                $('#modal-loader').modal('hide');
            };
            $.ajax({
                url: SIH.getEndPoint("/api/auth/ams/application/" + applicationObj.application.id + "/questions"),
                type: 'POST',
                contentType: "application/json",
                headers: {
                    "X-Auth-Token": store.getItem("token")
                },
                data: JSON.stringify(applicationObj),
                success: callback ? callback : saveSuccess,
                error: function (data) {
                    if (data && data.responseText) {
                        showErrorMessage(data.responseText);
                    } else {
                        addAdditionQuestionIfBlank();
                        console.error("Something bad happened at Server while fetching the existing application. Please check the following error log.");
                        console.error(data);
                    }
                    $('#modal-loader').modal('hide');
                }
            })
        } else if (!isAdditionQuestionValid) {
            addAdditionQuestionIfBlank();
            console.error("Invalid Additional Questions");
        } else {
            addAdditionQuestionIfBlank();
            console.error("Cannot save application without any question selected");
            showErrorMessage("At least 1 question should be selected.")
        }
    }
};

function goToDashboard() {
    window.location = $('.dashboard').attr('href');
}

function goToNextTab() {
    $("li.active").next(".desktop-tabs").find("a").click();
    scrollTo(0, $("li.active.desktop-tabs").offset().top - 200);
    markCategoryAsDone();
}

function goToPrevTab() {
    $("li.active").prev(".desktop-tabs").find("a").click();
    scrollTo(0, $("li.active.desktop-tabs").offset().top - 200);
    markCategoryAsDone();
}

function changeBtnList() {
    var allTabs = $("li.desktop-tabs");
    var activeTab = $("li.active.desktop-tabs")[0];
    var firstTab = allTabs.first()[0];
    var lastTab = allTabs.last()[0];

    if (activeTab === firstTab) {
        $(".action-btn-list:visible").html(
            "                <li>\n" +
            "                    <a href='javascript:void(0)' onclick=\"goToDetailsPage()\" class=\"back-btn\"> BACK</a>\n" +
            "                </li>\n" +
            "                <li>\n" +
            "                    <button type=\"button\" onclick=\"previewApplication()\" class=\"preview-btn\">preview</button>\n" +
            "                </li>\n" +
            "                <li>\n" +
            "                    <button type=\"button\" onclick=\"submitApplication('QUESTIONS_DRAFTED')\" class=\"draft-btn\">save as draft</button>\n" +
            "                </li>\n" +
            "                <li>\n" +
            "                    <button type=\"button\" onclick=\"goToNextTab()\" class=\"next-btn\">next</button>\n" +
            "                </li>");
    } else if (activeTab !== lastTab) {
        $(".action-btn-list:visible").html(
            "                <li>\n" +
            "                    <button type=\"button\" onclick=\"goToPrevTab()\" class=\"next-btn\">previous</button>\n" +
            "                </li>\n" +
            "                <li>\n" +
            "                    <button type=\"button\" onclick=\"previewApplication()\" class=\"preview-btn\">preview</button>\n" +
            "                </li>\n" +
            "                <li>\n" +
            "                    <button type=\"button\" onclick=\"submitApplication('QUESTIONS_DRAFTED')\" class=\"draft-btn\">save as draft</button>\n" +
            "                </li>\n" +
            "                <li>\n" +
            "                    <button type=\"button\" onclick=\"goToNextTab()\" class=\"next-btn\">next</button>\n" +
            "                </li>");
    } else {
        $(".action-btn-list:visible").html(
            "                <li>\n" +
            "                    <button type=\"button\" onclick=\"goToPrevTab()\" class=\"next-btn\">previous</button>\n" +
            "                </li>\n" +
            "                <li>\n" +
            "                    <button type=\"button\" onclick=\"previewApplication()\" class=\"preview-btn\">preview</button>\n" +
            "                </li>\n" +
            "                <li>\n" +
            "                    <button type=\"button\" onclick=\"submitApplication('QUESTIONS_DRAFTED')\" class=\"draft-btn\">save as draft</button>\n" +
            "                </li>\n" +
            "                <li>\n" +
            "                    <button type=\"button\" onclick=\"submitApplication('SUBMITTED')\" class=\"next-btn\">SUBMIT</button>\n" +
            "                </li>"
        )
    }
}

function markCategoryAsDone() {
    var tabList = $("li.desktop-tabs");
    tabList.each(function (index, element) {
        var href = $(element).find("a").attr("href");
        var additionalQues = $(href).find('.ams-question-field');
        if (additionalQues && additionalQues.val() && additionalQues.val().length > 0) {
            $(element).addClass("question-selected");
        }
        else if ($(href).find("input:checkbox:checked").length > 0) {
            $(element).addClass("question-selected");
        } else {
            $(element).removeClass("question-selected");
        }
    })
}

var registerTabChangedEvent = function () {
    $('#amsQuestionnaire a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
        markCategoryAsDone();
        changeBtnList();
    });
};

var registerAddQuestionEvent = function () {
    var questionTypeArray = ["RADIO", "DROPDOWN", "CHECKBOX"];
    $(document).on('click', '.ams-add-btn', function (event) {
        var flag = false;
        $("#additional-question-table .text-danger").remove();
        $("#additional-question-table tr").each(function(evt) {
            if ($.inArray($(this).find('.additional-question-type').val(), questionTypeArray) >= 0) {
                $(this).find(".ams-question-option-field").each(function() {
                    if(this.value == "") {
                        flag = true;
                        $(this).closest(".repeat-fields").append("<span class='text-danger'>Please enter value.</span>");
                    }
                });
            }
        });
        if(!flag) {
            if ($.inArray($(event.target).closest('td').find('.additional-question-type').val(), questionTypeArray) >= 0) {
                var options = [];
                $(event.target).closest('td').find('.ams-question-option').find('.ams-question-option-field').each(function () {
                    options.push($(this).val());
                    applicationObj.additionalQuestion[$(event.target).closest('td').data('index')].question.options = options;
                });
            }
            applicationObj.additionalQuestion.push({
                question: new Question("", "", "", ""),
                mandatory: false
            });
            renderAdditionalQuestionData();
        }
    });
    $(document).on('change', '.additional-question-type', function (event) {
        var $target = $(event.target);
        if ($target.val()) {
            $target.closest('td').find('.additional-question-value-type').removeAttr("disabled");
        }
        var index = $target.closest('td').data('index');
        applicationObj.additionalQuestion[index].question.attributeType = $(event.target).val();
        if ($.inArray($target.val(), questionTypeArray) >= 0) {
            $target.closest('td').find('.ams-question-option').removeClass('display-n');
            $target.closest('td').find('.additional-question-value-type').val('SELECTION').trigger("change");
            $target.closest('td').find('.additional-question-value-type').addClass('display-n');
            $target.closest('td').find('.additional-question-value-type-doc').addClass('display-n');
        } else if ($target.val() === 'TEXTAREA') {
            $target.closest('td').find('.ams-question-option').addClass('display-n');
            $target.closest('td').find('.additional-question-value-type').removeClass('display-n').val('ALPHA_NUM').trigger("change").attr('disabled', 'disabled');
            $target.closest('td').find('.additional-question-value-type-doc').addClass('display-n');
        }
        else if ($target.val() === 'DOCUMENT') {
            $target.closest('td').find('.ams-question-option').addClass('display-n');
            $target.closest('td').find('.additional-question-value-type').removeClass('display-n').val('URL').trigger("change").attr('disabled', 'disabled');
            $target.closest('td').find('.additional-question-value-type-doc').addClass('display-n');
        }
        else if ($target.val() === 'FILE'){
            $target.closest('td').find('.ams-question-option').addClass('display-n');
            $target.closest('td').find('.additional-question-value-type').val("");
            $target.closest('td').find('.additional-question-value-type').addClass('display-n');
            $target.closest('td').find('.additional-question-value-type-doc').removeClass('display-n');
            $target.closest('td').find('.additional-question-value-type-doc').removeAttr("disabled");
        }
        else {
            $target.closest('td').find('.ams-question-option').addClass('display-n');
            $target.closest('td').find('.additional-question-value-type').val("");
            $target.closest('td').find('.additional-question-value-type').removeClass('display-n')
            $target.closest('td').find('.additional-question-value-type-doc').addClass('display-n');
        }
    });
    $(document).on('click','.additional-question-value-type-doc',function (event) {

        $(this).closest('td').find('.additional-question-value-type').addClass('display-n');
        $(this).closest('td').find('.additional-question-value-type-doc').removeAttr("disabled");
    });

    $(document).on('click', '.ams-add-option-btn', function (event) {
        $('.ams-option-div').clone();
    });
};

var removeRow = function (index) {
    applicationObj.additionalQuestion.splice(index, 1);
    renderAdditionalQuestionData();
};

var showErrorModal = function (errorMessage, callback) {
    $('.ams-error-modal .modal-body p').html(errorMessage);
    $('.ams-error-modal').modal('show').on('hidden.bs.modal', callback);
};

var showErrorMessage = function (errorMessage) {
    var amsError = $('#ams-error');
    amsError.show();
    $('#ams-success').hide();
    amsError.html(errorMessage);
    scrollTo(0, amsError.offset().top - 200);
};

var showSuccessMessage = function (successMessage) {
    $('#ams-error').hide();
    var amsSuccess = $('#ams-success');
    amsSuccess.show();
    amsSuccess.html(successMessage);
    scrollTo(0, amsSuccess.offset().top - 200);
};

var cleanMessages = function () {
    $('#ams-success').hide();
    $('#ams-error').hide();
};

var previewApplication = function () {
    var previewCallback = function (data) {
        if (data) {
            applicationObj = data;
            addAdditionQuestionIfBlank();
            var $form = $("#amsQuestionnaire");
            var previewBaseUrl = $form.data("previewBaseUrl");
            window.open(previewBaseUrl + "/" + applicationObj.application.type.toLowerCase().replace("_", "-") + ".html?applicationId=" + applicationObj.application.id);
        }
        $('#modal-loader').modal('hide');
    };
    submitApplication("QUESTIONS_DRAFTED", previewCallback);
};

var goToDetailsPage = function () {
    var $form = $("#amsQuestionnaire");
    var applicationDetailBaseUrl = $form.data("applicationDetailBaseUrl");
    window.location.href = applicationDetailBaseUrl + "/" + applicationObj.application.type.toLowerCase().replace("_", "-") + "-details.html";
};
$.rbl_challenge_form = function () {
    var $form = $("form[name='RblForm']");
    var formData = {};
    var isValidated = true;
    var isUserAplicable = false;
    var role = store.getItem('role');
    var $submitRblForm = $form.find("input[name='rblFormSubmit']");
    var $saveRblForm = $form.find("input[name='rblFormSave']");
    var $rblChallengeModals = $(".rbl-challenge-modals");

    if (store.getItem("token")) {
        $("input[name='id']").val(store.getItem("uniqueId"));
        if (!store.getItem("published")) {
            disableRBLForm();
            $('.under-moderation-modal').modal('show');
        } else {
            $form.find('input.form-control, select.form-control, textarea.form-control').removeAttr("disabled", "disabled");
            $form.find("input[type=button]").removeAttr("disabled", "disabled");

            if (role && (role.toLowerCase() === 'startup' || role.toLowerCase() === 'individual')) {
                getEligible();
            } else {
                $rblChallengeModals.find('.rbl-eligibility-modal').modal('show');
                $rblChallengeModals.find('.rbl-eligibility-modal button').on('click', function () {
                    window.location = $('.logo').attr('href');
                });
            }
        }
    } else {
        disableRBLForm();
        store.getItem("no-profile") ? $('.complete-profile-modal').modal('show') : $(".login .sign-in").trigger('click');
    }

    function disableRBLForm() {
        $form.find('input.form-control, select.form-control, textarea.form-control').prop("disabled", "disabled");
        $form.find("input[type='button']").prop("disabled", "disabled");
    }

    function getEligible() {
        $.ajax({
            type: "GET",
            async: "false",
            url: SIH.getEndPoint("/api/auth/rblChallenge/applicable"),
            headers: {"X-Auth-Token": store.getItem("token")}
        }).done(function (data) {
            isUserAplicable = data;
            if (isUserAplicable) {
                prepopulateData();
            } else {
                $rblChallengeModals.find('.rbl-already-submitted-modal').modal('show');
                $rblChallengeModals.find('.rbl-already-submitted-modal button').on('click', function () {
                    window.location = $('.logo').attr('href');
                });
            }
        });
    }

    function prepopulateData() {
        $.ajax({
            type: "GET",
            contentType: "application/json",
            dataType: "json",
            url: SIH.getEndPoint("/api/auth/rblChallenge/") + store.getItem("uniqueId"),
            headers: {"X-Auth-Token": store.getItem("token")}
        }).done(function (data) {
            if (!data || !data.status) {
                prePopulateForm();
            } else {
                $("input[name='startupName']").val(data.startupName);
                $("input[name='state']").val(data.state);
                $("input[name='city']").val(data.city);
                $("input[name='founderName']").val(data.founderName);
                $("input[name='founderEmail']").val(data.founderEmail);
                $("input[name='founderMobile']").val(data.founderMobile);
                $("textarea[name='coreTeamDetails']").val(data.coreTeamDetails);
                $("input[name='appLink']").val(data.appLink);
                $("textarea[name='productDescription']").val(data.productDescription);
                $("textarea[name='keyDiff']").val(data.keyDiff);
                $("textarea[name='problemSolving']").val(data.problemSolving);
                $("select[name='category']").val(data.category);
                $("textarea[name='competitors']").val(data.competitors);
                $("select[name='stage']").val(data.stage);
                $("select[name='launchDate']").val(data.launchDate);
                $("input[name='targetAudience']").val(data.targetAudience);
                $("input[name='activeUsers']").val(data.activeUsers);
                $("select[name='fundingStage']").val(data.fundingStage);
                $("input[name='revenue']").val(data.revenue);
                $("select[name='skills']").val(data.skills).trigger("change");
                $("input[name='expectation']").val(data.expectation);
                if (data.presentation) {
                    $("input[name='presentation']").val(data.presentation);
                    $("input[name='presentationFileName']").val(data.presentationFileName);
                    var $presentationLink = $("a.presentationLink");
                    $presentationLink.prop("href", SIH.getEndPoint("/api/file/challenge/doc/rbl/") + data.presentation + "/get").text(data.presentationFileName).removeClass("display-n");
                }
            }
        }).error(function () {
            console.log("Error in prepopulating form.");
        });
    }

    function getFormData(doValidate) {
        formData = {};
        isValidated = true;
        var attrValue = "";
        var inputField = $form.find(".form-control");
        $.each(inputField, function (index, inputSel) {
            var key = $(inputSel).attr("name");
            if (typeof key !== "undefined") {
                var type = $(inputSel).attr("type");
                if (type !== "file") {
                    attrValue = $(inputSel).val();
                    if (attrValue) {
                        formData[key] = attrValue;
                    }
                    validateField(attrValue, inputSel, doValidate);
                }
            }
        });
    }

    function validateField(attrValue, inputSel, doValidate) {
        var message = "";
        var requiredField = $(inputSel).closest(".form-group").find("sup.required");
        if (requiredField && requiredField.length > 0 && (!attrValue || attrValue === "")) {
            if (doValidate) {
                message = message + "This field is mandatory. ";
            }
        } else {
            if (typeof $(inputSel).attr("maxlength") !== "undefined") {
                var maxlength = $(inputSel).attr("maxlength");
                if (attrValue.length > maxlength) {
                    message = message + "Only " + maxlength + " characters are allowed. ";
                }
            }
            if (typeof $(inputSel).attr("pattern") !== "undefined") {
                var pattern = new RegExp($(inputSel).attr("pattern"));

                if (attrValue && !pattern.test(attrValue)) {
                    message = message + $(inputSel).attr("data-pattern-error");
                }
            }
        }
        if (message === "") {
            $(inputSel).closest(".form-group").removeClass("has-error");
        } else {
            isValidated = false;
            $(inputSel).closest(".form-group").addClass("has-error");
        }
        $(inputSel).siblings("span.help-block").first().html(message);
    }

    function checkFileUpload(fileToValidate, fileSize) {

        var message = "";
        if ($(fileToValidate).val() !== "") {
            if (fileToValidate.files[0].size > fileSize) {
                message = "File Should not be greater then " + Math.floor(fileSize / 1000000) + " MB.";
            }
            if (message !== "") {
                isValidated = false;
                $(fileToValidate).siblings(".help-block").html(message).parents(".form-group").addClass("has-error");
                $(fileToValidate).val("");
            } else {
                $(fileToValidate).siblings(".help-block").html("").parents(".form-group").removeClass("has-error");
                $(fileToValidate).siblings("input[type='hidden'][name='presentationFileName']").val(fileToValidate.files[0].name);
                var data = new FormData();
                data.append("file", fileToValidate.files[0]);
                $(".modal.loader").modal("show");
                $.ajax({
                    type: "POST",
                    data: data,
                    dataType: 'json',
                    contentType: false,
                    processData: false,
                    url: SIH.getEndPoint("/api/file/rblChallenge/doc"),
                    headers: {"X-Auth-Token": store.getItem("token")}
                }).done(function (data) {
                    $(".modal.loader").modal("hide");
                    $(fileToValidate).siblings("input[type='hidden'][name='presentation']").val(data.name);
                    if (data.name) {
                        var $presentationLink = $("a.presentationLink");
                        $presentationLink.prop("href", SIH.getEndPoint("/api/file/challenge/doc/rbl/") + data.name).text(data.originalFilename).removeClass("display-n");
                    }
                }).error(function () {
                    $(".modal.loader").modal("hide");
                    $(".rbl-error-message").modal("show");
                    return false;
                });
            }
        }
        return false;
    }

    function prePopulateForm() {
        var $startupName = $("input[name='startupName']");
        var $state = $("input[name='state']");
        var $city = $("input[name='city']");
        $.ajax({
            type: "GET",
            async: false,
            url: SIH.getEndPoint("/api/auth/user/profile"),
            headers: {"X-Auth-Token": store.getItem("token")}
        }).done(function (data) {
            if (data.user.name) {
                $("input[name='founderName']").val(data.user.name);
                $startupName.val(data.user.name);
            }
            if (data.user.email) {
                $("input[name='founderEmail']").val(data.user.email);
            }
            if (data.user.phone) {
                $("input[name='founderMobile']").val(data.user.phone);
            }
            if (data.user.startup) {
                var startupData = data.user.startup;

                if (startupData.location.city && startupData.location.city.text) {
                    $city.val(startupData.location.city.text);
                }
                if (startupData.location.state && startupData.location.state.text) {
                    $state.val(startupData.location.state.text);
                }
            } else {
                var userData = data.user;

                if (userData.location.city && userData.location.city.text) {
                    $city.val(userData.location.city.text);
                }
                if (userData.location.state && userData.location.state.text) {
                    $state.val(userData.location.state.text);
                }
            }
        });
    }

    $form.find("input[type=file]").on('change', function (event) {
        checkFileUpload(this, 2062594);
        return false;
    });

    $saveRblForm.on("click", function () {
        getFormData(false);
        if (isValidated && isUserAplicable) {
            $(".rbl-error-block").find(".form-group").removeClass("has-error").find("span.help-block").addClass("display-n");
            $.ajax({
                type: "POST",
                data: JSON.stringify(formData),
                contentType: "application/json",
                dataType: "json",
                url: SIH.getEndPoint("/api/auth/rblChallenge/saveasdraft"),
                headers: {"X-Auth-Token": store.getItem("token")}
            }).done(function (response) {
                if (response == true) {
                    $(".rbl-save-message .save-message").removeClass("display-n");
                    $(".rbl-error-block .help-block").addClass("display-n");
                } else {
                    $(".rbl-error-message").modal("show");
                }
            }).error(function () {
                $(".rbl-error-message").modal("show");
            });
        } else {
            $(".rbl-save-message .save-message").addClass("display-n");
            $(".rbl-error-block").find(".form-group").addClass("has-error").find("span.help-block").removeClass("display-n");
        }
    });

    $submitRblForm.on("click", function () {
        getFormData(true);
        if (isValidated && isUserAplicable) {
            $(".rbl-error-block").find(".form-group").removeClass("has-error").find("span.help-block").addClass("display-n");
            $.ajax({
                type: "POST",
                data: JSON.stringify(formData),
                contentType: "application/json",
                dataType: "json",
                url: SIH.getEndPoint("/api/auth/rblChallenge/apply"),
                headers: {"X-Auth-Token": store.getItem("token")}
            }).done(function (response) {
                ga('send', 'event', 'Website-InFinIT20', 'SubmitButton', 'InFinIT20-Submit-button', 1);
                if (response == true) {
                    window.location = $form.attr("data-path");
                } else {
                    $(".rbl-error-message").modal("show");
                }
            }).error(function () {
                $(".rbl-error-message").modal("show");
            });
        } else {
            $(".rbl-error-block").find(".form-group").addClass("has-error").find("span.help-block").removeClass("display-n");
        }
    });

    $rblChallengeModals.find(".rbl-error-message button").on("click", function () {
        $rblChallengeModals.find(".rbl-error-message").modal("hide");
    })
};

$.ams_applicant_application = function () {
    var $form = $("form[name='ams-application-form']");
    var formType = "";
    var applicationId = "";
    var formData = {};
    var isValidated = true;
    var isUserAplicable = false;
    var errorMappingObj = {};
    applicationId = $form.data("id");
    var role = store.getItem('role');
    var token = store.getItem("token");
    if(!token){
        token = $("#ams-application-form").data("admin-token");
    }
    var headers = {'X-Auth-Token': token, 'Content-Type': 'application/json'};
    if(jQuery.inArray( applicationId, ["5ea181f8e4b0363cb6335eea", "5ebb99dae4b03b2ccef38dda", "5ebbf6e36827795ffb61b1ea", "5ebbf6e36827795ffb61b1eb", "5ebbf6e36827795ffb61b1ec", "5ebbf6e36827795ffb61b1ed", "5ebbf6e36827795ffb61b1ee", "5ebbf6e36827795ffb61b1ef", "5ebbf6e36827795ffb61b1f0", "5ebbf6e36827795ffb61b1f1"] ) > -1 ){
        role = "Kirana";
        token="";
        headers = {'Content-Type': 'application/json'};
    }
    var $submitAmsForm = $form.find("input[name='amsFormSubmit']");
    var $saveAmsForm = $form.find("input[name='amsFormSave']");
    var problemStatementTitle = sessionStorage.getItem("problemStatementTitle");
    var problemStatementDescription = sessionStorage.getItem("problemStatementDescription");
    var problemStatementId = sessionStorage.getItem("problemStatementId");
    if (isPreviewMode) {
        token = $form.data("admin-token");
    }
    function getApplicationQuestion() {
        applicationId = $form.data("id");
        var apiPath = SIH.getEndPoint("/api/auth/ams/application/" + applicationId + "/questions");
        if(jQuery.inArray( applicationId, ["5ea181f8e4b0363cb6335eea", "5ebb99dae4b03b2ccef38dda", "5ebbf6e36827795ffb61b1ea", "5ebbf6e36827795ffb61b1eb", "5ebbf6e36827795ffb61b1ec", "5ebbf6e36827795ffb61b1ed", "5ebbf6e36827795ffb61b1ee", "5ebbf6e36827795ffb61b1ef", "5ebbf6e36827795ffb61b1f0", "5ebbf6e36827795ffb61b1f1"] ) > -1 ){
            apiPath = SIH.getEndPoint("/api/noauth/ams/application/" + applicationId + "/questions");
        }else {
            apiPath =  SIH.getEndPoint("/api/auth/ams/application/" + applicationId + "/questions");
        }
        $('#modal-loader').modal('show');
        if (applicationId) {
            $.ajax({
                url: apiPath,
                type: 'GET',
                contentType: 'application/json',
                headers: headers,
                success: function (response) {
                    var excludedList = {};
                    if (response && response.application) {
                        formType = response.application.formType;
                    }
                    var problemStatementTemplate = Handlebars.compile($("#problem-statement-template").html());
                    var template = Handlebars.compile($("#ams-applicant-template").html());
                    var questionCategoryArray = ['Personal and team Details',
                        'General Questions',
                        'Solution Details',
                        'Revenue Model',
                        'Competition',
                        'Road Map Ahead'];
                    var questionList = {
                        'Personal and team Details': {},
                        'General Questions': {},
                        'Solution Details': {},
                        'Revenue Model': {},
                        'Competition': {},
                        'Road Map Ahead': {},
                        'Additional Question': {}
                    };
                    var reimbursementConfigs = setStateConfigList("/services/tags/reimbursements.json");
                    $.each(reimbursementConfigs, function (index, item) {
                        questionList[item.id] = {};
                        questionCategoryArray.push(item.text);
                        excludedList[item.id] = item.text;
                    });
                    var incentiveConfigs = setStateConfigList("/services/tags/incentives.json");
                    $.each(incentiveConfigs, function (index, item) {
                        questionList[item.id] = {};
                        questionCategoryArray.push(item.text);
                        excludedList[item.id] = item.text;
                    });
                    questionCategoryArray.push('Additional Question');
                    $.each(questionList, function (index, val) {
                        questionList[index] = response.questionCategoryList[index] || [];
                    });
                    questionList['Additional Question'] = response.additionalQuestion;
                    if (response.application.reimbursementType && excludedList[response.application.reimbursementType.id]) {
                        questionList[excludedList[response.application.reimbursementType.id]] = questionList[response.application.reimbursementType.id];
                        delete questionList[response.application.reimbursementType.id];
                    } else if (response.application.fiscalIncentiveType && excludedList[response.application.fiscalIncentiveType.id]) {
                        questionList[excludedList[response.application.fiscalIncentiveType.id]] = questionList[response.application.fiscalIncentiveType.id];
                        delete questionList[response.application.fiscalIncentiveType.id];
                    }
                    // questionList.rowCount = 0;
                    var headingData = [];
                    var hasSelfCertification = false;
                    var question = {questionList: questionList, questionCategoryArray: questionCategoryArray};
                    question.rowCount = 0;
                    $.each(response.questionCategoryList, function (index, val) {
                        val.rowCount = 0;
                        $.each(val, function (index, val) {
                            if (!hasSelfCertification && val.question.valueType === 'SELF_CERTIFICATION') {
                                hasSelfCertification = true;
                                question['hasSelfCertification'] = true;
                                question['selfCertification'] = val.question;
                                question['selfCertificationMandatory'] = val.mandatory;
                            }
                            if (val.question.parentId) {
                                var value = {"parentId": val.question.parentId, "name": val.question.name};
                                var present = false;
                                $.each(headingData, function (index, value) {
                                    if (value.parentId === val.question.parentId) {
                                        present = true;
                                        return true;
                                    }
                                });
                                if (!present) {
                                    val.question.first = true;
                                    headingData.push(value);
                                }
                            }
                        });
                    });

                    $("form[name=ams-application-form]").html(template(question));
                    /*if(excludedList[$('.applicant-detail-title').data('key')]){
                        $('.applicant-detail-title').text(excludedList[$('.applicant-detail-title').data('key')]);
                    }*/
                    if (problemStatementTitle) {
                        $("form[name=ams-application-form]").prepend(problemStatementTemplate({
                            problemStatementTitle: problemStatementTitle,
                            problemStatementDescription: problemStatementDescription
                        }));
                    }
                    $.each(headingData, function (index, val) {
                        getQuestion(val.parentId, val.name);
                    });
                    if(jQuery.inArray( applicationId, ["5ea181f8e4b0363cb6335eea", "5ebb99dae4b03b2ccef38dda", "5ebbf6e36827795ffb61b1ea", "5ebbf6e36827795ffb61b1eb", "5ebbf6e36827795ffb61b1ec", "5ebbf6e36827795ffb61b1ed", "5ebbf6e36827795ffb61b1ee", "5ebbf6e36827795ffb61b1ef", "5ebbf6e36827795ffb61b1f0", "5ebbf6e36827795ffb61b1f1"] ) < 0 ) {
                        fetchSavedApplicationData(response.application.id, problemStatementId);
                    }
                    $('#modal-loader').modal('hide');
                    if(jQuery.inArray( applicationId, ["5ea181f8e4b0363cb6335eea", "5ebb99dae4b03b2ccef38dda", "5ebbf6e36827795ffb61b1ea", "5ebbf6e36827795ffb61b1eb", "5ebbf6e36827795ffb61b1ec", "5ebbf6e36827795ffb61b1ed", "5ebbf6e36827795ffb61b1ee", "5ebbf6e36827795ffb61b1ef", "5ebbf6e36827795ffb61b1f0", "5ebbf6e36827795ffb61b1f1"] ) > -1 ) {
                        $("#draftRemoveForKirana").hide();
debugger;
                       // setting problem statement for non secure programs like Kirana or Hall of fame
                    if(response.application.formType === "CHALLENGE" && response.application.problemStatements.length > -1){
                        problemStatementTitle = response.application.problemStatements[0].problemStatementTitle;
                        problemStatementDescription = response.application.problemStatements[0].problemStatementDescription;
                        problemStatementId = response.application.problemStatements[0].problemStatementId;
                    }
                    //end
                    }
                    if (isPreviewMode) {
                        $(".buttonRow").html(""); // remove action buttons
                    }
                    $('.ams-form-date').datepicker({dateFormat:'dd/mm/yy'});
                },
                error: function (response) {
                    $('#modal-loader').modal('hide');
                    $('.ams-applicant-error-modal p').html("Application not found");
                    $(".ams-applicant-error-modal").modal("show");
                }
            });
        } else {
            $('.ams-applicant-error-modal p').html("Application not found");
            $(".ams-applicant-error-modal").modal("show");
        }
    }

    function getQuestion(parentId, name) {
        var appId = getParameterByName("applicationId");
        var apiPath = SIH.getEndPoint("/api/auth/ams/questionnaire/get/" + parentId);
        if(jQuery.inArray( appId, ["5ea181f8e4b0363cb6335eea", "5ebb99dae4b03b2ccef38dda", "5ebbf6e36827795ffb61b1ea", "5ebbf6e36827795ffb61b1eb", "5ebbf6e36827795ffb61b1ec", "5ebbf6e36827795ffb61b1ed", "5ebbf6e36827795ffb61b1ee", "5ebbf6e36827795ffb61b1ef", "5ebbf6e36827795ffb61b1f0", "5ebbf6e36827795ffb61b1f1"] ) > -1 ){
            apiPath = SIH.getEndPoint("/api//noauth/ams/application/questionnaire/get/" + parentId);
        }else {
            apiPath = SIH.getEndPoint("/api/auth/ams/questionnaire/get/" + parentId);
        }
        $.ajax({
            url: apiPath,
            type: 'GET',
            async: false,
            contentType: 'application/json',
            headers: headers,
            success: function (response) {
                $("input[name=" + name + "]").closest('.row').before('<h2 class="detail-title">' + response.question.questionTitle + '</h2>')
            },
            error: function (response) {
                console.error("error getting question");
            }
        })
    }

    getApplicationQuestion();

    function getFormData(doValidate) {
        formData = {};
        isValidated = true;
        var attrValue = "";
        var inputField = $form.find(".form-control");
        $.each(inputField, function (index, inputSel) {
            var isList = $(inputSel).closest(".repeat-container").length;
            var key = $(inputSel).attr("name");
            if (typeof key !== "undefined") {
                var type = $(inputSel).attr("type");
                if (type !== "file" && type !== "hidden") {
                    if (typeof key !== "undefined") {
                        if (isList) {
                            attrValue = $('input[name="' + inputSel.name + '"], select[name ="' + inputSel.name + '"] ,textarea[name="' + inputSel.name + '"]').serializeArray().map(function (ele) {
                                return ele.value
                            });
                        } else if (type === 'radio') {
                            attrValue = $('input[name="' + inputSel.name + '"]:checked').val();
                        } else if (type === 'checkbox') {
                            var array = [];
                            var elements = $('input[name="' + inputSel.name + '"]:checked');
                            $.each(elements, function (index, item) {
                                array.push(item.value);
                            });
                            attrValue = array;
                        } else {
                            attrValue = $(inputSel).val();
                        }
                        if (attrValue && attrValue.length) {
                            formData[key] = attrValue;
                        }
                        if (doValidate) {
                            if (isList && Array.isArray(attrValue) && type !== "radio") {
                                var listContainer = $(inputSel).closest(".repeat-container");
                                attrValue.forEach(function (elementValue, index) {
                                    if (listContainer.find(".repeat-fields").index($(inputSel).closest(".repeat-fields")) === index) {
                                        validateField(elementValue, inputSel, doValidate);
                                    }
                                })
                            } else {
                                validateField(attrValue, inputSel, doValidate);
                            }
                        }
                    }
                } else if (type === 'file') {
                    var fileObject = {};
                    var fileName = $('input[name=' + inputSel.name + '][type=hidden]').val();
                    if (fileName) {
                        fileObject["fileName"] = fileName;
                        fileObject["fileOriginalName"] = $('input[name=' + inputSel.name + 'FileName][type=hidden]').val();
                        formData[key] = fileObject;
                    } else if (doValidate) {
                        validateField(fileName, inputSel, doValidate);
                    }
                }
                errorMappingObj["" + key + ""] = $("input[name=" + key + "]")[0] || $("select[name=" + key + "]")[0] || $("textarea[name=" + key + "]")[0];
            }
        });

        if (doValidate) {
            var certify = $('.certify');
            $.each(certify, function (index, inputSel) {
                validateField($(inputSel).is(':checked'), inputSel, doValidate);
            });
        }
        handleRepeatContainerFields(formData);
    }

    function handleRepeatContainerFields(formData){
        var arr = {};
        $('.repeat-container').each(function(index,val) {
            $($(this).find('.repeat-fields')[0]).each(function () {
                $(this).find('input[type=radio]').each(function () {
                    var name = $(this).attr("name");
                    if (!arr[name]) {
                        arr[name] = $("input[name=" + name + "]:checked").val()
                    }
                })
            });
        });

        $('.repeat-container').each(function(index,val) {
            var n = $(this).attr('repeatNumber');
            $.each(arr,function(index,val){
                for(var i = 1; i <= n;i++){
                    var name = index+"_"+i;
                    console.log(name+"---"+$("input[name="+name+"]:checked").val());
                    if($("input[name="+name+"]").length){
                        var v = $("input[name="+name+"]:checked").val();
                        if(formData[index] === undefined ){
                            formData[index] = [];
                            formData[index].push(null);
                        }
                        formData[index].push(v);
                    }
                }
            });
        });
       /* var n = $('.repeat-container .repeat-fields').length;
        $.each(arr,function(index,val){
            for(var i = 1; i < n;i++){
                var name = index+"_"+i;
                console.log(name+"---"+$("input[name="+name+"]:checked").val())
                var v = $("input[name="+name+"]:checked").val();
                formData[index].push(v);
            }
        })*/
       console.log(formData);
    }

    function validateField(attrValue, inputSel, doValidate) {
        var message = "";
        var requiredField = $(inputSel).closest(".form-group").find("sup.required");
        if (requiredField && requiredField.length > 0 && (!attrValue || attrValue === "" || attrValue.length === 0 || (typeof attrValue.trim === "function" && attrValue.trim() === ""))) {
            if (doValidate) {
                message = message + "This field is required. ";
            }
        } else {
            var cd = "alphabets";
            if($(inputSel).attr('type') === "number"){
                cd = "digits";
            }
            if (attrValue && (typeof $(inputSel).attr("minlength") !== "undefined" && typeof $(inputSel).attr("maxlength") !== "undefined")) {
                minlength = $(inputSel).attr("minlength");
                maxlength = $(inputSel).attr("maxlength");
                if (minlength && maxlength && (attrValue.length < minlength || attrValue.length > maxlength)) {
                    message = message + "Between " + minlength +"-"+maxlength + " "+cd+" are allowed. ";
                }
            }else {
                if (attrValue && (typeof $(inputSel).attr("minlength") !== "undefined")) {
                        var minlength = $(inputSel).attr("minlength");
                    if (attrValue.length < minlength) {
                        message = message + "Minimum " + minlength + " "+cd+" are allowed. ";
                    }
                } if (attrValue && (typeof $(inputSel).attr("maxlength") !== "undefined")) {
                    var maxlength = $(inputSel).attr("maxlength");
                    if (attrValue.length > maxlength) {
                        message = message + "Only " + maxlength + " "+cd+" are allowed. ";
                    }
                }
            }

            if (attrValue && (typeof $(inputSel).attr("pattern") !== "undefined")) {
                var pattern = new RegExp($(inputSel).attr("pattern"));

                if (!pattern.test(attrValue)) {
                    message = message + $(inputSel).attr("data-pattern-error");
                }
            }
        }
        if (message === "") {
            $(inputSel).closest(".form-group").removeClass("has-error");
        } else {
            isValidated = false;
            $(inputSel).closest(".form-group").addClass("has-error");
        }
        $(inputSel).siblings("span.help-block").first().html(message);
    }

    $(document).on("click", "form[name=ams-application-form] input[name='amsFormSubmit']", function (event) {
        $('#modal-loader').modal('show');
        getFormData(true);
        var $target = $(event.target);
        var id = $('input[name=id]').val();
        if(jQuery.inArray( applicationId, ["5ea181f8e4b0363cb6335eea", "5ebb99dae4b03b2ccef38dda", "5ebbf6e36827795ffb61b1ea", "5ebbf6e36827795ffb61b1eb", "5ebbf6e36827795ffb61b1ec", "5ebbf6e36827795ffb61b1ed", "5ebbf6e36827795ffb61b1ee", "5ebbf6e36827795ffb61b1ef", "5ebbf6e36827795ffb61b1f0", "5ebbf6e36827795ffb61b1f1"] ) > -1 ){
            id = "";
        }
        if (isValidated) {
            var data = {
                'id': id,
                'application': {'id': applicationId, 'formType': formType},
                'status': 'PENDING',
                'questionResponses': formData,
                'problemStatementTitle': problemStatementTitle,
                'problemStatementDescription': problemStatementDescription,
                'problemStatementId': problemStatementId
            };
            sessionStorage.clear();
            var apiPath = SIH.getEndPoint("/api/auth/ams/application/applicationResponse/save");
            if(jQuery.inArray( applicationId, ["5ea181f8e4b0363cb6335eea", "5ebb99dae4b03b2ccef38dda", "5ebbf6e36827795ffb61b1ea", "5ebbf6e36827795ffb61b1eb", "5ebbf6e36827795ffb61b1ec", "5ebbf6e36827795ffb61b1ed", "5ebbf6e36827795ffb61b1ee", "5ebbf6e36827795ffb61b1ef", "5ebbf6e36827795ffb61b1f0", "5ebbf6e36827795ffb61b1f1"] ) > -1 ){
                apiPath = SIH.getEndPoint("/api/noauth/ams/application/applicationResponse/save");
            }else {
                apiPath =  SIH.getEndPoint("/api/auth/ams/application/applicationResponse/save");
            }
            $.ajax({
                url: apiPath,
                type: "POST",
                contentType: 'application/json',
                headers: headers,
                data: JSON.stringify(data)
            }).done(function (response) {
                $('#modal-loader').modal('hide');
                if (response) {
                    window.location = $form.attr("data-path");
                } else {
                    $('.ams-applicant-error-modal p').html("There are some error saving the form. Please contact Support Team");
                    $(".ams-applicant-error-modal").modal("show");
                }
            }).error(function (response) {
                if (response && response.status === 400) {
                    populateFormErrors(response, null, $target, errorMappingObj);
                    amsErrorBlockScroll();
                } else if (response && response.status === 403) {
                    $('.ams-error-modal p').html(response.responseText);
                    $(".ams-error-modal").modal("show");
                    $(".buttonRow").find(".btn").attr("disabled", "disabled");
                } else {
                    $('.ams-error-modal p').html("There are some error saving the form. Please contact Support Team");
                    $(".ams-error-modal").modal("show");
                }
                $('#modal-loader').modal('hide');
            });
        } else {
            $('#modal-loader').modal("hide");
            amsErrorBlockScroll();
            return false;
        }
    });

    function fetchUserResponse() {
        $.ajax({
            url: SIH.getEndPoint("/api/auth/ams/application/userResponse"),
            type: 'GET',
            async: false,
            contentType: 'application/json',
            headers: {'X-Auth-Token': token, 'Content-Type': 'application/json'}
        }).done(function (response) {
            setFormData(response.questionResponses,true);
        })
    }

    function fetchSavedApplicationData(applicationId, problemStatementId) {
        var url;
        if (problemStatementId) {
            url = SIH.getEndPoint("/api/auth/ams/application/applicationApplicantResponse/" + applicationId + "/" + problemStatementId);
        }
        else {
            url = SIH.getEndPoint("/api/auth/ams/application/applicationApplicantResponse/" + applicationId)
        }
        $.ajax({
            url: url,
            type: 'GET',
            async: false,
            contentType: 'application/json',
            headers: {'X-Auth-Token': token, 'Content-Type': 'application/json'}
        }).done(function (response) {
            if (response && response.status && (response.status !== 'DRAFTED' && response.status !== 'INCOMPLETE')) {
                if (response.multiplePSAllowed && problemStatementId && response.problemStatementId && !response.multiplePSAllowed && problemStatementId != response.problemStatementId) {
                    disableAMSApplicantForm("This application allow submission of single problem Statement. You have already applied for: " + response.problemStatementTitle, response);
                }
                else
                    disableAMSApplicantForm("You have already applied for the challenge", response);
            }

            else if (response && response.status == 'INCOMPLETE' && (new Date().getTime() - new Date(response.application.endDate).getTime() > 432000000)) {
                disableAMSApplicantForm("You are too late to resubmit this application",response);
            } else if (response && response.questionResponses) {
                setFormData(response.questionResponses);
                $("input[name=id]").val(response.id);
                if (response.status === 'INCOMPLETE') {
                    $('input[name=amsFormSave]').remove();
                }
            } else if (response && response.application.createdBy === store.getItem("uniqueId")) {
                $(".buttonRow").html("");
            }
            if (response && response.problemStatementTitle) {
                problemStatementTitle = sessionStorage.getItem("problemStatementTitle") || response.problemStatementTitle;
                problemStatementDescription = sessionStorage.getItem("problemStatementDescription") || response.problemStatementDescription;
                sessionStorage.setItem("problemStatementTitle", problemStatementTitle);
                sessionStorage.setItem("problemStatementDescription", problemStatementDescription);
            }

            if(!response.questionResponses){
                fetchUserResponse();
            }

        }).error(function (response) {
            if (response && response.status === 403) {
                $('#modal-loader').modal('hide');
                $('.ams-error-modal p').html(response.responseText);
                $(".ams-error-modal").modal("show");
                $(".buttonRow").find(".btn").attr("disabled", "disabled");
                $("#ams-eligibility-error").show();
            } else {
                console.error("Error in fetching saved data");
            }

        });
    }
    $(document).on("addRepeatButton", function (obj) {
        console.log("add button clicked");
        var cloneElem = obj.cloneElem;
        var targetElem = obj.targetElem;
        var latestRepeat = $(targetElem).closest('.repeat-container').attr('repeatNumber');
        if(!latestRepeat){
            latestRepeat = 0;
        }
        $(targetElem).closest('.repeat-container').attr('repeatNumber',parseInt(latestRepeat) +1);
        var n = $(targetElem).closest('.repeat-container').find('.repeat-fields').length - 1;
        $(cloneElem).find("input[type=radio]").each(function (index, val) {
            var name = $(this).attr("name");
            $(this).attr("name", name + '_' + (parseInt(latestRepeat) +1));
        })

    });
    function disableAMSApplicantForm(msg,response) {
        setFormData(response.questionResponses);
        $("#ams-application-form input, #ams-application-form select, #ams-application-form textarea").prop("disabled", true);
        /*if(response.application.endDate){
            var endDate = new Date(response.application.endDate);
            endDate.setDate(endDate.getDate() +1);
            var currentDate = new Date();
            if(currentDate < endDate){*/
                $('.ams-error-modal p').html(msg);
                $(".ams-error-modal").modal("show");
            /*}
        }*/

        $(".buttonRow").find(".btn").attr("disabled", "disabled").hide();

    }

    function setFormData(data,autofill) {
        $.each(data, function (index, val) {
            if(!val){
                return;
            }
            var field = $('#ams-application-form input[name=' + index + '], ' +
                '#ams-application-form select[name=' + index + '], ' +
                '#ams-application-form textarea[name=' + index + ']');
            var isList = field.closest(".repeat-container").length;
            var type = field.attr("type");
            if (isList && Array.isArray(val)) {
                    var i =0;
                    val.forEach(function (value, idx) {
                        field = $('#ams-application-form input[name=' + index + '], #ams-application-form select[name=' + index + '], #ams-application-form textarea[name=' + index + ']');
                        var currentField = $(field).eq(idx);
                        if (type !== "radio") {
                            currentField.val(value);
                        }
                        var repeatField = currentField.closest('.repeat-container').find('.repeat-fields').length;
                        if (repeatField < val.length) {
                            var parent = currentField.closest(".repeat-container");
                            var button = parent.find(".repeat-add");
                            if (button.length > 0) {
                                button.trigger("click");
                            }
                        }

                        if (type === "radio") {
                            var name = $(field).attr("name");
                            if (i > 0) {
                                name = name + "_" + i;
                            }
                            $.each($('input[name=' + name + ']'), function (index, inputValue) {
                                if (value === $(this).val()) {
                                    $(this).prop('checked', true);
                                    return true;
                                }
                            });
                            i++;
                        }
                    });
                    field.closest(".repeat-container").attr('repeatNumber', val.length - 1)
                    /*if(type==='radio'){
                        var n = $('.repeat-container .repeat-fields').length;
                        var i = 0;
                        val.forEach(function (value, idx) {
                            var name = index;
                            if(i > 0){
                                name = name +"_" + i;
                            }
                            $.each($('input[name=' + name + ']'), function (index, inputValue) {
                                if (value === $(this).val()) {
                                    $(this).prop('checked', true);
                                    return true;
                                }
                            });
                            i++;
                        });
                    }*/
                } else if (type === 'radio') {
                    $.each($('input[name=' + index + ']'), function (index, value) {
                        if (val === $(this).val()) {
                            $(this).attr('checked', true);
                            return true;
                        }
                    });
                } else if (type === 'checkbox') {
                    $.each($('input[name=' + index + ']'), function (index, value) {
                        var inputVal = $(this).val();
                        $.each(val, function (index, value1) {
                            if (value1 === inputVal) {
                                $(value).attr('checked', true);
                            }
                        })
                    });
                } else if (type === "file") {
                    $("input[name=" + index + "][type=hidden]").val(val.fileName);
                    $("input[name=" + index + "FileName]").val(val.fileOriginalName);
                    var $formLink = $('a.' + index);
                    $formLink.prop("href", SIH.getEndPoint("/api/file/ams/applicant/doc/get/") + val.fileName).text(val.fileOriginalName).removeClass("display-n");
                } else {
                    field.val(val);
                    if (autofill) {
                        field.addClass('ams-autofill-field');
                    }
                }
            });
        }

        $(document).on("click", "form[name=ams-application-form] input[name='amsFormSave']", function () {
            getFormData(false);
            var id = $('input[name=id]').val();
            if(jQuery.inArray( applicationId, ["5ea181f8e4b0363cb6335eea", "5ebb99dae4b03b2ccef38dda", "5ebbf6e36827795ffb61b1ea", "5ebbf6e36827795ffb61b1eb", "5ebbf6e36827795ffb61b1ec", "5ebbf6e36827795ffb61b1ed", "5ebbf6e36827795ffb61b1ee", "5ebbf6e36827795ffb61b1ef", "5ebbf6e36827795ffb61b1f0", "5ebbf6e36827795ffb61b1f1"] ) > -1 ){
                id = "";
            }
            var data = {
                'id': id,
                'application': {'id': applicationId, 'formType': formType},
                'status': 'DRAFTED',
                'questionResponses': formData,
                'problemStatementTitle': problemStatementTitle,
                'problemStatementDescription': problemStatementDescription,
                'problemStatementId': problemStatementId
            };
            $('#modal-loader').modal('show');
            var apiPath = SIH.getEndPoint("/api/auth/ams/application/applicationResponse/save");
            if(jQuery.inArray( applicationId, ["5ea181f8e4b0363cb6335eea", "5ebb99dae4b03b2ccef38dda", "5ebbf6e36827795ffb61b1ea", "5ebbf6e36827795ffb61b1eb", "5ebbf6e36827795ffb61b1ec", "5ebbf6e36827795ffb61b1ed", "5ebbf6e36827795ffb61b1ee", "5ebbf6e36827795ffb61b1ef", "5ebbf6e36827795ffb61b1f0", "5ebbf6e36827795ffb61b1f1"] ) > -1 ){
                apiPath = SIH.getEndPoint("/api/noauth/ams/application/applicationResponse/save");
            }else {
                apiPath =  SIH.getEndPoint("/api/auth/ams/application/applicationResponse/save");
            }
            $.ajax({
                url: apiPath,
                type: "POST",
                contentType: 'application/json',
                headers: headers,
                data: JSON.stringify(data)
            }).done(function (response) {
                $('#modal-loader').modal('hide');
                if (response) {
                    $("input[name=id]").val(response.id);
                    showSuccessMessage($('#ams-application-form').data('save-msg'));
                } else {
                    showErrorMessage($('#ams-application-form').data('error-msg'));
                }
            }).error(function (response) {
                $('#modal-loader').modal('hide');
                if (response && response.status === 403) {
                    $('.ams-error-modal p').html(response.responseText);
                    $(".ams-error-modal").modal("show");
                    $(".buttonRow").find(".btn").attr("disabled", "disabled");
                } else if (response && response.status === 400) {
                    populateFormErrors(response, null, $target, errorMappingObj);
                    amsErrorBlockScroll();
                } else {
                    showErrorMessage($('#ams-application-form').data('error-msg'));
                }
            });
        });

        $(document).on("change", "form[name='ams-application-form'] input[type=file]", function (event) {
            var maxSize = $(event.target).attr('max-size');
            if (maxSize) {
                maxSize = maxSize * 1024 * 1024;
            } else {
                maxSize = 10485760;
            }
            checkAMSFileUpload(event.target, maxSize);
            return false;
        });

        function checkAMSFileUpload(fileToValidate, fileSize) {
            var message = "";
            if ($(fileToValidate).val() !== "") {
                if (fileToValidate.files && fileToValidate.files[0].size > fileSize) {
                    onErrorResetFileUpload(fileToValidate, $(fileToValidate).attr("name"));
                    message = "File Should not be greater than " + Math.floor(fileSize / 1048576) + " MB.";
                }
                if (message !== "") {
                    isValidated = false;
                    $(fileToValidate).siblings(".help-block").html(message).parents(".form-group").addClass("has-error");
                    $(fileToValidate).val("");
                } else {
                    if (fileToValidate.files) {
                        $(fileToValidate).siblings(".help-block").html("").parents(".form-group").removeClass("has-error");
                        var name = $(fileToValidate).attr("name");
                        var data = new FormData();
                        data.append("file", fileToValidate.files[0]);
                        if($(fileToValidate).data('value') && $(fileToValidate).data('value').length>0){
                            var value = $(fileToValidate).data('value');
                            apiPath=SIH.getEndPoint('/api/file/ams/applicant/doc/'+value);
                        }
                        else{
                            apiPath=SIH.getEndPoint('/api/file/ams/applicant/doc');
                        }
                        $(".modal.loader").modal("show");
                        if(jQuery.inArray( applicationId, ["5ea181f8e4b0363cb6335eea", "5ebb99dae4b03b2ccef38dda", "5ebbf6e36827795ffb61b1ea", "5ebbf6e36827795ffb61b1eb", "5ebbf6e36827795ffb61b1ec", "5ebbf6e36827795ffb61b1ed", "5ebbf6e36827795ffb61b1ee", "5ebbf6e36827795ffb61b1ef", "5ebbf6e36827795ffb61b1f0", "5ebbf6e36827795ffb61b1f1"] ) > -1 ){
                            $.ajax({
                                type: "POST",
                                data: data,
                                dataType: 'json',
                                contentType: false,
                                processData: false,
                                url:apiPath
                            }).done(function (data) {
                                $(".modal.loader").modal("hide");
                                $(fileToValidate).siblings("input[type='hidden'][name=" + name + "FileName]").val(fileToValidate.files[0].name);
                                $(fileToValidate).siblings("input[type='hidden'][name=" + name + "]").val(data.name);
                                if (data.name) {
                                    var $fileLink = $(fileToValidate).siblings('a');
                                    $fileLink.prop("href", SIH.getEndPoint("/api/file/ams/applicant/doc/get/") + data.name).text(data.originalFilename).removeClass("display-n");
                                }
                            }).error(function (xhr, error, thrown) {
                                onErrorResetFileUpload(fileToValidate, name);
                                $(".modal.loader").modal("hide");
                                showErrorModal(xhr.responseText);
                                return false;
                            });
                        }else {
                            $.ajax({
                                type: "POST",
                                data: data,
                                dataType: 'json',
                                contentType: false,
                                processData: false,
                                url:apiPath,
                                headers: {"X-Auth-Token": store.getItem("token")}
                            }).done(function (data) {
                                $(".modal.loader").modal("hide");
                                $(fileToValidate).siblings("input[type='hidden'][name=" + name + "FileName]").val(fileToValidate.files[0].name);
                                $(fileToValidate).siblings("input[type='hidden'][name=" + name + "]").val(data.name);
                                if (data.name) {
                                    var $fileLink = $(fileToValidate).siblings('a');
                                    $fileLink.prop("href", SIH.getEndPoint("/api/file/ams/applicant/doc/get/") + data.name).text(data.originalFilename).removeClass("display-n");
                                }
                            }).error(function (xhr, error, thrown) {
                                onErrorResetFileUpload(fileToValidate, name);
                                $(".modal.loader").modal("hide");
                                showErrorModal(xhr.responseText);
                                return false;
                            });
                        }
                    }
                }
            }
            return false;
        }

        function onErrorResetFileUpload(fileToValidate, name) {
            $(fileToValidate).siblings("input[type='hidden'][name=" + name + "FileName]").removeAttr("value");
            $(fileToValidate).siblings("input[type='hidden'][name=" + name + "]").removeAttr("value");
            $(fileToValidate).siblings('a').attr("href", "").text("").addClass('display-n');
        }

    }





$.goaRecognition = function () {
    var cin = "";
    var referenceNo = "";
    var lastAccordionSaved = "";
    var formData = new FormData();
    var isValidated = true;
    var tableContent;
    var authToken = store.getItem("token");

    var $entity_type = $("select[name='entityType']");
    var $industry_id = $("select[name='industry_id']");
    var $section = $("select[name='section']");
    var $categories_id = $("select[name='categories_id']");
    var $state_id = $('#state_name');
    var $incorp_number = $("input[name='incorpNumber']");
    var $incorp_date = $("input[name='incorpDate']");
    var $entity_name = $("input[name='entityName']");
    var $tax_ipr = $("select[name='tax_benifit']");
    var $submitRecognitionForm = $("input[name='submitRecognitionForm']");

    //Funding Source
    var $isFunded = $("input[name=funded]");
    var $isFundedVal = $("input[name=funded]:checked").val();
    var $fundingSource = $("input[name=fundingSource]");

    //IPR
    var $appliedForIpr = $("input[name=appliedForIpr]");
    var $appliedForIprVal = $("input[name=appliedForIpr]:checked").val();
    var $iprForm = $(".regiFormSection");

    //Another State
    var $anotherStateRegistered = $("input[name=registeredInOtherState]");
    var $anotherStateRegisteredVal = $("input[name=registeredInOtherState]:checked").val();
    var $anotherStateName = $("select[name=otherState]");
    var $anotherStateRegistrationNo = $("input[name=startupRegNo]");
    var $anotherStateRegistrationDate = $("input[name=startupRegDate]");

    //DIPP
    var $registeredWithDipp = $("input[name=dippCertified]");
    var $registeredWithDippVal = $("input[name=dippCertified]:checked").val();
    var $dippNumber = $("input[name=dippNumber]");

    var entityType = {
        "1": "PRIVATE_LIMITED_COMPANY",
        "2": "LIMITED_LIABILITY_PARTNERSHIP",
        "3": "REGISTERED_PARTNERSHIP",
    };
    initForm();

    function prePopulateForm() {
        $.ajax({
            type: "GET",
            async: false,
            url: SIH.getEndPoint("/api/auth/user/profile"),
            headers: {"X-Auth-Token": store.getItem("token")}
        }).done(function (data) {
            $("select[name=entityType]").val(entityType[data.user.startup.startupEntity]).trigger("change");
            $("select[name=startupindustry]").val(data.user.startup.focusArea.industry.id);
            if (data.user.startup.focusArea.industry.id) {
                var params = {};
                params["industry"] = data.user.startup.focusArea.industry.id;
                var $selection = $("#sector");
                setList(params, $selection.data("path"), $selection);
                $("select[name=sector]").val(data.user.startup.focusArea.sectors[0].id)
            }
            var selectedServices = [];
            $(data.user.startup.services).each(function (key, val) {
                $("select[name=services] option").each(function (key, value) {
                    if ($(this).text() === val) {
                        selectedServices.push($(value).val());
                    }
                });
            });
            $("select[name=services]").val(selectedServices).trigger('change');
            $("input[name=panNumber]").val(data.user.startup.pan);
            $("input[name=incorpNumber]").val(data.user.startup.cin);
            if (data.user.startup.cin) {
                $("input[name=incorpNumber]").trigger("change");
            }
            $("input[name=website]").val(data.user.startup.website);
            $.each($('input[name=stage]'), function (index, value) {
                if (($(this).val() === "on" && data.user.startup.stage === true) || ($(this).val() === "off" && data.user.startup.stage === false) || ($(this).val() === data.user.startup.stage)) {
                    $(this).attr('checked', true);
                }
            });
            $.each($('input[name=dippCertified]'), function (index, value) {
                if (($(this).val() === "on" && data.user.startup.dippCertified === true) || ($(this).val() === "off" && data.user.startup.dippCertified === false) || ($(this).val() === data.user.startup.dippCertified)) {
                    $(this).attr('checked', true).trigger("change");
                }
            });
            $("input[name=dippNumber]").val(data.user.startup.dippNumber);
            $("textarea[name=ideaBrief].richTextArea").summernote("code", data.user.startup.ideaBrief);
            $('#modal-loader').modal('hide');
        });
    }

    function populateUploadedFiles(data) {
        ["businessModel", "pitchDeck", "letters"].forEach(function (fileName) {
            if (data[fileName]) {
                $("input[name='" + fileName + "']").val(data[fileName]);
                $("input[name='" + fileName + "FileName']").val(data[fileName + "FileName"]);
                var $presentationLink = $("input[type=file][name='upload_" + fileName + "']").siblings("a.presentationLink");
                $presentationLink.prop("href", SIH.getEndPoint("/api/file/stateRecognition/goa/") + data[fileName] + "/get").text(data[fileName + "FileName"]).removeClass("display-n");
            }
        });
    }

    function initForm() {
        if (!$isFundedVal || $isFunded === "off") {
            $fundingSource.closest(".repeatcontainer").addClass("display-n");
            $fundingSource.closest(".repeatcontainer").find(".form-group").addClass("display-n");
        }
        if (!$appliedForIprVal || $appliedForIprVal === "off") {
            $iprForm.addClass("display-n");
        }
        if (!$anotherStateRegisteredVal || $anotherStateRegisteredVal === "off") {
            $anotherStateName.closest(".form-group").addClass("display-n");
            $anotherStateRegistrationNo.closest(".form-group").addClass("display-n");
            $anotherStateRegistrationDate.closest(".form-group").addClass("display-n");
        }
        if (!$registeredWithDippVal || $registeredWithDippVal === "off") {
            $dippNumber.closest(".form-group").addClass("display-n");
        }
    }

    $entity_type.on("change", function () {
        $('input[name=incorpDate], input[name=entityName], input[name=incorpNumber]').val('');
        if ($(this).val() === "PRIVATE_LIMITED_COMPANY" || $(this).val() === "LIMITED_LIABILITY_PARTNERSHIP") {
            $('input[name=incorpDate]').attr('readonly', 'readonly');
            $('input[name=entityName]').attr({
                'readonly': 'true'
            });
        } else {
            $('input[name=incorpDate]').removeAttr('readonly');
            $('input[name=entityName]').removeAttr('readonly');
        }
    });

    $isFunded.change(function () {
        var val = $("input[name=funded]:checked").val();
        if (val === "on") {
            $fundingSource.closest(".repeatcontainer").removeClass("display-n");
            $fundingSource.closest(".repeatcontainer").find(".form-group").removeClass("display-n");
        } else {
            $fundingSource.closest(".repeatcontainer").addClass("display-n");
            $fundingSource.closest(".repeatcontainer").find(".form-group").addClass("display-n");
        }
    });
    $appliedForIpr.change(function () {
        var val = $("input[name=appliedForIpr]:checked").val();
        if (val === "on") {
            $iprForm.removeClass("display-n");
        } else {
            $iprForm.addClass("display-n");
        }
    });
    $anotherStateRegistered.change(function () {
        var val = $("input[name=registeredInOtherState]:checked").val();
        if (val === "on") {
            $anotherStateName.closest(".form-group").removeClass("display-n");
            $anotherStateRegistrationNo.closest(".form-group").removeClass("display-n");
            $anotherStateRegistrationDate.closest(".form-group").removeClass("display-n");
        } else {
            $anotherStateName.closest(".form-group").addClass("display-n");
            $anotherStateRegistrationNo.closest(".form-group").addClass("display-n");
            $anotherStateRegistrationDate.closest(".form-group").addClass("display-n");
        }
    });

    $registeredWithDipp.change(function () {
        var val = $("input[name=dippCertified]:checked").val();
        if (val === "on") {
            $dippNumber.closest(".form-group").removeClass("display-n");
        } else {
            $dippNumber.closest(".form-group").addClass("display-n");
        }
    });

    $(".accordionitem:first").find(".accordion-section-title").addClass("active");
    $(".accordionitem:first").find(".accordion-section-content").addClass("open").show();

    $incorp_number.on("change", function () {
        if ($entity_type.val() !== "REGISTERED_PARTNERSHIP") {
            var $this = this;
            $('#modal-loader').modal('show');
            $.ajax({
                type: "POST",
                dataType: "json",
                data: {"incorp_no": $(this).val()},
                url: $("#incorporationNoMCA").val(),
                success: function (data) {
                    $('#modal-loader').modal('hide');
                    if (data.isValidIncorporationNo === "true") {
                        $entity_name.val(data.nameEntity).attr("readonly", "readonly").parents(".form-group").removeClass("has-error").find(".help-block").html("");
                        var dateSplit = data.incorpdate.split("-");
                        if (dateSplit.length === 3) {
                            $incorp_date.val(dateSplit[1] + "/" + dateSplit[0] + "/" + dateSplit[2]).attr("readonly", "readonly").parents(".form-group").removeClass("has-error").find(".help-block").html("");
                        }
                        $($this).parents(".form-group").removeClass("has-error").find(".help-block").html("");
                    } else {
                        //  $entity_name.val("").removeAttr("readonly");
                        //  $incorp_date.val("").removeAttr("readonly");
                        $($this).parents(".form-group").addClass("has-error").find(".help-block").html("Please enter valid CIN number.")
                    }
                },
                error: function () {
                    $('#modal-loader').modal('hide');
                    $($this).parents(".form-group").addClass("has-error").find(".help-block").html("We are facing problems fetching your CIN details. Please try after some time.")
                }
            });
        }
    });


    $(".fileuploadMultipurpose").change(function () {
        var _this = $(this);
        checkFileUpload(this, _this.data("propname"), _this.data("propdisplay"), 10000000);
    });


    $("input[name='ipr_type']").on("change", function () {
        if ($(this).val() === "1") {
            $(".regiFormSection").removeClass("display-n");
        } else {
            $(".regiFormSection").addClass("display-n");
        }
    });

    $("input[name='patent_type']").on("change, click", function () {
        $("input[name='patent_type']").parents("td").removeClass("has-error");
        if ($("input[name='patent_type']:checked").length > 0) {
            $("input[name='patent_application_no']").parent().removeClass("display-n");
        }
    });

    $("input[name='trademark_type']").on("change, click", function () {
        $("input[name='trademark_type']").parents("td").removeClass("has-error");
        if ($("input[name='trademark_type']:checked").length > 0) {
            $("input[name='trademark_application_no']").parent().removeClass("display-n");
        }
    });

    $("input[name='copyright_type']").on("click", function () {
        $("input[name='copyright_type']").parents("td").removeClass("has-error");
    });

    $("input[name='design_type']").on("change, click", function () {
        $("input[name='design_type']").parents("td").removeClass("has-error");
        if ($("input[name='design_type']:checked").length > 0) {
            $("input[name='design_application_no']").parent().removeClass("display-n");
        }
    });

    $("input[name='plant_variety_type']").on("click", function () {
        $("input[name='plant_variety_type']").parents("td").removeClass("has-error");
    });

    $("input[name='innovative_product_service_type']").on("change", function () {
        if ($(this).val() === "1") {
            $(".innovative_product_service_table").removeClass("display-n");
        } else {
            $(".innovative_product_service_table").addClass("display-n");
        }
    });

    $("input[name='business_model_type']").on("change", function () {
        if ($(this).val() === "1") {
            $(".business_model_detail").removeClass("display-n");
        } else {
            $(".business_model_detail").addClass("display-n");
        }
    });

    $($entity_type).on("change", function () {
        $('input[name=incorp_date], input[name=entity_name], input[name=incorp_number]').val('');
        if ($(this).val() === "PRIVATE_LIMITED_COMPANY" || $(this).val() == "LIMITED_LIABILITY_PARTNERSHIP") {
            $('input[name=incorp_date]').attr('disabled', 'disabled');
            $('input[name=entity_name]').attr({
                'disabled': 'disabled',
                'readonly': 'true'
            });
            $('.recognition-tax-benifit #tax_benifit').removeAttr('disabled');
            $('.recognition-tax-benifit #tax_benifit>option:eq(0)').prop('selected', true);
        } else {
            $('input[name=incorp_date]').removeAttr('disabled');
            $('input[name=entity_name]').removeAttr('readonly disabled');
            $('.recognition-tax-benifit #tax_benifit>option:eq(1)').prop('selected', true);
            $('.recognition-tax-benifit #tax_benifit').attr('disabled', 'disabled');

            $(".availTaxBenefit").addClass("display-n").find("textarea").val("");
            $(".availTaxBenefit").find(".fundedFileName a").html("");
            $tax_ipr.val("0");
            $tax_ipr.find("option[value='1']").addClass("display-n");
            $(".notEligibleForTax-errorMessage").removeClass("display-n");
        }
    });

    var saveObject = {
        "SaveEntity": {"name": "SaveEntity", "section": 1, "errorMessage": "saveEntityErrorMessage"},
        "saveAuthorizedRepresentatives": {
            "name": "saveAuthorizedRepresentatives",
            "section": 2,
            "errorMessage": "saveAuthorizedRepErrorMessage"
        },
        "saveFundingDetails": {
            "name": "saveFundingDetails",
            "section": 3,
            "errorMessage": "saveFundingDetailsMessage"
        },
        "saveRequiredInfo": {"name": "saveRequiredInfo", "section": 4, "errorMessage": "saveRequiredInfoErrorMessage"},
        "saveFounderDetails": {
            "name": "saveFounderDetails",
            "section": 5,
            "errorMessage": "saveFounderDetailsErrorMessage"
        },
        "saveSelfCertification": {
            "name": "saveSelfCertification",
            "section": 6,
            "errorMessage": "saveSelfCertificationErrorMessage"
        }
    };

    $("input[value='Save'],input[name='submitRecognitionForm']").click(function (e) {
        var s = saveObject[this.name];
        var $this = this;
        var $target = $(e.currentTarget);
        var isSubmit = $target.val() === "Submit";
        var url = SIH.getEndPoint("/api/auth/recognition/draft/goa/startup");
        if (isSubmit) {
            url = SIH.getEndPoint("/api/auth/recognition/save/goa/startup");
            $target = $(".certify");
        }
        validate($target);
        if (isValidated) {
            var $formData = $target.closest("form.goaRecognitionForm").serialize();
            var data = convertSerializeDataToJSON($formData);
            handleCustomizedData(data);
            s && (data["lastAccordionSaved"] = s.section);
            $('#modal-loader').modal('show');
            $.ajax({
                url: url,
                data: JSON.stringify(data),
                type: 'POST',
                beforeSend: setAuthTokenHeader,
                contentType: "application/json",
                success: function (response) {
                    $('#modal-loader').modal('hide');
                    if (response) {
                        saveStateRecognized();
                        $("input[name=id]").val(response);
                        $($this).parents(".accordion-section-content").hide();
                        var $accItem = $($this).parents(".accordionitem");
                        $accItem.find(".accordion-section-title").removeClass("active");
                        $accItem.next().find(".accordion-section-title").addClass("active");
                        $accItem.next().find(".accordion-section-content").show();

                    }
                    if (isSubmit) {
                        window.location.href = $("#thankyouPage").val();
                    }
                }, error: function (response) {
                    $('#modal-loader').modal('hide');
                    var errorMsg = "Error in saving the form";
                    if (response != null) {
                        errorMsg = response.constructor === Array && response.get(0) != null ? response[0].defaultMessage : (response.responseText != null && response.responseText != "" ? errorMsg + " : " + response.responseText : errorMsg);
                    }
                    $('.goa-recognition-error-modal p').html(errorMsg);
                    $('.goa-recognition-error-modal').modal('show');
                }
            });

        } else {
            $(".accordionitem").find(".accordion-section-title").removeClass("active").end()
                .find(".accordion-section-content").hide();
            var _firstErrorElem = $(".form-group.has-error:first");
            $('html, body').animate({
                scrollTop: _firstErrorElem.offset().top - 15
            }, 500);
            _firstErrorElem.closest(".accordionitem").find(".accordion-section-title").addClass("active");
            $(".form-group.has-error").each(function () {
                $(this).closest(".accordionitem").find(".accordion-section-content").show();
            });
        }
    });

    function checkFileUpload(fileToValidate, fileOriginal, fileDisplayName, fileSize) {

        var message = "";
        if ($(fileToValidate).val() !== "") {
            if (fileToValidate.files[0].size > fileSize) {
                isValidated = false;
                message = "File Should not be greater than " + Math.floor(fileSize / 1000000) + " MB.";
            }
            if ((fileToValidate.files[0].type).indexOf("image") > -1) {
                isValidated = false;
                message = message + "Image-type file format not accepted.";
            }
            if (message !== "") {
                isValidated = false;
                $(fileToValidate).siblings(".help-block").html(message).parents(".form-group").addClass("has-error");
                $(fileToValidate).val("");
                $(fileToValidate).siblings(".fileName").val("");
                $(fileToValidate).siblings(".fileDisplayName").val("");
                $(fileToValidate).siblings("a.presentationLink").addClass("display-n");
            } else {
                $(fileToValidate).siblings(".help-block").html("").parents(".form-group").removeClass("has-error");
                $(fileToValidate).siblings("input[type='hidden'][name='" + fileDisplayName + "']").val(fileToValidate.files[0].name);
                var data = new FormData();
                data.append("file", fileToValidate.files[0]);
                $(".modal.loader").modal("show");
                $.ajax({
                    type: "POST",
                    data: data,
                    dataType: 'json',
                    contentType: false,
                    processData: false,
                    url: SIH.getEndPoint("/api/file/stateRecognition/doc/goa"),
                    headers: {"X-Auth-Token": store.getItem("token")}
                }).done(function (data) {
                    $(".modal.loader").modal("hide");
                    $(fileToValidate).siblings("input[type='hidden'][name='" + fileOriginal + "']").val(data.name);
                    if (data.name) {
                        var $presentationLink = $(fileToValidate).siblings("a.presentationLink");
                        $presentationLink.prop("href", SIH.getEndPoint("/api/file/stateRecognition/goa/") + data.name + "/get").text(data.originalFilename).removeClass("display-n");
                    }
                }).error(function () {
                    $(".modal.loader").modal("hide");
                    alert("Error in uploading file. Please try again.");
                    $(fileToValidate).val("");
                    $(fileToValidate).siblings(".fileName").val("");
                    $(fileToValidate).siblings(".fileDisplayName").val("");
                    $(fileToValidate).siblings("a.presentationLink").addClass("display-n");
                    return false;
                });
            }
        }
        return false;
    }

    function handleCustomizedData(data) {
        var services = data["services"];
        if ($("input[name=funded]:checked").val() === "on") {
            var fundingSource = data["fundingSource"];
            var founderName = data["founderName"];
            if (fundingSource && !Array.isArray(fundingSource)) {
                fundingSource = new Array(fundingSource);
            }
            if (founderName && !Array.isArray(founderName)) {
                founderName = new Array(founderName);
            }
            if (fundingSource && fundingSource.length) {
                var fundingDetails = [];
                $(fundingSource).each(function (index, item) {
                    var fund = {
                        fundingSource: Array.isArray(data["fundingSource"]) ? data["fundingSource"][index] : data["fundingSource"],
                        fundingAmount: Array.isArray(data["fundingAmount"]) ? data["fundingAmount"][index] : data["fundingAmount"],
                        fundingDate: Array.isArray(data["fundingDate"]) ? data["fundingDate"][index] : data["fundingDate"]
                    };
                    fundingDetails.push(fund);

                });
                data["fundingDetails"] = fundingDetails;
                delete data["fundingSource"];
                delete data["fundingAmount"];
                delete data["fundingDate"];
            }
        } else {
            delete  data["fundingDetails"];
        }
        var founderName = $('input[name=founderName]');
        var founderAddress = $('input[name=founderAddress]');
        var founderAge = $('input[name=founderAge]');
        var founderEducation = $('input[name=founderEducation]');
        var founderExperience = $('input[name=founderExperience]');
        var founderExperienceDetails = $('input[name=founderExperienceDetails]');

        var founderDetails = [];
        for (var i = 0; i < founderName.length; i++) {
            var founder = {
                founderName: $(founderName[i]).val(),
                founderAddress: $(founderAddress[i]).val(),
                founderAge: $(founderAge[i]).val(),
                founderEducation: $(founderEducation[i]).val(),
                founderExperience: $(founderExperience[i]).val(),
                founderExperienceDetails: $(founderExperienceDetails[i]).val()
            };
            founderDetails.push(founder);
        }
        data["founderDetails"] = founderDetails;
        delete data["founderName"];
        delete data["founderAddress"];
        delete data["founderAge"];
        delete data["founderEducation"];
        delete data["founderExperience"];
        delete data["founderExperienceDetails"];

        /* if(founderName && founderName.length){

             $(founderName).each(function(index,item){
                 var founder = {
                     founderName: Array.isArray(data["founderName"]) ? data["founderName"][index] : data["founderName"],
                     founderAddress:Array.isArray(data["founderAddress"]) ? data["founderAddress"][index] : data["founderAddress"],
                     founderAge:Array.isArray(data["founderAge"]) ? data["founderAge"][index] : data["founderAge"],
                     founderEducation:Array.isArray(data["founderEducation"]) ? data["founderEducation"][index] : data["founderEducation"],
                     founderExperience:Array.isArray(data["founderExperience"]) ? data["founderExperience"][index] : data["founderExperience"],
                     founderExperienceDetails:Array.isArray(data["founderExperienceDetails"]) ? data["founderExperienceDetails"][index] : data["founderExperienceDetails"]
                 };
                 founderDetails.push(founder);

             });
             data["founderDetails"] = founderDetails;
             delete data["founderName"];
             delete data["founderAddress"];
             delete data["founderAge"];
             delete data["founderEducation"];
             delete data["founderExperience"];
             delete data["founderExperienceDetails"];
         }*/
        if (services && !Array.isArray(services)) {
            data["services"] = new Array(services);
        }
        if ($("input[name=dippCertified]:checked").val() === "off") {
            delete data["dippNumber"];
        }
        if ($("input[name=registeredInOtherState]:checked").val() === "off") {
            delete data["otherState"];
            delete data["startupRegNo"];
            delete data["startupRegDate"];
        }
        if ($("input[name=appliedForIpr]:checked").val() === "off") {
            delete data["patent"];
            delete data["trademark"];
            delete data["copyright"];
            delete data["design"];
            delete data["plantVariety"];
            delete data["patentApplicationNo"];
            delete data["trademarkApplicationNo"];
            delete data["copyrightApplicationNo"];
            delete data["designApplicationNo"];
            delete data["plantVarietyApplicationNo"];
        }
    }

    if (authToken) {
        getRecognitionData();
    }

    function getRecognitionData() {
        $('#modal-loader').modal('show');
        $.ajax({
            type: "GET",
            async: false,
            url: SIH.getEndPoint("/api/auth/recognition/fetchDetails/goa/startup"),
            headers: {"X-Auth-Token": authToken}
        }).done(function (data) {
            if (data) {
                setFormData(data);
            } else {
                prePopulateForm();
            }
        });
    }

    function checkRequiredField(attrValue, inputSel) {
        var requiredField = $(inputSel).closest(".form-group").find("sup.required");
        if (requiredField && requiredField.length > 0 && (!attrValue || attrValue === "")) {
            isValidated = false;
            $(inputSel).closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field can't be left Blank.");
        } else {
            $(inputSel).closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
        }
    }


    function infoRequiredData(accordianItem, fieldName) {
        var inputSelection = $(accordianItem).find("input[name='" + fieldName + "']:checked");
        var attrValue = $(inputSelection).val();
        if (attrValue) {
            formData.delete(fieldName);
            formData.append(fieldName, attrValue.toString());
        }
        checkRequiredField(attrValue, $(accordianItem).find("input[name='" + fieldName + "']"));
    }

    $('input[name=product_service_type]').change(function (e) {
        var val = $('input[name=product_service_type]:checked').val();
        if (val) {
            if (val === "1") {
                $(this).closest(".form-group").append("<p id='stageCheck' style='color:#a94442'>Startups at Ideation Stage are not eligible for Tax Benefits</p>");
            } else {
                $('#stageCheck').remove();
            }
        }

    });

    function showRecognitionError(obj, msg) {
        msg = msg ? msg : "There might be some error in your form, please recheck and save again.";
        $(obj).parents(".button").next().find(".has-error").html(msg).removeClass('display-n');
    }

    function validate($target) {
        var validateIpr = false;
        if ($("input[name=incorpNumber]").closest(".form-group").hasClass("has-error")) {
            isValidated = false;
            return false;
        }
        isValidated = true;
        var currentTarget = $target.closest('div.accordionitem');
        var validateSections = [];
        validateSections.push($(currentTarget));
        $(currentTarget).attr("validate", "1");
        $(currentTarget).prevAll().each(function () {
            $(this).attr("validate", "1");
            validateSections.push($(this));
        });

        var requiredFields = $('div.accordion-section sup.required');
        $.each(requiredFields, function (index, item) {
            if (($(item).closest("div.accordionitem")).attr("validate") === "1") {
                var element = $(item).closest('.form-group').find(".form-control:not(.richTextarea,.customised-dropdown)");
                if (element.attr("name") === "appliedForIpr") {
                    validateIpr = true;
                }
                if (element && element.length > 0 && !element.closest(".modal").length && !element.closest(".form-group").hasClass("display-n")) {
                    if (element.attr("type") === "radio" || element.attr("type") === "checkbox") {
                        if (element.is(':checked')) {
                            element.closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
                        }
                        else {
                            if (element.attr("type") === "checkbox") {
                                element.closest(".form-group").addClass("has-error");
                            } else {
                                element.closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field cannot be left Blank.");
                            }
                            isValidated = false;
                        }
                    }
                    else if (!element.val() || element.val() === "") {
                        isValidated = false;
                        showErrorState(element, true);
                    } else if (element.attr("minlength") && element.val().length < parseInt(element.attr("minlength"))) {
                        element.closest(".form-group").addClass("has-error").find("span.help-block").first().html("Mimimum length of this field must be " + element.attr("minlength"));
                        isValidated = false;
                    } else {
                        showErrorState(element, false);
                    }
                }

            }
        });
        var richTextAreas = $('.form-control.richTextarea');
        $.each(richTextAreas, function (index, item) {
            if (($(item).closest("div.accordionitem")).attr("validate") === "1") {
                var el = $(item);
                if (el.closest('.form-group').find('sup.required').length > 0) {
                    var note = el.val().trim();
                    if (note.length > 0 && !el.summernote('isEmpty')) {
                        el.siblings('.note-editor.note-frame').removeClass('note-has-error').addClass('note-writer-text');
                        showErrorState(el, false);
                    } else {
                        isValidated = false;
                        el.siblings('.note-editor.note-frame').addClass('note-has-error').removeClass('note-writer-text');
                        showErrorState(el, true);
                    }
                }
            }
        });

        var customizedDropDown = $('.form-control.customised-dropdown');
        $.each(customizedDropDown, function (index, item) {
            if (($(item).closest("div.accordionitem")).attr("validate") === "1") {
                var el = $(item);
                var selectedIndustries = $("select[name=industry]").val();
                if (!selectedIndustries || selectedIndustries.length === 0) {
                    isValidated = false;
                    showErrorState(el, true);
                } else {
                    $.each(selectedIndustries, function (idx, selectedIndustry) {
                        var selectedIndustryArr = selectedIndustry.split("/");
                        var industryName = selectedIndustryArr[selectedIndustryArr.length - 1];
                        if (el.find("ul#sector").first().find("input[name=" + industryName + "][type=checkbox]:checked").length === 0) {
                            isValidated = false;
                            showErrorState(el, true);
                        } else {
                            showErrorState(el, false);
                        }
                    });
                }
            }
        });

        var regexValidatedfields = $('.form-control.regex-val');
        $.each(regexValidatedfields, function (index, item) {
            if (($(item).closest("div.accordionitem")).attr("validate") === "1") {
                var element = $(item);
                var re = new RegExp(element.attr("regex"));
                if (element.val() && !re.test(element.val())) {
                    isValidated = false;
                    //showErrorState(element, true);
                    element.closest(".form-group").addClass("has-error");
                    element.siblings(".regex-msg").show();
                }
                else {
                    if (!(element.closest(".form-group").has("sup.required") && !element.val())) {
                        showErrorState(element, false);
                    }
                    element.siblings(".regex-msg").hide();
                }
            }
        });
        var iprValue = $("input[name=appliedForIpr]:checked").val();
        if (iprValue === "on" && validateIpr) {
            validateIPR();
        }
    }

    function validateIPR() {
        var validated = false;
        var patent = $("input[name=patent]:checked");
        var trademark = $("input[name=trademark]:checked");
        var copyright = $("input[name=copyright]:checked");
        var design = $("input[name=design]:checked");
        var plantVariety = $("input[name=plantVariety]:checked");

        var patentNo = $("input[name=patentApplicationNo]");
        var trademarkNo = $("input[name=trademarkApplicationNo]");
        var copyrightNo = $("input[name=copyrightApplicationNo]");
        var designNo = $("input[name=designApplicationNo]");
        var plantNo = $("input[name=plantVarietyApplicationNo]");

        if (patent && patent.length) {
            if (patentNo.val()) {
                patentNo.parents("td").removeClass("has-error");
            } else {
                patentNo.parents("td").addClass("has-error");
                validated = validated || true;
            }
        }
        if (patentNo.val()) {
            if (patent && !patent.length) {
                $("input[name=patent]").parents("td").addClass("has-error");
                validated = validated || true;
            } else {
                $("input[name=patent]").parents("td").removeClass("has-error");
            }
        }

        if (trademark && trademark.length) {
            if (trademarkNo.val()) {
                trademarkNo.parents("td").removeClass("has-error");
            } else {
                trademarkNo.parents("td").addClass("has-error");
                validated = validated || true;
            }
        }
        if (trademarkNo.val()) {
            if (trademark && !trademark.length) {
                $("input[name=trademark]").parents("td").addClass("has-error");
                validated = validated || true;
            } else {
                $("input[name=trademark]").parents("td").removeClass("has-error");
            }
        }

        if (copyright && copyright.length) {
            if (copyrightNo.val()) {
                copyrightNo.parents("td").removeClass("has-error");
            } else {
                copyrightNo.parents("td").addClass("has-error");
                validated = validated || true;
            }
        }
        if (copyrightNo.val()) {
            if (copyright && !copyright.length) {
                $("input[name=copyright]").parents("td").addClass("has-error");
                validated = validated || true;
            } else {
                $("input[name=copyright]").parents("td").removeClass("has-error");
            }
        }
        if (design && design.length) {
            if (designNo.val()) {
                designNo.parents("td").removeClass("has-error");
            } else {
                designNo.parents("td").addClass("has-error");
                validated = validated || true;
            }
        }
        if (designNo.val()) {
            if (design && !design.length) {
                $("input[name=design]").parents("td").addClass("has-error");
                validated = validated || true;
            } else {
                $("input[name=design]").parents("td").removeClass("has-error");
            }
        }
        if (plantVariety && plantVariety.length) {

            if (plantNo.val()) {
                plantNo.parents("td").removeClass("has-error");
            } else {
                plantNo.parents("td").addClass("has-error");
                validated = validated || true;
            }
        }
        if (plantNo.val()) {
            if (plantVariety && !plantVariety.length) {
                $("input[name=plantVariety]").parents("td").addClass("has-error");
                validated = validated || true;
            } else {
                $("input[name=plantVariety]").parents("td").removeClass("has-error");
            }
        }

        if (validated) {
            isValidated = false;
        }
    }

    function setFormData(data) {
        $.each(data, function (index, val) {
            var field = $('form.goaRecognitionForm input[name=' + index + '], form.goaRecognitionForm select[name=' + index + '], form.goaRecognitionForm textarea[name=' + index + ']');
            var isList = Boolean(field.closest(".repeat-container").length);
            var type = field.attr("type");
            if (type === 'radio') {
                $.each($('input[name=' + index + ']'), function (index, value) {
                    if (($(this).val() === "on" && val === true) || ($(this).val() === "off" && val === false) || ($(this).val() === val)) {
                        $(this).attr('checked', true);
                        field.trigger("change");
                        return true;
                    }
                });
            } else if (type === 'checkbox') {
                $.each($('input[name=' + index + ']'), function (index, value) {
                    var inputVal = $(this).val();
                    $.each(val, function (index, value1) {
                        if (value1 === inputVal) {
                            $(value).attr('checked', true);
                        }
                    })
                });
            }
            else if (isList && Array.isArray(val)) {
                val.forEach(function (value, idx) {
                    field = $('form.goaRecognitionForm input[name=' + index + '], form.goaRecognitionForm select[name=' + index + '], form.goaRecognitionForm textarea[name=' + index + ']');
                    var currentField = $(field).eq(idx);
                    currentField.val(value);
                    if (field.length < val.length) {
                        var parent = currentField.closest(".repeat-container");
                        var button = parent.find(".repeat-add");
                        if (button.length > 0) {
                            button.trigger("click");
                        }
                    }
                })
            } else {
                field.val(val);
                if (index !== "incorpNumber" && index !== 'entityType') {
                    field.trigger("change")
                }
            }
        });
        if (data["startupindustry"]) {
            var params = {};
            params["industry"] = data["startupindustry"];
            var $selection = $("#sector");
            setList(params, $selection.data("path"), $selection);
            $selection.val(data["sector"]);
        }
        if (data["fundingDetails"]) {
            data["fundingDetails"].forEach(function (value, idx) {
                var fundingSource = $('form.goaRecognitionForm input[name=fundingSource]')[idx];
                var fundingAmount = $('form.goaRecognitionForm input[name=fundingAmount]')[idx];
                var fundingDate = $('form.goaRecognitionForm input[name=fundingDate]')[idx];
                $(fundingSource).val(value["fundingSource"]);
                $(fundingAmount).val(value["fundingAmount"]);
                $(fundingDate).val(value["fundingDate"]);
                if ((idx + 1) < data["fundingDetails"].length) {
                    $('form.goaRecognitionForm input[name=fundingSource]').closest(".repeat-container").find('.repeat-add').trigger("click");
                }
            });
        }
        if (data["founderDetails"]) {
            data["founderDetails"].forEach(function (value, idx) {
                var founderName = $('form.goaRecognitionForm input[name=founderName]')[idx];
                var founderAge = $('form.goaRecognitionForm input[name=founderAge]')[idx];
                var founderAddress = $('form.goaRecognitionForm input[name=founderAddress]')[idx];
                var founderEducation = $('form.goaRecognitionForm input[name=founderEducation]')[idx];
                var founderExperience = $('form.goaRecognitionForm input[name=founderExperience]')[idx];
                var founderExperienceDetails = $('form.goaRecognitionForm input[name=founderExperienceDetails]')[idx];
                $(founderName).val(value["founderName"]);
                $(founderAge).val(value["founderAge"]);
                $(founderAddress).val(value["founderAddress"]);
                $(founderEducation).val(value["founderEducation"]);
                $(founderExperience).val(value["founderExperience"]);
                $(founderExperienceDetails).val(value["founderExperienceDetails"]);
                if ((idx + 1) < data["founderDetails"].length) {
                    $('form.goaRecognitionForm input[name=founderName]').closest(".repeat-container").find('.repeat-add').trigger("click");
                }
            });
        }
        if (data["entityType"] !== "REGISTERED_PARTNERSHIP") {
            $entity_name.attr("readonly", "readonly").parents(".form-group").removeClass("has-error").find(".help-block").html("");
            $incorp_date.attr("readonly", "readonly").parents(".form-group").removeClass("has-error").find(".help-block").html("");
        }

        $("textarea[name=ideaBrief].richTextArea").summernote("code", data["ideaBrief"]);
        if (data["lastAccordionSaved"]) {
            var openAccordion = $incorp_number;
            $('.accordionitem .number').each(function (index, val) {
                if ($(this).html().trim() === data["lastAccordionSaved"]) {
                    openAccordion = $(this);
                }
            });
            $(openAccordion).parents(".accordionitem").find(".accordion-section-title").addClass("active");
            $(openAccordion).parents(".accordionitem").find(".accordion-section-content").show();
            if (data["lastAccordionSaved"] !== "1") {
                $(".accordionitem:first").find(".accordion-section-title").removeClass("active");
                $(".accordionitem:first").find(".accordion-section-content").hide();
            }
        }

        if (data["status"] == "ACCEPTED" || data["status"] == "REJECTED") {
            viewMode();
        }
        populateUploadedFiles(data);
        $('#modal-loader').modal('hide');
    }

    function viewMode() {
        $(".goa-recognition-container").find(".accordion-section-content").show().end()
            .find(".repeat-add").hide().end()
            .find(".repeat-remove").hide().end()
            .find("input").attr("disabled", "disabled").end()
            .find(".form-control").attr("disabled", "disabled");
        $("textarea[name=ideaBrief].richTextArea").summernote('disable');
    }
};
$.upRecognition = function () {
    var cin = "";
    var referenceNo = "";
    var lastAccordionSaved = "";
    var formData = new FormData();
    var isValidated = true;
    var tableContent;
    var authToken = store.getItem("token");

    var $entity_type = $("select[name='entityType']");
    var $industry_id = $("select[name='industry_id']");
    var $section = $("select[name='section']");
    var $categories_id = $("select[name='categories_id']");
    var $state_id = $('#state_name');
    var $incorp_number = $("input[name='incorpNumber']");
    var $incorp_date = $("input[name='incorpDate']");
    var $entity_name = $("input[name='entityName']");
    var $tax_ipr = $("select[name='tax_benifit']");
    var $submitRecognitionForm = $("input[name='submitRecognitionForm']");

    //Funding Source
    var $isFunded = $("input[name=funded]");
    var $isFundedVal = $("input[name=funded]:checked").val();
    var $fundingSource = $("input[name=fundingSource]");

    //IPR
    var $appliedForIpr = $("input[name=appliedForIpr]");
    var $appliedForIprVal = $("input[name=appliedForIpr]:checked").val();
    var $iprForm = $(".regiFormSection");

    //Another State
    var $anotherStateRegistered = $("input[name=registeredInOtherState]");
    var $anotherStateRegisteredVal = $("input[name=registeredInOtherState]:checked").val();
    var $anotherStateName = $("select[name=otherState]");
    var $anotherStateRegistrationNo = $("input[name=startupRegNo]");
    var $anotherStateRegistrationDate = $("input[name=startupRegDate]");

    //DIPP
    var $registeredWithDipp = $("input[name=dippCertified]");
    var $registeredWithDippVal = $("input[name=dippCertified]:checked").val();
    var $dippNumber = $("input[name=dippNumber]");

    var entityType = {
        "1": "PRIVATE_LIMITED_COMPANY",
        "2": "LIMITED_LIABILITY_PARTNERSHIP",
        "3": "REGISTERED_PARTNERSHIP",
    };
    initForm();

    function prePopulateForm() {
        $.ajax({
            type: "GET",
            async: false,
            url: SIH.getEndPoint("/api/auth/user/profile"),
            headers: {"X-Auth-Token": store.getItem("token")}
        }).done(function (data) {
            $("select[name=industry]").val(data.user.startup.focusArea.industry.id);
            if (data.user.startup.focusArea.sectors) {
                var params = {};
                params["sector"] = data.user.startup.focusArea.sectors.id;
                var $selection = $("#sector");
                setList(params, $selection.data("path"), $selection);
                $("select[name=sector]").val(data.user.startup.focusArea.sectors[0].id)
            }
            var selectedServices = [];
            $(data.user.startup.services).each(function (key, val) {
                $("select[name=services] option").each(function (key, value) {
                    if ($(this).text() === val) {
                        selectedServices.push($(value).val());
                    }
                });
            });
            $("select[name=services]").val(selectedServices).select2();
            $("input[name=panNumber]").val(data.user.startup.pan);
            $("input[name=incorpNumber]").val(data.user.startup.cin);
            if (data.user.startup.cin) {
                $("input[name=incorpNumber]").trigger("change");
            }
            $("input[name=website]").val(data.user.startup.website);
            $.each($('input[name=stage]'), function (index, value) {
                if (($(this).val() === "on" && data.user.startup.stage === true) || ($(this).val() === "off" && data.user.startup.stage === false) || ($(this).val() === data.user.startup.stage)) {
                    $(this).attr('checked', true);
                }
            });
            $.each($('input[name=dippCertified]'), function (index, value) {
                if (($(this).val() === "on" && data.user.startup.dippCertified === true) || ($(this).val() === "off" && data.user.startup.dippCertified === false) || ($(this).val() === data.user.startup.dippCertified)) {
                    $(this).attr('checked', true).trigger("change");
                }
            });
            $("input[name=dippNumber]").val(data.user.startup.dippNumber);
            $("textarea[name=ideaBrief].richTextArea").summernote("code", data.user.startup.ideaBrief);
            $('#modal-loader').modal('hide');
        });
    }

    function populateUploadedFiles(data) {
        ["businessModel", "pitchDeck", "letters"].forEach(function (fileName) {
            if (data[fileName]) {
                $("input[name='" + fileName + "']").val(data[fileName]);
                $("input[name='" + fileName + "FileName']").val(data[fileName + "FileName"]);
                var $presentationLink = $("input[type=file][name='upload_" + fileName + "']").siblings("a.presentationLink");
                $presentationLink.prop("href", SIH.getEndPoint("/api/file/stateRecognition/up/") + data[fileName] + "/get").text(data[fileName + "FileName"]).removeClass("display-n");
            }
        });
    }

    function initForm() {
        if (!$isFundedVal || $isFunded === "off") {
            $fundingSource.closest(".repeatcontainer").addClass("display-n");
            $fundingSource.closest(".repeatcontainer").find(".form-group").addClass("display-n");
        }
        if (!$appliedForIprVal || $appliedForIprVal === "off") {
            $iprForm.addClass("display-n");
        }
        if (!$anotherStateRegisteredVal || $anotherStateRegisteredVal === "off") {
            $anotherStateName.closest(".form-group").addClass("display-n");
            $anotherStateRegistrationNo.closest(".form-group").addClass("display-n");
            $anotherStateRegistrationDate.closest(".form-group").addClass("display-n");
        }
        if (!$registeredWithDippVal || $registeredWithDippVal === "off") {
            $dippNumber.closest(".form-group").addClass("display-n");
        }
    }

    $entity_type.on("change", function () {
        $('input[name=incorpDate], input[name=entityName], input[name=incorpNumber]').val('');
        if ($(this).val() === "PRIVATE_LIMITED_COMPANY" || $(this).val() === "LIMITED_LIABILITY_PARTNERSHIP") {
            $('input[name=incorpDate]').attr('readonly', 'readonly');
            $('input[name=entityName]').attr({
                'readonly': 'true'
            });
        } else {
            $('input[name=incorpDate]').removeAttr('readonly');
            $('input[name=entityName]').removeAttr('readonly');
        }
    });

    $isFunded.change(function () {
        var val = $("input[name=funded]:checked").val();
        if (val === "on") {
            $fundingSource.closest(".repeatcontainer").removeClass("display-n");
            $fundingSource.closest(".repeatcontainer").find(".form-group").removeClass("display-n");
        } else {
            $fundingSource.closest(".repeatcontainer").addClass("display-n");
            $fundingSource.closest(".repeatcontainer").find(".form-group").addClass("display-n");
        }
    });
    $appliedForIpr.change(function () {
        var val = $("input[name=appliedForIpr]:checked").val();
        if (val === "on") {
            $iprForm.removeClass("display-n");
        } else {
            $iprForm.addClass("display-n");
        }
    });
    $anotherStateRegistered.change(function () {
        var val = $("input[name=registeredInOtherState]:checked").val();
        if (val === "on") {
            $anotherStateName.closest(".form-group").removeClass("display-n");
            $anotherStateRegistrationNo.closest(".form-group").removeClass("display-n");
            $anotherStateRegistrationDate.closest(".form-group").removeClass("display-n");
        } else {
            $anotherStateName.closest(".form-group").addClass("display-n");
            $anotherStateRegistrationNo.closest(".form-group").addClass("display-n");
            $anotherStateRegistrationDate.closest(".form-group").addClass("display-n");
        }
    });

    $registeredWithDipp.change(function () {
        var val = $("input[name=dippCertified]:checked").val();
        if (val === "on") {
            $dippNumber.closest(".form-group").removeClass("display-n");
        } else {
            $dippNumber.closest(".form-group").addClass("display-n");
        }
    });

    $(".accordionitem:first").find(".accordion-section-title").addClass("active");
    $(".accordionitem:first").find(".accordion-section-content").addClass("open").show();

    $incorp_number.on("change", function () {
        if ($entity_type.val() !== "REGISTERED_PARTNERSHIP") {
            var $this = this;
            $('#modal-loader').modal('show');
            $.ajax({
                type: "POST",
                dataType: "json",
                data: {"incorp_no": $(this).val()},
                url: $("#incorporationNoMCA").val(),
                success: function (data) {
                    $('#modal-loader').modal('hide');
                    if (data.isValidIncorporationNo === "true") {
                        $entity_name.val(data.nameEntity).attr("readonly", "readonly").parents(".form-group").removeClass("has-error").find(".help-block").html("");
                        var dateSplit = data.incorpdate.split("-");
                        if (dateSplit.length === 3) {
                            $incorp_date.val(dateSplit[1] + "/" + dateSplit[0] + "/" + dateSplit[2]).attr("readonly", "readonly").parents(".form-group").removeClass("has-error").find(".help-block").html("");
                        }
                        $($this).parents(".form-group").removeClass("has-error").find(".help-block").html("");
                    } else {
                        //  $entity_name.val("").removeAttr("readonly");
                        //  $incorp_date.val("").removeAttr("readonly");
                        $($this).parents(".form-group").addClass("has-error").find(".help-block").html("Please enter valid CIN number.")
                    }
                },
                error: function () {
                    $('#modal-loader').modal('hide');
                    $($this).parents(".form-group").addClass("has-error").find(".help-block").html("We are facing problems fetching your CIN details. Please try after some time.")
                }
            });
        }
    });

    $(".fileuploadMultipurpose").change(function () {
        var _this = $(this);
        var formats = ["image/jpeg", "image/png", "application/pdf"];
        checkFileUpload(this, _this.data("propname"), _this.data("propdisplay"), 10000000);
    });

    $("input[name='ipr_type']").on("change", function () {
        if ($(this).val() === "1") {
            $(".regiFormSection").removeClass("display-n");
        } else {
            $(".regiFormSection").addClass("display-n");
        }
    });

    $("input[name='patent_type']").on("change, click", function () {
        $("input[name='patent_type']").parents("td").removeClass("has-error");
        if ($("input[name='patent_type']:checked").length > 0) {
            $("input[name='patent_application_no']").parent().removeClass("display-n");
        }
    });

    $("input[name='trademark_type']").on("change, click", function () {
        $("input[name='trademark_type']").parents("td").removeClass("has-error");
        if ($("input[name='trademark_type']:checked").length > 0) {
            $("input[name='trademark_application_no']").parent().removeClass("display-n");
        }
    });

    $("input[name='copyright_type']").on("click", function () {
        $("input[name='copyright_type']").parents("td").removeClass("has-error");
    });

    $("input[name='design_type']").on("change, click", function () {
        $("input[name='design_type']").parents("td").removeClass("has-error");
        if ($("input[name='design_type']:checked").length > 0) {
            $("input[name='design_application_no']").parent().removeClass("display-n");
        }
    });

    $("input[name='plant_variety_type']").on("click", function () {
        $("input[name='plant_variety_type']").parents("td").removeClass("has-error");
    });

    $("input[name='innovative_product_service_type']").on("change", function () {
        if ($(this).val() === "1") {
            $(".innovative_product_service_table").removeClass("display-n");
        } else {
            $(".innovative_product_service_table").addClass("display-n");
        }
    });

    $("input[name='business_model_type']").on("change", function () {
        if ($(this).val() === "1") {
            $(".business_model_detail").removeClass("display-n");
        } else {
            $(".business_model_detail").addClass("display-n");
        }
    });

    $($entity_type).on("change", function () {
        $('input[name=incorp_date], input[name=entity_name], input[name=incorp_number]').val('');
        if ($(this).val() === "PRIVATE_LIMITED_COMPANY" || $(this).val() == "LIMITED_LIABILITY_PARTNERSHIP") {
            $('input[name=incorp_date]').attr('disabled', 'disabled');
            $('input[name=entity_name]').attr({
                'disabled': 'disabled',
                'readonly': 'true'
            });
            $('.recognition-tax-benifit #tax_benifit').removeAttr('disabled');
            $('.recognition-tax-benifit #tax_benifit>option:eq(0)').prop('selected', true);
        } else {
            $('input[name=incorp_date]').removeAttr('disabled');
            $('input[name=entity_name]').removeAttr('readonly disabled');
            $('.recognition-tax-benifit #tax_benifit>option:eq(1)').prop('selected', true);
            $('.recognition-tax-benifit #tax_benifit').attr('disabled', 'disabled');

            $(".availTaxBenefit").addClass("display-n").find("textarea").val("");
            $(".availTaxBenefit").find(".fundedFileName a").html("");
            $tax_ipr.val("0");
            $tax_ipr.find("option[value='1']").addClass("display-n");
            $(".notEligibleForTax-errorMessage").removeClass("display-n");
        }
    });

    var saveObject = {
        "SaveEntity": {"name": "SaveEntity", "section": 1, "errorMessage": "saveEntityErrorMessage"},
        "saveAuthorizedRepresentatives": {
            "name": "saveAuthorizedRepresentatives",
            "section": 2,
            "errorMessage": "saveAuthorizedRepErrorMessage"
        },
        "saveFundingDetails": {
            "name": "saveFundingDetails",
            "section": 3,
            "errorMessage": "saveFundingDetailsMessage"
        },
        "saveRequiredInfo": {"name": "saveRequiredInfo", "section": 4, "errorMessage": "saveRequiredInfoErrorMessage"},
        "saveFounderDetails": {
            "name": "saveFounderDetails",
            "section": 5,
            "errorMessage": "saveFounderDetailsErrorMessage"
        },
        "saveSelfCertification": {
            "name": "saveSelfCertification",
            "section": 6,
            "errorMessage": "saveSelfCertificationErrorMessage"
        }
    };

    $("input[value='Save'],input[name='submitRecognitionForm']").click(function (e) {
        var s = saveObject[this.name];
        var $this = this;
        var $target = $(e.currentTarget);
        var isSubmit = $target.val() === "Submit";
        var url = SIH.getEndPoint("/api/auth/recognition/draft/up/startup");
        if (isSubmit) {
            url = SIH.getEndPoint("/api/auth/recognition/save/up/startup");
            $target = $(".certify");
        }
        validate($target);
        if (isValidated) {
            var $formData = $target.closest("form.upRecognitionForm").serialize();
            var data = convertSerializeDataToJSON($formData);
            handleCustomizedData(data);
            s && (data["lastAccordionSaved"] = s.section);
            $('#modal-loader').modal('show');
            $.ajax({
                url: url,
                data: JSON.stringify(data),
                type: 'POST',
                beforeSend: setAuthTokenHeader,
                contentType: "application/json",
                success: function (response) {
                    $('#modal-loader').modal('hide');
                    if (response) {
                        $("input[name=id]").val(response);
                        $($this).parents(".accordion-section-content").hide();
                        var $accItem = $($this).parents(".accordionitem");
                        $accItem.find(".accordion-section-title").removeClass("active");
                        $accItem.next().find(".accordion-section-title").addClass("active");
                        $accItem.next().find(".accordion-section-content").show();
                    }
                    if (isSubmit) {
                        window.location.href = $("#thankyouPage").val();
                    }
                }, error: function (response) {
                    $('#modal-loader').modal('hide');
                    var errorMsg = "Error in saving the form";
                    if (response != null) {
                        errorMsg = response.constructor === Array && response.get(0) != null ? response[0].defaultMessage : (response.responseText != null && response.responseText != "" ? errorMsg + " : " + response.responseText : errorMsg);
                    }
                    $('.up-recognition-error-modal p').html(errorMsg);
                    $('.up-recognition-error-modal').modal('show');
                }
            });

        } else {
            $(".accordionitem").find(".accordion-section-title").removeClass("active").end()
                .find(".accordion-section-content").hide();
            var _firstErrorElem = $(".form-group.has-error:first");
            $('html, body').animate({
                scrollTop: _firstErrorElem.offset().top - 15
            }, 500);
            _firstErrorElem.closest(".accordionitem").find(".accordion-section-title").addClass("active");
            $(".form-group.has-error").each(function () {
                $(this).closest(".accordionitem").find(".accordion-section-content").show();
            });
        }
    });

    function checkFileUpload(fileToValidate, fileOriginal, fileDisplayName, fileSize) {

        var message = "";
        if ($(fileToValidate).val() !== "") {
            if (fileToValidate.files[0].size > fileSize) {
                isValidated = false;
                message = "File Should not be greater than " + Math.floor(fileSize / 1000000) + " MB.";
            }
            if ((fileToValidate.files[0].type).indexOf("image") > -1) {
                isValidated = false;
                message = message + "Image-type file format not accepted.";
            }
            if (message !== "") {
                isValidated = false;
                $(fileToValidate).siblings(".help-block").html(message).parents(".form-group").addClass("has-error");
                $(fileToValidate).val("");
                $(fileToValidate).siblings(".fileName").val("");
                $(fileToValidate).siblings(".fileDisplayName").val("");
                $(fileToValidate).siblings("a.presentationLink").addClass("display-n");
            } else {
                $(fileToValidate).siblings(".help-block").html("").parents(".form-group").removeClass("has-error");
                $(fileToValidate).siblings("input[type='hidden'][name='" + fileDisplayName + "']").val(fileToValidate.files[0].name);
                var data = new FormData();
                data.append("file", fileToValidate.files[0]);
                $(".modal.loader").modal("show");
                $.ajax({
                    type: "POST",
                    data: data,
                    dataType: 'json',
                    contentType: false,
                    processData: false,
                    url: SIH.getEndPoint("/api/file/stateRecognition/doc/up"),
                    headers: {"X-Auth-Token": store.getItem("token")}
                }).done(function (data) {
                    $(".modal.loader").modal("hide");
                    $(fileToValidate).siblings("input[type='hidden'][name='" + fileOriginal + "']").val(data.name);
                    if (data.name) {
                        var $presentationLink = $(fileToValidate).siblings("a.presentationLink");
                        $presentationLink.prop("href", SIH.getEndPoint("/api/file/stateRecognition/up/") + data.name + "/get").text(data.originalFilename).removeClass("display-n");
                    }
                }).error(function () {
                    $(".modal.loader").modal("hide");
                    alert("Error in uploading file. Please try again.");
                    $(fileToValidate).val("");
                    $(fileToValidate).siblings(".fileName").val("");
                    $(fileToValidate).siblings(".fileDisplayName").val("");
                    $(fileToValidate).siblings("a.presentationLink").addClass("display-n");
                    return false;
                });
            }
        }
        return false;
    }

    function handleCustomizedData(data) {
        var services = data["services"];
        if ($("input[name=funded]:checked").val() === "on") {
            var fundingSource = data["fundingSource"];
            var founderName = data["founderName"];
            if (fundingSource && !Array.isArray(fundingSource)) {
                fundingSource = new Array(fundingSource);
            }
            if (founderName && !Array.isArray(founderName)) {
                founderName = new Array(founderName);
            }
            if (fundingSource && fundingSource.length) {
                var fundingDetails = [];
                $(fundingSource).each(function (index, item) {
                    var fund = {
                        fundingSource: Array.isArray(data["fundingSource"]) ? data["fundingSource"][index] : data["fundingSource"],
                        fundingAmount: Array.isArray(data["fundingAmount"]) ? data["fundingAmount"][index] : data["fundingAmount"],
                        fundingDate: Array.isArray(data["fundingDate"]) ? data["fundingDate"][index] : data["fundingDate"]
                    };
                    fundingDetails.push(fund);

                });
                data["fundingDetails"] = fundingDetails;
                delete data["fundingSource"];
                delete data["fundingAmount"];
                delete data["fundingDate"];
            }
        } else {
            delete  data["fundingDetails"];
        }
        var founderName = $('input[name=founderName]');
        var founderAddress = $('input[name=founderAddress]');
        var founderAge = $('input[name=founderAge]');
        var founderEducation = $('input[name=founderEducation]');
        var founderExperience = $('input[name=founderExperience]');
        var founderExperienceDetails = $('input[name=founderExperienceDetails]');

        var founderDetails = [];
        for (var i = 0; i < founderName.length; i++) {
            var founder = {
                founderName: $(founderName[i]).val(),
                founderAddress: $(founderAddress[i]).val(),
                founderAge: $(founderAge[i]).val(),
                founderEducation: $(founderEducation[i]).val(),
                founderExperience: $(founderExperience[i]).val(),
                founderExperienceDetails: $(founderExperienceDetails[i]).val()
            };
            founderDetails.push(founder);
        }
        data["founderDetails"] = founderDetails;
        delete data["founderName"];
        delete data["founderAddress"];
        delete data["founderAge"];
        delete data["founderEducation"];
        delete data["founderExperience"];
        delete data["founderExperienceDetails"];

        /* if(founderName && founderName.length){
 
             $(founderName).each(function(index,item){
                 var founder = {
                     founderName: Array.isArray(data["founderName"]) ? data["founderName"][index] : data["founderName"],
                     founderAddress:Array.isArray(data["founderAddress"]) ? data["founderAddress"][index] : data["founderAddress"],
                     founderAge:Array.isArray(data["founderAge"]) ? data["founderAge"][index] : data["founderAge"],
                     founderEducation:Array.isArray(data["founderEducation"]) ? data["founderEducation"][index] : data["founderEducation"],
                     founderExperience:Array.isArray(data["founderExperience"]) ? data["founderExperience"][index] : data["founderExperience"],
                     founderExperienceDetails:Array.isArray(data["founderExperienceDetails"]) ? data["founderExperienceDetails"][index] : data["founderExperienceDetails"]
                 };
                 founderDetails.push(founder);
 
             });
             data["founderDetails"] = founderDetails;
             delete data["founderName"];
             delete data["founderAddress"];
             delete data["founderAge"];
             delete data["founderEducation"];
             delete data["founderExperience"];
             delete data["founderExperienceDetails"];
         }*/
        if (services && !Array.isArray(services)) {
            data["services"] = new Array(services);
        }
        if ($("input[name=dippCertified]:checked").val() === "off") {
            delete data["dippNumber"];
        }
        if ($("input[name=registeredInOtherState]:checked").val() === "off") {
            delete data["otherState"];
            delete data["startupRegNo"];
            delete data["startupRegDate"];
        }
        if ($("input[name=appliedForIpr]:checked").val() === "off") {
            delete data["patent"];
            delete data["trademark"];
            delete data["copyright"];
            delete data["design"];
            delete data["plantVariety"];
            delete data["patentApplicationNo"];
            delete data["trademarkApplicationNo"];
            delete data["copyrightApplicationNo"];
            delete data["designApplicationNo"];
            delete data["plantVarietyApplicationNo"];
        }
    }

    if (authToken) {
        getRecognitionData();
    }

    function getRecognitionData() {
        $('#modal-loader').modal('show');
        $.ajax({
            type: "GET",
            async: false,
            url: SIH.getEndPoint("/api/auth/recognition/fetchDetails/up/startup"),
            headers: {"X-Auth-Token": authToken}
        }).done(function (data) {
            if (data) {
                setFormData(data);
            } else {
                prePopulateForm();
            }
        });
    }

    function checkRequiredField(attrValue, inputSel) {
        var requiredField = $(inputSel).closest(".form-group").find("sup.required");
        if (requiredField && requiredField.length > 0 && (!attrValue || attrValue === "")) {
            isValidated = false;
            $(inputSel).closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field can't be left Blank.");
        } else {
            $(inputSel).closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
        }
    }


    function infoRequiredData(accordianItem, fieldName) {
        var inputSelection = $(accordianItem).find("input[name='" + fieldName + "']:checked");
        var attrValue = $(inputSelection).val();
        if (attrValue) {
            formData.delete(fieldName);
            formData.append(fieldName, attrValue.toString());
        }
        checkRequiredField(attrValue, $(accordianItem).find("input[name='" + fieldName + "']"));
    }

    $('input[name=product_service_type]').change(function (e) {
        var val = $('input[name=product_service_type]:checked').val();
        if (val) {
            if (val === "1") {
                $(this).closest(".form-group").append("<p id='stageCheck' style='color:#a94442'>Startups at Ideation Stage are not eligible for Tax Benefits</p>");
            } else {
                $('#stageCheck').remove();
            }
        }

    });

    function showRecognitionError(obj, msg) {
        msg = msg ? msg : "There might be some error in your form, please recheck and save again.";
        $(obj).parents(".button").next().find(".has-error").html(msg).removeClass('display-n');
    }

    function validate($target) {
        var validateIpr = false;
        if ($("input[name=incorpNumber]").closest(".form-group").hasClass("has-error")) {
            isValidated = false;
            return false;
        }
        isValidated = true;
        var currentTarget = $target.closest('div.accordionitem');
        var validateSections = [];
        validateSections.push($(currentTarget));
        $(currentTarget).attr("validate", "1");
        $(currentTarget).prevAll().each(function () {
            $(this).attr("validate", "1");
            validateSections.push($(this));
        });

        var requiredFields = $('div.accordion-section sup.required');
        $.each(requiredFields, function (index, item) {
            if (($(item).closest("div.accordionitem")).attr("validate") === "1") {
                var element = $(item).closest('.form-group').find(".form-control:not(.richTextarea,.customised-dropdown)");
                if (element.attr("name") === "appliedForIpr") {
                    validateIpr = true;
                }
                if (element && element.length > 0 && !element.closest(".modal").length && !element.closest(".form-group").hasClass("display-n")) {
                    if (element.attr("type") === "radio" || element.attr("type") === "checkbox") {
                        if (element.is(':checked')) {
                            element.closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
                        }
                        else {
                            if (element.attr("type") === "checkbox") {
                                element.closest(".form-group").addClass("has-error");
                            } else {
                                element.closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field cannot be left Blank.");
                            }
                            isValidated = false;
                        }
                    }
                    else if (!element.val() || element.val() === "") {
                        isValidated = false;
                        showErrorState(element, true);
                    } else if (element.attr("minlength") && element.val().length < parseInt(element.attr("minlength"))) {
                        element.closest(".form-group").addClass("has-error").find("span.help-block").first().html("Mimimum length of this field must be " + element.attr("minlength"));
                        isValidated = false;
                    } else {
                        showErrorState(element, false);
                    }
                }

            }
        });
        var richTextAreas = $('.form-control.richTextarea');
        $.each(richTextAreas, function (index, item) {
            if (($(item).closest("div.accordionitem")).attr("validate") === "1") {
                var el = $(item);
                if (el.closest('.form-group').find('sup.required').length > 0) {
                    var note = el.val().trim();
                    if (note.length > 0 && !el.summernote('isEmpty')) {
                        el.siblings('.note-editor.note-frame').removeClass('note-has-error').addClass('note-writer-text');
                        showErrorState(el, false);
                    } else {
                        isValidated = false;
                        el.siblings('.note-editor.note-frame').addClass('note-has-error').removeClass('note-writer-text');
                        showErrorState(el, true);
                    }
                }
            }
        });

        var customizedDropDown = $('.form-control.customised-dropdown');
        $.each(customizedDropDown, function (index, item) {
            if (($(item).closest("div.accordionitem")).attr("validate") === "1") {
                var el = $(item);
                var selectedIndustries = $("select[name=industry]").val();
                if (!selectedIndustries || selectedIndustries.length === 0) {
                    isValidated = false;
                    showErrorState(el, true);
                } else {
                    $.each(selectedIndustries, function (idx, selectedIndustry) {
                        var selectedIndustryArr = selectedIndustry.split("/");
                        var industryName = selectedIndustryArr[selectedIndustryArr.length - 1];
                        if (el.find("ul#sector").first().find("input[name=" + industryName + "][type=checkbox]:checked").length === 0) {
                            isValidated = false;
                            showErrorState(el, true);
                        } else {
                            showErrorState(el, false);
                        }
                    });
                }
            }
        });

        var regexValidatedfields = $('.form-control.regex-val');
        $.each(regexValidatedfields, function (index, item) {
            if (($(item).closest("div.accordionitem")).attr("validate") === "1") {
                var element = $(item);
                var re = new RegExp(element.attr("regex"));
                if (element.val() && !re.test(element.val())) {
                    isValidated = false;
                    //showErrorState(element, true);
                    element.closest(".form-group").addClass("has-error");
                    element.siblings(".regex-msg").show();
                }
                else {
                    if (!(element.closest(".form-group").has("sup.required") && !element.val())) {
                        showErrorState(element, false);
                    }
                    element.siblings(".regex-msg").hide();
                }
            }
        });
        var iprValue = $("input[name=appliedForIpr]:checked").val();
        if (iprValue === "on" && validateIpr) {
            validateIPR();
        }
    }

    function validateIPR() {
        var validated = false;
        var patent = $("input[name=patent]:checked");
        var trademark = $("input[name=trademark]:checked");
        var copyright = $("input[name=copyright]:checked");
        var design = $("input[name=design]:checked");
        var plantVariety = $("input[name=plantVariety]:checked");

        var patentNo = $("input[name=patentApplicationNo]");
        var trademarkNo = $("input[name=trademarkApplicationNo]");
        var copyrightNo = $("input[name=copyrightApplicationNo]");
        var designNo = $("input[name=designApplicationNo]");
        var plantNo = $("input[name=plantVarietyApplicationNo]");

        if (patent && patent.length) {
            if (patentNo.val()) {
                patentNo.parents("td").removeClass("has-error");
            } else {
                patentNo.parents("td").addClass("has-error");
                validated = validated || true;
            }
        }
        if (patentNo.val()) {
            if (patent && !patent.length) {
                $("input[name=patent]").parents("td").addClass("has-error");
                validated = validated || true;
            } else {
                $("input[name=patent]").parents("td").removeClass("has-error");
            }
        }

        if (trademark && trademark.length) {
            if (trademarkNo.val()) {
                trademarkNo.parents("td").removeClass("has-error");
            } else {
                trademarkNo.parents("td").addClass("has-error");
                validated = validated || true;
            }
        }
        if (trademarkNo.val()) {
            if (trademark && !trademark.length) {
                $("input[name=trademark]").parents("td").addClass("has-error");
                validated = validated || true;
            } else {
                $("input[name=trademark]").parents("td").removeClass("has-error");
            }
        }

        if (copyright && copyright.length) {
            if (copyrightNo.val()) {
                copyrightNo.parents("td").removeClass("has-error");
            } else {
                copyrightNo.parents("td").addClass("has-error");
                validated = validated || true;
            }
        }
        if (copyrightNo.val()) {
            if (copyright && !copyright.length) {
                $("input[name=copyright]").parents("td").addClass("has-error");
                validated = validated || true;
            } else {
                $("input[name=copyright]").parents("td").removeClass("has-error");
            }
        }
        if (design && design.length) {
            if (designNo.val()) {
                designNo.parents("td").removeClass("has-error");
            } else {
                designNo.parents("td").addClass("has-error");
                validated = validated || true;
            }
        }
        if (designNo.val()) {
            if (design && !design.length) {
                $("input[name=design]").parents("td").addClass("has-error");
                validated = validated || true;
            } else {
                $("input[name=design]").parents("td").removeClass("has-error");
            }
        }
        if (plantVariety && plantVariety.length) {

            if (plantNo.val()) {
                plantNo.parents("td").removeClass("has-error");
            } else {
                plantNo.parents("td").addClass("has-error");
                validated = validated || true;
            }
        }
        if (plantNo.val()) {
            if (plantVariety && !plantVariety.length) {
                $("input[name=plantVariety]").parents("td").addClass("has-error");
                validated = validated || true;
            } else {
                $("input[name=plantVariety]").parents("td").removeClass("has-error");
            }
        }

        if (validated) {
            isValidated = false;
        }
    }

    function setFormData(data) {
        $.each(data, function (index, val) {
            var field = $('form.upRecognitionForm input[name=' + index + '], form.upRecognitionForm select[name=' + index + '], form.upRecognitionForm textarea[name=' + index + ']');
            var isList = Boolean(field.closest(".repeat-container").length);
            var type = field.attr("type");
            if (type === 'radio') {
                $.each($('input[name=' + index + ']'), function (index, value) {
                    if (($(this).val() === "on" && val === true) || ($(this).val() === "off" && val === false) || ($(this).val() === val)) {
                        $(this).attr('checked', true);
                        field.trigger("change");
                        return true;
                    }
                });
            } else if (type === 'checkbox') {
                $.each($('input[name=' + index + ']'), function (index, value) {
                    var inputVal = $(this).val();
                    $.each(val, function (index, value1) {
                        if (value1 === inputVal) {
                            $(value).attr('checked', true);
                        }
                    })
                });
            }
            else if (isList && Array.isArray(val)) {
                val.forEach(function (value, idx) {
                    field = $('form.upRecognitionForm input[name=' + index + '], form.upRecognitionForm select[name=' + index + '], form.upRecognitionForm textarea[name=' + index + ']');
                    var currentField = $(field).eq(idx);
                    currentField.val(value);
                    if (field.length < val.length) {
                        var parent = currentField.closest(".repeat-container");
                        var button = parent.find(".repeat-add");
                        if (button.length > 0) {
                            button.trigger("click");
                        }
                    }
                })
            } else {
                field.val(val);
                if (index !== "incorpNumber" && index !== 'entityType') {
                    field.trigger("change")
                }
            }
        });
        if (data["startupindustry"]) {
            var params = {};
            params["industry"] = data["startupindustry"];
            var $selection = $("#sector");
            setList(params, $selection.data("path"), $selection);
            $selection.val(data["sector"]);
        }
        if (data["fundingDetails"]) {
            data["fundingDetails"].forEach(function (value, idx) {
                var fundingSource = $('form.upRecognitionForm input[name=fundingSource]')[idx];
                var fundingAmount = $('form.upRecognitionForm input[name=fundingAmount]')[idx];
                var fundingDate = $('form.upRecognitionForm input[name=fundingDate]')[idx];
                $(fundingSource).val(value["fundingSource"]);
                $(fundingAmount).val(value["fundingAmount"]);
                $(fundingDate).val(value["fundingDate"]);
                if ((idx + 1) < data["fundingDetails"].length) {
                    $('form.upRecognitionForm input[name=fundingSource]').closest(".repeat-container").find('.repeat-add').trigger("click");
                }
            });
        }
        if (data["founderDetails"]) {
            data["founderDetails"].forEach(function (value, idx) {
                var founderName = $('form.upRecognitionForm input[name=founderName]')[idx];
                var founderAge = $('form.upRecognitionForm input[name=founderAge]')[idx];
                var founderAddress = $('form.upRecognitionForm input[name=founderAddress]')[idx];
                var founderEducation = $('form.upRecognitionForm input[name=founderEducation]')[idx];
                var founderExperience = $('form.upRecognitionForm input[name=founderExperience]')[idx];
                var founderExperienceDetails = $('form.upRecognitionForm input[name=founderExperienceDetails]')[idx];
                $(founderName).val(value["founderName"]);
                $(founderAge).val(value["founderAge"]);
                $(founderAddress).val(value["founderAddress"]);
                $(founderEducation).val(value["founderEducation"]);
                $(founderExperience).val(value["founderExperience"]);
                $(founderExperienceDetails).val(value["founderExperienceDetails"]);
                if ((idx + 1) < data["founderDetails"].length) {
                    $('form.upRecognitionForm input[name=founderName]').closest(".repeat-container").find('.repeat-add').trigger("click");
                }
            });
        }
        if (data["entityType"] !== "REGISTERED_PARTNERSHIP") {
            $entity_name.attr("readonly", "readonly").parents(".form-group").removeClass("has-error").find(".help-block").html("");
            $incorp_date.attr("readonly", "readonly").parents(".form-group").removeClass("has-error").find(".help-block").html("");
        }

        $("textarea[name=ideaBrief].richTextArea").summernote("code", data["ideaBrief"]);
        if (data["lastAccordionSaved"]) {
            var openAccordion = $incorp_number;
            $('.accordionitem .number').each(function (index, val) {
                if ($(this).html().trim() === data["lastAccordionSaved"]) {
                    openAccordion = $(this);
                }
            });
            $(openAccordion).parents(".accordionitem").find(".accordion-section-title").addClass("active");
            $(openAccordion).parents(".accordionitem").find(".accordion-section-content").show();
            if (data["lastAccordionSaved"] !== "1") {
                $(".accordionitem:first").find(".accordion-section-title").removeClass("active");
                $(".accordionitem:first").find(".accordion-section-content").hide();
            }
        }

        if (data["status"] == "ACCEPTED" || data["status"] == "REJECTED") {
            viewMode();
        }
        populateUploadedFiles(data);
        $('#modal-loader').modal('hide');
    }

    function viewMode() {
        $(".up-recognition-container").find(".accordion-section-content").show().end()
            .find(".repeat-add").hide().end()
            .find(".repeat-remove").hide().end()
            .find("input").attr("disabled", "disabled").end()
            .find(".form-control").attr("disabled", "disabled");
        $("textarea[name=ideaBrief].richTextArea").summernote('disable');
    }
};
$.stateRecognitionStartup = function () {
    var cin = "";
    var referenceNo = "";
    var lastAccordionSaved = "";
    var formData = new FormData();
    var isValidated = true;
    var tableContent;
    var authToken = store.getItem("token");

    var $entity_type = $("select[name='entityType']");
    var $industry_id = $("select[name='industry_id']");
    var $section = $("select[name='section']");
    var $categories_id = $("select[name='categories_id']");
    var $state_id = $('#state_name');
    var $incorp_number = $("input[name='incorpNumber']");
    var $incorp_date = $("input[name='incorpDate']");
    var $entity_name = $("input[name='entityName']");
    var $tax_ipr = $("select[name='tax_benifit']");
    var $submitRecognitionForm = $("input[name='submitRecognitionForm']");

    //Funding Source
    var $isFunded = $("input[name=funded]");
    var $isFundedVal = $("input[name=funded]:checked").val();
    var $fundingSource = $("input[name=fundingSource]");

    //IPR
    var $appliedForIpr = $("input[name=appliedForIpr]");
    var $appliedForIprVal = $("input[name=appliedForIpr]:checked").val();
    var $iprForm = $(".regiFormSection");

    //Another State
    var $anotherStateRegistered = $("input[name=registeredInOtherState]");
    var $anotherStateRegisteredVal = $("input[name=registeredInOtherState]:checked").val();
    var $anotherStateName = $("select[name=otherState]");
    var $anotherStateRegistrationNo = $("input[name=startupRegNo]");
    var $anotherStateRegistrationDate = $("input[name=startupRegDate]");

    //DIPP
    var $registeredWithDipp = $("input[name=dippCertified]");
    var $registeredWithDippVal = $("input[name=dippCertified]:checked").val();
    var $dippNumber = $("input[name=dippNumber]");

    initForm();

    function prePopulateForm() {
        $.ajax({
            type: "GET",
            async: false,
            url: SIH.getEndPoint("/api/auth/user/profile"),
            headers: {"X-Auth-Token": store.getItem("token")}
        }).done(function (data) {
            if ($("select[name=entityType]")) {
                $("select[name=entityType]").val(entityType[data.user.startup.startupEntity]).trigger("change");
            }

            if ($("select[name=startupindustry]")) {
                $("select[name=startupindustry]").val(data.user.startup.focusArea.industry.id);
            }
            if (data.user.startup.focusArea.industry.id) {
                var params = {};
                params["industry"] = data.user.startup.focusArea.industry.id;
                var $selection = $("#sector");
                setList(params, $selection.data("path"), $selection);
                $("select[name=sector]").val(data.user.startup.focusArea.sectors[0].id)
            }
            var selectedServices = [];
            $(data.user.startup.services).each(function (key, val) {
                $("select[name=services] option").each(function (key, value) {
                    if ($(this).text() === val) {
                        selectedServices.push($(value).val());
                    }
                });
            });
            $("select[name=services]").val(selectedServices).select2();
            $("input[name=panNumber]").val(data.user.startup.pan);
            $("input[name=incorpNumber]").val(data.user.startup.cin);
            if (data.user.startup.cin) {
                $("input[name=incorpNumber]").trigger("change");
            }
            $("input[name=website]").val(data.user.startup.website);
            $.each($('input[name=stage]'), function (index, value) {
                if (($(this).val() === "on" && data.user.startup.stage === true) || ($(this).val() === "off" && data.user.startup.stage === false) || ($(this).val() === data.user.startup.stage)) {
                    $(this).attr('checked', true);
                }
            });
            $.each($('input[name=dippCertified]'), function (index, value) {
                if (($(this).val() === "on" && data.user.startup.dippCertified === true) || ($(this).val() === "off" && data.user.startup.dippCertified === false) || ($(this).val() === data.user.startup.dippCertified)) {
                    $(this).attr('checked', true).trigger("change");
                }
            });
            $("input[name=dippNumber]").val(data.user.startup.dippNumber);
            $("textarea[name=ideaBrief].richTextArea").summernote("code", data.user.startup.ideaBrief);
            $('#modal-loader').modal('hide');

        });
    }

    function populateUploadedFiles(data) {
        ["businessModel", "pitchDeck", "letters"].forEach(function (fileName) {
            if (data[fileName]) {
                $("input[name='" + fileName + "']").val(data[fileName]);
                $("input[name='" + fileName + "FileName']").val(data[fileName + "FileName"]);
                var $presentationLink = $("input[type=file][name='upload_" + fileName + "']").siblings("a.presentationLink");
                $presentationLink.prop("href", SIH.getEndPoint("/api/file/stateRecognition/" + store.getItem("state") + "/") + data[fileName] + "/get").text(data[fileName + "FileName"]).removeClass("display-n");
            }
        });
    }

    function initForm() {
        if (!$isFundedVal || $isFunded === "off") {
            $fundingSource.closest(".repeatcontainer").addClass("display-n");
            $fundingSource.closest(".repeatcontainer").find(".form-group").addClass("display-n");
        }
        if (!$appliedForIprVal || $appliedForIprVal === "off") {
            $iprForm.addClass("display-n");
        }
        if (!$anotherStateRegisteredVal || $anotherStateRegisteredVal === "off") {
            $anotherStateName.closest(".form-group").addClass("display-n");
            $anotherStateRegistrationNo.closest(".form-group").addClass("display-n");
            $anotherStateRegistrationDate.closest(".form-group").addClass("display-n");
        }
        if (!$registeredWithDippVal || $registeredWithDippVal === "off") {
            $dippNumber.closest(".form-group").addClass("display-n");
        }
    }

    $entity_type.on("change", function () {
        $('input[name=incorpDate], input[name=entityName], input[name=incorpNumber]').val('');
        if ($(this).val() === "PRIVATE_LIMITED_COMPANY" || $(this).val() === "LIMITED_LIABILITY_PARTNERSHIP") {
            $('input[name=incorpDate]').attr('readonly', 'readonly');
            $('input[name=entityName]').attr({
                'readonly': 'true'
            });
        } else {
            $('input[name=incorpDate]').removeAttr('readonly');
            $('input[name=entityName]').removeAttr('readonly');
        }
    });

    $isFunded.change(function () {
        var val = $("input[name=funded]:checked").val();
        if (val === "on") {
            $fundingSource.closest(".repeatcontainer").removeClass("display-n");
            $fundingSource.closest(".repeatcontainer").find(".form-group").removeClass("display-n");
        } else {
            $fundingSource.closest(".repeatcontainer").addClass("display-n");
            $fundingSource.closest(".repeatcontainer").find(".form-group").addClass("display-n");
        }
    });
    $appliedForIpr.change(function () {
        var val = $("input[name=appliedForIpr]:checked").val();
        if (val === "on") {
            $iprForm.removeClass("display-n");
        } else {
            $iprForm.addClass("display-n");
        }
    });
    $anotherStateRegistered.change(function () {
        var val = $("input[name=registeredInOtherState]:checked").val();
        if (val === "on") {
            $anotherStateName.closest(".form-group").removeClass("display-n");
            $anotherStateRegistrationNo.closest(".form-group").removeClass("display-n");
            $anotherStateRegistrationDate.closest(".form-group").removeClass("display-n");
        } else {
            $anotherStateName.closest(".form-group").addClass("display-n");
            $anotherStateRegistrationNo.closest(".form-group").addClass("display-n");
            $anotherStateRegistrationDate.closest(".form-group").addClass("display-n");
        }
    });

    $registeredWithDipp.change(function () {
        var val = $("input[name=dippCertified]:checked").val();
        if (val === "on") {
            $dippNumber.closest(".form-group").removeClass("display-n");
        } else {
            $dippNumber.closest(".form-group").addClass("display-n");
        }
    });

    $(".accordionitem:first").find(".accordion-section-title").addClass("active");
    $(".accordionitem:first").find(".accordion-section-content").addClass("open").show();

    $incorp_number.on("change", function () {
        if ($entity_type.val() !== "REGISTERED_PARTNERSHIP") {
            var $this = this;
            $('#modal-loader').modal('show');
            $.ajax({
                type: "POST",
                dataType: "json",
                data: {"incorp_no": $(this).val()},
                url: $("#incorporationNoMCA").val(),
                success: function (data) {
                    $('#modal-loader').modal('hide');
                    if (data.isValidIncorporationNo === "true") {
                        $entity_name.val(data.nameEntity).attr("readonly", "readonly").parents(".form-group").removeClass("has-error").find(".help-block").html("");
                        var dateSplit = data.incorpdate.split("-");
                        if (dateSplit.length === 3) {
                            $incorp_date.val(dateSplit[1] + "/" + dateSplit[0] + "/" + dateSplit[2]).attr("readonly", "readonly").parents(".form-group").removeClass("has-error").find(".help-block").html("");
                        }
                        $($this).parents(".form-group").removeClass("has-error").find(".help-block").html("");
                    } else {
                        //  $entity_name.val("").removeAttr("readonly");
                        //  $incorp_date.val("").removeAttr("readonly");
                        $($this).parents(".form-group").addClass("has-error").find(".help-block").html("Please enter valid CIN number.")
                    }
                },
                error: function () {
                    $('#modal-loader').modal('hide');
                    $($this).parents(".form-group").addClass("has-error").find(".help-block").html("We are facing problems fetching your CIN details. Please try after some time.")
                }
            });
        }
    });


    $(".fileuploadMultipurpose").change(function () {
        var _this = $(this);
        checkFileUpload(this, _this.data("propname"), _this.data("propdisplay"), 10000000);
    });


    $("input[name='ipr_type']").on("change", function () {
        if ($(this).val() === "1") {
            $(".regiFormSection").removeClass("display-n");
        } else {
            $(".regiFormSection").addClass("display-n");
        }
    });

    $("input[name='patent_type']").on("change, click", function () {
        $("input[name='patent_type']").parents("td").removeClass("has-error");
        if ($("input[name='patent_type']:checked").length > 0) {
            $("input[name='patent_application_no']").parent().removeClass("display-n");
        }
    });

    $("input[name='trademark_type']").on("change, click", function () {
        $("input[name='trademark_type']").parents("td").removeClass("has-error");
        if ($("input[name='trademark_type']:checked").length > 0) {
            $("input[name='trademark_application_no']").parent().removeClass("display-n");
        }
    });

    $("input[name='copyright_type']").on("click", function () {
        $("input[name='copyright_type']").parents("td").removeClass("has-error");
    });

    $("input[name='design_type']").on("change, click", function () {
        $("input[name='design_type']").parents("td").removeClass("has-error");
        if ($("input[name='design_type']:checked").length > 0) {
            $("input[name='design_application_no']").parent().removeClass("display-n");
        }
    });

    $("input[name='plant_variety_type']").on("click", function () {
        $("input[name='plant_variety_type']").parents("td").removeClass("has-error");
    });

    $("input[name='innovative_product_service_type']").on("change", function () {
        if ($(this).val() === "1") {
            $(".innovative_product_service_table").removeClass("display-n");
        } else {
            $(".innovative_product_service_table").addClass("display-n");
        }
    });

    $("input[name='business_model_type']").on("change", function () {
        if ($(this).val() === "1") {
            $(".business_model_detail").removeClass("display-n");
        } else {
            $(".business_model_detail").addClass("display-n");
        }
    });

    $($entity_type).on("change", function () {
        $('input[name=incorp_date], input[name=entity_name], input[name=incorp_number]').val('');
        if ($(this).val() === "PRIVATE_LIMITED_COMPANY" || $(this).val() == "LIMITED_LIABILITY_PARTNERSHIP") {
            $('input[name=incorp_date]').attr('disabled', 'disabled');
            $('input[name=entity_name]').attr({
                'disabled': 'disabled',
                'readonly': 'true'
            });
            $('.recognition-tax-benifit #tax_benifit').removeAttr('disabled');
            $('.recognition-tax-benifit #tax_benifit>option:eq(0)').prop('selected', true);
        } else {
            $('input[name=incorp_date]').removeAttr('disabled');
            $('input[name=entity_name]').removeAttr('readonly disabled');
            $('.recognition-tax-benifit #tax_benifit>option:eq(1)').prop('selected', true);
            $('.recognition-tax-benifit #tax_benifit').attr('disabled', 'disabled');

            $(".availTaxBenefit").addClass("display-n").find("textarea").val("");
            $(".availTaxBenefit").find(".fundedFileName a").html("");
            $tax_ipr.val("0");
            $tax_ipr.find("option[value='1']").addClass("display-n");
            $(".notEligibleForTax-errorMessage").removeClass("display-n");
        }
    });

    var saveObject = {
        "SaveEntity": {"name": "SaveEntity", "section": 1, "errorMessage": "saveEntityErrorMessage"},
        "saveAuthorizedRepresentatives": {
            "name": "saveAuthorizedRepresentatives",
            "section": 2,
            "errorMessage": "saveAuthorizedRepErrorMessage"
        },
        "saveFundingDetails": {
            "name": "saveFundingDetails",
            "section": 3,
            "errorMessage": "saveFundingDetailsMessage"
        },
        "saveRequiredInfo": {"name": "saveRequiredInfo", "section": 4, "errorMessage": "saveRequiredInfoErrorMessage"},
        "saveFounderDetails": {
            "name": "saveFounderDetails",
            "section": 5,
            "errorMessage": "saveFounderDetailsErrorMessage"
        },
        "saveSelfCertification": {
            "name": "saveSelfCertification",
            "section": 6,
            "errorMessage": "saveSelfCertificationErrorMessage"
        }
    };

    $("input[value='Save'],input[name='submitRecognitionForm']").click(function (e) {
        var s = saveObject[this.name];
        var $this = this;
        var $target = $(e.currentTarget);
        var isSubmit = $target.val() === "Submit";
        var url = SIH.getEndPoint("/api/auth/recognition/draft/" + store.getItem("state"));
        if (isSubmit) {
            url = SIH.getEndPoint("/api/auth/recognition/save/" + store.getItem('state'));
            $target = $(".certify");
        }
        validate($target);
        if (isValidated) {
            var $formData = $target.closest("form.stateCommonRecognitionForm").serialize();
            var data = convertSerializeDataToJSON($formData);
            handleCustomizedData(data);
            s && (data["lastAccordionSaved"] = s.section);
            $('#modal-loader').modal('show');
            $.ajax({
                url: url,
                data: JSON.stringify(data),
                type: 'POST',
                beforeSend: setAuthTokenHeader,
                contentType: "application/json",
                success: function (response) {
                    $('#modal-loader').modal('hide');
                    if (response) {
                        $("input[name=id]").val(response);
                        $($this).parents(".accordion-section-content").hide();
                        var $accItem = $($this).parents(".accordionitem");
                        $accItem.find(".accordion-section-title").removeClass("active");
                        $accItem.next().find(".accordion-section-title").addClass("active");
                        $accItem.next().find(".accordion-section-content").show();
                    }
                    if (isSubmit) {
                        window.location.href = $("#thankyouPage").val();
                    }
                }, error: function (response) {
                    $('#modal-loader').modal('hide');
                    var errorMsg = "Error in saving the form";
                    if (response != null) {
                        errorMsg = response.constructor === Array && response.get(0) != null ? response[0].defaultMessage : (response.responseText != null && response.responseText != "" ? errorMsg + " : " + response.responseText : errorMsg);
                    }
                    $('.recognition-error-modal p').html(errorMsg);
                    $('.recognition-error-modal').modal('show');
                }
            });

        } else {
            $(".accordionitem").find(".accordion-section-title").removeClass("active").end()
                .find(".accordion-section-content").hide();
            var _firstErrorElem = $(".form-group.has-error:first");
            $('html, body').animate({
                scrollTop: _firstErrorElem.offset().top - 15
            }, 500);
            _firstErrorElem.closest(".accordionitem").find(".accordion-section-title").addClass("active");
            $(".form-group.has-error").each(function () {
                $(this).closest(".accordionitem").find(".accordion-section-content").show();
            });
        }
    });

    function checkFileUpload(fileToValidate, fileOriginal, fileDisplayName, fileSize) {

        var message = "";
        if ($(fileToValidate).val() !== "") {
            if (fileToValidate.files[0].size > fileSize) {
                isValidated = false;
                message = "File Should not be greater than " + Math.floor(fileSize / 1000000) + " MB.";
            }
            if ((fileToValidate.files[0].type).indexOf("image") > -1) {
                isValidated = false;
                message = message + "Image-type file format not accepted.";
            }
            if (message !== "") {
                isValidated = false;
                $(fileToValidate).siblings(".help-block").html(message).parents(".form-group").addClass("has-error");
                $(fileToValidate).val("");
                $(fileToValidate).siblings(".fileName").val("");
                $(fileToValidate).siblings(".fileDisplayName").val("");
                $(fileToValidate).siblings("a.presentationLink").addClass("display-n");
            } else {
                $(fileToValidate).siblings(".help-block").html("").parents(".form-group").removeClass("has-error");
                $(fileToValidate).siblings("input[type='hidden'][name='" + fileDisplayName + "']").val(fileToValidate.files[0].name);
                var data = new FormData();
                data.append("file", fileToValidate.files[0]);
                $(".modal.loader").modal("show");
                $.ajax({
                    type: "POST",
                    data: data,
                    dataType: 'json',
                    contentType: false,
                    processData: false,
                    url: SIH.getEndPoint("/api/file/stateRecognition/doc/" + store.getItem("state")),
                    headers: {"X-Auth-Token": store.getItem("token")}
                }).done(function (data) {
                    $(".modal.loader").modal("hide");
                    $(fileToValidate).siblings("input[type='hidden'][name='" + fileOriginal + "']").val(data.name);
                    if (data.name) {
                        var $presentationLink = $(fileToValidate).siblings("a.presentationLink");
                        $presentationLink.prop("href", SIH.getEndPoint("/api/file/stateRecognition/" + store.getItem("state") + "/") + data.name + "/get").text(data.originalFilename).removeClass("display-n");
                    }
                }).error(function () {
                    $(".modal.loader").modal("hide");
                    alert("Error in uploading file. Please try again.");
                    $(fileToValidate).val("");
                    $(fileToValidate).siblings(".fileName").val("");
                    $(fileToValidate).siblings(".fileDisplayName").val("");
                    $(fileToValidate).siblings("a.presentationLink").addClass("display-n");
                    return false;
                });
            }
        }
        return false;
    }

    function handleCustomizedData(data) {
        var services = data["services"];
        if ($("input[name=funded]:checked").val() === "on") {
            var fundingSource = data["fundingSource"];
            var founderName = data["founderName"];
            if (fundingSource && !Array.isArray(fundingSource)) {
                fundingSource = new Array(fundingSource);
            }
            if (founderName && !Array.isArray(founderName)) {
                founderName = new Array(founderName);
            }
            if (fundingSource && fundingSource.length) {
                var fundingDetails = [];
                $(fundingSource).each(function (index, item) {
                    var fund = {
                        fundingSource: Array.isArray(data["fundingSource"]) ? data["fundingSource"][index] : data["fundingSource"],
                        fundingAmount: Array.isArray(data["fundingAmount"]) ? data["fundingAmount"][index] : data["fundingAmount"],
                        fundingDate: Array.isArray(data["fundingDate"]) ? data["fundingDate"][index] : data["fundingDate"]
                    };
                    fundingDetails.push(fund);

                });
                data["fundingDetails"] = fundingDetails;
                delete data["fundingSource"];
                delete data["fundingAmount"];
                delete data["fundingDate"];
            }
        } else {
            delete  data["fundingDetails"];
        }
        var founderName = $('input[name=founderName]');
        var founderAddress = $('input[name=founderAddress]');
        var founderAge = $('input[name=founderAge]');
        var founderEducation = $('input[name=founderEducation]');
        var founderExperience = $('input[name=founderExperience]');
        var founderExperienceDetails = $('input[name=founderExperienceDetails]');

        var founderDetails = [];
        for (var i = 0; i < founderName.length; i++) {
            var founder = {
                founderName: $(founderName[i]).val(),
                founderAddress: $(founderAddress[i]).val(),
                founderAge: $(founderAge[i]).val(),
                founderEducation: $(founderEducation[i]).val(),
                founderExperience: $(founderExperience[i]).val(),
                founderExperienceDetails: $(founderExperienceDetails[i]).val()
            };
            founderDetails.push(founder);
        }
        data["founderDetails"] = founderDetails;
        delete data["founderName"];
        delete data["founderAddress"];
        delete data["founderAge"];
        delete data["founderEducation"];
        delete data["founderExperience"];
        delete data["founderExperienceDetails"];

        /* if(founderName && founderName.length){

         $(founderName).each(function(index,item){
         var founder = {
         founderName: Array.isArray(data["founderName"]) ? data["founderName"][index] : data["founderName"],
         founderAddress:Array.isArray(data["founderAddress"]) ? data["founderAddress"][index] : data["founderAddress"],
         founderAge:Array.isArray(data["founderAge"]) ? data["founderAge"][index] : data["founderAge"],
         founderEducation:Array.isArray(data["founderEducation"]) ? data["founderEducation"][index] : data["founderEducation"],
         founderExperience:Array.isArray(data["founderExperience"]) ? data["founderExperience"][index] : data["founderExperience"],
         founderExperienceDetails:Array.isArray(data["founderExperienceDetails"]) ? data["founderExperienceDetails"][index] : data["founderExperienceDetails"]
         };
         founderDetails.push(founder);

         });
         data["founderDetails"] = founderDetails;
         delete data["founderName"];
         delete data["founderAddress"];
         delete data["founderAge"];
         delete data["founderEducation"];
         delete data["founderExperience"];
         delete data["founderExperienceDetails"];
         }*/
        if (services && !Array.isArray(services)) {
            data["services"] = new Array(services);
        }
        if ($("input[name=dippCertified]:checked").val() === "off") {
            delete data["dippNumber"];
        }
        if ($("input[name=registeredInOtherState]:checked").val() === "off") {
            delete data["otherState"];
            delete data["startupRegNo"];
            delete data["startupRegDate"];
        }
        if ($("input[name=appliedForIpr]:checked").val() === "off") {
            delete data["patent"];
            delete data["trademark"];
            delete data["copyright"];
            delete data["design"];
            delete data["plantVariety"];
            delete data["patentApplicationNo"];
            delete data["trademarkApplicationNo"];
            delete data["copyrightApplicationNo"];
            delete data["designApplicationNo"];
            delete data["plantVarietyApplicationNo"];
        }
    }

    if (authToken) {
        getRecognitionData();
    }

    function getRecognitionData() {
        $('#modal-loader').modal('show');
        $.ajax({
            type: "GET",
            async: false,
            url: SIH.getEndPoint("/api/auth/recognition/fetchDetails/" + store.getItem("state")),
            headers: {"X-Auth-Token": authToken}
        }).done(function (data) {
            if (data) {
                setFormData(data);
            } else {
                prePopulateForm();
            }
        });
    }

    function checkRequiredField(attrValue, inputSel) {
        var requiredField = $(inputSel).closest(".form-group").find("sup.required");
        if (requiredField && requiredField.length > 0 && (!attrValue || attrValue === "")) {
            isValidated = false;
            $(inputSel).closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field can't be left Blank.");
        } else {
            $(inputSel).closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
        }
    }


    function infoRequiredData(accordianItem, fieldName) {
        var inputSelection = $(accordianItem).find("input[name='" + fieldName + "']:checked");
        var attrValue = $(inputSelection).val();
        if (attrValue) {
            formData.delete(fieldName);
            formData.append(fieldName, attrValue.toString());
        }
        checkRequiredField(attrValue, $(accordianItem).find("input[name='" + fieldName + "']"));
    }

    $('input[name=product_service_type]').change(function (e) {
        var val = $('input[name=product_service_type]:checked').val();
        if (val) {
            if (val === "1") {
                $(this).closest(".form-group").append("<p id='stageCheck' style='color:#a94442'>Startups at Ideation Stage are not eligible for Tax Benefits</p>");
            } else {
                $('#stageCheck').remove();
            }
        }

    });

    function showRecognitionError(obj, msg) {
        msg = msg ? msg : "There might be some error in your form, please recheck and save again.";
        $(obj).parents(".button").next().find(".has-error").html(msg).removeClass('display-n');
    }

    function validate($target) {
        var validateIpr = false;
        if ($("input[name=incorpNumber]") && $("input[name=incorpNumber]").closest(".form-group").hasClass("has-error")) {
            isValidated = false;
            return false;
        }
        isValidated = true;
        var currentTarget = $target.closest('div.accordionitem');
        var validateSections = [];
        validateSections.push($(currentTarget));
        $(currentTarget).attr("validate", "1");
        $(currentTarget).prevAll().each(function () {
            $(this).attr("validate", "1");
            validateSections.push($(this));
        });

        var requiredFields = $('div.accordion-section sup.required');
        $.each(requiredFields, function (index, item) {
            if (($(item).closest("div.accordionitem")).attr("validate") === "1") {
                var element = $(item).closest('.form-group').find(".form-control:not(.richTextarea,.customised-dropdown)");
                if (element.attr("name") === "appliedForIpr") {
                    validateIpr = true;
                }
                if (element && element.length > 0 && !element.closest(".modal").length && !element.closest(".form-group").hasClass("display-n")) {
                    if (element.attr("type") === "radio" || element.attr("type") === "checkbox") {
                        if (element.is(':checked')) {
                            element.closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
                        }
                        else {
                            if (element.attr("type") === "checkbox") {
                                element.closest(".form-group").addClass("has-error");
                            } else {
                                element.closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field cannot be left Blank.");
                            }
                            isValidated = false;
                        }
                    }
                    else if (!element.val() || element.val() === "") {
                        isValidated = false;
                        showErrorState(element, true);
                    } else if (element.attr("minlength") && element.val().length < parseInt(element.attr("minlength"))) {
                        element.closest(".form-group").addClass("has-error").find("span.help-block").first().html("Mimimum length of this field must be " + element.attr("minlength"));
                        isValidated = false;
                    } else {
                        showErrorState(element, false);
                    }
                }

            }
        });
        var richTextAreas = $('.form-control.richTextarea');
        $.each(richTextAreas, function (index, item) {
            if (($(item).closest("div.accordionitem")).attr("validate") === "1") {
                var el = $(item);
                if (el.closest('.form-group').find('sup.required').length > 0) {
                    var note = el.val().trim();
                    if (note.length > 0 && !el.summernote('isEmpty')) {
                        el.siblings('.note-editor.note-frame').removeClass('note-has-error').addClass('note-writer-text');
                        showErrorState(el, false);
                    } else {
                        isValidated = false;
                        el.siblings('.note-editor.note-frame').addClass('note-has-error').removeClass('note-writer-text');
                        showErrorState(el, true);
                    }
                }
            }
        });

        var customizedDropDown = $('.form-control.customised-dropdown');
        $.each(customizedDropDown, function (index, item) {
            if (($(item).closest("div.accordionitem")).attr("validate") === "1") {
                var el = $(item);
                if ($("select[name=industry]")) {
                    var selectedIndustries = $("select[name=industry]").val();
                    if (!selectedIndustries || selectedIndustries.length === 0) {
                        isValidated = false;
                        showErrorState(el, true);
                    } else {
                        $.each(selectedIndustries, function (idx, selectedIndustry) {
                            var selectedIndustryArr = selectedIndustry.split("/");
                            var industryName = selectedIndustryArr[selectedIndustryArr.length - 1];
                            if (el.find("ul#sector").first().find("input[name=" + industryName + "][type=checkbox]:checked").length === 0) {
                                isValidated = false;
                                showErrorState(el, true);
                            } else {
                                showErrorState(el, false);
                            }
                        });
                    }
                }
            }
        });

        var regexValidatedfields = $('.form-control.regex-val');
        $.each(regexValidatedfields, function (index, item) {
            if (($(item).closest("div.accordionitem")).attr("validate") === "1") {
                var element = $(item);
                var re = new RegExp(element.attr("regex"));
                if (element.val() && !re.test(element.val())) {
                    isValidated = false;
                    //showErrorState(element, true);
                    element.closest(".form-group").addClass("has-error");
                    element.siblings(".regex-msg").show();
                }
                else {
                    if (!(element.closest(".form-group").has("sup.required") && !element.val())) {
                        showErrorState(element, false);
                    }
                    element.siblings(".regex-msg").hide();
                }
            }
        });
        if ($("input[name=appliedForIpr]:checked")) {
            var iprValue = $("input[name=appliedForIpr]:checked").val();
            if (iprValue === "on" && validateIpr) {
                validateIPR();
            }
        }
    }

    function validateIPR() {
        var validated = false;
        var patent = $("input[name=patent]:checked");
        var trademark = $("input[name=trademark]:checked");
        var copyright = $("input[name=copyright]:checked");
        var design = $("input[name=design]:checked");
        var plantVariety = $("input[name=plantVariety]:checked");

        var patentNo = $("input[name=patentApplicationNo]");
        var trademarkNo = $("input[name=trademarkApplicationNo]");
        var copyrightNo = $("input[name=copyrightApplicationNo]");
        var designNo = $("input[name=designApplicationNo]");
        var plantNo = $("input[name=plantVarietyApplicationNo]");

        if (patent && patent.length) {
            if (patentNo.val()) {
                patentNo.parents("td").removeClass("has-error");
            } else {
                patentNo.parents("td").addClass("has-error");
                validated = validated || true;
            }
        }
        if (patentNo.val()) {
            if (patent && !patent.length) {
                $("input[name=patent]").parents("td").addClass("has-error");
                validated = validated || true;
            } else {
                $("input[name=patent]").parents("td").removeClass("has-error");
            }
        }

        if (trademark && trademark.length) {
            if (trademarkNo.val()) {
                trademarkNo.parents("td").removeClass("has-error");
            } else {
                trademarkNo.parents("td").addClass("has-error");
                validated = validated || true;
            }
        }
        if (trademarkNo.val()) {
            if (trademark && !trademark.length) {
                $("input[name=trademark]").parents("td").addClass("has-error");
                validated = validated || true;
            } else {
                $("input[name=trademark]").parents("td").removeClass("has-error");
            }
        }

        if (copyright && copyright.length) {
            if (copyrightNo.val()) {
                copyrightNo.parents("td").removeClass("has-error");
            } else {
                copyrightNo.parents("td").addClass("has-error");
                validated = validated || true;
            }
        }
        if (copyrightNo.val()) {
            if (copyright && !copyright.length) {
                $("input[name=copyright]").parents("td").addClass("has-error");
                validated = validated || true;
            } else {
                $("input[name=copyright]").parents("td").removeClass("has-error");
            }
        }
        if (design && design.length) {
            if (designNo.val()) {
                designNo.parents("td").removeClass("has-error");
            } else {
                designNo.parents("td").addClass("has-error");
                validated = validated || true;
            }
        }
        if (designNo.val()) {
            if (design && !design.length) {
                $("input[name=design]").parents("td").addClass("has-error");
                validated = validated || true;
            } else {
                $("input[name=design]").parents("td").removeClass("has-error");
            }
        }
        if (plantVariety && plantVariety.length) {

            if (plantNo.val()) {
                plantNo.parents("td").removeClass("has-error");
            } else {
                plantNo.parents("td").addClass("has-error");
                validated = validated || true;
            }
        }
        if (plantNo.val()) {
            if (plantVariety && !plantVariety.length) {
                $("input[name=plantVariety]").parents("td").addClass("has-error");
                validated = validated || true;
            } else {
                $("input[name=plantVariety]").parents("td").removeClass("has-error");
            }
        }

        if (validated) {
            isValidated = false;
        }
    }

    function setFormData(data) {
        $.each(data, function (index, val) {
            var field = $('form.common-state-recognition input[name=' + index + '], form.common-state-recognition select[name=' + index + '], form.common-state-recognition textarea[name=' + index + ']');
            var isList = Boolean(field.closest(".repeat-container").length);
            var type = field.attr("type");
            if (type === 'radio') {
                $.each($('input[name=' + index + ']'), function (index, value) {
                    if (($(this).val() === "on" && val === true) || ($(this).val() === "off" && val === false) || ($(this).val() === val)) {
                        $(this).attr('checked', true);
                        field.trigger("change");
                        return true;
                    }
                });
            } else if (type === 'checkbox') {
                $.each($('input[name=' + index + ']'), function (index, value) {
                    var inputVal = $(this).val();
                    $.each(val, function (index, value1) {
                        if (value1 === inputVal) {
                            $(value).attr('checked', true);
                        }
                    })
                });
            }
            else if (isList && Array.isArray(val)) {
                val.forEach(function (value, idx) {
                    field = $('form.common-state-recognition input[name=' + index + '], form.common-state-recognition select[name=' + index + '], form.common-state-recognition textarea[name=' + index + ']');
                    var currentField = $(field).eq(idx);
                    currentField.val(value);
                    if (field.length < val.length) {
                        var parent = currentField.closest(".repeat-container");
                        var button = parent.find(".repeat-add");
                        if (button.length > 0) {
                            button.trigger("click");
                        }
                    }
                })
            } else {
                field.val(val);
                if (index !== "incorpNumber") {
                    field.trigger("change")
                }
            }
        });
        if (data["startupindustry"]) {
            var params = {};
            params["industry"] = data["startupindustry"];
            var $selection = $("#sector");
            setList(params, $selection.data("path"), $selection);
            $selection.val(data["sector"]);
        }
        if (data["fundingDetails"]) {
            data["fundingDetails"].forEach(function (value, idx) {
                var fundingSource = $('form.common-state-recognition input[name=fundingSource]')[idx];
                var fundingAmount = $('form.common-state-recognition input[name=fundingAmount]')[idx];
                var fundingDate = $('form.common-state-recognition input[name=fundingDate]')[idx];
                $(fundingSource).val(value["fundingSource"]);
                $(fundingAmount).val(value["fundingAmount"]);
                $(fundingDate).val(value["fundingDate"]);
                if ((idx + 1) < data["fundingDetails"].length) {
                    $('form.common-state-recognition input[name=fundingSource]').closest(".repeat-container").find('.repeat-add').trigger("click");
                }
            });
        }
        if (data["founderDetails"]) {
            data["founderDetails"].forEach(function (value, idx) {
                var founderName = $('form.common-state-recognition input[name=founderName]')[idx];
                var founderAge = $('form.common-state-recognition input[name=founderAge]')[idx];
                var founderAddress = $('form.common-state-recognition input[name=founderAddress]')[idx];
                var founderEducation = $('form.common-state-recognition input[name=founderEducation]')[idx];
                var founderExperience = $('form.common-state-recognition input[name=founderExperience]')[idx];
                var founderExperienceDetails = $('form.common-state-recognition input[name=founderExperienceDetails]')[idx];
                $(founderName).val(value["founderName"]);
                $(founderAge).val(value["founderAge"]);
                $(founderAddress).val(value["founderAddress"]);
                $(founderEducation).val(value["founderEducation"]);
                $(founderExperience).val(value["founderExperience"]);
                $(founderExperienceDetails).val(value["founderExperienceDetails"]);
                if ((idx + 1) < data["founderDetails"].length) {
                    $('form.common-state-recognition input[name=founderName]').closest(".repeat-container").find('.repeat-add').trigger("click");
                }
            });
        }
        if (data["entityType"] !== "REGISTERED_PARTNERSHIP") {
            $entity_name.attr("readonly", "readonly").parents(".form-group").removeClass("has-error").find(".help-block").html("");
            $incorp_date.attr("readonly", "readonly").parents(".form-group").removeClass("has-error").find(".help-block").html("");
        }

        $("textarea[name=ideaBrief].richTextArea").summernote("code", data["ideaBrief"]);
        if (data["lastAccordionSaved"]) {
            var openAccordion = $incorp_number;
            $('.accordionitem .number').each(function (index, val) {
                if ($(this).html().trim() === data["lastAccordionSaved"]) {
                    openAccordion = $(this);
                }
            });
            $(openAccordion).parents(".accordionitem").find(".accordion-section-title").addClass("active");
            $(openAccordion).parents(".accordionitem").find(".accordion-section-content").show();
            if (data["lastAccordionSaved"] !== "1") {
                $(".accordionitem:first").find(".accordion-section-title").removeClass("active");
                $(".accordionitem:first").find(".accordion-section-content").hide();
            }
        }

        if (data["status"] == "ACCEPTED" || data["status"] == "REJECTED") {
            viewMode();
        }
        populateUploadedFiles(data);
        $('#modal-loader').modal('hide');
    }

    function viewMode() {
        $(".state-recognition-container").find(".accordion-section-content").show().end()
            .find(".repeat-add").hide().end()
            .find(".repeat-remove").hide().end()
            .find("input").attr("disabled", "disabled").end()
            .find(".form-control").attr("disabled", "disabled");
        $("textarea[name=ideaBrief].richTextArea").summernote('disable');
    }
};
$.stateRecognitionIncubator = function () {
    var formData = new FormData();
    var isValidated = true;
    var authToken = store.getItem("token");
    var incubatorType;

    //Head of Host Institute Details
    var $incubatorType = $("select[name='incubatorType']");

    initForm();

    function initForm() {
        $('.upNewIncubator, .upExistingIncubator').parent().addClass('display-n');
    }

    $incubatorType.on("change", function () {
        if ($(this).val() === "EXISTING") {
            $('.upExistingIncubator').parent().removeClass('display-n');
            $('.upNewIncubator').parent().addClass('display-n');
            incubatorType = "upExistingIncubator";
        } else if ($(this).val() === "NEW") {
            $('.upNewIncubator').parent().removeClass('display-n');
            $('.upExistingIncubator').parent().addClass('display-n');
            incubatorType = "upNewIncubator";
        } else {
            $('.upNewIncubator, .upExistingIncubator').parent().addClass('display-n');
        }
    });

    $(".accordionitem:first").find(".accordion-section-title").addClass("active");
    $(".accordionitem:first").find(".accordion-section-content").addClass("open").show();

    var saveObject = {
        "SaveEntity": {"name": "SaveEntity", "section": 1, "errorMessage": "saveEntityErrorMessage"},
        "saveAuthorizedRepresentatives": {
            "name": "saveAuthorizedRepresentatives",
            "section": 2,
            "errorMessage": "saveAuthorizedRepErrorMessage"
        },
        "saveFundingDetails": {
            "name": "saveFundingDetails",
            "section": 3,
            "errorMessage": "saveFundingDetailsMessage"
        },
        "saveRequiredInfo": {"name": "saveRequiredInfo", "section": 4, "errorMessage": "saveRequiredInfoErrorMessage"},
        "saveFounderDetails": {
            "name": "saveFounderDetails",
            "section": 5,
            "errorMessage": "saveFounderDetailsErrorMessage"
        },
        "saveSelfCertification": {
            "name": "saveSelfCertification",
            "section": 6,
            "errorMessage": "saveSelfCertificationErrorMessage"
        }
    };

    function clearIncubatorTypeElements(element) {
        var elements = element.closest('.form-group').find(".form-control:not(.richTextarea)");
        $.each(elements, function (index, item) {
            if ($(item).is("select")) {
                $(item).val('');
            } else {
                $(item).val('');
            }
        });
        var richTextAreas = element.closest('.form-group').find('.form-control.richTextarea');
        $.each(richTextAreas, function (index, item) {
            $(item).summernote("code", "")
        });
    }

    $(document).on('change', '#newIncubatorIndustry , #existingIncubatorIndustry', function (event) {
        var $target = $(event.target);
        var params = {};
        params["industry"] = $target.val();
        var $selection = event.target.id == 'newIncubatorIndustry' ? $("#newIncubatorSector") : $("#existingIncubatorSector");
        setList(params, $selection.data("path"), $selection);
    });

    $("input[value='Save'],input[name='submitRecognitionForm']").click(function (e) {
        var s = saveObject[this.name];
        var $this = this;
        var $target = $(e.currentTarget);
        var isSubmit = $target.val() === "Submit";
        var stateName = SIH.getStateName()[store.getItem('state')];
        var url = SIH.getEndPoint("/api/auth/recognition/draft/" + stateName + "/incubator");
        if (isSubmit) {
            url = SIH.getEndPoint("/api/auth/recognition/save/" + stateName + "/incubator");
            $target = $(".certify");
        }
        validate($target);
        if (isValidated) {
            if ($incubatorType.val() === "EXISTING") {
                clearIncubatorTypeElements($('.upNewIncubator'));
            } else if ($incubatorType.val() === "NEW") {
                clearIncubatorTypeElements($('.upExistingIncubator'));
            }
            var $formData = $target.closest("form.stateCommonRecognitionForm").serialize();
            var data = convertSerializeDataToJSON($formData);
            handleCustomizedData(data);
            s && (data["lastAccordionSaved"] = s.section);
            $('#modal-loader').modal('show');
            $.ajax({
                url: url,
                data: JSON.stringify(data),
                type: 'POST',
                beforeSend: setAuthTokenHeader,
                contentType: "application/json",
                success: function (response) {
                    $('#modal-loader').modal('hide');
                    if (response) {
                        saveStateRecognized();
                        $("input[name=id]").val(response);
                        $($this).parents(".accordion-section-content").hide();
                        var $accItem = $($this).parents(".accordionitem");
                        $accItem.find(".accordion-section-title").removeClass("active");
                        $accItem.next().find(".accordion-section-title").addClass("active");
                        $accItem.next().find(".accordion-section-content").show();
                    }
                    if (isSubmit) {
                        window.location.href = $("#thankyouPage").val();
                    }
                }, error: function (response) {
                    $('#modal-loader').modal('hide');
                    var errorMsg = "Error in saving the form";
                    if (response != null) {
                        errorMsg = response.constructor === Array && response.get(0) != null ? response[0].defaultMessage : (response.responseText != null && response.responseText != "" ? errorMsg + " : " + response.responseText : errorMsg);
                    }
                    $('.recognition-error-modal p').html(errorMsg);
                    $('.recognition-error-modal').modal('show');
                }
            });

        } else {
            $(".accordionitem").find(".accordion-section-title").removeClass("active").end()
                .find(".accordion-section-content").hide();
            var _firstErrorElem = $(".form-group.has-error:first");
            $('html, body').animate({
                scrollTop: _firstErrorElem.offset().top - 15
            }, 500);
            _firstErrorElem.closest(".accordionitem").find(".accordion-section-title").addClass("active");
            $(".form-group.has-error").each(function () {
                $(this).closest(".accordionitem").find(".accordion-section-content").show();
            });
        }
    });

    if (authToken) {
        getRecognitionData();
    }

    function getRecognitionData() {
        $('#modal-loader').modal('show');
        $.ajax({
            type: "GET",
            async: false,
            url: SIH.getEndPoint("/api/auth/recognition/fetchDetails/" + SIH.getStateName()[store.getItem('state')] + "/incubator"),
            headers: {"X-Auth-Token": authToken}
        }).done(function (data) {
            if (data) {
                setFormData(data);
            }
            $('#modal-loader').modal('hide');
        });
    }

    function checkRequiredField(attrValue, inputSel) {
        var requiredField = $(inputSel).closest(".form-group").find("sup.required");
        if (requiredField && requiredField.length > 0 && (!attrValue || attrValue === "")) {
            isValidated = false;
            $(inputSel).closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field can't be left Blank.");
        } else {
            $(inputSel).closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
        }
    }

    function handleCustomizedData(data) {
        if (data["newServices"] != null) {
            var services = data["newServices"];
            if (services && !Array.isArray(services)) {
                data["newServices"] = new Array(services);
            }
        } else if (data["existingServices"] != null) {
            var services = data["existingServices"];
            if (services && !Array.isArray(services)) {
                data["existingServices"] = new Array(services);
            }
        }

        var incubateeName = $('input[name=incubateeName]');
        var incubationPeriod = $("input[name=incubationPeriod]");
        var promoterName = $("input[name=promoterName]");
        var promoterContact = $("input[name=promoterContact]");
        var incubateeProducts = $("input[name=incubateeProducts]");
        var incubateeWebsite = $("input[name=incubateeWebsite]");
        var incubateeCompanyDescription = $("textarea[name=incubateeCompanyDescription]");
        var mentorName = $("input[name=mentorName]");
        var mentorDesignation = $("input[name=mentorDesignation]");
        var mentorCompany = $("input[name=mentorCompany]");
        var mentorMobileNumber = $("input[name=mentorMobileNumber]");
        var mentorEmailId = $("input[name=mentorEmailId]");
        var fieldOfMentorship = $("input[name=fieldOfMentorship]");

        var incubateeDetails = [];
        for (var i = 0; i < incubateeName.length; i++) {
            var incubatees = {
                incubateeName: $(incubateeName[i]).val(),
                incubationPeriod: $(incubationPeriod[i]).val(),
                promoterName: $(promoterName[i]).val(),
                promoterContact: $(promoterContact[i]).val(),
                incubateeProducts: $(incubateeProducts[i]).val(),
                incubateeWebsite: $(incubateeWebsite[i]).val(),
                incubateeCompanyDescription: $(incubateeCompanyDescription[i]).val()
            };
            incubateeDetails.push(incubatees);
        }
        data["incubateeDetails"] = incubateeDetails;
        delete data["incubateeName"];
        delete data["incubationPeriod"];
        delete data["promoterName"];
        delete data["promoterContact"];
        delete data["incubateeProducts"];
        delete data["incubateeWebsite"];
        var mentorDetails = [];
        for (var i = 0; i < mentorName.length; i++) {
            var mentors = {
                mentorName: $(mentorName[i]).val(),
                mentorDesignation: $(mentorDesignation[i]).val(),
                mentorCompany: $(mentorCompany[i]).val(),
                mentorMobileNumber: $(mentorMobileNumber[i]).val(),
                mentorEmailId: $(mentorEmailId[i]).val(),
                fieldOfMentorship: $(fieldOfMentorship[i]).val()
            };
            mentorDetails.push(mentors);
        }
        data["mentorDetails"] = mentorDetails;
        delete data["mentorName"];
        delete data["mentorDesignation"];
        delete data["mentorCompany"];
        delete data["mentorMobileNumber"];
        delete data["mentorEmailId"];
        delete data["fieldOfMentorship"];
    }

    function validate($target) {
        isValidated = true;
        var currentTarget = $target.closest('div.accordionitem');
        var validateSections = [];
        validateSections.push($(currentTarget));
        $(currentTarget).attr("validate", "1");
        $(currentTarget).prevAll().each(function () {
            $(this).attr("validate", "1");
            validateSections.push($(this));
        });

        var requiredFields = $('div.accordion-section sup.required');
        $.each(requiredFields, function (index, item) {
            if (($(item).closest("div.accordionitem")).attr("validate") === "1") {
                var element = $(item).closest('.form-group').find(".form-control:not(.richTextarea,.customised-dropdown)");
                if (element && element.length > 0 && !element.closest(".modal").length && !element.closest(".form-group").hasClass("display-n") && !(element.parents('.section').length && !element.parents('.section').find('.form-group').hasClass(incubatorType))) {
                    if (element.attr("type") === "radio" || element.attr("type") === "checkbox") {
                        if (element.is(':checked')) {
                            element.closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
                        }
                        else {
                            if (element.attr("type") === "checkbox") {
                                element.closest(".form-group").addClass("has-error");
                            } else {
                                element.closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field cannot be left Blank.");
                            }
                            isValidated = false;
                        }
                    }
                    else if (!element.val() || element.val() === "") {
                        isValidated = false;
                        showErrorState(element, true);
                    } else if (element.attr("minlength") && element.val().length < parseInt(element.attr("minlength"))) {
                        element.closest(".form-group").addClass("has-error").find("span.help-block").first().html("Mimimum length of this field must be " + element.attr("minlength"));
                        isValidated = false;
                    } else {
                        showErrorState(element, false);
                    }
                }

            }
        });
        var richTextAreas = $('.form-control.richTextarea');
        $.each(richTextAreas, function (index, item) {
            if (($(item).closest("div.accordionitem")).attr("validate") === "1") {
                var el = $(item);
                if (el.closest('.form-group').find('sup.required').length > 0 && !(el.parents('.section').length && !el.parents('.section').find('.form-group').hasClass(incubatorType))) {
                    var note = el.val().trim();
                    if (note.length > 0 && !el.summernote('isEmpty')) {
                        el.siblings('.note-editor.note-frame').removeClass('note-has-error').addClass('note-writer-text');
                        showErrorState(el, false);
                    } else {
                        isValidated = false;
                        el.siblings('.note-editor.note-frame').addClass('note-has-error').removeClass('note-writer-text');
                        showErrorState(el, true);
                    }
                }
            }
        });

        var customizedDropDown = $('.form-control.customised-dropdown');
        $.each(customizedDropDown, function (index, item) {
            if (($(item).closest("div.accordionitem")).attr("validate") === "1") {
                var el = $(item);
                if ($("select[name=industry]")) {
                    var selectedIndustries = $("select[name=industry]").val();
                    if (!selectedIndustries || selectedIndustries.length === 0) {
                        isValidated = false;
                        showErrorState(el, true);
                    } else {
                        $.each(selectedIndustries, function (idx, selectedIndustry) {
                            var selectedIndustryArr = selectedIndustry.split("/");
                            var industryName = selectedIndustryArr[selectedIndustryArr.length - 1];
                            if (el.find("ul#sector").first().find("input[name=" + industryName + "][type=checkbox]:checked").length === 0) {
                                isValidated = false;
                                showErrorState(el, true);
                            } else {
                                showErrorState(el, false);
                            }
                        });
                    }
                }
            }
        });

        var regexValidatedfields = $('.form-control.regex-val');
        $.each(regexValidatedfields, function (index, item) {
            if (($(item).closest("div.accordionitem")).attr("validate") === "1") {
                var element = $(item);
                var re = new RegExp(element.attr("regex"));
                if (!(element.parents('.section').length && !element.parents('.section').find('.form-group').hasClass(incubatorType))) {
                    if (element.val() && !re.test(element.val())) {
                        isValidated = false;
                        //showErrorState(element, true);
                        element.closest(".form-group").addClass("has-error");
                        element.siblings(".regex-msg").show();
                    }
                    else {
                        if (!(element.closest(".form-group").has("sup.required") && !element.val())) {
                            showErrorState(element, false);
                        }
                        element.siblings(".regex-msg").hide();
                    }
                }
            }

        });
    }

    function setFormData(data) {
        $.each(data, function (index, val) {
            var field = $('form.stateCommonRecognitionForm input[name=' + index + '], form.stateCommonRecognitionForm select[name=' + index + '], form.stateCommonRecognitionForm textarea[name=' + index + ']');
            var isList = Boolean(field.closest(".repeat-container").length);
            var type = field.attr("type");
            if (type === 'radio') {
                $.each($('input[name=' + index + ']'), function (index, value) {
                    if (($(this).val() === "on" && val === true) || ($(this).val() === "off" && val === false) || ($(this).val() === val)) {
                        $(this).attr('checked', true);
                        field.trigger("change");
                        return true;
                    }
                });
            } else if (type === 'checkbox') {
                $.each($('input[name=' + index + ']'), function (index, value) {
                    var inputVal = $(this).val();
                    $.each(val, function (index, value1) {
                        if (value1 === inputVal) {
                            $(value).attr('checked', true);
                        }
                    })
                });
            } else if ($('[name=' + index + ']').is('textarea')) {
                $("textarea[name=" + index + "].richTextArea").summernote("code", val);
            }
            else if (isList && Array.isArray(val)) {
                val.forEach(function (value, idx) {
                    field = $('form.stateCommonRecognitionForm input[name=' + index + '], form.stateCommonRecognitionForm select[name=' + index + '], form.stateCommonRecognitionForm textarea[name=' + index + ']');
                    var currentField = $(field).eq(idx);
                    currentField.val(value);
                    if (field.length < val.length) {
                        var parent = currentField.closest(".repeat-container");
                        var button = parent.find(".repeat-add");
                        if (button.length > 0) {
                            button.trigger("click");
                        }
                    }
                })
            } else {
                field.val(val);
                if (index !== "incorpNumber") {
                    field.trigger("change")
                }
            }
        });
        if (data["startupindustry"]) {
            var params = {};
            params["industry"] = data["startupindustry"];
            var $selection = $("#sector");
            setList(params, $selection.data("path"), $selection);
            $selection.val(data["sector"]);
        }
        if (data["incubateeDetails"]) {
            data["incubateeDetails"].forEach(function (value, idx) {
                var incubateeName = $('form.stateCommonRecognitionForm input[name=incubateeName]')[idx];
                var incubationPeriod = $('form.stateCommonRecognitionForm input[name=incubationPeriod]')[idx];
                var promoterName = $('form.stateCommonRecognitionForm input[name=promoterName]')[idx];
                var promoterContact = $('form.stateCommonRecognitionForm input[name=promoterContact]')[idx];
                var incubateeCompanyDescription = $('form.stateCommonRecognitionForm textarea[name=incubateeCompanyDescription]')[idx];
                var incubateeProducts = $('form.stateCommonRecognitionForm input[name=incubateeProducts]')[idx];
                var incubateeWebsite = $('form.stateCommonRecognitionForm input[name=incubateeWebsite]')[idx];
                $(incubateeName).val(value["incubateeName"]);
                $(incubationPeriod).val(value["incubationPeriod"]);
                $(promoterName).val(value["promoterName"]);
                $(promoterContact).val(value["promoterContact"]);
                $(incubateeCompanyDescription).summernote("code", value["incubateeCompanyDescription"]);
                $(incubateeProducts).val(value["incubateeProducts"]);
                $(incubateeWebsite).val(value["incubateeWebsite"]);
                if ((idx + 1) < data["incubateeDetails"].length) {
                    $('form.stateCommonRecognitionForm input[name=incubateeName]').closest(".repeat-container").find('.repeat-add').trigger("click");
                }
            });
        }
        if (data["mentorDetails"]) {
            data["mentorDetails"].forEach(function (value, idx) {
                var mentorName = $('form.stateCommonRecognitionForm input[name=mentorName]')[idx];
                var mentorDesignation = $('form.stateCommonRecognitionForm input[name=mentorDesignation]')[idx];
                var mentorCompany = $('form.stateCommonRecognitionForm input[name=mentorCompany]')[idx];
                var mentorMobileNumber = $('form.stateCommonRecognitionForm input[name=mentorMobileNumber]')[idx];
                var mentorEmailId = $('form.stateCommonRecognitionForm input[name=mentorEmailId]')[idx];
                var fieldOfMentorship = $('form.stateCommonRecognitionForm input[name=fieldOfMentorship]')[idx];
                $(mentorName).val(value["mentorName"]);
                $(mentorDesignation).val(value["mentorDesignation"]);
                $(mentorCompany).val(value["mentorCompany"]);
                $(mentorMobileNumber).val(value["mentorMobileNumber"]);
                $(mentorEmailId).val(value["mentorEmailId"]);
                $(fieldOfMentorship).val(value["fieldOfMentorship"]);
                if ((idx + 1) < data["mentorDetails"].length) {
                    $('form.stateCommonRecognitionForm input[name=mentorName]').closest(".repeat-container").find('.repeat-add').trigger("click");
                }
            });
        }
        if (data["lastAccordionSaved"]) {
            var openAccordion = $incorp_number;
            $('.accordionitem .number').each(function (index, val) {
                if ($(this).html().trim() === data["lastAccordionSaved"]) {
                    openAccordion = $(this);
                }
            });
            $(openAccordion).parents(".accordionitem").find(".accordion-section-title").addClass("active");
            $(openAccordion).parents(".accordionitem").find(".accordion-section-content").show();
            if (data["lastAccordionSaved"] !== "1") {
                $(".accordionitem:first").find(".accordion-section-title").removeClass("active");
                $(".accordionitem:first").find(".accordion-section-content").hide();
            }
        }

        if (data["status"] == "ACCEPTED" || data["status"] == "REJECTED") {
            viewMode();
        }
        if (data["status"] == "INCOMPLETE") {
            $('input[type=button][name=save]').hide();
        }
    }

    function viewMode() {
        $(".state-recognition-container").find(".accordion-section-content").show().end()
            .find(".repeat-add").hide().end()
            .find(".repeat-remove").hide().end()
            .find("input").attr("disabled", "disabled").end()
            .find(".form-control").attr("disabled", "disabled");
        $(".state-recognition-container").find(".accordion-section-content textarea").each(function () {
            $(this).next().find(".note-editable").attr("contenteditable", false);
        });
    }
};
/*!
 DataTables 1.10.16
 ©2008-2017 SpryMedia Ltd - datatables.net/license
*/
(function(h){"function"===typeof define&&define.amd?define(["jquery"],function(E){return h(E,window,document)}):"object"===typeof exports?module.exports=function(E,G){E||(E=window);G||(G="undefined"!==typeof window?require("jquery"):require("jquery")(E));return h(G,E,E.document)}:h(jQuery,window,document)})(function(h,E,G,k){function X(a){var b,c,d={};h.each(a,function(e){if((b=e.match(/^([^A-Z]+?)([A-Z])/))&&-1!=="a aa ai ao as b fn i m o s ".indexOf(b[1]+" "))c=e.replace(b[0],b[2].toLowerCase()),
d[c]=e,"o"===b[1]&&X(a[e])});a._hungarianMap=d}function I(a,b,c){a._hungarianMap||X(a);var d;h.each(b,function(e){d=a._hungarianMap[e];if(d!==k&&(c||b[d]===k))"o"===d.charAt(0)?(b[d]||(b[d]={}),h.extend(!0,b[d],b[e]),I(a[d],b[d],c)):b[d]=b[e]})}function Ca(a){var b=m.defaults.oLanguage,c=a.sZeroRecords;!a.sEmptyTable&&(c&&"No data available in table"===b.sEmptyTable)&&F(a,a,"sZeroRecords","sEmptyTable");!a.sLoadingRecords&&(c&&"Loading..."===b.sLoadingRecords)&&F(a,a,"sZeroRecords","sLoadingRecords");
a.sInfoThousands&&(a.sThousands=a.sInfoThousands);(a=a.sDecimal)&&cb(a)}function db(a){A(a,"ordering","bSort");A(a,"orderMulti","bSortMulti");A(a,"orderClasses","bSortClasses");A(a,"orderCellsTop","bSortCellsTop");A(a,"order","aaSorting");A(a,"orderFixed","aaSortingFixed");A(a,"paging","bPaginate");A(a,"pagingType","sPaginationType");A(a,"pageLength","iDisplayLength");A(a,"searching","bFilter");"boolean"===typeof a.sScrollX&&(a.sScrollX=a.sScrollX?"100%":"");"boolean"===typeof a.scrollX&&(a.scrollX=
a.scrollX?"100%":"");if(a=a.aoSearchCols)for(var b=0,c=a.length;b<c;b++)a[b]&&I(m.models.oSearch,a[b])}function eb(a){A(a,"orderable","bSortable");A(a,"orderData","aDataSort");A(a,"orderSequence","asSorting");A(a,"orderDataType","sortDataType");var b=a.aDataSort;"number"===typeof b&&!h.isArray(b)&&(a.aDataSort=[b])}function fb(a){if(!m.__browser){var b={};m.__browser=b;var c=h("<div/>").css({position:"fixed",top:0,left:-1*h(E).scrollLeft(),height:1,width:1,overflow:"hidden"}).append(h("<div/>").css({position:"absolute",
top:1,left:1,width:100,overflow:"scroll"}).append(h("<div/>").css({width:"100%",height:10}))).appendTo("body"),d=c.children(),e=d.children();b.barWidth=d[0].offsetWidth-d[0].clientWidth;b.bScrollOversize=100===e[0].offsetWidth&&100!==d[0].clientWidth;b.bScrollbarLeft=1!==Math.round(e.offset().left);b.bBounding=c[0].getBoundingClientRect().width?!0:!1;c.remove()}h.extend(a.oBrowser,m.__browser);a.oScroll.iBarWidth=m.__browser.barWidth}function gb(a,b,c,d,e,f){var g,j=!1;c!==k&&(g=c,j=!0);for(;d!==
e;)a.hasOwnProperty(d)&&(g=j?b(g,a[d],d,a):a[d],j=!0,d+=f);return g}function Da(a,b){var c=m.defaults.column,d=a.aoColumns.length,c=h.extend({},m.models.oColumn,c,{nTh:b?b:G.createElement("th"),sTitle:c.sTitle?c.sTitle:b?b.innerHTML:"",aDataSort:c.aDataSort?c.aDataSort:[d],mData:c.mData?c.mData:d,idx:d});a.aoColumns.push(c);c=a.aoPreSearchCols;c[d]=h.extend({},m.models.oSearch,c[d]);ja(a,d,h(b).data())}function ja(a,b,c){var b=a.aoColumns[b],d=a.oClasses,e=h(b.nTh);if(!b.sWidthOrig){b.sWidthOrig=
e.attr("width")||null;var f=(e.attr("style")||"").match(/width:\s*(\d+[pxem%]+)/);f&&(b.sWidthOrig=f[1])}c!==k&&null!==c&&(eb(c),I(m.defaults.column,c),c.mDataProp!==k&&!c.mData&&(c.mData=c.mDataProp),c.sType&&(b._sManualType=c.sType),c.className&&!c.sClass&&(c.sClass=c.className),c.sClass&&e.addClass(c.sClass),h.extend(b,c),F(b,c,"sWidth","sWidthOrig"),c.iDataSort!==k&&(b.aDataSort=[c.iDataSort]),F(b,c,"aDataSort"));var g=b.mData,j=Q(g),i=b.mRender?Q(b.mRender):null,c=function(a){return"string"===
typeof a&&-1!==a.indexOf("@")};b._bAttrSrc=h.isPlainObject(g)&&(c(g.sort)||c(g.type)||c(g.filter));b._setter=null;b.fnGetData=function(a,b,c){var d=j(a,b,k,c);return i&&b?i(d,b,a,c):d};b.fnSetData=function(a,b,c){return R(g)(a,b,c)};"number"!==typeof g&&(a._rowReadObject=!0);a.oFeatures.bSort||(b.bSortable=!1,e.addClass(d.sSortableNone));a=-1!==h.inArray("asc",b.asSorting);c=-1!==h.inArray("desc",b.asSorting);!b.bSortable||!a&&!c?(b.sSortingClass=d.sSortableNone,b.sSortingClassJUI=""):a&&!c?(b.sSortingClass=
d.sSortableAsc,b.sSortingClassJUI=d.sSortJUIAscAllowed):!a&&c?(b.sSortingClass=d.sSortableDesc,b.sSortingClassJUI=d.sSortJUIDescAllowed):(b.sSortingClass=d.sSortable,b.sSortingClassJUI=d.sSortJUI)}function Y(a){if(!1!==a.oFeatures.bAutoWidth){var b=a.aoColumns;Ea(a);for(var c=0,d=b.length;c<d;c++)b[c].nTh.style.width=b[c].sWidth}b=a.oScroll;(""!==b.sY||""!==b.sX)&&ka(a);r(a,null,"column-sizing",[a])}function Z(a,b){var c=la(a,"bVisible");return"number"===typeof c[b]?c[b]:null}function $(a,b){var c=
la(a,"bVisible"),c=h.inArray(b,c);return-1!==c?c:null}function aa(a){var b=0;h.each(a.aoColumns,function(a,d){d.bVisible&&"none"!==h(d.nTh).css("display")&&b++});return b}function la(a,b){var c=[];h.map(a.aoColumns,function(a,e){a[b]&&c.push(e)});return c}function Fa(a){var b=a.aoColumns,c=a.aoData,d=m.ext.type.detect,e,f,g,j,i,h,l,q,t;e=0;for(f=b.length;e<f;e++)if(l=b[e],t=[],!l.sType&&l._sManualType)l.sType=l._sManualType;else if(!l.sType){g=0;for(j=d.length;g<j;g++){i=0;for(h=c.length;i<h;i++){t[i]===
k&&(t[i]=B(a,i,e,"type"));q=d[g](t[i],a);if(!q&&g!==d.length-1)break;if("html"===q)break}if(q){l.sType=q;break}}l.sType||(l.sType="string")}}function hb(a,b,c,d){var e,f,g,j,i,n,l=a.aoColumns;if(b)for(e=b.length-1;0<=e;e--){n=b[e];var q=n.targets!==k?n.targets:n.aTargets;h.isArray(q)||(q=[q]);f=0;for(g=q.length;f<g;f++)if("number"===typeof q[f]&&0<=q[f]){for(;l.length<=q[f];)Da(a);d(q[f],n)}else if("number"===typeof q[f]&&0>q[f])d(l.length+q[f],n);else if("string"===typeof q[f]){j=0;for(i=l.length;j<
i;j++)("_all"==q[f]||h(l[j].nTh).hasClass(q[f]))&&d(j,n)}}if(c){e=0;for(a=c.length;e<a;e++)d(e,c[e])}}function M(a,b,c,d){var e=a.aoData.length,f=h.extend(!0,{},m.models.oRow,{src:c?"dom":"data",idx:e});f._aData=b;a.aoData.push(f);for(var g=a.aoColumns,j=0,i=g.length;j<i;j++)g[j].sType=null;a.aiDisplayMaster.push(e);b=a.rowIdFn(b);b!==k&&(a.aIds[b]=f);(c||!a.oFeatures.bDeferRender)&&Ga(a,e,c,d);return e}function ma(a,b){var c;b instanceof h||(b=h(b));return b.map(function(b,e){c=Ha(a,e);return M(a,
c.data,e,c.cells)})}function B(a,b,c,d){var e=a.iDraw,f=a.aoColumns[c],g=a.aoData[b]._aData,j=f.sDefaultContent,i=f.fnGetData(g,d,{settings:a,row:b,col:c});if(i===k)return a.iDrawError!=e&&null===j&&(J(a,0,"Requested unknown parameter "+("function"==typeof f.mData?"{function}":"'"+f.mData+"'")+" for row "+b+", column "+c,4),a.iDrawError=e),j;if((i===g||null===i)&&null!==j&&d!==k)i=j;else if("function"===typeof i)return i.call(g);return null===i&&"display"==d?"":i}function ib(a,b,c,d){a.aoColumns[c].fnSetData(a.aoData[b]._aData,
d,{settings:a,row:b,col:c})}function Ia(a){return h.map(a.match(/(\\.|[^\.])+/g)||[""],function(a){return a.replace(/\\\./g,".")})}function Q(a){if(h.isPlainObject(a)){var b={};h.each(a,function(a,c){c&&(b[a]=Q(c))});return function(a,c,f,g){var j=b[c]||b._;return j!==k?j(a,c,f,g):a}}if(null===a)return function(a){return a};if("function"===typeof a)return function(b,c,f,g){return a(b,c,f,g)};if("string"===typeof a&&(-1!==a.indexOf(".")||-1!==a.indexOf("[")||-1!==a.indexOf("("))){var c=function(a,
b,f){var g,j;if(""!==f){j=Ia(f);for(var i=0,n=j.length;i<n;i++){f=j[i].match(ba);g=j[i].match(U);if(f){j[i]=j[i].replace(ba,"");""!==j[i]&&(a=a[j[i]]);g=[];j.splice(0,i+1);j=j.join(".");if(h.isArray(a)){i=0;for(n=a.length;i<n;i++)g.push(c(a[i],b,j))}a=f[0].substring(1,f[0].length-1);a=""===a?g:g.join(a);break}else if(g){j[i]=j[i].replace(U,"");a=a[j[i]]();continue}if(null===a||a[j[i]]===k)return k;a=a[j[i]]}}return a};return function(b,e){return c(b,e,a)}}return function(b){return b[a]}}function R(a){if(h.isPlainObject(a))return R(a._);
if(null===a)return function(){};if("function"===typeof a)return function(b,d,e){a(b,"set",d,e)};if("string"===typeof a&&(-1!==a.indexOf(".")||-1!==a.indexOf("[")||-1!==a.indexOf("("))){var b=function(a,d,e){var e=Ia(e),f;f=e[e.length-1];for(var g,j,i=0,n=e.length-1;i<n;i++){g=e[i].match(ba);j=e[i].match(U);if(g){e[i]=e[i].replace(ba,"");a[e[i]]=[];f=e.slice();f.splice(0,i+1);g=f.join(".");if(h.isArray(d)){j=0;for(n=d.length;j<n;j++)f={},b(f,d[j],g),a[e[i]].push(f)}else a[e[i]]=d;return}j&&(e[i]=e[i].replace(U,
""),a=a[e[i]](d));if(null===a[e[i]]||a[e[i]]===k)a[e[i]]={};a=a[e[i]]}if(f.match(U))a[f.replace(U,"")](d);else a[f.replace(ba,"")]=d};return function(c,d){return b(c,d,a)}}return function(b,d){b[a]=d}}function Ja(a){return D(a.aoData,"_aData")}function na(a){a.aoData.length=0;a.aiDisplayMaster.length=0;a.aiDisplay.length=0;a.aIds={}}function oa(a,b,c){for(var d=-1,e=0,f=a.length;e<f;e++)a[e]==b?d=e:a[e]>b&&a[e]--; -1!=d&&c===k&&a.splice(d,1)}function ca(a,b,c,d){var e=a.aoData[b],f,g=function(c,d){for(;c.childNodes.length;)c.removeChild(c.firstChild);
c.innerHTML=B(a,b,d,"display")};if("dom"===c||(!c||"auto"===c)&&"dom"===e.src)e._aData=Ha(a,e,d,d===k?k:e._aData).data;else{var j=e.anCells;if(j)if(d!==k)g(j[d],d);else{c=0;for(f=j.length;c<f;c++)g(j[c],c)}}e._aSortData=null;e._aFilterData=null;g=a.aoColumns;if(d!==k)g[d].sType=null;else{c=0;for(f=g.length;c<f;c++)g[c].sType=null;Ka(a,e)}}function Ha(a,b,c,d){var e=[],f=b.firstChild,g,j,i=0,n,l=a.aoColumns,q=a._rowReadObject,d=d!==k?d:q?{}:[],t=function(a,b){if("string"===typeof a){var c=a.indexOf("@");
-1!==c&&(c=a.substring(c+1),R(a)(d,b.getAttribute(c)))}},m=function(a){if(c===k||c===i)j=l[i],n=h.trim(a.innerHTML),j&&j._bAttrSrc?(R(j.mData._)(d,n),t(j.mData.sort,a),t(j.mData.type,a),t(j.mData.filter,a)):q?(j._setter||(j._setter=R(j.mData)),j._setter(d,n)):d[i]=n;i++};if(f)for(;f;){g=f.nodeName.toUpperCase();if("TD"==g||"TH"==g)m(f),e.push(f);f=f.nextSibling}else{e=b.anCells;f=0;for(g=e.length;f<g;f++)m(e[f])}if(b=b.firstChild?b:b.nTr)(b=b.getAttribute("id"))&&R(a.rowId)(d,b);return{data:d,cells:e}}
function Ga(a,b,c,d){var e=a.aoData[b],f=e._aData,g=[],j,i,n,l,q;if(null===e.nTr){j=c||G.createElement("tr");e.nTr=j;e.anCells=g;j._DT_RowIndex=b;Ka(a,e);l=0;for(q=a.aoColumns.length;l<q;l++){n=a.aoColumns[l];i=c?d[l]:G.createElement(n.sCellType);i._DT_CellIndex={row:b,column:l};g.push(i);if((!c||n.mRender||n.mData!==l)&&(!h.isPlainObject(n.mData)||n.mData._!==l+".display"))i.innerHTML=B(a,b,l,"display");n.sClass&&(i.className+=" "+n.sClass);n.bVisible&&!c?j.appendChild(i):!n.bVisible&&c&&i.parentNode.removeChild(i);
n.fnCreatedCell&&n.fnCreatedCell.call(a.oInstance,i,B(a,b,l),f,b,l)}r(a,"aoRowCreatedCallback",null,[j,f,b])}e.nTr.setAttribute("role","row")}function Ka(a,b){var c=b.nTr,d=b._aData;if(c){var e=a.rowIdFn(d);e&&(c.id=e);d.DT_RowClass&&(e=d.DT_RowClass.split(" "),b.__rowc=b.__rowc?qa(b.__rowc.concat(e)):e,h(c).removeClass(b.__rowc.join(" ")).addClass(d.DT_RowClass));d.DT_RowAttr&&h(c).attr(d.DT_RowAttr);d.DT_RowData&&h(c).data(d.DT_RowData)}}function jb(a){var b,c,d,e,f,g=a.nTHead,j=a.nTFoot,i=0===
h("th, td",g).length,n=a.oClasses,l=a.aoColumns;i&&(e=h("<tr/>").appendTo(g));b=0;for(c=l.length;b<c;b++)f=l[b],d=h(f.nTh).addClass(f.sClass),i&&d.appendTo(e),a.oFeatures.bSort&&(d.addClass(f.sSortingClass),!1!==f.bSortable&&(d.attr("tabindex",a.iTabIndex).attr("aria-controls",a.sTableId),La(a,f.nTh,b))),f.sTitle!=d[0].innerHTML&&d.html(f.sTitle),Ma(a,"header")(a,d,f,n);i&&da(a.aoHeader,g);h(g).find(">tr").attr("role","row");h(g).find(">tr>th, >tr>td").addClass(n.sHeaderTH);h(j).find(">tr>th, >tr>td").addClass(n.sFooterTH);
if(null!==j){a=a.aoFooter[0];b=0;for(c=a.length;b<c;b++)f=l[b],f.nTf=a[b].cell,f.sClass&&h(f.nTf).addClass(f.sClass)}}function ea(a,b,c){var d,e,f,g=[],j=[],i=a.aoColumns.length,n;if(b){c===k&&(c=!1);d=0;for(e=b.length;d<e;d++){g[d]=b[d].slice();g[d].nTr=b[d].nTr;for(f=i-1;0<=f;f--)!a.aoColumns[f].bVisible&&!c&&g[d].splice(f,1);j.push([])}d=0;for(e=g.length;d<e;d++){if(a=g[d].nTr)for(;f=a.firstChild;)a.removeChild(f);f=0;for(b=g[d].length;f<b;f++)if(n=i=1,j[d][f]===k){a.appendChild(g[d][f].cell);
for(j[d][f]=1;g[d+i]!==k&&g[d][f].cell==g[d+i][f].cell;)j[d+i][f]=1,i++;for(;g[d][f+n]!==k&&g[d][f].cell==g[d][f+n].cell;){for(c=0;c<i;c++)j[d+c][f+n]=1;n++}h(g[d][f].cell).attr("rowspan",i).attr("colspan",n)}}}}function N(a){var b=r(a,"aoPreDrawCallback","preDraw",[a]);if(-1!==h.inArray(!1,b))C(a,!1);else{var b=[],c=0,d=a.asStripeClasses,e=d.length,f=a.oLanguage,g=a.iInitDisplayStart,j="ssp"==y(a),i=a.aiDisplay;a.bDrawing=!0;g!==k&&-1!==g&&(a._iDisplayStart=j?g:g>=a.fnRecordsDisplay()?0:g,a.iInitDisplayStart=
-1);var g=a._iDisplayStart,n=a.fnDisplayEnd();if(a.bDeferLoading)a.bDeferLoading=!1,a.iDraw++,C(a,!1);else if(j){if(!a.bDestroying&&!kb(a))return}else a.iDraw++;if(0!==i.length){f=j?a.aoData.length:n;for(j=j?0:g;j<f;j++){var l=i[j],q=a.aoData[l];null===q.nTr&&Ga(a,l);l=q.nTr;if(0!==e){var t=d[c%e];q._sRowStripe!=t&&(h(l).removeClass(q._sRowStripe).addClass(t),q._sRowStripe=t)}r(a,"aoRowCallback",null,[l,q._aData,c,j]);b.push(l);c++}}else c=f.sZeroRecords,1==a.iDraw&&"ajax"==y(a)?c=f.sLoadingRecords:
f.sEmptyTable&&0===a.fnRecordsTotal()&&(c=f.sEmptyTable),b[0]=h("<tr/>",{"class":e?d[0]:""}).append(h("<td />",{valign:"top",colSpan:aa(a),"class":a.oClasses.sRowEmpty}).html(c))[0];r(a,"aoHeaderCallback","header",[h(a.nTHead).children("tr")[0],Ja(a),g,n,i]);r(a,"aoFooterCallback","footer",[h(a.nTFoot).children("tr")[0],Ja(a),g,n,i]);d=h(a.nTBody);d.children().detach();d.append(h(b));r(a,"aoDrawCallback","draw",[a]);a.bSorted=!1;a.bFiltered=!1;a.bDrawing=!1}}function S(a,b){var c=a.oFeatures,d=c.bFilter;
c.bSort&&lb(a);d?fa(a,a.oPreviousSearch):a.aiDisplay=a.aiDisplayMaster.slice();!0!==b&&(a._iDisplayStart=0);a._drawHold=b;N(a);a._drawHold=!1}function mb(a){var b=a.oClasses,c=h(a.nTable),c=h("<div/>").insertBefore(c),d=a.oFeatures,e=h("<div/>",{id:a.sTableId+"_wrapper","class":b.sWrapper+(a.nTFoot?"":" "+b.sNoFooter)});a.nHolding=c[0];a.nTableWrapper=e[0];a.nTableReinsertBefore=a.nTable.nextSibling;for(var f=a.sDom.split(""),g,j,i,n,l,q,k=0;k<f.length;k++){g=null;j=f[k];if("<"==j){i=h("<div/>")[0];
n=f[k+1];if("'"==n||'"'==n){l="";for(q=2;f[k+q]!=n;)l+=f[k+q],q++;"H"==l?l=b.sJUIHeader:"F"==l&&(l=b.sJUIFooter);-1!=l.indexOf(".")?(n=l.split("."),i.id=n[0].substr(1,n[0].length-1),i.className=n[1]):"#"==l.charAt(0)?i.id=l.substr(1,l.length-1):i.className=l;k+=q}e.append(i);e=h(i)}else if(">"==j)e=e.parent();else if("l"==j&&d.bPaginate&&d.bLengthChange)g=nb(a);else if("f"==j&&d.bFilter)g=ob(a);else if("r"==j&&d.bProcessing)g=pb(a);else if("t"==j)g=qb(a);else if("i"==j&&d.bInfo)g=rb(a);else if("p"==
j&&d.bPaginate)g=sb(a);else if(0!==m.ext.feature.length){i=m.ext.feature;q=0;for(n=i.length;q<n;q++)if(j==i[q].cFeature){g=i[q].fnInit(a);break}}g&&(i=a.aanFeatures,i[j]||(i[j]=[]),i[j].push(g),e.append(g))}c.replaceWith(e);a.nHolding=null}function da(a,b){var c=h(b).children("tr"),d,e,f,g,j,i,n,l,q,k;a.splice(0,a.length);f=0;for(i=c.length;f<i;f++)a.push([]);f=0;for(i=c.length;f<i;f++){d=c[f];for(e=d.firstChild;e;){if("TD"==e.nodeName.toUpperCase()||"TH"==e.nodeName.toUpperCase()){l=1*e.getAttribute("colspan");
q=1*e.getAttribute("rowspan");l=!l||0===l||1===l?1:l;q=!q||0===q||1===q?1:q;g=0;for(j=a[f];j[g];)g++;n=g;k=1===l?!0:!1;for(j=0;j<l;j++)for(g=0;g<q;g++)a[f+g][n+j]={cell:e,unique:k},a[f+g].nTr=d}e=e.nextSibling}}}function ra(a,b,c){var d=[];c||(c=a.aoHeader,b&&(c=[],da(c,b)));for(var b=0,e=c.length;b<e;b++)for(var f=0,g=c[b].length;f<g;f++)if(c[b][f].unique&&(!d[f]||!a.bSortCellsTop))d[f]=c[b][f].cell;return d}function sa(a,b,c){r(a,"aoServerParams","serverParams",[b]);if(b&&h.isArray(b)){var d={},
e=/(.*?)\[\]$/;h.each(b,function(a,b){var c=b.name.match(e);c?(c=c[0],d[c]||(d[c]=[]),d[c].push(b.value)):d[b.name]=b.value});b=d}var f,g=a.ajax,j=a.oInstance,i=function(b){r(a,null,"xhr",[a,b,a.jqXHR]);c(b)};if(h.isPlainObject(g)&&g.data){f=g.data;var n=h.isFunction(f)?f(b,a):f,b=h.isFunction(f)&&n?n:h.extend(!0,b,n);delete g.data}n={data:b,success:function(b){var c=b.error||b.sError;c&&J(a,0,c);a.json=b;i(b)},dataType:"json",cache:!1,type:a.sServerMethod,error:function(b,c){var d=r(a,null,"xhr",
[a,null,a.jqXHR]);-1===h.inArray(!0,d)&&("parsererror"==c?J(a,0,"Invalid JSON response",1):4===b.readyState&&J(a,0,"Ajax error",7));C(a,!1)}};a.oAjaxData=b;r(a,null,"preXhr",[a,b]);a.fnServerData?a.fnServerData.call(j,a.sAjaxSource,h.map(b,function(a,b){return{name:b,value:a}}),i,a):a.sAjaxSource||"string"===typeof g?a.jqXHR=h.ajax(h.extend(n,{url:g||a.sAjaxSource})):h.isFunction(g)?a.jqXHR=g.call(j,b,i,a):(a.jqXHR=h.ajax(h.extend(n,g)),g.data=f)}function kb(a){return a.bAjaxDataGet?(a.iDraw++,C(a,
!0),sa(a,tb(a),function(b){ub(a,b)}),!1):!0}function tb(a){var b=a.aoColumns,c=b.length,d=a.oFeatures,e=a.oPreviousSearch,f=a.aoPreSearchCols,g,j=[],i,n,l,k=V(a);g=a._iDisplayStart;i=!1!==d.bPaginate?a._iDisplayLength:-1;var t=function(a,b){j.push({name:a,value:b})};t("sEcho",a.iDraw);t("iColumns",c);t("sColumns",D(b,"sName").join(","));t("iDisplayStart",g);t("iDisplayLength",i);var pa={draw:a.iDraw,columns:[],order:[],start:g,length:i,search:{value:e.sSearch,regex:e.bRegex}};for(g=0;g<c;g++)n=b[g],
l=f[g],i="function"==typeof n.mData?"function":n.mData,pa.columns.push({data:i,name:n.sName,searchable:n.bSearchable,orderable:n.bSortable,search:{value:l.sSearch,regex:l.bRegex}}),t("mDataProp_"+g,i),d.bFilter&&(t("sSearch_"+g,l.sSearch),t("bRegex_"+g,l.bRegex),t("bSearchable_"+g,n.bSearchable)),d.bSort&&t("bSortable_"+g,n.bSortable);d.bFilter&&(t("sSearch",e.sSearch),t("bRegex",e.bRegex));d.bSort&&(h.each(k,function(a,b){pa.order.push({column:b.col,dir:b.dir});t("iSortCol_"+a,b.col);t("sSortDir_"+
a,b.dir)}),t("iSortingCols",k.length));b=m.ext.legacy.ajax;return null===b?a.sAjaxSource?j:pa:b?j:pa}function ub(a,b){var c=ta(a,b),d=b.sEcho!==k?b.sEcho:b.draw,e=b.iTotalRecords!==k?b.iTotalRecords:b.recordsTotal,f=b.iTotalDisplayRecords!==k?b.iTotalDisplayRecords:b.recordsFiltered;if(d){if(1*d<a.iDraw)return;a.iDraw=1*d}na(a);a._iRecordsTotal=parseInt(e,10);a._iRecordsDisplay=parseInt(f,10);d=0;for(e=c.length;d<e;d++)M(a,c[d]);a.aiDisplay=a.aiDisplayMaster.slice();a.bAjaxDataGet=!1;N(a);a._bInitComplete||
ua(a,b);a.bAjaxDataGet=!0;C(a,!1)}function ta(a,b){var c=h.isPlainObject(a.ajax)&&a.ajax.dataSrc!==k?a.ajax.dataSrc:a.sAjaxDataProp;return"data"===c?b.aaData||b[c]:""!==c?Q(c)(b):b}function ob(a){var b=a.oClasses,c=a.sTableId,d=a.oLanguage,e=a.oPreviousSearch,f=a.aanFeatures,g='<input type="search" class="'+b.sFilterInput+'"/>',j=d.sSearch,j=j.match(/_INPUT_/)?j.replace("_INPUT_",g):j+g,b=h("<div/>",{id:!f.f?c+"_filter":null,"class":b.sFilter}).append(h("<label/>").append(j)),f=function(){var b=!this.value?
"":this.value;b!=e.sSearch&&(fa(a,{sSearch:b,bRegex:e.bRegex,bSmart:e.bSmart,bCaseInsensitive:e.bCaseInsensitive}),a._iDisplayStart=0,N(a))},g=null!==a.searchDelay?a.searchDelay:"ssp"===y(a)?400:0,i=h("input",b).val(e.sSearch).attr("placeholder",d.sSearchPlaceholder).on("keyup.DT search.DT input.DT paste.DT cut.DT",g?Na(f,g):f).on("keypress.DT",function(a){if(13==a.keyCode)return!1}).attr("aria-controls",c);h(a.nTable).on("search.dt.DT",function(b,c){if(a===c)try{i[0]!==G.activeElement&&i.val(e.sSearch)}catch(d){}});
return b[0]}function fa(a,b,c){var d=a.oPreviousSearch,e=a.aoPreSearchCols,f=function(a){d.sSearch=a.sSearch;d.bRegex=a.bRegex;d.bSmart=a.bSmart;d.bCaseInsensitive=a.bCaseInsensitive};Fa(a);if("ssp"!=y(a)){vb(a,b.sSearch,c,b.bEscapeRegex!==k?!b.bEscapeRegex:b.bRegex,b.bSmart,b.bCaseInsensitive);f(b);for(b=0;b<e.length;b++)wb(a,e[b].sSearch,b,e[b].bEscapeRegex!==k?!e[b].bEscapeRegex:e[b].bRegex,e[b].bSmart,e[b].bCaseInsensitive);xb(a)}else f(b);a.bFiltered=!0;r(a,null,"search",[a])}function xb(a){for(var b=
m.ext.search,c=a.aiDisplay,d,e,f=0,g=b.length;f<g;f++){for(var j=[],i=0,n=c.length;i<n;i++)e=c[i],d=a.aoData[e],b[f](a,d._aFilterData,e,d._aData,i)&&j.push(e);c.length=0;h.merge(c,j)}}function wb(a,b,c,d,e,f){if(""!==b){for(var g=[],j=a.aiDisplay,d=Oa(b,d,e,f),e=0;e<j.length;e++)b=a.aoData[j[e]]._aFilterData[c],d.test(b)&&g.push(j[e]);a.aiDisplay=g}}function vb(a,b,c,d,e,f){var d=Oa(b,d,e,f),f=a.oPreviousSearch.sSearch,g=a.aiDisplayMaster,j,e=[];0!==m.ext.search.length&&(c=!0);j=yb(a);if(0>=b.length)a.aiDisplay=
g.slice();else{if(j||c||f.length>b.length||0!==b.indexOf(f)||a.bSorted)a.aiDisplay=g.slice();b=a.aiDisplay;for(c=0;c<b.length;c++)d.test(a.aoData[b[c]]._sFilterRow)&&e.push(b[c]);a.aiDisplay=e}}function Oa(a,b,c,d){a=b?a:Pa(a);c&&(a="^(?=.*?"+h.map(a.match(/"[^"]+"|[^ ]+/g)||[""],function(a){if('"'===a.charAt(0))var b=a.match(/^"(.*)"$/),a=b?b[1]:a;return a.replace('"',"")}).join(")(?=.*?")+").*$");return RegExp(a,d?"i":"")}function yb(a){var b=a.aoColumns,c,d,e,f,g,j,i,h,l=m.ext.type.search;c=!1;
d=0;for(f=a.aoData.length;d<f;d++)if(h=a.aoData[d],!h._aFilterData){j=[];e=0;for(g=b.length;e<g;e++)c=b[e],c.bSearchable?(i=B(a,d,e,"filter"),l[c.sType]&&(i=l[c.sType](i)),null===i&&(i=""),"string"!==typeof i&&i.toString&&(i=i.toString())):i="",i.indexOf&&-1!==i.indexOf("&")&&(va.innerHTML=i,i=Wb?va.textContent:va.innerText),i.replace&&(i=i.replace(/[\r\n]/g,"")),j.push(i);h._aFilterData=j;h._sFilterRow=j.join("  ");c=!0}return c}function zb(a){return{search:a.sSearch,smart:a.bSmart,regex:a.bRegex,
caseInsensitive:a.bCaseInsensitive}}function Ab(a){return{sSearch:a.search,bSmart:a.smart,bRegex:a.regex,bCaseInsensitive:a.caseInsensitive}}function rb(a){var b=a.sTableId,c=a.aanFeatures.i,d=h("<div/>",{"class":a.oClasses.sInfo,id:!c?b+"_info":null});c||(a.aoDrawCallback.push({fn:Bb,sName:"information"}),d.attr("role","status").attr("aria-live","polite"),h(a.nTable).attr("aria-describedby",b+"_info"));return d[0]}function Bb(a){var b=a.aanFeatures.i;if(0!==b.length){var c=a.oLanguage,d=a._iDisplayStart+
1,e=a.fnDisplayEnd(),f=a.fnRecordsTotal(),g=a.fnRecordsDisplay(),j=g?c.sInfo:c.sInfoEmpty;g!==f&&(j+=" "+c.sInfoFiltered);j+=c.sInfoPostFix;j=Cb(a,j);c=c.fnInfoCallback;null!==c&&(j=c.call(a.oInstance,a,d,e,f,g,j));h(b).html(j)}}function Cb(a,b){var c=a.fnFormatNumber,d=a._iDisplayStart+1,e=a._iDisplayLength,f=a.fnRecordsDisplay(),g=-1===e;return b.replace(/_START_/g,c.call(a,d)).replace(/_END_/g,c.call(a,a.fnDisplayEnd())).replace(/_MAX_/g,c.call(a,a.fnRecordsTotal())).replace(/_TOTAL_/g,c.call(a,
f)).replace(/_PAGE_/g,c.call(a,g?1:Math.ceil(d/e))).replace(/_PAGES_/g,c.call(a,g?1:Math.ceil(f/e)))}function ga(a){var b,c,d=a.iInitDisplayStart,e=a.aoColumns,f;c=a.oFeatures;var g=a.bDeferLoading;if(a.bInitialised){mb(a);jb(a);ea(a,a.aoHeader);ea(a,a.aoFooter);C(a,!0);c.bAutoWidth&&Ea(a);b=0;for(c=e.length;b<c;b++)f=e[b],f.sWidth&&(f.nTh.style.width=v(f.sWidth));r(a,null,"preInit",[a]);S(a);e=y(a);if("ssp"!=e||g)"ajax"==e?sa(a,[],function(c){var f=ta(a,c);for(b=0;b<f.length;b++)M(a,f[b]);a.iInitDisplayStart=
d;S(a);C(a,!1);ua(a,c)},a):(C(a,!1),ua(a))}else setTimeout(function(){ga(a)},200)}function ua(a,b){a._bInitComplete=!0;(b||a.oInit.aaData)&&Y(a);r(a,null,"plugin-init",[a,b]);r(a,"aoInitComplete","init",[a,b])}function Qa(a,b){var c=parseInt(b,10);a._iDisplayLength=c;Ra(a);r(a,null,"length",[a,c])}function nb(a){for(var b=a.oClasses,c=a.sTableId,d=a.aLengthMenu,e=h.isArray(d[0]),f=e?d[0]:d,d=e?d[1]:d,e=h("<select/>",{name:c+"_length","aria-controls":c,"class":b.sLengthSelect}),g=0,j=f.length;g<j;g++)e[0][g]=
new Option("number"===typeof d[g]?a.fnFormatNumber(d[g]):d[g],f[g]);var i=h("<div><label/></div>").addClass(b.sLength);a.aanFeatures.l||(i[0].id=c+"_length");i.children().append(a.oLanguage.sLengthMenu.replace("_MENU_",e[0].outerHTML));h("select",i).val(a._iDisplayLength).on("change.DT",function(){Qa(a,h(this).val());N(a)});h(a.nTable).on("length.dt.DT",function(b,c,d){a===c&&h("select",i).val(d)});return i[0]}function sb(a){var b=a.sPaginationType,c=m.ext.pager[b],d="function"===typeof c,e=function(a){N(a)},
b=h("<div/>").addClass(a.oClasses.sPaging+b)[0],f=a.aanFeatures;d||c.fnInit(a,b,e);f.p||(b.id=a.sTableId+"_paginate",a.aoDrawCallback.push({fn:function(a){if(d){var b=a._iDisplayStart,i=a._iDisplayLength,h=a.fnRecordsDisplay(),l=-1===i,b=l?0:Math.ceil(b/i),i=l?1:Math.ceil(h/i),h=c(b,i),k,l=0;for(k=f.p.length;l<k;l++)Ma(a,"pageButton")(a,f.p[l],l,h,b,i)}else c.fnUpdate(a,e)},sName:"pagination"}));return b}function Sa(a,b,c){var d=a._iDisplayStart,e=a._iDisplayLength,f=a.fnRecordsDisplay();0===f||-1===
e?d=0:"number"===typeof b?(d=b*e,d>f&&(d=0)):"first"==b?d=0:"previous"==b?(d=0<=e?d-e:0,0>d&&(d=0)):"next"==b?d+e<f&&(d+=e):"last"==b?d=Math.floor((f-1)/e)*e:J(a,0,"Unknown paging action: "+b,5);b=a._iDisplayStart!==d;a._iDisplayStart=d;b&&(r(a,null,"page",[a]),c&&N(a));return b}function pb(a){return h("<div/>",{id:!a.aanFeatures.r?a.sTableId+"_processing":null,"class":a.oClasses.sProcessing}).html(a.oLanguage.sProcessing).insertBefore(a.nTable)[0]}function C(a,b){a.oFeatures.bProcessing&&h(a.aanFeatures.r).css("display",
b?"block":"none");r(a,null,"processing",[a,b])}function qb(a){var b=h(a.nTable);b.attr("role","grid");var c=a.oScroll;if(""===c.sX&&""===c.sY)return a.nTable;var d=c.sX,e=c.sY,f=a.oClasses,g=b.children("caption"),j=g.length?g[0]._captionSide:null,i=h(b[0].cloneNode(!1)),n=h(b[0].cloneNode(!1)),l=b.children("tfoot");l.length||(l=null);i=h("<div/>",{"class":f.sScrollWrapper}).append(h("<div/>",{"class":f.sScrollHead}).css({overflow:"hidden",position:"relative",border:0,width:d?!d?null:v(d):"100%"}).append(h("<div/>",
{"class":f.sScrollHeadInner}).css({"box-sizing":"content-box",width:c.sXInner||"100%"}).append(i.removeAttr("id").css("margin-left",0).append("top"===j?g:null).append(b.children("thead"))))).append(h("<div/>",{"class":f.sScrollBody}).css({position:"relative",overflow:"auto",width:!d?null:v(d)}).append(b));l&&i.append(h("<div/>",{"class":f.sScrollFoot}).css({overflow:"hidden",border:0,width:d?!d?null:v(d):"100%"}).append(h("<div/>",{"class":f.sScrollFootInner}).append(n.removeAttr("id").css("margin-left",
0).append("bottom"===j?g:null).append(b.children("tfoot")))));var b=i.children(),k=b[0],f=b[1],t=l?b[2]:null;if(d)h(f).on("scroll.DT",function(){var a=this.scrollLeft;k.scrollLeft=a;l&&(t.scrollLeft=a)});h(f).css(e&&c.bCollapse?"max-height":"height",e);a.nScrollHead=k;a.nScrollBody=f;a.nScrollFoot=t;a.aoDrawCallback.push({fn:ka,sName:"scrolling"});return i[0]}function ka(a){var b=a.oScroll,c=b.sX,d=b.sXInner,e=b.sY,b=b.iBarWidth,f=h(a.nScrollHead),g=f[0].style,j=f.children("div"),i=j[0].style,n=j.children("table"),
j=a.nScrollBody,l=h(j),q=j.style,t=h(a.nScrollFoot).children("div"),m=t.children("table"),o=h(a.nTHead),p=h(a.nTable),s=p[0],r=s.style,u=a.nTFoot?h(a.nTFoot):null,x=a.oBrowser,T=x.bScrollOversize,Xb=D(a.aoColumns,"nTh"),O,K,P,w,Ta=[],y=[],z=[],A=[],B,C=function(a){a=a.style;a.paddingTop="0";a.paddingBottom="0";a.borderTopWidth="0";a.borderBottomWidth="0";a.height=0};K=j.scrollHeight>j.clientHeight;if(a.scrollBarVis!==K&&a.scrollBarVis!==k)a.scrollBarVis=K,Y(a);else{a.scrollBarVis=K;p.children("thead, tfoot").remove();
u&&(P=u.clone().prependTo(p),O=u.find("tr"),P=P.find("tr"));w=o.clone().prependTo(p);o=o.find("tr");K=w.find("tr");w.find("th, td").removeAttr("tabindex");c||(q.width="100%",f[0].style.width="100%");h.each(ra(a,w),function(b,c){B=Z(a,b);c.style.width=a.aoColumns[B].sWidth});u&&H(function(a){a.style.width=""},P);f=p.outerWidth();if(""===c){r.width="100%";if(T&&(p.find("tbody").height()>j.offsetHeight||"scroll"==l.css("overflow-y")))r.width=v(p.outerWidth()-b);f=p.outerWidth()}else""!==d&&(r.width=
v(d),f=p.outerWidth());H(C,K);H(function(a){z.push(a.innerHTML);Ta.push(v(h(a).css("width")))},K);H(function(a,b){if(h.inArray(a,Xb)!==-1)a.style.width=Ta[b]},o);h(K).height(0);u&&(H(C,P),H(function(a){A.push(a.innerHTML);y.push(v(h(a).css("width")))},P),H(function(a,b){a.style.width=y[b]},O),h(P).height(0));H(function(a,b){a.innerHTML='<div class="dataTables_sizing" style="height:0;overflow:hidden;">'+z[b]+"</div>";a.style.width=Ta[b]},K);u&&H(function(a,b){a.innerHTML='<div class="dataTables_sizing" style="height:0;overflow:hidden;">'+
A[b]+"</div>";a.style.width=y[b]},P);if(p.outerWidth()<f){O=j.scrollHeight>j.offsetHeight||"scroll"==l.css("overflow-y")?f+b:f;if(T&&(j.scrollHeight>j.offsetHeight||"scroll"==l.css("overflow-y")))r.width=v(O-b);(""===c||""!==d)&&J(a,1,"Possible column misalignment",6)}else O="100%";q.width=v(O);g.width=v(O);u&&(a.nScrollFoot.style.width=v(O));!e&&T&&(q.height=v(s.offsetHeight+b));c=p.outerWidth();n[0].style.width=v(c);i.width=v(c);d=p.height()>j.clientHeight||"scroll"==l.css("overflow-y");e="padding"+
(x.bScrollbarLeft?"Left":"Right");i[e]=d?b+"px":"0px";u&&(m[0].style.width=v(c),t[0].style.width=v(c),t[0].style[e]=d?b+"px":"0px");p.children("colgroup").insertBefore(p.children("thead"));l.scroll();if((a.bSorted||a.bFiltered)&&!a._drawHold)j.scrollTop=0}}function H(a,b,c){for(var d=0,e=0,f=b.length,g,j;e<f;){g=b[e].firstChild;for(j=c?c[e].firstChild:null;g;)1===g.nodeType&&(c?a(g,j,d):a(g,d),d++),g=g.nextSibling,j=c?j.nextSibling:null;e++}}function Ea(a){var b=a.nTable,c=a.aoColumns,d=a.oScroll,
e=d.sY,f=d.sX,g=d.sXInner,j=c.length,i=la(a,"bVisible"),n=h("th",a.nTHead),l=b.getAttribute("width"),k=b.parentNode,t=!1,m,o,p=a.oBrowser,d=p.bScrollOversize;(m=b.style.width)&&-1!==m.indexOf("%")&&(l=m);for(m=0;m<i.length;m++)o=c[i[m]],null!==o.sWidth&&(o.sWidth=Db(o.sWidthOrig,k),t=!0);if(d||!t&&!f&&!e&&j==aa(a)&&j==n.length)for(m=0;m<j;m++)i=Z(a,m),null!==i&&(c[i].sWidth=v(n.eq(m).width()));else{j=h(b).clone().css("visibility","hidden").removeAttr("id");j.find("tbody tr").remove();var s=h("<tr/>").appendTo(j.find("tbody"));
j.find("thead, tfoot").remove();j.append(h(a.nTHead).clone()).append(h(a.nTFoot).clone());j.find("tfoot th, tfoot td").css("width","");n=ra(a,j.find("thead")[0]);for(m=0;m<i.length;m++)o=c[i[m]],n[m].style.width=null!==o.sWidthOrig&&""!==o.sWidthOrig?v(o.sWidthOrig):"",o.sWidthOrig&&f&&h(n[m]).append(h("<div/>").css({width:o.sWidthOrig,margin:0,padding:0,border:0,height:1}));if(a.aoData.length)for(m=0;m<i.length;m++)t=i[m],o=c[t],h(Eb(a,t)).clone(!1).append(o.sContentPadding).appendTo(s);h("[name]",
j).removeAttr("name");o=h("<div/>").css(f||e?{position:"absolute",top:0,left:0,height:1,right:0,overflow:"hidden"}:{}).append(j).appendTo(k);f&&g?j.width(g):f?(j.css("width","auto"),j.removeAttr("width"),j.width()<k.clientWidth&&l&&j.width(k.clientWidth)):e?j.width(k.clientWidth):l&&j.width(l);for(m=e=0;m<i.length;m++)k=h(n[m]),g=k.outerWidth()-k.width(),k=p.bBounding?Math.ceil(n[m].getBoundingClientRect().width):k.outerWidth(),e+=k,c[i[m]].sWidth=v(k-g);b.style.width=v(e);o.remove()}l&&(b.style.width=
v(l));if((l||f)&&!a._reszEvt)b=function(){h(E).on("resize.DT-"+a.sInstance,Na(function(){Y(a)}))},d?setTimeout(b,1E3):b(),a._reszEvt=!0}function Db(a,b){if(!a)return 0;var c=h("<div/>").css("width",v(a)).appendTo(b||G.body),d=c[0].offsetWidth;c.remove();return d}function Eb(a,b){var c=Fb(a,b);if(0>c)return null;var d=a.aoData[c];return!d.nTr?h("<td/>").html(B(a,c,b,"display"))[0]:d.anCells[b]}function Fb(a,b){for(var c,d=-1,e=-1,f=0,g=a.aoData.length;f<g;f++)c=B(a,f,b,"display")+"",c=c.replace(Yb,
""),c=c.replace(/&nbsp;/g," "),c.length>d&&(d=c.length,e=f);return e}function v(a){return null===a?"0px":"number"==typeof a?0>a?"0px":a+"px":a.match(/\d$/)?a+"px":a}function V(a){var b,c,d=[],e=a.aoColumns,f,g,j,i;b=a.aaSortingFixed;c=h.isPlainObject(b);var n=[];f=function(a){a.length&&!h.isArray(a[0])?n.push(a):h.merge(n,a)};h.isArray(b)&&f(b);c&&b.pre&&f(b.pre);f(a.aaSorting);c&&b.post&&f(b.post);for(a=0;a<n.length;a++){i=n[a][0];f=e[i].aDataSort;b=0;for(c=f.length;b<c;b++)g=f[b],j=e[g].sType||
"string",n[a]._idx===k&&(n[a]._idx=h.inArray(n[a][1],e[g].asSorting)),d.push({src:i,col:g,dir:n[a][1],index:n[a]._idx,type:j,formatter:m.ext.type.order[j+"-pre"]})}return d}function lb(a){var b,c,d=[],e=m.ext.type.order,f=a.aoData,g=0,j,i=a.aiDisplayMaster,h;Fa(a);h=V(a);b=0;for(c=h.length;b<c;b++)j=h[b],j.formatter&&g++,Gb(a,j.col);if("ssp"!=y(a)&&0!==h.length){b=0;for(c=i.length;b<c;b++)d[i[b]]=b;g===h.length?i.sort(function(a,b){var c,e,g,j,i=h.length,k=f[a]._aSortData,m=f[b]._aSortData;for(g=
0;g<i;g++)if(j=h[g],c=k[j.col],e=m[j.col],c=c<e?-1:c>e?1:0,0!==c)return"asc"===j.dir?c:-c;c=d[a];e=d[b];return c<e?-1:c>e?1:0}):i.sort(function(a,b){var c,g,j,i,k=h.length,m=f[a]._aSortData,o=f[b]._aSortData;for(j=0;j<k;j++)if(i=h[j],c=m[i.col],g=o[i.col],i=e[i.type+"-"+i.dir]||e["string-"+i.dir],c=i(c,g),0!==c)return c;c=d[a];g=d[b];return c<g?-1:c>g?1:0})}a.bSorted=!0}function Hb(a){for(var b,c,d=a.aoColumns,e=V(a),a=a.oLanguage.oAria,f=0,g=d.length;f<g;f++){c=d[f];var j=c.asSorting;b=c.sTitle.replace(/<.*?>/g,
"");var i=c.nTh;i.removeAttribute("aria-sort");c.bSortable&&(0<e.length&&e[0].col==f?(i.setAttribute("aria-sort","asc"==e[0].dir?"ascending":"descending"),c=j[e[0].index+1]||j[0]):c=j[0],b+="asc"===c?a.sSortAscending:a.sSortDescending);i.setAttribute("aria-label",b)}}function Ua(a,b,c,d){var e=a.aaSorting,f=a.aoColumns[b].asSorting,g=function(a,b){var c=a._idx;c===k&&(c=h.inArray(a[1],f));return c+1<f.length?c+1:b?null:0};"number"===typeof e[0]&&(e=a.aaSorting=[e]);c&&a.oFeatures.bSortMulti?(c=h.inArray(b,
D(e,"0")),-1!==c?(b=g(e[c],!0),null===b&&1===e.length&&(b=0),null===b?e.splice(c,1):(e[c][1]=f[b],e[c]._idx=b)):(e.push([b,f[0],0]),e[e.length-1]._idx=0)):e.length&&e[0][0]==b?(b=g(e[0]),e.length=1,e[0][1]=f[b],e[0]._idx=b):(e.length=0,e.push([b,f[0]]),e[0]._idx=0);S(a);"function"==typeof d&&d(a)}function La(a,b,c,d){var e=a.aoColumns[c];Va(b,{},function(b){!1!==e.bSortable&&(a.oFeatures.bProcessing?(C(a,!0),setTimeout(function(){Ua(a,c,b.shiftKey,d);"ssp"!==y(a)&&C(a,!1)},0)):Ua(a,c,b.shiftKey,d))})}
function wa(a){var b=a.aLastSort,c=a.oClasses.sSortColumn,d=V(a),e=a.oFeatures,f,g;if(e.bSort&&e.bSortClasses){e=0;for(f=b.length;e<f;e++)g=b[e].src,h(D(a.aoData,"anCells",g)).removeClass(c+(2>e?e+1:3));e=0;for(f=d.length;e<f;e++)g=d[e].src,h(D(a.aoData,"anCells",g)).addClass(c+(2>e?e+1:3))}a.aLastSort=d}function Gb(a,b){var c=a.aoColumns[b],d=m.ext.order[c.sSortDataType],e;d&&(e=d.call(a.oInstance,a,b,$(a,b)));for(var f,g=m.ext.type.order[c.sType+"-pre"],j=0,i=a.aoData.length;j<i;j++)if(c=a.aoData[j],
c._aSortData||(c._aSortData=[]),!c._aSortData[b]||d)f=d?e[j]:B(a,j,b,"sort"),c._aSortData[b]=g?g(f):f}function xa(a){if(a.oFeatures.bStateSave&&!a.bDestroying){var b={time:+new Date,start:a._iDisplayStart,length:a._iDisplayLength,order:h.extend(!0,[],a.aaSorting),search:zb(a.oPreviousSearch),columns:h.map(a.aoColumns,function(b,d){return{visible:b.bVisible,search:zb(a.aoPreSearchCols[d])}})};r(a,"aoStateSaveParams","stateSaveParams",[a,b]);a.oSavedState=b;a.fnStateSaveCallback.call(a.oInstance,a,
b)}}function Ib(a,b,c){var d,e,f=a.aoColumns,b=function(b){if(b&&b.time){var g=r(a,"aoStateLoadParams","stateLoadParams",[a,b]);if(-1===h.inArray(!1,g)&&(g=a.iStateDuration,!(0<g&&b.time<+new Date-1E3*g)&&!(b.columns&&f.length!==b.columns.length))){a.oLoadedState=h.extend(!0,{},b);b.start!==k&&(a._iDisplayStart=b.start,a.iInitDisplayStart=b.start);b.length!==k&&(a._iDisplayLength=b.length);b.order!==k&&(a.aaSorting=[],h.each(b.order,function(b,c){a.aaSorting.push(c[0]>=f.length?[0,c[1]]:c)}));b.search!==
k&&h.extend(a.oPreviousSearch,Ab(b.search));if(b.columns){d=0;for(e=b.columns.length;d<e;d++)g=b.columns[d],g.visible!==k&&(f[d].bVisible=g.visible),g.search!==k&&h.extend(a.aoPreSearchCols[d],Ab(g.search))}r(a,"aoStateLoaded","stateLoaded",[a,b])}}c()};if(a.oFeatures.bStateSave){var g=a.fnStateLoadCallback.call(a.oInstance,a,b);g!==k&&b(g)}else c()}function ya(a){var b=m.settings,a=h.inArray(a,D(b,"nTable"));return-1!==a?b[a]:null}function J(a,b,c,d){c="DataTables warning: "+(a?"table id="+a.sTableId+
" - ":"")+c;d&&(c+=". For more information about this error, please see http://datatables.net/tn/"+d);if(b)E.console&&console.log&&console.log(c);else if(b=m.ext,b=b.sErrMode||b.errMode,a&&r(a,null,"error",[a,d,c]),"alert"==b)alert(c);else{if("throw"==b)throw Error(c);"function"==typeof b&&b(a,d,c)}}function F(a,b,c,d){h.isArray(c)?h.each(c,function(c,d){h.isArray(d)?F(a,b,d[0],d[1]):F(a,b,d)}):(d===k&&(d=c),b[c]!==k&&(a[d]=b[c]))}function Jb(a,b,c){var d,e;for(e in b)b.hasOwnProperty(e)&&(d=b[e],
h.isPlainObject(d)?(h.isPlainObject(a[e])||(a[e]={}),h.extend(!0,a[e],d)):a[e]=c&&"data"!==e&&"aaData"!==e&&h.isArray(d)?d.slice():d);return a}function Va(a,b,c){h(a).on("click.DT",b,function(b){a.blur();c(b)}).on("keypress.DT",b,function(a){13===a.which&&(a.preventDefault(),c(a))}).on("selectstart.DT",function(){return!1})}function z(a,b,c,d){c&&a[b].push({fn:c,sName:d})}function r(a,b,c,d){var e=[];b&&(e=h.map(a[b].slice().reverse(),function(b){return b.fn.apply(a.oInstance,d)}));null!==c&&(b=h.Event(c+
".dt"),h(a.nTable).trigger(b,d),e.push(b.result));return e}function Ra(a){var b=a._iDisplayStart,c=a.fnDisplayEnd(),d=a._iDisplayLength;b>=c&&(b=c-d);b-=b%d;if(-1===d||0>b)b=0;a._iDisplayStart=b}function Ma(a,b){var c=a.renderer,d=m.ext.renderer[b];return h.isPlainObject(c)&&c[b]?d[c[b]]||d._:"string"===typeof c?d[c]||d._:d._}function y(a){return a.oFeatures.bServerSide?"ssp":a.ajax||a.sAjaxSource?"ajax":"dom"}function ha(a,b){var c=[],c=Kb.numbers_length,d=Math.floor(c/2);b<=c?c=W(0,b):a<=d?(c=W(0,
c-2),c.push("ellipsis"),c.push(b-1)):(a>=b-1-d?c=W(b-(c-2),b):(c=W(a-d+2,a+d-1),c.push("ellipsis"),c.push(b-1)),c.splice(0,0,"ellipsis"),c.splice(0,0,0));c.DT_el="span";return c}function cb(a){h.each({num:function(b){return za(b,a)},"num-fmt":function(b){return za(b,a,Wa)},"html-num":function(b){return za(b,a,Aa)},"html-num-fmt":function(b){return za(b,a,Aa,Wa)}},function(b,c){x.type.order[b+a+"-pre"]=c;b.match(/^html\-/)&&(x.type.search[b+a]=x.type.search.html)})}function Lb(a){return function(){var b=
[ya(this[m.ext.iApiIndex])].concat(Array.prototype.slice.call(arguments));return m.ext.internal[a].apply(this,b)}}var m=function(a){this.$=function(a,b){return this.api(!0).$(a,b)};this._=function(a,b){return this.api(!0).rows(a,b).data()};this.api=function(a){return a?new s(ya(this[x.iApiIndex])):new s(this)};this.fnAddData=function(a,b){var c=this.api(!0),d=h.isArray(a)&&(h.isArray(a[0])||h.isPlainObject(a[0]))?c.rows.add(a):c.row.add(a);(b===k||b)&&c.draw();return d.flatten().toArray()};this.fnAdjustColumnSizing=
function(a){var b=this.api(!0).columns.adjust(),c=b.settings()[0],d=c.oScroll;a===k||a?b.draw(!1):(""!==d.sX||""!==d.sY)&&ka(c)};this.fnClearTable=function(a){var b=this.api(!0).clear();(a===k||a)&&b.draw()};this.fnClose=function(a){this.api(!0).row(a).child.hide()};this.fnDeleteRow=function(a,b,c){var d=this.api(!0),a=d.rows(a),e=a.settings()[0],h=e.aoData[a[0][0]];a.remove();b&&b.call(this,e,h);(c===k||c)&&d.draw();return h};this.fnDestroy=function(a){this.api(!0).destroy(a)};this.fnDraw=function(a){this.api(!0).draw(a)};
this.fnFilter=function(a,b,c,d,e,h){e=this.api(!0);null===b||b===k?e.search(a,c,d,h):e.column(b).search(a,c,d,h);e.draw()};this.fnGetData=function(a,b){var c=this.api(!0);if(a!==k){var d=a.nodeName?a.nodeName.toLowerCase():"";return b!==k||"td"==d||"th"==d?c.cell(a,b).data():c.row(a).data()||null}return c.data().toArray()};this.fnGetNodes=function(a){var b=this.api(!0);return a!==k?b.row(a).node():b.rows().nodes().flatten().toArray()};this.fnGetPosition=function(a){var b=this.api(!0),c=a.nodeName.toUpperCase();
return"TR"==c?b.row(a).index():"TD"==c||"TH"==c?(a=b.cell(a).index(),[a.row,a.columnVisible,a.column]):null};this.fnIsOpen=function(a){return this.api(!0).row(a).child.isShown()};this.fnOpen=function(a,b,c){return this.api(!0).row(a).child(b,c).show().child()[0]};this.fnPageChange=function(a,b){var c=this.api(!0).page(a);(b===k||b)&&c.draw(!1)};this.fnSetColumnVis=function(a,b,c){a=this.api(!0).column(a).visible(b);(c===k||c)&&a.columns.adjust().draw()};this.fnSettings=function(){return ya(this[x.iApiIndex])};
this.fnSort=function(a){this.api(!0).order(a).draw()};this.fnSortListener=function(a,b,c){this.api(!0).order.listener(a,b,c)};this.fnUpdate=function(a,b,c,d,e){var h=this.api(!0);c===k||null===c?h.row(b).data(a):h.cell(b,c).data(a);(e===k||e)&&h.columns.adjust();(d===k||d)&&h.draw();return 0};this.fnVersionCheck=x.fnVersionCheck;var b=this,c=a===k,d=this.length;c&&(a={});this.oApi=this.internal=x.internal;for(var e in m.ext.internal)e&&(this[e]=Lb(e));this.each(function(){var e={},g=1<d?Jb(e,a,!0):
a,j=0,i,e=this.getAttribute("id"),n=!1,l=m.defaults,q=h(this);if("table"!=this.nodeName.toLowerCase())J(null,0,"Non-table node initialisation ("+this.nodeName+")",2);else{db(l);eb(l.column);I(l,l,!0);I(l.column,l.column,!0);I(l,h.extend(g,q.data()));var t=m.settings,j=0;for(i=t.length;j<i;j++){var o=t[j];if(o.nTable==this||o.nTHead.parentNode==this||o.nTFoot&&o.nTFoot.parentNode==this){var s=g.bRetrieve!==k?g.bRetrieve:l.bRetrieve;if(c||s)return o.oInstance;if(g.bDestroy!==k?g.bDestroy:l.bDestroy){o.oInstance.fnDestroy();
break}else{J(o,0,"Cannot reinitialise DataTable",3);return}}if(o.sTableId==this.id){t.splice(j,1);break}}if(null===e||""===e)this.id=e="DataTables_Table_"+m.ext._unique++;var p=h.extend(!0,{},m.models.oSettings,{sDestroyWidth:q[0].style.width,sInstance:e,sTableId:e});p.nTable=this;p.oApi=b.internal;p.oInit=g;t.push(p);p.oInstance=1===b.length?b:q.dataTable();db(g);g.oLanguage&&Ca(g.oLanguage);g.aLengthMenu&&!g.iDisplayLength&&(g.iDisplayLength=h.isArray(g.aLengthMenu[0])?g.aLengthMenu[0][0]:g.aLengthMenu[0]);
g=Jb(h.extend(!0,{},l),g);F(p.oFeatures,g,"bPaginate bLengthChange bFilter bSort bSortMulti bInfo bProcessing bAutoWidth bSortClasses bServerSide bDeferRender".split(" "));F(p,g,["asStripeClasses","ajax","fnServerData","fnFormatNumber","sServerMethod","aaSorting","aaSortingFixed","aLengthMenu","sPaginationType","sAjaxSource","sAjaxDataProp","iStateDuration","sDom","bSortCellsTop","iTabIndex","fnStateLoadCallback","fnStateSaveCallback","renderer","searchDelay","rowId",["iCookieDuration","iStateDuration"],
["oSearch","oPreviousSearch"],["aoSearchCols","aoPreSearchCols"],["iDisplayLength","_iDisplayLength"]]);F(p.oScroll,g,[["sScrollX","sX"],["sScrollXInner","sXInner"],["sScrollY","sY"],["bScrollCollapse","bCollapse"]]);F(p.oLanguage,g,"fnInfoCallback");z(p,"aoDrawCallback",g.fnDrawCallback,"user");z(p,"aoServerParams",g.fnServerParams,"user");z(p,"aoStateSaveParams",g.fnStateSaveParams,"user");z(p,"aoStateLoadParams",g.fnStateLoadParams,"user");z(p,"aoStateLoaded",g.fnStateLoaded,"user");z(p,"aoRowCallback",
g.fnRowCallback,"user");z(p,"aoRowCreatedCallback",g.fnCreatedRow,"user");z(p,"aoHeaderCallback",g.fnHeaderCallback,"user");z(p,"aoFooterCallback",g.fnFooterCallback,"user");z(p,"aoInitComplete",g.fnInitComplete,"user");z(p,"aoPreDrawCallback",g.fnPreDrawCallback,"user");p.rowIdFn=Q(g.rowId);fb(p);var u=p.oClasses;h.extend(u,m.ext.classes,g.oClasses);q.addClass(u.sTable);p.iInitDisplayStart===k&&(p.iInitDisplayStart=g.iDisplayStart,p._iDisplayStart=g.iDisplayStart);null!==g.iDeferLoading&&(p.bDeferLoading=
!0,e=h.isArray(g.iDeferLoading),p._iRecordsDisplay=e?g.iDeferLoading[0]:g.iDeferLoading,p._iRecordsTotal=e?g.iDeferLoading[1]:g.iDeferLoading);var v=p.oLanguage;h.extend(!0,v,g.oLanguage);v.sUrl&&(h.ajax({dataType:"json",url:v.sUrl,success:function(a){Ca(a);I(l.oLanguage,a);h.extend(true,v,a);ga(p)},error:function(){ga(p)}}),n=!0);null===g.asStripeClasses&&(p.asStripeClasses=[u.sStripeOdd,u.sStripeEven]);var e=p.asStripeClasses,x=q.children("tbody").find("tr").eq(0);-1!==h.inArray(!0,h.map(e,function(a){return x.hasClass(a)}))&&
(h("tbody tr",this).removeClass(e.join(" ")),p.asDestroyStripes=e.slice());e=[];t=this.getElementsByTagName("thead");0!==t.length&&(da(p.aoHeader,t[0]),e=ra(p));if(null===g.aoColumns){t=[];j=0;for(i=e.length;j<i;j++)t.push(null)}else t=g.aoColumns;j=0;for(i=t.length;j<i;j++)Da(p,e?e[j]:null);hb(p,g.aoColumnDefs,t,function(a,b){ja(p,a,b)});if(x.length){var w=function(a,b){return a.getAttribute("data-"+b)!==null?b:null};h(x[0]).children("th, td").each(function(a,b){var c=p.aoColumns[a];if(c.mData===
a){var d=w(b,"sort")||w(b,"order"),e=w(b,"filter")||w(b,"search");if(d!==null||e!==null){c.mData={_:a+".display",sort:d!==null?a+".@data-"+d:k,type:d!==null?a+".@data-"+d:k,filter:e!==null?a+".@data-"+e:k};ja(p,a)}}})}var T=p.oFeatures,e=function(){if(g.aaSorting===k){var a=p.aaSorting;j=0;for(i=a.length;j<i;j++)a[j][1]=p.aoColumns[j].asSorting[0]}wa(p);T.bSort&&z(p,"aoDrawCallback",function(){if(p.bSorted){var a=V(p),b={};h.each(a,function(a,c){b[c.src]=c.dir});r(p,null,"order",[p,a,b]);Hb(p)}});
z(p,"aoDrawCallback",function(){(p.bSorted||y(p)==="ssp"||T.bDeferRender)&&wa(p)},"sc");var a=q.children("caption").each(function(){this._captionSide=h(this).css("caption-side")}),b=q.children("thead");b.length===0&&(b=h("<thead/>").appendTo(q));p.nTHead=b[0];b=q.children("tbody");b.length===0&&(b=h("<tbody/>").appendTo(q));p.nTBody=b[0];b=q.children("tfoot");if(b.length===0&&a.length>0&&(p.oScroll.sX!==""||p.oScroll.sY!==""))b=h("<tfoot/>").appendTo(q);if(b.length===0||b.children().length===0)q.addClass(u.sNoFooter);
else if(b.length>0){p.nTFoot=b[0];da(p.aoFooter,p.nTFoot)}if(g.aaData)for(j=0;j<g.aaData.length;j++)M(p,g.aaData[j]);else(p.bDeferLoading||y(p)=="dom")&&ma(p,h(p.nTBody).children("tr"));p.aiDisplay=p.aiDisplayMaster.slice();p.bInitialised=true;n===false&&ga(p)};g.bStateSave?(T.bStateSave=!0,z(p,"aoDrawCallback",xa,"state_save"),Ib(p,g,e)):e()}});b=null;return this},x,s,o,u,Xa={},Mb=/[\r\n]/g,Aa=/<.*?>/g,Zb=/^\d{2,4}[\.\/\-]\d{1,2}[\.\/\-]\d{1,2}([T ]{1}\d{1,2}[:\.]\d{2}([\.:]\d{2})?)?$/,$b=RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\|\\$|\\^|\\-)",
"g"),Wa=/[',$£€¥%\u2009\u202F\u20BD\u20a9\u20BArfk]/gi,L=function(a){return!a||!0===a||"-"===a?!0:!1},Nb=function(a){var b=parseInt(a,10);return!isNaN(b)&&isFinite(a)?b:null},Ob=function(a,b){Xa[b]||(Xa[b]=RegExp(Pa(b),"g"));return"string"===typeof a&&"."!==b?a.replace(/\./g,"").replace(Xa[b],"."):a},Ya=function(a,b,c){var d="string"===typeof a;if(L(a))return!0;b&&d&&(a=Ob(a,b));c&&d&&(a=a.replace(Wa,""));return!isNaN(parseFloat(a))&&isFinite(a)},Pb=function(a,b,c){return L(a)?!0:!(L(a)||"string"===
typeof a)?null:Ya(a.replace(Aa,""),b,c)?!0:null},D=function(a,b,c){var d=[],e=0,f=a.length;if(c!==k)for(;e<f;e++)a[e]&&a[e][b]&&d.push(a[e][b][c]);else for(;e<f;e++)a[e]&&d.push(a[e][b]);return d},ia=function(a,b,c,d){var e=[],f=0,g=b.length;if(d!==k)for(;f<g;f++)a[b[f]][c]&&e.push(a[b[f]][c][d]);else for(;f<g;f++)e.push(a[b[f]][c]);return e},W=function(a,b){var c=[],d;b===k?(b=0,d=a):(d=b,b=a);for(var e=b;e<d;e++)c.push(e);return c},Qb=function(a){for(var b=[],c=0,d=a.length;c<d;c++)a[c]&&b.push(a[c]);
return b},qa=function(a){var b;a:{if(!(2>a.length)){b=a.slice().sort();for(var c=b[0],d=1,e=b.length;d<e;d++){if(b[d]===c){b=!1;break a}c=b[d]}}b=!0}if(b)return a.slice();b=[];var e=a.length,f,g=0,d=0;a:for(;d<e;d++){c=a[d];for(f=0;f<g;f++)if(b[f]===c)continue a;b.push(c);g++}return b};m.util={throttle:function(a,b){var c=b!==k?b:200,d,e;return function(){var b=this,g=+new Date,j=arguments;d&&g<d+c?(clearTimeout(e),e=setTimeout(function(){d=k;a.apply(b,j)},c)):(d=g,a.apply(b,j))}},escapeRegex:function(a){return a.replace($b,
"\\$1")}};var A=function(a,b,c){a[b]!==k&&(a[c]=a[b])},ba=/\[.*?\]$/,U=/\(\)$/,Pa=m.util.escapeRegex,va=h("<div>")[0],Wb=va.textContent!==k,Yb=/<.*?>/g,Na=m.util.throttle,Rb=[],w=Array.prototype,ac=function(a){var b,c,d=m.settings,e=h.map(d,function(a){return a.nTable});if(a){if(a.nTable&&a.oApi)return[a];if(a.nodeName&&"table"===a.nodeName.toLowerCase())return b=h.inArray(a,e),-1!==b?[d[b]]:null;if(a&&"function"===typeof a.settings)return a.settings().toArray();"string"===typeof a?c=h(a):a instanceof
h&&(c=a)}else return[];if(c)return c.map(function(){b=h.inArray(this,e);return-1!==b?d[b]:null}).toArray()};s=function(a,b){if(!(this instanceof s))return new s(a,b);var c=[],d=function(a){(a=ac(a))&&(c=c.concat(a))};if(h.isArray(a))for(var e=0,f=a.length;e<f;e++)d(a[e]);else d(a);this.context=qa(c);b&&h.merge(this,b);this.selector={rows:null,cols:null,opts:null};s.extend(this,this,Rb)};m.Api=s;h.extend(s.prototype,{any:function(){return 0!==this.count()},concat:w.concat,context:[],count:function(){return this.flatten().length},
each:function(a){for(var b=0,c=this.length;b<c;b++)a.call(this,this[b],b,this);return this},eq:function(a){var b=this.context;return b.length>a?new s(b[a],this[a]):null},filter:function(a){var b=[];if(w.filter)b=w.filter.call(this,a,this);else for(var c=0,d=this.length;c<d;c++)a.call(this,this[c],c,this)&&b.push(this[c]);return new s(this.context,b)},flatten:function(){var a=[];return new s(this.context,a.concat.apply(a,this.toArray()))},join:w.join,indexOf:w.indexOf||function(a,b){for(var c=b||0,
d=this.length;c<d;c++)if(this[c]===a)return c;return-1},iterator:function(a,b,c,d){var e=[],f,g,j,h,n,l=this.context,m,o,u=this.selector;"string"===typeof a&&(d=c,c=b,b=a,a=!1);g=0;for(j=l.length;g<j;g++){var r=new s(l[g]);if("table"===b)f=c.call(r,l[g],g),f!==k&&e.push(f);else if("columns"===b||"rows"===b)f=c.call(r,l[g],this[g],g),f!==k&&e.push(f);else if("column"===b||"column-rows"===b||"row"===b||"cell"===b){o=this[g];"column-rows"===b&&(m=Ba(l[g],u.opts));h=0;for(n=o.length;h<n;h++)f=o[h],f=
"cell"===b?c.call(r,l[g],f.row,f.column,g,h):c.call(r,l[g],f,g,h,m),f!==k&&e.push(f)}}return e.length||d?(a=new s(l,a?e.concat.apply([],e):e),b=a.selector,b.rows=u.rows,b.cols=u.cols,b.opts=u.opts,a):this},lastIndexOf:w.lastIndexOf||function(a,b){return this.indexOf.apply(this.toArray.reverse(),arguments)},length:0,map:function(a){var b=[];if(w.map)b=w.map.call(this,a,this);else for(var c=0,d=this.length;c<d;c++)b.push(a.call(this,this[c],c));return new s(this.context,b)},pluck:function(a){return this.map(function(b){return b[a]})},
pop:w.pop,push:w.push,reduce:w.reduce||function(a,b){return gb(this,a,b,0,this.length,1)},reduceRight:w.reduceRight||function(a,b){return gb(this,a,b,this.length-1,-1,-1)},reverse:w.reverse,selector:null,shift:w.shift,slice:function(){return new s(this.context,this)},sort:w.sort,splice:w.splice,toArray:function(){return w.slice.call(this)},to$:function(){return h(this)},toJQuery:function(){return h(this)},unique:function(){return new s(this.context,qa(this))},unshift:w.unshift});s.extend=function(a,
b,c){if(c.length&&b&&(b instanceof s||b.__dt_wrapper)){var d,e,f,g=function(a,b,c){return function(){var d=b.apply(a,arguments);s.extend(d,d,c.methodExt);return d}};d=0;for(e=c.length;d<e;d++)f=c[d],b[f.name]="function"===typeof f.val?g(a,f.val,f):h.isPlainObject(f.val)?{}:f.val,b[f.name].__dt_wrapper=!0,s.extend(a,b[f.name],f.propExt)}};s.register=o=function(a,b){if(h.isArray(a))for(var c=0,d=a.length;c<d;c++)s.register(a[c],b);else for(var e=a.split("."),f=Rb,g,j,c=0,d=e.length;c<d;c++){g=(j=-1!==
e[c].indexOf("()"))?e[c].replace("()",""):e[c];var i;a:{i=0;for(var n=f.length;i<n;i++)if(f[i].name===g){i=f[i];break a}i=null}i||(i={name:g,val:{},methodExt:[],propExt:[]},f.push(i));c===d-1?i.val=b:f=j?i.methodExt:i.propExt}};s.registerPlural=u=function(a,b,c){s.register(a,c);s.register(b,function(){var a=c.apply(this,arguments);return a===this?this:a instanceof s?a.length?h.isArray(a[0])?new s(a.context,a[0]):a[0]:k:a})};o("tables()",function(a){var b;if(a){b=s;var c=this.context;if("number"===
typeof a)a=[c[a]];else var d=h.map(c,function(a){return a.nTable}),a=h(d).filter(a).map(function(){var a=h.inArray(this,d);return c[a]}).toArray();b=new b(a)}else b=this;return b});o("table()",function(a){var a=this.tables(a),b=a.context;return b.length?new s(b[0]):a});u("tables().nodes()","table().node()",function(){return this.iterator("table",function(a){return a.nTable},1)});u("tables().body()","table().body()",function(){return this.iterator("table",function(a){return a.nTBody},1)});u("tables().header()",
"table().header()",function(){return this.iterator("table",function(a){return a.nTHead},1)});u("tables().footer()","table().footer()",function(){return this.iterator("table",function(a){return a.nTFoot},1)});u("tables().containers()","table().container()",function(){return this.iterator("table",function(a){return a.nTableWrapper},1)});o("draw()",function(a){return this.iterator("table",function(b){"page"===a?N(b):("string"===typeof a&&(a="full-hold"===a?!1:!0),S(b,!1===a))})});o("page()",function(a){return a===
k?this.page.info().page:this.iterator("table",function(b){Sa(b,a)})});o("page.info()",function(){if(0===this.context.length)return k;var a=this.context[0],b=a._iDisplayStart,c=a.oFeatures.bPaginate?a._iDisplayLength:-1,d=a.fnRecordsDisplay(),e=-1===c;return{page:e?0:Math.floor(b/c),pages:e?1:Math.ceil(d/c),start:b,end:a.fnDisplayEnd(),length:c,recordsTotal:a.fnRecordsTotal(),recordsDisplay:d,serverSide:"ssp"===y(a)}});o("page.len()",function(a){return a===k?0!==this.context.length?this.context[0]._iDisplayLength:
k:this.iterator("table",function(b){Qa(b,a)})});var Sb=function(a,b,c){if(c){var d=new s(a);d.one("draw",function(){c(d.ajax.json())})}if("ssp"==y(a))S(a,b);else{C(a,!0);var e=a.jqXHR;e&&4!==e.readyState&&e.abort();sa(a,[],function(c){na(a);for(var c=ta(a,c),d=0,e=c.length;d<e;d++)M(a,c[d]);S(a,b);C(a,!1)})}};o("ajax.json()",function(){var a=this.context;if(0<a.length)return a[0].json});o("ajax.params()",function(){var a=this.context;if(0<a.length)return a[0].oAjaxData});o("ajax.reload()",function(a,
b){return this.iterator("table",function(c){Sb(c,!1===b,a)})});o("ajax.url()",function(a){var b=this.context;if(a===k){if(0===b.length)return k;b=b[0];return b.ajax?h.isPlainObject(b.ajax)?b.ajax.url:b.ajax:b.sAjaxSource}return this.iterator("table",function(b){h.isPlainObject(b.ajax)?b.ajax.url=a:b.ajax=a})});o("ajax.url().load()",function(a,b){return this.iterator("table",function(c){Sb(c,!1===b,a)})});var Za=function(a,b,c,d,e){var f=[],g,j,i,n,l,m;i=typeof b;if(!b||"string"===i||"function"===
i||b.length===k)b=[b];i=0;for(n=b.length;i<n;i++){j=b[i]&&b[i].split&&!b[i].match(/[\[\(:]/)?b[i].split(","):[b[i]];l=0;for(m=j.length;l<m;l++)(g=c("string"===typeof j[l]?h.trim(j[l]):j[l]))&&g.length&&(f=f.concat(g))}a=x.selector[a];if(a.length){i=0;for(n=a.length;i<n;i++)f=a[i](d,e,f)}return qa(f)},$a=function(a){a||(a={});a.filter&&a.search===k&&(a.search=a.filter);return h.extend({search:"none",order:"current",page:"all"},a)},ab=function(a){for(var b=0,c=a.length;b<c;b++)if(0<a[b].length)return a[0]=
a[b],a[0].length=1,a.length=1,a.context=[a.context[b]],a;a.length=0;return a},Ba=function(a,b){var c,d,e,f=[],g=a.aiDisplay;c=a.aiDisplayMaster;var j=b.search;d=b.order;e=b.page;if("ssp"==y(a))return"removed"===j?[]:W(0,c.length);if("current"==e){c=a._iDisplayStart;for(d=a.fnDisplayEnd();c<d;c++)f.push(g[c])}else if("current"==d||"applied"==d)f="none"==j?c.slice():"applied"==j?g.slice():h.map(c,function(a){return-1===h.inArray(a,g)?a:null});else if("index"==d||"original"==d){c=0;for(d=a.aoData.length;c<
d;c++)"none"==j?f.push(c):(e=h.inArray(c,g),(-1===e&&"removed"==j||0<=e&&"applied"==j)&&f.push(c))}return f};o("rows()",function(a,b){a===k?a="":h.isPlainObject(a)&&(b=a,a="");var b=$a(b),c=this.iterator("table",function(c){var e=b,f;return Za("row",a,function(a){var b=Nb(a);if(b!==null&&!e)return[b];f||(f=Ba(c,e));if(b!==null&&h.inArray(b,f)!==-1)return[b];if(a===null||a===k||a==="")return f;if(typeof a==="function")return h.map(f,function(b){var e=c.aoData[b];return a(b,e._aData,e.nTr)?b:null});
b=Qb(ia(c.aoData,f,"nTr"));if(a.nodeName){if(a._DT_RowIndex!==k)return[a._DT_RowIndex];if(a._DT_CellIndex)return[a._DT_CellIndex.row];b=h(a).closest("*[data-dt-row]");return b.length?[b.data("dt-row")]:[]}if(typeof a==="string"&&a.charAt(0)==="#"){var i=c.aIds[a.replace(/^#/,"")];if(i!==k)return[i.idx]}return h(b).filter(a).map(function(){return this._DT_RowIndex}).toArray()},c,e)},1);c.selector.rows=a;c.selector.opts=b;return c});o("rows().nodes()",function(){return this.iterator("row",function(a,
b){return a.aoData[b].nTr||k},1)});o("rows().data()",function(){return this.iterator(!0,"rows",function(a,b){return ia(a.aoData,b,"_aData")},1)});u("rows().cache()","row().cache()",function(a){return this.iterator("row",function(b,c){var d=b.aoData[c];return"search"===a?d._aFilterData:d._aSortData},1)});u("rows().invalidate()","row().invalidate()",function(a){return this.iterator("row",function(b,c){ca(b,c,a)})});u("rows().indexes()","row().index()",function(){return this.iterator("row",function(a,
b){return b},1)});u("rows().ids()","row().id()",function(a){for(var b=[],c=this.context,d=0,e=c.length;d<e;d++)for(var f=0,g=this[d].length;f<g;f++){var h=c[d].rowIdFn(c[d].aoData[this[d][f]]._aData);b.push((!0===a?"#":"")+h)}return new s(c,b)});u("rows().remove()","row().remove()",function(){var a=this;this.iterator("row",function(b,c,d){var e=b.aoData,f=e[c],g,h,i,n,l;e.splice(c,1);g=0;for(h=e.length;g<h;g++)if(i=e[g],l=i.anCells,null!==i.nTr&&(i.nTr._DT_RowIndex=g),null!==l){i=0;for(n=l.length;i<
n;i++)l[i]._DT_CellIndex.row=g}oa(b.aiDisplayMaster,c);oa(b.aiDisplay,c);oa(a[d],c,!1);0<b._iRecordsDisplay&&b._iRecordsDisplay--;Ra(b);c=b.rowIdFn(f._aData);c!==k&&delete b.aIds[c]});this.iterator("table",function(a){for(var c=0,d=a.aoData.length;c<d;c++)a.aoData[c].idx=c});return this});o("rows.add()",function(a){var b=this.iterator("table",function(b){var c,f,g,h=[];f=0;for(g=a.length;f<g;f++)c=a[f],c.nodeName&&"TR"===c.nodeName.toUpperCase()?h.push(ma(b,c)[0]):h.push(M(b,c));return h},1),c=this.rows(-1);
c.pop();h.merge(c,b);return c});o("row()",function(a,b){return ab(this.rows(a,b))});o("row().data()",function(a){var b=this.context;if(a===k)return b.length&&this.length?b[0].aoData[this[0]]._aData:k;b[0].aoData[this[0]]._aData=a;ca(b[0],this[0],"data");return this});o("row().node()",function(){var a=this.context;return a.length&&this.length?a[0].aoData[this[0]].nTr||null:null});o("row.add()",function(a){a instanceof h&&a.length&&(a=a[0]);var b=this.iterator("table",function(b){return a.nodeName&&
"TR"===a.nodeName.toUpperCase()?ma(b,a)[0]:M(b,a)});return this.row(b[0])});var bb=function(a,b){var c=a.context;if(c.length&&(c=c[0].aoData[b!==k?b:a[0]])&&c._details)c._details.remove(),c._detailsShow=k,c._details=k},Tb=function(a,b){var c=a.context;if(c.length&&a.length){var d=c[0].aoData[a[0]];if(d._details){(d._detailsShow=b)?d._details.insertAfter(d.nTr):d._details.detach();var e=c[0],f=new s(e),g=e.aoData;f.off("draw.dt.DT_details column-visibility.dt.DT_details destroy.dt.DT_details");0<D(g,
"_details").length&&(f.on("draw.dt.DT_details",function(a,b){e===b&&f.rows({page:"current"}).eq(0).each(function(a){a=g[a];a._detailsShow&&a._details.insertAfter(a.nTr)})}),f.on("column-visibility.dt.DT_details",function(a,b){if(e===b)for(var c,d=aa(b),f=0,h=g.length;f<h;f++)c=g[f],c._details&&c._details.children("td[colspan]").attr("colspan",d)}),f.on("destroy.dt.DT_details",function(a,b){if(e===b)for(var c=0,d=g.length;c<d;c++)g[c]._details&&bb(f,c)}))}}};o("row().child()",function(a,b){var c=this.context;
if(a===k)return c.length&&this.length?c[0].aoData[this[0]]._details:k;if(!0===a)this.child.show();else if(!1===a)bb(this);else if(c.length&&this.length){var d=c[0],c=c[0].aoData[this[0]],e=[],f=function(a,b){if(h.isArray(a)||a instanceof h)for(var c=0,k=a.length;c<k;c++)f(a[c],b);else a.nodeName&&"tr"===a.nodeName.toLowerCase()?e.push(a):(c=h("<tr><td/></tr>").addClass(b),h("td",c).addClass(b).html(a)[0].colSpan=aa(d),e.push(c[0]))};f(a,b);c._details&&c._details.detach();c._details=h(e);c._detailsShow&&
c._details.insertAfter(c.nTr)}return this});o(["row().child.show()","row().child().show()"],function(){Tb(this,!0);return this});o(["row().child.hide()","row().child().hide()"],function(){Tb(this,!1);return this});o(["row().child.remove()","row().child().remove()"],function(){bb(this);return this});o("row().child.isShown()",function(){var a=this.context;return a.length&&this.length?a[0].aoData[this[0]]._detailsShow||!1:!1});var bc=/^([^:]+):(name|visIdx|visible)$/,Ub=function(a,b,c,d,e){for(var c=
[],d=0,f=e.length;d<f;d++)c.push(B(a,e[d],b));return c};o("columns()",function(a,b){a===k?a="":h.isPlainObject(a)&&(b=a,a="");var b=$a(b),c=this.iterator("table",function(c){var e=a,f=b,g=c.aoColumns,j=D(g,"sName"),i=D(g,"nTh");return Za("column",e,function(a){var b=Nb(a);if(a==="")return W(g.length);if(b!==null)return[b>=0?b:g.length+b];if(typeof a==="function"){var e=Ba(c,f);return h.map(g,function(b,f){return a(f,Ub(c,f,0,0,e),i[f])?f:null})}var k=typeof a==="string"?a.match(bc):"";if(k)switch(k[2]){case "visIdx":case "visible":b=
parseInt(k[1],10);if(b<0){var m=h.map(g,function(a,b){return a.bVisible?b:null});return[m[m.length+b]]}return[Z(c,b)];case "name":return h.map(j,function(a,b){return a===k[1]?b:null});default:return[]}if(a.nodeName&&a._DT_CellIndex)return[a._DT_CellIndex.column];b=h(i).filter(a).map(function(){return h.inArray(this,i)}).toArray();if(b.length||!a.nodeName)return b;b=h(a).closest("*[data-dt-column]");return b.length?[b.data("dt-column")]:[]},c,f)},1);c.selector.cols=a;c.selector.opts=b;return c});u("columns().header()",
"column().header()",function(){return this.iterator("column",function(a,b){return a.aoColumns[b].nTh},1)});u("columns().footer()","column().footer()",function(){return this.iterator("column",function(a,b){return a.aoColumns[b].nTf},1)});u("columns().data()","column().data()",function(){return this.iterator("column-rows",Ub,1)});u("columns().dataSrc()","column().dataSrc()",function(){return this.iterator("column",function(a,b){return a.aoColumns[b].mData},1)});u("columns().cache()","column().cache()",
function(a){return this.iterator("column-rows",function(b,c,d,e,f){return ia(b.aoData,f,"search"===a?"_aFilterData":"_aSortData",c)},1)});u("columns().nodes()","column().nodes()",function(){return this.iterator("column-rows",function(a,b,c,d,e){return ia(a.aoData,e,"anCells",b)},1)});u("columns().visible()","column().visible()",function(a,b){var c=this.iterator("column",function(b,c){if(a===k)return b.aoColumns[c].bVisible;var f=b.aoColumns,g=f[c],j=b.aoData,i,n,l;if(a!==k&&g.bVisible!==a){if(a){var m=
h.inArray(!0,D(f,"bVisible"),c+1);i=0;for(n=j.length;i<n;i++)l=j[i].nTr,f=j[i].anCells,l&&l.insertBefore(f[c],f[m]||null)}else h(D(b.aoData,"anCells",c)).detach();g.bVisible=a;ea(b,b.aoHeader);ea(b,b.aoFooter);xa(b)}});a!==k&&(this.iterator("column",function(c,e){r(c,null,"column-visibility",[c,e,a,b])}),(b===k||b)&&this.columns.adjust());return c});u("columns().indexes()","column().index()",function(a){return this.iterator("column",function(b,c){return"visible"===a?$(b,c):c},1)});o("columns.adjust()",
function(){return this.iterator("table",function(a){Y(a)},1)});o("column.index()",function(a,b){if(0!==this.context.length){var c=this.context[0];if("fromVisible"===a||"toData"===a)return Z(c,b);if("fromData"===a||"toVisible"===a)return $(c,b)}});o("column()",function(a,b){return ab(this.columns(a,b))});o("cells()",function(a,b,c){h.isPlainObject(a)&&(a.row===k?(c=a,a=null):(c=b,b=null));h.isPlainObject(b)&&(c=b,b=null);if(null===b||b===k)return this.iterator("table",function(b){var d=a,e=$a(c),f=
b.aoData,g=Ba(b,e),j=Qb(ia(f,g,"anCells")),i=h([].concat.apply([],j)),l,n=b.aoColumns.length,m,o,u,s,r,v;return Za("cell",d,function(a){var c=typeof a==="function";if(a===null||a===k||c){m=[];o=0;for(u=g.length;o<u;o++){l=g[o];for(s=0;s<n;s++){r={row:l,column:s};if(c){v=f[l];a(r,B(b,l,s),v.anCells?v.anCells[s]:null)&&m.push(r)}else m.push(r)}}return m}if(h.isPlainObject(a))return[a];c=i.filter(a).map(function(a,b){return{row:b._DT_CellIndex.row,column:b._DT_CellIndex.column}}).toArray();if(c.length||
!a.nodeName)return c;v=h(a).closest("*[data-dt-row]");return v.length?[{row:v.data("dt-row"),column:v.data("dt-column")}]:[]},b,e)});var d=this.columns(b,c),e=this.rows(a,c),f,g,j,i,n,l=this.iterator("table",function(a,b){f=[];g=0;for(j=e[b].length;g<j;g++){i=0;for(n=d[b].length;i<n;i++)f.push({row:e[b][g],column:d[b][i]})}return f},1);h.extend(l.selector,{cols:b,rows:a,opts:c});return l});u("cells().nodes()","cell().node()",function(){return this.iterator("cell",function(a,b,c){return(a=a.aoData[b])&&
a.anCells?a.anCells[c]:k},1)});o("cells().data()",function(){return this.iterator("cell",function(a,b,c){return B(a,b,c)},1)});u("cells().cache()","cell().cache()",function(a){a="search"===a?"_aFilterData":"_aSortData";return this.iterator("cell",function(b,c,d){return b.aoData[c][a][d]},1)});u("cells().render()","cell().render()",function(a){return this.iterator("cell",function(b,c,d){return B(b,c,d,a)},1)});u("cells().indexes()","cell().index()",function(){return this.iterator("cell",function(a,
b,c){return{row:b,column:c,columnVisible:$(a,c)}},1)});u("cells().invalidate()","cell().invalidate()",function(a){return this.iterator("cell",function(b,c,d){ca(b,c,a,d)})});o("cell()",function(a,b,c){return ab(this.cells(a,b,c))});o("cell().data()",function(a){var b=this.context,c=this[0];if(a===k)return b.length&&c.length?B(b[0],c[0].row,c[0].column):k;ib(b[0],c[0].row,c[0].column,a);ca(b[0],c[0].row,"data",c[0].column);return this});o("order()",function(a,b){var c=this.context;if(a===k)return 0!==
c.length?c[0].aaSorting:k;"number"===typeof a?a=[[a,b]]:a.length&&!h.isArray(a[0])&&(a=Array.prototype.slice.call(arguments));return this.iterator("table",function(b){b.aaSorting=a.slice()})});o("order.listener()",function(a,b,c){return this.iterator("table",function(d){La(d,a,b,c)})});o("order.fixed()",function(a){if(!a){var b=this.context,b=b.length?b[0].aaSortingFixed:k;return h.isArray(b)?{pre:b}:b}return this.iterator("table",function(b){b.aaSortingFixed=h.extend(!0,{},a)})});o(["columns().order()",
"column().order()"],function(a){var b=this;return this.iterator("table",function(c,d){var e=[];h.each(b[d],function(b,c){e.push([c,a])});c.aaSorting=e})});o("search()",function(a,b,c,d){var e=this.context;return a===k?0!==e.length?e[0].oPreviousSearch.sSearch:k:this.iterator("table",function(e){e.oFeatures.bFilter&&fa(e,h.extend({},e.oPreviousSearch,{sSearch:a+"",bRegex:null===b?!1:b,bSmart:null===c?!0:c,bCaseInsensitive:null===d?!0:d}),1)})});u("columns().search()","column().search()",function(a,
b,c,d){return this.iterator("column",function(e,f){var g=e.aoPreSearchCols;if(a===k)return g[f].sSearch;e.oFeatures.bFilter&&(h.extend(g[f],{sSearch:a+"",bRegex:null===b?!1:b,bSmart:null===c?!0:c,bCaseInsensitive:null===d?!0:d}),fa(e,e.oPreviousSearch,1))})});o("state()",function(){return this.context.length?this.context[0].oSavedState:null});o("state.clear()",function(){return this.iterator("table",function(a){a.fnStateSaveCallback.call(a.oInstance,a,{})})});o("state.loaded()",function(){return this.context.length?
this.context[0].oLoadedState:null});o("state.save()",function(){return this.iterator("table",function(a){xa(a)})});m.versionCheck=m.fnVersionCheck=function(a){for(var b=m.version.split("."),a=a.split("."),c,d,e=0,f=a.length;e<f;e++)if(c=parseInt(b[e],10)||0,d=parseInt(a[e],10)||0,c!==d)return c>d;return!0};m.isDataTable=m.fnIsDataTable=function(a){var b=h(a).get(0),c=!1;if(a instanceof m.Api)return!0;h.each(m.settings,function(a,e){var f=e.nScrollHead?h("table",e.nScrollHead)[0]:null,g=e.nScrollFoot?
h("table",e.nScrollFoot)[0]:null;if(e.nTable===b||f===b||g===b)c=!0});return c};m.tables=m.fnTables=function(a){var b=!1;h.isPlainObject(a)&&(b=a.api,a=a.visible);var c=h.map(m.settings,function(b){if(!a||a&&h(b.nTable).is(":visible"))return b.nTable});return b?new s(c):c};m.camelToHungarian=I;o("$()",function(a,b){var c=this.rows(b).nodes(),c=h(c);return h([].concat(c.filter(a).toArray(),c.find(a).toArray()))});h.each(["on","one","off"],function(a,b){o(b+"()",function(){var a=Array.prototype.slice.call(arguments);
a[0]=h.map(a[0].split(/\s/),function(a){return!a.match(/\.dt\b/)?a+".dt":a}).join(" ");var d=h(this.tables().nodes());d[b].apply(d,a);return this})});o("clear()",function(){return this.iterator("table",function(a){na(a)})});o("settings()",function(){return new s(this.context,this.context)});o("init()",function(){var a=this.context;return a.length?a[0].oInit:null});o("data()",function(){return this.iterator("table",function(a){return D(a.aoData,"_aData")}).flatten()});o("destroy()",function(a){a=a||
!1;return this.iterator("table",function(b){var c=b.nTableWrapper.parentNode,d=b.oClasses,e=b.nTable,f=b.nTBody,g=b.nTHead,j=b.nTFoot,i=h(e),f=h(f),k=h(b.nTableWrapper),l=h.map(b.aoData,function(a){return a.nTr}),o;b.bDestroying=!0;r(b,"aoDestroyCallback","destroy",[b]);a||(new s(b)).columns().visible(!0);k.off(".DT").find(":not(tbody *)").off(".DT");h(E).off(".DT-"+b.sInstance);e!=g.parentNode&&(i.children("thead").detach(),i.append(g));j&&e!=j.parentNode&&(i.children("tfoot").detach(),i.append(j));
b.aaSorting=[];b.aaSortingFixed=[];wa(b);h(l).removeClass(b.asStripeClasses.join(" "));h("th, td",g).removeClass(d.sSortable+" "+d.sSortableAsc+" "+d.sSortableDesc+" "+d.sSortableNone);f.children().detach();f.append(l);g=a?"remove":"detach";i[g]();k[g]();!a&&c&&(c.insertBefore(e,b.nTableReinsertBefore),i.css("width",b.sDestroyWidth).removeClass(d.sTable),(o=b.asDestroyStripes.length)&&f.children().each(function(a){h(this).addClass(b.asDestroyStripes[a%o])}));c=h.inArray(b,m.settings);-1!==c&&m.settings.splice(c,
1)})});h.each(["column","row","cell"],function(a,b){o(b+"s().every()",function(a){var d=this.selector.opts,e=this;return this.iterator(b,function(f,g,h,i,n){a.call(e[b](g,"cell"===b?h:d,"cell"===b?d:k),g,h,i,n)})})});o("i18n()",function(a,b,c){var d=this.context[0],a=Q(a)(d.oLanguage);a===k&&(a=b);c!==k&&h.isPlainObject(a)&&(a=a[c]!==k?a[c]:a._);return a.replace("%d",c)});m.version="1.10.16";m.settings=[];m.models={};m.models.oSearch={bCaseInsensitive:!0,sSearch:"",bRegex:!1,bSmart:!0};m.models.oRow=
{nTr:null,anCells:null,_aData:[],_aSortData:null,_aFilterData:null,_sFilterRow:null,_sRowStripe:"",src:null,idx:-1};m.models.oColumn={idx:null,aDataSort:null,asSorting:null,bSearchable:null,bSortable:null,bVisible:null,_sManualType:null,_bAttrSrc:!1,fnCreatedCell:null,fnGetData:null,fnSetData:null,mData:null,mRender:null,nTh:null,nTf:null,sClass:null,sContentPadding:null,sDefaultContent:null,sName:null,sSortDataType:"std",sSortingClass:null,sSortingClassJUI:null,sTitle:null,sType:null,sWidth:null,
sWidthOrig:null};m.defaults={aaData:null,aaSorting:[[0,"asc"]],aaSortingFixed:[],ajax:null,aLengthMenu:[10,25,50,100],aoColumns:null,aoColumnDefs:null,aoSearchCols:[],asStripeClasses:null,bAutoWidth:!0,bDeferRender:!1,bDestroy:!1,bFilter:!0,bInfo:!0,bLengthChange:!0,bPaginate:!0,bProcessing:!1,bRetrieve:!1,bScrollCollapse:!1,bServerSide:!1,bSort:!0,bSortMulti:!0,bSortCellsTop:!1,bSortClasses:!0,bStateSave:!1,fnCreatedRow:null,fnDrawCallback:null,fnFooterCallback:null,fnFormatNumber:function(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,
this.oLanguage.sThousands)},fnHeaderCallback:null,fnInfoCallback:null,fnInitComplete:null,fnPreDrawCallback:null,fnRowCallback:null,fnServerData:null,fnServerParams:null,fnStateLoadCallback:function(a){try{return JSON.parse((-1===a.iStateDuration?sessionStorage:localStorage).getItem("DataTables_"+a.sInstance+"_"+location.pathname))}catch(b){}},fnStateLoadParams:null,fnStateLoaded:null,fnStateSaveCallback:function(a,b){try{(-1===a.iStateDuration?sessionStorage:localStorage).setItem("DataTables_"+a.sInstance+
"_"+location.pathname,JSON.stringify(b))}catch(c){}},fnStateSaveParams:null,iStateDuration:7200,iDeferLoading:null,iDisplayLength:10,iDisplayStart:0,iTabIndex:0,oClasses:{},oLanguage:{oAria:{sSortAscending:": activate to sort column ascending",sSortDescending:": activate to sort column descending"},oPaginate:{sFirst:"First",sLast:"Last",sNext:"Next",sPrevious:"Previous"},sEmptyTable:"No data available in table",sInfo:"Showing _START_ to _END_ of _TOTAL_ entries",sInfoEmpty:"Showing 0 to 0 of 0 entries",
sInfoFiltered:"(filtered from _MAX_ total entries)",sInfoPostFix:"",sDecimal:"",sThousands:",",sLengthMenu:"Show _MENU_ entries",sLoadingRecords:"Loading...",sProcessing:"Processing...",sSearch:"Search:",sSearchPlaceholder:"",sUrl:"",sZeroRecords:"No matching records found"},oSearch:h.extend({},m.models.oSearch),sAjaxDataProp:"data",sAjaxSource:null,sDom:"lfrtip",searchDelay:null,sPaginationType:"simple_numbers",sScrollX:"",sScrollXInner:"",sScrollY:"",sServerMethod:"GET",renderer:null,rowId:"DT_RowId"};
X(m.defaults);m.defaults.column={aDataSort:null,iDataSort:-1,asSorting:["asc","desc"],bSearchable:!0,bSortable:!0,bVisible:!0,fnCreatedCell:null,mData:null,mRender:null,sCellType:"td",sClass:"",sContentPadding:"",sDefaultContent:null,sName:"",sSortDataType:"std",sTitle:null,sType:null,sWidth:null};X(m.defaults.column);m.models.oSettings={oFeatures:{bAutoWidth:null,bDeferRender:null,bFilter:null,bInfo:null,bLengthChange:null,bPaginate:null,bProcessing:null,bServerSide:null,bSort:null,bSortMulti:null,
bSortClasses:null,bStateSave:null},oScroll:{bCollapse:null,iBarWidth:0,sX:null,sXInner:null,sY:null},oLanguage:{fnInfoCallback:null},oBrowser:{bScrollOversize:!1,bScrollbarLeft:!1,bBounding:!1,barWidth:0},ajax:null,aanFeatures:[],aoData:[],aiDisplay:[],aiDisplayMaster:[],aIds:{},aoColumns:[],aoHeader:[],aoFooter:[],oPreviousSearch:{},aoPreSearchCols:[],aaSorting:null,aaSortingFixed:[],asStripeClasses:null,asDestroyStripes:[],sDestroyWidth:0,aoRowCallback:[],aoHeaderCallback:[],aoFooterCallback:[],
aoDrawCallback:[],aoRowCreatedCallback:[],aoPreDrawCallback:[],aoInitComplete:[],aoStateSaveParams:[],aoStateLoadParams:[],aoStateLoaded:[],sTableId:"",nTable:null,nTHead:null,nTFoot:null,nTBody:null,nTableWrapper:null,bDeferLoading:!1,bInitialised:!1,aoOpenRows:[],sDom:null,searchDelay:null,sPaginationType:"two_button",iStateDuration:0,aoStateSave:[],aoStateLoad:[],oSavedState:null,oLoadedState:null,sAjaxSource:null,sAjaxDataProp:null,bAjaxDataGet:!0,jqXHR:null,json:k,oAjaxData:k,fnServerData:null,
aoServerParams:[],sServerMethod:null,fnFormatNumber:null,aLengthMenu:null,iDraw:0,bDrawing:!1,iDrawError:-1,_iDisplayLength:10,_iDisplayStart:0,_iRecordsTotal:0,_iRecordsDisplay:0,oClasses:{},bFiltered:!1,bSorted:!1,bSortCellsTop:null,oInit:null,aoDestroyCallback:[],fnRecordsTotal:function(){return"ssp"==y(this)?1*this._iRecordsTotal:this.aiDisplayMaster.length},fnRecordsDisplay:function(){return"ssp"==y(this)?1*this._iRecordsDisplay:this.aiDisplay.length},fnDisplayEnd:function(){var a=this._iDisplayLength,
b=this._iDisplayStart,c=b+a,d=this.aiDisplay.length,e=this.oFeatures,f=e.bPaginate;return e.bServerSide?!1===f||-1===a?b+d:Math.min(b+a,this._iRecordsDisplay):!f||c>d||-1===a?d:c},oInstance:null,sInstance:null,iTabIndex:0,nScrollHead:null,nScrollFoot:null,aLastSort:[],oPlugins:{},rowIdFn:null,rowId:null};m.ext=x={buttons:{},classes:{},builder:"-source-",errMode:"alert",feature:[],search:[],selector:{cell:[],column:[],row:[]},internal:{},legacy:{ajax:null},pager:{},renderer:{pageButton:{},header:{}},
order:{},type:{detect:[],search:{},order:{}},_unique:0,fnVersionCheck:m.fnVersionCheck,iApiIndex:0,oJUIClasses:{},sVersion:m.version};h.extend(x,{afnFiltering:x.search,aTypes:x.type.detect,ofnSearch:x.type.search,oSort:x.type.order,afnSortData:x.order,aoFeatures:x.feature,oApi:x.internal,oStdClasses:x.classes,oPagination:x.pager});h.extend(m.ext.classes,{sTable:"dataTable",sNoFooter:"no-footer",sPageButton:"paginate_button",sPageButtonActive:"current",sPageButtonDisabled:"disabled",sStripeOdd:"odd",
sStripeEven:"even",sRowEmpty:"dataTables_empty",sWrapper:"dataTables_wrapper",sFilter:"dataTables_filter",sInfo:"dataTables_info",sPaging:"dataTables_paginate paging_",sLength:"dataTables_length",sProcessing:"dataTables_processing",sSortAsc:"sorting_asc",sSortDesc:"sorting_desc",sSortable:"sorting",sSortableAsc:"sorting_asc_disabled",sSortableDesc:"sorting_desc_disabled",sSortableNone:"sorting_disabled",sSortColumn:"sorting_",sFilterInput:"",sLengthSelect:"",sScrollWrapper:"dataTables_scroll",sScrollHead:"dataTables_scrollHead",
sScrollHeadInner:"dataTables_scrollHeadInner",sScrollBody:"dataTables_scrollBody",sScrollFoot:"dataTables_scrollFoot",sScrollFootInner:"dataTables_scrollFootInner",sHeaderTH:"",sFooterTH:"",sSortJUIAsc:"",sSortJUIDesc:"",sSortJUI:"",sSortJUIAscAllowed:"",sSortJUIDescAllowed:"",sSortJUIWrapper:"",sSortIcon:"",sJUIHeader:"",sJUIFooter:""});var Kb=m.ext.pager;h.extend(Kb,{simple:function(){return["previous","next"]},full:function(){return["first","previous","next","last"]},numbers:function(a,b){return[ha(a,
b)]},simple_numbers:function(a,b){return["previous",ha(a,b),"next"]},full_numbers:function(a,b){return["first","previous",ha(a,b),"next","last"]},first_last_numbers:function(a,b){return["first",ha(a,b),"last"]},_numbers:ha,numbers_length:7});h.extend(!0,m.ext.renderer,{pageButton:{_:function(a,b,c,d,e,f){var g=a.oClasses,j=a.oLanguage.oPaginate,i=a.oLanguage.oAria.paginate||{},n,l,m=0,o=function(b,d){var k,s,u,r,v=function(b){Sa(a,b.data.action,true)};k=0;for(s=d.length;k<s;k++){r=d[k];if(h.isArray(r)){u=
h("<"+(r.DT_el||"div")+"/>").appendTo(b);o(u,r)}else{n=null;l="";switch(r){case "ellipsis":b.append('<span class="ellipsis">&#x2026;</span>');break;case "first":n=j.sFirst;l=r+(e>0?"":" "+g.sPageButtonDisabled);break;case "previous":n=j.sPrevious;l=r+(e>0?"":" "+g.sPageButtonDisabled);break;case "next":n=j.sNext;l=r+(e<f-1?"":" "+g.sPageButtonDisabled);break;case "last":n=j.sLast;l=r+(e<f-1?"":" "+g.sPageButtonDisabled);break;default:n=r+1;l=e===r?g.sPageButtonActive:""}if(n!==null){u=h("<a>",{"class":g.sPageButton+
" "+l,"aria-controls":a.sTableId,"aria-label":i[r],"data-dt-idx":m,tabindex:a.iTabIndex,id:c===0&&typeof r==="string"?a.sTableId+"_"+r:null}).html(n).appendTo(b);Va(u,{action:r},v);m++}}}},s;try{s=h(b).find(G.activeElement).data("dt-idx")}catch(u){}o(h(b).empty(),d);s!==k&&h(b).find("[data-dt-idx="+s+"]").focus()}}});h.extend(m.ext.type.detect,[function(a,b){var c=b.oLanguage.sDecimal;return Ya(a,c)?"num"+c:null},function(a){if(a&&!(a instanceof Date)&&!Zb.test(a))return null;var b=Date.parse(a);
return null!==b&&!isNaN(b)||L(a)?"date":null},function(a,b){var c=b.oLanguage.sDecimal;return Ya(a,c,!0)?"num-fmt"+c:null},function(a,b){var c=b.oLanguage.sDecimal;return Pb(a,c)?"html-num"+c:null},function(a,b){var c=b.oLanguage.sDecimal;return Pb(a,c,!0)?"html-num-fmt"+c:null},function(a){return L(a)||"string"===typeof a&&-1!==a.indexOf("<")?"html":null}]);h.extend(m.ext.type.search,{html:function(a){return L(a)?a:"string"===typeof a?a.replace(Mb," ").replace(Aa,""):""},string:function(a){return L(a)?
a:"string"===typeof a?a.replace(Mb," "):a}});var za=function(a,b,c,d){if(0!==a&&(!a||"-"===a))return-Infinity;b&&(a=Ob(a,b));a.replace&&(c&&(a=a.replace(c,"")),d&&(a=a.replace(d,"")));return 1*a};h.extend(x.type.order,{"date-pre":function(a){return Date.parse(a)||-Infinity},"html-pre":function(a){return L(a)?"":a.replace?a.replace(/<.*?>/g,"").toLowerCase():a+""},"string-pre":function(a){return L(a)?"":"string"===typeof a?a.toLowerCase():!a.toString?"":a.toString()},"string-asc":function(a,b){return a<
b?-1:a>b?1:0},"string-desc":function(a,b){return a<b?1:a>b?-1:0}});cb("");h.extend(!0,m.ext.renderer,{header:{_:function(a,b,c,d){h(a.nTable).on("order.dt.DT",function(e,f,g,h){if(a===f){e=c.idx;b.removeClass(c.sSortingClass+" "+d.sSortAsc+" "+d.sSortDesc).addClass(h[e]=="asc"?d.sSortAsc:h[e]=="desc"?d.sSortDesc:c.sSortingClass)}})},jqueryui:function(a,b,c,d){h("<div/>").addClass(d.sSortJUIWrapper).append(b.contents()).append(h("<span/>").addClass(d.sSortIcon+" "+c.sSortingClassJUI)).appendTo(b);
h(a.nTable).on("order.dt.DT",function(e,f,g,h){if(a===f){e=c.idx;b.removeClass(d.sSortAsc+" "+d.sSortDesc).addClass(h[e]=="asc"?d.sSortAsc:h[e]=="desc"?d.sSortDesc:c.sSortingClass);b.find("span."+d.sSortIcon).removeClass(d.sSortJUIAsc+" "+d.sSortJUIDesc+" "+d.sSortJUI+" "+d.sSortJUIAscAllowed+" "+d.sSortJUIDescAllowed).addClass(h[e]=="asc"?d.sSortJUIAsc:h[e]=="desc"?d.sSortJUIDesc:c.sSortingClassJUI)}})}}});var Vb=function(a){return"string"===typeof a?a.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,
"&quot;"):a};m.render={number:function(a,b,c,d,e){return{display:function(f){if("number"!==typeof f&&"string"!==typeof f)return f;var g=0>f?"-":"",h=parseFloat(f);if(isNaN(h))return Vb(f);h=h.toFixed(c);f=Math.abs(h);h=parseInt(f,10);f=c?b+(f-h).toFixed(c).substring(2):"";return g+(d||"")+h.toString().replace(/\B(?=(\d{3})+(?!\d))/g,a)+f+(e||"")}}},text:function(){return{display:Vb}}};h.extend(m.ext.internal,{_fnExternApiFunc:Lb,_fnBuildAjax:sa,_fnAjaxUpdate:kb,_fnAjaxParameters:tb,_fnAjaxUpdateDraw:ub,
_fnAjaxDataSrc:ta,_fnAddColumn:Da,_fnColumnOptions:ja,_fnAdjustColumnSizing:Y,_fnVisibleToColumnIndex:Z,_fnColumnIndexToVisible:$,_fnVisbleColumns:aa,_fnGetColumns:la,_fnColumnTypes:Fa,_fnApplyColumnDefs:hb,_fnHungarianMap:X,_fnCamelToHungarian:I,_fnLanguageCompat:Ca,_fnBrowserDetect:fb,_fnAddData:M,_fnAddTr:ma,_fnNodeToDataIndex:function(a,b){return b._DT_RowIndex!==k?b._DT_RowIndex:null},_fnNodeToColumnIndex:function(a,b,c){return h.inArray(c,a.aoData[b].anCells)},_fnGetCellData:B,_fnSetCellData:ib,
_fnSplitObjNotation:Ia,_fnGetObjectDataFn:Q,_fnSetObjectDataFn:R,_fnGetDataMaster:Ja,_fnClearTable:na,_fnDeleteIndex:oa,_fnInvalidate:ca,_fnGetRowElements:Ha,_fnCreateTr:Ga,_fnBuildHead:jb,_fnDrawHead:ea,_fnDraw:N,_fnReDraw:S,_fnAddOptionsHtml:mb,_fnDetectHeader:da,_fnGetUniqueThs:ra,_fnFeatureHtmlFilter:ob,_fnFilterComplete:fa,_fnFilterCustom:xb,_fnFilterColumn:wb,_fnFilter:vb,_fnFilterCreateSearch:Oa,_fnEscapeRegex:Pa,_fnFilterData:yb,_fnFeatureHtmlInfo:rb,_fnUpdateInfo:Bb,_fnInfoMacros:Cb,_fnInitialise:ga,
_fnInitComplete:ua,_fnLengthChange:Qa,_fnFeatureHtmlLength:nb,_fnFeatureHtmlPaginate:sb,_fnPageChange:Sa,_fnFeatureHtmlProcessing:pb,_fnProcessingDisplay:C,_fnFeatureHtmlTable:qb,_fnScrollDraw:ka,_fnApplyToChildren:H,_fnCalculateColumnWidths:Ea,_fnThrottle:Na,_fnConvertToWidth:Db,_fnGetWidestNode:Eb,_fnGetMaxLenString:Fb,_fnStringToCss:v,_fnSortFlatten:V,_fnSort:lb,_fnSortAria:Hb,_fnSortListener:Ua,_fnSortAttachListener:La,_fnSortingClasses:wa,_fnSortData:Gb,_fnSaveState:xa,_fnLoadState:Ib,_fnSettingsFromNode:ya,
_fnLog:J,_fnMap:F,_fnBindAction:Va,_fnCallbackReg:z,_fnCallbackFire:r,_fnLengthOverflow:Ra,_fnRenderer:Ma,_fnDataSource:y,_fnRowAttributes:Ka,_fnCalculateEnd:function(){}});h.fn.dataTable=m;m.$=h;h.fn.dataTableSettings=m.settings;h.fn.dataTableExt=m.ext;h.fn.DataTable=function(a){return h(this).dataTable(a).api()};h.each(m,function(a,b){h.fn.DataTable[a]=b});return h.fn.dataTable});

var applicationTable, applicantTable, apptype;
var apiPathNotification, cssClassNotification, pagePathNotification;

var enablerDashboard = {
    application: {status: "ALL"},
    applicant: {level1: {status: "ALL"}, level2: {status: "ACCEPT"}}
};


var toggleSIH_AdminFilters = function (action) {
    if (action === "show") {
        $("#applicationType").removeClass('display-n');
        $("#applicationType").parent('div').removeClass('display-n');
        $("#applicationType").parent('div').siblings().removeClass('display-n');
        $("#onlyMineCheckboxDiv").removeClass('display-n');
    } else {
        $("#applicationType").addClass('display-n');
        $("#applicationType").parent('div').addClass('display-n');
        $("#applicationType").parent('div').siblings().addClass('display-n');
        $("#onlyMineCheckboxDiv").addClass('display-n');
    }
};

var populateApplicationTypeSideBar = function (apiPath, listType) {
    $.ajax({
        url: SIH.getEndPoint(apiPath ? apiPath : "/api/auth/ams/application/status/countbytype"),
        type: 'GET',
        data: sideBarData,
        contentType: "application/json",
        headers: {
            "X-Auth-Token": store.getItem("token")
        },
        success: function (data) {
            if (listType === "sih-admin-list") {
                var list = {
                    "ACTIVE": 0,
                    "INACTIVE": 0,
                    "COMPLETED": 0
                }
            } else {
                var list = {
                    "APPROVED": 0,
                    "COMPLETED": 0,
                    "DRAFTED": 0,
                    "INCOMPLETE": 0,
                    "REJECTED": 0,
                    "SUBMITTED": 0
                };
            }

            Object.keys(list).forEach(function (key) {
                list[key] = data[key];
            });
            var context = {
                applicationTypeCount: list
            };
            var allCount = {
                "ALL": Object.values(context.applicationTypeCount).reduce(function (previous, value) {
                    return previous + value;
                }, 0)
            };
            context.applicationTypeCount = Object.assign(allCount, context.applicationTypeCount);

            var template = Handlebars.compile($("#enabler-side-cards-template").html());

            $(".enabler-side-cards-list").html(template(context));
            changeActiveStatus(enablerDashboard.application.status);
        },
        error: function (error) {
            showErrorDialog($('.enabler-dashboard').data("error-msg"));
        }
    });
};

var populateApplicationsData = function (apiPath, cssClass, pagePath) {
    setTitle();
    if (cssClass === "sih-admin-list") {
        getAdminNotifications(apiPath, pagePath)
    } else {
        getEnablerApplications();
    }
};

var setTitle = function () {
    var context = {status: enablerDashboard.application.status};
    var template = Handlebars.compile($("#dashboard-title-template").html());
    $(".program-name").html(template(context));
};

var changeActiveStatus = function (newStatus) {
    enablerDashboard.application.status = newStatus;
    $(".app-type").removeClass("active");
    $("#type-" + enablerDashboard.application.status).addClass("active")
};

var changeStatus = function (newStatus) {
    changeActiveStatus(newStatus);
    if (store.getItem("role") === "SIH_Admin") {
        showGeneralTable('', '', '', true);
    } else {
        showGeneralTable();
    }
};

var showErrorDialog = function (errorMsg, callback) {
    $('.ams-error-modal .modal-body p').html(errorMsg);
    $('.ams-error-modal').modal('show');

    if (callback) {
        $('.ams-error-modal').on('hidden.bs.modal', callback)
    }
};

$(window).load(function () {
    // Event listener to the two range filtering inputs to redraw on input
    $('#applicationType').on('change', function () {

        $('#modal-loader').modal("show");
        apptype = $('#applicationType').val() ? $('#applicationType').val() : null;
        isOnlyMyProgram = $("#onlyMine").prop("checked");
        sideBarData = {'type': apptype, 'onlyMyProgram': isOnlyMyProgram};

        if (store.getItem("token") && store.getItem('published')) {
            populateApplicationTypeSideBar(sideBarApiPath, sideBarCssClass);
        }
        showGeneralTable('', '', '', true);

    });

    $('#onlyMine').on('change', function (e) {

        e.preventDefault();

        $('#modal-loader').modal("show");
        apptype = $('#applicationType').val() ? $('#applicationType').val() : null;
        isOnlyMyProgram = $("#onlyMine").prop("checked");
        sideBarData = {'type': apptype, 'onlyMyProgram': isOnlyMyProgram};

        if (store.getItem("token") && store.getItem('published')) {
            populateApplicationTypeSideBar(sideBarApiPath, sideBarCssClass);
        }
        showGeneralTable('', '', '', true);

    });
});

var getEnablerApplications = function () {
    $('#modal-loader').modal("show");
    var template = Handlebars.compile($("#enabler-dashboard-template").html());
    var context = {applications: []};
    $(".enabler-dashboard-table").html(template(context));
    applicationTable = $('#sih-dashboardTable').DataTable({
        processing: true,
        serverSide: true,
        drawCallback: function (settings) {
            $('#modal-loader').modal("hide");
        },
        ajax: {
            url: SIH.getEndPoint("/api/auth/ams/application/list"),
            dataSrc: 'data',
            dataType: "json",
            type: 'POST',
            error: function (xhr, error, thrown) {
                if (xhr.status === 403) {
                    showErrorDialog("You are not authorised to view this page", goToDashboard);
                } else {
                    showErrorDialog($('.enabler-dashboard').data("error-msg"), goToDashboard);
                }
            },
            beforeSend: function (xhr) {
                xhr.setRequestHeader("X-Auth-Token", store.getItem("token"));
                xhr.setRequestHeader("Content-type", "application/json");
            },
            data: function (d) {
                d.status = enablerDashboard.application.status !== 'ALL' ? enablerDashboard.application.status : null;
                d.type = apptype;
                d.onlyMyProgram = $("#onlyMine").prop('checked');

                return JSON.stringify(d);
            }
        },
        columnDefs: [
            {name: "id", orderable: false, targets: 0},
            {name: "title", targets: 1},
            {name: "submittedOn", targets: 2},
            {name: "createdBy", targets: 3, searchable: false, orderable: false, visible: !isOnlyMyProgram},
            {name: "id", orderable: false, targets: 4}
        ],
        "order": [[2, "desc"]],
        columns: [
            {
                data: "id", render: function (id, type, row) {
                    var status = row.status;
                    if (status === "APPROVED" || status === "COMPLETED") {
                        return "<a href=\"javascript:void(0)\" onclick=\"showApplicantDetails('" + id + "')\">" + id + "</a>";
                    } else if (status === "DETAILS_DRAFTED" || status === "INCOMPLETE") {
                        return "<a href=\"javascript:void(0)\" onclick=\"goToDraftedApplicationDetails('" + id + "', '" + row.type + "')\">" + id + "</a>";
                    } else if (status === "DETAILS_SAVED" || status === "QUESTIONS_DRAFTED") {
                        return "<a href=\"javascript:void(0)\" onclick=\"goToDraftedApplicationQuestion('" + id + "')\">" + id + "</a>";
                    } else if (status === "REJECTED" || status === "SUBMITTED") {
                        return "<a href=\"javascript:void(0)\" onclick=\"goToApplicationDashboard('" + id + "', '" + row.type + "')\">" + id + "</a>";
                    } else {
                        return "<a href=\"javascript:void(0)\">" + id + "</a>";
                    }
                }, defaultContent: "-", searchable: true
            },
            {
                data: "title", defaultContent: "-", searchable: true, render: function (title) {
                    return title.length > 100 ?
                        title.substr(0, 100) + '…' :
                        title;
                }
            },
            {data: "submittedOn", defaultContent: "-", render: formatDate, searchable: false},
            {data: "createdBy", defaultContent: "-", visible: !isOnlyMyProgram},
            {
                data: "id", render: function (id, type, row) {
                    var status = row.status;
                    if (status === "APPROVED" || status === "COMPLETED") {
                        return "<a href=\"javascript:void(0)\" onclick=\"showApplicantDetails('" + id + "')\"><span class=\"action-eye-icon\">&nbsp;</span></a>";
                    } else if (status === "DETAILS_DRAFTED" || status === "INCOMPLETE") {
                        return "<a href=\"javascript:void(0)\" onclick=\"goToDraftedApplicationDetails('" + id + "', '" + row.type + "')\"><span class=\"action-eye-icon\">&nbsp;</span></a>";
                    } else if (status === "DETAILS_SAVED" || status === "QUESTIONS_DRAFTED") {
                        return "<a href=\"javascript:void(0)\" onclick=\"goToDraftedApplicationQuestion('" + id + "')\"><span class=\"action-eye-icon\">&nbsp;</span></a>";
                    } else if (status === "REJECTED" || status === "SUBMITTED") {
                        return "<a href=\"javascript:void(0)\" onclick=\"goToApplicationDashboard('" + id + "', '" + row.type + "')\"><span class=\"action-eye-icon\">&nbsp;</span></a>";
                    } else {
                        return "<a href=\"javascript:void(0)\"><span class=\"action-eye-icon\">&nbsp;</span></a>";
                    }
                }
            }
        ]
    });
    //$('#modal-loader').modal("hide");
};
var getAdminNotifications = function (apiPath, pagePath) {
    $('#modal-loader').modal("show");
    var template = Handlebars.compile($("#admin-dashboard-template").html());
    var context = {applications: []};
    $(".enabler-dashboard-table").html(template(context));
    applicationTable = $('#sih-dashboardTable').DataTable({
        processing: true,
        serverSide: true,
        drawCallback: function (settings) {
            $('#modal-loader').modal("hide");
        },
        ajax: {
            url: SIH.getEndPoint(apiPath),
            dataSrc: 'data',
            dataType: "json",
            type: 'POST',
            error: function (xhr, error, thrown) {
                if (xhr.status === 403) {
                    showErrorDialog("You are not authorised to view this page", goToDashboard);
                } else {
                    showErrorDialog($('.enabler-dashboard').data("error-msg"), goToDashboard);
                }
            },
            beforeSend: function (xhr) {
                xhr.setRequestHeader("X-Auth-Token", store.getItem("token"));
                xhr.setRequestHeader("Content-type", "application/json");
            },
            data: function (d) {
                d.notificationStatus = enablerDashboard.application.status !== 'ALL' ? enablerDashboard.application.status : null;
                return JSON.stringify(d);
            }
        },
        columnDefs: [
            {name: "id", orderable: false, targets: 0},
            {name: "notificationTitle", targets: 1},
            {name: "submittedOn", targets: 2},
        ],
        "order": [[2, "desc"]],
        columns: [
            {
                data: "id", render: function (id, type, row) {
                    var path = pagePath + ".html?notificationId=" + id;
                    return "<a href=" + path + ">" + id + "</a>";
                }, defaultContent: "-", searchable: true
            },
            {
                data: "notificationTitle", defaultContent: "-", searchable: true, render: function (notificationTitle) {
                    return notificationTitle.length > 100 ?
                        notificationTitle.substr(0, 100) + '…' :
                        notificationTitle;
                }
            },
            {data: "submittedOn", defaultContent: "-", render: formatDate, searchable: false},
        ]
    });
    $('#modal-loader').modal("hide");
};

var goToDraftedApplicationDetails = function (applicationId, type) {
    var createApplicationBaseUrl = $("#enabler-right-section").data("createApplicationBaseUrl");
    sessionStorage.setItem("amsApplicationId", applicationId);
    window.location.href = (createApplicationBaseUrl + "/" + type.toLowerCase().replace("_", "-") + "-details.html");
};

var goToDraftedApplicationQuestion = function (applicationId) {
    var createApplicationBaseUrl = $("#enabler-right-section").data("createApplicationBaseUrl");
    sessionStorage.setItem("amsApplicationId", applicationId);
    window.location.href = (createApplicationBaseUrl + "/select-questions.html?applicationId=" + applicationId);
};

var goToApplicationDashboard = function (applicationId, type) {
    var applicationDashboardBaseUrl = $("#enabler-right-section").data("applicationDashboardBaseUrl");
    sessionStorage.setItem("amsApplicationId", applicationId);
    window.open(applicationDashboardBaseUrl + "/" + type.toLowerCase().replace("_", "-") + ".html?applicationId=" + applicationId,'_blank');
};

var formatDate = function (time) {
    if (typeof time === 'number') {
        var m_names = ["JAN", "FEB", "MAR",
            "APR", "MAY", "JUN", "JUL", "AUG", "SEP",
            "OCT", "NOV", "DEC"];
        var formattedDate = new Date(time);
        return formattedDate.getDate() + " " + m_names[formattedDate.getMonth()] + ", " + formattedDate.getFullYear();
    }
};

var showGeneralTable = function (apiPath, cssClass, pagePath, showSIH_AdminFilters) {
    if (showSIH_AdminFilters) {
        toggleSIH_AdminFilters("show");
    }
    var template = Handlebars.compile($("#enabler-general-dashboard-template").html());
    $("#enabler-right-section").html(template({}));
    apiPathNotification = apiPath ? apiPath : apiPathNotification;
    cssClassNotification = cssClass ? cssClass : cssClassNotification;
    pagePathNotification = pagePath ? pagePath : pagePathNotification;
    populateApplicationsData(apiPathNotification, cssClassNotification, pagePathNotification);
};

var showApplicantDetails = function (applicationId) {
    toggleSIH_AdminFilters("hide");
    changeActiveApplication(applicationId);
    var template = Handlebars.compile($("#enabler-applicant-dashboard-template").html());
    $("#enabler-right-section").html(template(enablerDashboard));
    populateApplicantData("#level1");
};

function changeActiveApplication(applicationId) {
    enablerDashboard.application.id = applicationId;
}

function changeActiveApplicantStatus(status, parent, element) {
    if (parent === "#level1") {
        enablerDashboard.applicant.level1.status = status;
    } else {
        enablerDashboard.applicant.level2.status = status;
    }
    if (element) {
        $(element).addClass("active").siblings().removeClass("active");
        $("input#applicant-search-component").val("");
    } else {
        $(parent + " .dashboard-status #" + status).addClass("active").siblings().removeClass("active");
    }
}

var populateApplicantData = function (parent) {
    setTitle();
    populateTopStatusBar(enablerDashboard.application.id);
    updateApplicantResponses(parent);
};

function populateTopStatusBar(applicationId) {
    if (applicationId) {
        $.ajax({
            url: SIH.getEndPoint("/api/auth/ams/application/" + applicationId + "/response/statusWiseCount"),
            type: 'POST',
            contentType: "application/json",
            headers: {
                "X-Auth-Token": store.getItem("token"),
                "Content-Type": "application/json"
            },
            success: function (data) {
                var context = {
                    applicantStatusCount: data
                };
                var level1Template = Handlebars.compile($("#level1-status-list").html());
                var level2Template = Handlebars.compile($("#level2-status-list").html());
                $("#level1 .dashboard-status").html(level1Template(context));
                $("#level2 .dashboard-status").html(level2Template(context));
                changeActiveApplicantStatus("ALL", "#level1");

                $.ajax({
                    url: SIH.getEndPoint("/api/auth/ams/application/" + applicationId),
                    type: 'GET',
                    contentType: "application/json",
                    headers: {
                        "X-Auth-Token": store.getItem("token")
                    },
                    success: function (data) {
                        enablerDashboard.application.currentStatus = data.status;
                        enablerDashboard.application.type = data.type;
                        if (enablerDashboard.application.type === 'WORKSHOP') {
                            $("li.ams-winner").hide();
                            $(".announce-result-btn").hide();
                        } else {
                            $("li.ams-winner").show();
                            if (enablerDashboard.application.currentStatus === 'COMPLETED') {
                                $(".announce-result>button").attr("disabled", "disabled");
                            }
                        }
                        /*  if (enablerDashboard.application.currentStatus !== 'COMPLETED') {
                              $("li.download-pdf-btn").hide();
                          }*/

                    }, fail: function (error) {
                        log.error(error);
                    }
                });
            },
            error: function (error) {
                showErrorDialog($('.enabler-dashboard').data("error-msg"));
            }
        })
    }
}

function changeLevel1Status(newStatus, element) {
    changeActiveApplicantStatus(newStatus, "#level1", element);
    updateApplicantResponses("#level1");
    $('#level1 .download-pdf').attr("data-status", newStatus);
    registerModalEventBulk();
}

function changeLevel2Status(newStatus, element) {
    changeActiveApplicantStatus(newStatus, "#level2", element);
    updateApplicantResponses("#level2");
    $('#level2 .download-pdf').attr("data-status", newStatus);
}
var rows_selected= [];
function updateApplicantResponses(parent) {
    $('#modal-loader').modal("show");
    var status, isLevel1, tableId;
    if (parent === "#level1") {
        status = enablerDashboard.applicant.level1.status === "ALL" ? null : enablerDashboard.applicant.level1.status;
        isLevel1 = true;
        tableId = "#sih-enabler-dashboardTable1";
    } else {
        status = enablerDashboard.applicant.level2.status;
        isLevel1 = false;
        tableId = "#sih-enabler-dashboardTable2";
        if (status === 'WINNER') {
            $("#announce-result-btn").show();
        } else {
            $("#announce-result-btn").hide();
        }
    }
    if (applicantTable) {
        applicantTable.destroy();
    }
    applicantTable = $(tableId).DataTable({
        processing: true,
        serverSide: true,
        drawCallback: function (settings) {
            if(settings._iRecordsTotal >0 && status == "PENDING"){
                $(".action-button-row button").removeClass("hidden");
            }else{
                $(".action-button-row button").addClass("hidden");
            }
            $('#modal-loader').modal("hide");
        },
        ajax: {
            url: SIH.getEndPoint("/api/auth/ams/application/" + enablerDashboard.application.id + "/response/list"),
            dataSrc: 'data',
            dataType: "json",
            error: function (xhr, error, thrown) {
                if (xhr.status === 403) {
                    showErrorDialog("You are not authorised to view this page", goToDashboard);
                } else {
                    showErrorDialog($('.enabler-dashboard').data("error-msg"), goToDashboard);
                }
            },

            type: 'POST',
            beforeSend: function (xhr) {
                xhr.setRequestHeader("X-Auth-Token", store.getItem("token"));
                xhr.setRequestHeader("Content-type", "application/json");
            },
            data: function (d) {
                d.status = status;
                d.level1 = isLevel1;
                return JSON.stringify(d);
            },

        },

        columnDefs: [
            {name: "check", orderable: false, targets: 0, className: "select-checkbox"},
            {name: "id", orderable: false, targets: 1},
            {name: "applicantName", orderable: false, targets: 2},
            {name: "dateCreated", orderable: true, targets: 3},
            {name: "userType", orderable: false, targets: 4},
            {name: "status", orderable: true, targets: 5}
        ],
        "order": [[3, "desc"]],
        select: {
            style: "multi",
            selector: 'td:first-child'
        },
        columns: [
            {
                data: "check", defaultContent: "",searchable: false
            },
            {
                data: "id", defaultContent: "-", searchable: true,
                render: function (id, type, row) {
                    var url = $('#enabler-right-section').data("applicantDataUrl") + ".html?responseId=" + id;
                    return '<a href=' + url + ' >' + row.applicationResponseNo + '</a>';
                }
            },
            {data: "applicantName", defaultContent: "-", searchable: true},
            {data: "dateCreated", defaultContent: "-", render: formatDate, searchable: false},
            {
                data: "userType", defaultContent: "-", searchable: true,
                render: function (userType, type, row) {
                    return userType ? userType.name : null;
                }
            },
            {
                data: "status", defaultContent: "-", searchable: true,
                render: function (status, type, row) {
                    var placeHolder, text;
                    if (status === "REJECT_LEVEL_I" || status === "REJECT_LEVEL_II") {
                        placeHolder = "reject";
                        text = "rejected";
                    } else {
                        placeHolder = status;
                        text = status;
                    }
                    return '<input type="button" class="ams-' + placeHolder.toLowerCase() + '-button btn-ams" value="' + capitalizeFirstLetter(text) + '">';
                }
            }
        ]
    });
}

$(document).on('click', '#mass_select_all', function() {
    $(".application-table table thead th span").toggleClass("selectedCustomTh");
    if($(".application-table table thead th span").hasClass("selectedCustomTh")){
        var cells = applicantTable.rows().select();
    }else{
        var cells = applicantTable.rows().deselect();
    }
});

function capitalizeFirstLetter(string) {
    return string.charAt(0).toUpperCase() + string.slice(1).toLowerCase();
}

function announceResult() {
    if (enablerDashboard.application.id) {
        $('#modal-loader').modal("show");
        $.ajax({
            url: SIH.getEndPoint("/api/auth/ams/application/" + enablerDashboard.application.id + "/result"),
            type: 'POST',
            contentType: "application/json",
            headers: {
                "X-Auth-Token": store.getItem("token"),
                "Content-Type": "application/json"
            },
            success: function (data) {
                $('#modal-loader').modal("hide");
                $(".announce-result>button").attr("disabled", "disabled");
                //$("li.download-pdf-btn").show();
                alert("The results have been announced successfully.");
            },
            error: function (error) {
                $('#modal-loader').modal("hide");
                if (error.status === 400 && error.responseText) {
                    showErrorDialog(error.responseText);
                } else {
                    showErrorDialog($('.enabler-dashboard').data("error-msg"));
                }
            }
        })
    }
}

function downloadReport() {

    var status = $('.tab-pane.active').find(".download-pdf").attr("data-status");
    if (enablerDashboard.application.id) {

        $.ajax({
            url: SIH.getEndPoint("/api/auth/ams/application/applicantReport?applicationId=" + enablerDashboard.application.id + "&status=" + status),
            type: 'GET',
            headers: {
                "X-Auth-Token": store.getItem("token")
            },
            success: function (response, status, xhr) {

                const cType = xhr.getResponseHeader('Content-Type');
                const blob = createBlob(response, cType);
                const filename = enablerDashboard.application.id + ".xlsx";

                downloadFile(blob, filename);
            },
            error: function (error) {
                if (error.status === 400 && error.responseText) {
                    showErrorDialog(error.responseText);
                } else {
                    showErrorDialog($('.enabler-dashboard').data("error-msg"));
                }
            }
        })
    }
}

function downloadDocs() {
    if (enablerDashboard.application.id) {
        var a = window.document.createElement("a");
        a.href = SIH.getEndPoint("/api/file/application/docs/" + enablerDashboard.application.id);
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }
}
var changeBulkResponseStatus = function (status, comment) {
    var appIds = [];
    applicantTable.rows(".selected").data().each(function(d){
        appIds.push(d.id);
    });
    var data = {
        appIds: appIds,
        status: status,
    };

    if (status === 'REJECT_LEVEL_I') {
        data.rejectionReasonlevelI = comment;
    } else if (status === 'REJECT_LEVEL_II') {
        data.rejectionReasonlevelII = comment;
    } else if (status === 'INCOMPLETE') {
        data.incompleteReason = comment;
    } else if (status === "WINNER") {
        data.winnerRemark = comment;
    }

    var requestApi = SIH.getEndPoint("/api/auth/ams/application/applicationResponse/bulkUpdateStatus");
    var redirectUrl = $("#applicant-response-details-bulk").data("redirectUrl");

    if (data.appIds.length > 0) {
        $('#modal-loader').modal('show');
        $.ajax({
            url: requestApi,
            type: "POST",
            contentType: 'application/json',
            data: JSON.stringify(data),
            headers: {'X-Auth-Token': store.getItem("token"), 'Content-Type': 'application/json'}
        }).success(function (response) {
            $('#modal-loader').modal('hide');
            $('.thankyou-modal .modal-body p')
                .html('Your request has been updated successfully.');
            $('.thankyou-modal').modal('show');
        }).error(function (xhr, error, thrown) {
            console.error(error);
            $('#modal-loader').modal('hide');
            if (xhr.status === 403) {
                showErrorDialog("You are not authorised to update status", goToDashboard);
            } else {
                showErrorDialog("Something bad happened", goToDashboard);
            }
        });
    } else {
        $('.ams-error-modal p').html("Please select atleast one application.");
        $(".ams-error-modal").modal("show");
        //$(".buttonRow").find(".btn").attr("disabled", "disabled");
    }
};
var registerModalEventBulk = function () {
    //$(document).on("click", ".action-button-row .form-approved-btn",".action-button-row .form-reject-btn",".action-button-row .form-incomplete-btn", function () {
    $(".action-button-row .btn").off("click").on("click", function () {
    $('.ams-bulk-rejection-modal textarea#ams-approval-comment').val('');
        var status = $(this).data('status');
        $('.ams-bulk-rejection-modal input[name="status"]').val(status);
        var formType = $(this).parent().data('form-type');
        if (status === "REJECT_LEVEL_I" || status === "REJECT_LEVEL_II" || status === "INCOMPLETE" || status === "WINNER") {
            $('.ams-bulk-rejection-modal .ams-submit-btn').attr('data-status', status);
            $('.ams-bulk-rejection-modal').modal('show');
            var heading;
            if (status === "REJECT_LEVEL_I" || status === "REJECT_LEVEL_II") {
                heading = "REJECTED";
                $('.ams-bulk-rejection-modal textarea').attr('placeholder', 'Please enter reason for rejection.')
            } else if (status === "INCOMPLETE") {
                heading = "MARK AS INCOMPLETE";
                $('.ams-bulk-rejection-modal textarea').attr('placeholder', 'Please enter reason for marking as incomplete.')
            } else {

                heading = "WINNER REMARKS";
                $('.ams-bulk-rejection-modal textarea').attr('placeholder', 'Please enter winner remarks. This will be sent to winner when result is announced.')
            }
            $('.ams-bulk-rejection-modal .modal-heading').text(heading);
        } else {
            changeBulkResponseStatus(status);
        }
    });
};
$(document).on('click', ".ams-bulk-rejection-modal .ams-submit-btn", function () {
    var status = $(".ams-bulk-rejection-modal .ams-submit-btn").data("status");
    var comment = $(".ams-bulk-rejection-modal textarea#ams-approval-comment").val();
    if (comment) {
        changeBulkResponseStatus(status, comment);
        $('.ams-bulk-rejection-modal').modal('hide');
    } else {
        if ($(".ams-bulk-rejection-modal").find(".help-block").length === 0) {
            $(".ams-bulk-rejection-modal textarea#ams-approval-comment").closest(".form-group").addClass("has-error");
            $("<span style='font-size: small' class=\"help-block\">This field is required</span>").insertAfter(".ams-response-rejection-modal textarea#ams-approval-comment")
        }
    }
});
var responseObj;

var getApplicantResponse = function (applicantResponseId) {
    var requestApi = $("#applicant-response-details").data("applicationFetchApi");

    if (requestApi && applicantResponseId) {
        $('#modal-loader').modal('show');
        $.ajax({
            url: SIH.getEndPoint(requestApi + applicantResponseId),
            type: "GET",
            contentType: 'application/json',
            headers: {'X-Auth-Token': store.getItem("token"), 'Content-Type': 'application/json'}
        }).done(function (response) {
            responseObj = response;
            var uniqueId = store.getItem("uniqueId");
            var context = {response: response, currentUserId: uniqueId};
            var btnSource = document.getElementById("action-button").innerHTML;
            var btnTemplate = Handlebars.compile(btnSource);
            var dataSource = document.getElementById("ams-applicant-detail-template").innerHTML;
            var dataTemplate = Handlebars.compile(dataSource);
            $(".form-enabler-btns").html(btnTemplate(context));
            $("#applicant-response-details").html(dataTemplate(context));
            $('#modal-loader').modal('hide');
        }).error(function (xhr, error, thrown) {
            console.error(error);
            $('#modal-loader').modal('hide');
            if (xhr.status === 403) {
                showErrorDialog("You are not authorised to view this page.", goToDashboard);
            } else {
                showErrorDialog("Something bad happened", goToDashboard);
            }
        });
    } else {
        $('.ams-error-modal p').html("Invalid Application.");
        $(".ams-error-modal").modal("show");
        $(".buttonRow").find(".btn").attr("disabled", "disabled");
    }
};


var changeResponseStatus = function (status) {
    var requestApi = $("#applicant-response-details").data("changeStatusApi");
    var redirectUrl = $("#applicant-response-details").data("redirectUrl");
    responseObj.status = status;
    var data = Object.assign({}, responseObj);
    data.detailedApplicationResponseDTO = undefined;
    if (requestApi && data.id) {
        $('#modal-loader').modal('show');
        $.ajax({
            url: SIH.getEndPoint(requestApi),
            type: "POST",
            contentType: 'application/json',
            data: JSON.stringify(data),
            headers: {'X-Auth-Token': store.getItem("token"), 'Content-Type': 'application/json'}
        }).success(function (response) {
            sessionStorage.setItem("applicationId", responseObj.applicationId);
            window.location.href = redirectUrl + ".html";
            $('#modal-loader').modal('hide');
        }).error(function (xhr, error, thrown) {
            console.error(error);
            $('#modal-loader').modal('hide');
            if (xhr.status === 403) {
                showErrorDialog("You are not authorised to update status", goToDashboard);
            } else {
                showErrorDialog("Something bad happened", goToDashboard);
            }
        });
    } else {
        $('.ams-error-modal p').html("Invalid Application.");
        $(".ams-error-modal").modal("show");
        $(".buttonRow").find(".btn").attr("disabled", "disabled");
    }
};

var registerModalEvent = function () {
    $(document).on("click", ".form-enabler-btns .btn", function () {
        $('.ams-response-rejection-modal textarea#ams-approval-comment').val('');
        var status = $(this).data('status');
        $('.ams-response-rejection-modal input[name="status"]').val(status);
        var formType = $(this).parent().data('form-type');
        if (status === "REJECT_LEVEL_I" || status === "REJECT_LEVEL_II" || status === "INCOMPLETE" || status === "WINNER") {
            $('.ams-response-rejection-modal .ams-submit-btn').attr('data-status', status);
            $('.ams-response-rejection-modal').modal('show');
            var heading;
            if (status === "REJECT_LEVEL_I" || status === "REJECT_LEVEL_II") {
                heading = "REJECTED";
                $('.ams-response-rejection-modal textarea').attr('placeholder', 'Please enter reason for rejection.')
            } else if (status === "INCOMPLETE") {
                heading = "MARK AS INCOMPLETE";
                $('.ams-response-rejection-modal textarea').attr('placeholder', 'Please enter reason for marking as incomplete.')
            } else {
                heading = "WINNER REMARKS";
                $('.ams-response-rejection-modal textarea').attr('placeholder', 'Please enter winner remarks. This will be sent to winner when result is announced.')
            }
            $('.ams-response-rejection-modal .modal-heading').text(heading);
        } else {
            changeResponseStatus(status);
        }
    });

    $(document).on('click', ".ams-response-rejection-modal .ams-submit-btn", function () {
        var status = $(".ams-response-rejection-modal .ams-submit-btn").data("status");
        var comment = $(".ams-response-rejection-modal textarea#ams-approval-comment").val();
        if (comment) {
            if (status === 'REJECT_LEVEL_I') {
                responseObj.rejectionReasonlevelI = comment;
            } else if (status === 'REJECT_LEVEL_II') {
                responseObj.rejectionReasonlevelII = comment;
            } else if (status === 'INCOMPLETE') {
                responseObj.incompleteReason = comment;
            } else if (status === "WINNER") {
                responseObj.winnerRemark = comment;
            }
            changeResponseStatus(status);
            $('.ams-response-rejection-modal').modal('hide');
        } else {
            if ($(".ams-response-rejection-modal").find(".help-block").length === 0) {
                $(".ams-response-rejection-modal textarea#ams-approval-comment").closest(".form-group").addClass("has-error");
                $("<span style='font-size: small' class=\"help-block\">This field is required</span>").insertAfter(".ams-response-rejection-modal textarea#ams-approval-comment")
            }
        }
    })
};
/**
 * @author zhixin wen <wenzhixin2010@gmail.com>
 * @version 1.2.1
 *
 * http://wenzhixin.net.cn/p/multiple-select/
 */

/**
 * This has been customised according to some requirements
 */


(function ($) {

    'use strict';

    // it only does '%s', and return '' when arguments are undefined
    var sprintf = function (str) {
        var args = arguments,
            flag = true,
            i = 1;

        str = str.replace(/%s/g, function () {
            var arg = args[i++];

            if (typeof arg === 'undefined') {
                flag = false;
                return '';
            }
            return arg;
        });
        return flag ? str : '';
    };

    var removeDiacritics = function (str) {
        var defaultDiacriticsRemovalMap = [
            {
                'base': 'A',
                'letters': /[\u0041\u24B6\uFF21\u00C0\u00C1\u00C2\u1EA6\u1EA4\u1EAA\u1EA8\u00C3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\u00C4\u01DE\u1EA2\u00C5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F]/g
            },
            {'base': 'AA', 'letters': /[\uA732]/g},
            {'base': 'AE', 'letters': /[\u00C6\u01FC\u01E2]/g},
            {'base': 'AO', 'letters': /[\uA734]/g},
            {'base': 'AU', 'letters': /[\uA736]/g},
            {'base': 'AV', 'letters': /[\uA738\uA73A]/g},
            {'base': 'AY', 'letters': /[\uA73C]/g},
            {'base': 'B', 'letters': /[\u0042\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181]/g},
            {'base': 'C', 'letters': /[\u0043\u24B8\uFF23\u0106\u0108\u010A\u010C\u00C7\u1E08\u0187\u023B\uA73E]/g},
            {
                'base': 'D',
                'letters': /[\u0044\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779]/g
            },
            {'base': 'DZ', 'letters': /[\u01F1\u01C4]/g},
            {'base': 'Dz', 'letters': /[\u01F2\u01C5]/g},
            {
                'base': 'E',
                'letters': /[\u0045\u24BA\uFF25\u00C8\u00C9\u00CA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\u00CB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E]/g
            },
            {'base': 'F', 'letters': /[\u0046\u24BB\uFF26\u1E1E\u0191\uA77B]/g},
            {
                'base': 'G',
                'letters': /[\u0047\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E]/g
            },
            {
                'base': 'H',
                'letters': /[\u0048\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D]/g
            },
            {
                'base': 'I',
                'letters': /[\u0049\u24BE\uFF29\u00CC\u00CD\u00CE\u0128\u012A\u012C\u0130\u00CF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197]/g
            },
            {'base': 'J', 'letters': /[\u004A\u24BF\uFF2A\u0134\u0248]/g},
            {
                'base': 'K',
                'letters': /[\u004B\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2]/g
            },
            {
                'base': 'L',
                'letters': /[\u004C\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780]/g
            },
            {'base': 'LJ', 'letters': /[\u01C7]/g},
            {'base': 'Lj', 'letters': /[\u01C8]/g},
            {'base': 'M', 'letters': /[\u004D\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C]/g},
            {
                'base': 'N',
                'letters': /[\u004E\u24C3\uFF2E\u01F8\u0143\u00D1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4]/g
            },
            {'base': 'NJ', 'letters': /[\u01CA]/g},
            {'base': 'Nj', 'letters': /[\u01CB]/g},
            {
                'base': 'O',
                'letters': /[\u004F\u24C4\uFF2F\u00D2\u00D3\u00D4\u1ED2\u1ED0\u1ED6\u1ED4\u00D5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\u00D6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\u00D8\u01FE\u0186\u019F\uA74A\uA74C]/g
            },
            {'base': 'OI', 'letters': /[\u01A2]/g},
            {'base': 'OO', 'letters': /[\uA74E]/g},
            {'base': 'OU', 'letters': /[\u0222]/g},
            {'base': 'P', 'letters': /[\u0050\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754]/g},
            {'base': 'Q', 'letters': /[\u0051\u24C6\uFF31\uA756\uA758\u024A]/g},
            {
                'base': 'R',
                'letters': /[\u0052\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782]/g
            },
            {
                'base': 'S',
                'letters': /[\u0053\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784]/g
            },
            {
                'base': 'T',
                'letters': /[\u0054\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786]/g
            },
            {'base': 'TZ', 'letters': /[\uA728]/g},
            {
                'base': 'U',
                'letters': /[\u0055\u24CA\uFF35\u00D9\u00DA\u00DB\u0168\u1E78\u016A\u1E7A\u016C\u00DC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244]/g
            },
            {'base': 'V', 'letters': /[\u0056\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245]/g},
            {'base': 'VY', 'letters': /[\uA760]/g},
            {'base': 'W', 'letters': /[\u0057\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72]/g},
            {'base': 'X', 'letters': /[\u0058\u24CD\uFF38\u1E8A\u1E8C]/g},
            {
                'base': 'Y',
                'letters': /[\u0059\u24CE\uFF39\u1EF2\u00DD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE]/g
            },
            {
                'base': 'Z',
                'letters': /[\u005A\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762]/g
            },
            {
                'base': 'a',
                'letters': /[\u0061\u24D0\uFF41\u1E9A\u00E0\u00E1\u00E2\u1EA7\u1EA5\u1EAB\u1EA9\u00E3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\u00E4\u01DF\u1EA3\u00E5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250]/g
            },
            {'base': 'aa', 'letters': /[\uA733]/g},
            {'base': 'ae', 'letters': /[\u00E6\u01FD\u01E3]/g},
            {'base': 'ao', 'letters': /[\uA735]/g},
            {'base': 'au', 'letters': /[\uA737]/g},
            {'base': 'av', 'letters': /[\uA739\uA73B]/g},
            {'base': 'ay', 'letters': /[\uA73D]/g},
            {'base': 'b', 'letters': /[\u0062\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253]/g},
            {
                'base': 'c',
                'letters': /[\u0063\u24D2\uFF43\u0107\u0109\u010B\u010D\u00E7\u1E09\u0188\u023C\uA73F\u2184]/g
            },
            {
                'base': 'd',
                'letters': /[\u0064\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A]/g
            },
            {'base': 'dz', 'letters': /[\u01F3\u01C6]/g},
            {
                'base': 'e',
                'letters': /[\u0065\u24D4\uFF45\u00E8\u00E9\u00EA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\u00EB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD]/g
            },
            {'base': 'f', 'letters': /[\u0066\u24D5\uFF46\u1E1F\u0192\uA77C]/g},
            {
                'base': 'g',
                'letters': /[\u0067\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F]/g
            },
            {
                'base': 'h',
                'letters': /[\u0068\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265]/g
            },
            {'base': 'hv', 'letters': /[\u0195]/g},
            {
                'base': 'i',
                'letters': /[\u0069\u24D8\uFF49\u00EC\u00ED\u00EE\u0129\u012B\u012D\u00EF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131]/g
            },
            {'base': 'j', 'letters': /[\u006A\u24D9\uFF4A\u0135\u01F0\u0249]/g},
            {
                'base': 'k',
                'letters': /[\u006B\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3]/g
            },
            {
                'base': 'l',
                'letters': /[\u006C\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747]/g
            },
            {'base': 'lj', 'letters': /[\u01C9]/g},
            {'base': 'm', 'letters': /[\u006D\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F]/g},
            {
                'base': 'n',
                'letters': /[\u006E\u24DD\uFF4E\u01F9\u0144\u00F1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5]/g
            },
            {'base': 'nj', 'letters': /[\u01CC]/g},
            {
                'base': 'o',
                'letters': /[\u006F\u24DE\uFF4F\u00F2\u00F3\u00F4\u1ED3\u1ED1\u1ED7\u1ED5\u00F5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\u00F6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\u00F8\u01FF\u0254\uA74B\uA74D\u0275]/g
            },
            {'base': 'oi', 'letters': /[\u01A3]/g},
            {'base': 'ou', 'letters': /[\u0223]/g},
            {'base': 'oo', 'letters': /[\uA74F]/g},
            {'base': 'p', 'letters': /[\u0070\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755]/g},
            {'base': 'q', 'letters': /[\u0071\u24E0\uFF51\u024B\uA757\uA759]/g},
            {
                'base': 'r',
                'letters': /[\u0072\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783]/g
            },
            {
                'base': 's',
                'letters': /[\u0073\u24E2\uFF53\u00DF\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B]/g
            },
            {
                'base': 't',
                'letters': /[\u0074\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787]/g
            },
            {'base': 'tz', 'letters': /[\uA729]/g},
            {
                'base': 'u',
                'letters': /[\u0075\u24E4\uFF55\u00F9\u00FA\u00FB\u0169\u1E79\u016B\u1E7B\u016D\u00FC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289]/g
            },
            {'base': 'v', 'letters': /[\u0076\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C]/g},
            {'base': 'vy', 'letters': /[\uA761]/g},
            {'base': 'w', 'letters': /[\u0077\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73]/g},
            {'base': 'x', 'letters': /[\u0078\u24E7\uFF58\u1E8B\u1E8D]/g},
            {
                'base': 'y',
                'letters': /[\u0079\u24E8\uFF59\u1EF3\u00FD\u0177\u1EF9\u0233\u1E8F\u00FF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF]/g
            },
            {
                'base': 'z',
                'letters': /[\u007A\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763]/g
            }
        ];

        for (var i = 0; i < defaultDiacriticsRemovalMap.length; i++) {
            str = str.replace(defaultDiacriticsRemovalMap[i].letters, defaultDiacriticsRemovalMap[i].base);
        }

        return str;

    };

    function MultipleSelect($el, options) {
        var that = this,
            name = $el.attr('name') || options.name || '';

        this.options = options;

        // hide select element
        this.$el = $el.hide();

        // label element
        this.$label = this.$el.closest('label');
        if (this.$label.length === 0 && this.$el.attr('id')) {
            this.$label = $(sprintf('label[for="%s"]', this.$el.attr('id').replace(/:/g, '\\:')));
        }

        // restore class and title from select element
        this.$parent = $(sprintf(
            '<div class="ms-parent %s" %s/>',
            $el.attr('class') || '',
            sprintf('title="%s"', $el.attr('title'))));

        // add placeholder to choice button
        this.$choice = $(sprintf([
                '<button type="button" class="ms-choice">',
                '<span class="placeholder">%s</span>',
                '<div></div>',
                '</button>'
            ].join(''),
            this.options.placeholder));

        // default position is bottom
        this.$drop = $(sprintf('<div class="ms-drop %s"%s></div>',
            this.options.position,
            sprintf(' style="width: %s"', this.options.dropWidth)));

        this.$el.after(this.$parent);
        this.$parent.append(this.$choice);
        this.$parent.append(this.$drop);

        if (this.$el.prop('disabled')) {
            this.$choice.addClass('disabled');
        }
        this.$parent.css('width',
            this.options.width ||
            this.$el.css('width') ||
            this.$el.outerWidth() + 20);

        this.selectAllName = 'data-name="selectAll' + name + '"';
        this.selectGroupName = 'data-name="selectGroup' + name + '"';
        this.selectItemName = 'data-name="selectItem' + name + '"';

        if (!this.options.keepOpen) {
            $(document).click(function (e) {
                if ($(e.target)[0] === that.$choice[0] ||
                    $(e.target).parents('.ms-choice')[0] === that.$choice[0]) {
                    return;
                }
                if (($(e.target)[0] === that.$drop[0] ||
                    $(e.target).parents('.ms-drop')[0] !== that.$drop[0] && e.target !== $el[0]) &&
                    that.options.isOpen) {
                    that.close();
                }
            });
        }
    }

    MultipleSelect.prototype = {
        constructor: MultipleSelect,

        init: function () {
            var that = this,
                $ul = $('<ul></ul>');

            this.$drop.html('');

            if (this.options.filter) {
                this.$drop.append([
                    '<div class="ms-search">',
                    '<input type="text" autocomplete="off" autocorrect="off" autocapitilize="off" spellcheck="false">',
                    '</div>'].join('')
                );
            }

            if (this.options.selectAll && !this.options.single) {
                $ul.append([
                    '<li class="ms-select-all">',
                    '<label>',
                    sprintf('<input type="checkbox" %s /> ', this.selectAllName),
                    '<div class="control_indicator"></div>',
                    this.options.selectAllText,
                    '</label>',
                    '</li>'
                ].join(''));
            }

            $.each(this.$el.children(), function (i, elm) {
                $ul.append(that.optionToHtml(i, elm));
            });
            $ul.append(sprintf('<li class="ms-no-results">%s</li>', this.options.noMatchesFound));
            this.$drop.append($ul);

            this.$drop.find('ul').css('max-height', this.options.maxHeight + 'px');
            this.$drop.find('.multiple').css('width', this.options.multipleWidth + 'px');

            this.$searchInput = this.$drop.find('.ms-search input');
            this.$selectAll = this.$drop.find('input[' + this.selectAllName + ']');
            this.$selectGroups = this.$drop.find('input[' + this.selectGroupName + ']');
            this.$selectItems = this.$drop.find('input[' + this.selectItemName + ']:enabled');
            this.$disableItems = this.$drop.find('input[' + this.selectItemName + ']:disabled');
            this.$noResults = this.$drop.find('.ms-no-results');

            this.events();
            this.updateSelectAll(true);
            this.update(true);

            if (this.options.isOpen) {
                this.open();
            }
        },

        optionToHtml: function (i, elm, group, groupDisabled) {
            var that = this,
                $elm = $(elm),
                classes = $elm.attr('class') || '',
                title = sprintf('title="%s"', $elm.attr('title')),
                multiple = this.options.multiple ? 'multiple' : '',
                disabled,
                type = this.options.single ? 'radio' : 'checkbox';

            if ($elm.is('option')) {
                var value = $elm.val(),
                    text = that.options.textTemplate($elm),
                    selected = $elm.prop('selected'),
                    style = sprintf('style="%s"', this.options.styler(value)),
                    $el;

                disabled = groupDisabled || $elm.prop('disabled');

                $el = $([
                    sprintf('<li class="%s %s" %s %s>', multiple, classes, title, style),
                    sprintf('<label class="%s">', disabled ? 'disabled' : ''),
                    sprintf('<input type="%s" %s%s%s%s>',
                        type, this.selectItemName,
                        selected ? ' checked="checked"' : '',
                        disabled ? ' disabled="disabled"' : '',
                        sprintf(' data-group="%s"', group)),
                    '<div class="control_indicator"></div>',
                    sprintf('<span>%s</span>', text),
                    '</label>',
                    '</li>'
                ].join(''));
                $el.find('input').val(value);
                return $el;
            }
            if ($elm.is('optgroup')) {
                var label = that.options.labelTemplate($elm),
                    $group = $('<div/>');

                group = 'group_' + i;
                disabled = $elm.prop('disabled');

                $group.append([
                    '<li class="group">',
                    sprintf('<label class="optgroup %s" data-group="%s">', disabled ? 'disabled' : '', group),
                    this.options.hideOptgroupCheckboxes || this.options.single ? '' :
                        sprintf('<input type="checkbox" %s %s>',
                            this.selectGroupName, disabled ? 'disabled="disabled"' : ''),
                    label,
                    '</label>',
                    '</li>'
                ].join(''));

                $.each($elm.children(), function (i, elm) {
                    $group.append(that.optionToHtml(i, elm, group, disabled));
                });
                return $group.html();
            }
        },

        events: function () {
            var that = this,
                toggleOpen = function (e) {
                    e.preventDefault();
                    that[that.options.isOpen ? 'close' : 'open']();
                };

            if (this.$label) {
                this.$label.off('click').on('click', function (e) {
                    if (e.target.nodeName.toLowerCase() !== 'label' || e.target !== this) {
                        return;
                    }
                    toggleOpen(e);
                    if (!that.options.filter || !that.options.isOpen) {
                        that.focus();
                    }
                    e.stopPropagation(); // Causes lost focus otherwise
                });
            }

            this.$choice.off('click').on('click', toggleOpen)
                .off('focus').on('focus', this.options.onFocus)
                .off('blur').on('blur', this.options.onBlur);

            this.$parent.off('keydown').on('keydown', function (e) {
                switch (e.which) {
                    case 27: // esc key
                        that.close();
                        that.$choice.focus();
                        break;
                }
            });

            this.$searchInput.off('keydown').on('keydown', function (e) {
                // Ensure shift-tab causes lost focus from filter as with clicking away
                if (e.keyCode === 9 && e.shiftKey) {
                    that.close();
                }
            }).off('keyup').on('keyup', function (e) {
                // enter or space
                // Avoid selecting/deselecting if no choices made
                if (that.options.filterAcceptOnEnter && (e.which === 13 || e.which == 32) && that.$searchInput.val()) {
                    that.$selectAll.click();
                    that.close();
                    that.focus();
                    return;
                }
                that.filter();
            });

            this.$selectAll.off('click').on('click', function () {
                var checked = $(this).prop('checked'),
                    $items = that.$selectItems.filter(':visible');

                if ($items.length === that.$selectItems.length) {
                    that[checked ? 'checkAll' : 'uncheckAll']();
                } else { // when the filter option is true
                    that.$selectGroups.prop('checked', checked);
                    $items.prop('checked', checked);
                    that.options[checked ? 'onCheckAll' : 'onUncheckAll']();
                    that.update();
                }
            });
            this.$selectGroups.off('click').on('click', function () {
                var group = $(this).parent().attr('data-group'),
                    $items = that.$selectItems.filter(':visible'),
                    $children = $items.filter(sprintf('[data-group="%s"]', group)),
                    checked = $children.length !== $children.filter(':checked').length;

                $children.prop('checked', checked);
                that.updateSelectAll();
                that.update();
                that.options.onOptgroupClick({
                    label: $(this).parent().text(),
                    checked: checked,
                    children: $children.get(),
                    instance: that
                });
            });
            this.$selectItems.off('click').on('click', function () {
                that.updateSelectAll();
                that.update();
                that.updateOptGroupSelect();
                that.options.onClick({
                    label: $(this).parent().text(),
                    value: $(this).val(),
                    checked: $(this).prop('checked'),
                    instance: that
                });

                if (that.options.single && that.options.isOpen && !that.options.keepOpen) {
                    that.close();
                }

                if (that.options.single) {
                    var clickedVal = $(this).val();
                    that.$selectItems.filter(function () {
                        return $(this).val() !== clickedVal;
                    }).each(function () {
                        $(this).prop('checked', false);
                    });
                    that.update();
                }
            });
        },

        open: function () {
            if (this.$choice.hasClass('disabled')) {
                return;
            }
            this.options.isOpen = true;
            this.$choice.find('>div').addClass('open');
            this.$drop[this.animateMethod('show')]();

            // fix filter bug: no results show
            this.$selectAll.parent().show();
            this.$noResults.hide();

            // Fix #77: 'All selected' when no options
            if (!this.$el.children().length) {
                this.$selectAll.parent().hide();
                this.$noResults.show();
            }

            if (this.options.container) {
                var offset = this.$drop.offset();
                this.$drop.appendTo($(this.options.container));
                this.$drop.offset({
                    top: offset.top,
                    left: offset.left
                });
            }

            if (this.options.filter) {
                this.$searchInput.val('');
                this.$searchInput.focus();
                this.filter();
            }
            this.options.onOpen();
        },

        close: function () {
            this.options.isOpen = false;
            this.$choice.find('>div').removeClass('open');
            this.$drop[this.animateMethod('hide')]();
            if (this.options.container) {
                this.$parent.append(this.$drop);
                this.$drop.css({
                    'top': 'auto',
                    'left': 'auto'
                });
            }
            this.options.onClose();
        },

        animateMethod: function (method) {
            var methods = {
                show: {
                    fade: 'fadeIn',
                    slide: 'slideDown'
                },
                hide: {
                    fade: 'fadeOut',
                    slide: 'slideUp'
                }
            };

            return methods[method][this.options.animate] || method;
        },

        update: function (isInit) {
            var selects = this.options.displayValues ? this.getSelects() : this.getSelects('text'),
                $span = this.$choice.find('>span'),
                sl = selects.length;

            if (sl === 0) {
                $span.addClass('placeholder').html(this.options.placeholder);
            } else if (this.options.allSelected && sl === this.$selectItems.length + this.$disableItems.length) {
                $span.removeClass('placeholder').html(this.options.allSelected);
            } else if (this.options.ellipsis && sl > this.options.minimumCountSelected) {
                $span.removeClass('placeholder').text(selects.slice(0, this.options.minimumCountSelected)
                    .join(this.options.delimiter) + '...');
            } else if (this.options.countSelected && sl > this.options.minimumCountSelected) {
                $span.removeClass('placeholder').html(this.options.countSelected
                    .replace('#', selects.length)
                    .replace('%', this.$selectItems.length + this.$disableItems.length));
            } else {
                $span.removeClass('placeholder').text(selects.join(this.options.delimiter));
            }

            if (this.options.addTitle) {
                $span.prop('title', this.getSelects('text'));
            }

            // set selects to select
            this.$el.val(this.getSelects()).trigger('change');

            // add selected class to selected li
            this.$drop.find('li').removeClass('selected');
            this.$drop.find('input:checked').each(function () {
                $(this).parents('li').first().addClass('selected');
            });

            // trigger <select> change event
            if (!isInit) {
                this.$el.trigger('change');
            }
        },

        updateSelectAll: function (isInit) {
            var $items = this.$selectItems;

            if (!isInit) {
                $items = $items.filter(':visible');
            }
            this.$selectAll.prop('checked', $items.length &&
                $items.length === $items.filter(':checked').length);
            if (!isInit && this.$selectAll.prop('checked')) {
                this.options.onCheckAll();
            }
        },

        updateOptGroupSelect: function () {
            var $items = this.$selectItems.filter(':visible');
            $.each(this.$selectGroups, function (i, val) {
                var group = $(val).parent().attr('data-group'),
                    $children = $items.filter(sprintf('[data-group="%s"]', group));
                $(val).prop('checked', $children.length &&
                    $children.length === $children.filter(':checked').length);
            });
        },

        //value or text, default: 'value'
        getSelects: function (type) {
            var that = this,
                texts = [],
                values = [];
            this.$drop.find(sprintf('input[%s]:checked', this.selectItemName)).each(function () {
                texts.push($(this).parents('li').first().text());
                values.push($(this).val());
            });

            if (type === 'text' && this.$selectGroups.length) {
                texts = [];
                this.$selectGroups.each(function () {
                    var html = [],
                        text = $.trim($(this).parent().text()),
                        group = $(this).parent().data('group'),
                        $children = that.$drop.find(sprintf('[%s][data-group="%s"]', that.selectItemName, group)),
                        $selected = $children.filter(':checked');

                    if (!$selected.length) {
                        return;
                    }

                    html.push('[');
                    html.push(text);
                    if ($children.length > $selected.length) {
                        var list = [];
                        $selected.each(function () {
                            list.push($(this).parent().text());
                        });
                        html.push(': ' + list.join(', '));
                    }
                    html.push(']');
                    texts.push(html.join(''));
                });
            }
            return type === 'text' ? texts : values;
        },

        setSelects: function (values) {
            var that = this;
            this.$selectItems.prop('checked', false);
            this.$disableItems.prop('checked', false);
            $.each(values, function (i, value) {
                that.$selectItems.filter(sprintf('[value="%s"]', value)).prop('checked', true);
                that.$disableItems.filter(sprintf('[value="%s"]', value)).prop('checked', true);
            });
            this.$selectAll.prop('checked', this.$selectItems.length ===
                this.$selectItems.filter(':checked').length + this.$disableItems.filter(':checked').length);

            $.each(that.$selectGroups, function (i, val) {
                var group = $(val).parent().attr('data-group'),
                    $children = that.$selectItems.filter('[data-group="' + group + '"]');
                $(val).prop('checked', $children.length &&
                    $children.length === $children.filter(':checked').length);
            });

            this.update();
        },

        enable: function () {
            this.$choice.removeClass('disabled');
        },

        disable: function () {
            this.$choice.addClass('disabled');
        },

        checkAll: function () {
            this.$selectItems.prop('checked', true);
            this.$selectGroups.prop('checked', true);
            this.$selectAll.prop('checked', true);
            this.update();
            this.options.onCheckAll();
        },

        uncheckAll: function () {
            this.$selectItems.prop('checked', false);
            this.$selectGroups.prop('checked', false);
            this.$selectAll.prop('checked', false);
            this.update();
            this.options.onUncheckAll();
        },

        focus: function () {
            this.$choice.focus();
            this.options.onFocus();
        },

        blur: function () {
            this.$choice.blur();
            this.options.onBlur();
        },

        refresh: function () {
            this.init();
        },

        destroy: function () {
            this.$el.show();
            this.$parent.remove();
            this.$el.data('multipleSelect', null);
        },

        filter: function () {
            var that = this,
                text = $.trim(this.$searchInput.val()).toLowerCase();

            if (text.length === 0) {
                this.$selectAll.parent().show();
                this.$selectItems.parent().show();
                this.$disableItems.parent().show();
                this.$selectGroups.parent().show();
                this.$noResults.hide();
            } else {
                this.$selectItems.each(function () {
                    var $parent = $(this).parent();
                    $parent[removeDiacritics($parent.text().toLowerCase()).indexOf(removeDiacritics(text)) < 0 ? 'hide' : 'show']();
                });
                this.$disableItems.parent().hide();
                this.$selectGroups.each(function () {
                    var $parent = $(this).parent();
                    var group = $parent.attr('data-group'),
                        $items = that.$selectItems.filter(':visible');
                    $parent[$items.filter(sprintf('[data-group="%s"]', group)).length ? 'show' : 'hide']();
                });

                //Check if no matches found
                if (this.$selectItems.parent().filter(':visible').length) {
                    this.$selectAll.parent().show();
                    this.$noResults.hide();
                } else {
                    this.$selectAll.parent().hide();
                    this.$noResults.show();
                }
            }
            this.updateOptGroupSelect();
            this.updateSelectAll();
            this.options.onFilter(text);
        }
    };

    $.fn.multipleSelect = function () {
        var option = arguments[0],
            args = arguments,

            value,
            allowedMethods = [
                'getSelects', 'setSelects',
                'enable', 'disable',
                'open', 'close',
                'checkAll', 'uncheckAll',
                'focus', 'blur',
                'refresh', 'destroy'
            ];

        this.each(function () {
            var $this = $(this),
                data = $this.data('multipleSelect'),
                options = $.extend({}, $.fn.multipleSelect.defaults,
                    $this.data(), typeof option === 'object' && option);

            if (!data) {
                data = new MultipleSelect($this, options);
                $this.data('multipleSelect', data);
            }

            if (typeof option === 'string') {
                if ($.inArray(option, allowedMethods) < 0) {
                    throw 'Unknown method: ' + option;
                }
                value = data[option](args[1]);
            } else {
                data.init();
                if (args[1]) {
                    value = data[args[1]].apply(data, [].slice.call(args, 2));
                }
            }
        });

        return typeof value !== 'undefined' ? value : this;
    };

    $.fn.multipleSelect.defaults = {
        name: '',
        isOpen: false,
        placeholder: '',
        selectAll: true,
        selectAllDelimiter: ['[', ']'],
        minimumCountSelected: 3,
        ellipsis: false,
        multiple: false,
        multipleWidth: 80,
        single: false,
        filter: false,
        width: undefined,
        dropWidth: undefined,
        maxHeight: 250,
        container: null,
        position: 'bottom',
        keepOpen: false,
        animate: 'none', // 'none', 'fade', 'slide'
        displayValues: false,
        delimiter: ', ',
        addTitle: false,
        filterAcceptOnEnter: false,
        hideOptgroupCheckboxes: false,

        selectAllText: 'Select all',
        allSelected: 'All selected',
        countSelected: '# of % selected',
        noMatchesFound: 'No matches found',

        styler: function () {
            return false;
        },
        textTemplate: function ($elm) {
            return $elm.html();
        },
        labelTemplate: function ($elm) {
            return $elm.attr('label');
        },

        onOpen: function () {
            return false;
        },
        onClose: function () {
            return false;
        },
        onCheckAll: function () {
            return false;
        },
        onUncheckAll: function () {
            return false;
        },
        onFocus: function () {
            return false;
        },
        onBlur: function () {
            return false;
        },
        onOptgroupClick: function () {
            return false;
        },
        onClick: function () {
            return false;
        },
        onFilter: function () {
            return false;
        }
    };
})(jQuery);

/**
 * bootbox.js 5.3.2
 *
 * http://bootboxjs.com/license.txt
 */
!function(e,t){'use strict';'function'==typeof define&&define.amd?define(['jquery'],t):'object'==typeof exports?module.exports=t(require('jquery')):e.bootbox=t(e.jQuery)}(this,function t(p,u){'use strict';var r,n,i,l;Object.keys||(Object.keys=(r=Object.prototype.hasOwnProperty,n=!{toString:null}.propertyIsEnumerable('toString'),l=(i=['toString','toLocaleString','valueOf','hasOwnProperty','isPrototypeOf','propertyIsEnumerable','constructor']).length,function(e){if('function'!=typeof e&&('object'!=typeof e||null===e))throw new TypeError('Object.keys called on non-object');var t,o,a=[];for(t in e)r.call(e,t)&&a.push(t);if(n)for(o=0;o<l;o++)r.call(e,i[o])&&a.push(i[o]);return a}));var d={};d.VERSION='5.0.0';var b={},f={dialog:"<div class=\"bootbox modal\" tabindex=\"-1\" role=\"dialog\" aria-hidden=\"true\"><div class=\"modal-dialog\"><div class=\"modal-content\"><div class=\"modal-body\"><div class=\"bootbox-body\"></div></div></div></div></div>",header:"<div class=\"modal-header\"><h5 class=\"modal-title\"></h5></div>",footer:'<div class="modal-footer"></div>',closeButton:'<button type="button" class="bootbox-close-button close" aria-hidden="true">&times;</button>',form:'<form class="bootbox-form"></form>',button:'<button type="button" class="btn"></button>',option:'<option></option>',promptMessage:'<div class="bootbox-prompt-message"></div>',inputs:{text:'<input class="bootbox-input bootbox-input-text form-control" autocomplete="off" type="text" />',textarea:'<textarea class="bootbox-input bootbox-input-textarea form-control"></textarea>',email:'<input class="bootbox-input bootbox-input-email form-control" autocomplete="off" type="email" />',select:'<select class="bootbox-input bootbox-input-select form-control"></select>',checkbox:'<div class="form-check checkbox"><label class="form-check-label"><input class="form-check-input bootbox-input bootbox-input-checkbox" type="checkbox" /></label></div>',radio:'<div class="form-check radio"><label class="form-check-label"><input class="form-check-input bootbox-input bootbox-input-radio" type="radio" name="bootbox-radio" /></label></div>',date:'<input class="bootbox-input bootbox-input-date form-control" autocomplete="off" type="date" />',time:'<input class="bootbox-input bootbox-input-time form-control" autocomplete="off" type="time" />',number:'<input class="bootbox-input bootbox-input-number form-control" autocomplete="off" type="number" />',password:'<input class="bootbox-input bootbox-input-password form-control" autocomplete="off" type="password" />',range:'<input class="bootbox-input bootbox-input-range form-control-range" autocomplete="off" type="range" />'}},m={locale:'en',backdrop:'static',animate:!0,className:null,closeButton:!0,show:!0,container:'body',value:'',inputType:'text',swapButtonOrder:!1,centerVertical:!1,multiple:!1,scrollable:!1};function c(e,t,o){return p.extend(!0,{},e,function(e,t){var o=e.length,a={};if(o<1||2<o)throw new Error('Invalid argument length');return 2===o||'string'==typeof e[0]?(a[t[0]]=e[0],a[t[1]]=e[1]):a=e[0],a}(t,o))}function h(e,t,o,a){var r;a&&a[0]&&(r=a[0].locale||m.locale,(a[0].swapButtonOrder||m.swapButtonOrder)&&(t=t.reverse()));var n,i,l,s={className:'bootbox-'+e,buttons:function(e,t){for(var o={},a=0,r=e.length;a<r;a++){var n=e[a],i=n.toLowerCase(),l=n.toUpperCase();o[i]={label:(s=l,c=t,void 0,p=b[c],p?p[s]:b.en[s])}}var s,c,p;return o}(t,r)};return n=c(s,a,o),l={},v(i=t,function(e,t){l[t]=!0}),v(n.buttons,function(e){if(l[e]===u)throw new Error('button key "'+e+'" is not allowed (options are '+i.join(' ')+')')}),n}function w(e){return Object.keys(e).length}function v(e,o){var a=0;p.each(e,function(e,t){o(e,t,a++)})}function g(e,t,o){e.stopPropagation(),e.preventDefault(),p.isFunction(o)&&!1===o.call(t,e)||t.modal('hide')}function y(e){return/([01][0-9]|2[0-3]):[0-5][0-9]?:[0-5][0-9]/.test(e)}function x(e){return/(\d{4})-(\d{2})-(\d{2})/.test(e)}return d.locales=function(e){return e?b[e]:b},d.addLocale=function(e,o){return p.each(['OK','CANCEL','CONFIRM'],function(e,t){if(!o[t])throw new Error('Please supply a translation for "'+t+'"')}),b[e]={OK:o.OK,CANCEL:o.CANCEL,CONFIRM:o.CONFIRM},d},d.removeLocale=function(e){if('en'===e)throw new Error('"en" is used as the default and fallback locale and cannot be removed.');return delete b[e],d},d.setLocale=function(e){return d.setDefaults('locale',e)},d.setDefaults=function(){var e={};return 2===arguments.length?e[arguments[0]]=arguments[1]:e=arguments[0],p.extend(m,e),d},d.hideAll=function(){return p('.bootbox').modal('hide'),d},d.init=function(e){return t(e||p)},d.dialog=function(e){if(p.fn.modal===u)throw new Error("\"$.fn.modal\" is not defined; please double check you have included the Bootstrap JavaScript library. See http://getbootstrap.com/javascript/ for more details.");if(e=function(r){var n,i;if('object'!=typeof r)throw new Error('Please supply an object of options');if(!r.message)throw new Error('"message" option must not be null or an empty string.');(r=p.extend({},m,r)).buttons||(r.buttons={});return n=r.buttons,i=w(n),v(n,function(e,t,o){if(p.isFunction(t)&&(t=n[e]={callback:t}),'object'!==p.type(t))throw new Error('button with key "'+e+'" must be an object');if(t.label||(t.label=e),!t.className){var a=!1;a=r.swapButtonOrder?0===o:o===i-1,t.className=i<=2&&a?'btn-primary':'btn-secondary btn-default'}}),r}(e),p.fn.modal.Constructor.VERSION){e.fullBootstrapVersion=p.fn.modal.Constructor.VERSION;var t=e.fullBootstrapVersion.indexOf('.');e.bootstrap=e.fullBootstrapVersion.substring(0,t)}else e.bootstrap='2',e.fullBootstrapVersion='2.3.2',console.warn('Bootbox will *mostly* work with Bootstrap 2, but we do not officially support it. Please upgrade, if possible.');var o=p(f.dialog),a=o.find('.modal-dialog'),r=o.find('.modal-body'),n=p(f.header),i=p(f.footer),l=e.buttons,s={onEscape:e.onEscape};if(r.find('.bootbox-body').html(e.message),0<w(e.buttons)&&(v(l,function(e,t){var o=p(f.button);switch(o.data('bb-handler',e),o.addClass(t.className),e){case'ok':case'confirm':o.addClass('bootbox-accept');break;case'cancel':o.addClass('bootbox-cancel')}o.html(t.label),i.append(o),s[e]=t.callback}),r.after(i)),!0===e.animate&&o.addClass('fade'),e.className&&o.addClass(e.className),e.size)switch(e.fullBootstrapVersion.substring(0,3)<'3.1'&&console.warn('"size" requires Bootstrap 3.1.0 or higher. You appear to be using '+e.fullBootstrapVersion+'. Please upgrade to use this option.'),e.size){case'small':case'sm':a.addClass('modal-sm');break;case'large':case'lg':a.addClass('modal-lg');break;case'xl':case'extra-large':e.fullBootstrapVersion.substring(0,3)<'4.2'&&console.warn('Using size "xl"/"extra-large" requires Bootstrap 4.2.0 or higher. You appear to be using '+e.fullBootstrapVersion+'. Please upgrade to use this option.'),a.addClass('modal-xl')}if(e.scrollable&&(e.fullBootstrapVersion.substring(0,3)<'4.3'&&console.warn('Using "scrollable" requires Bootstrap 4.3.0 or higher. You appear to be using '+e.fullBootstrapVersion+'. Please upgrade to use this option.'),a.addClass('modal-dialog-scrollable')),e.title&&(r.before(n),o.find('.modal-title').html(e.title)),e.closeButton){var c=p(f.closeButton);e.title?3<e.bootstrap?o.find('.modal-header').append(c):o.find('.modal-header').prepend(c):c.prependTo(r)}return e.centerVertical&&(e.fullBootstrapVersion<'4.0.0'&&console.warn('"centerVertical" requires Bootstrap 4.0.0-beta.3 or higher. You appear to be using '+e.fullBootstrapVersion+'. Please upgrade to use this option.'),a.addClass('modal-dialog-centered')),o.one('hide.bs.modal',function(e){e.target===this&&(o.off('escape.close.bb'),o.off('click'))}),o.one('hidden.bs.modal',function(e){e.target===this&&o.remove()}),o.one('shown.bs.modal',function(){o.find('.bootbox-accept:first').trigger('focus')}),'static'!==e.backdrop&&o.on('click.dismiss.bs.modal',function(e){o.children('.modal-backdrop').length&&(e.currentTarget=o.children('.modal-backdrop').get(0)),e.target===e.currentTarget&&o.trigger('escape.close.bb')}),o.on('escape.close.bb',function(e){s.onEscape&&g(e,o,s.onEscape)}),o.on('click','.modal-footer button:not(.disabled)',function(e){var t=p(this).data('bb-handler');t!==u&&g(e,o,s[t])}),o.on('click','.bootbox-close-button',function(e){g(e,o,s.onEscape)}),o.on('keyup',function(e){27===e.which&&o.trigger('escape.close.bb')}),p(e.container).append(o),o.modal({backdrop:!!e.backdrop&&'static',keyboard:!1,show:!1}),e.show&&o.modal('show'),o},d.alert=function(){var e;if((e=h('alert',['ok'],['message','callback'],arguments)).callback&&!p.isFunction(e.callback))throw new Error('alert requires the "callback" property to be a function when provided');return e.buttons.ok.callback=e.onEscape=function(){return!p.isFunction(e.callback)||e.callback.call(this)},d.dialog(e)},d.confirm=function(){var e;if(e=h('confirm',['cancel','confirm'],['message','callback'],arguments),!p.isFunction(e.callback))throw new Error('confirm requires a callback');return e.buttons.cancel.callback=e.onEscape=function(){return e.callback.call(this,!1)},e.buttons.confirm.callback=function(){return e.callback.call(this,!0)},d.dialog(e)},d.prompt=function(){var r,t,e,n,o,a;if(e=p(f.form),(r=h('prompt',['cancel','confirm'],['title','callback'],arguments)).value||(r.value=m.value),r.inputType||(r.inputType=m.inputType),o=r.show===u?m.show:r.show,r.show=!1,r.buttons.cancel.callback=r.onEscape=function(){return r.callback.call(this,null)},r.buttons.confirm.callback=function(){var e;if('checkbox'===r.inputType)e=n.find('input:checked').map(function(){return p(this).val()}).get();else if('radio'===r.inputType)e=n.find('input:checked').val();else{if(n[0].checkValidity&&!n[0].checkValidity())return!1;e='select'===r.inputType&&!0===r.multiple?n.find('option:selected').map(function(){return p(this).val()}).get():n.val()}return r.callback.call(this,e)},!r.title)throw new Error('prompt requires a title');if(!p.isFunction(r.callback))throw new Error('prompt requires a callback');if(!f.inputs[r.inputType])throw new Error('Invalid prompt type');switch(n=p(f.inputs[r.inputType]),r.inputType){case'text':case'textarea':case'email':case'password':n.val(r.value),r.placeholder&&n.attr('placeholder',r.placeholder),r.pattern&&n.attr('pattern',r.pattern),r.maxlength&&n.attr('maxlength',r.maxlength),r.required&&n.prop({required:!0}),r.rows&&!isNaN(parseInt(r.rows))&&'textarea'===r.inputType&&n.attr({rows:r.rows});break;case'date':case'time':case'number':case'range':if(n.val(r.value),r.placeholder&&n.attr('placeholder',r.placeholder),r.pattern&&n.attr('pattern',r.pattern),r.required&&n.prop({required:!0}),'date'!==r.inputType&&r.step){if(!('any'===r.step||!isNaN(r.step)&&0<parseInt(r.step)))throw new Error('"step" must be a valid positive number or the value "any". See https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input#attr-step for more information.');n.attr('step',r.step)}(function(e,t,o){var a=!1,r=!0,n=!0;if('date'===e)t===u||(r=x(t))?o===u||(n=x(o))||console.warn('Browsers which natively support the "date" input type expect date values to be of the form "YYYY-MM-DD" (see ISO-8601 https://www.iso.org/iso-8601-date-and-time-format.html). Bootbox does not enforce this rule, but your max value may not be enforced by this browser.'):console.warn('Browsers which natively support the "date" input type expect date values to be of the form "YYYY-MM-DD" (see ISO-8601 https://www.iso.org/iso-8601-date-and-time-format.html). Bootbox does not enforce this rule, but your min value may not be enforced by this browser.');else if('time'===e){if(t!==u&&!(r=y(t)))throw new Error('"min" is not a valid time. See https://www.w3.org/TR/2012/WD-html-markup-20120315/datatypes.html#form.data.time for more information.');if(o!==u&&!(n=y(o)))throw new Error('"max" is not a valid time. See https://www.w3.org/TR/2012/WD-html-markup-20120315/datatypes.html#form.data.time for more information.')}else{if(t!==u&&isNaN(t))throw new Error('"min" must be a valid number. See https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input#attr-min for more information.');if(o!==u&&isNaN(o))throw new Error('"max" must be a valid number. See https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input#attr-max for more information.')}if(r&&n){if(o<=t)throw new Error('"max" must be greater than "min". See https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input#attr-max for more information.');a=!0}return a})(r.inputType,r.min,r.max)&&(r.min!==u&&n.attr('min',r.min),r.max!==u&&n.attr('max',r.max));break;case'select':var i={};if(a=r.inputOptions||[],!p.isArray(a))throw new Error('Please pass an array of input options');if(!a.length)throw new Error('prompt with "inputType" set to "select" requires at least one option');r.placeholder&&n.attr('placeholder',r.placeholder),r.required&&n.prop({required:!0}),r.multiple&&n.prop({multiple:!0}),v(a,function(e,t){var o=n;if(t.value===u||t.text===u)throw new Error('each option needs a "value" property and a "text" property');t.group&&(i[t.group]||(i[t.group]=p('<optgroup />').attr('label',t.group)),o=i[t.group]);var a=p(f.option);a.attr('value',t.value).text(t.text),o.append(a)}),v(i,function(e,t){n.append(t)}),n.val(r.value);break;case'checkbox':var l=p.isArray(r.value)?r.value:[r.value];if(!(a=r.inputOptions||[]).length)throw new Error('prompt with "inputType" set to "checkbox" requires at least one option');n=p('<div class="bootbox-checkbox-list"></div>'),v(a,function(e,o){if(o.value===u||o.text===u)throw new Error('each option needs a "value" property and a "text" property');var a=p(f.inputs[r.inputType]);a.find('input').attr('value',o.value),a.find('label').append('\n'+o.text),v(l,function(e,t){t===o.value&&a.find('input').prop('checked',!0)}),n.append(a)});break;case'radio':if(r.value!==u&&p.isArray(r.value))throw new Error('prompt with "inputType" set to "radio" requires a single, non-array value for "value"');if(!(a=r.inputOptions||[]).length)throw new Error('prompt with "inputType" set to "radio" requires at least one option');n=p('<div class="bootbox-radiobutton-list"></div>');var s=!0;v(a,function(e,t){if(t.value===u||t.text===u)throw new Error('each option needs a "value" property and a "text" property');var o=p(f.inputs[r.inputType]);o.find('input').attr('value',t.value),o.find('label').append('\n'+t.text),r.value!==u&&t.value===r.value&&(o.find('input').prop('checked',!0),s=!1),n.append(o)}),s&&n.find('input[type="radio"]').first().prop('checked',!0)}if(e.append(n),e.on('submit',function(e){e.preventDefault(),e.stopPropagation(),t.find('.bootbox-accept').trigger('click')}),''!==p.trim(r.message)){var c=p(f.promptMessage).html(r.message);e.prepend(c),r.message=e}else r.message=e;return(t=d.dialog(r)).off('shown.bs.modal'),t.on('shown.bs.modal',function(){n.focus()}),!0===o&&t.modal('show'),t},d.addLocale('en',{OK:'OK',CANCEL:'Cancel',CONFIRM:'OK'}),d});
/**
 * @license
 * =========================================================
 * bootstrap-datetimepicker.js
 * http://www.eyecon.ro/bootstrap-datepicker
 * =========================================================
 * Copyright 2012 Stefan Petre
 *
 * Contributions:
 *  - Andrew Rowls
 *  - Thiago de Arruda
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =========================================================
 */
(function($){var smartPhone=window.orientation!=undefined;var DateTimePicker=function(element,options){this.id=dpgId++;this.init(element,options)};var dateToDate=function(dt){if(typeof dt==="string"){return new Date(dt)}return dt};DateTimePicker.prototype={constructor:DateTimePicker,init:function(element,options){var icon;if(!(options.pickTime||options.pickDate))throw new Error("Must choose at least one picker");this.options=options;this.$element=$(element);this.language=options.language in dates?options.language:"en";this.pickDate=options.pickDate;this.pickTime=options.pickTime;this.isInput=this.$element.is("input");this.component=false;if(this.$element.find(".input-append")||this.$element.find(".input-prepend"))this.component=this.$element.find(".add-on");this.format=options.format;if(!this.format){if(this.isInput)this.format=this.$element.data("format");else this.format=this.$element.find("input").data("format");if(!this.format)this.format="MM/dd/yyyy"}this._compileFormat();if(this.component){icon=this.component.find("i")}if(this.pickTime){if(icon&&icon.length)this.timeIcon=icon.data("time-icon");if(!this.timeIcon)this.timeIcon="icon-time";icon.addClass(this.timeIcon)}if(this.pickDate){if(icon&&icon.length)this.dateIcon=icon.data("date-icon");if(!this.dateIcon)this.dateIcon="icon-calendar";icon.removeClass(this.timeIcon);icon.addClass(this.dateIcon)}this.widget=$(getTemplate(this.timeIcon,options.pickDate,options.pickTime,options.pick12HourFormat,options.pickSeconds,options.collapse)).appendTo("body");this.minViewMode=options.minViewMode||this.$element.data("date-minviewmode")||0;if(typeof this.minViewMode==="string"){switch(this.minViewMode){case"months":this.minViewMode=1;break;case"years":this.minViewMode=2;break;default:this.minViewMode=0;break}}this.viewMode=options.viewMode||this.$element.data("date-viewmode")||0;if(typeof this.viewMode==="string"){switch(this.viewMode){case"months":this.viewMode=1;break;case"years":this.viewMode=2;break;default:this.viewMode=0;break}}this.startViewMode=this.viewMode;this.weekStart=options.weekStart||this.$element.data("date-weekstart")||0;this.weekEnd=this.weekStart===0?6:this.weekStart-1;this.setStartDate(options.startDate||this.$element.data("date-startdate"));this.setEndDate(options.endDate||this.$element.data("date-enddate"));this.fillDow();this.fillMonths();this.fillHours();this.fillMinutes();this.fillSeconds();this.update();this.showMode();this._attachDatePickerEvents()},show:function(e){this.widget.show();this.height=this.component?this.component.outerHeight():this.$element.outerHeight();this.place();this.$element.trigger({type:"show",date:this._date});this._attachDatePickerGlobalEvents();if(e){e.stopPropagation();e.preventDefault()}},disable:function(){this.$element.find("input").prop("disabled",true);this._detachDatePickerEvents()},enable:function(){this.$element.find("input").prop("disabled",false);this._attachDatePickerEvents()},hide:function(){var collapse=this.widget.find(".collapse");for(var i=0;i<collapse.length;i++){var collapseData=collapse.eq(i).data("collapse");if(collapseData&&collapseData.transitioning)return}this.widget.hide();this.viewMode=this.startViewMode;this.showMode();this.set();this.$element.trigger({type:"hide",date:this._date});this._detachDatePickerGlobalEvents()},set:function(){var formatted="";if(!this._unset)formatted=this.formatDate(this._date);if(!this.isInput){if(this.component){var input=this.$element.find("input");input.val(formatted);this._resetMaskPos(input)}this.$element.data("date",formatted)}else{this.$element.val(formatted);this._resetMaskPos(this.$element)}},setValue:function(newDate){if(!newDate){this._unset=true}else{this._unset=false}if(typeof newDate==="string"){this._date=this.parseDate(newDate)}else if(newDate){this._date=new Date(newDate)}this.set();this.viewDate=UTCDate(this._date.getUTCFullYear(),this._date.getUTCMonth(),1,0,0,0,0);this.fillDate();this.fillTime()},getDate:function(){if(this._unset)return null;return new Date(this._date.valueOf())},setDate:function(date){if(!date)this.setValue(null);else this.setValue(date.valueOf())},setStartDate:function(date){if(date instanceof Date){this.startDate=date}else if(typeof date==="string"){this.startDate=new UTCDate(date);if(!this.startDate.getUTCFullYear()){this.startDate=-Infinity}}else{this.startDate=-Infinity}if(this.viewDate){this.update()}},setEndDate:function(date){if(date instanceof Date){this.endDate=date}else if(typeof date==="string"){this.endDate=new UTCDate(date);if(!this.endDate.getUTCFullYear()){this.endDate=Infinity}}else{this.endDate=Infinity}if(this.viewDate){this.update()}},getLocalDate:function(){if(this._unset)return null;var d=this._date;return new Date(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate(),d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds())},setLocalDate:function(localDate){if(!localDate)this.setValue(null);else this.setValue(Date.UTC(localDate.getFullYear(),localDate.getMonth(),localDate.getDate(),localDate.getHours(),localDate.getMinutes(),localDate.getSeconds(),localDate.getMilliseconds()))},place:function(){var position="absolute";var offset=this.component?this.component.offset():this.$element.offset();this.width=this.component?this.component.outerWidth():this.$element.outerWidth();offset.top=offset.top+this.height;var $window=$(window);if(this.options.width!=undefined){this.widget.width(this.options.width)}if(this.options.orientation=="left"){this.widget.addClass("left-oriented");offset.left=offset.left-this.widget.width()+20}if(this._isInFixed()){position="fixed";offset.top-=$window.scrollTop();offset.left-=$window.scrollLeft()}if($window.width()<offset.left+this.widget.outerWidth()){offset.right=$window.width()-offset.left-this.width;offset.left="auto";this.widget.addClass("pull-right")}else{offset.right="auto";this.widget.removeClass("pull-right")}this.widget.css({position:position,top:offset.top,left:offset.left,right:offset.right})},notifyChange:function(){this.$element.trigger({type:"changeDate",date:this.getDate(),localDate:this.getLocalDate()})},update:function(newDate){var dateStr=newDate;if(!dateStr){if(this.isInput){dateStr=this.$element.val()}else{dateStr=this.$element.find("input").val()}if(dateStr){this._date=this.parseDate(dateStr)}if(!this._date){var tmp=new Date;this._date=UTCDate(tmp.getFullYear(),tmp.getMonth(),tmp.getDate(),tmp.getHours(),tmp.getMinutes(),tmp.getSeconds(),tmp.getMilliseconds())}}this.viewDate=UTCDate(this._date.getUTCFullYear(),this._date.getUTCMonth(),1,0,0,0,0);this.fillDate();this.fillTime()},fillDow:function(){var dowCnt=this.weekStart;var html=$("<tr>");while(dowCnt<this.weekStart+7){html.append('<th class="dow">'+dates[this.language].daysMin[dowCnt++%7]+"</th>")}this.widget.find(".datepicker-days thead").append(html)},fillMonths:function(){var html="";var i=0;while(i<12){html+='<span class="month">'+dates[this.language].monthsShort[i++]+"</span>"}this.widget.find(".datepicker-months td").append(html)},fillDate:function(){var year=this.viewDate.getUTCFullYear();var month=this.viewDate.getUTCMonth();var currentDate=UTCDate(this._date.getUTCFullYear(),this._date.getUTCMonth(),this._date.getUTCDate(),0,0,0,0);var startYear=typeof this.startDate==="object"?this.startDate.getUTCFullYear():-Infinity;var startMonth=typeof this.startDate==="object"?this.startDate.getUTCMonth():-1;var endYear=typeof this.endDate==="object"?this.endDate.getUTCFullYear():Infinity;var endMonth=typeof this.endDate==="object"?this.endDate.getUTCMonth():12;this.widget.find(".datepicker-days").find(".disabled").removeClass("disabled");this.widget.find(".datepicker-months").find(".disabled").removeClass("disabled");this.widget.find(".datepicker-years").find(".disabled").removeClass("disabled");this.widget.find(".datepicker-days th:eq(1)").text(dates[this.language].months[month]+" "+year);var prevMonth=UTCDate(year,month-1,28,0,0,0,0);var day=DPGlobal.getDaysInMonth(prevMonth.getUTCFullYear(),prevMonth.getUTCMonth());prevMonth.setUTCDate(day);prevMonth.setUTCDate(day-(prevMonth.getUTCDay()-this.weekStart+7)%7);if(year==startYear&&month<=startMonth||year<startYear){this.widget.find(".datepicker-days th:eq(0)").addClass("disabled")}if(year==endYear&&month>=endMonth||year>endYear){this.widget.find(".datepicker-days th:eq(2)").addClass("disabled")}var nextMonth=new Date(prevMonth.valueOf());nextMonth.setUTCDate(nextMonth.getUTCDate()+42);nextMonth=nextMonth.valueOf();var html=[];var row;var clsName;while(prevMonth.valueOf()<nextMonth){if(prevMonth.getUTCDay()===this.weekStart){row=$("<tr>");html.push(row)}clsName="";if(prevMonth.getUTCFullYear()<year||prevMonth.getUTCFullYear()==year&&prevMonth.getUTCMonth()<month){clsName+=" old"}else if(prevMonth.getUTCFullYear()>year||prevMonth.getUTCFullYear()==year&&prevMonth.getUTCMonth()>month){clsName+=" new"}if(prevMonth.valueOf()===currentDate.valueOf()){clsName+=" active"}if(prevMonth.valueOf()+864e5<=this.startDate){clsName+=" disabled"}if(prevMonth.valueOf()>this.endDate){clsName+=" disabled"}row.append('<td class="day'+clsName+'">'+prevMonth.getUTCDate()+"</td>");prevMonth.setUTCDate(prevMonth.getUTCDate()+1)}this.widget.find(".datepicker-days tbody").empty().append(html);var currentYear=this._date.getUTCFullYear();var months=this.widget.find(".datepicker-months").find("th:eq(1)").text(year).end().find("span").removeClass("active");if(currentYear===year){months.eq(this._date.getUTCMonth()).addClass("active")}if(currentYear-1<startYear){this.widget.find(".datepicker-months th:eq(0)").addClass("disabled")}if(currentYear+1>endYear){this.widget.find(".datepicker-months th:eq(2)").addClass("disabled")}for(var i=0;i<12;i++){if(year==startYear&&startMonth>i||year<startYear){$(months[i]).addClass("disabled")}else if(year==endYear&&endMonth<i||year>endYear){$(months[i]).addClass("disabled")}}html="";year=parseInt(year/10,10)*10;var yearCont=this.widget.find(".datepicker-years").find("th:eq(1)").text(year+"-"+(year+9)).end().find("td");this.widget.find(".datepicker-years").find("th").removeClass("disabled");if(startYear>year){this.widget.find(".datepicker-years").find("th:eq(0)").addClass("disabled")}if(endYear<year+9){this.widget.find(".datepicker-years").find("th:eq(2)").addClass("disabled")}year-=1;for(var i=-1;i<11;i++){html+='<span class="year'+(i===-1||i===10?" old":"")+(currentYear===year?" active":"")+(year<startYear||year>endYear?" disabled":"")+'">'+year+"</span>";year+=1}yearCont.html(html)},fillHours:function(){var table=this.widget.find(".timepicker .timepicker-hours table");table.parent().hide();var html="";if(this.options.pick12HourFormat){var current=1;for(var i=0;i<3;i+=1){html+="<tr>";for(var j=0;j<4;j+=1){var c=current.toString();html+='<td class="hour">'+padLeft(c,2,"0")+"</td>";current++}html+="</tr>"}}else{var current=0;for(var i=0;i<6;i+=1){html+="<tr>";for(var j=0;j<4;j+=1){var c=current.toString();html+='<td class="hour">'+padLeft(c,2,"0")+"</td>";current++}html+="</tr>"}}table.html(html)},fillMinutes:function(){var table=this.widget.find(".timepicker .timepicker-minutes table");table.parent().hide();var html="";var current=0;for(var i=0;i<5;i++){html+="<tr>";for(var j=0;j<4;j+=1){var c=current.toString();html+='<td class="minute">'+padLeft(c,2,"0")+"</td>";current+=3}html+="</tr>"}table.html(html)},fillSeconds:function(){var table=this.widget.find(".timepicker .timepicker-seconds table");table.parent().hide();var html="";var current=0;for(var i=0;i<5;i++){html+="<tr>";for(var j=0;j<4;j+=1){var c=current.toString();html+='<td class="second">'+padLeft(c,2,"0")+"</td>";current+=3}html+="</tr>"}table.html(html)},fillTime:function(){if(!this._date)return;var timeComponents=this.widget.find(".timepicker span[data-time-component]");var table=timeComponents.closest("table");var is12HourFormat=this.options.pick12HourFormat;var hour=this._date.getUTCHours();var period="AM";if(is12HourFormat){if(hour>=12)period="PM";if(hour===0)hour=12;else if(hour!=12)hour=hour%12;this.widget.find(".timepicker [data-action=togglePeriod]").text(period)}hour=padLeft(hour.toString(),2,"0");var minute=padLeft(this._date.getUTCMinutes().toString(),2,"0");var second=padLeft(this._date.getUTCSeconds().toString(),2,"0");timeComponents.filter("[data-time-component=hours]").text(hour);timeComponents.filter("[data-time-component=minutes]").text(minute);timeComponents.filter("[data-time-component=seconds]").text(second)},click:function(e){e.stopPropagation();e.preventDefault();this._unset=false;var target=$(e.target).closest("span, td, th");if(target.length===1){if(!target.is(".disabled")){switch(target[0].nodeName.toLowerCase()){case"th":switch(target[0].className){case"switch":this.showMode(1);break;case"prev":case"next":var vd=this.viewDate;var navFnc=DPGlobal.modes[this.viewMode].navFnc;var step=DPGlobal.modes[this.viewMode].navStep;if(target[0].className==="prev")step=step*-1;vd["set"+navFnc](vd["get"+navFnc]()+step);this.fillDate();this.set();break}break;case"span":if(target.is(".month")){var month=target.parent().find("span").index(target);this.viewDate.setUTCMonth(month)}else{var year=parseInt(target.text(),10)||0;this.viewDate.setUTCFullYear(year)}if(this.viewMode!==0){this._date=UTCDate(this.viewDate.getUTCFullYear(),this.viewDate.getUTCMonth(),this.viewDate.getUTCDate(),this._date.getUTCHours(),this._date.getUTCMinutes(),this._date.getUTCSeconds(),this._date.getUTCMilliseconds());this.notifyChange()}this.showMode(-1);this.fillDate();this.set();break;case"td":if(target.is(".day")){var day=parseInt(target.text(),10)||1;var month=this.viewDate.getUTCMonth();var year=this.viewDate.getUTCFullYear();if(target.is(".old")){if(month===0){month=11;year-=1}else{month-=1}}else if(target.is(".new")){if(month==11){month=0;year+=1}else{month+=1}}this._date=UTCDate(year,month,day,this._date.getUTCHours(),this._date.getUTCMinutes(),this._date.getUTCSeconds(),this._date.getUTCMilliseconds());this.viewDate=UTCDate(year,month,Math.min(28,day),0,0,0,0);this.fillDate();this.set();this.notifyChange()}break}}}},actions:{incrementHours:function(e){this._date.setUTCHours(this._date.getUTCHours()+1)},incrementMinutes:function(e){this._date.setUTCMinutes(this._date.getUTCMinutes()+1)},incrementSeconds:function(e){this._date.setUTCSeconds(this._date.getUTCSeconds()+1)},decrementHours:function(e){this._date.setUTCHours(this._date.getUTCHours()-1)},decrementMinutes:function(e){this._date.setUTCMinutes(this._date.getUTCMinutes()-1)},decrementSeconds:function(e){this._date.setUTCSeconds(this._date.getUTCSeconds()-1)},togglePeriod:function(e){var hour=this._date.getUTCHours();if(hour>=12)hour-=12;else hour+=12;this._date.setUTCHours(hour)},showPicker:function(){this.widget.find(".timepicker > div:not(.timepicker-picker)").hide();this.widget.find(".timepicker .timepicker-picker").show()},showHours:function(){this.widget.find(".timepicker .timepicker-picker").hide();this.widget.find(".timepicker .timepicker-hours").show()},showMinutes:function(){this.widget.find(".timepicker .timepicker-picker").hide();this.widget.find(".timepicker .timepicker-minutes").show()},showSeconds:function(){this.widget.find(".timepicker .timepicker-picker").hide();this.widget.find(".timepicker .timepicker-seconds").show()},selectHour:function(e){var tgt=$(e.target);var value=parseInt(tgt.text(),10);if(this.options.pick12HourFormat){var current=this._date.getUTCHours();if(current>=12){if(value!=12)value=(value+12)%24}else{if(value===12)value=0;else value=value%12}}this._date.setUTCHours(value);this.actions.showPicker.call(this)},selectMinute:function(e){var tgt=$(e.target);var value=parseInt(tgt.text(),10);this._date.setUTCMinutes(value);this.actions.showPicker.call(this)},selectSecond:function(e){var tgt=$(e.target);var value=parseInt(tgt.text(),10);this._date.setUTCSeconds(value);this.actions.showPicker.call(this)}},doAction:function(e){e.stopPropagation();e.preventDefault();if(!this._date)this._date=UTCDate(1970,0,0,0,0,0,0);var action=$(e.currentTarget).data("action");var rv=this.actions[action].apply(this,arguments);this.set();this.fillTime();this.notifyChange();return rv},stopEvent:function(e){e.stopPropagation();e.preventDefault()},keydown:function(e){var self=this,k=e.which,input=$(e.target);if(k==8||k==46){setTimeout(function(){self._resetMaskPos(input)})}},keypress:function(e){var k=e.which;if(k==8||k==46){return}var input=$(e.target);var c=String.fromCharCode(k);var val=input.val()||"";val+=c;var mask=this._mask[this._maskPos];if(!mask){return false}if(mask.end!=val.length){return}if(!mask.pattern.test(val.slice(mask.start))){val=val.slice(0,val.length-1);while((mask=this._mask[this._maskPos])&&mask.character){val+=mask.character;this._maskPos++}val+=c;if(mask.end!=val.length){input.val(val);return false}else{if(!mask.pattern.test(val.slice(mask.start))){input.val(val.slice(0,mask.start));return false}else{input.val(val);this._maskPos++;return false}}}else{this._maskPos++}},change:function(e){var input=$(e.target);var val=input.val();if(this._formatPattern.test(val)){this.update();this.setValue(this._date.getTime());this.notifyChange();this.set()}else if(val&&val.trim()){this.setValue(this._date.getTime());if(this._date)this.set();else input.val("")}else{if(this._date){this.setValue(null);this.notifyChange();this._unset=true}}this._resetMaskPos(input)},showMode:function(dir){if(dir){this.viewMode=Math.max(this.minViewMode,Math.min(2,this.viewMode+dir))}this.widget.find(".datepicker > div").hide().filter(".datepicker-"+DPGlobal.modes[this.viewMode].clsName).show()},destroy:function(){this._detachDatePickerEvents();this._detachDatePickerGlobalEvents();this.widget.remove();this.$element.removeData("datetimepicker");this.component.removeData("datetimepicker")},formatDate:function(d){return this.format.replace(formatReplacer,function(match){var methodName,property,rv,len=match.length;if(match==="ms")len=1;property=dateFormatComponents[match].property;if(property==="Hours12"){rv=d.getUTCHours();if(rv===0)rv=12;else if(rv!==12)rv=rv%12}else if(property==="Period12"){if(d.getUTCHours()>=12)return"PM";else return"AM"}else{methodName="get"+property;rv=d[methodName]()}if(methodName==="getUTCMonth")rv=rv+1;if(methodName==="getUTCYear")rv=rv+1900-2e3;return padLeft(rv.toString(),len,"0")})},parseDate:function(str){var match,i,property,methodName,value,parsed={};if(!(match=this._formatPattern.exec(str)))return null;for(i=1;i<match.length;i++){property=this._propertiesByIndex[i];if(!property)continue;value=match[i];if(/^\d+$/.test(value))value=parseInt(value,10);parsed[property]=value}return this._finishParsingDate(parsed)},_resetMaskPos:function(input){var val=input.val();for(var i=0;i<this._mask.length;i++){if(this._mask[i].end>val.length){this._maskPos=i;break}else if(this._mask[i].end===val.length){this._maskPos=i+1;break}}},_finishParsingDate:function(parsed){var year,month,date,hours,minutes,seconds,milliseconds;year=parsed.UTCFullYear;if(parsed.UTCYear)year=2e3+parsed.UTCYear;if(!year)year=1970;if(parsed.UTCMonth)month=parsed.UTCMonth-1;else month=0;date=parsed.UTCDate||1;hours=parsed.UTCHours||0;minutes=parsed.UTCMinutes||0;seconds=parsed.UTCSeconds||0;milliseconds=parsed.UTCMilliseconds||0;if(parsed.Hours12){hours=parsed.Hours12}if(parsed.Period12){if(/pm/i.test(parsed.Period12)){if(hours!=12)hours=(hours+12)%24}else{hours=hours%12}}return UTCDate(year,month,date,hours,minutes,seconds,milliseconds)},_compileFormat:function(){var match,component,components=[],mask=[],str=this.format,propertiesByIndex={},i=0,pos=0;while(match=formatComponent.exec(str)){component=match[0];if(component in dateFormatComponents){i++;propertiesByIndex[i]=dateFormatComponents[component].property;components.push("\\s*"+dateFormatComponents[component].getPattern(this)+"\\s*");mask.push({pattern:new RegExp(dateFormatComponents[component].getPattern(this)),property:dateFormatComponents[component].property,start:pos,end:pos+=component.length})}else{components.push(escapeRegExp(component));mask.push({pattern:new RegExp(escapeRegExp(component)),character:component,start:pos,end:++pos})}str=str.slice(component.length)}this._mask=mask;this._maskPos=0;this._formatPattern=new RegExp("^\\s*"+components.join("")+"\\s*$");this._propertiesByIndex=propertiesByIndex},_attachDatePickerEvents:function(){var self=this;this.widget.on("click",".datepicker *",$.proxy(this.click,this));this.widget.on("click","[data-action]",$.proxy(this.doAction,this));this.widget.on("mousedown",$.proxy(this.stopEvent,this));if(this.pickDate&&this.pickTime){this.widget.on("click.togglePicker",".accordion-toggle",function(e){e.stopPropagation();var $this=$(this);var $parent=$this.closest("ul");var expanded=$parent.find(".collapse.in");var closed=$parent.find(".collapse:not(.in)");if(expanded&&expanded.length){var collapseData=expanded.data("collapse");if(collapseData&&collapseData.transitioning)return;expanded.collapse("hide");closed.collapse("show");$this.find("i").toggleClass(self.timeIcon+" "+self.dateIcon);self.$element.find(".add-on i").toggleClass(self.timeIcon+" "+self.dateIcon)}})}if(this.isInput){this.$element.on({focus:$.proxy(this.show,this),change:$.proxy(this.change,this)});if(this.options.maskInput){this.$element.on({keydown:$.proxy(this.keydown,this),keypress:$.proxy(this.keypress,this)})}}else{this.$element.on({change:$.proxy(this.change,this)},"input");if(this.options.maskInput){this.$element.on({keydown:$.proxy(this.keydown,this),keypress:$.proxy(this.keypress,this)},"input")}if(this.component){this.component.on("click",$.proxy(this.show,this))}else{this.$element.on("click",$.proxy(this.show,this))}}},_attachDatePickerGlobalEvents:function(){$(window).on("resize.datetimepicker"+this.id,$.proxy(this.place,this));if(!this.isInput){$(document).on("mousedown.datetimepicker"+this.id,$.proxy(this.hide,this))}},_detachDatePickerEvents:function(){this.widget.off("click",".datepicker *",this.click);this.widget.off("click","[data-action]");this.widget.off("mousedown",this.stopEvent);if(this.pickDate&&this.pickTime){this.widget.off("click.togglePicker")}if(this.isInput){this.$element.off({focus:this.show,change:this.change});if(this.options.maskInput){this.$element.off({keydown:this.keydown,keypress:this.keypress})}}else{this.$element.off({change:this.change},"input");if(this.options.maskInput){this.$element.off({keydown:this.keydown,keypress:this.keypress},"input")}if(this.component){this.component.off("click",this.show)}else{this.$element.off("click",this.show)}}},_detachDatePickerGlobalEvents:function(){$(window).off("resize.datetimepicker"+this.id);if(!this.isInput){$(document).off("mousedown.datetimepicker"+this.id)}},_isInFixed:function(){if(this.$element){var parents=this.$element.parents();var inFixed=false;for(var i=0;i<parents.length;i++){if($(parents[i]).css("position")=="fixed"){inFixed=true;break}}return inFixed}else{return false}}};$.fn.datetimepicker=function(option,val){return this.each(function(){var $this=$(this),data=$this.data("datetimepicker"),options=typeof option==="object"&&option;if(!data){$this.data("datetimepicker",data=new DateTimePicker(this,$.extend({},$.fn.datetimepicker.defaults,options)))}if(typeof option==="string")data[option](val)})};$.fn.datetimepicker.defaults={maskInput:false,pickDate:true,pickTime:true,pick12HourFormat:false,pickSeconds:true,startDate:-Infinity,endDate:Infinity,collapse:true};$.fn.datetimepicker.Constructor=DateTimePicker;var dpgId=0;var dates=$.fn.datetimepicker.dates={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}};var dateFormatComponents={dd:{property:"UTCDate",getPattern:function(){return"(0?[1-9]|[1-2][0-9]|3[0-1])\\b"}},MM:{property:"UTCMonth",getPattern:function(){return"(0?[1-9]|1[0-2])\\b"}},yy:{property:"UTCYear",getPattern:function(){return"(\\d{2})\\b"}},yyyy:{property:"UTCFullYear",getPattern:function(){return"(\\d{4})\\b"}},hh:{property:"UTCHours",getPattern:function(){return"(0?[0-9]|1[0-9]|2[0-3])\\b"}},mm:{property:"UTCMinutes",getPattern:function(){return"(0?[0-9]|[1-5][0-9])\\b"}},ss:{property:"UTCSeconds",getPattern:function(){return"(0?[0-9]|[1-5][0-9])\\b"}},ms:{property:"UTCMilliseconds",getPattern:function(){return"([0-9]{1,3})\\b"}},HH:{property:"Hours12",getPattern:function(){return"(0?[1-9]|1[0-2])\\b"}},PP:{property:"Period12",getPattern:function(){return"(AM|PM|am|pm|Am|aM|Pm|pM)\\b"}}};var keys=[];for(var k in dateFormatComponents)keys.push(k);keys[keys.length-1]+="\\b";keys.push(".");var formatComponent=new RegExp(keys.join("\\b|"));keys.pop();var formatReplacer=new RegExp(keys.join("\\b|"),"g");function escapeRegExp(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function padLeft(s,l,c){if(l<s.length)return s;else return Array(l-s.length+1).join(c||" ")+s}function getTemplate(timeIcon,pickDate,pickTime,is12Hours,showSeconds,collapse){if(pickDate&&pickTime){return'<div class="bootstrap-datetimepicker-widget dropdown-menu">'+"<ul>"+"<li"+(collapse?' class="collapse in"':"")+">"+'<div class="datepicker">'+DPGlobal.template+"</div>"+"</li>"+'<li class="picker-switch accordion-toggle"><a><i class="'+timeIcon+'"></i></a></li>'+"<li"+(collapse?' class="collapse"':"")+">"+'<div class="timepicker">'+TPGlobal.getTemplate(is12Hours,showSeconds)+"</div>"+"</li>"+"</ul>"+"</div>"}else if(pickTime){return'<div class="bootstrap-datetimepicker-widget dropdown-menu">'+'<div class="timepicker">'+TPGlobal.getTemplate(is12Hours,showSeconds)+"</div>"+"</div>"}else{return'<div class="bootstrap-datetimepicker-widget dropdown-menu">'+'<div class="datepicker">'+DPGlobal.template+"</div>"+"</div>"}}function UTCDate(){return new Date(Date.UTC.apply(Date,arguments))}var DPGlobal={modes:[{clsName:"days",navFnc:"UTCMonth",navStep:1},{clsName:"months",navFnc:"UTCFullYear",navStep:1},{clsName:"years",navFnc:"UTCFullYear",navStep:10}],isLeapYear:function(year){return year%4===0&&year%100!==0||year%400===0},getDaysInMonth:function(year,month){return[31,DPGlobal.isLeapYear(year)?29:28,31,30,31,30,31,31,30,31,30,31][month]},headTemplate:"<thead>"+"<tr>"+'<th class="prev">&lsaquo;</th>'+'<th colspan="5" class="switch"></th>'+'<th class="next">&rsaquo;</th>'+"</tr>"+"</thead>",contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>'};DPGlobal.template='<div class="datepicker-days">'+'<table class="table-condensed">'+DPGlobal.headTemplate+"<tbody></tbody>"+"</table>"+"</div>"+'<div class="datepicker-months">'+'<table class="table-condensed">'+DPGlobal.headTemplate+DPGlobal.contTemplate+"</table>"+"</div>"+'<div class="datepicker-years">'+'<table class="table-condensed">'+DPGlobal.headTemplate+DPGlobal.contTemplate+"</table>"+"</div>";var TPGlobal={hourTemplate:'<span data-action="showHours" data-time-component="hours" class="timepicker-hour"></span>',minuteTemplate:'<span data-action="showMinutes" data-time-component="minutes" class="timepicker-minute"></span>',secondTemplate:'<span data-action="showSeconds" data-time-component="seconds" class="timepicker-second"></span>'};TPGlobal.getTemplate=function(is12Hours,showSeconds){return'<div class="timepicker-picker">'+'<table class="table-condensed"'+(is12Hours?' data-hour-format="12"':"")+">"+"<tr>"+'<td><a href="#" class="btn" data-action="incrementHours"><i class="icon-chevron-up"></i></a></td>'+'<td class="separator"></td>'+'<td><a href="#" class="btn" data-action="incrementMinutes"><i class="icon-chevron-up"></i></a></td>'+(showSeconds?'<td class="separator"></td>'+'<td><a href="#" class="btn" data-action="incrementSeconds"><i class="icon-chevron-up"></i></a></td>':"")+(is12Hours?'<td class="separator"></td>':"")+"</tr>"+"<tr>"+"<td>"+TPGlobal.hourTemplate+"</td> "+'<td class="separator">:</td>'+"<td>"+TPGlobal.minuteTemplate+"</td> "+(showSeconds?'<td class="separator">:</td>'+"<td>"+TPGlobal.secondTemplate+"</td>":"")+(is12Hours?'<td class="separator"></td>'+"<td>"+'<button type="button" class="btn btn-primary" data-action="togglePeriod"></button>'+"</td>":"")+"</tr>"+"<tr>"+'<td><a href="#" class="btn" data-action="decrementHours"><i class="icon-chevron-down"></i></a></td>'+'<td class="separator"></td>'+'<td><a href="#" class="btn" data-action="decrementMinutes"><i class="icon-chevron-down"></i></a></td>'+(showSeconds?'<td class="separator"></td>'+'<td><a href="#" class="btn" data-action="decrementSeconds"><i class="icon-chevron-down"></i></a></td>':"")+(is12Hours?'<td class="separator"></td>':"")+"</tr>"+"</table>"+"</div>"+'<div class="timepicker-hours" data-action="selectHour">'+'<table class="table-condensed">'+"</table>"+"</div>"+'<div class="timepicker-minutes" data-action="selectMinute">'+'<table class="table-condensed">'+"</table>"+"</div>"+(showSeconds?'<div class="timepicker-seconds" data-action="selectSecond">'+'<table class="table-condensed">'+"</table>"+"</div>":"")}})(window.jQuery);
$.pushNotificationForm = function (errorMsg, thankYouMsg, notificationId, fetchErrorMsg) {
    var formData = {};
    var isValidated = true;
    var $submitForm = $("input[name='pushNotificationSubmit']");
    $("input[name=appNotificationImagePath]").attr("disabled", "disabled");

    var showErrorModal = function (errorMessage, callback) {
        $('.ams-error-modal .modal-body p').html(errorMessage);
        $('.ams-error-modal').modal('show').on('hidden.bs.modal', callback);
    };

    if (notificationId) {
        fetchPushNotificationDetails(notificationId);
    }

    function fetchPushNotificationDetails(notificationId) {
        $('#modal-loader').modal("show");
        $.ajax({
            url: SIH.getEndPoint("/api/auth/pushNotification") + "/" + notificationId,
            type: 'GET',
            beforeSend: setAMSAuthTokenHeader

        }).done(function (data) {
            if (data) {
                handlePushNotificationData(data);
                $('#modal-loader').modal("hide");
            } else {
                $('.ams-error-modal .modal-body p').html($("#pushNotificationForm").data("fetch-error"));
                $('.ams-error-modal').modal('show');
            }
        }).fail(function (response) {
            if (response && response.status === 401) {
                $("#loginModal").modal("show");
            }
            else if (response && response.responseText) {
                $('.ams-error-modal .modal-body p').html(response.responseText);
                $('.ams-error-modal').modal('show');
            }
        });

    }

    function handlePushNotificationData(data) {
        var cities = [];
        for (var field in data) {
            var fieldValue = data["" + field];
            if (fieldValue != null) {
                if ($('[name=' + field + ']').is('textarea')) {
                    $("textarea[name=" + field + "]").val(fieldValue);
                } else if ((field === "web" || field === "app" || field === "dashboard") && fieldValue) {
                    $('input#' + field).prop("checked", true).trigger('change');
                } else if (field == "focusAreas" || field == "focusArea") {
                    populateFocusAreas(field, fieldValue);
                }
                else if ($('#' + field).is('select')) {
                    if (field == "userTypes") {
                        var stakeholders = [];
                        $(fieldValue).each(function () {
                            stakeholders.push(this.id);
                        });
                        $('#' + field).val(stakeholders);
                    } else {
                        $('#' + field).val(fieldValue);
                    }
                    $('#' + field).trigger("change");
                }
                else if ($.isArray(fieldValue)) {
                    $.each(fieldValue, function (idx, val) {
                        $("input[type=checkbox][value='" + val.state.id + "']").prop("checked", true);
                        $.each(val.cities, function (id, val) {
                            cities.push(val.id);
                        });
                    });
                } else {
                    $("input[name=" + field + "]").val(fieldValue);
                }
            }
        }

        $(".selectionwithalloption #states").trigger("change", ["", {"cities": cities}]);
        $('.addContainer').each(function () {
            var checkedInputs = $(this).find('input.addAll:checked').length;
            if (checkedInputs && (checkedInputs == $(this).find('input.addAll').length)) {
                $(this).find("input[name=addAll]").prop('checked', true);
            }
        });

        if (data['notificationStatus'] === 'COMPLETED') {
            $('#pushNotificationForm input[type=text],#pushNotificationForm select.form-control,#pushNotificationForm ,#pushNotificationForm .customised-dropdown').attr("disabled", "disabled");
            $('#pushNotificationForm input[name=pushNotificationSubmit]').hide();
        }
    }

    function validateForm(requiredFields, isValidated) {
        isValidated = true;
        $.each(requiredFields, function (index, item) {
            var element = $(item).closest('.form-group').find(".form-control:not(.richTextarea,.customised-dropdown)");
            if (element && element.length > 0 && !element.closest(".modal").length) {
                if (element.attr("type") === "radio") {
                    if (element.is(':checked')) {
                        element.closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
                    }
                    else {
                        element.closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field cannot be left Blank.");
                        isValidated = false;
                    }
                } else if (element.attr("type") === "checkbox" && element.attr("name") === "notificationType" && $('input[name=notificationType]:checked').length === 0) {
                    isValidated = false;
                    showErrorState(element, true);
                } else if (!element.val() || element.val() === "") {
                    isValidated = false;
                    showErrorState(element, true);
                }
                else {
                    showErrorState(element, false);
                }
            }
        });
        var richTextAreas = $('.form-control.richTextarea');
        $.each(richTextAreas, function (index, item) {
            var el = $(item);
            if (el.closest('.form-group').find('sup.required').length > 0) {
                var note = el.val().trim();
                if (note.length > 0 && !el.summernote('isEmpty')) {
                    el.siblings('.note-editor.note-frame').removeClass('note-has-error').addClass('note-writer-text');
                    showErrorState(el, false);
                } else {
                    isValidated = false;
                    el.siblings('.note-editor.note-frame').addClass('note-has-error').removeClass('note-writer-text');
                    showErrorState(el, true);
                }
            }
        });
        var customizedDropDown = $('.form-control.customised-dropdown');
        $.each(customizedDropDown, function (index, item) {
            var el = $(item);
            if (el.closest('.form-group').find('sup.required').length > 0) {
                var selectedFields = el.find('select').length > 0 ? el.find('select option:selected') : el.find('input[type=checkbox]:checked');
                if (!selectedFields || selectedFields.length === 0) {
                    isValidated = false;
                    showErrorState(el, true);
                }
            }
        });

        var regexValidatedfields = $('#pushNotificationForm .regex-val');
        $.each(regexValidatedfields, function (index, item) {
            var element = $(item);
            var re = new RegExp(element.attr("regex"));
            if (element.val() && !re.test(element.val())) {
                isValidated = false;
                //showErrorState(element, true);
                element.closest(".form-group").addClass("has-error");
                element.siblings(".regex-msg").show();
            }
            else {
                if (!(element.closest(".form-group").has("sup.required") && !element.val())) {
                    showErrorState(element, false);
                }
                element.siblings(".regex-msg").hide();
            }
        });
        if ($("select[name=appNotificationLandingPage]").val() === "Dashboard/pushNotifications") {
            if (!$("input[name=appNotificationImagePath]").val()) {
                isValidated = false;
                showErrorState($("input[name=appNotificationImagePath]"), true);
            } else {
                showErrorState($("input[name=appNotificationImagePath]"), false);
            }
        } else {
            showErrorState($("input[name=appNotificationImagePath]"), false);
        }
        var scheduleTime = $('input[name=scheduledTime]').val();
        if (scheduleTime) {
            var scheduleDate = scheduleTime.split(' ');
            var scheduleTimeStr = scheduleDate[0].split('/');
            var scheduleTimeDate = new Date(scheduleTimeStr[1] + "/" + scheduleTimeStr[0] + "/" + scheduleTimeStr[2] + " " + scheduleDate[1]);
            if (scheduleTimeDate < new Date()) {
                isValidated = false;
                $('input[name=scheduledTime]').closest(".form-group").addClass("has-error").find("span.help-block").first().html("Selected Date/Time has passed. Kindly choose another Date/Time.");
            } else {
                $('input[name=scheduledTime]').closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
            }
        }
        if (!isValidated) {
            return false;
        }
        else {
            return true;
        }
    };

    function cleanFormErrors() {
        $('#pushNotificationForm .error-message').addClass('display-n');
        $('#pushNotificationForm .error-message .success-content,#pushNotificationForm .error-message .err-content').addClass('display-n');
    }

    $("select[name=appNotificationLandingPage]").change(function () {
        if ($("select[name=appNotificationLandingPage]").val() === "Dashboard/pushNotifications") {
            $("input[name=appNotificationImagePath]").removeAttr("disabled");
        } else {
            $("input[name=appNotificationImagePath]").attr("disabled", "disabled");
        }
    });

    function getFormData() {
        formData = {};
        isValidated = true;
        var attrValue = "";
        var inputField = $("#pushNotificationForm").find(".form-control:not(.richTextarea,.customised-dropdown)");
        formData["web"] = false;
        formData["app"] = false;
        $.each(inputField, function (index, inputSel) {
            var key = $(inputSel).attr("name");
            attrValue = $(inputSel).val();
            if (typeof key !== "undefined") {
                if ($(inputSel).attr("name") === "notificationType") {
                    $('input[name=notificationType]:checked').each(function () {
                        if ($(this).val() === "web") {
                            formData["web"] = true;
                        }
                        if ($(this).val() === "app") {
                            formData["app"] = true;
                        }
                        if ($(this).val() === "dashboard") {
                            formData["dashboard"] = true;
                        }
                    });
                } else if ($('#' + key).is('select') && key === 'userTypes') {
                    var valueArr = [];
                    $('#' + key).find('option:selected').each(function () {
                        var tagObject = {};
                        tagObject["id"] = $(this).val();
                        tagObject["name"] = $(this).text();
                        tagObject["text"] = $(this).text();
                        valueArr.push(tagObject);
                    });
                    formData["" + key] = valueArr;
                } else if (attrValue) {
                    formData[key] = attrValue.toString();
                }
            }
        });
        var richTextAreas = $("#pushNotificationForm").find('.form-control.richTextarea');
        $.each(richTextAreas, function (index, inputSel) {
            var key = $(inputSel).attr("name");
            attrValue = $(inputSel).val();
            if (typeof key != undefined && attrValue) {
                formData[key] = attrValue.toString();
            }
        });
        formData = addFocusAreas(formData);
        formData = addLocationDetails(formData);
    }

    var showSuccessMessage = function (successMessage) {
        var success = $('#pushNotification-success');
        success.show();
        success.html(successMessage);
        scrollTo(0, success.offset().top - 200);
    };

    function errorBlockScroll(formContainer) {
        $('.has-error').length ? $('html, body').animate({scrollTop: $('.has-error').offset().top - 200}, 500) : formScrollTop(formContainer);
    }

    function formScrollTop(formContainer) {
        $('html, body').animate({
            scrollTop: formContainer.offset().top - 200
        }, 500);
    }

    $('input[name=notificationType]').on('change', function () {
        if ($(this).attr("id") === "web") {
            if (!$('input[name=notificationType][id=dashboard]').prop("checked")) {
                $('input[name=webNotificationLandingPage]').parents('.columncontrol').toggleClass('display-n');
            }
        } else if ($(this).attr("id") === "dashboard") {
            $('select[name=dashboardNotificationCategory]').parents('.columncontrol').toggleClass('display-n');
            if ($('input[name=notificationType][id=web]').prop("checked")) {
                $('input[name=webNotificationLandingPage]').parents('.columncontrol').removeClass('display-n');
            } else {
                $('input[name=webNotificationLandingPage]').parents('.columncontrol').toggleClass('display-n');
            }
        } else {
            $('select#appNotificationLandingPage').parents('.columncontrol').toggleClass('display-n');
        }


    });
    $submitForm.on("click", function () {
        cleanFormErrors();
        if (validateForm($('form#pushNotificationForm sup.required:visible'))) {
            $submitForm.addClass("display-n");
            $('#modal-loader').modal("show");
            getFormData();
            formData["id"] = $('input[name=id]').val() ? $('input[name=id]').val() : null;
            $(this).parents(".form-group").removeClass("has-error").find("span.help-block").addClass("display-n");
            var url = (!$("input[name=scheduledTime]").val() && $('select[name=notificationStatus]').val() === 'ACTIVE') ?
                SIH.getEndPoint("/api/auth/pushNotification/send") :
                SIH.getEndPoint("/api/auth/pushNotification/save");
            $.ajax({
                type: "POST",
                data: JSON.stringify(formData),
                contentType: "application/json",
                url: url,
                headers: {"X-Auth-Token": store.getItem("token")}
            }).done(function (response) {
                $("input[name=id]").val(response.id);
                //showSuccessMessage(thankYouMsg);
                $('#modal-loader').modal("hide");
                bootbox.alert({
                    message: "Thank You.Your request has been submitted",
                    callback: function () {
                        goToDashboard();
                    }
                })
            }).error(function (error) {
                $('#modal-loader').modal("hide");
                if (error.status === 403) {
                    showErrorModal(errorMsg, goToDashboard);
                } else {
                    showErrorModal("Something went wrong. Please try again later.", goToDashboard);
                }
            });
        }
        else {
            errorBlockScroll("#pushNotificationForm");
            return false;
        }
    });
};
$.form80iac = function () {
    var cin;
    var tbl_condition;
    var table_name = "startup_registration";
    var authToken = store.getItem("token");
    getIncorpNo();   //"IV-190307687/2016";
    var data;
    var date;
    var current_date;
    var itr_date;
    var year_difference;
    var isValidated = false;
    var formData = new FormData();
    var saveApi = $("#saveApi").val();
    var link = $("#imageLink").val();
    $('.hasDatepicker').removeClass('hasDatepicker').datepicker({dateFormat: 'dd/mm/yy'});
    var inputTypes = ["text", "email", "number"];
    var itReturnArray = [{
        "s_no": "1",
        "it_return": "IT_returns_FY",
        "it_return_annual_year": "IT_returns_first_year",
        "it_return_year": "",
    }, {
        "s_no": "2",
        "it_return": "IT_returns_SY",
        "it_return_annual_year": "IT_returns_second_year",
        "it_return_year": "",
    }, {
        "s_no": "3",
        "it_return": "IT_returns_TY",
        "it_return_annual_year": "IT_returns_third_year",
        "it_return_year": "",
    },];

    var accountDetailArray = [{
        "s_no": "1",
        "balance_Sheet": "balance_sheet_FY",
        "Trading_and_Profit_Loss_Account": "trading_account_FY",
        "financial_year_name": "annual_accounts_first_year",
        "financial_year": ""
    }, {
        "s_no": "2",
        "balance_Sheet": "balance_sheet_SY",
        "Trading_and_Profit_Loss_Account": "trading_account_SY",
        "financial_year_name": "annual_accounts_second_year",
        "financial_year": ""
    }, {
        "s_no": "3",
        "balance_Sheet": "balance_sheet_TY",
        "Trading_and_Profit_Loss_Account": "trading_account_TY",
        "financial_year_name": "annual_accounts_third_year",
        "financial_year": ""
    },];


    function checkEligibility(data) {
        var isValidUser = true;
        var incorp_date = data['incorporation_date'];
        var dippNumber = data['randum_reg'];
        var nature_of_entity = data['nature_of_entity'];
        if (nature_of_entity === "3" || !dippNumber) {
            isValidUser = false;
        }
        else if (incorp_date) {
            var date = new Date(incorp_date);
            if (date < new Date("04/01/2016")) {
                isValidUser = false;
            }
        } else if (data.status && data.status !== "1") {
            isValidUser = false;
        } else if (data.recognization_certi_status === "2" || data.recognization_certi_status === "3") {
            isValidUser = false;
        } else if (data.eligibility_certi_status === "1" || data.eligibility_certi_status === "2") {
            isValidUser = false;
        } else if (data.cdate && data.tax_benifit === "0") {
            var d = new Date(data.cdate);
            if (d < new Date("05/01/2018")) {
                isValidUser = false;
            }
        } else if (data.dev_of_product_service === "1") {
            isValidUser = false;
        }
        if (!isValidUser) {
            $('#modal-loader').modal('hide');
            $('.recognition-error-modal .modal-body p').html("<h5>You are not eligible to fill this form. Only DIPP recognized Startups incorporated after 1st April 2016 may do so, provided:<h5><br> <ol type='a'><li>Application is not already under process</li> <li>The application has not been rejected in the past</li></ol>");
            $('.recognition-error-modal').modal('show');
        } else {
            eligibilitySuccess(data);
        }
        //eligibilitySuccess(data);
    }

    function fetchSuccess(message) {
        data = message[message.length -1];
        checkEligibility(data);
    }

    function eligibilitySuccess(data) {
        var user_form_status = data.status_80_iac;
        var place = data.place_80_iac;
        dateValidationForFinancialYear(data);
        var formFields = $('.startupRecognition.form80').find('.form-control:not(.richTextarea)');
        $.each(formFields, function (index, value) {
            var name = $(value).attr("name");
            var fieldValue = data[name];
            if (fieldValue) {
                if ($('[name=' + name + ']').is('input') && $.inArray($('input[name=' + name + ']').attr("type"), inputTypes) == -1) {
                    var fileEntity = $("input[name=upload_" + name + "]").siblings("a");
                    fileEntity.html("View Document").removeClass("display-n");
                    fileEntity.prop("href", link + fieldValue);
                    fileEntity.prop("target", "_blank");
                }
                else {
                    if ($('[name=' + name + ']').hasClass("hasDatepicker")) {
                        var date = fieldValue.split('-');
                        var fieldDate = date[2] + "/" + date[1] + "/" + date[0];
                        $('[name=' + name + ']').val(fieldDate);
                        if (name === "share_issue_date") {
                            $('[name=' + name + ']').trigger("change");
                        }
                        if ($('[name=' + name + ']').hasClass("disabled-field")) {
                            $('[name=' + name + ']').attr("disabled", "disabled")
                        }
                    } else {
                        $('[name=' + name + ']').val(fieldValue);
                    }
                    if ($('[name=' + name + ']').closest(".form-group").hasClass("disabled-field") || $('[name=' + name + ']').hasClass("disabled-field")) {
                        $('[name=' + name + ']').attr("disabled", "disabled");
                    }
                }
            }
            $('[name=pan_number]').attr("disabled", "disabled");
        });
        var currentDate = new Date();
        $('input[name=date_80_iac]').datepicker("setDate", currentDate).attr("disabled", "disabled");
        var address = data.office_address + ", " + data.address2 + ", " + data.address3 + ", " + data.city + ", " + data.state;
        $('input[name=office_address]').val(address);
        $('textarea[name=fifty_six_details]').val(data['56_details']);

        if (place && user_form_status !== "4") {
            getFormStatus();
        }
        $('#modal-loader').modal('hide');
    }

    function getFormStatus() {
        $('.startupRecognition.form80').each(function () {
            $('.startupRecognition input[type=text],.startupRecognition input[type=email],.startupRecognition select.form-control,.startupRecognition input[type=number],.startupRecognition input[type=radio],.startupRecognition input[type=file], .startupRecognition textarea').attr("disabled", "disabled");
            $('.startupRecognition input[type=button]').hide();
        });
    }

    function dateValidationForFinancialYear(data) {
        date = new Date();
        var yyyy = date.getFullYear();
        var today = date.getDate();
        var month = date.getMonth() + 1;
        current_date = yyyy + "-" + month + "-" + today;
        itr_date = yyyy + "-" + "09" + "-" + "30";
        console.log(itr_date);
        if (month >= 3) {
            yyyy += 1;
        }
        console.log("current_date" + current_date);
        var registration_year = data.incorporation_date.split('-');
        var startUp_year = registration_year[0];
        var registration_month = registration_year[1];
        console.log("registration_month" + registration_month);
        if (registration_month <= 3) {
            startUp_year = startUp_year - 1;
        }
        console.log("startUp_year" + startUp_year);
        var difference = yyyy - startUp_year;
        cloneFinancialYearDetails(difference, yyyy, data);

        $(".financial-year .dipp-tax-values").on('change', "input[type=file]", function (event) {
            var formats = ["application/pdf"];
            isValidated = checkFileUploadReturn(formats, event.target, 5150000, isValidated);
            return false;
        });

        $(".income-tax .dipp-tax-values").on('change', "input[type=file]", function (event) {
            var formats = ["application/pdf"];
            isValidated = checkFileUploadReturn(formats, event.target, 5150000, isValidated);
            return false;
        });

    }

    $("input[type=file]").on('change', function (event) {
        var formats = ["application/pdf","application/wps-office.pdf"];
        isValidated = checkFileUploadReturn(formats, event.target, 5150000, isValidated);
        return false;
    });

    function cloneFinancialYearDetails(year_difference, current_year, data) {
        var previous_year;
        var previous_financial_year;
        var finance_year;
        var table = $(".financial-year .dipp-tax-values").prop('outerHTML');
        var incomeTax_table = $(".income-tax .dipp-tax-values").prop(
            'outerHTML');


        if (year_difference === 0) {

            previous_year = current_year;
            var next_financial_year = previous_year + 1;
            finance_year = previous_year + "-" + next_financial_year;

            var tds_financial = $(".financial-year .dipp-tax-values").find('td');
            tds_financial.eq(0).html(1);
            tds_financial.eq(1).html(finance_year);
            accountDetailArray[0]["financial_year"] = finance_year;

            var tds_income = $(".income-tax .dipp-tax-values").find('td');
            tds_income.eq(0).html(1);
            tds_income.eq(1).html(finance_year);
            itReturnArray[0]["it_return_year"] = finance_year;

        }

        else {
            year_difference = year_difference >= 3 ? 3 : year_difference;
            for (var i = 0; i < year_difference - 1; i++) {
                $(".financial-year table").append(table);

                $(".income-tax table").append(incomeTax_table);
            }

            $(".financial-year .dipp-tax-values").each(
                function (index, e) {
                    if (index < 3) {
                        previous_year = current_year - index;
                        previous_financial_year = current_year - (index + 1);
                        finance_year = previous_financial_year + "-" + previous_year;
                        var tds = $(this).find('td');
                        tds.eq(0).html(index + 1);
                        tds.eq(1).html(finance_year);
                        accountDetailArray[index]["financial_year"] = finance_year;
                        var balanceSheetIndex = accountDetailArray[index].balance_Sheet;
                        var tradingIndex = accountDetailArray[index].Trading_and_Profit_Loss_Account;
                        setTableAttribute(tds.eq(2), balanceSheetIndex);
                        setTableAttribute(tds.eq(3), tradingIndex);
                        if (index >= 1) {
                            if (index === 1 && (new Date(current_date) > new Date(itr_date))) {
                                tds.eq(2).find("input[type=file]").addClass("validate").siblings(".fileUploadRequired").removeClass("display-n");
                                tds.eq(3).find("input[type=file]").addClass("validate").siblings(".fileUploadRequired").removeClass("display-n");
                            }
                            if (index === 2) {
                                tds.eq(2).find("input[type=file]").addClass("validate").siblings(".fileUploadRequired").removeClass("display-n");
                                tds.eq(3).find("input[type=file]").addClass("validate").siblings(".fileUploadRequired").removeClass("display-n");
                            }
                        }
                    }
                });

            $(".income-tax .dipp-tax-values").each(function (index, e) {
                if (index < 3) {
                    var table_data = $(this).find('td');
                    table_data.eq(0).html(index + 1);
                    var it_previous_year = current_year - index;
                    var it_previous_financial_year = current_year - (index + 1);
                    var it_finance_year = it_previous_financial_year + "-"
                        + it_previous_year;
                    table_data.eq(1).html(it_finance_year);

                    var itReturnIndex = itReturnArray[index].it_return;
                    itReturnArray[index]["it_return_year"] = it_finance_year;
                    setTableAttribute(table_data.eq(2), itReturnIndex);
                    if (index >= 1) {
                        if (index === 1 && (new Date(current_date) > new Date(itr_date))) {
                            table_data.eq(2).find("input[type=file]").addClass("validate").siblings(".fileUploadRequired").removeClass("display-n");
                            table_data.eq(3).find("input[type=file]").addClass("validate").siblings(".fileUploadRequired").removeClass("display-n");
                        }
                        if (index === 2) {
                            table_data.eq(2).find("input[type=file]").addClass("validate").siblings(".fileUploadRequired").removeClass("display-n");
                            table_data.eq(3).find("input[type=file]").addClass("validate").siblings(".fileUploadRequired").removeClass("display-n");
                        }
                    }
                }
            });
        }
    }

    function setTableAttribute(element, value) {

        $(element).find("input[type=file]").attr("data-propname", value).attr("name", "upload_" + value).attr("data-propdisplay", value + "FileName").siblings(".fileName").attr("name", value).siblings("fileDisplayName").attr("name", value + "FileName");

    }

    $('.submit-cta').on("click", function () {
        $('#modal-loader').modal('show');
        validateFields();
        if (isValidated) {
            $('.submitFormErrorMessage').html("").addClass("display-n");
            getDataFromFields();
            saveData();
        } else {
            $('#modal-loader').modal('hide');
            $('.submitFormErrorMessage').html("There are some errors in form.Please recheck and submit again").removeClass("display-n");
        }
    });

    $('.startupRecognition.form80 .fileuploadMultipurpose input[type=file]').change(function () {
        $(this).siblings("a").html("").addClass("display-n").attr("href", "");
    });

    function validateFields() {

        var requiredFields = $('.form80 sup.required');
        if (requiredFields) {
            isValidated = true;
            $.each(requiredFields, function (index, item) {
                var element = $(item).closest('.form-group').find(".form-control:visible");
                var type = $(element).attr('type');
                if (type && type !== "file" && (!element.val() || element.val() === "")) {
                    isValidated = false;
                    showErrorState(element, true);
                } else if (type && type === 'checkbox') {
                    if (element.is(':checked')) {
                        showErrorState(element, false);
                    } else {
                        isValidated = false;
                        showErrorState(element, true);
                    }
                } else {
                    showErrorState(element, false);
                }
            });
        }

        var requiredFiles = $('.startupRecognition.form80 .fileuploadMultipurpose sup.required');
        isValidated = validateFileField(requiredFiles, null, isValidated);

        var financialYearFiles = $('.startupRecognition.form80 .financial-year .fileuploadMultipurpose .validate');
        isValidated = validateFileField(financialYearFiles, null, isValidated);

        var incomeTaxFiles = $('.startupRecognition.form80 .income-tax .fileuploadMultipurpose .validate');
        isValidated = validateFileField(incomeTaxFiles, null, isValidated);

        var regexValidatedFields = $('.form80 .regex-val');

        isValidated = validateRegexFields(regexValidatedFields, isValidated);
    }

    function getDataFromFields() {

        $(".form-group input[type=file],.form-group .form-control", ".form80").each(function (index, val) {
            var type = $(this).attr("type");
            var name = $(this).attr("name");
            var value = $(this).val();
            if (type === "file") {
                name = $(this).data("propname");
                formData.delete(name);
                formData.append(name, $(this)[0].files[0]);
            } else {
                if (!$(this).siblings(".fileuploadMultipurpose").length) {
                    formData.delete(name);
                    formData.append(name, value);
                }
            }
        });

        $.each(itReturnArray, function (index, element) {

            var key = itReturnArray[index].it_return_annual_year;
            var val = itReturnArray[index].it_return_year;
            if (val) {
                formData.delete(key);
                formData.append(key, val);

            }

        });
        $.each(accountDetailArray, function (index, element) {

            var key = accountDetailArray[index].financial_year_name;
            var val = accountDetailArray[index].financial_year;

            if (val) {
                formData.delete(key);
                formData.append(key, val);
            }
        });
        formData.append("reg_id", data['id']);
    }

    function saveData() {
        $.ajax({
            type: "POST",
            dataType: "json",
            data: formData,
            contentType: false,
            processData: false,
            url: saveApi,
            success: function (data) {
                $('#modal-loader').modal('hide');
                console.log(data['_resultflagg']);
                if (data._resultflag === '1') {
                    $(".recognition-form-submit-message").modal('show');
                }
            },
            error: function (data) {
                console.log("error");
                $('#modal-loader').modal('hide');
            }
        });
    }

    function getIncorpNo() {
        $('#modal-loader').modal('show');
        $.ajax({
            type: "GET",
            async: false,
            url: SIH.getEndPoint("/api/auth/user/cin"),
            headers: {"X-Auth-Token": authToken}
        }).success(function (data) {
            if (data) {
                cin = data.cin;
                tbl_condition = "incorporation_no = " + "\'" + cin + "\'" + " and archive = 0 ";
                fetchTableData(table_name, tbl_condition, fetchSuccess);
            }
            else {
                $('#modal-loader').modal('hide');
                $('.recognition-error-modal .modal-body p').html("<h5>You are not eligible to fill this form. Only DIPP recognized Startups incorporated after 1st April 2016 may do so, provided:<h5><br> <ol type='a'><li>Application is not already under process</li> <li>The application has not been rejected in the past</li></ol>");
                $('.recognition-error-modal').modal('show');
            }
        }).error(function () {
            $('#modal-loader').modal('hide');
            console.log("Error");
            $(".recognition-form-error-message").modal('show');
        });
    }
};
$.form56 = function () {
    var i = "IV-190307687/2016";
    //var i = "U45403MZ2018SGC013317";
    // var i = "U93090DL2017PTC326230";
    var cin = "";
    var yyyy;
    var date;
    var formats = ["application/pdf"];
    var skipFields = ["incorporation_date", "incorporation_no",
        "office_address", "nature_of_entity", "rep_mobile", "rep_email", "randum_reg"];
    var formData = new FormData();
    var tbl_condition = "incorporation_no = " + "\'" + i + "\'";
    var table_name = "startup_registration";
    var form56Data;
    var $nature_entity = $("select[name='nature_of_entity']");
    var nature_of_entity = "";
    var isValidated = true;
    var link = $("#imageLink").val();
    var inputTypes = ["text", "email", "number"];
    var reg_id = "";
    getIncorpNo();
    var section56Id = getUrlParameter("applicationId");
    var investor_html = $(".investor_details").first().prop('outerHTML');
    $('.hasDatepicker').removeClass('hasDatepicker').datepicker({dateFormat: 'dd/mm/yy'});
    fetchTableData("startup_natureof_entity", null, entityNatureCallBack);

    function fetchSuccess(message) {
        checkEligibility(message[message.length-1]);
    }

    function eligibiltySuccess(data) {
        prepopulateForm(data);
        var currentDate = new Date();
        var address = data.office_address + ", " + data.address2 + ", " + data.city + ", " + data.state;
        $('input[name=office_address]').val(address);
        reg_id = data.id;
        if (section56Id) {
            fetchTableData("section_56", "id = " + section56Id, retrieveFormFields);
        } else {
            $('input[name=certifyDate],input[name=date]').datepicker("setDate", currentDate).attr("disabled", "disabled");
            $('#modal-loader').modal('hide');
        }
    }

    function entityNatureCallBack(data) {
        if (data) {
            $nature_entity.html("<option>Select</option>");
            $.each(data, function (i, value) {
                $nature_entity.append("<option value=" + value.id + ">" + value.name + "</option>");
            });
        }
        else {
            $nature_entity.next().html("There is some problem fetching entity type.").parents(".form-group").addClass("has-error");
        }
        $nature_entity.val(nature_of_entity);
    }

    function prepopulateForm(message) {
        var formFields = $('.startupRecognition.form56').find('.form-control:not(.richTextarea,[name=memorandum_association],[name=board_resolution])');
        setFormFields(formFields, message);
    }

    function retrieveFormFields(message) {
        if (message[message.length - 1].reg_id) {
            form56Data = message[message.length - 1];
            if (form56Data.reg_id !== reg_id) {
                $('#modal-loader').modal('hide');
                $('.recognition-error-modal .modal-body p').html("You are not eligible to fill this form");
                $('.recognition-error-modal').modal('show');
            } else {
                $('.startupRecognition .accordion-section-content').addClass('open').show();
                var formFields = $('.startupRecognition.form56').find('.form-control:not(.richTextarea)');
                setFormFields(formFields, message[message.length - 1]);
                checkStatus(form56Data);
            }
        }
    }

    function checkStatus(data) {
        if (data.status !== "4") {
            $('.startupRecognition.form56').each(function () {
                $('.startupRecognition input[type=text],.startupRecognition input[type=email],.startupRecognition select.form-control,.startupRecognition input[type=number],.startupRecognition input[type=radio],.startupRecognition input[type=file], .startupRecognition textarea').attr("disabled", "disabled");
                $('.startupRecognition input[type=button]').hide();
            });
        }
    }

    function setFormFields(formFields, data) {
        $.each(formFields, function (index, value) {
            var name = $(value).attr("name");
            var fieldValue = data[name];
            if (fieldValue && !$(value).val()) {
                if ($('[name=' + name + ']').is('input') && $.inArray($('input[name=' + name + ']').attr("type"), inputTypes) === -1) {
                    var fileEntity = $("input[name=upload_" + name + "]").siblings("a");
                    fileEntity.html("View Document").removeClass("display-n");
                    fileEntity.prop("href", link + fieldValue);
                    fileEntity.prop("target", "_blank");
                }
                else if ($('[name=' + name + ']').is('select')) {
                    if (name === "no_of_investor" && fieldValue > 0) {
                        $('select[name=' + name + ']').val(fieldValue);
                        $('select[name=' + name + ']').trigger("change");
                        if (section56Id) {
                            fetchTableData("startup_investor", "section_id = " + section56Id, fetchInvestorDetails);
                        }
                    } else {
                        $('select[name=' + name + ']').val(fieldValue).trigger("change");
                        if ($('select[name=' + name + ']').hasClass("disabled-field")) {
                            $('select[name=' + name + ']').attr("disabled", "disabled").trigger("change");
                        }
                    }
                }
                else {
                    if ($('[name=' + name + ']').hasClass("hasDatepicker")) {
                        var date = fieldValue.split('-');
                        var fieldDate = date[2] + "/" + date[1] + "/" + date[0];
                        $('[name=' + name + ']').val(fieldDate).trigger("change");
                        if (name === "share_issue_date") {
                            $('[name=' + name + ']').trigger("change");
                        }
                        if ($('[name=' + name + ']').hasClass("disabled-field")) {
                            $('[name=' + name + ']').attr("disabled", "disabled").trigger("change");
                        }
                    } else {
                        $('[name=' + name + ']').val(fieldValue).trigger("change");
                    }
                    if ($('[name=' + name + ']').closest(".form-group").hasClass("disabled-field")) {
                        $('[name=' + name + ']').attr("disabled", "disabled");
                    }
                }
            } else {
                if ($('[name=' + name + ']').hasClass("disabled-field")) {
                    $('[name=' + name + ']').attr("disabled", "disabled");
                }
            }
        });
        if (data['created_date']) {
            var dateSplit = data['created_date'].split(" ")[0].split('-');
            if (dateSplit.length === 3) {
                $('input[name=certifyDate],input[name=date]').val(dateSplit[2] + "/" + dateSplit[1] + "/" + dateSplit[0]).attr("readonly", "readonly").parents(".form-group").removeClass("has-error").find(".help-block").html("");
            }
        }
        // $('input[name=certifyDate],input[name=date]').datepicker("setDate", data['created_date']).attr("disabled", "disabled");
        $('#modal-loader').modal('hide');
    }

    $('.submit-cta').on("click", function () {
        $('#modal-loader').modal('show');
        validateForm();
        if (isValidated) {
            $('.submitFormErrorMessage').html("").addClass("display-n");
            getDataFromFields();
            saveData();
        } else {
            $('#modal-loader').modal('hide');
            $('.submitFormErrorMessage').html("There are some errors in form.Please recheck and submit again").removeClass("display-n");
            $(".accordionitem").find(".accordion-section-title").removeClass("active").end()
                .find(".accordion-section-content").hide();
            var _firstErrorElem = $(".form-group.has-error,.scroll-error,.certify-has-error,.add_doc_file.has-error, td.has-error:first").first();
            _firstErrorElem.closest(".accordionitem").find(".accordion-section-title").addClass("active").siblings('.accordion-section-content').show();
            if (_firstErrorElem && _firstErrorElem.offset()) {
                $('html, body').animate({
                    scrollTop: _firstErrorElem.offset().top - 100
                }, 500);
            }

        }
    });

    $('.startupRecognition.form56 .fileuploadMultipurpose input[type=file]').change(fileUpload);

    function fileUpload(e) {
        isValidated = checkFileUploadReturn(formats, e.target, 5150000, isValidated);
        if (isValidated) {
            $(e.target).siblings("a").html("").addClass("display-n").attr("href", "");
            showErrorState($(e.target), false);
        }
    }

    function validateFields(requiredFields, removeError) {
        if (removeError) {
            $.each(requiredFields, function (index, item) {
                var element = $(item).closest('.form-group').find(".form-control");
                showErrorState(element, false);
            });
        } else {
            if (requiredFields) {
                $.each(requiredFields, function (index, item) {
                    var element = $(item).closest('.form-group').find(".form-control:not(.fileName,.fileDisplayName,.validate-ignore)");
                    if (element && element.length) {
                        var type = $(element).attr('type');
                        if (type !== "file" && (!element.val() || element.val() === "")) {
                            isValidated = false;
                            showErrorState(element, true);
                        } else if (type === 'checkbox') {
                            if (element.is(':checked')) {
                                showErrorState(element, false);
                            } else {
                                isValidated = false;
                                showErrorState(element, true);
                            }
                        } else {
                            showErrorState(element, false);
                        }
                    }
                });
            }
        }
    }

    function validateForm() {
        var requiredFields = $('.form56 sup.required');
        isValidated = true;
        validateFields(requiredFields);

        var requiredFiles = $('.startupRecognition.form56 .fileuploadMultipurpose sup.required');
        isValidated = validateFileField(requiredFiles, null, isValidated);

        var regexValidatedFields = $('.form56 .regex-val');
        isValidated = validateRegexFields(regexValidatedFields, isValidated);

    }

    function getDataFromFields() {
        $(".form-group input[type=file],.form-group .form-control", ".form56").filter(function () {
            return ($(this).parents('.investor_details').length === 0);
        }).each(function (index, val) {
            var type = $(this).attr("type");
            var name = $(this).attr("name");
            var value = $(this).val();
            if (type === "file") {
                name = $(this).data("propname");
                formData.delete(name);
                if ($(this)[0].files[0]) {
                    formData.append(name, $(this)[0].files[0]);
                }
            } else {
                if (!$(this).siblings(".fileuploadMultipurpose").length) {
                    if ($(this).hasClass("hasDatepicker")) {
                        var d = value.split("/");
                        value = d[2] + "/" + d[1] + "/" + d[0];
                    }
                    formData.delete(name);
                    formData.append(name, value);
                }
            }
        });
        if (section56Id) {
            formData.append("id", section56Id);
        }
        formData.append("reg_id", reg_id);
        formData.append("save_draft", "0");

        $.each(skipFields, function (index, val) {
            formData.delete(val);
        });
    }

    function saveData() {
        var url = $("#form56SaveApi").val();
        if (section56Id) {
            url = $("#form56UpdateApi").val();
        }
        $.ajax({
            type: "POST",
            dataType: "json",
            data: formData,
            contentType: false,
            processData: false,
            url: url,
            success: function (data) {
                console.log(data['_resultflagg']);
                $('#modal-loader').modal('hide');
                $(".recognition-form-submit-message").modal('show');
            },
            error: function (data) {
                $('#modal-loader').modal('hide');
                console.log("error");
                $(".recognition-form-error-message").modal('show');
            }
        });
    }

    function checkEligibility(data) {
        var isValidUser = true;
        var dippNumber = data['randum_reg'];
        link = link + dippNumber + "/";
        nature_of_entity = data['nature_of_entity'];
        reg_id = data['id'];
        /*nature_of_entity === "2" || nature_of_entity === "3" || */
        if (!dippNumber) {
            isValidUser = false;
        } else if (data.status && data.status !== "1") {
            isValidUser = false;
        } else if (data.recognization_certi_status === "3") {
            isValidUser = false;
        }
        if (!isValidUser) {
            $('#modal-loader').modal('hide');
            $('.recognition-error-modal .modal-body p').html("You are not eligible to fill this application");
            $('.recognition-error-modal').modal('show');
        } else {
            eligibiltySuccess(data);
        }
        //eligibiltySuccess(data);
    }

    function getIncorpNo() {
        $('#modal-loader').modal('show');
        $.ajax({
            type: "GET",
            async: false,
            url: SIH.getEndPoint("/api/auth/user/cin"),
            headers: {"X-Auth-Token": store.getItem("token")}
        }).success(function (data) {
            if (data) {
                cin = data.cin;
                tbl_condition = "incorporation_no = " + "\'" + cin + "\'" + " and archive = 0 ";
                fetchTableData(table_name, tbl_condition, fetchSuccess);
            }
            else {
                $('#modal-loader').modal('hide');
                $('.recognition-error-modal .modal-body p').html("You are not eligible to fill this form");
                $('.recognition-error-modal').modal('show');
            }
        }).error(function () {
            $('#modal-loader').modal('hide');
            $(".recognition-form-error-message").modal('show');
        });
    }

    /* $("[name=place],[name=date],[name=randum_reg],[name=pan_number],[name=name_father],[name=name_auhorized],[name=auhorized_pan],[name=designation],[name=entity_name]").change(function(){
         var name = $(this).attr("name");
         var dest_class = name+"_text";
         if($(this).val()) {
             $("." + dest_class).html("<b>" + $(this).val() + "</b>");
         }else{
             $("." + dest_class).html("_____________");
         }
     })*/

};
$("#submitConnectWitUs").on('click', function () {

    $("#submitConnectWitUs").prev('div.err-div').remove();

    var formdata = $("#connect-with-us").serializeObject();

    var url = SIH.getEndPoint("/api/noauth/email/connect-with-us");

    $.ajax({
        type: "POST",
        url: url,
        data: JSON.stringify(formdata),
        contentType: "application/json",
    }).done(function (data) {
        showThankYouModal('connectwithus');
        $("#connect-with-us").reset();
    }).fail(function (error) {
        $("<div class='err-div'></div>").insertBefore("#submitConnectWitUs").text(JSON.parse(error.responseText)[0].defaultMessage || $("#connect-with-us").attr('error-message'));
    });
});
$.eodb_form = function (msg1, msg2, problemPage) {
    var formData = {};
    var isValidated = true;
    var $applicantName = $("input[name='applicantName']");
    var $email = $("input[name='email']");
    var $mobile = $("input[name='mobile']");
    var $videoFileName = $("input[name='videoLink']");
    var $submitChallengeForm = $("input[name='eodbFormSubmit']");
    prepopulateAllForm();
    getChallengeCountryList();

    function getChallengeCountryList() {
        $.ajax({
            type: "GET",
            url: "/services/tags/countries.json",
        }).done(function (data) {
            $.each(data, function (index, result) {
                var options = "<option  id='" + result.id + "' value='" + result.id + "'>" + result.text + "</option>";
                $("#countryList").append(options + "<br>")
            });
        });
    }

    $("#entityType").change(function () {
        var entityType = $("#entityType").val();
        if (entityType === "Other Entity") {
            $("#otherEntities").closest('.form-group').removeClass("display-n");
        } else {
            $("#otherEntities").closest('.form-group').addClass("display-n");
        }
    });

    function getMinistriesList() {
        $.ajax({
            type: "GET",
            url: "/services/tags/children.json?tag=sih:ministry",
        }).done(function (data) {
            $.each(data, function (index, result) {
                var options = "<option  id='" + result.id + "' value='" + result.text + "'>" + result.text + "</option>";
                $("#ministrySelection").append(options + "<br>")
            });
            var option = "<option  id='do-not-know' value='Do not Know'>" + 'Do not Know' + "</option>";
            $("#ministrySelection").append(option + "<br>")
        });
    }


    function getFormData() {
        formData = {};
        isValidated = true;
        var attrValue = "";
        var inputField = $("#eodbChallengeForm").find(".form-control");
        $.each(inputField, function (index, inputSel) {

            var key = $(inputSel).attr("name");
            if (typeof key != "undefined") {
                attrValue = $(inputSel).attr("type") === "radio" ? $('input[name="' + inputSel.name + '"]:checked').val() : $(inputSel).val();
                /* if(key === "ministrySelection" && attrValue && !$.isArray(attrValue)){
                     var valueArr = [];
                     valueArr.push(attrValue);
                     attrValue = valueArr;
                 }*/
                if (attrValue) {
                    formData[key] = attrValue;
                }
                checkRequiredField(attrValue, inputSel);
            }
        });
        formData['additionalDocuments'] = $('input[type=hidden][name=additionalDocuments]').val();
        formData['problemCode'] = store.getItem('themeCode');
        formData['problemDescription'] = store.getItem('themeTitle');
    }

    function checkRequiredField(attrValue, inputSel) {
        var requiredField = $(inputSel).closest(".form-group").find("sup.required");
        if (requiredField && requiredField.length > 0 && (!attrValue || attrValue === "")) {
            isValidated = false;
            $(inputSel).closest(".form-group").addClass("has-error").find("span.help-block").first().html("This field cannot be left Blank.");
        } else {
            $(inputSel).closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
        }
    }


    function checkFileUpload(selectedFormats, fileToValidate, fileSize, extensions) {

        var message = "";
        if ($(fileToValidate).val() !== "") {
            if (fileToValidate.files[0].size > fileSize) {
                message = "File Should not be greater then " + Math.floor(fileSize / 1000000) + " MB.";
            }
            if (jQuery.inArray(fileToValidate.files[0].type, selectedFormats) === -1) {
                message = message + " Please upload " + extensions.toString() + " file formats.";
            }
            if (message !== "") {
                isValidated = false;
                $(fileToValidate).siblings(".help-block").html(message).parents(".form-group").addClass("has-error");
                $(fileToValidate).val("");
            } else {
                $(fileToValidate).siblings(".help-block").html("").parents(".form-group").removeClass("has-error");
                var data = new FormData();
                data.append("file", fileToValidate.files[0]);
                $(".modal.loader").modal("show");
                $.ajax({
                    type: "POST",
                    data: data,
                    dataType: 'json',
                    contentType: false,
                    processData: false,
                    url: SIH.getEndPoint("/api/file/eodbChallenge/doc"),
                }).done(function (data) {
                    $(".modal.loader").modal("hide");
                    $(fileToValidate).siblings("input[type='hidden']").val(data.name);
                }).error(function () {
                    $(".modal.loader").modal("hide");
                    $(".agriculture-challenge-error-message").modal("show");
                    return false;
                });
            }
        }
        return false;
    }

    $("#eodbChallengeForm .textBoxOut").on("change", ".fileUploadField input[type='file']", function () {
        var formats = ["application/vnd.ms-powerpoint", "application/vnd.openxmlformats-officedocument.presentationml.presentation", "application/pdf"];
        var extensions = ["ppt", "pptx", "pdf"];
        checkFileUpload(formats, this, 2062594, extensions);
        return false;
    });

    function prepopulateAllForm() {
        if (store.getItem('themeTitle')) {
            $('#eodbChallengeForm .problem-statement-wrapper img').attr('src', store.getItem('themeImage'));
            $('#eodbChallengeForm .problem-statement-wrapper .static-heading').html(store.getItem('themeTitle'));
        } else {
            window.location = $('.statement-wrapper').data('redirect-path') + ".html";
        }
        if (store.getItem('themeCode') && store.getItem('themeCode') === "001") {
            $(".central-gov").removeClass("display-n")
            getMinistriesList();
        } else {
            $(".central-gov").addClass("display-n")
        }
        $("#otherEntities").closest('.form-group').addClass("display-n");
        // $('#eodbChallengeForm .problem-statement-wrapper .description').html(store.getItem('themeDescription'));
    }

    $submitChallengeForm.on("click", function () {
        $('#modal-loader').modal("show");
        getFormData();
        if (isValidated) {
            $(this).parents(".form-group").removeClass("has-error").find("span.help-block").addClass("display-n");
            $.ajax({
                type: "POST",
                data: JSON.stringify(formData),
                contentType: "application/json",
                dataType: "json",
                url: SIH.getEndPoint("/api/noauth/eodbChallenge/apply"),
            }).done(function () {
                $('#modal-loader').modal("hide");
                $(".israel-challenge-submit-message").modal('show');
                window.location = $submitChallengeForm.attr("data-path") + ".html";
            }).error(function () {
                $('#modal-loader').modal("hide");
                $(".agriculture-error-message").modal("show");
            });
        } else {
            $('#modal-loader').modal("hide");
            $(this).parents(".form-group").addClass("has-error").find("span.help-block").removeClass("display-n");
        }

    });
    $("#agricultureChallengeForm").find('#state').on("change", function (event) {
        event.stopPropagation();
    });

};

$.badge_manager_events = function () {

    $("select[name=badgeAssign]").attr("disabled", "disabled");
    $("select[name=badgeUnassign]").attr("disabled", "disabled");
    $(".cancelUpdateBadge").click(function () {
        bootbox.confirm("Do you want to cancel the updation?", function () {
            resetBadgeForms($(".badgeCreateTab"));
        });
    });
    $("input[name='iconName']").on('change', function (event) {
        var target = event.target;
        var $target = $(target);
        var file = target.files[0];
        if (file && !validateIcon(file)) {
            return false;
        }
        var imgIcon = $target.parent().siblings(".image-section").find('span.camera-image');
        var imageTag = $target.parent().siblings(".image-section").find("img.browse")[0];
        if (file) {
            var data = new FormData();
            data.append("file", file);
            $('#modal-loader').modal("show");
            $.ajax({
                url: SIH.getEndPoint("/api/file/badge/icon"),
                type: 'POST',
                data: data,
                cache: false,
                contentType: false,
                processData: false,
                success: function (data) {
                    $('#modal-loader').modal("hide");
                    if (data && data.name) {
                        imageTag.src = window.URL.createObjectURL(target.files[0]);
                        $(imageTag).css("display", "block");
                        $(imgIcon).css("display", "none");
                        $target.attr("data-iconfile", data.name);
                    }
                }, error: function (data) {
                    $('#modal-loader').modal("hide");
                    bootbox.alert("Error while uploading icon. Please try again.");
                }
            });
        }
    });

    function validateIcon(file) {
        var allowedExtensionsForImage = ["image/png", "image/jpeg", "image/jpg"];
        var maxImageSizeInBytes = 1048576;
        if ($.inArray(file.type, allowedExtensionsForImage) < 0) {
            bootbox.alert("Supported Formats for file uploads are: " + allowedExtensionsForImage.join(" , "));
            return false;
        }
        if (file.size > maxImageSizeInBytes) {
            bootbox.alert("Maximum file size allowed is 1 MB ");
            return false;
        }
        return true;
    }

    $(".updateBadge").click(function () {
        var formData = {}, $openTab = $(".badgeCreateTab");
        var $title = $openTab.find("input[name='title']");
        if ($title.val()) {
            formData["id"] = $openTab.find("input[name='badgeId']").val();
            formData["title"] = $title.val();
            formData["description"] = $openTab.find("textarea[name='description']").val();
            formData["iconName"] = $openTab.find("input[name='iconName']").data("iconfile");
            submitBadgeForm(formData, "/api/auth/badge/update", $openTab, "Badge updated successfully");
        } else {
            showErrorState($title, true, "Please enter a valid badge title.");
        }
    });

    $(".assignBadge").click(function () {
        var formData = {}, $openTab = $(".badgeAssignTab");
        var $selectedBadges = $("select[name=badgeAssign]");
        var badges = [];
        $.each($selectedBadges.val(), function (idx, badgeId) {
            var badge = {};
            badge["id"] = badgeId;
            badges.push(badge);
        });
        var userIds = [];
        $(".textTag").each(function () {
            var userId = $(this).data("userid");
            if (userId && userIds.indexOf(userId) < 0) userIds.push(userId);
        });
        if (!userIds.length) {
            showErrorState($("input[name='user_badgeAssign']"), true, "Please select a user.");
        } else if (!badges.length) {
            showErrorState($selectedBadges, true, "Please select atleast 1 badge.");
        } else {
            formData["assignedBadges"] = badges;
            formData["assignedUserIds"] = userIds;
            submitBadgeForm(formData, "/api/auth/badge/assign", $openTab, "Badges assigned successfully");
        }
    });

    $(".unassignBadge").click(function () {
        var formData = {}, $openTab = $(".badgeUnassignTab");
        var $user = $openTab.find("input[name='user_badgeUnassign']");
        var $selectedBadges = $("select[name=badgeUnassign]");
        var badges = [];
        $.each($selectedBadges.val(), function (idx, badgeId) {
            var badge = {};
            badge["id"] = badgeId;
            badges.push(badge);
        });
        if (!$user.val()) {
            showErrorState($user, true, "Please select a user.");
        } else if (!badges.length) {
            showErrorState($selectedBadges, true, "Please select atleast 1 badge.");
        } else {
            formData["uniqueId"] = $user.data("userid");
            formData["assignedBadges"] = badges;
            submitBadgeForm(formData, "/api/auth/badge/unassign", $openTab, "Badges un-assigned successfully");
        }
    });

    function submitBadgeForm(formData, path, $openTab, message) {
        $.ajax({
            url: SIH.getEndPoint(path),
            type: "POST",
            data: JSON.stringify(formData),
            beforeSend: setAuthTokenHeader,
            contentType: "application/json"
        }).success(function (response) {
            bootbox.alert(message);
            resetBadgeForms($openTab);
            showBadges();
        }).error(function () {
            bootbox.alert("Error in submitting form. Please try again.");
        });
    }

    function resetBadgeForms($openTab) {
        $openTab.find(".form-control").val("");
        $("#badgeUpdateId").remove();
        $(".cancelUpdateBadge").addClass("hidden");
        $(".updateBadge").closest(".cta").removeClass("floatingCta");
        var $selectTarget = $openTab.find("select");
        $selectTarget.val(null).trigger("change").attr("disabled", "disabled");
        $selectTarget.select2({
            data: []
        });
        showErrorState($selectTarget, false, "");
        $(".textTags").html("");
        $openTab.find(".richTextarea").summernote("code", "");
        $openTab.find("img.browse").hide();
        $openTab.find(".camera-image").show();
        $openTab.find("input[name='iconName']").attr("data-iconfile", "");
    }

    $(".cinSearch").click(function () {
        var assignFunction = !!$(this).closest(".badgeAssignTab").length;
        var $target = assignFunction ? $("input[name='user_badgeAssign']") : $("input[name='user_badgeUnassign']");
        var $selectTarget = assignFunction ? $("select#badgeAssign") : $("select#badgeUnassign");
        if ($target.val()) {
            verifyUser($target, $selectTarget, assignFunction);
        }
        else {
            showErrorState($target, true, "Please enter a valid user-email.");
            $selectTarget.attr("disabled", "disabled");
        }
    });

    function verifyUser($target, $selectTarget, multi) {
        $('#modal-loader').modal("show");
        var userEmail = $target.val(), data = {};
        data["email"] = userEmail;
        $.ajax({
            url: SIH.getEndPoint("/api/auth/user/get"),
            data: JSON.stringify(data),
            type: 'POST',
            beforeSend: setAuthTokenHeader,
            dataType: "json",
            contentType: "application/json",
            success: function (userDetail) {
                showErrorState($target, false, "");
                if (multi) {
                    if (!$("#tag_" + userDetail.uniqueId).length) {
                        var textTag = "<span class='textTag' id='tag_" + userDetail.uniqueId + "' data-userid='" + userDetail.uniqueId + "'>" + userEmail +
                            "<i class='textTagClose fa fa-close' onclick=\"removeTextTag('tag_" + userDetail.uniqueId + "')\"></i></span>";
                        $target.parent().siblings(".textTags").append(textTag).show();
                        $target.val("");
                    }
                    loadBadgeSelection($selectTarget);
                } else {
                    $('#modal-loader').modal("hide");
                    $target.attr("data-userid", userDetail.uniqueId);
                    var selectData = [];
                    $.each(userDetail.assignedBadges, function (idx, badgeObj) {
                        var selectObj = {};
                        selectObj["id"] = badgeObj.id;
                        selectObj["text"] = badgeObj.title;
                        selectData.push(selectObj);
                    });
                    $selectTarget.val(null).trigger("change").attr("disabled", false);
                    $selectTarget.select2({
                        data: selectData
                    });
                }
            },
            error: function () {
                $('#modal-loader').modal("hide");
                showErrorState($target, true, "Please enter a valid user-email");
                $selectTarget.attr("disabled", "disabled");
            }
        });
    }

    function showErrorState(el, hasError, errorMsg) {
        if (hasError) {
            if (!errorMsg) errorMsg = "This field cannot be left Blank.";
            el.siblings('.help-block').show();
            el.closest(".form-group").addClass("has-error").find("span.help-block").first().html(errorMsg);
        } else {
            el.closest(".form-group").removeClass("has-error").find("span.help-block").first().html("");
        }
    }

    $(".dynamicTabs li:nth-child(4)").click(function () {
        badgeViewTable.ajax.reload();
    });
    $(".dynamicTabs li:nth-child(5)").click(function () {
        badgeUsersTable.ajax.reload();
    });
};

var badgeViewTable;
var showBadges = function () {
    $('#modal-loader').modal("show");
    var template = Handlebars.compile($("#badge-dashboard-template").html());
    var context = {badges: []};
    $(".badge-dashboard-table").html(template(context));
    badgeViewTable = $('#badge-dashboardTable').DataTable({
        processing: true,
        serverSide: true,
        lengthChange: false,
        ajax: {
            url: SIH.getEndPoint("/api/auth/badge/list"),
            dataSrc: 'data',
            dataType: "json",
            type: 'POST',
            error: function (xhr, error, thrown) {
                if (xhr.status === 403) {
                    bootbox.alert("You are not authorised to view this page");
                } else {
                    bootbox.alert("Error in loading badges.");
                }
            },
            beforeSend: function (xhr) {
                xhr.setRequestHeader("X-Auth-Token", store.getItem("token"));
                xhr.setRequestHeader("Content-type", "application/json");
            },
            data: function (d) {
                d.title = null;
                return JSON.stringify(d);
            }
        },
        columnDefs: [
            {name: "title", orderable: false, targets: 0},
            {name: "description", orderable: false, targets: 1},
            {name: "iconName", orderable: false, targets: 2},
            {name: "id", orderable: false, targets: 3}
        ],
        columns: [
            {
                data: "title", defaultContent: "-", render: function (title) {
                    return "<div class='hoverText'>" + title + "</div>";
                }
            },
            {
                data: "description", defaultContent: "-", render: function (description) {
                    return description ? "<div class='hoverText'>" + description + "</div>" : "-";
                }
            },
            {
                data: "iconName", defaultContent: "-", searchable: false, render: function (iconName) {
                    var getIconAPI = SIH.getEndPoint("/api/file/badge/icon") + "?fileName=" + iconName;
                    return iconName ? "<img src='" + getIconAPI + "' width='65' height='65'/>" : "-";
                }
            },
            {
                data: "id", defaultContent: "-", render: function (id) {
                    return "<div><a href=\"javascript:void(0)\" onclick=\"editBadge('" + id + "')\"><span style='color: green;'>Update</span></a>" +
                        "&nbsp;&nbsp;&nbsp;<a href=\"javascript:void(0)\" onclick=\"removeBadge('" + id + "')\"><span style='color: red;'>Remove</span></a></div>";
                }
            }
        ]
    });
    $('#modal-loader').modal("hide");
};

var badgeUsersTable;
var showBadgeUsers = function () {
    $('#modal-loader').modal("show");
    var template = Handlebars.compile($("#badgeUser-dashboard-template").html());
    var context = {badges: []};
    $(".badgeUser-dashboard-table").html(template(context));
    badgeUsersTable = $('#badgeUser-dashboardTable').DataTable({
        processing: true,
        serverSide: true,
        lengthChange: false,
        ajax: {
            url: SIH.getEndPoint("/api/auth/badge/users"),
            dataSrc: 'data',
            dataType: "json",
            type: 'POST',
            error: function (xhr, error, thrown) {
                if (xhr.status === 403) {
                    bootbox.alert("You are not authorised to view this page");
                } else {
                    bootbox.alert("Error in loading badge users.");
                }
            },
            beforeSend: function (xhr) {
                xhr.setRequestHeader("X-Auth-Token", store.getItem("token"));
                xhr.setRequestHeader("Content-type", "application/json");
            },
            data: function (d) {
                d.title = null;
                return JSON.stringify(d);
            }
        },
        columnDefs: [
            {name: "name", className: "dt-left", orderable: false, targets: 0},
            {name: "email", className: "dt-left", orderable: false, targets: 1},
            {name: "assignedBadges", className: "dt-left", orderable: false, targets: 2}
        ],
        columns: [
            {
                data: "name", defaultContent: "-"
            },
            {
                data: "email", defaultContent: "-"
            },
            {
                data: "assignedBadges", defaultContent: "-", searchable: false, render: function (assignedBadges) {
                    var badges = "<ul>";
                    $.each(assignedBadges, function (idx, badgeObj) {
                        badges += "<li data-badgeid='" + badgeObj.id + "'>" + badgeObj.title + "</li>";
                    });
                    return badges + "</ul>";
                }
            }
        ]
    });
    $('#modal-loader').modal("hide");
};

function loadBadgeSelection($selectTarget, badgeId) {
    var data = {};
    if (badgeId) data["id"] = badgeId;
    $.ajax({
        url: SIH.getEndPoint("/api/auth/badge/get"),
        data: JSON.stringify(data),
        type: 'POST',
        beforeSend: setAuthTokenHeader,
        dataType: "json",
        contentType: "application/json",
        success: function (response) {
            $('#modal-loader').modal("hide");
            if (badgeId) {
                if (response.length > 0) populateBadgeUpdation(response[0]);
                else bootbox.alert("Unable to fetch badge(s).Please try again.");
            } else {
                var selectData = [];
                $.each(response, function (idx, badgeObj) {
                    var selectObj = {};
                    selectObj["id"] = badgeObj.id;
                    selectObj["text"] = badgeObj.title;
                    selectData.push(selectObj);
                });
                $("select[name='badgeAssign']").select2({
                    data: selectData
                });
                $selectTarget.attr("disabled", false);
            }
        },
        error: function () {
            $('#modal-loader').modal("hide");
            bootbox.alert("Unable to fetch badge(s).Please try again.");
        }
    });
}

function removeTextTag(tagId) {
    $("#" + tagId).remove();
}

function editBadge(badgeId) {
    $(".link-tabs:first").trigger("click");
    $('html, body').animate({
        scrollTop: 0
    });
    loadBadgeSelection(null, badgeId);
}

function removeBadge(badgeId) {
    bootbox.confirm("Are you sure you want to delete this badge?", function () {
        var data = {};
        data["id"] = badgeId;
        $.ajax({
            url: SIH.getEndPoint("/api/auth/badge/remove"),
            data: JSON.stringify(data),
            type: 'POST',
            beforeSend: setAuthTokenHeader,
            contentType: "application/json",
            success: function () {
                $('#modal-loader').modal("hide");
                bootbox.alert("Badge removed successfully.");
                showBadges();
            },
            error: function () {
                $('#modal-loader').modal("hide");
                bootbox.alert("Error in deleting badge. Please try again");
            }
        });
    });
}

function populateBadgeUpdation(badgeObj) {
    $openTab = $(".badgeCreateTab");
    $(".cancelUpdateBadge").removeClass("hidden").closest(".cta").addClass("floatingCta");
    $(".updateBadge").closest(".cta").addClass("floatingCta");
    $openTab.find(".component-wrapper").append("<input type='hidden' id='badgeUpdateId' name='badgeId' value='" + badgeObj.id + "'/>");
    $openTab.find("input[name='title']").val(badgeObj.title);
    $openTab.find("textarea[name='description']").summernote("code", badgeObj.description);
    var $target = $openTab.find("input[name='iconName']");
    var imgIcon = $target.parent().siblings(".image-section").find('span.camera-image');
    var imageTag = $target.parent().siblings(".image-section").find("img.browse")[0];
    loadIconImage(badgeObj.iconName, $target, imgIcon, imageTag);
}

function loadIconImage(iconName, $target, imgIcon, imageTag) {
    var getIconAPI = SIH.getEndPoint("/api/file/badge/icon");
    imageTag.src = getIconAPI + "?fileName=" + iconName;
    $(imageTag).css("display", "block");
    $(imgIcon).css("display", "none");
    $target.attr("data-iconfile", iconName);
}
function mentorshipFormEvents() {
    $('[name=tie_email],[name=tie_password],[name=verify-tie-btn],[name=otherThanTieLVDescription]').closest('.form-group').hide();
    $(".successStories").closest(".baseformfield").addClass("display-n");

    var $mentorshipToggle = $("input:checkbox[name='mentorshipParticipant']");
    var $mentorshipCityTrigger = $(".mentor_selection_offline:checkbox:first");
    if ($mentorshipToggle.length && !$mentorshipToggle.is(":checked")) $(".mentorshipComp").addClass("mentorshipComp-hidden");
    if (!$mentorshipCityTrigger.is(":checked")) $(".mentorCity").addClass("mentorshipComp-hidden");
    $mentorshipCityTrigger.click(function () {
        $(".mentorCity").toggle(this.checked).toggleClass("hidden", !this.checked);
    });
    $mentorshipToggle.click(function () {
        $(".mentorshipProgram").toggle(this.checked);
        $(".mentorshipComp:not(.mentorCity)").toggleClass("mentorshipComp-hidden", !this.checked);
        if (!$(this).is(":checked")) {
            $("select[name=mentorDomains]").val("").trigger("change");
            $("input[type=checkbox][name=mentorMeans]").prop("checked", false);
            $("input[name=mentorCategory]").prop("checked", false);
            $("select[name=mentorHours]").val("");
            $("select[name=mentorCity]").val("").addClass("mentorshipComp-hidden");
            $(".mentorCity").hide();
            $("input[name=noOfStartupsToMentor]").val("");
        }
    });

    $("input:checkbox[name='hasStories']").change(function () {
        $(".successStories").closest(".baseformfield").toggleClass("display-n", !this.checked);
    });

    $('[name=TiEOrLetsVenture]').click(function (e) {
        var selectedRadio = $(this).val();
        if (selectedRadio === 'isTIE') {
            $('[name=otherThanTieLVDescription]').closest('.form-group').hide();
            $('[name=tie_email],[name=tie_password],[name=verify-tie-btn]').closest('.form-group').show();
        } else if (selectedRadio === 'others') {
            $('[name=tie_email],[name=tie_password],[name=verify-tie-btn]').closest('.form-group').hide();
            tieOrlvSpecificMessage(null, null, false);
            $('[name=otherThanTieLVDescription]').closest('.form-group').show();
        }
    });
}


function addMentorshipProgramDetails(data, mentorshipParticipant) {
    var formData = data || {};
    formData["mentorshipParticipant"] = mentorshipParticipant ? mentorshipParticipant : $("input[name=mentorshipParticipant]").is(":checked");
    formData["mentorship"] = {};
    formData["mentorship"]["mentorCategory"] = $("input[name='mentorCategory']:checked").val();
    formData["mentorship"]["mentorCity"] = $("select[name='mentorCity']").children("option:selected").val();
    formData["mentorship"]["mentorHours"] = $("select[name='mentorHours']").children("option:selected").val();
    formData["mentorship"]["noOfStartupsToMentor"] = $("input[name='noOfStartupsToMentor']").val();
    var mentorMeans = [];
    $.each($("input[name='mentorMeans']:checked"), function () {
        mentorMeans.push($(this).val());
    });
    formData["mentorship"]["mentorMeans"] = mentorMeans;
    formData["mentorship"]["mentorDomains"] = $("select[name='mentorDomains']").val();
    return formData;
}

function populateMentorshipProgramDetails(mentorshipObj) {
    $.each(mentorshipObj, function (key, value) {
        if (key == "mentorDomains") {
            populateMultiSelectOption(key, value);
        } else if (key == "mentorMeans") {
            $.each(value, function (idx, val) {
                $("input[type=checkbox][name=" + key + "][value='" + val + "']").trigger("click");
            });
        } else if (key == "mentorHours" || key == "mentorCity") {
            populateSingleSelect(key, value);
        } else if (key == "mentorCategory") {
            $("input[name=" + key + "][value='" + value + "']").prop("checked", true);
        } else {
            $("input[name=" + key + "]").val(value);
        }
    });
}

function validateMentorshipFields(isValidated, isUpdateFlow) {
    var role = store.getItem("role"), personaType = store.getItem("personatype");
    if ($("input:checkbox[name='mentorshipParticipant']").is(":checked") || role === 'Mentor' || personaType === 'mentor') {
        var element = $("input[type=checkbox][name=mentorMeans]");
        if (element.closest("div.section-block").attr("validate") == "1" || isUpdateFlow) {
            var helpBlock = $(".mentor_selection_offline").find("span.help-block").first();
            if (element.is(':checked')) {
                element.closest(".form-group").removeClass("has-error");
                helpBlock.html("");
            } else {
                element.closest(".form-group").addClass("has-error");
                helpBlock.html("Please select atleast one of the 4 options above.");
                isValidated = false;
            }
        }
    }
    return isValidated;
}

function validateTieLvVerifications(isValidated) {
    var $tieLvError = $(".tieOrlvSpecificMessage");
    if ($tieLvError.length) {
        isValidated = false;

    }
    return isValidated;
}
(function($){
    $(window).on("load",function(){

        // TimeLine Images
        $('.timeline-content .timeline .image-section').each(function(){
            var x = $(this).children("a").length;
            if(x > 6){
                $(this).children('a:nth-child(6)').append('<div class="count"> +'+(x-6)+'</div>')
            }
            $(this).addClass( " " + "image-count"+x);
        });

// Header Search bar

        $('.search-bar .fa-search').click(function(){
            $(this).parent().toggleClass('show-input');
        });

        // Search Bar Mobile

        $('.search-mobile').click(function(){
            $('.search-form').addClass('show');
        });

        $('.cross-icon .fa-times').click(function(){
            $('.search-form').removeClass('show');
        });

// Mobile Menu Js

        $('.menu-icon').click(function(){
            $('.mobile-menu-wrapper').addClass('show');
            //$('html').css('overflow','hidden');
        })

        $('.close-menu').click(function(){
            $('.mobile-menu-wrapper').removeClass('show');
            $('html').css('overflow','initial');
        })

        $('.dropbtn').click(function(){
            $(this).parent().toggleClass('show-menu');
            $(this).closest('li').siblings().removeClass('show-menu');
        })


//  Login Js

        $('.login-wrapper').click(function(){
            $(this).toggleClass('show-login');
        });

// Accordion


        // Sticky Header
        if($('.mid-header-wrap').length) {
            var headerHeight = $('.mid-header-wrap').offset().top;
            $(window).scroll(function () {
                if (!$('.persona-body').length) {
                    var scroll = $(window).scrollTop();

                    if (scroll > headerHeight) {
                        $('.mid-header-wrap, .main-header').addClass('sticky');
                    }
                    else {
                        $('.mid-header-wrap, .main-header').removeClass('sticky');
                    }
                }
            });
        }

        jQuery('.benefit-outer-wrapper').prepend("<div class='notice-part-bg'></div>")
        winWidth = jQuery(window).width();
        containerWidth = jQuery('.benefit-inner-wrapper').outerWidth();
        //noticePercentWidth = (containerWidth * 25) / 100;
        noticePercentWidth = jQuery('.benefit-inner-wrapper > .row-container').first().outerWidth();
        noticeWidth = noticePercentWidth + ((winWidth - containerWidth) / 2);
        jQuery('.notice-part-bg').css('width',noticeWidth);
        jQuery(window).resize(function(){
            winWidth = jQuery(window).width();
            containerWidth = jQuery('.benefit-inner-wrapper').outerWidth();
            //noticePercentWidth = (containerWidth * 25) / 100;
            noticePercentWidth = jQuery('.benefit-inner-wrapper > .row-container').first().outerWidth();
            noticeWidth = noticePercentWidth + ((winWidth - containerWidth) / 2);
            jQuery('.notice-part-bg').css('width',noticeWidth);
        });

    });
    $(window).on('load resize',function(){
        if($(window).width() > 991){
            $(".timeline-bottom, .faq-home .accordion,.faqs-wrapper .accordion").mCustomScrollbar();
        }
        if($(window).width() > 1024){
            $(".home-notice-board").mCustomScrollbar({'autoHideScrollbar':true});
        }
        // else{
        //     $('.notice-board-display-wrapper').slick({
        //         infinite: true,
        //         slidesToScroll: 1,
        //         dots:false,
        //         autoplay:false,
        //         slidesToShow: 2,
        //         responsive: [
        //             {
        //                 breakpoint: 1024,
        //                 settings: {
        //                     slidesToShow: 2
        //                 }
        //             },
        //             {
        //                 breakpoint: 450,
        //                 settings: {
        //                     slidesToShow: 1
        //                 }
        //             }
        //         ]
        //     });
        // }
    });
})($);
var player = {};
$(window).load(function () {

    $('.carouselherobanner .home-banner').not('.slick-initialized').slick({
        infinite: true,
        slidesToShow: 1,
        slidesToScroll: 1,
        prevArrow: '<div class="button-prev">Previous Slide</div>',
        nextArrow: '<div class="button-next">Next Slide</div>',
        autoplay: 1,
        responsive: [
            {
                breakpoint: 767,
                settings: {
                    adaptiveHeight: true
                }
            }
        ]
    });

    var playState = true;
    if ($(window).width() < 1024) {
        playState = false;
    }
    var muteState = true;
    var fullScreenPlayState = false;
    var fullScreen = false;
    var interval = null;
    var bannerTimer = null;
    var userPaused = false;
    var usercenterPaused = false;
    var isYoutubeVideo = false;
    var currentId = null;
    var isPlayerScriptLoaded = false;


    if ($('.video').length > 0) {
        var isVideo = $('.slick-active').find('video');
        $('.hero-container .black-bar').click(function (e) {

            if ($(window).width() > 1023) {
                playpauseHandle();
                if (e && e.hasOwnProperty('originalEvent')) {
                    usercenterPaused = !usercenterPaused;
                }
            }
        });
        if (isVideo.length && $(window).width() > 1023) {
            isVideo.get(0).play();
            isVideo.get(0).addEventListener('ended', addReplyButton);
        } else {
            isYoutubeVideo = true;
            var videoContainerCssId = $('.slick-active').find('.player-container').attr('id');
            currentId = videoContainerCssId;
            if (!player[currentId] && videoContainerCssId) {
                if (!isPlayerScriptLoaded) {
                    isPlayerScriptLoaded = true;
                    var tag = document.createElement('script');
                    tag.src = "https://www.youtube.com/iframe_api";
                    var firstScriptTag = document.getElementsByTagName('script')[0];
                    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
                    var videoSrc = $('.slick-active').find('#player-src').data('url');
                    if (!videoSrc) {
                        return;
                    }
                    var re = /https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube(?:-nocookie)?\.com\S*?[^\w\s-])([\w-]{11})(?=[^\w-]|$)(?![?=&+%\w.-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/ig;
                    var videoId = videoSrc.replace(re, '$1');

                    var url = document.createElement('a');
                    url.href = videoSrc;
                    var loop = getParameterFromUrl(url.search, "loop");

                    function getParameterFromUrl(url,name) {
                        var regexS = "[\\?&]" + name + "=([^&#]*)",
                            regex = new RegExp(regexS),
                            results = regex.exec(url);
                        if (results == null) {
                            return "";
                        } else {
                            return decodeURIComponent(results[1].replace(/\+/g, " "));
                        }
                    }

                    function onYouTubeIframeAPIReady() {
                        player[videoContainerCssId] = new YT.Player(videoContainerCssId, {
                            height: '453',
                            width: '100%',
                            videoId: videoId,
                            playerVars: {
                                autoplay: playState ? 1 : 0,
                                controls: 0,
                                mute: muteState ? 1 : 0,
                                showinfo: 0,
                                disablekb: 1,
                                rel: 0,
                                loop: loop ? 1 : 0,
                                playlist: videoId
                            },
                            events: {
                                'onReady': onPlayerReady,
                                'onStateChange': onPlayerStateChange
                            }
                        });

                        /*player[videoContainerCssId].cuePlaylist(videoId);
                        player[videoContainerCssId].setLoop(loop ? true : false);
                        console.log(player[videoContainerCssId].getPlaylist());*/
                    }
                }

                window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;

                function onPlayerReady(event) {
                }

                var done = false;

                function onPlayerStateChange(event) {
                    if (isYoutubeVideo) {
                        if (event.data == YT.PlayerState.PLAYING) {
                            if (!playState) {
                                $('.play-control').find('.control').toggleClass('pause play');
                                playState = !playState;
                                fullScreenPlayState = false;
                            }
                        }
                        if (event.data == YT.PlayerState.PAUSED) {
                            if (playState) {
                                $('.play-control').find('.control').toggleClass('pause play');
                                playState = !playState;
                                fullScreenPlayState = false;
                            }
                        }
                        if (event.data == YT.PlayerState.ENDED) {
                            addReplyButton();
                        }
                    }
                }
            } else {
                slideNext(this);
            }
        }

        /* var heroBanner = new Waypoint.Inview({
           element: document.querySelector('.home-hero-banner-content .button-next.slick-arrow'),
           enter: function (direction) {
             if(window.innerHeight != screen.height){
               if ($('.slick-current .control').hasClass('play') && !userPaused && !usercenterPaused) {
                 $('.slick-current .control').click();
               }
             }
           },
           exited: function (direction) {
             if(window.innerHeight != screen.height){
               if (!$('.slick-current .control').hasClass('play')) {
                 $('.slick-current .control').click();
               }
             }

           }
         });*/

        function bindFullScreenEvent() {
            document.removeEventListener("fullscreenchange", onFullScreenChange, false);
            document.removeEventListener("webkitfullscreenchange", onFullScreenChange, false);
            document.removeEventListener("mozfullscreenchange", onFullScreenChange, false);

            document.addEventListener("fullscreenchange", onFullScreenChange, false);
            document.addEventListener("webkitfullscreenchange", onFullScreenChange, false);
            document.addEventListener("mozfullscreenchange", onFullScreenChange, false);
        }

        function onFullScreenChange() {
            var fullscreenElement = document.fullscreenElement || document.mozFullScreenElement || document.webkitFullscreenElement;
            var videoElem = $('.slick-active').find('video');
            if (videoElem.length && !fullscreenElement) {
                var isMuted = videoElem.get(0).muted;
                var isPlaying = !videoElem.get(0).paused;
                muteState = isMuted;
                playState = isPlaying;
                if (isMuted) {
                    $('.volume').removeClass('unmute');
                }
                else {
                    $('.volume').addClass('unmute');
                }
                if (isPlaying) {
                    $('.play-control').find('.control').removeClass('play').addClass('pause');
                }
                else {
                    $('.play-control').find('.control').removeClass('pause').addClass('play');
                }
            }
        }

        $(document).idle({
            onIdle: function () {
                $('.hero-container').addClass('hideOnVideo')
            },
            onActive: function () {
                $('.hero-container').removeClass('hideOnVideo')
            },
            idle: 10000
        })
        bindFullScreenEvent();
        $(".slick-slider").on("beforeChange", function (event, slick, currentSlide, nextSlide) {

            var imgElem = $('.slick-active', this).find('.video');
            if (imgElem.length) {
                $('.home-banner').addClass('notVideo');
            }

            var videoElem = $('.slick-active', this).find('video');
            var imgWrapper = $('.slick-active', this).find('.images-wrapper');
            if (videoElem.length) {
                $('.coundownTimer').addClass('hideTimer');
                videoElem.get(0).pause();
                videoElem.get(0).removeEventListener('ended', addReplyButton);
            } else if (imgWrapper.length) {
                slideNext(this);
            } else if (isYoutubeVideo) {
                isYoutubeVideo = false;
                player[currentId] && player[currentId].pauseVideo && player[currentId].pauseVideo();
            }
        });

        $(".slick-slider").on("afterChange", function (e, slick, currentSlide) {
            var imgElem = $('.slick-active', this).find('.video');
            if (imgElem.length) {
                $('.home-banner').removeClass('notVideo');
            }


            /*var count = $('.slick-track .slick-slide',this).length;
            var curSlideIndex = parseInt($('.slick-track .slick-active',this).attr('data-slick-index'));
            if (curSlideIndex == 0) {
                $('.button-prev',this).hide();
                $('.button-next',this).show();
            }
            else {
                $('.button-prev',this).show();
            }

            //If we're on the last slide hide the Next button.
            if (count == curSlideIndex + 1) {
                $('.button-next',this).hide();
            }*/
            var videoElem = $('.slick-active', this).find('video');
            var imgWrapper = $('.slick-active', this).find('.images-wrapper');
            if (videoElem.length) {
                isYoutubeVideo = false;
                if (playState || fullScreenPlayState) {
                    videoElem.get(0).play();
                    $('.slick-active', this).find('.play-control').removeClass('replay').find('.control').removeClass('play').addClass('pause');
                    playState = true;
                }
                videoElem.get(0).addEventListener('ended', addReplyButton);
                videoElem.get(0).muted = muteState;

            }
            else if (imgWrapper.length) {
                slideNext(this);
            }
            else {
                /* case for rendering youtube player */

                isYoutubeVideo = true;
                var videoContainerCssId = $('.slick-active', this).find('.player-container').attr('id');
                currentId = videoContainerCssId;
                if (!player[currentId]) {

                    if (!isPlayerScriptLoaded) {
                        isPlayerScriptLoaded = true;
                        var tag = document.createElement('script');
                        tag.src = "https://www.youtube.com/iframe_api";
                        var firstScriptTag = document.getElementsByTagName('script')[0];
                        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
                        var videoSrc = $('.slick-active').find('#player-src').data('url');
                        if (!videoSrc) {
                            return;
                        }
                        var re = /https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube(?:-nocookie)?\.com\S*?[^\w\s-])([\w-]{11})(?=[^\w-]|$)(?![?=&+%\w.-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/ig;
                        var videoId = videoSrc.replace(re, '$1');

                        function onYouTubeIframeAPIReady() {
                            player[videoContainerCssId] = new YT.Player(videoContainerCssId, {
                                height: '100%',
                                width: '100%',
                                videoId: videoId,
                                playerVars: {
                                    autoplay: playState ? 1 : 0,
                                    controls: 0,
                                    mute: muteState ? 1 : 0,
                                    showinfo: 0,
                                    disablekb: 1,
                                    rel: 0
                                },
                                events: {
                                    'onReady': onPlayerReady,
                                    'onStateChange': onPlayerStateChange
                                }
                            });
                        }
                    } else {
                        var videoSrc = $('.slick-active', this).find('#player-src').data('url');
                        if (!videoSrc) {
                            return;
                        }
                        var re = /https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube(?:-nocookie)?\.com\S*?[^\w\s-])([\w-]{11})(?=[^\w-]|$)(?![?=&+%\w.-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/ig;
                        var videoId = videoSrc.replace(re, '$1');
                        player[videoContainerCssId] = new YT.Player(videoContainerCssId, {
                            height: '100%',
                            width: '100%',
                            videoId: videoId,
                            playerVars: {
                                autoplay: playState ? 1 : 0,
                                controls: 0,
                                mute: muteState ? 1 : 0,
                                showinfo: 0,
                                disablekb: 1,
                                rel: 0
                            },
                            events: {
                                'onReady': onPlayerReady,
                                'onStateChange': onPlayerStateChange
                            }
                        });

                    }

                    window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;

                    function onPlayerReady(event) {

                    }

                    var done = false;

                    function onPlayerStateChange(event) {
                        if (isYoutubeVideo) {
                            if (event.data == YT.PlayerState.PLAYING) {
                                if (!playState) {
                                    $('.play-control').find('.control').toggleClass('pause play');
                                    playState = !playState;
                                    fullScreenPlayState = false;
                                }
                            }
                            if (event.data == YT.PlayerState.PAUSED) {
                                if (playState) {
                                    $('.play-control').find('.control').toggleClass('pause play');
                                    playState = !playState;
                                    fullScreenPlayState = false;
                                }
                            }
                            if (event.data == YT.PlayerState.ENDED) {
                                addReplyButton();
                            }
                        }
                    }
                } else {
                    if (playState) {
                        $('.slick-active').find('.play-control').removeClass('replay').find('.control').removeClass('play').addClass('pause');
                        player[currentId].playVideo();
                        if (muteState) {
                            player[currentId].mute();
                        } else {
                            player[currentId].unMute();
                        }
                    }
                }
            }
        });
    }

    //End

    function addReplyButton() {
        $('.slick-active').find('.play-control').addClass('replay');
        var videoElem = $('.slick-active').find('video').get(0);
        fullScreenPlayState = true;

        var exitFullScreen = document.exitFullscreen || document.mozCancelFullScreen || document.webkitExitFullscreen || document.msExitFullscreen;
        if (exitFullScreen) {
            exitFullScreen.call(document);
        }
        bannerTimer = setTimeout(function () {
            $('.home-banner').slick('next')
        }, 5000)
        //coundownTimer();
    }

    function slideNext(thisObj) {
        /* setTimeout(function () {
             $('.home-banner',thisObj).slick('next')
         }, 10000);*/
    }


    function addVideEndEvent() {
        var isVideo = $('.slick-active').find('video');
        if (isVideo.length) {
            isVideo.get(0).addEventListener('ended', addReplyButton);
        }
    }

    /*Playpause handling function*/
    function playpauseHandle(e) {
        $('.play-control').find('.control').toggleClass('pause play');
        clearTimeout(bannerTimer);
        var isVideo = $('.slick-active').find('video');
        var isReplayActive = $(this).hasClass('replay');
        if (isReplayActive) {
            if (isYoutubeVideo) {
                player[currentId].playVideo();
            } else {
                isVideo.get(0).play();
            }
            $(this).removeClass('replay').find('.control').removeClass('play').addClass('pause');
            return;
        }
        $(this).removeClass('replay');
        playState = !playState;
        if (e && e.hasOwnProperty('originalEvent')) {
            userPaused = !userPaused;
            usercenterPaused = !usercenterPaused;
        }

        fullScreenPlayState = false;
        if (isYoutubeVideo) {
            if (playState) {
                if (player[currentId]) {
                    player[currentId].playVideo();
                }
            }
            else {
                player[currentId].pauseVideo();
            }
        } else {
            if (playState) {
                isVideo.get(0).play();
            }
            else {
                isVideo.get(0).pause();
            }
        }
    }

    $('body').on("click", '.hero-container .play-control', playpauseHandle)

    $('body').on("click", '.hero-container .volume', function () {
        $('.volume').toggleClass('unmute');
        var isVideo = $('.slick-active').find('video');
        muteState = !muteState;
        if (isYoutubeVideo) {
            if (muteState) {
                player[currentId].mute()
            }
            else {
                player[currentId].unMute()
            }
        } else {
            if (muteState) {
                isVideo.get(0).muted = true;
            }
            else {
                isVideo.get(0).muted = false;
            }
        }
    });

    $("body").on('click', '.hero-container #fullScreen', function () {
        if (isYoutubeVideo) {
            var playerElement = $('.slick-active').find('#' + currentId).get(0);
            var requestFullScreen = playerElement.requestFullScreen || playerElement.mozRequestFullScreen || playerElement.webkitRequestFullScreen;
            if (requestFullScreen) {
                requestFullScreen.bind(playerElement)();
            }
        } else {
            var videoElem = $('.slick-active').find('video').get(0);
            var isFullScreenAllow = videoElem.requestFullscreen || videoElem.mozRequestFullScreen || videoElem.webkitRequestFullscreen;
            if (isFullScreenAllow) {
                isFullScreenAllow.call(videoElem);
            }
            else {
                alert('full screen not supported by browser')
            }
        }
    });
    if(onYouTubeIframeAPIReady) {
        onYouTubeIframeAPIReady();
    }
});
(function () {
    // 'use strict';

    // Does the browser actually support the video element?
    var supportsVideo = !!document.createElement('video').canPlayType;
    if ($(".offline-video").length) {


        if (supportsVideo) {
            // Obtain handles to main elements
            var videoContainer = $('.off-videoContainer');
            var video = $('.off-video');
            var videoControls = $('.video-controls');

            // Hide the default controls
            $(".off-videoContainer video").controls = false;

            // Display the user defined video controls
            for (var i = 0; i < videoControls.length; i++) {
                videoControls[i].setAttribute('data-state', 'visible');
            }
            // Obtain handles to buttons and other elements
            var playpause = $('.off-playpause');
            var stop = $('.off-stop');
            var mute = $('.off-mute');
            var volinc = $('.off-volinc');
            var voldec = $('.off-voldec');
            var progress = $('.off-progress');
            var progressBar = $('off-progress-bar');
            var fullscreen = $('.off-fs');

            // If the browser doesn't support the progress element, set its state for some different styling
            var supportsProgress = (document.createElement('progress').max !== undefined);
            if (!supportsProgress) progress.setAttribute('data-state', 'fake');

            // Check if the browser supports the Fullscreen API
            var fullScreenEnabled = !!(document.fullscreenEnabled || document.mozFullScreenEnabled || document.msFullscreenEnabled || document.webkitSupportsFullscreen || document.webkitFullscreenEnabled || document.createElement('video').webkitRequestFullScreen);
            // If the browser doesn't support the Fulscreen API then hide the fullscreen button
            if (!fullScreenEnabled) {
                fullscreen.style.display = 'none';
            }

            // Check the volume
            var checkVolume = function (dir) {
                if (dir) {
                    var currentVolume = Math.floor(video.volume * 10) / 10;
                    if (dir === '+') {
                        if (currentVolume < 1) video.volume += 0.1;
                    }
                    else if (dir === '-') {
                        if (currentVolume > 0) video.volume -= 0.1;
                    }
                    // If the volume has been turned off, also set it as muted
                    // Note: can only do this with the custom control set as when the 'volumechange' event is raised, there is no way to know if it was via a volume or a mute change
                    if (currentVolume <= 0) video.muted = true;
                    else video.muted = false;
                }
                changeButtonState('mute');
            }

            // Change the volume
            var alterVolume = function (dir) {
                checkVolume(dir);
            }

            // Set the video container's fullscreen state
            var setFullscreenData = function (state) {
                videoContainer.setAttribute('data-fullscreen', !!state);
                // Set the fullscreen button's 'data-state' which allows the correct button image to be set via CSS
                fullscreen.setAttribute('data-state', !!state ? 'cancel-fullscreen' : 'go-fullscreen');
            }

            // Checks if the document is currently in fullscreen mode
            var isFullScreen = function () {
                return !!(document.fullScreen || document.webkitIsFullScreen || document.mozFullScreen || document.msFullscreenElement || document.fullscreenElement);
            }

            // Fullscreen
            var handleFullscreen = function (that) {
                // If fullscreen mode is active...
                if (isFullScreen()) {
                    // ...exit fullscreen mode
                    // (Note: this can only be called on document)
                    if (document.exitFullscreen) document.exitFullscreen();
                    else if (document.mozCancelFullScreen) document.mozCancelFullScreen();
                    else if (document.webkitCancelFullScreen) document.webkitCancelFullScreen();
                    else if (document.msExitFullscreen) document.msExitFullscreen();
                    setFullscreenData(false);
                }
                else {
                    // ...otherwise enter fullscreen mode
                    // (Note: can be called on document, but here the specific element is used as it will also ensure that the element's children, e.g. the custom controls, go fullscreen also)
                    if (videoContainer.requestFullscreen) videoContainer.requestFullscreen();
                    else if (videoContainer.mozRequestFullScreen) videoContainer.mozRequestFullScreen();
                    else if (videoContainer.webkitRequestFullScreen) {
                        // Safari 5.1 only allows proper fullscreen on the video element. This also works fine on other WebKit browsers as the following CSS (set in styles.css) hides the default controls that appear again, and
                        // ensures that our custom controls are visible:
                        // figure[data-fullscreen=true] video::-webkit-media-controls { display:none !important; }
                        // figure[data-fullscreen=true] .controls { z-index:2147483647; }
                        video.webkitRequestFullScreen();
                    }
                    else if (videoContainer.msRequestFullscreen) videoContainer.msRequestFullscreen();
                    setFullscreenData(true);
                }
            }

            // Only add the events if addEventListener is supported (IE8 and less don't support it, but that will use Flash anyway)
            if (document.addEventListener) {
                // Wait for the video's meta data to be loaded, then set the progress bar's max value to the duration of the video
                for (var i = 0; i < video.length; i++) {
                    video[i].addEventListener('loadedmetadata', function () {
                        for (var i = 0; i < progress.length; i++) {
                            progress[i].setAttribute('max', video.duration);
                        }
                    });
                }

                // Changes the button state of certain button's so the correct visuals can be displayed with CSS
                var changeButtonState = function (type) {
                    // Play/Pause button
                    if (type == 'playpause') {
                        if (video.paused || video.ended) {

                            playpause[0].setAttribute('data-state', 'play');
                        }
                        else {
                            playpause[0].setAttribute('data-state', 'pause');
                        }
                    }
                    // Mute button
                    else if (type == 'mute') {
                        mute.attr('data-state', video.muted ? 'unmute' : 'mute');
                    }
                }

                // Add event listeners for video specific events
                //     for (var i = 0 ; i < video.length; i++){
                //     video[i].addEventListener('play', function () {
                //         changeButtonState('playpause');
                //     }, false);
                // }
                // for (var i = 0 ; i < video.length; i++){
                //     video[i].addEventListener('pause', function () {
                //         changeButtonState('playpause');
                //     }, false);
                // }
                video.on('play', function () {
                    if ($(this).get(0).paused || $(this).get(0).ended) {

                        $(this).siblings(".controls").find(playpause).attr('data-state', 'play');
                    }
                    else {
                        $(this).siblings(".controls").find(playpause).attr('data-state', 'pause');
                    }
                });
                video.on('pause', function () {
                    if ($(this).get(0).paused || $(this).get(0).ended) {

                        $(this).siblings(".controls").find(playpause).attr('data-state', 'play');
                    }
                    else {
                        $(this).siblings(".controls").find(playpause).attr('data-state', 'pause');
                    }
                });

                // for (var i = 0; i < video.length; i++) {
                //     video[i].addEventListener('volumechange', function () {
                //         checkVolume();
                //     }, false);
                // }
                // Add events for all buttons
                //     for (var i = 0 ; i < playpause.length; i++){
                //     playpause[i].addEventListener('click', function (e) {
                //         if (video[i].paused || video[i].ended) video[i].play();
                //         else video[i].pause();
                //     });
                // }
                playpause.click(function () {
                    if ($(this).closest(".controls").siblings("video").get(0).paused || $(this).closest(".controls").siblings("video").get(0).ended)
                        $(this).closest(".controls").siblings("video").get(0).play();
                    else
                        $(this).closest(".controls").siblings("video").get(0).pause();
                })

                // The Media API has no 'stop()' function, so pause the video and reset its time and the progress bar
                // for (var i = 0; i < video.length; i++) {
                //     stop[i].addEventListener('click', function (e) {
                //         video[i].pause();
                //         video[i].currentTime = 0;
                //         progress[i].value = 0;
                //         // Update the play/pause button's 'data-state' which allows the correct button image to be set via CSS
                //         changeButtonState('playpause');
                //     });
                // }
                // for (var i = 0; i < video.length; i++) {
                //     mute[i].addEventListener('click', function (e) {
                //         video[i].muted = !video[i].muted;
                //         changeButtonState('mute');
                //     });
                // }
                mute.click(function(){
                    let vid = $(this).closest(".controls").siblings("video").get(0);
                    $(this).closest(".controls").siblings("video").get(0).muted = !$(this).closest(".controls").siblings("video").get(0).muted; 
                    $(this).attr('data-state', $(this).closest(".controls").siblings("video").get(0).muted ? 'mute' : 'unmute');
                })
                for (var i = 0; i < video.length; i++) {
                    volinc[i].addEventListener('click', function (e) {
                        alterVolume('+');
                    });
                }
                for (var i = 0; i < video.length; i++) {
                    voldec[i].addEventListener('click', function (e) {
                        alterVolume('-');
                    });
                }
                // for (var i = 0; i < video.length; i++) {
                //     fullscreen[i].addEventListener('click', function (e) {
                //         handleFullscreen();
                //     });
                // }
                fullscreen.click(function(){
                    $(this).closest(".controls").siblings("video").get(0).requestFullscreen();
                })
                // As the video is playing, update the progress bar
                /* video.addEventListener('timeupdate', function () {
                     // For mobile browsers, ensure that the progress element's max attribute is set
                     if (!progress.getAttribute('max')) progress.setAttribute('max', video.duration);
                     progress.value = video.currentTime;
                     progressBar.style.width = Math.floor((video.currentTime / video.duration) * 100) + '%';
                 });*/

                // React to the user clicking within the progress bar
                /* progress.addEventListener('click', function (e) {
                     //var pos = (e.pageX  - this.offsetLeft) / this.offsetWidth; // Also need to take the parent into account here as .controls now has position:relative
                     var pos = (e.pageX - (this.offsetLeft + this.offsetParent.offsetLeft)) / this.offsetWidth;
                     video.currentTime = pos * video.duration;
                 });*/

                // Listen for fullscreen change events (from other controls, e.g. right clicking on the video itself)
                document.addEventListener('fullscreenchange', function (e) {
                    setFullscreenData(!!(document.fullScreen || document.fullscreenElement));
                });
                document.addEventListener('webkitfullscreenchange', function () {
                    setFullscreenData(!!document.webkitIsFullScreen);
                });
                document.addEventListener('mozfullscreenchange', function () {
                    setFullscreenData(!!document.mozFullScreen);
                });
                document.addEventListener('msfullscreenchange', function () {
                    setFullscreenData(!!document.msFullscreenElement);
                });
            }
        }
    }

})();
/*!
 * http://suyati.github.io/line-control
 * LineControl 1.1.0
 * Copyright (C) 2014, Suyati Technologies
 * This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.
This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.
You should have received a copy of the GNU General Public License along with this library; if not, write to the Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
 *
*/

(function ($) {
    var editorObj;
    var methods = {
        saveSelection: function () {
            //Function to save the text selection range from the editor
            $(this).data('editor').focus();
            if (window.getSelection) {
                sel = window.getSelection();
                if (sel.getRangeAt && sel.rangeCount) {
                    $(this).data('currentRange', sel.getRangeAt(0));
                }
            } else if (document.selection && document.selection.createRange) {
                $(this).data('currentRange', document.selection.createRange());
            }
            else
                $(this).data('currentRange', null);
        },

        restoreSelection: function (text, mode) {
            //Function to restore the text selection range from the editor
            var node;
            typeof text !== 'undefined' ? text : false;
            typeof mode !== 'undefined' ? mode : "";
            var range = $(this).data('currentRange');
            if (range) {
                if (window.getSelection) {
                    if (text) {
                        range.deleteContents();
                        if (mode == "html") {
                            var el = document.createElement("div");
                            el.innerHTML = text;
                            var frag = document.createDocumentFragment(), node, lastNode;
                            while ((node = el.firstChild)) {
                                lastNode = frag.appendChild(node);
                            }
                            range.insertNode(frag);
                        }
                        else
                            range.insertNode(document.createTextNode(text));

                    }
                    sel = window.getSelection();
                    sel.removeAllRanges();
                    sel.addRange(range);
                }
                else if (document.selection && range.select) {
                    range.select();
                    if (text) {
                        if (mode == "html")
                            range.pasteHTML(text);
                        else
                            range.text = text;
                    }
                }
            }
        },

        restoreIESelection: function () {
            //Function to restore the text selection range from the editor in IE
            var range = $(this).data('currentRange');
            if (range) {
                if (window.getSelection) {
                    sel = window.getSelection();
                    sel.removeAllRanges();
                    sel.addRange(range);
                } else if (document.selection && range.select) {
                    range.select();
                }
            }
        },

        insertTextAtSelection: function (text, mode) {
            var sel, range, node;
            typeof mode !== 'undefined' ? mode : "";
            if (window.getSelection) {
                sel = window.getSelection();
                if (sel.getRangeAt && sel.rangeCount) {
                    range = sel.getRangeAt(0);
                    range.deleteContents();
                    var textNode = document.createTextNode(text);

                    if (mode == "html") {
                        var el = document.createElement("div");
                        el.innerHTML = text;
                        var frag = document.createDocumentFragment(), node, lastNode;
                        while ((node = el.firstChild)) {
                            lastNode = frag.appendChild(node);
                        }
                        range.insertNode(frag);
                    }
                    else {
                        range.insertNode(textNode);
                        range.selectNode(textNode);
                    }
                    sel.removeAllRanges();
                    range = range.cloneRange();
                    range.collapse(false);
                    sel.addRange(range);
                }
            } else if (document.selection && document.selection.createRange) {
                range = document.selection.createRange();
                range.pasteHTML(text);
                range.select();
            }
        },

        imageWidget: function () {
            //Class for Widget Handling the upload of Files
            var _idSuffix = this.attr("id");
            var row = $('<div/>', {
                "class": "row"
            }).append($('<div/>', {
                id: "imgErrMsg_" + _idSuffix
            }));
            var container = $('<div/>', {'class': "tabbable tabs-left"});
            var navTabs = $('<ul/>',
                {
                    class: "nav nav-tabs"
                }).append($('<li/>',
                {
                    class: "active"
                }).append($('<a/>', {
                    "href": "#uploadImageBar_" + _idSuffix,
                    "data-toggle": "tab"
                }).html("From Computer")
            )).append($('<li/>').append($('<a/>', {
                "href": "#imageFromLinkBar_" + _idSuffix,
                "data-toggle": "tab"
            }).html("From URL")));

            var tabContent = $("<div/>", {class: "tab-content"});
            var uploadImageBar = $("<div/>", {
                id: "uploadImageBar_" + _idSuffix,
                class: "tab-pane active"
            });

            handleFileSelect = function (evt) {
                var files = evt.target.files; // FileList object
                var output = [];
                for (var i = 0, f; f = files[i]; i++) {
                    //Loop thorugh all the files
                    if (!f.type.match('image.*') || !f.name.match(/(?:gif|jpg|png|jpeg)$/)) { //Process only Images
                        methods.showMessage.apply(this, ["imgErrMsg_" + _idSuffix, "Invalid file type"]);
                        continue;
                    }
                    var reader = new FileReader();
                    reader.onload = (function (imageFile) {
                        return function (e) {
                            //Render Thumnails
                            var li = $('<li/>', {class: "col-xs-12 col-sm-6 col-md-3 col-lg-3"});
                            var a = $('<a/>', {
                                href: "javascript:void(0)",
                                class: "thumbnail"
                            });
                            var image = $('<img/>', {
                                src: e.target.result,
                                title: escape(imageFile.name)
                            }).appendTo(a).click(function () {
                                $('#imageList_' + _idSuffix).data('current', $(this).attr('src'));
                            });
                            li.append(a).appendTo($('#imageList_' + _idSuffix));
                        }
                    })(f);
                    reader.readAsDataURL(f);
                }
            }
            var chooseFromLocal = $('<input/>', {
                type: "file",
                class: "inline-form-control",
                multiple: "multiple"
            });
            chooseFromLocal.on('change', handleFileSelect);
            uploadImageBar.append(chooseFromLocal);
            var imageFromLinkBar = $("<div/>", {
                id: "imageFromLinkBar_" + _idSuffix,
                class: "tab-pane"
            });
            var getImageURL = $("<div/>", {class: "input-group"});
            var imageURL = $('<input/>', {
                type: "url",
                class: 'form-control',
                id: "imageURL_" + _idSuffix,
                placeholder: "Enter URL"
            }).appendTo(getImageURL);
            var getURL = $("<button/>", {
                class: "btn btn-success",
                type: "button"
            }).html("Go!").click(function () {
                var url = $('#imageURL_' + _idSuffix).val();
                if (url == '') {
                    methods.showMessage.apply(this, ["imgErrMsg_" + _idSuffix, "Please enter image url"]);
                    return false;
                }
                var li = $('<li/>', {class: "span6 col-xs-12 col-sm-6 col-md-3 col-lg-3"});
                var a = $('<a/>', {
                    href: "javascript:void(0)",
                    class: "thumbnail"
                });
                var image = $('<img/>', {
                    src: url,
                }).error(function () {
                    methods.showMessage.apply(this, ["imgErrMsg_" + _idSuffix, "Invalid image url"]);
                    return false;
                }).load(function () {
                    $(this).appendTo(a).click(function () {
                        $('#imageList_' + _idSuffix).data('current', $(this).attr('src'));
                    });
                    li.append(a).appendTo($('#imageList_' + _idSuffix));
                });
            }).appendTo($("<span/>", {class: "input-group-btn form-control-button-right"}).appendTo(getImageURL));

            imageFromLinkBar.append(getImageURL);
            tabContent.append(uploadImageBar).append(imageFromLinkBar);
            container.append(navTabs).append(tabContent);

            var imageListContainer = $("<div/>", {'class': 'col-xs-12 col-sm-12 col-md-12 col-lg-12'});
            var imageList = $('<ul/>', {
                "class": "thumbnails padding-top list-unstyled",
                "id": 'imageList_' + _idSuffix
            }).appendTo(imageListContainer);
            row.append(container).append(imageListContainer);
            return row;
        },

        tableWidget: function (mode) {
            //Function to generate the table input form
            var idExtn = "_" + $(this).attr("id");
            if (typeof mode !== 'undefined') {
                idExtn = "_" + editorObj.attr("id") + "_Edt";
            }
            var tblCntr = $('<div/>', { //Outer Container Div
                class: "row-fluid"
            }).append($('<div/>', { //Err Message Div
                id: "tblErrMsg" + idExtn
            })).append($('<form/>', { //Form
                    id: "tblForm" + idExtn
                }).append($('<div/>', { //Inner Container Div
                    class: "row"
                }).append($('<div/>', { //Left input Container Div
                    id: "tblInputsLeft" + idExtn,
                    class: "col-xs-12 col-sm-6 col-md-6 col-lg-6"
                }).append($('<label/>', {for: "tblRows" + idExtn, text: "Rows"}
                )).append($('<input/>', {
                    id: "tblRows" + idExtn,
                    type: "text",
                    class: "form-control form-control-width",
                    value: 2
                })).append($('<label/>', {for: "tblColumns" + idExtn, text: "Columns"}
                )).append($('<input/>', {
                    id: "tblColumns" + idExtn,
                    type: "text",
                    class: "form-control form-control-width",
                    value: 2
                })).append($('<label/>', {for: "tblWidth" + idExtn, text: "Width"}
                )).append($('<input/>', {
                    id: "tblWidth" + idExtn,
                    type: "text",
                    class: "form-control form-control-width",
                    value: 400
                })).append($('<label/>', {for: "tblHeight" + idExtn, text: "Height"}
                )).append($('<input/>', {
                    id: "tblHeight" + idExtn,
                    type: "text",
                    class: "form-control form-control-width",
                }))
                ).append($('<div/>', { //Right input Container Div
                    id: "tblInputsRight" + idExtn,
                    class: "col-xs-12 col-sm-6 col-md-6 col-lg-6"
                }).append($('<label/>', {for: "tblAlign" + idExtn, text: "Alignment"}
                )).append($('<select/>', {id: "tblAlign" + idExtn, class: "form-control form-control-width"}
                ).append($('<option/>', {text: "Choose", value: ""}
                )).append($('<option/>', {text: "Left", value: "left"}
                )).append($('<option/>', {text: "Center", value: "center"}
                )).append($('<option/>', {text: "Right", value: "right"}))
                ).append($('<label/>', {for: "tblBorder" + idExtn, text: "Border size"}
                )).append($('<input/>', {
                    id: "tblBorder" + idExtn,
                    type: "text",
                    class: "form-control form-control-width",
                    value: 1
                })).append($('<label/>', {for: "tblCellspacing" + idExtn, text: "Cell spacing"}
                )).append($('<input/>', {
                    id: "tblCellspacing" + idExtn,
                    type: "text",
                    class: "form-control form-control-width",
                    value: 1
                })).append($('<label/>', {for: "tblCellpadding" + idExtn, text: "Cell padding"}
                )).append($('<input/>', {
                    id: "tblCellpadding" + idExtn,
                    type: "text",
                    class: "form-control form-control-width",
                    value: 1
                }))
                )
                )
            )
            return tblCntr;
        },

        imageAttributeWidget: function () {

            var edtTablecntr = $('<div/>', {
                    class: "row-fluid"
                }
            ).append($('<div/>', { //Err Message Div
                id: "imageErrMsg"
            })).append($('<input/>', {
                id: "imgAlt",
                type: "text",
                class: "form-control form-control-link ",
                placeholder: "Alt Text",
            })).append($('<input/>', {
                id: "imgTarget",
                class: "form-control form-control-link ",
                type: "text",
                placeholder: "Link Target"
            })).append($('<input/>', {
                id: "imgHidden",
                type: "hidden"
            }))

            return edtTablecntr;

        },

        getHTMLTable: function (tblRows, tblColumns, attributes) {
            //Function to generate html table. Supplied arguments: tablerows-no.of rows, no.of columns, table attributes.
            var tableElement = $('<table/>', {class: "table"});
            for (var i = 0; i < attributes.length; i++) {
                if (attributes[i].value != '') {
                    if (attributes[i].attribute == "width" || attributes[i].attribute == "height")
                        tableElement.css(attributes[i].attribute, attributes[i].value);
                    else
                        tableElement.attr(attributes[i].attribute, attributes[i].value);
                }
            }
            for (var i = 1; i <= tblRows; i++) {
                var tblRow = $('<tr/>');
                for (var j = 1; j <= tblColumns; j++) {
                    var tblColumn = $('<td/>').html('&nbsp;');
                    tblColumn.appendTo(tblRow);
                }
                tblRow.appendTo(tableElement);
            }
            return tableElement;
        },

        init: function (options) {
            if ($(this).attr("id") === undefined || $(this).attr("id") === "") {
                $(this).attr("id", Date.now());
            }
            var fonts = {
                "Sans serif": "arial,helvetica,sans-serif",
                "Serif": "times new roman,serif",
                "Wide": "arial black,sans-serif",
                "Narrow": "arial narrow,sans-serif",
                "Comic Sans MS": "comic sans ms,sans-serif",
                "Courier New": "courier new,monospace",
                "Garamond": "garamond,serif",
                "Georgia": "georgia,serif",
                "Tahoma": "tahoma,sans-serif",
                "Trebuchet MS": "trebuchet ms,sans-serif",
                "Verdana": "verdana,sans-serif"
            };

            var styles = {
                "Heading 1": "<h1>",
                "Heading 2": "<h2>",
                "Heading 3": "<h3>",
                "Heading 4": "<h4>",
                "Heading 5": "<h5>",
                "Heading 6": "<h6>",
                "Paragraph": "<p>"
            };

            var fontsizes = {
                "Small": "2",
                "Normal": "3",
                "Medium": "4",
                "Large": "5",
                "Huge": "6"
            };

            var colors = [{name: 'Black', hex: '#000000'},
                {name: 'MediumBlack', hex: '#444444'},
                {name: 'LightBlack', hex: '#666666'},
                {name: 'DimBlack', hex: '#999999'},
                {name: 'Gray', hex: '#CCCCCC'},
                {name: 'DimGray', hex: '#EEEEEE'},
                {name: 'LightGray', hex: '#F3F3F3'},
                {name: 'White', hex: '#FFFFFF'},

                {name: 'libreak', hex: null},

                {name: 'Red', hex: '#FF0000'},
                {name: 'Orange', hex: '#FF9900'},
                {name: 'Yellow', hex: '#FFFF00'},
                {name: 'Lime', hex: '#00FF00'},
                {name: 'Cyan', hex: '#00FFFF'},
                {name: 'Blue', hex: '#0000FF'},
                {name: 'BlueViolet', hex: '#8A2BE2'},
                {name: 'Magenta', hex: '#FF00FF'},

                {name: 'libreak', hex: null},

                {name: 'LightPink', hex: '#FFB6C1'},
                {name: 'Bisque', hex: '#FCE5CD'},
                {name: 'BlanchedAlmond', hex: '#FFF2CC'},
                {name: 'LightLime', hex: '#D9EAD3'},
                {name: 'LightCyan', hex: '#D0E0E3'},
                {name: 'AliceBlue', hex: '#CFE2F3'},
                {name: 'Lavender', hex: '#D9D2E9'},
                {name: 'Thistle', hex: '#EAD1DC'},

                {name: 'LightCoral', hex: '#EA9999'},
                {name: 'Wheat', hex: '#F9CB9C'},
                {name: 'NavajoWhite', hex: '#FFE599'},
                {name: 'DarkSeaGreen', hex: '#B6D7A8'},
                {name: 'LightBlue', hex: '#A2C4C9'},
                {name: 'SkyBlue', hex: '#9FC5E8'},
                {name: 'LightPurple', hex: '#B4A7D6'},
                {name: 'PaleVioletRed', hex: '#D5A6BD'},

                {name: 'IndianRed', hex: '#E06666'},
                {name: 'LightSandyBrown', hex: '#F6B26B'},
                {name: 'Khaki', hex: '#FFD966'},
                {name: 'YellowGreen', hex: '#93C47D'},
                {name: 'CadetBlue', hex: '#76A5AF'},
                {name: 'DeepSkyBlue', hex: '#6FA8DC'},
                {name: 'MediumPurple', hex: '#8E7CC3'},
                {name: 'MediumVioletRed', hex: '#C27BA0'},

                {name: 'Crimson', hex: '#CC0000'},
                {name: 'SandyBrown', hex: '#E69138'},
                {name: 'Gold', hex: '#F1C232'},
                {name: 'MediumSeaGreen', hex: '#6AA84F'},
                {name: 'Teal', hex: '#45818E'},
                {name: 'SteelBlue', hex: '#3D85C6'},
                {name: 'SlateBlue', hex: '#674EA7'},
                {name: 'VioletRed', hex: '#A64D79'},

                {name: 'Brown', hex: '#990000'},
                {name: 'Chocolate', hex: '#B45F06'},
                {name: 'GoldenRod', hex: '#BF9000'},
                {name: 'Green', hex: '#38761D'},
                {name: 'SlateGray', hex: '#134F5C'},
                {name: 'RoyalBlue', hex: '#0B5394'},
                {name: 'Indigo', hex: '#351C75'},
                {name: 'Maroon', hex: '#741B47'},

                {name: 'DarkRed', hex: '#660000'},
                {name: 'SaddleBrown', hex: '#783F04'},
                {name: 'DarkGoldenRod', hex: '#7F6000'},
                {name: 'DarkGreen', hex: '#274E13'},
                {name: 'DarkSlateGray', hex: '#0C343D'},
                {name: 'Navy', hex: '#073763'},
                {name: 'MidnightBlue', hex: '#20124D'},
                {name: 'DarkMaroon', hex: '#4C1130'}];

            var specialchars = [{name: "Exclamation ", text: "!"},
                {name: "At", text: "@"},
                {name: "Hash", text: "#"},
                {name: "Percentage", text: "%"},
                {name: "Uppercase", text: "^"},
                {name: "Ampersand", text: "&"},
                {name: "Asterisk", text: "*"},
                {name: "OpenBracket", text: "("},
                {name: "CloseBracket", text: ")"},
                {name: "Underscore", text: "_"},
                {name: "Hiphen", text: "-"},
                {name: "Plus", text: "+"},
                {name: "Equalto", text: "="},
                {name: "OpenSquareBracket", text: "["},
                {name: "CloseSquareBracket", text: "]"},
                {name: "OpenCurly", text: "{"},
                {name: "CloseCurly", text: "}"},
                {name: "Pipe", text: "|"},
                {name: "Colon", text: ":"},
                {name: "Semicolon", text: ";"},
                {name: "Single quote", text: "&#39;"},
                {name: "Double quote", text: "&#34;"},
                {name: "Left single curly quote", text: "&lsquo;"},
                {name: "right single curly quote", text: "&rsquo;"},
                {name: "Forward-slash", text: "&#47;"},
                {name: "Back-slash", text: "&#92;"},
                {name: "LessThan", text: "<"},
                {name: "GreaterThan", text: ">"},
                {name: "QuestionMark", text: "?"},
                {name: "Tilda", text: "~"},
                {name: "Grave accent", text: "`"},
                {name: "Micron", text: "&micro;"},
                {name: "Paragraph sign", text: "&para;"},
                {name: "Plus/minus", text: "&plusmn;"},
                {name: "Trademark", text: "&trade;"},
                {name: "Copyright", text: "&copy;"},
                {name: "Registered", text: "&reg;"},
                {name: "Section", text: "&sect;"},
                {name: "right double angle quotes", text: "&#187;"},
                {name: "fraction one quarter", text: "&#188;"},
                {name: "fraction one half", text: "&#189;"},
                {name: "fraction three quarters", text: "&#190;"},
                {name: "Dollar", text: "$"},
                {name: "Euro", text: "&euro;"},
                {name: "Pound", text: "&pound;"},
                {name: "Yen", text: "&yen;"},
                {name: "Cent", text: "&#162;"},
                {name: "IndianRupee", text: "&#8377;"},];

            var menuItems = {
                'fonteffects': true,
                'texteffects': true,
                'aligneffects': true,
                'textformats': true,
                'actions': true,
                'insertoptions': true,
                'extraeffects': true,
                'advancedoptions': true,
                'screeneffects': true,

                'fonts': {
                    "select": true,
                    "default": "Font",
                    "tooltip": "Fonts",
                    "commandname": "fontName",
                    "custom": null
                },

                'styles': {
                    "select": true,
                    "default": "Formatting",
                    "tooltip": "Paragraph Format",
                    "commandname": "formatBlock",
                    "custom": null
                },

                'font_size': {
                    "select": true,
                    "default": "Font size",
                    "tooltip": "Font Size",
                    "commandname": "fontSize",
                    "custom": null
                },

                'color': {
                    "text": "A",
                    "icon": "fa fa-font",
                    "tooltip": "Text/Background Color",
                    "commandname": null,
                    "custom": function (button) {
                        var editor = $(this);
                        var flag = 0;
                        var paletteCntr = $('<div/>', {
                            id: "paletteCntr",
                            class: "activeColour",
                            css: {"display": "none", "width": "335px"}
                        }).click(function (event) {
                            event.stopPropagation();
                        });
                        var paletteDiv = $('<div/>', {id: "colorpellete"});
                        var palette = $('<ul />', {id: "color_ui"}).append($('<li />').css({
                            "width": "145px",
                            "display": "Block",
                            "height": "25px"
                        }).html('<div>Text Color</div>'));
                        var bgPalletteDiv = $('<div/>', {id: "bg_colorpellete"});
                        var bgPallette = $('<ul />', {id: "bgcolor_ui"}).append($('<li />').css({
                            "width": "145px",
                            "display": "Block",
                            "height": "25px"
                        }).html('<div>Background Color</div>'));
                        if (editor.data("colorBtn")) {
                            flag = 1;
                            editor.data("colorBtn", null);
                        }
                        else
                            editor.data("colorBtn", 1);
                        if (flag == 0) {
                            for (var i = 0; i < colors.length; i++) {
                                if (colors[i].hex != null) {
                                    palette.append($('<li />').css('background-color', colors[i].hex).mousedown(function (event) {
                                        event.preventDefault();
                                    }).click(function () {
                                        var hexcolor = methods.rgbToHex.apply(this, [$(this).css('background-color')]);
                                        methods.restoreSelection.apply(this);
                                        methods.setStyleWithCSS.apply(this);
                                        document.execCommand('forecolor', false, hexcolor);
                                        $('#paletteCntr').remove();

                                        editor.data("colorBtn", null);
                                    }));

                                    bgPallette.append($('<li />').css('background-color', colors[i].hex).mousedown(function (event) {
                                        event.preventDefault();
                                    }).click(function () {
                                        var hexcolor = methods.rgbToHex.apply(this, [$(this).css('background-color')]);
                                        methods.restoreSelection.apply(this);
                                        methods.setStyleWithCSS.apply(this);
                                        document.execCommand('backColor', false, hexcolor);
                                        $('#paletteCntr').remove();
                                        editor.data("colorBtn", null);
                                    }));
                                }
                                else {
                                    palette.append($('<li />').css({
                                        "width": "145px",
                                        "display": "Block",
                                        "height": "5px"
                                    }));
                                    bgPallette.append($('<li />').css({
                                        "width": "145px",
                                        "display": "Block",
                                        "height": "5px"
                                    }));
                                }
                            }
                            palette.appendTo(paletteDiv);
                            bgPallette.appendTo(bgPalletteDiv);
                            paletteDiv.appendTo(paletteCntr);
                            bgPalletteDiv.appendTo(paletteCntr)
                            paletteCntr.insertAfter(button);
                            $('#paletteCntr').slideDown('slow');
                        }
                        else
                            $('#paletteCntr').remove();
                    }
                },

                'bold': {
                    "text": "B",
                    "icon": "fa fa-bold",
                    "tooltip": "Bold",
                    "commandname": "bold",
                    "custom": null
                },

                'italics': {
                    "text": "I",
                    "icon": "fa fa-italic",
                    "tooltip": "Italics",
                    "commandname": "italic",
                    "custom": null
                },

                'underline': {
                    "text": "U",
                    "icon": "fa fa-underline",
                    "tooltip": "Underline",
                    "commandname": "underline",
                    "custom": null
                },

                'strikeout': {
                    "text": "Strikeout",
                    "icon": "fa fa-strikethrough",
                    "tooltip": "Strike Through",
                    "commandname": "strikeThrough",
                    "custom": null
                },

                'ol': {
                    "text": "N",
                    "icon": "fa fa-list-ol",
                    "tooltip": "Insert/Remove Numbered List",
                    "commandname": "insertorderedlist",
                    "custom": null
                },

                'ul': {
                    "text": "Bullet",
                    "icon": "fa fa-list-ul",
                    "tooltip": "Insert/Remove Bulleted List",
                    "commandname": "insertunorderedlist",
                    "custom": null
                },

                'undo': {
                    "text": "undo",
                    "icon": "fa fa-undo",
                    "tooltip": "Undo",
                    "commandname": "undo",
                    "custom": null
                },

                'redo': {
                    "text": "redo",
                    "icon": "fa fa-repeat",
                    "tooltip": "Redo",
                    "commandname": "redo",
                    "custom": null
                },

                'l_align': {
                    "text": "leftalign",
                    "icon": "fa fa-align-left",
                    "tooltip": "Align Left",
                    "commandname": "justifyleft",
                    "custom": null
                },

                'r_align': {
                    "text": "rightalign",
                    "icon": "fa fa-align-right",
                    "tooltip": "Align Right",
                    "commandname": "justifyright",
                    "custom": null
                },

                'c_align': {
                    "text": "centeralign",
                    "icon": "fa fa-align-center",
                    "tooltip": "Align Center",
                    "commandname": "justifycenter",
                    "custom": null
                },

                'justify': {
                    "text": "justify",
                    "icon": "fa fa-align-justify",
                    "tooltip": "Justify",
                    "commandname": "justifyfull",
                    "custom": null
                },

                'unlink': {
                    "text": "Unlink",
                    "icon": "fa fa-unlink",
                    "tooltip": "Unlink",
                    "commandname": "unlink",
                    "custom": null
                },

                'insert_link': {
                    "modal": true,
                    "modalId": "InsertLink_" + $(this).attr("id"),
                    "icon": "fa fa-link",
                    "tooltip": "Insert Link",
                    "modalHeader": "Insert Hyperlink",
                    "modalBody": $('<div/>', {
                        class: "form-group"
                    }).append($('<div/>', {
                        id: "errMsg_" + $(this).attr("id")
                    })).append($('<input/>', {
                        type: "text",
                        id: "inputText_" + $(this).attr("id"),
                        class: "form-control form-control-link ",
                        placeholder: "Text to Display",
                    })).append($('<input/>', {
                        type: "text",
                        id: "inputUrl_" + $(this).attr("id"),
                        required: true,
                        class: "form-control form-control-link",
                        placeholder: "Enter URL"
                    })),
                    "beforeLoad": function () {
                        editorObj = this;
                        var _idSuffix = "_" + this.attr("id");
                        $('#inputText' + _idSuffix);
                        $('#inputUrl' + _idSuffix);
                        $(".alert").alert("close");
                        if ($(editorObj).data('currentRange') != '') {
                            $('#inputText_' + _idSuffix).val($(editorObj).data('currentRange'));
                        }
                    },
                    "onSave": function () {
                        var urlPattern = /(http|ftp|https):\/\/[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#-]*[\w@?^=%&amp;\/~+#-])?/;
                        var _idSuffix = "_" + editorObj.attr("id");
                        var targetText = $('#inputText' + _idSuffix).val();
                        var targetURL = $('#inputUrl' + _idSuffix).val();
                        var range = $(editorObj).data('currentRange');
                        if (targetURL == '') {
                            methods.showMessage.apply(editorObj, ["errMsg", "Please enter url"]);
                            return false;
                        }
                        if (!targetURL.match(urlPattern)) {
                            methods.showMessage.apply(editorObj, ["errMsg", "Enter valid url"]);
                            return false;
                        }
                        if (range == '' && targetText == '') {
                            targetText = targetURL;
                        }
                        if (navigator.userAgent.match(/MSIE/i) || navigator.userAgent.match(/Windows NT.*Trident\//)) {
                            var targetLink = '<a href="' + targetURL + '" target="_blank">' + targetText + '</a>';
                            methods.restoreSelection.apply(editorObj, [targetLink, 'html']);
                        }
                        else {
                            methods.restoreSelection.apply(editorObj, [targetText]);
                            document.execCommand('createLink', false, targetURL);
                        }
                        $(editorObj).data("editor").find('a[href="' + targetURL + '"]').each(function () {
                            $(this).attr("target", "_blank");
                        });
                        $(".alert").alert("close");
                        $("#InsertLink" + _idSuffix).modal("hide");
                        $(editorObj).data("editor").focus();
                        return false;
                    }
                },

                'insert_img': {
                    "modal": true,
                    "modalId": "InsertImage_" + $(this).attr("id"),
                    "icon": "fa fa-picture-o",
                    "tooltip": "Insert Image",
                    "modalHeader": "Insert Image",
                    "modalBody": methods.imageWidget.apply(this),
                    "beforeLoad": function () {
                        editorObj = this;
                        var _idSuffix = editorObj.attr("id");
                        $('#imageURL_' + _idSuffix).val("");
                        $("#uploadImageBar_" + _idSuffix + " :input").val("");
                        $('#imageList_' + _idSuffix).data('current', "");
                    },
                    "onSave": function () {
                        var _idSuffix = "_" + editorObj.attr("id");
                        methods.restoreSelection.apply(this);
                        if ($('#imageList' + _idSuffix).data('current')) {
                            if (navigator.userAgent.match(/MSIE/i) || navigator.userAgent.match(/Windows NT.*Trident\//)) {
                                var imageStr = '<img src="' + $('#imageList' + _idSuffix).data('current') + '"/>'
                                methods.restoreSelection.apply(this, [imageStr, 'html'])
                            }
                            else {
                                document.execCommand('insertimage', false, $('#imageList' + _idSuffix).data('current'));
                            }
                        }
                        else {
                            methods.showMessage.apply(this, ["imgErrMsg" + _idSuffix, "Please select an image"]);
                            return false;
                        }
                        $("#InsertImage" + _idSuffix).modal("hide");
                        $(this).data("editor").focus();
                    }
                },

                'insert_table': {
                    "modal": true,
                    "modalId": "InsertTable_" + $(this).attr("id"),
                    "icon": "fa fa-table",
                    "tooltip": "Insert Table",
                    "modalHeader": "Insert Table",
                    "modalBody": methods.tableWidget.apply(this),
                    "beforeLoad": function () {
                        editorObj = this;
                        $('#tblForm_' + editorObj.attr("id")).each(function () {
                            this.reset();
                        });
                    },
                    "onSave": function () {
                        _idSuffix = "_" + editorObj.attr("id");
                        methods.restoreSelection.apply(this);
                        var tblRows = $('#tblRows' + _idSuffix).val();
                        var tblColumns = $('#tblColumns' + _idSuffix).val();
                        var tblWidth = $('#tblWidth' + _idSuffix).val();
                        var tblHeight = $('#tblHeight' + _idSuffix).val();
                        var tblAlign = $('#tblAlign' + _idSuffix).val();
                        var tblBorder = $('#tblBorder' + _idSuffix).val();
                        var tblCellspacing = $('#tblCellspacing' + _idSuffix).val();
                        var tblCellpadding = $('#tblCellpadding' + _idSuffix).val();
                        var intReg = /^[0-9]+$/;
                        var cssReg = /^auto$|^[+-]?[0-9]+\.?([0-9]+)?(px|em|ex|%|in|cm|mm|pt|pc)?$/ig;
                        var numReg = /^[0-9]+\.?([0-9])?$/;

                        if (!tblRows.match(intReg)) {
                            methods.showMessage.apply(this, ["tblErrMsg", "Rows must be a positive number"]);
                            return false;
                        }
                        if (!tblColumns.match(intReg)) {
                            methods.showMessage.apply(this, ["tblErrMsg", "Columns must be a positive number"]);
                            return false;
                        }
                        if (tblWidth != "" && !tblWidth.match(cssReg)) {
                            methods.showMessage.apply(this, ["tblErrMsg", "Please enter positive number with or without a valid CSS measurement unit (px,em,ex,%,in,cm,mm,pt,pc)"]);
                            return false;
                        }
                        if (tblHeight != "" && !tblHeight.match(cssReg)) {
                            methods.showMessage.apply(this, ["tblErrMsg", "Please enter positive number with or without a valid CSS measurement unit (px,em,ex,%,in,cm,mm,pt,pc)"]);
                            return false;
                        }
                        if (tblBorder != "" && !tblBorder.match(numReg)) {
                            methods.showMessage.apply(this, ["tblErrMsg", "Border size must be a positive number"]);
                            return false;
                        }
                        if (tblCellspacing != "" && !tblCellspacing.match(numReg)) {
                            methods.showMessage.apply(this, ["tblErrMsg", "Cell spacing must be a positive number"]);
                            return false;
                        }
                        if (tblCellpadding != "" && !tblCellpadding.match(numReg)) {
                            methods.showMessage.apply(this, ["tblErrMsg", "Cell padding must be a positive number"]);
                            return false;
                        }

                        var htmlTableCntr = $('<div/>');
                        var tblAttributes = [
                            {attribute: "align", value: tblAlign},
                            {attribute: "border", value: tblBorder},
                            {attribute: "cellspacing", value: tblCellspacing},
                            {attribute: "cellpadding", value: tblCellpadding},
                            {attribute: "width", value: tblWidth},
                            {attribute: "height", value: tblHeight},
                        ];
                        var htmlTable = methods.getHTMLTable.apply(this, [tblRows, tblColumns, tblAttributes]);
                        htmlTable.appendTo(htmlTableCntr);
                        if (navigator.userAgent.match(/MSIE/i) || navigator.userAgent.match(/Windows NT.*Trident\//))
                            methods.restoreSelection.apply(this, [htmlTableCntr.html(), 'html']);
                        else
                            document.execCommand('insertHTML', false, htmlTableCntr.html());
                        $("#InsertTable" + _idSuffix).modal("hide");
                        $(this).data("editor").focus();
                    }
                },

                'hr_line': {
                    "text": "HR",
                    "icon": "fa fa-minus",
                    "tooltip": "Horizontal Rule",
                    "commandname": "insertHorizontalRule",
                    "custom": null
                },

                'block_quote': {
                    "text": "Block Quote",
                    "icon": "fa fa-quote-right",
                    "tooltip": "Block Quote",
                    "commandname": null,
                    "custom": function () {
                        methods.setStyleWithCSS.apply(this);
                        if (navigator.userAgent.match(/MSIE/i) || navigator.userAgent.match(/Windows NT.*Trident\//)) {
                            document.execCommand('indent', false, null);
                        }
                        else {
                            document.execCommand('formatBlock', false, '<blockquote>');
                        }
                    }
                },

                'indent': {
                    "text": "Indent",
                    "icon": "fa fa-indent",
                    "tooltip": "Increase Indent",
                    "commandname": "indent",
                    "custom": null
                },

                'outdent': {
                    "text": "Outdent",
                    "icon": "fa fa-outdent",
                    "tooltip": "Decrease Indent",
                    "commandname": "outdent",
                    "custom": null
                },

                'print': {
                    "text": "Print",
                    "icon": "fa fa-print",
                    "tooltip": "Print",
                    "commandname": null,
                    "custom": function () {
                        oDoc = $(this).data("editor");
                        var oPrntWin = window.open("", "_blank", "width=450,height=470,left=400,top=100,menubar=yes,toolbar=no,location=no,scrollbars=yes");
                        oPrntWin.document.open();
                        oPrntWin.document.write("<!doctype html><html><head><title>Print</title></head><body onload=\"print();\">" + oDoc.html() + "</body></html>");
                        oPrntWin.document.close();
                    }
                },

                'rm_format': {
                    "text": "Remove format",
                    "icon": "fa fa-eraser",
                    "tooltip": "Remove Formatting",
                    "commandname": "removeformat",
                    "custom": null
                },

                'select_all': {
                    "text": "Select all",
                    "icon": "fa fa-file-text",
                    "tooltip": "Select All",
                    "commandname": null,
                    "custom": function () {
                        document.execCommand("selectall", null, null);
                    }
                },

                'togglescreen': {
                    "text": "Toggle Screen",
                    "icon": "fa fa-arrows-alt",
                    "tooltip": "Toggle Screen",
                    "commandname": null,
                    "custom": function (button, parameters) {
                        $(this).data("editor").parent().toggleClass('fullscreen');
                        var statusdBarHeight = 0;
                        if ($(this).data("statusBar").length) {
                            statusdBarHeight = $(this).data("statusBar").height();
                        }
                        if ($(this).data("editor").parent().hasClass('fullscreen'))
                            $(this).data("editor").css({"height": $(this).data("editor").parent().height() - ($(this).data("menuBar").height() + statusdBarHeight) - 13});
                        else
                            $(this).data("editor").css({"height": ""});
                    }
                },

                'splchars': {
                    "text": "S",
                    "icon": "fa fa-asterisk",
                    "tooltip": "Insert Special Character",
                    "commandname": null,
                    "custom": function (button) {
                        methods.restoreIESelection.apply(this);
                        var flag = 0;
                        var splCharDiv = $('<div/>', {
                            id: "specialchar",
                            class: "specialCntr",
                            css: {"display": "none"}
                        }).click(function (event) {
                            event.stopPropagation();
                        });
                        var splCharUi = $('<ul />', {id: "special_ui"});
                        var editor_Content = this;
                        if ($(this).data("editor").data("splcharsBtn")) {
                            flag = 1;
                            $(this).data("editor").data("splcharsBtn", null);
                        }
                        else
                            $(this).data("editor").data("splcharsBtn", 1);

                        if (flag == 0) {
                            for (var i = 0; i < specialchars.length; i++) {
                                splCharUi.append($('<li />').html(specialchars[i].text).attr('title', specialchars[i].name).mousedown(function (event) {
                                    event.preventDefault();
                                }).click(function (event) {
                                    if (navigator.userAgent.match(/MSIE/i) || navigator.userAgent.match(/Windows NT.*Trident\//)) {
                                        var specCharHtml = $(this).html();
                                        methods.insertTextAtSelection.apply(this, [specCharHtml, 'html']);
                                    }
                                    else {
                                        document.execCommand('insertHTML', false, $(this).html());
                                    }
                                    $('#specialchar').remove();
                                    $(editor_Content).data("editor").data("splcharsBtn", null);
                                }));
                            }
                            splCharUi.prependTo(splCharDiv);
                            splCharDiv.insertAfter(button)
                            $('#specialchar').slideDown('slow');
                        }
                        else
                            $('#specialchar').remove();
                    }
                },

                'source': {
                    "text": "Source",
                    "icon": "fa fa-code",
                    "tooltip": "Source",
                    "commandname": null,
                    "custom": function (button, params) {
                        methods.getSource.apply(this, [button, params])
                    }
                },
                "params": {"obj": null},
            };

            var menuGroups = {
                'texteffects': ['bold', 'italics', 'underline', 'color'],
                'aligneffects': ['l_align', 'c_align', 'r_align', 'justify'],
                'textformats': ['indent', 'outdent', 'block_quote', 'ol', 'ul'],
                'fonteffects': ['fonts', 'styles', 'font_size'],
                'actions': ['undo', 'redo'],
                'insertoptions': ['insert_link', 'unlink', 'insert_img', 'insert_table'],
                'extraeffects': ['strikeout', 'hr_line', 'splchars'],
                'advancedoptions': ['print', 'rm_format', 'select_all', 'source'],
                'screeneffects': ['togglescreen']
            };

            var settings = $.extend({
                'texteffects': true,
                'aligneffects': true,
                'textformats': true,
                'fonteffects': true,
                'actions': true,
                'insertoptions': true,
                'extraeffects': true,
                'advancedoptions': true,
                'screeneffects': true,
                'bold': true,
                'italics': true,
                'underline': true,
                'ol': true,
                'ul': true,
                'undo': true,
                'redo': true,
                'l_align': true,
                'r_align': true,
                'c_align': true,
                'justify': true,
                'insert_link': true,
                'unlink': true,
                'insert_img': true,
                'hr_line': true,
                'block_quote': true,
                'source': true,
                'strikeout': true,
                'indent': true,
                'outdent': true,
                'fonts': fonts,
                'styles': styles,
                'print': true,
                'rm_format': true,
                'status_bar': true,
                'font_size': fontsizes,
                'color': colors,
                'splchars': specialchars,
                'insert_table': true,
                'select_all': true,
                'togglescreen': true
            }, options);

            var containerDiv = $("<div/>", {class: "row-fluid Editor-container"});
            var $this = $(this).hide();
            $this.after(containerDiv);
            var menuBar = $("<div/>", {
                id: "menuBarDiv_" + $(this).attr("id"),
                class: "row-fluid line-control-menu-bar"
            }).prependTo(containerDiv);
            var editor = $("<div/>", {
                class: "Editor-editor",
                css: {overflow: "auto"},
                contenteditable: "true"
            }).appendTo(containerDiv);
            var statusBar = $("<div/>", {
                id: "statusbar_" + $(this).attr("id"),
                class: "row-fluid line-control-status-bar",
                unselectable: "on",
            }).appendTo(containerDiv);
            $(this).data("menuBar", menuBar);
            $(this).data("editor", editor);
            $(this).data("statusBar", statusBar);
            var editor_Content = this;
            if (settings['status_bar']) {
                editor.keyup(function (event) {
                    var wordCount = methods.getWordCount.apply(editor_Content);
                    var charCount = methods.getCharCount.apply(editor_Content);
                    $(editor_Content).data("statusBar").html('<div class="label">' + 'Words : ' + wordCount + '</div>');
                    $(editor_Content).data("statusBar").append('<div class="label">' + 'Characters : ' + charCount + '</div>');
                });
            }


            for (var item in menuItems) {
                if (!settings[item]) { //if the display is not set to true for the button in the settings.
                    if (settings[item] in menuGroups) {
                        for (var each in menuGroups[item]) {
                            settings[each] = false;
                        }
                    }
                    continue;
                }
                if (item in menuGroups) {
                    var group = $("<div/>", {class: "btn-group"});
                    for (var index = 0; index < menuGroups[item].length; index++) {
                        var value = menuGroups[item][index];
                        if (settings[value]) {
                            var menuItem = methods.createMenuItem.apply(this, [menuItems[value], settings[value], true]);
                            group.append(menuItem);
                        }
                        settings[value] = false;
                    }
                    menuBar.append(group);
                }
                else {
                    var menuItem = methods.createMenuItem.apply(this, [menuItems[item], settings[item], true]);
                    menuBar.append(menuItem);
                }
            }

            //For contextmenu
            $(document.body).mousedown(function (event) {
                var target = $(event.target);
                if (!target.parents().andSelf().is('#context-menu')) { // Clicked outside
                    $('#context-menu').remove();
                }
                if (!target.parents().andSelf().is('#specialchar') && (target.closest('a').html() != '<i class="fa fa-asterisk"></i>')) { //Clicked outside
                    if ($("#specialchar").is(':visible')) {
                        $(editor_Content).data("editor").data("splcharsBtn", null);
                        $('#specialchar').remove();
                    }
                }
                if (!target.parents().andSelf().is('#paletteCntr') && (target.closest('a').html() != '<i class="fa fa-font"></i>')) { //Clicked outside
                    if ($("#paletteCntr").is(':visible')) {
                        $(editor_Content).data("editor").data("colorBtn", null);
                        $('#paletteCntr').remove();
                    }
                }
            });
            editor.bind("contextmenu", function (e) {
                if ($('#context-menu').length)
                    $('#context-menu').remove();
                var cMenu = $('<div/>', {
                    id: "context-menu"
                }).css({
                    position: "absolute", top: e.pageY, left: e.pageX, "z-index": 9999
                }).click(function (event) {
                    event.stopPropagation();
                });
                var cMenuUl = $('<ul/>', {class: "dropdown-menu on", "role": "menu"});
                e.preventDefault();
                if ($(e.target).is('a')) {
                    methods.createLinkContext.apply(this, [e, cMenuUl]);
                    cMenuUl.appendTo(cMenu);
                    cMenu.appendTo('body');
                }
                else if ($(e.target).is('td') || $(e.target).is("th")) {
                    methods.createTableContext.apply(this, [e, cMenuUl]);
                    cMenuUl.appendTo(cMenu);
                    cMenu.appendTo('body');
                }
                else if ($(e.target).is('img')) {

                    methods.createImageContext.apply(this, [e, cMenuUl]);
                    cMenuUl.appendTo(cMenu);
                    cMenu.appendTo('body');
                }
            });
        },
        createLinkContext: function (event, cMenuUl) {
            var cMenuli = $('<li/>').append($('<a/>', {
                id: "rem_link",
                "href": "javascript:void(0)",
                "text": "RemoveLink"
            }).click(function (e) {
                return function () {
                    $(e.target).contents().unwrap();
                    $('#context-menu').remove();
                }
            }(event)));
            cMenuli.appendTo(cMenuUl);

        },

        createImageContext: function (event, cMenuUl) {
            var cModalId = "imgAttribute";
            var cModalHeader = "Image Attributes";
            var imgModalBody = methods.imageAttributeWidget.apply(this, ["edit"]);
            var onSave = function () {
                var urlPattern = /(http|ftp|https):\/\/[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#-]*[\w@?^=%&amp;\/~+#-])?/;
                var imageAlt = $('#imgAlt').val();
                var imageTarget = $('#imgTarget').val();
                if (imageAlt == "") {
                    methods.showMessage.apply(this, ["imageErrMsg", "Please enter image alternative text"]);
                    return false;
                }
                if (imageTarget != "" && !imageTarget.match(urlPattern)) {
                    methods.showMessage.apply(this, ["imageErrMsg", "Please enter valid url"]);
                    return false;
                }
                if ($("#imgHidden").val() != "") {
                    var imgId = $("#imgHidden").val();
                    $("#" + imgId).attr('alt', imageAlt);
                    if (imageTarget != "") {
                        if ($("#wrap_" + imgId).length)
                            $("#wrap_" + imgId).attr("href", imageTarget);
                        else
                            $("#" + imgId).wrap($('<a/>', {id: "wrap_" + imgId, href: imageTarget, target: "_blank"}));
                    }
                    else {
                        if ($("#wrap_" + imgId).length)
                            $("#" + imgId).unwrap();
                    }
                }
                $("#imgAttribute").modal("hide");
                editorObj.data("editor").focus();
            };
            methods.createModal.apply(this, [cModalId, cModalHeader, imgModalBody, onSave]);
            var modalTrigger = $('<a/>', {
                href: "#" + cModalId,
                "text": "Image Attributes",
                "data-toggle": "modal"
            }).click(function (e) {
                return function () {
                    $('#context-menu').remove();
                    var stamp = (new Date).getTime();
                    $('#imgAlt').val($(e.target).closest("img").attr("alt"));
                    $('#imgTarget').val('');

                    if (typeof $(e.target).closest("img").attr("id") !== "undefined") {
                        var identifier = $(e.target).closest("img").attr("id");
                        $('#imgHidden').val(identifier);
                        if ($('#wrap_' + identifier).length)
                            $('#imgTarget').val($('#wrap_' + identifier).attr("href"));
                        else
                            $('#imgTarget').val('');
                    }
                    else {
                        $(e.target).closest("img").attr("id", "img_" + stamp)
                        $('#imgHidden').val("img_" + stamp);
                    }

                }
            }(event));
            cMenuUl.append($('<li/>').append(modalTrigger))
                .append($('<li/>').append($('<a/>', {text: "Remove Image"}).click(
                    function (e) {
                        return function () {
                            $('#context-menu').remove();
                            $(e.target).closest("img").remove();
                        }
                    }(event))));
        },

        createTableContext: function (event, cMenuUl) {
            var _idSuffix = "_" + editorObj.attr("id") + "_Edt";
            var modalId = "editProperties_" + editorObj.attr("id");
            $("#" + modalId).remove();
            var modalHeader = "Table Properties";
            var tblModalBody = methods.tableWidget.apply(this, ["edit"]);
            var onSave = function () {
                var tblWidthEdt = $('#tblWidth' + _idSuffix).val();
                var tblHeightEdt = $('#tblHeight' + _idSuffix).val();
                var tblBorderEdt = $('#tblBorder' + _idSuffix).val();
                var tblAlignEdt = $('#tblAlign' + _idSuffix).val();
                var tblCellspacingEdt = $('#tblCellspacing' + _idSuffix).val();
                var tblCellpaddingEdt = $('#tblCellpadding' + _idSuffix).val();
                var tblEdtCssReg = /^auto$|^[+-]?[0-9]+\.?([0-9]+)?(px|em|ex|%|in|cm|mm|pt|pc)?$/ig;
                var tblEdtNumReg = /^[0-9]+\.?([0-9])?$/;
                if (tblWidthEdt != "" && !tblWidthEdt.match(tblEdtCssReg)) {
                    methods.showMessage.apply(this, ["tblErrMsgEdt", "Please enter positive number with or without a valid CSS measurement unit (px,em,ex,%,in,cm,mm,pt,pc)"]);
                    return false;
                }
                if (tblHeightEdt != "" && !tblHeightEdt.match(tblEdtCssReg)) {
                    methods.showMessage.apply(this, ["tblErrMsgEdt", "Please enter positive number with or without a valid CSS measurement unit (px,em,ex,%,in,cm,mm,pt,pc)"]);
                    return false;
                }
                if (tblBorderEdt != "" && !tblBorderEdt.match(tblEdtNumReg)) {
                    methods.showMessage.apply(this, ["tblErrMsgEdt", "Border size must be a positive number"]);
                    return false;
                }
                if (tblCellspacingEdt != "" && !tblCellspacingEdt.match(tblEdtNumReg)) {
                    methods.showMessage.apply(this, ["tblErrMsgEdt", "Cell spacing must be a positive number"]);
                    return false;
                }
                if (tblCellpaddingEdt != "" && !tblCellpaddingEdt.match(tblEdtNumReg)) {
                    methods.showMessage.apply(this, ["tblErrMsgEdt", "Cell padding must be a positive number"]);
                    return false;
                }
                $(event.target).closest('table').css('width', tblWidthEdt);
                if (tblHeightEdt != "")
                    $(event.target).closest('table').css('height', tblHeightEdt);
                $(event.target).closest('table').attr('align', tblAlignEdt);
                $(event.target).closest('table').attr('border', tblBorderEdt);
                $(event.target).closest('table').attr('cellspacing', tblCellspacingEdt);
                $(event.target).closest('table').attr('cellpadding', tblCellpaddingEdt);
                $("#" + modalId).modal("hide");
                editorObj.data("editor").focus();
            };
            methods.createModal.apply(this, [modalId, modalHeader, tblModalBody, onSave]);
            var modalTrigger = $('<a/>', {
                href: "#" + modalId,
                "text": "Table Properties",
                "data-toggle": "modal"
            }).click(function (e) {
                return function () {
                    var _idSuffix = "_" + editorObj.attr("id") + "_Edt";
                    $('#context-menu').remove();
                    $('#tblRows' + _idSuffix).val($(e.target).closest('table').prop('rows').length);
                    $('#tblColumns' + _idSuffix).val($(e.target).closest('table').find('tr')[0].cells.length);
                    $('#tblRows' + _idSuffix).attr('disabled', 'disabled');
                    $('#tblColumns' + _idSuffix).attr('disabled', 'disabled');
                    $('#tblWidth' + _idSuffix).val($(e.target).closest('table').get(0).style.width);
                    $('#tblHeight' + _idSuffix).val($(e.target).closest('table').get(0).style.height);
                    $('#tblAlign' + _idSuffix).val($(e.target).closest('table').attr("align"));
                    $('#tblBorder' + _idSuffix).val($(e.target).closest('table').attr("border"));
                    $('#tblCellspacing' + _idSuffix).val($(e.target).closest('table').attr("cellspacing"));
                    $('#tblCellpadding' + _idSuffix).val($(e.target).closest('table').attr("cellpadding"));


                }
            }(event));

            cMenuUl.append($('<li/>', {class: "dropdown-submenu", css: {display: "block"}})
                .append($('<a/>', {"tabindex": "-1", href: "javascript:void(0)", "text": "Row"}))
                .append($('<ul/>', {class: "dropdown-menu"})
                    .append($('<li/>').append($('<a/>', {
                        id: "tbl_addrow",
                        "href": "javascript:void(0)",
                        "text": "Add Row"
                    }).click(function (e) {
                        return function () {
                            $("#context-menu").remove();
                            var selectedRow = $(e.target).closest("tr");
                            var newRow = $("<tr/>");
                            selectedRow.children().each(function () {
                                var newColumn = $("<" + $(this).prop("nodeName") + "/>").html("&nbsp;");
                                newRow.append(newColumn);
                            });
                            selectedRow.after(newRow);
                        }
                    }(event))))
                    .append($('<li/>').append($('<a/>', {text: "Remove Row"}).click(
                        function (e) {
                            return function () {
                                $('#context-menu').remove();
                                $(e.target).closest("tr").remove();
                            }
                        }(event))))
                )).append($('<li/>', {class: "dropdown-submenu", css: {display: "block"}})
                .append($('<a/>', {"tabindex": "-1", href: "javascript:void(0)", "text": "Column"}))
                .append($('<ul/>', {class: "dropdown-menu"})
                    .append($('<li/>').append($('<a/>', {
                        id: "tbl_addcolumn",
                        "href": "javascript:void(0)",
                        "text": "Add Column",
                    }).click(function (e) {
                        return function () {
                            $('#context-menu').remove();
                            var selectedCell = $(e.target);
                            var columnIndex = selectedCell.siblings().addBack().index(selectedCell);
                            selectedCell.closest("table").find("tr").each(function () {
                                var cellInSelectedColumn = $(this).children(":eq(" + columnIndex + ")");
                                var newCell = $("<" + cellInSelectedColumn.prop("nodeName") + "/>").html("&nbsp;");
                                cellInSelectedColumn.after(newCell);
                            });
                        }
                    }(event))))
                    .append($('<li/>').append($('<a/>', {text: "Remove Column"}).click(
                        function (e) {
                            return function () {
                                $('#context-menu').remove();
                                var selectedCell = $(e.target);
                                var columnIndex = selectedCell.siblings().addBack().index(selectedCell);
                                selectedCell.closest("table").find("tr").each(function () {
                                    $(this).children(":eq(" + columnIndex + ")").remove();
                                });
                            }
                        }(event))))
                ));
            cMenuUl.append($('<li/>').append(modalTrigger))
                .append($('<li/>', {class: "divider"}))
                .append($('<li/>').append($('<a/>', {text: "Remove Table"}).click(
                    function (e) {
                        return function () {
                            $('#context-menu').remove();
                            $(e.target).closest("table").remove();
                        }
                    }(event))));

        },

        createModal: function (modalId, modalHeader, modalBody, onSave) {
            //Create a Modal for the button.
            var modalTrigger = $('<a/>', {
                href: "#" + modalId,
                role: "button",
                class: "btn btn-default",
                "data-toggle": "modal"
            });
            var modalElement = $('<div/>', {
                id: modalId,
                class: "modal fade",
                tabindex: "-1",
                role: "dialog",
                "aria-labelledby": "h3_" + modalId,
                "aria-hidden": "true"
            }).append($('<div>', {
                    class: "modal-dialog"
                }).append($('<div>', {
                    class: "modal-content"
                }).append($('<div>', {
                    class: "modal-header"
                }).append($('<button/>', {
                    type: "button",
                    class: "close",
                    "data-dismiss": "modal",
                    "aria-hidden": "true"
                }).html('x')
                ).append($('<h3/>', {
                    id: "h3_" + modalId
                }).html(modalHeader))
                ).append($('<div>', {
                    class: "modal-body"
                }).append(modalBody)
                ).append($('<div>', {
                    class: "modal-footer"
                }).append($('<button/>', {
                    type: "button",
                    class: "btn btn-default",
                    "data-dismiss": "modal",
                    "aria-hidden": "true"
                }).html('Cancel')
                ).append($('<button/>', {
                    type: "button",
                    class: "btn btn-success",
                }).html('Done').mousedown(function (e) {
                    e.preventDefault();
                }).click(function (obj) {
                    return function () {
                        onSave.apply(obj)
                    }
                }(this)))
                )
                )
            );
            modalElement.appendTo("body");
            return modalTrigger;
        },

        createMenuItem: function (itemSettings, options, returnElement) {
            //Function to perform multiple actions.supplied arguments: itemsettings-list of buttons and button options, options: options for select input, returnelement: boolean.
            //1.Create Select Options using Bootstrap Dropdown.
            //2.Create modal dialog using bootstrap options
            //3.Create menubar buttons binded with corresponding event actions
            typeof returnElement !== 'undefined' ? returnElement : false;

            if (itemSettings["select"]) {
                var menuWrapElement = $("<div/>", {class: "btn-group"});
                var menuElement = $("<ul/>", {class: "dropdown-menu"});
                menuWrapElement.append($('<a/>', {
                    class: "btn btn-default dropdown-toggle",
                    "data-toggle": "dropdown",
                    "href": "javascript:void(0)",
                    "title": itemSettings["tooltip"]
                }).html(itemSettings["default"]).append($("<span/>", {class: "caret"})).mousedown(function (e) {
                    e.preventDefault();
                }));
                $.each(options, function (i, v) {
                    var option = $('<li/>')
                    $("<a/>", {
                        tabindex: "-1",
                        href: "javascript:void(0)"
                    }).html(i).appendTo(option);

                    option.click(function () {
                        $(this).parent().parent().data("value", v);
                        $(this).parent().parent().trigger("change")
                    });
                    menuElement.append(option);
                });
                var action = "change";
            }
            else if (itemSettings["modal"]) {
                var menuWrapElement = methods.createModal.apply(this, [itemSettings["modalId"], itemSettings["modalHeader"], itemSettings["modalBody"], itemSettings["onSave"]]);
                var menuElement = $("<i/>");
                if (itemSettings["icon"])
                    menuElement.addClass(itemSettings["icon"]);
                else
                    menuElement.html(itemSettings["text"]);
                menuWrapElement.append(menuElement);
                menuWrapElement.mousedown(function (obj, methods, beforeLoad) {
                    return function (e) {
                        e.preventDefault();
                        methods.saveSelection.apply(obj);
                        if (beforeLoad) {
                            beforeLoad.apply(obj);
                        }
                    }
                }(this, methods, itemSettings["beforeLoad"]));
                menuWrapElement.attr('title', itemSettings['tooltip']);
                return menuWrapElement;
            }
            else {
                var menuWrapElement = $("<a/>", {href: 'javascript:void(0)', class: 'btn btn-default'});
                var menuElement = $("<i/>");
                if (itemSettings["icon"])
                    menuElement.addClass(itemSettings["icon"]);
                else
                    menuElement.html(itemSettings["text"]);
                var action = "click";
            }
            if (itemSettings["custom"]) {
                menuWrapElement.bind(action, (function (obj, params) {
                    return function () {
                        methods.saveSelection.apply(obj);
                        itemSettings["custom"].apply(obj, [$(this), params]);
                    }
                })(this, itemSettings['params']));
            }
            else {
                menuWrapElement.data("commandName", itemSettings["commandname"]);
                menuWrapElement.data("editor", $(this).data("editor"));
                menuWrapElement.bind(action, function () {
                    methods.setTextFormat.apply(this)
                });
            }
            menuWrapElement.attr('title', itemSettings['tooltip']);
            menuWrapElement.css('cursor', 'pointer');
            menuWrapElement.append(menuElement);
            if (returnElement)
                return menuWrapElement;
            $(this).data("menuBar").append(menuWrapElement);
        },

        setTextFormat: function () {
            //Function to run the text formatting options using execCommand.
            methods.setStyleWithCSS.apply(this);
            document.execCommand($(this).data("commandName"), false, $(this).data("value") || null);
            $(this).data("editor").focus();
            return false;
        },

        getSource: function (button, params) {
            //Function to show the html source code to the editor and toggle the text display.
            var flag = 0;
            if (button.data('state')) {
                flag = 1;
                button.data('state', null);
            }
            else
                button.data('state', 1);
            $(this).data("source-mode", !flag);
            var editor = $(this).data('editor');
            var content;
            if (flag == 0) { //Convert text to HTML
                content = document.createTextNode(editor.html());
                editor.empty();
                editor.attr('contenteditable', false);
                preElement = $("<pre/>", {
                    contenteditable: true
                });
                preElement.append(content);
                editor.append(preElement);
                button.parent().siblings().hide();
                button.siblings().hide();
            }
            else {
                var html = editor.children().first().text();
                editor.html(html);
                editor.attr('contenteditable', true);
                button.parent().siblings().show();
                button.siblings().show();
            }
        },

        countWords: function (node) {
            //Function to count the number of words recursively as the text grows in the editor.
            var count = 0;
            var textNodes = node.contents().filter(function () {
                return (this.nodeType == 3);
            });
            for (var index = 0; index < textNodes.length; index++) {
                text = textNodes[index].textContent;
                text = text.replace(/[^-\w\s]/gi, ' ');
                text = $.trim(text);
                count = count + text.split(/\s+/).length;
            }
            var childNodes = node.children().each(function () {
                count = count + methods.countWords.apply(this, [$(this)]);
            });
            return count
        },

        countChars: function (node) {
            //Function to count the number of characters recursively as the text grows in the editor.
            var count = 0;
            var textNodes = node.contents().filter(function () {
                return (this.nodeType == 3);
            });
            for (var index = 0; index < textNodes.length; index++) {
                text = textNodes[index].textContent;
                count = count + text.length;
            }
            var childNodes = node.children().each(function () {
                count = count + methods.countChars.apply(this, [$(this)]);
            });
            return count;
        },

        getWordCount: function () {
            //Function to return the word count of the text in the editor
            return methods.countWords.apply(this, [$(this).data("editor")]);
        },

        getCharCount: function () {
            //Function to return the character count of the text in the editor
            return methods.countChars.apply(this, [$(this).data("editor")]);
        },

        rgbToHex: function (rgb) {
            //Function to convert the rgb color codes into hexadecimal code
            rgb = rgb.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);
            return "#" +
                ("0" + parseInt(rgb[1], 10).toString(16)).slice(-2) +
                ("0" + parseInt(rgb[2], 10).toString(16)).slice(-2) +
                ("0" + parseInt(rgb[3], 10).toString(16)).slice(-2);
        },

        showMessage: function (target, message) {
            //Function to show the error message. Supplied arguments:target-div id, message-message text to be displayed.
            var errorDiv = $('<div/>', {class: "alert alert-danger"}
            ).append($('<button/>', {
                type: "button",
                class: "close",
                "data-dismiss": "alert",
                html: "x"
            })).append($('<span/>').html(message));
            errorDiv.appendTo($('#' + target));
            setTimeout(function () {
                $('.alert').alert('close');
            }, 3000);
        },

        getText: function () {
            //Function to get the source code.
            if (!$(this).data("source-mode"))
                return $(this).data("editor").html();
            else
                return $(this).data("editor").children().first().text();
        },

        setText: function (text) {
            //Function to set the source code
            if (!$(this).data("source-mode"))
                $(this).data("editor").html(text);
            else
                $(this).data("editor").children().first().text(text);
        },

        setStyleWithCSS: function () {
            if (navigator.userAgent.match(/MSIE/i)) {	//for IE10
                try {
                    Editor.execCommand("styleWithCSS", 0, false);
                } catch (e) {
                    try {
                        Editor.execCommand("useCSS", 0, true);
                    } catch (e) {
                        try {
                            Editor.execCommand('styleWithCSS', false, false);
                        }
                        catch (e) {
                        }
                    }
                }
            }
            else {
                document.execCommand("styleWithCSS", null, true);
            }
        },

    }

    $.fn.Editor = function (method) {

        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.Editor');
        }
    };
})(jQuery);

/*!
 * Lightbox v2.11.1
 * by Lokesh Dhakar
 *
 * More info:
 * http://lokeshdhakar.com/projects/lightbox2/
 *
 * Copyright Lokesh Dhakar
 * Released under the MIT license
 * https://github.com/lokesh/lightbox2/blob/master/LICENSE
 *
 * @preserve
 */
!function(a,b){"function"==typeof define&&define.amd?define(["jquery"],b):"object"==typeof exports?module.exports=b(require("jquery")):a.lightbox=b(a.jQuery)}(this,function(a){function b(b){this.album=[],this.currentImageIndex=void 0,this.init(),this.options=a.extend({},this.constructor.defaults),this.option(b)}return b.defaults={albumLabel:"Image %1 of %2",alwaysShowNavOnTouchDevices:!1,fadeDuration:600,fitImagesInViewport:!0,imageFadeDuration:600,positionFromTop:50,resizeDuration:700,showImageNumberLabel:!0,wrapAround:!1,disableScrolling:!1,sanitizeTitle:!1},b.prototype.option=function(b){a.extend(this.options,b)},b.prototype.imageCountLabel=function(a,b){return this.options.albumLabel.replace(/%1/g,a).replace(/%2/g,b)},b.prototype.init=function(){var b=this;a(document).ready(function(){b.enable(),b.build()})},b.prototype.enable=function(){var b=this;a("body").on("click","a[rel^=lightbox], area[rel^=lightbox], a[data-lightbox], area[data-lightbox]",function(c){return b.start(a(c.currentTarget)),!1})},b.prototype.build=function(){if(!(a("#lightbox").length>0)){var b=this;a('<div id="lightboxOverlay" tabindex="-1" class="lightboxOverlay"></div><div id="lightbox" tabindex="-1" class="lightbox"><div class="lb-outerContainer"><div class="lb-container"><img class="lb-image" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" alt=""/><div class="lb-nav"><a class="lb-prev" aria-label="Previous image" href="" ></a><a class="lb-next" aria-label="Next image" href="" ></a></div><div class="lb-loader"><a class="lb-cancel"></a></div></div></div><div class="lb-dataContainer"><div class="lb-data"><div class="lb-details"><span class="lb-caption"></span><span class="lb-number"></span></div><div class="lb-closeContainer"><a class="lb-close"></a></div></div></div></div>').appendTo(a("body")),this.$lightbox=a("#lightbox"),this.$overlay=a("#lightboxOverlay"),this.$outerContainer=this.$lightbox.find(".lb-outerContainer"),this.$container=this.$lightbox.find(".lb-container"),this.$image=this.$lightbox.find(".lb-image"),this.$nav=this.$lightbox.find(".lb-nav"),this.containerPadding={top:parseInt(this.$container.css("padding-top"),10),right:parseInt(this.$container.css("padding-right"),10),bottom:parseInt(this.$container.css("padding-bottom"),10),left:parseInt(this.$container.css("padding-left"),10)},this.imageBorderWidth={top:parseInt(this.$image.css("border-top-width"),10),right:parseInt(this.$image.css("border-right-width"),10),bottom:parseInt(this.$image.css("border-bottom-width"),10),left:parseInt(this.$image.css("border-left-width"),10)},this.$overlay.hide().on("click",function(){return b.end(),!1}),this.$lightbox.hide().on("click",function(c){"lightbox"===a(c.target).attr("id")&&b.end()}),this.$outerContainer.on("click",function(c){return"lightbox"===a(c.target).attr("id")&&b.end(),!1}),this.$lightbox.find(".lb-prev").on("click",function(){return 0===b.currentImageIndex?b.changeImage(b.album.length-1):b.changeImage(b.currentImageIndex-1),!1}),this.$lightbox.find(".lb-next").on("click",function(){return b.currentImageIndex===b.album.length-1?b.changeImage(0):b.changeImage(b.currentImageIndex+1),!1}),this.$nav.on("mousedown",function(a){3===a.which&&(b.$nav.css("pointer-events","none"),b.$lightbox.one("contextmenu",function(){setTimeout(function(){this.$nav.css("pointer-events","auto")}.bind(b),0)}))}),this.$lightbox.find(".lb-loader, .lb-close").on("click",function(){return b.end(),!1})}},b.prototype.start=function(b){function c(a){d.album.push({alt:a.attr("data-alt"),link:a.attr("href"),title:a.attr("data-title")||a.attr("title")})}var d=this,e=a(window);e.on("resize",a.proxy(this.sizeOverlay,this)),this.sizeOverlay(),this.album=[];var f,g=0,h=b.attr("data-lightbox");if(h){f=a(b.prop("tagName")+'[data-lightbox="'+h+'"]');for(var i=0;i<f.length;i=++i)c(a(f[i])),f[i]===b[0]&&(g=i)}else if("lightbox"===b.attr("rel"))c(b);else{f=a(b.prop("tagName")+'[rel="'+b.attr("rel")+'"]');for(var j=0;j<f.length;j=++j)c(a(f[j])),f[j]===b[0]&&(g=j)}var k=e.scrollTop()+this.options.positionFromTop,l=e.scrollLeft();this.$lightbox.css({top:k+"px",left:l+"px"}).fadeIn(this.options.fadeDuration),this.options.disableScrolling&&a("body").addClass("lb-disable-scrolling"),this.changeImage(g)},b.prototype.changeImage=function(b){var c=this,d=this.album[b].link,e=d.split(".").slice(-1)[0],f=this.$lightbox.find(".lb-image");this.disableKeyboardNav(),this.$overlay.fadeIn(this.options.fadeDuration),a(".lb-loader").fadeIn("slow"),this.$lightbox.find(".lb-image, .lb-nav, .lb-prev, .lb-next, .lb-dataContainer, .lb-numbers, .lb-caption").hide(),this.$outerContainer.addClass("animating");var g=new Image;g.onload=function(){var h,i,j,k,l,m;f.attr({alt:c.album[b].alt,src:d}),a(g),f.width(g.width),f.height(g.height),m=a(window).width(),l=a(window).height(),k=m-c.containerPadding.left-c.containerPadding.right-c.imageBorderWidth.left-c.imageBorderWidth.right-20,j=l-c.containerPadding.top-c.containerPadding.bottom-c.imageBorderWidth.top-c.imageBorderWidth.bottom-c.options.positionFromTop-70,"svg"===e&&(0!==g.width&&0!==g.height||(f.width(k),f.height(j))),c.options.fitImagesInViewport?(c.options.maxWidth&&c.options.maxWidth<k&&(k=c.options.maxWidth),c.options.maxHeight&&c.options.maxHeight<j&&(j=c.options.maxHeight)):(k=c.options.maxWidth||g.width||k,j=c.options.maxHeight||g.height||j),(g.width>k||g.height>j)&&(g.width/k>g.height/j?(i=k,h=parseInt(g.height/(g.width/i),10),f.width(i),f.height(h)):(h=j,i=parseInt(g.width/(g.height/h),10),f.width(i),f.height(h))),c.sizeContainer(f.width(),f.height())},g.src=this.album[b].link,this.currentImageIndex=b},b.prototype.sizeOverlay=function(){var b=this;setTimeout(function(){b.$overlay.width(a(document).width()).height(a(document).height())},0)},b.prototype.sizeContainer=function(a,b){function c(){d.$lightbox.find(".lb-dataContainer").width(g),d.$lightbox.find(".lb-prevLink").height(h),d.$lightbox.find(".lb-nextLink").height(h),d.$overlay.focus(),d.showImage()}var d=this,e=this.$outerContainer.outerWidth(),f=this.$outerContainer.outerHeight(),g=a+this.containerPadding.left+this.containerPadding.right+this.imageBorderWidth.left+this.imageBorderWidth.right,h=b+this.containerPadding.top+this.containerPadding.bottom+this.imageBorderWidth.top+this.imageBorderWidth.bottom;e!==g||f!==h?this.$outerContainer.animate({width:g,height:h},this.options.resizeDuration,"swing",function(){c()}):c()},b.prototype.showImage=function(){this.$lightbox.find(".lb-loader").stop(!0).hide(),this.$lightbox.find(".lb-image").fadeIn(this.options.imageFadeDuration),this.updateNav(),this.updateDetails(),this.preloadNeighboringImages(),this.enableKeyboardNav()},b.prototype.updateNav=function(){var a=!1;try{document.createEvent("TouchEvent"),a=!!this.options.alwaysShowNavOnTouchDevices}catch(a){}this.$lightbox.find(".lb-nav").show(),this.album.length>1&&(this.options.wrapAround?(a&&this.$lightbox.find(".lb-prev, .lb-next").css("opacity","1"),this.$lightbox.find(".lb-prev, .lb-next").show()):(this.currentImageIndex>0&&(this.$lightbox.find(".lb-prev").show(),a&&this.$lightbox.find(".lb-prev").css("opacity","1")),this.currentImageIndex<this.album.length-1&&(this.$lightbox.find(".lb-next").show(),a&&this.$lightbox.find(".lb-next").css("opacity","1"))))},b.prototype.updateDetails=function(){var a=this;if(void 0!==this.album[this.currentImageIndex].title&&""!==this.album[this.currentImageIndex].title){var b=this.$lightbox.find(".lb-caption");this.options.sanitizeTitle?b.text(this.album[this.currentImageIndex].title):b.html(this.album[this.currentImageIndex].title),b.fadeIn("fast")}if(this.album.length>1&&this.options.showImageNumberLabel){var c=this.imageCountLabel(this.currentImageIndex+1,this.album.length);this.$lightbox.find(".lb-number").text(c).fadeIn("fast")}else this.$lightbox.find(".lb-number").hide();this.$outerContainer.removeClass("animating"),this.$lightbox.find(".lb-dataContainer").fadeIn(this.options.resizeDuration,function(){return a.sizeOverlay()})},b.prototype.preloadNeighboringImages=function(){if(this.album.length>this.currentImageIndex+1){(new Image).src=this.album[this.currentImageIndex+1].link}if(this.currentImageIndex>0){(new Image).src=this.album[this.currentImageIndex-1].link}},b.prototype.enableKeyboardNav=function(){this.$lightbox.on("keyup.keyboard",a.proxy(this.keyboardAction,this)),this.$overlay.on("keyup.keyboard",a.proxy(this.keyboardAction,this))},b.prototype.disableKeyboardNav=function(){this.$lightbox.off(".keyboard"),this.$overlay.off(".keyboard")},b.prototype.keyboardAction=function(a){var b=a.keyCode;27===b?(a.stopPropagation(),this.end()):37===b?0!==this.currentImageIndex?this.changeImage(this.currentImageIndex-1):this.options.wrapAround&&this.album.length>1&&this.changeImage(this.album.length-1):39===b&&(this.currentImageIndex!==this.album.length-1?this.changeImage(this.currentImageIndex+1):this.options.wrapAround&&this.album.length>1&&this.changeImage(0))},b.prototype.end=function(){this.disableKeyboardNav(),a(window).off("resize",this.sizeOverlay),this.$lightbox.fadeOut(this.options.fadeDuration),this.$overlay.fadeOut(this.options.fadeDuration),this.options.disableScrolling&&a("body").removeClass("lb-disable-scrolling")},new b});
//# sourceMappingURL=lightbox.min.map
/** HTML5 LightBox - jQuery Image and Video LightBox Plugin
 * Copyright 2014 Magic Hills Pty Ltd All Rights Reserved
 * Website: http://html5box.com
 * Version 8.0
 */
(function () {
    var scripts = document.getElementsByTagName("script");
    var jsFolder = "";
    for (var i = 0; i < scripts.length; i++) if (scripts[i].src && scripts[i].src.match(/html5lightbox\.js/i)) jsFolder = scripts[i].src.substr(0, scripts[i].src.lastIndexOf("/") + 1);
    var loadjQuery = false;
    if (typeof jQuery == "undefined") loadjQuery = true; else {
        var jVersion = jQuery.fn.jquery.split(".");
        if (jVersion[0] < 1 || jVersion[0] == 1 && jVersion[1] < 6) loadjQuery = true
    }
    if (loadjQuery) {
        var head = document.getElementsByTagName("head")[0];
        var script = document.createElement("script");
        script.setAttribute("type", "text/javascript");
        if (script.readyState) script.onreadystatechange = function () {
            if (script.readyState == "loaded" || script.readyState == "complete") {
                script.onreadystatechange = null;
                loadHtml5LightBox(jsFolder)
            }
        }; else script.onload = function () {
            loadHtml5LightBox(jsFolder)
        };
        script.setAttribute("src", jsFolder + "jquery.js");
        head.appendChild(script)
    } else loadHtml5LightBox(jsFolder)
})();

function loadHtml5LightBox(jsFolder) {
    (function ($) {
        $.fn.html5lightbox = function (options) {
            var inst = this;
            inst.options = $.extend({
                freelink: "http://html5box.com/",
                defaultvideovolume: 1,
                mutevideo: false,
                autoclose: false,
                autoclosedelay: 0,
                resizedelay: 100,
                insideiframe: false,
                autoresizecontent: true,
                defaultwidth: 960,
                defaultheight: 540,
                usedefaultsizeforcontent: false,
                preload: true,
                preloadallonpageload: false,
                preloadalldelay: 5E3,
                autoplay: true,
                loopvideo: false,
                html5player: true,
                responsive: true,
                nativehtml5controls: false,
                videohidecontrols: false,
                nativecontrolsonfirefox: false,
                nativecontrolsonie: false,
                nativecontrolsoniphone: true,
                nativecontrolsonipad: true,
                nativecontrolsonandroid: true,
                nativecontrolsonfullscreen: true,
                nativecontrolsnodownload: true,
                noresizecallback: true,
                imagekeepratio: true,
                maxheight: false,
                elemautoheight: false,
                useflashonie9: true,
                useflashonie10: true,
                useflashonie11: false,
                useflashformp4onfirefox: false,
                transition: "none",
                transitionduration: 400,
                exitanimation: "",
                animationduration: "1s",
                enablepdfjs: true,
                pdfjsengine: "",
                openpdfinnewtaboniphone: false,
                openpdfinnewtabonipad: false,
                googleanalyticsaccount: "",
                arrowloop: true,
                showall: false,
                userelforgroup: true,
                shownavigation: true,
                thumbwidth: 96,
                thumbheight: 72,
                thumbgap: 4,
                thumbtopmargin: 12,
                thumbbottommargin: 12,
                thumbborder: 1,
                thumbbordercolor: "transparent",
                thumbhighlightbordercolor: "#fff",
                thumbopacity: 1,
                navbuttonwidth: 32,
                navbgcolor: "rgba(0,0,0,0.2)",
                shownavcontrol: true,
                navcontrolimage: "lightbox-navcontrol.png",
                hidenavdefault: false,
                overlaybgcolor: "#000",
                overlayopacity: 0.9,
                bgcolor: "#fff",
                bordersize: 8,
                borderradius: 0,
                bordermargin: 16,
                bordertopmargin: 48,
                barautoheight: true,
                barheight: 64,
                smallscreenheight: 415,
                responsivebarheight: false,
                barheightonsmallheight: 64,
                notkeepratioonsmallheight: false,
                bordertopmarginsmall: 36,
                loadingwidth: 64,
                loadingheight: 64,
                resizespeed: 400,
                fadespeed: 0,
                jsfolder: jsFolder,
                skinsfoldername: "skins/default",
                loadingimage: "lightbox-loading.gif",
                nextimage: "lightbox-next.png",
                previmage: "lightbox-prev.png",
                closeimage: "lightbox-close.png",
                playvideoimage: "lightbox-playvideo.png",
                titlebgimage: "lightbox-titlebg.png",
                navarrowsprevimage: "lightbox-navprev.png",
                navarrowsnextimage: "lightbox-navnext.png",
                navarrowsalwaysshowontouch: true,
                showarrowsbottomonsmallscreen: true,
                navarrowsbottomscreenwidth: 479,
                closeonoverlay: true,
                alwaysshownavarrows: false,
                showplaybutton: true,
                playimage: "lightbox-play.png",
                pauseimage: "lightbox-pause.png",
                playimagesize: 32,
                fullscreenmode: false,
                fullscreencloseimage: "lightbox-close-fullscreen.png",
                fullscreennextimage: "lightbox-next-fullscreen.png",
                fullscreenprevimage: "lightbox-prev-fullscreen.png",
                fullscreennomargin: false,
                fullscreenmodeonsmallscreen: false,
                fullscreennomarginonsmallscreen: false,
                fullscreensmallscreenwidth: 800,
                fullscreenbgcolor: "transparent",
                fullscreenbordersize: 0,
                fullscreentextinside: false,
                fullscreentextoutside: true,
                fullscreennotransition: true,
                videobgcolor: "#000",
                html5videoposter: "",
                showtitle: true,
                titlestyle: "bottom",
                titleinsidecss: "color:#fff; font-size:16px; font-family:Arial,Helvetica,sans-serif; overflow:hidden; text-align:left; margin:4px 8px;",
                titlebottomcss: "color:#333; font-size:16px; font-family:Arial,Helvetica,sans-serif; overflow:hidden; text-align:left;",
                titleoutsidecss: "color:#fff; font-size:18px; font-family:Arial,Helvetica,sans-serif; overflow:hidden; text-align:center; margin: 8px;",
                resizeleftright: true,
                showonmouseoverinside: false,
                showinsidetitleforimageonly: true,
                showdescription: true,
                descriptioninsidecss: "color:#fff; font-size:12px; font-family:Arial,Helvetica,sans-serif; overflow:hidden; text-align:left; margin:4px 0px 0px; padding: 0px;",
                descriptionbottomcss: "color:#333; font-size:12px; font-family:Arial,Helvetica,sans-serif; overflow:hidden; text-align:left; margin:4px 0px 0px; padding: 0px;",
                descriptionoutsidecss: "color:#fff; font-size:14px; font-family:Arial,Helvetica,sans-serif; overflow:hidden; text-align:center; margin:8px; padding: 0px;",
                fullscreentitlebottomcss: "color:#fff; font-size:16px; font-family:Arial,Helvetica,sans-serif; overflow:hidden; text-align:left; margin:4px 8px 8px;",
                fullscreendescriptionbottomcss: "color:#fff; font-size:12px; font-family:Arial,Helvetica,sans-serif; overflow:hidden; text-align:left; margin:4px 0px 0px; padding: 0px;",
                showsocialmedia: true,
                socialmediaposition: "position:absolute;top:8px;right:8px;",
                showtitleprefix: true,
                titleprefix: "%NUM / %TOTAL",
                autoslide: false,
                slideinterval: 5E3,
                showtimer: true,
                timerposition: "bottom",
                timerheight: 2,
                timercolor: "#dc572e",
                timeropacity: 1,
                initvimeo: true,
                inityoutube: true,
                swipepreventdefaultonandroid: false,
                initsocial: true,
                showsocial: false,
                socialposition: "position:absolute;top:100%;right:0;",
                socialpositionsmallscreen: "position:absolute;top:100%;right:0;left:0;",
                socialdirection: "horizontal",
                socialbuttonsize: 32,
                socialbuttonfontsize: 18,
                socialrotateeffect: true,
                showfacebook: true,
                showtwitter: true,
                showpinterest: true,
                showemail: true,
                imagepercentage: 75,
                sidetobottomscreenwidth: 479,
                errorwidth: 280,
                errorheight: 48,
                errorcss: "text-align:center; color:#ff0000; font-size:14px; font-family:Arial, sans-serif;",
                enabletouchswipe: true,
                mobileresizeevent: false,
                swipedistance: 0,
                bodynoscroll: false,
                useabsolutepos: false,
                useabsoluteposonmobile: false,
                supportesckey: true,
                supportarrowkeys: true,
                version: "3.3",
                stamp: true,
                freemark: "72,84,77,76,53,32,76,105,103,104,116,98,111,120,32,70,114,101,101,32,86,101,114,115,105,111,110",
                watermark: "",
                watermarklink: ""
            }, options);
            if (typeof html5lightbox_options != "undefined" && html5lightbox_options) $.extend(inst.options, html5lightbox_options);
            if ($("div.html5lightbox_options").length) $.each($("div.html5lightbox_options").data(), function (key, value) {
                inst.options[key.toLowerCase()] = value
            });
            if ($("div#html5lightbox_options").length) $.each($("div#html5lightbox_options").data(), function (key, value) {
                inst.options[key.toLowerCase()] = value
            });
            if ($("div#html5lightbox_general_options").length) $.each($("div#html5lightbox_general_options").data(),
                function (key, value) {
                    inst.options[key.toLowerCase()] = value
                });
            var ELEM_TYPE = 0, ELEM_HREF = 1, ELEM_TITLE = 2, ELEM_GROUP = 3, ELEM_WIDTH = 4, ELEM_HEIGHT = 5,
                ELEM_HREF_WEBM = 6, ELEM_HREF_OGG = 7, ELEM_THUMBNAIL = 8, ELEM_DESCRIPTION = 9, ELEM_DIV = 10,
                ELEM_ORIGINALWIDTH = 11, ELEM_ORIGINALHEIGHT = 12, ELEM_SOCIALMEDIA = 13, ELEM_WEBLINK = 14,
                ELEM_WEBLINKTARGET = 15, ELEM_WEBLINKTEXT = 16;
            inst.options.types = ["IMAGE", "FLASH", "VIDEO", "YOUTUBE", "VIMEO", "PDF", "MP3", "WEB", "FLV", "DAILYMOTION", "DIV", "WISTIA", "IFRAMEVIDEO"];
            inst.options.htmlfolder = window.location.href.substr(0,
                window.location.href.lastIndexOf("/") + 1);
            inst.options.skinsfolder = inst.options.skinsfoldername;
            if (inst.options.skinsfolder.length > 0 && inst.options.skinsfolder[inst.options.skinsfolder.length - 1] != "/") inst.options.skinsfolder += "/";
            if (inst.options.skinsfolder.charAt(0) != "/" && inst.options.skinsfolder.substring(0, 5) != "http:" && inst.options.skinsfolder.substring(0, 6) != "https:") inst.options.skinsfolder = inst.options.jsfolder + inst.options.skinsfolder;
            var image_list = ["loadingimage", "nextimage", "previmage", "closeimage",
                "playvideoimage", "titlebgimage", "navarrowsprevimage", "navarrowsnextimage", "navcontrolimage", "playimage", "pauseimage", "fullscreencloseimage", "fullscreennextimage", "fullscreenprevimage"];
            for (var i = 0; i < image_list.length; i++) if (inst.options[image_list[i]]) if (inst.options[image_list[i]].substring(0, 7).toLowerCase() != "http://" && inst.options[image_list[i]].substring(0, 8).toLowerCase() != "https://") inst.options[image_list[i]] = inst.options.skinsfolder + inst.options[image_list[i]];
            var i;
            var l;
            var mark = "";
            var bytes =
                inst.options.freemark.split(",");
            for (i = 0; i < bytes.length; i++) mark += String.fromCharCode(bytes[i]);
            inst.options.freemark = mark;
            var d0 = "hmtamgli5cboxh.iclolms";
            for (i = 1; i <= 5; i++) d0 = d0.slice(0, i) + d0.slice(i + 1);
            l = d0.length;
            for (i = 0; i < 5; i++) d0 = d0.slice(0, l - 9 + i) + d0.slice(l - 8 + i);
            if (inst.options.htmlfolder.indexOf(d0) != -1) inst.options.stamp = false;
            inst.options.flashInstalled = false;
            try {
                if (new ActiveXObject("ShockwaveFlash.ShockwaveFlash")) inst.options.flashInstalled = true
            } catch (e) {
                if (navigator.mimeTypes["application/x-shockwave-flash"]) inst.options.flashInstalled =
                    true
            }
            inst.options.html5VideoSupported = !!document.createElement("video").canPlayType;
            inst.options.isChrome = navigator.userAgent.match(/Chrome/i) != null;
            inst.options.isFirefox = navigator.userAgent.match(/Firefox/i) != null;
            inst.options.isOpera = navigator.userAgent.match(/Opera/i) != null || navigator.userAgent.match(/OPR\//i) != null;
            inst.options.isSafari = navigator.userAgent.match(/Safari/i) != null;
            inst.options.isIE11 = navigator.userAgent.match(/Trident\/7/) != null && navigator.userAgent.match(/rv:11/) != null;
            inst.options.isIE =
                navigator.userAgent.match(/MSIE/i) != null && !inst.options.isOpera;
            inst.options.isIE10 = navigator.userAgent.match(/MSIE 10/i) != null && !this.options.isOpera;
            inst.options.isIE9 = navigator.userAgent.match(/MSIE 9/i) != null && !inst.options.isOpera;
            inst.options.isIE8 = navigator.userAgent.match(/MSIE 8/i) != null && !inst.options.isOpera;
            inst.options.isIE7 = navigator.userAgent.match(/MSIE 7/i) != null && !inst.options.isOpera;
            inst.options.isIE6 = navigator.userAgent.match(/MSIE 6/i) != null && !inst.options.isOpera;
            inst.options.isIE678 =
                inst.options.isIE6 || inst.options.isIE7 || inst.options.isIE8;
            inst.options.isIE6789 = inst.options.isIE6 || inst.options.isIE7 || inst.options.isIE8 || inst.options.isIE9;
            inst.options.isAndroid = navigator.userAgent.match(/Android/i) != null;
            inst.options.isIPad = navigator.userAgent.match(/iPad/i) != null;
            inst.options.isIPhone = navigator.userAgent.match(/iPod/i) != null || navigator.userAgent.match(/iPhone/i) != null;
            inst.options.isIOS = inst.options.isIPad || inst.options.isIPhone;
            inst.options.isMobile = inst.options.isAndroid ||
                inst.options.isIPad || inst.options.isIPhone;
            inst.options.isIOSLess5 = inst.options.isIPad && inst.options.isIPhone && (navigator.userAgent.match(/OS 4/i) != null || navigator.userAgent.match(/OS 3/i) != null);
            inst.options.supportCSSPositionFixed = !inst.options.isIE6 && !inst.options.isIOSLess5;
            inst.options.iequirksmode = inst.options.isIE6789 && document.compatMode != "CSS1Compat";
            inst.options.isTouch = "ontouchstart" in window;
            if (inst.options.isChrome) {
                var match = navigator.userAgent.match(/Chrome\/([0-9]+)/);
                inst.options.chromeVersion =
                    match && match.length >= 2 ? parseInt(match[1], 10) : 0
            }
            if (inst.options.isAndroid) {
                var match = navigator.userAgent.match(/Android\s([0-9\.]*)/i);
                inst.options.androidVersion = match && match.length >= 2 ? parseInt(match[1], 10) : -1
            }
            var v = document.createElement("video");
            inst.options.canplaymp4 = v && v.canPlayType && v.canPlayType("video/mp4").replace(/no/, "");
            if (inst.options.isFirefox && inst.options.nativecontrolsonfirefox || (inst.options.isIE6789 || inst.options.isIE10 || inst.options.isIE11) && inst.options.nativecontrolsonie || inst.options.isIPhone &&
                inst.options.nativecontrolsoniphone || inst.options.isIPad && inst.options.nativecontrolsonipad || inst.options.isAndroid && inst.options.nativecontrolsonandroid) inst.options.nativehtml5controls = true;
            if (inst.options.isIOS || inst.options.isAndroid) inst.options.nativecontrolsonfullscreen = true;
            inst.options.navheight = 0;
            inst.options.thumbgap += 2 * inst.options.thumbborder;
            inst.options.resizeTimeout = -1;
            inst.slideTimeout = null;
            inst.autosliding = false;
            inst.existingElem = -1;
            inst.direction = -3;
            inst.elemArray = new Array;
            inst.options.curElem =
                -1;
            inst.defaultoptions = $.extend({}, inst.options);
            if (inst.options.googleanalyticsaccount && !window._gaq) {
                window._gaq = window._gaq || [];
                window._gaq.push(["_setAccount", inst.options.googleanalyticsaccount]);
                window._gaq.push(["_trackPageview"]);
                $.getScript("https://ssl.google-analytics.com/ga.js")
            }
            if (inst.options.initvimeo) {
                var tag = document.createElement("script");
                tag.src = inst.options.jsfolder + "froogaloop2.min.js";
                var firstScriptTag = document.getElementsByTagName("script")[0];
                firstScriptTag.parentNode.insertBefore(tag,
                    firstScriptTag)
            }
            if (inst.options.inityoutube) {
                var tag = document.createElement("script");
                tag.src = "https://www.youtube.com/iframe_api";
                var firstScriptTag = document.getElementsByTagName("script")[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag)
            }
            if (inst.options.initsocial) $("head").append('<link rel="stylesheet" href="' + inst.options.jsfolder + 'icons/css/fontello.css" type="text/css" />');
            inst.showing = false;
            inst.navvisible = false;
            inst.disableEscKey = function (isFullscreen) {
                if (isFullscreen) inst.disableesckeyinfullscreen =
                    true; else setTimeout(function () {
                    inst.disableesckeyinfullscreen = false
                }, 1E3)
            };
            inst.supportKeyboard = function () {
                inst.disableesckeyinfullscreen = false;
                $(document).keyup(function (e) {
                    if (!inst.showing) return;
                    if (!inst.disableesckeyinfullscreen && inst.options.supportesckey && e.keyCode == 27) inst.finish(); else if (inst.options.supportarrowkeys) if (e.keyCode == 39) inst.gotoSlide(-1); else if (e.keyCode == 37) inst.gotoSlide(-2)
                });
                if (inst.options.supportesckey && document.addEventListener) {
                    document.addEventListener("MSFullscreenChange",
                        function () {
                            inst.disableEscKey(document.msFullscreenElement != null)
                        }, false);
                    document.addEventListener("webkitfullscreenchange", function () {
                        inst.disableEscKey(document.webkitIsFullScreen)
                    }, false)
                }
            };
            inst.supportKeyboard();
            inst.init = function () {
                inst.showing = false;
                inst.readData();
                inst.createMarkup();
                inst.initSlide()
            };
            inst.checkParentData = function (node, parentNode, attr) {
                return node.data(attr) ? node.data(attr) : parentNode && parentNode.data(attr) ? parentNode.data(attr) : null
            };
            inst.checkParentClass = function (node, parentNode,
                                              attr) {
                var ret = null;
                $.each([node, parentNode], function (index, nodeValue) {
                    if (nodeValue && nodeValue.attr("class")) {
                        var classList = nodeValue.attr("class").split(/\s+/);
                        $.each(classList, function (index, className) {
                            if (className && className.toLowerCase().indexOf("html5lightbox-" + attr + "-") == 0) {
                                var names = className.split("-");
                                if (names.length == 3) ret = parseInt(names[2])
                            }
                        })
                    }
                });
                return ret
            };
            inst.readNodeData = function (node, parentNode) {
                var fileType = "mediatype" in node.data() ? node.data("mediatype") : inst.checkType(node.attr("href"));
                if (fileType < 0) return;
                var title = node.data("title") ? node.data("title") : node.attr("title");
                var group = node.data("group") ? node.data("group") : inst.options.userelforgroup ? node.attr("rel") : null;
                if (!group && parentNode) group = parentNode.data("group") ? parentNode.data("group") : inst.options.userelforgroup ? parentNode.attr("rel") : null;
                for (var i = 0; i < inst.elemArray.length; i++) if (node.attr("href") == inst.elemArray[i][ELEM_HREF]) {
                    inst.elemArray[i][ELEM_TITLE] = title;
                    inst.elemArray[i][ELEM_GROUP] = group;
                    return
                }
                var w = inst.checkParentData(node,
                    parentNode, "width");
                var h = inst.checkParentData(node, parentNode, "height");
                if (!w) w = inst.checkParentClass(node, parentNode, "width");
                if (!h) h = inst.checkParentClass(node, parentNode, "height");
                inst.elemArray.push(new Array(fileType, node.attr("href"), title, group, w, h, inst.checkParentData(node, parentNode, "webm"), inst.checkParentData(node, parentNode, "ogg"), inst.checkParentData(node, parentNode, "thumbnail"), inst.checkParentData(node, parentNode, "description"), null, null, null, inst.checkParentData(node, parentNode, "socialmedia"),
                    inst.checkParentData(node, parentNode, "weblink"), inst.checkParentData(node, parentNode, "weblinktarget"), inst.checkParentData(node, parentNode, "weblinktext")))
            };
            inst.readData = function () {
                inst.each(function () {
                    var self = $(this);
                    if (this.nodeName.toLowerCase() == "a" || this.nodeName.toLowerCase() == "area") inst.readNodeData(self); else self.find("a,area").each(function () {
                        inst.readNodeData($(this), self)
                    })
                })
            };
            inst.createMarkup = function () {
                if ($(window).width() <= inst.options.fullscreensmallscreenwidth) {
                    if (inst.options.fullscreenmodeonsmallscreen) {
                        inst.options.fullscreenmode =
                            true;
                        if (inst.options.fullscreennomarginonsmallscreen) inst.options.fullscreennomargin = true
                    }
                    if (inst.options.fullscreenmode && inst.options.fullscreennomarginonsmallscreen) inst.options.fullscreennomargin = true
                }
                if (inst.options.fullscreenmode) {
                    inst.options.bgcolor = inst.options.fullscreenbgcolor;
                    inst.options.bordersize = inst.options.fullscreenbordersize;
                    if (inst.options.fullscreennomargin) {
                        inst.options.bordersize = 0;
                        inst.options.bordermargin = 0;
                        inst.options.bordertopmargin = 0;
                        inst.options.bordertopmarginsmall =
                            0
                    }
                    if (inst.options.fullscreentextoutside) {
                        inst.options.titlestyle = "outside";
                        inst.options.titlecss = inst.options.titleoutsidecss;
                        inst.options.descriptioncss = inst.options.descriptionoutsidecss
                    } else if (inst.options.fullscreentextinside) {
                        inst.options.titlestyle = "inside";
                        inst.options.titlecss = inst.options.titleinsidecss;
                        inst.options.descriptioncss = inst.options.descriptioninsidecss
                    } else {
                        inst.options.titlebottomcss = inst.options.fullscreentitlebottomcss;
                        inst.options.descriptionbottomcss = inst.options.fullscreendescriptionbottomcss
                    }
                }
                inst.options.barheightoriginal =
                    inst.options.barheight;
                if (inst.options.responsivebarheight) {
                    var winH = $(window).height();
                    if (winH <= inst.options.smallscreenheight) inst.options.barheight = inst.options.barheightonsmallheight
                }
                switch (inst.options.titlestyle) {
                    case "inside":
                        inst.options.titlecss = inst.options.titleinsidecss;
                        inst.options.descriptioncss = inst.options.descriptioninsidecss;
                        break;
                    case "outside":
                        inst.options.titlecss = inst.options.titleoutsidecss;
                        inst.options.descriptioncss = inst.options.descriptionoutsidecss;
                        break;
                    default:
                        inst.options.titlecss =
                            inst.options.titlebottomcss;
                        inst.options.descriptioncss = inst.options.descriptionbottomcss
                }
                inst.options.titlecss = $.trim(inst.options.titlecss);
                if (inst.options.titlecss.length > 1) {
                    if (inst.options.titlecss.charAt(0) == "{") inst.options.titlecss = inst.options.titlecss.substring(1);
                    if (inst.options.titlecss.charAt(inst.options.titlecss.length - 1) == "}") inst.options.titlecss = inst.options.titlecss.substring(0, inst.options.titlecss.length - 1)
                }
                inst.options.descriptioncss = $.trim(inst.options.descriptioncss);
                if (inst.options.descriptioncss.length >
                    1) {
                    if (inst.options.descriptioncss.charAt(0) == "{") inst.options.descriptioncss = inst.options.descriptioncss.substring(1);
                    if (inst.options.descriptioncss.charAt(inst.options.descriptioncss.length - 1) == "}") inst.options.descriptioncss = inst.options.descriptioncss.substring(0, inst.options.descriptioncss.length - 1)
                }
                inst.options.errorcss = $.trim(inst.options.errorcss);
                if (inst.options.errorcss.length > 1) {
                    if (inst.options.errorcss.charAt(0) == "{") inst.options.errorcss = inst.options.errorcss.substring(1);
                    if (inst.options.errorcss.charAt(inst.options.errorcss.length -
                            1) == "}") inst.options.errorcss = inst.options.errorcss.substring(0, inst.options.errorcss.length - 1)
                }
                var styleCss = ".bodynoscroll {height:100%;overflow:hidden;}";
                styleCss += ".html5-hide {display:none !important;} #html5box-html5-lightbox .html5-text {" + inst.options.titlecss + "}";
                styleCss += "#html5box-html5-lightbox .html5-description {" + inst.options.descriptioncss + "}";
                styleCss += "#html5box-html5-lightbox .html5-error {" + inst.options.errorcss + "}";
                if (inst.options.navarrowsalwaysshowontouch || inst.options.alwaysshownavarrows) {
                    styleCss +=
                        "#html5box-html5-lightbox .html5-prev-touch {left:0px;top:50%;margin-top:-16px;margin-left:-32px;} #html5box-html5-lightbox .html5-next-touch {right:0px;top:50%;margin-top:-16px;margin-right:-32px;}";
                    if (inst.options.showarrowsbottomonsmallscreen) styleCss += "@media (max-width: " + inst.options.navarrowsbottomscreenwidth + "px) { #html5box-html5-lightbox .html5-prev-touch {top:100%;left:0;margin:0;} #html5box-html5-lightbox .html5-next-touch {top:100%;right:0;margin:0;} }"
                }
                styleCss += "#html5box-html5-lightbox .html5-prev-fullscreen {display:block;} #html5box-html5-lightbox .html5-next-fullscreen {display:block;} #html5box-html5-lightbox .html5-prev-bottom-fullscreen {display:none;} #html5box-html5-lightbox .html5-next-bottom-fullscreen {display:none;}";
                if (inst.options.showarrowsbottomonsmallscreen) styleCss += "@media (max-width: " + inst.options.navarrowsbottomscreenwidth + "px) {#html5box-html5-lightbox .html5-prev-fullscreen {display:none;} #html5box-html5-lightbox .html5-next-fullscreen {display:none;} #html5box-html5-lightbox .html5-prev-bottom-fullscreen {display:block;} #html5box-html5-lightbox .html5-next-bottom-fullscreen {display:block;} }";
                if (inst.options.titlestyle == "right") {
                    styleCss += "#html5box-html5-lightbox .html5-elem-wrap {width:" + inst.options.imagepercentage +
                        "%;height:100%;} #html5box-html5-lightbox .html5-elem-data-box {min-height:100%;}";
                    styleCss += "@media (max-width: " + inst.options.sidetobottomscreenwidth + "px) {#html5box-html5-lightbox .html5-elem-wrap {width:100%;height:auto;} #html5box-html5-lightbox .html5-elem-data-box {width:100%;height:auto;min-height:0;}}"
                } else if (inst.options.titlestyle == "left") {
                    styleCss += "#html5box-html5-lightbox .html5-elem-wrap {height:100%;} #html5box-html5-lightbox .html5-elem-data-box {width:" + String(100 - inst.options.imagepercentage) +
                        "%;min-height:100%;}";
                    styleCss += "@media (max-width: " + inst.options.sidetobottomscreenwidth + "px) {#html5box-html5-lightbox .html5-elem-wrap {width:100%;height:auto;} #html5box-html5-lightbox .html5-elem-data-box {width:100%;height:auto;min-height:0;}}"
                }
                styleCss += ".html5-rotate { border-radius:50%; -webkit-transition:-webkit-transform .4s ease-in; transition: transform .4s ease-in; } .html5-rotate:hover { -webkit-transform: rotate(360deg); transform: rotate(360deg); }";
                styleCss += "@media (max-width: " +
                    inst.options.navarrowsbottomscreenwidth + "px) {#html5-social {" + inst.options.socialpositionsmallscreen + "}}";
                styleCss += ".html5box-animated { -webkit-animation-duration:" + inst.options.animationduration + "; animation-duration:" + inst.options.animationduration + "; -webkit-animation-fill-mode: both; animation-fill-mode: both; } @-webkit-keyframes html5box-fadeOut { from { opacity: 1; } to { opacity: 0; } } @keyframes html5box-fadeOut { from { opacity: 1; } to { opacity: 0; } } .html5box-fadeOut { -webkit-animation-name: html5box-fadeOut; animation-name: html5box-fadeOut; }";
                styleCss += "@-webkit-keyframes html5box-fadeOutDown { from { opacity: 1; } to { opacity: 0; -webkit-transform: translate3d(0, 100%, 0); transform: translate3d(0, 100%, 0); } } @keyframes html5box-fadeOutDown { from { opacity: 1; } to { opacity: 0; -webkit-transform: translate3d(0, 100%, 0); transform: translate3d(0, 100%, 0); } } .html5box-fadeOutDown { -webkit-animation-name: html5box-fadeOutDown; animation-name: html5box-fadeOutDown; }";
                $("head").append("<style type='text/css' data-creator='html5box-html5-lightbox'>" +
                    styleCss + "</style>");
                var elemheight = inst.options.elemautoheight ? "auto" : "100%";
                inst.$lightbox = $("<div id='html5box-html5-lightbox' style='display:none;top:0px;left:0px;width:100%;height:100%;z-index:9999998;text-align:center;'>" + "<div id='html5-lightbox-overlay' style='display:block;position:absolute;top:0px;left:0px;width:100%;min-height:100%;background-color:" + inst.options.overlaybgcolor + ";opacity:" + inst.options.overlayopacity + ";filter:alpha(opacity=" + Math.round(inst.options.overlayopacity * 100) +
                    ");'></div>" + "<div id='html5-lightbox-box' style='display:block;position:relative;margin:0px auto;'>" + "<div class='html5-elem-box' style='display:block;position:relative;width:100%;overflow-x:hidden;overflow-y:auto;height:" + elemheight + ";margin:0px auto;text-align:center;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;'>" + "<div class='html5-elem-wrap' style='display:block;position:relative;overflow:hidden;margin:0px auto;text-align:center;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;background-color:" +
                    inst.options.bgcolor + ";'>" + "<div class='html5-loading' style='display:none;position:absolute;top:0px;left:0px;text-align:center;width:100%;height:100%;background:url(\"" + inst.options.loadingimage + "\") no-repeat center center;'></div>" + "<div class='html5-error-box html5-error' style='display:none;position:absolute;padding:" + inst.options.bordersize + "px;text-align:center;width:" + inst.options.errorwidth + "px;height:" + inst.options.errorheight + "px;'>" + "The requested content cannot be loaded.<br />Please try again later." +
                    "</div>" + "<div class='html5-image' style='display:none;position:relative;top:0px;left:0px;width:100%;height:100%;" + (inst.options.iequirksmode ? "margin" : "padding") + ":" + inst.options.bordersize + "px;text-align:center;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;'></div>" + "</div>" + "</div>" + "</div>" + "</div>");
                inst.options.positionFixed = inst.options.supportCSSPositionFixed && inst.options.responsive && !inst.options.iequirksmode;
                if (inst.options.useabsolutepos || inst.options.useabsoluteposonmobile && inst.options.isMobile) inst.options.positionFixed = false;
                inst.$lightbox.css({position: inst.options.positionFixed ? "fixed" : "absolute"});
                inst.$lightbox.appendTo("body");
                inst.$lightboxBox = $("#html5-lightbox-box", inst.$lightbox);
                inst.$elem = $(".html5-elem-box", inst.$lightbox);
                inst.$elemWrap = $(".html5-elem-wrap", inst.$lightbox);
                inst.$loading = $(".html5-loading", inst.$lightbox);
                inst.$error = $(".html5-error-box", inst.$lightbox);
                inst.$image = $(".html5-image", inst.$lightbox);
                if (inst.options.fullscreenmode && inst.options.fullscreennomargin) inst.$elem.css({overflow: "hidden"});
                var elemText = "<div class='html5-elem-data-box' style='display:none;box-sizing:border-box;'><div class='html5-text' style='display:block;overflow:hidden;'></div></div>";
                if (inst.options.titlestyle == "left") inst.$elem.prepend(elemText); else if (inst.options.titlestyle ==
                    "outside") inst.$lightbox.append(elemText); else inst.$elem.append(elemText);
                inst.$elemData = $(".html5-elem-data-box", inst.$lightbox);
                inst.$text = $(".html5-text", inst.$lightbox);
                if (inst.options.borderradius > 0) {
                    inst.$elem.css({
                        "border-radius": inst.options.borderradius + "px",
                        "-moz-border-radius": inst.options.borderradius + "px",
                        "-webkit-border-radius": inst.options.borderradius + "px"
                    });
                    if (inst.options.titlestyle == "inside") inst.$elemWrap.css({
                        "border-radius": inst.options.borderradius + "px",
                        "-moz-border-radius": inst.options.borderradius +
                        "px",
                        "-webkit-border-radius": inst.options.borderradius + "px"
                    }); else if (inst.options.titlestyle == "bottom") {
                        inst.$elemWrap.css({
                            "border-top-left-radius": inst.options.borderradius + "px",
                            "-moz-top-left-border-radius": inst.options.borderradius + "px",
                            "-webkit-top-left-border-radius": inst.options.borderradius + "px",
                            "border-top-right-radius": inst.options.borderradius + "px",
                            "-moz-top-right-border-radius": inst.options.borderradius + "px",
                            "-webkit-top-right-border-radius": inst.options.borderradius + "px"
                        });
                        inst.$elemData.css({
                            "border-bottom-left-radius": inst.options.borderradius +
                            "px",
                            "-moz-top-bottom-border-radius": inst.options.borderradius + "px",
                            "-webkit-bottom-left-border-radius": inst.options.borderradius + "px",
                            "border-bottom-right-radius": inst.options.borderradius + "px",
                            "-moz-bottom-right-border-radius": inst.options.borderradius + "px",
                            "-webkit-bottom-right-border-radius": inst.options.borderradius + "px"
                        })
                    }
                }
                if (inst.options.titlestyle == "right" || inst.options.titlestyle == "left") {
                    inst.$lightboxBox.css({"background-color": inst.options.bgcolor});
                    if (inst.options.titlestyle == "right") {
                        inst.$elemWrap.css({
                            position: "relative",
                            "float": "left"
                        });
                        inst.$elemData.css({
                            position: "relative",
                            overflow: "hidden",
                            padding: inst.options.bordersize + "px"
                        })
                    } else {
                        inst.$elemWrap.css({position: "relative", overflow: "hidden"});
                        inst.$elemData.css({
                            position: "relative",
                            "float": "left",
                            padding: inst.options.bordersize + "px"
                        })
                    }
                } else if (inst.options.titlestyle == "inside") {
                    inst.$elemData.css({
                        position: "absolute",
                        margin: 0,
                        padding: 0,
                        bottom: inst.options.bordersize + "px",
                        left: inst.options.bordersize + "px",
                        right: inst.options.bordersize + "px",
                        "background-color": "#333",
                        "background-color": "rgba(51, 51, 51, 0.6)"
                    });
                    if (inst.options.showonmouseoverinside) inst.$elemData.css({opacity: 0});
                    inst.$text.css({padding: inst.options.bordersize + "px " + 2 * inst.options.bordersize + "px"})
                } else if (inst.options.titlestyle == "outside") inst.$elemData.css({
                    position: "relative",
                    width: "100%",
                    height: "auto"
                }); else {
                    inst.$elemData.css({
                        position: "relative",
                        width: "100%",
                        height: inst.options.barautoheight ? "auto" : inst.options.barheight + "px",
                        "padding": "0 0 " + inst.options.bordersize + "px" + " 0",
                        "background-color": inst.options.bgcolor,
                        "text-align": "left"
                    });
                    if (!inst.options.fullscreenmode || !inst.options.fullscreennomargin) inst.$text.css({"margin": "0 " + inst.options.bordersize + "px"})
                }
                if (inst.options.showsocial) {
                    var socialCode = '<div id="html5-social" style="display:none;' + inst.options.socialposition + '">';
                    var socialBtnCSS = (inst.options.socialdirection == "horizontal" ? "display:inline-block;" : "display:block;") + "margin:4px;";
                    var socialCSS = "display:table-cell;width:" + inst.options.socialbuttonsize + "px;height:" + inst.options.socialbuttonsize +
                        "px;font-size:" + inst.options.socialbuttonfontsize + "px;border-radius:50%;color:#fff;vertical-align:middle;text-align:center;cursor:pointer;padding:0;";
                    if (inst.options.showemail) socialCode += '<div class="html5-social-btn' + (inst.options.socialrotateeffect ? " html5-rotate" : "") + ' html5-social-email" style="' + socialBtnCSS + '"><div class="mh-icon-mail" style="' + socialCSS + 'background-color:#4d83ff;"></div></div>';
                    if (inst.options.showfacebook) socialCode += '<div class="html5-social-btn' + (inst.options.socialrotateeffect ?
                        " html5-rotate" : "") + ' html5-social-facebook" style="' + socialBtnCSS + '"><div class="mh-icon-facebook" style="' + socialCSS + 'background-color:#3b5998;"></div></div>';
                    if (inst.options.showtwitter) socialCode += '<div class="html5-social-btn' + (inst.options.socialrotateeffect ? " html5-rotate" : "") + ' html5-social-twitter" style="' + socialBtnCSS + '"><div class="mh-icon-twitter" style="' + socialCSS + 'background-color:#03b3ee;"></div></div>';
                    if (inst.options.showpinterest) socialCode += '<div class="html5-social-btn' + (inst.options.socialrotateeffect ?
                        " html5-rotate" : "") + ' html5-social-pinterest" style="' + socialBtnCSS + '"><div class="mh-icon-pinterest" style="' + socialCSS + 'background-color:#c92228;"></div></div>';
                    socialCode += '<div style="clear:both;"></div></div>';
                    inst.$lightboxBox.append(socialCode);
                    $(".html5-social-btn", inst.$lightbox).click(function () {
                        var shareUrl = window.location.href + (window.location.href.indexOf("?") < 0 ? "?" : "&") + "html5lightboxshare=" + encodeURIComponent(inst.currentElem[ELEM_HREF]);
                        var shareTitle = inst.currentElem[ELEM_TITLE];
                        var shareMedia = inst.currentElem[ELEM_HREF];
                        if (inst.currentElem[ELEM_TYPE] == 0) shareMedia = inst.absoluteUrl(inst.currentElem[ELEM_HREF]); else if (inst.currentElem[ELEM_TYPE] == 3) shareMedia = "https://img.youtube.com/vi/" + inst.getYoutubeId(inst.currentElem[ELEM_HREF]) + "/0.jpg"; else {
                            var lightboxLink = $('.html5lightbox[href="' + inst.currentElem[ELEM_HREF] + '"]');
                            if (lightboxLink.length > 0) if (lightboxLink.data("shareimage") && lightboxLink.data("shareimage").length > 0) shareMedia = inst.absoluteUrl(lightboxLink.data("shareimage"));
                            else if (lightboxLink.data("thumbnail") && lightboxLink.data("thumbnail").length > 0) shareMedia = inst.absoluteUrl(lightboxLink.data("thumbnail")); else {
                                var lightboxImg = $("img", lightboxLink);
                                if (lightboxImg.length > 0) shareMedia = inst.absoluteUrl(lightboxImg.attr("src"))
                            }
                        }
                        var isVideo = inst.currentElem[ELEM_TYPE] == 2 || inst.currentElem[ELEM_TYPE] == 3 || inst.currentElem[ELEM_TYPE] == 4 || inst.currentElem[ELEM_TYPE] == 8 || inst.currentElem[ELEM_TYPE] == 9 || inst.currentElem[ELEM_TYPE] == 11 || inst.currentElem[ELEM_TYPE] == 12;
                        if (!shareTitle) shareTitle =
                            ""; else shareTitle = inst.html2Text(shareTitle);
                        if ($(this).hasClass("html5-social-facebook")) window.open("https://www.facebook.com/sharer/sharer.php?u=" + encodeURIComponent(shareUrl) + "&t=" + encodeURIComponent(shareTitle), "_blank"); else if ($(this).hasClass("html5-social-twitter")) window.open("https://twitter.com/share?url=" + encodeURIComponent(shareUrl) + "&text=" + encodeURIComponent(shareTitle), "_blank"); else if ($(this).hasClass("html5-social-pinterest")) window.open("https://pinterest.com/pin/create/bookmarklet/?media=" +
                            encodeURIComponent(shareMedia) + "&url=" + encodeURIComponent(shareUrl) + "&description=" + encodeURIComponent(shareTitle) + "&is_video=" + (isVideo ? "true" : "false"), "_blank"); else if ($(this).hasClass("html5-social-email")) window.open("mailto:?subject=" + encodeURIComponent(shareTitle) + "&body=Check out this: " + encodeURIComponent(shareUrl));
                        return false
                    })
                }
                if (inst.options.fullscreenmode) {
                    inst.$lightbox.append("<div class='html5-next-fullscreen' style='cursor:pointer;position:absolute;right:" + inst.options.bordersize +
                        "px;top:50%;margin-top:-16px;z-index:1;'><img alt='' src='" + inst.options.fullscreennextimage + "'></div>" + "<div class='html5-prev-fullscreen' style='cursor:pointer;position:absolute;left:" + inst.options.bordersize + "px;top:50%;margin-top:-16px;z-index:1;'><img alt='' src='" + inst.options.fullscreenprevimage + "'></div>");
                    inst.$next = $(".html5-next-fullscreen", inst.$lightbox);
                    inst.$prev = $(".html5-prev-fullscreen", inst.$lightbox);
                    inst.$lightboxBox.append("<div class='html5-next-bottom-fullscreen' style='cursor:pointer;position:absolute;top:100%;right:0;margin-top:8px;z-index:1;'><img alt='' src='" +
                        inst.options.fullscreennextimage + "'></div>" + "<div class='html5-prev-bottom-fullscreen' style='cursor:pointer;position:absolute;top:100%;left:0;margin-top:8px;z-index:1;'><img alt='' src='" + inst.options.fullscreenprevimage + "'></div>");
                    inst.$nextbottom = $(".html5-next-bottom-fullscreen", inst.$lightbox);
                    inst.$prevbottom = $(".html5-prev-bottom-fullscreen", inst.$lightbox);
                    inst.$nextbottom.click(function () {
                        inst.nextArrowClicked()
                    });
                    inst.$prevbottom.click(function () {
                        inst.prevArrowClicked()
                    });
                    inst.$lightbox.append("<div id='html5-close-fullscreen' style='display:block;cursor:pointer;position:absolute;top:0;right:0;margin-top:0;margin-right:0;'><img alt='' src='" +
                        inst.options.fullscreencloseimage + "'></div>");
                    inst.$close = $("#html5-close-fullscreen", inst.$lightbox)
                } else {
                    inst.$lightboxBox.append("<div class='html5-next' style='display:none;cursor:pointer;position:absolute;right:" + inst.options.bordersize + "px;top:50%;margin-top:-32px;z-index:1;'><img alt='' src='" + inst.options.nextimage + "'></div>" + "<div class='html5-prev' style='display:none;cursor:pointer;position:absolute;left:" + inst.options.bordersize + "px;top:50%;margin-top:-32px;z-index:1;'><img alt='' src='" +
                        inst.options.previmage + "'></div>");
                    inst.$next = $(".html5-next", inst.$lightbox);
                    inst.$prev = $(".html5-prev", inst.$lightbox);
                    if (inst.options.isTouch && inst.options.navarrowsalwaysshowontouch || inst.options.alwaysshownavarrows) {
                        inst.$lightboxBox.append("<div class='html5-next-touch' style='display:block;cursor:pointer;position:absolute;z-index:1;'><img alt='' src='" + inst.options.nextimage + "'></div>" + "<div class='html5-prev-touch' style='display:block;cursor:pointer;position:absolute;z-index:1;'><img alt='' src='" +
                            inst.options.previmage + "'></div>");
                        inst.$nexttouch = $(".html5-next-touch", inst.$lightbox);
                        inst.$prevtouch = $(".html5-prev-touch", inst.$lightbox);
                        inst.$nexttouch.click(function () {
                            inst.nextArrowClicked()
                        });
                        inst.$prevtouch.click(function () {
                            inst.prevArrowClicked()
                        })
                    }
                    inst.$lightboxBox.append("<div id='html5-close' style='display:none;cursor:pointer;position:absolute;top:0;right:0;margin-top:-16px;margin-right:-16px;'><img alt='' src='" + inst.options.closeimage + "'></div>");
                    inst.$close = $("#html5-close", inst.$lightbox)
                }
                if (inst.options.titlestyle ==
                    "inside" && inst.options.showonmouseoverinside) inst.$lightboxBox.hover(function () {
                    if (inst.currentElem[ELEM_TYPE] == 0 || !inst.options.showinsidetitleforimageonly) inst.$elemData.animate({opacity: 1}, 400)
                }, function () {
                    inst.$elemData.animate({opacity: 0}, 400)
                });
                inst.$watermark = $("#html5-watermark", inst.$lightbox);
                if (inst.options.stamp) inst.$watermark.html("<a href='" + inst.options.freelink + "' style='text-decoration:none;' title='jQuery Lightbox'><div style='display:block;width:170px;height:20px;text-align:center;border-radius:3px;-moz-border-radius:3px;-webkit-border-radius:3px;background-color:#fff;color:#333;font:12px Arial,sans-serif;'><div style='line-height:20px;'>" +
                    inst.options.freemark + "</div></div></a>"); else if (inst.options.watermark) {
                    var html = "<img alt='' src='" + inst.options.watermark + "' style='border:none;' />";
                    if (inst.options.watermarklink) html = "<a href='" + inst.options.watermarklink + "' target='_blank'>" + html + "</a>";
                    inst.$watermark.html(html)
                }
                if (inst.options.closeonoverlay) $("#html5-lightbox-overlay", inst.$lightbox).click(inst.finish);
                inst.$close.click(inst.finish);
                inst.$next.click(function () {
                    inst.nextArrowClicked()
                });
                inst.$prev.click(function () {
                    inst.prevArrowClicked()
                });
                $(window).resize(function () {
                    if (inst.options.isIOS && !inst.options.mobileresizeevent) return;
                    clearTimeout(inst.options.resizeTimeout);
                    inst.options.resizeTimeout = setTimeout(function () {
                        inst.resizeWindow()
                    }, inst.options.resizedelay)
                });
                $(window).scroll(function () {
                    if (inst.options.isIOS && !inst.options.mobileresizeevent) return;
                    inst.scrollBox()
                });
                $(window).on("orientationchange", function (e) {
                    if (inst.options.isMobile) {
                        clearTimeout(inst.options.resizeTimeout);
                        inst.options.resizeTimeout = setTimeout(function () {
                                inst.resizeWindow()
                            },
                            inst.options.resizedelay)
                    }
                });
                if (inst.options.enabletouchswipe) inst.enableSwipe()
            };
            inst.html2Text = function (html) {
                var tag = document.createElement("div");
                tag.innerHTML = html;
                return tag.innerText
            };
            inst.slideTimer = function (interval, callback, updatecallback) {
                var timerInstance = this;
                timerInstance.timeout = interval;
                var updateinterval = 50;
                var updateTimerId = null;
                var runningTime = 0;
                var paused = false;
                var started = false;
                var startedandpaused = false;
                this.pause = function () {
                    if (started) {
                        paused = true;
                        clearInterval(updateTimerId)
                    }
                };
                this.resume = function (forceresume) {
                    if (startedandpaused && !forceresume) return;
                    startedandpaused = false;
                    if (started && paused) {
                        paused = false;
                        updateTimerId = setInterval(function () {
                            runningTime += updateinterval;
                            if (runningTime > timerInstance.timeout) {
                                clearInterval(updateTimerId);
                                if (callback) callback()
                            }
                            if (updatecallback) updatecallback(runningTime / timerInstance.timeout)
                        }, updateinterval)
                    }
                };
                this.stop = function () {
                    clearInterval(updateTimerId);
                    if (updatecallback) updatecallback(-1);
                    runningTime = 0;
                    paused = false;
                    started = false
                };
                this.start = function () {
                    runningTime = 0;
                    paused = false;
                    started = true;
                    updateTimerId = setInterval(function () {
                        runningTime += updateinterval;
                        if (runningTime > timerInstance.timeout) {
                            clearInterval(updateTimerId);
                            if (callback) callback()
                        }
                        if (updatecallback) updatecallback(runningTime / timerInstance.timeout)
                    }, updateinterval)
                };
                this.startandpause = function () {
                    runningTime = 0;
                    paused = true;
                    started = true;
                    startedandpaused = true
                };
                return this
            };
            inst.updateTimer = function (percent) {
                var w = Math.round(percent * 100);
                if (w > 100) w = 100;
                if (w < 0) w = 0;
                $(".html5-timer",
                    inst.$lightbox).css({display: "block", width: w + "%"})
            };
            inst.initSlide = function () {
                inst.autosliding = false;
                inst.slideTimeout = inst.slideTimer(inst.options.slideinterval, function () {
                    inst.gotoSlide(-1)
                }, inst.options.showtimer ? function (percent) {
                    inst.updateTimer(percent)
                } : null);
                if (inst.options.autoslide) {
                    inst.slideTimeout.stop();
                    inst.autosliding = true
                }
            };
            inst.nextArrowClicked = function () {
                if (inst.options.nextElem <= inst.options.curElem) if (inst.options.onlastarrowclicked && window[inst.options.onlastarrowclicked] && typeof window[inst.options.onlastarrowclicked] ==
                    "function") window[inst.options.onlastarrowclicked]();
                inst.gotoSlide(-1)
            };
            inst.prevArrowClicked = function () {
                if (inst.options.prevElem >= inst.options.curElem) if (inst.options.onfirstarrowclicked && window[inst.options.onfirstarrowclicked] && typeof window[inst.options.onfirstarrowclicked] == "function") window[inst.options.onfirstarrowclicked]();
                inst.gotoSlide(-2)
            };
            inst.calcNextPrevElem = function () {
                inst.options.nextElem = -1;
                inst.options.prevElem = -1;
                inst.options.inGroup = false;
                inst.options.groupIndex = 0;
                inst.options.groupCount =
                    0;
                var group = inst.elemArray[inst.options.curElem][ELEM_GROUP];
                for (var i = 0; i < inst.elemArray.length; i++) if (inst.matchGroup(group, inst.elemArray[i][ELEM_GROUP])) {
                    if (i == inst.options.curElem) inst.options.groupIndex = inst.options.groupCount;
                    inst.options.groupCount++
                }
                var j, curGroup = inst.elemArray[inst.options.curElem][ELEM_GROUP];
                if (curGroup != undefined && curGroup != null) {
                    for (j = inst.options.curElem + 1; j < inst.elemArray.length; j++) if (inst.matchGroup(curGroup, inst.elemArray[j][ELEM_GROUP])) {
                        inst.options.nextElem =
                            j;
                        break
                    }
                    if (inst.options.nextElem < 0) for (j = 0; j < inst.options.curElem; j++) if (inst.matchGroup(curGroup, inst.elemArray[j][ELEM_GROUP])) {
                        inst.options.nextElem = j;
                        break
                    }
                    if (inst.options.nextElem >= 0) {
                        for (j = inst.options.curElem - 1; j >= 0; j--) if (inst.matchGroup(curGroup, inst.elemArray[j][ELEM_GROUP])) {
                            inst.options.prevElem = j;
                            break
                        }
                        if (inst.options.prevElem < 0) for (j = inst.elemArray.length - 1; j > inst.options.curElem; j--) if (inst.matchGroup(curGroup, inst.elemArray[j][ELEM_GROUP])) {
                            inst.options.prevElem = j;
                            break
                        }
                    }
                }
                if (inst.options.nextElem >=
                    0 || inst.options.prevElem >= 0) inst.options.inGroup = true
            };
            inst.calcBoxPosition = function (initW, initH) {
                var boxW = initW + 2 * inst.options.bordersize;
                var boxH = initH + 2 * inst.options.bordersize;
                var navH = inst.options.shownavigation && inst.navvisible ? inst.options.navheight : 0;
                var winH = $(window).height();
                var boxT = Math.round((winH - navH) / 2 - boxH / 2);
                if (inst.options.titlestyle == "bottom") boxT -= Math.round(inst.options.barheight / 2);
                var topmargin = $(window).height() < inst.options.smallscreenheight ? inst.options.bordertopmarginsmall :
                    inst.options.bordertopmargin;
                if (boxT < topmargin) boxT = topmargin;
                if (inst.options.insideiframe && window.self != window.top) if (parent.window.jQuery && parent.window.jQuery("#" + inst.options.iframeid).length) {
                    var iframetop = parent.window.jQuery("#" + inst.options.iframeid).offset().top;
                    var parentscroll = parent.window.document.body.scrollTop;
                    boxT = topmargin;
                    boxT += parentscroll > iframetop ? parentscroll - iframetop : 0
                }
                return [boxW, boxH, boxT]
            };
            inst.hideNavArrows = function () {
                var showPrev = false;
                var showNext = false;
                if (inst.options.inGroup) {
                    if (inst.options.arrowloop ||
                        !inst.options.arrowloop && inst.options.prevElem < inst.options.curElem) showPrev = true;
                    if (inst.options.arrowloop || !inst.options.arrowloop && inst.options.nextElem > inst.options.curElem) showNext = true
                }
                if (showPrev) {
                    inst.$prev.removeClass("html5-hide");
                    if (inst.$prevbottom) inst.$prevbottom.removeClass("html5-hide");
                    if (inst.$prevtouch) inst.$prevtouch.removeClass("html5-hide")
                } else {
                    inst.$prev.addClass("html5-hide");
                    if (inst.$prevbottom) inst.$prevbottom.addClass("html5-hide");
                    if (inst.$prevtouch) inst.$prevtouch.addClass("html5-hide")
                }
                if (showNext) {
                    inst.$next.removeClass("html5-hide");
                    if (inst.$nextbottom) inst.$nextbottom.removeClass("html5-hide");
                    if (inst.$nexttouch) inst.$nexttouch.removeClass("html5-hide")
                } else {
                    inst.$next.addClass("html5-hide");
                    if (inst.$nextbottom) inst.$nextbottom.addClass("html5-hide");
                    if (inst.$nexttouch) inst.$nexttouch.addClass("html5-hide")
                }
            };
            inst.resizePositionFixed = function () {
                if (!inst.options.positionFixed) inst.$lightbox.css({
                    "padding-top": $(window).scrollTop() + "px",
                    "height": Math.max($(document).height(), $(window).height()) + "px"
                })
            };
            inst.adjustLightboxPos =
                function (w, h) {
                    var winWidth = $(window).width();
                    var boxPos = inst.calcBoxPosition(w, h);
                    var boxW = boxPos[0];
                    var boxH = boxPos[1];
                    var boxT = boxPos[2];
                    if (inst.options.iequirksmode) inst.$lightboxBox.css({"top": boxT}); else inst.$lightboxBox.css({"margin-top": boxT});
                    inst.resizePositionFixed();
                    if ((inst.options.titlestyle == "left" || inst.options.titlestyle == "right") && winWidth > inst.options.sidetobottomscreenwidth) {
                        inst.$lightboxBox.css({"width": boxW, "height": boxH});
                        inst.$elemWrap.css({
                            "width": inst.options.imagepercentage +
                            "%", "height": "100%"
                        })
                    } else {
                        inst.$lightboxBox.css({"width": boxW, "height": "auto"});
                        inst.$elemWrap.css({"width": boxW, "height": boxH})
                    }
                };
            inst.clickHandler = function () {
                var $this = $(this);
                var dataoptions = {};
                $.each($this.data(), function (key, value) {
                    dataoptions[key.toLowerCase()] = value
                });
                inst.options = $.extend(inst.options, inst.defaultoptions, dataoptions);
                $(window).trigger("html5lightbox.lightboxshow");
                inst.init();
                if (inst.elemArray.length <= 0) return true;
                inst.hideObjects();
                for (var i = 0; i < inst.elemArray.length; i++) if (inst.elemArray[i][ELEM_HREF] ==
                    $this.attr("href")) break;
                if (i == inst.elemArray.length) return true;
                inst.options.curElem = i;
                inst.calcNextPrevElem();
                inst.reset();
                inst.$lightbox.show();
                inst.adjustLightboxPos(inst.options.loadingwidth, inst.options.loadingheight);
                inst.loadCurElem();
                return false
            };
            inst.loadThumbnail = function (src, index, title) {
                var imgLoader = new Image;
                $(imgLoader).on("load", function () {
                    var style;
                    if (this.width / this.height <= inst.options.thumbwidth / inst.options.thumbheight) style = "width:100%;"; else style = "height:100%;";
                    $(".html5-nav-thumb").eq(index).html("<img alt='" +
                        inst.html2Text(title) + "' style='" + style + "' src='" + src + "' />")
                });
                imgLoader.src = src
            };
            inst.matchGroup = function (curGroup, elemGroup) {
                if (inst.options.showall) return true;
                if (!curGroup || !elemGroup) return false;
                var curs = curGroup.split(":");
                var elems = elemGroup.split(":");
                var result = false;
                for (var i in curs) if ($.inArray(curs[i], elems) > -1) {
                    result = true;
                    break
                }
                return result
            };
            inst.showNavigation = function () {
                if (!inst.options.shownavigation) return;
                if (!inst.currentElem || !inst.currentElem[ELEM_GROUP]) return;
                var i;
                var showNav =
                    false;
                var group = inst.currentElem[ELEM_GROUP];
                for (i = 0; i < inst.elemArray.length; i++) if (inst.matchGroup(group, inst.elemArray[i][ELEM_GROUP])) if (inst.elemArray[i][ELEM_THUMBNAIL] && inst.elemArray[i][ELEM_THUMBNAIL].length > 0) {
                    showNav = true;
                    break
                }
                if (!showNav) return;
                inst.options.navheight = inst.options.thumbheight + inst.options.thumbtopmargin + inst.options.thumbbottommargin;
                if ($(".html5-nav").length > 0) return;
                var posCss = inst.options.hidenavdefault ? "top:100%;bottom:auto;left:0;right:0;" : "top:auto;bottom:0;left:0;right:0;";
                var posType = inst.options.positionFixed ? "fixed" : "absolute";
                $("body").append("<div class='html5-nav' style='display:block;position:" + posType + ";" + posCss + "width:100%;height:" + inst.options.navheight + "px;z-index:9999999;" + (inst.options.navbgcolor ? "background-color:" + inst.options.navbgcolor + ";" : "") + "'>" + "<div class='html5-nav-container' style='position:relative;margin:" + inst.options.thumbtopmargin + "px auto " + inst.options.thumbbottommargin + "px;'>" + "<div class='html5-nav-prev' style='display:block;position:absolute;cursor:pointer;width:" +
                    inst.options.navbuttonwidth + 'px;height:100%;left:0;top:0;background:url("' + inst.options.navarrowsprevimage + "\") no-repeat left center;'></div>" + "<div class='html5-nav-mask' style='display:block;position:relative;margin:0 auto;overflow:hidden;'>" + "<div class='html5-nav-list'></div>" + "</div>" + "<div class='html5-nav-next' style='display:block;position:absolute;cursor:pointer;width:" + inst.options.navbuttonwidth + 'px;height:100%;right:0;top:0;background:url("' + inst.options.navarrowsnextimage + "\") no-repeat right center;'></div>" +
                    "</div>" + "</div>");
                inst.navvisible = inst.options.hidenavdefault ? false : true;
                if (inst.options.shownavcontrol) {
                    $(".html5-nav").append('<div class="html5-nav-showcontrol" style="position:absolute;display:block;cursor:pointer;bottom:100%;right:12px;margin:0;padding:0;"><img alt="" src="' + inst.options.navcontrolimage + '"></div>');
                    $(".html5-nav-showcontrol").click(function () {
                        var winH = $(window).height();
                        var navH = $(".html5-nav").height();
                        if (inst.navvisible) {
                            inst.navvisible = false;
                            $(".html5-nav").css({
                                top: winH -
                                navH + "px", bottom: "auto"
                            }).animate({top: winH + "px"}, function () {
                                $(this).css({top: "100%", bottom: "auto"})
                            })
                        } else {
                            inst.navvisible = true;
                            var navH = $(".html5-nav").height();
                            $(".html5-nav").css({
                                top: winH + "px",
                                bottom: "auto"
                            }).animate({top: winH - navH + "px"}, function () {
                                $(this).css({top: "auto", bottom: 0})
                            })
                        }
                        inst.resizeWindow()
                    })
                }
                var index = 0;
                for (i = 0; i < inst.elemArray.length; i++) if (inst.matchGroup(group, inst.elemArray[i][ELEM_GROUP])) if (inst.elemArray[i][ELEM_THUMBNAIL] && inst.elemArray[i][ELEM_THUMBNAIL].length > 0) {
                    $(".html5-nav-list").append("<div class='html5-nav-thumb' data-arrayindex='" +
                        i + "' style='float:left;overflow:hidden;cursor:pointer;opacity:" + inst.options.thumbopacity + ";margin: 0 " + inst.options.thumbgap / 2 + "px;width:" + inst.options.thumbwidth + "px;height:" + inst.options.thumbheight + "px;border:" + inst.options.thumbborder + "px solid " + inst.options.thumbbordercolor + ";'></div>");
                    this.loadThumbnail(inst.elemArray[i][ELEM_THUMBNAIL], index, inst.elemArray[i][ELEM_TITLE]);
                    index++
                }
                $(".html5-nav-thumb").hover(function () {
                    $(this).css({opacity: 1});
                    $(this).css({
                        border: inst.options.thumbborder +
                        "px solid " + inst.options.thumbhighlightbordercolor
                    })
                }, function () {
                    $(this).css({opacity: inst.options.thumbopacity});
                    $(this).css({border: inst.options.thumbborder + "px solid " + inst.options.thumbbordercolor})
                });
                $(".html5-nav-thumb").click(function () {
                    var index = $(this).data("arrayindex");
                    if (index >= 0) inst.gotoSlide(index)
                });
                inst.options.totalwidth = index * (inst.options.thumbgap + inst.options.thumbwidth + 2 * inst.options.thumbborder);
                $(".html5-nav-list").css({
                    display: "block", position: "relative", "margin-left": 0, width: inst.options.totalwidth +
                    "px"
                }).append("<div style='clear:both;'></div>");
                var $navMask = $(".html5-nav-mask");
                var $navPrev = $(".html5-nav-prev");
                var $navNext = $(".html5-nav-next");
                $navPrev.click(function () {
                    var $navList = $(".html5-nav-list");
                    var $navNext = $(".html5-nav-next");
                    var winWidth = $(window).width();
                    var maskWidth = winWidth - 2 * inst.options.navbuttonwidth;
                    var marginLeft = parseInt($navList.css("margin-left")) + maskWidth;
                    if (marginLeft >= 0) {
                        marginLeft = 0;
                        $(this).css({"background-position": "center left"})
                    } else $(this).css({"background-position": "center right"});
                    if (marginLeft <= maskWidth - inst.options.totalwidth) $navNext.css({"background-position": "center left"}); else $navNext.css({"background-position": "center right"});
                    $navList.animate({"margin-left": marginLeft})
                });
                $navNext.click(function () {
                    var $navList = $(".html5-nav-list");
                    var $navPrev = $(".html5-nav-prev");
                    var winWidth = $(window).width();
                    var maskWidth = winWidth - 2 * inst.options.navbuttonwidth;
                    var marginLeft = parseInt($navList.css("margin-left")) - maskWidth;
                    if (marginLeft <= maskWidth - inst.options.totalwidth) {
                        marginLeft =
                            maskWidth - inst.options.totalwidth;
                        $(this).css({"background-position": "center left"})
                    } else $(this).css({"background-position": "center right"});
                    if (marginLeft >= 0) $navPrev.css({"background-position": "center left"}); else $navPrev.css({"background-position": "center right"});
                    $navList.animate({"margin-left": marginLeft})
                });
                var winWidth = $(window).width();
                if (inst.options.totalwidth <= winWidth) {
                    $navMask.css({width: inst.options.totalwidth + "px"});
                    $navPrev.hide();
                    $navNext.hide()
                } else {
                    $navMask.css({
                        width: winWidth -
                        2 * inst.options.navbuttonwidth + "px"
                    });
                    $navPrev.show();
                    $navNext.show()
                }
            };
            inst.loadElem = function (elem) {
                inst.currentElem = elem;
                inst.showing = true;
                if (inst.options.bodynoscroll) $("html,body").addClass("bodynoscroll");
                if (!(inst.options.showtitle && inst.currentElem[ELEM_TITLE] && inst.currentElem[ELEM_TITLE].length > 0 || inst.options.showdescription && inst.currentElem[ELEM_DESCRIPTION] && inst.currentElem[ELEM_DESCRIPTION].length > 0 || inst.options.inGroup && (inst.options.showplaybutton || inst.options.showtitleprefix))) inst.options.barheight =
                    0;
                inst.showNavigation();
                inst.$elem.off("mouseenter").off("mouseleave").off("mousemove");
                inst.$loading.show();
                if (inst.options.onshowitem && window[inst.options.onshowitem] && typeof window[inst.options.onshowitem] == "function") window[inst.options.onshowitem](elem);
                if ((inst.options.transition == "slide" || inst.options.transition == "crossfade") && inst.existingElem >= 0) {
                    $(".html5-elem-box-previous").remove();
                    var newitem = inst.$elem.clone();
                    newitem.insertAfter(inst.$elem);
                    inst.$prevelem = inst.$elem;
                    inst.$elem = newitem;
                    inst.$prevelem.addClass("html5-elem-box-previous");
                    inst.$elem.addClass("html5-elem-box-current");
                    inst.$elemWrap = $(".html5-elem-wrap", inst.$elem);
                    inst.$loading = $(".html5-loading", inst.$elem);
                    inst.$error = $(".html5-error-box", inst.$elem);
                    inst.$image = $(".html5-image", inst.$elem);
                    if (inst.options.titlestyle != "outside") {
                        inst.$elemData = $(".html5-elem-data-box", inst.$elem);
                        inst.$text = $(".html5-text", inst.$elem)
                    }
                    inst.$elem.css({
                        position: "absolute", top: 0, left: inst.options.transition == "slide" ? inst.direction ==
                        -1 ? "100%" : "-100%" : 0, opacity: 0, height: "auto"
                    });
                    inst.$prevelem.css({width: inst.$prevelem.width() + "px", height: inst.$prevelem.height() + "px"})
                }
                switch (elem[ELEM_TYPE]) {
                    case 0:
                        var imgLoader = new Image;
                        $(imgLoader).on("load", function () {
                            elem[ELEM_ORIGINALWIDTH] = imgLoader.width;
                            elem[ELEM_ORIGINALHEIGHT] = imgLoader.height;
                            inst.showImage(elem, imgLoader.width, imgLoader.height)
                        });
                        $(imgLoader).on("error", function () {
                            inst.showError()
                        });
                        imgLoader.src = elem[ELEM_HREF];
                        break;
                    case 1:
                        inst.showSWF(elem);
                        break;
                    case 2:
                    case 8:
                        inst.showVideo(elem);
                        break;
                    case 3:
                    case 4:
                    case 9:
                    case 11:
                    case 12:
                        inst.showYoutubeVimeo(elem);
                        break;
                    case 5:
                        inst.showPDF(elem);
                        break;
                    case 6:
                        inst.showMP3(elem);
                        break;
                    case 7:
                        inst.showWeb(elem);
                        break;
                    case 10:
                        inst.showDiv(elem);
                        break
                }
                if (inst.options.googleanalyticsaccount && window._gaq) window._gaq.push(["_trackEvent", "Lightbox", "Open", elem[ELEM_HREF]]);
                if (inst.options.preload) {
                    if (inst.options.nextElem >= 0 && inst.elemArray[inst.options.nextElem][ELEM_TYPE] == 0) (new Image).src = inst.elemArray[inst.options.nextElem][ELEM_HREF];
                    if (inst.options.prevElem >=
                        0 && inst.elemArray[inst.options.prevElem][ELEM_TYPE] == 0) (new Image).src = inst.elemArray[inst.options.prevElem][ELEM_HREF]
                }
            };
            inst.loadCurElem = function () {
                inst.loadElem(inst.elemArray[inst.options.curElem])
            };
            inst.showError = function () {
                inst.$loading.hide();
                inst.resizeLightbox(inst.options.errorwidth, inst.options.errorheight, true, function () {
                    inst.$loading.hide();
                    inst.$error.show();
                    inst.$elem.fadeIn(inst.options.fadespeed, function () {
                        inst.showData()
                    })
                })
            };
            inst.calcTextWidth = function (objW) {
                return objW - 36
            };
            inst.showTitle =
                function (t, description) {
                    var text = "";
                    if (inst.options.showtitle) if (t && t.length > 0) text += t;
                    if (inst.options.inGroup) {
                        if (inst.options.showtitleprefix) text = "<span class='html5-title-prefix'>" + inst.options.titleprefix.replace("%NUM", inst.options.groupIndex + 1).replace("%TOTAL", inst.options.groupCount) + "</span> <span class='html5-title-caption'>" + text + "</span>";
                        if (inst.options.showplaybutton) text = "<div class='html5-playpause' style='display:inline-block;cursor:pointer;vertical-align:middle;width:" + inst.options.playimagesize +
                            "px;height:" + inst.options.playimagesize + "px;'><div class='html5-play' style='display:block;'><img alt='' src='" + inst.options.playimage + "'></div><div class='html5-pause' style='display:none;'><img alt='' src='" + inst.options.pauseimage + "'></div></div> " + text
                    }
                    if (text.length > 0) text = '<div class="html5-title">' + text + "</div>";
                    if (inst.options.showdescription && description && description.length > 0) text += '<div class="html5-description">' + description + "</div>";
                    inst.$text.html(text);
                    if (inst.options.inGroup && inst.options.showplaybutton) {
                        if (inst.autosliding) {
                            $(".html5-play",
                                inst.$lightbox).hide();
                            $(".html5-pause", inst.$lightbox).show()
                        } else {
                            $(".html5-play", inst.$lightbox).show();
                            $(".html5-pause", inst.$lightbox).hide()
                        }
                        $(".html5-play", inst.$lightbox).click(function () {
                            $(".html5-play", inst.$lightbox).hide();
                            $(".html5-pause", inst.$lightbox).show();
                            if (inst.slideTimeout) {
                                inst.slideTimeout.stop();
                                inst.slideTimeout.start();
                                inst.autosliding = true
                            }
                        });
                        $(".html5-pause", inst.$lightbox).click(function () {
                            $(".html5-play", inst.$lightbox).show();
                            $(".html5-pause", inst.$lightbox).hide();
                            if (inst.slideTimeout) {
                                inst.slideTimeout.stop();
                                inst.autosliding = false
                            }
                        })
                    }
                    $("#html5-social", inst.$lightbox).show();
                    if (inst.options.showsocialmedia) if (inst.currentElem[ELEM_SOCIALMEDIA]) if ($("#html5-socialmedia", inst.$lightboxBox).length > 0) $("#html5-socialmedia", inst.$lightboxBox).html(inst.currentElem[ELEM_SOCIALMEDIA]); else inst.$lightboxBox.append('<div id="html5-socialmedia" style="' + inst.options.socialmediaposition + '">' + inst.currentElem[ELEM_SOCIALMEDIA] + "</div>"); else if ($("#html5-socialmedia",
                            inst.$lightboxBox).length > 0) $("#html5-socialmedia", inst.$lightboxBox).remove()
                }, inst.showImage = function (elem, imgW, imgH) {
                var elemW, elemH;
                if (elem[ELEM_WIDTH]) elemW = elem[ELEM_WIDTH]; else {
                    elemW = imgW;
                    elem[ELEM_WIDTH] = imgW
                }
                if (elem[ELEM_HEIGHT]) elemH = elem[ELEM_HEIGHT]; else {
                    elemH = imgH;
                    elem[ELEM_HEIGHT] = imgH
                }
                inst.showTitle(elem[ELEM_TITLE], elem[ELEM_DESCRIPTION]);
                var sizeObj = inst.calcElemSize({w: elemW, h: elemH}, inst.options.imagekeepratio);
                inst.resizeLightbox(sizeObj.w, sizeObj.h, true, function () {
                    inst.$loading.hide();
                    var timercode = !inst.options.showtimer || !inst.options.inGroup ? "" : "<div class='html5-timer' style='display:none;position:absolute;" + inst.options.timerposition + ":0;left:0;width:0;height:" + inst.options.timerheight + "px;background-color:" + inst.options.timercolor + ";opacity:" + inst.options.timeropacity + ";'></div>";
                    var titlecode = elem[ELEM_WEBLINKTEXT] && elem[ELEM_WEBLINKTEXT].length > 0 ? " title='" + elem[ELEM_WEBLINKTEXT].replace(/'/g, "&#39;") + "'" : "";
                    var targetcode = elem[ELEM_WEBLINKTARGET] && elem[ELEM_WEBLINKTARGET].length >
                    0 ? " target='" + elem[ELEM_WEBLINKTARGET] + "'" : "";
                    var linkcode = elem[ELEM_WEBLINK] && elem[ELEM_WEBLINK].length > 0 ? "<a href='" + elem[ELEM_WEBLINK] + "'" + titlecode + targetcode + ">" : "";
                    var linkcodeafter = elem[ELEM_WEBLINK] && elem[ELEM_WEBLINK].length > 0 ? "</a>" : "";
                    inst.$image.hide();
                    inst.$image.html("<div class='html5-image-container' style='display:block;position:relative;width:100%;height:100%;" + (inst.options.imagekeepratio ? "overflow:hidden;" : "overflow:auto;") + "'>" + linkcode + "<img class='html5-image-img' alt='" + inst.html2Text(elem[ELEM_TITLE]) +
                        "' src='" + elem[ELEM_HREF] + "' width='100%' height='auto' />" + linkcodeafter + timercode + "</div>");
                    inst.$image.fadeIn(inst.options.fadespeed);
                    inst.showData();
                    if (inst.autosliding) {
                        inst.slideTimeout.stop();
                        inst.slideTimeout.start()
                    }
                })
            };
            inst.showSWF = function (elem) {
                var dataW = elem[ELEM_WIDTH] ? elem[ELEM_WIDTH] : inst.options.defaultwidth;
                var dataH = elem[ELEM_HEIGHT] ? elem[ELEM_HEIGHT] : inst.options.defaultheight;
                inst.showTitle(elem[ELEM_TITLE], elem[ELEM_DESCRIPTION]);
                var sizeObj = inst.calcElemSize({w: dataW, h: dataH},
                    true);
                dataW = sizeObj.w;
                dataH = sizeObj.h;
                inst.resizeLightbox(dataW, dataH, true, function () {
                    inst.$loading.hide();
                    inst.$image.html("<div class='html5lightbox-swf' style='display:block;width:100%;height:100%;'></div>").show();
                    inst.embedFlash($(".html5lightbox-swf", inst.$image), elem[ELEM_HREF], "window", {
                        width: dataW,
                        height: dataH
                    });
                    inst.$elem.show();
                    inst.showData();
                    if (inst.autosliding) {
                        inst.slideTimeout.stop();
                        inst.slideTimeout.start()
                    }
                })
            };
            inst.showVideo = function (elem) {
                inst.slideTimeout.stop();
                inst.showTitle(elem[ELEM_TITLE],
                    elem[ELEM_DESCRIPTION]);
                var dataW = elem[ELEM_WIDTH] ? elem[ELEM_WIDTH] : inst.options.defaultwidth;
                var dataH = elem[ELEM_HEIGHT] ? elem[ELEM_HEIGHT] : inst.options.defaultheight;
                var sizeObj = inst.calcElemSize({w: dataW, h: dataH}, true);
                dataW = sizeObj.w;
                dataH = sizeObj.h;
                inst.resizeLightbox(dataW, dataH, true, function () {
                    inst.$loading.hide();
                    inst.$image.html("<div class='html5lightbox-video' style='display:block;width:100%;height:100%;overflow:hidden;background-color:" + inst.options.videobgcolor + ";'></div>").show();
                    var isHTML5 =
                        false;
                    if (inst.options.isIE678 || elem[ELEM_TYPE] == 8 || inst.options.isIE9 && inst.options.useflashonie9 || inst.options.isIE10 && inst.options.useflashonie10 || inst.options.isIE11 && inst.options.useflashonie11) isHTML5 = false; else if (inst.options.isMobile) isHTML5 = true; else if ((inst.options.html5player || !inst.options.flashInstalled) && inst.options.html5VideoSupported) {
                        isHTML5 = true;
                        if (inst.options.isFirefox || inst.options.isOpera) if (!elem[ELEM_HREF_WEBM] && !elem[ELEM_HREF_OGG] && (!inst.options.canplaymp4 || inst.options.useflashformp4onfirefox)) isHTML5 =
                            false
                    }
                    if (isHTML5) {
                        var videoSrc = elem[ELEM_HREF];
                        if (inst.options.isFirefox || inst.options.isOpera) if (elem[ELEM_HREF_WEBM]) videoSrc = elem[ELEM_HREF_WEBM]; else if (elem[ELEM_HREF_OGG]) videoSrc = elem[ELEM_HREF_OGG];
                        inst.embedHTML5Video($(".html5lightbox-video", inst.$image), videoSrc, inst.options.autoplay, inst.options.loopvideo, inst.options.mutevideo);
                        if (elem[ELEM_WEBLINK] && elem[ELEM_WEBLINK].length > 0) $(".html5-lightbox-video", inst.$image).css({cursor: "pointer"}).click(function () {
                            if (elem[ELEM_WEBLINKTARGET] &&
                                elem[ELEM_WEBLINKTARGET].length > 0) window.open(elem[ELEM_WEBLINK], elem[ELEM_WEBLINKTARGET]); else window.open(elem[ELEM_WEBLINK])
                        })
                    } else {
                        var videoFile = elem[ELEM_HREF];
                        if (videoFile.charAt(0) != "/" && videoFile.substring(0, 5) != "http:" && videoFile.substring(0, 6) != "https:") videoFile = inst.options.htmlfolder + videoFile;
                        inst.embedFlash($(".html5lightbox-video", inst.$image), inst.options.jsfolder + "html5boxplayer.swf", "transparent", {
                            width: dataW,
                            height: dataH,
                            jsobjectname: "html5Lightbox",
                            hidecontrols: inst.options.videohidecontrols ?
                                "1" : "0",
                            hideplaybutton: "0",
                            videofile: videoFile,
                            hdfile: "",
                            ishd: "0",
                            defaultvolume: inst.options.defaultvideovolume,
                            autoplay: inst.options.autoplay ? "1" : "0",
                            loop: inst.options.loopvideo ? "1" : "0",
                            errorcss: ".html5box-error" + inst.options.errorcss,
                            id: 0
                        })
                    }
                    inst.$elem.show();
                    inst.showData()
                })
            };
            inst.loadNext = function () {
                $(window).trigger("html5lightbox.videofinished");
                if (inst.autosliding) inst.gotoSlide(-1); else if (inst.options.autoclose) setTimeout(function () {
                    inst.finish()
                }, inst.options.autoclosedelay)
            };
            inst.getYoutubeParams =
                function (href) {
                    var result = {};
                    if (href.indexOf("?") < 0) return result;
                    var params = href.substring(href.indexOf("?") + 1).split("&");
                    for (var i = 0; i < params.length; i++) {
                        var value = params[i].split("=");
                        if (value && value.length == 2 && value[0].toLowerCase() != "v") result[value[0].toLowerCase()] = value[1]
                    }
                    return result
                };
            inst.getYoutubeId = function (href) {
                var youtubeId = "";
                var regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\??v?=?))([^#\&\?]*).*/;
                var match = href.match(regExp);
                if (match && match[7] && match[7].length ==
                    11) youtubeId = match[7];
                return youtubeId
            };
            inst.prepareYoutubeHref = function (href) {
                var youtubeId = inst.getYoutubeId(href);
                var protocol = "https:";
                var result = protocol + "//www.youtube.com/embed/" + youtubeId;
                var params = this.getYoutubeParams(href);
                var first = true;
                for (var key in params) {
                    if (first) {
                        result += "?";
                        first = false
                    } else result += "&";
                    result += key + "=" + params[key]
                }
                return result
            };
            inst.prepareDailymotionHref = function (href) {
                if (href.match(/\:\/\/.*(dai\.ly)/i)) {
                    var protocol = "https:";
                    var id = href.match(/(dai\.ly\/)([a-zA-Z0-9\-\_]+)/)[2];
                    href = protocol + "//www.dailymotion.com/embed/video/" + id
                }
                return href
            };
            inst.showYoutubeVimeo = function (elem) {
                inst.slideTimeout.stop();
                inst.showTitle(elem[ELEM_TITLE], elem[ELEM_DESCRIPTION]);
                var dataW = elem[ELEM_WIDTH] ? elem[ELEM_WIDTH] : inst.options.defaultwidth;
                var dataH = elem[ELEM_HEIGHT] ? elem[ELEM_HEIGHT] : inst.options.defaultheight;
                var sizeObj = inst.calcElemSize({w: dataW, h: dataH}, true);
                dataW = sizeObj.w;
                dataH = sizeObj.h;
                if (inst.options.noresizecallback) {
                    inst.resizeLightbox(dataW, dataH, true, function () {
                        inst.showData()
                    });
                    inst.showYouTubeVimeoCallback(elem, sizeObj)
                } else inst.resizeLightbox(dataW, dataH, true, function () {
                    inst.showYouTubeVimeoCallback(elem, sizeObj);
                    inst.showData()
                })
            };
            inst.showYouTubeVimeoCallback = function (elem, sizeObj) {
                inst.$loading.hide();
                inst.$image.html("<div class='html5lightbox-video' style='display:block;width:100%;height:100%;overflow:hidden;'></div>").show();
                var href = elem[ELEM_HREF];
                var youtubeid = "";
                if (elem[ELEM_TYPE] == 3) {
                    youtubeid = inst.getYoutubeId(href);
                    href = inst.prepareYoutubeHref(href)
                }
                if (elem[ELEM_TYPE] ==
                    9) href = inst.prepareDailymotionHref(href);
                if (inst.options.autoplay) {
                    href += href.indexOf("?") < 0 ? "?" : "&";
                    if (elem[ELEM_TYPE] == 11) href += "autoPlay=true"; else href += "autoplay=1"
                }
                if (inst.options.loopvideo) {
                    href += href.indexOf("?") < 0 ? "?" : "&";
                    switch (elem[ELEM_TYPE]) {
                        case 3:
                            href += "loop=1&playlist=" + youtubeid;
                            break;
                        case 4:
                        case 9:
                            href += "loop=1";
                            break;
                        case 11:
                            href += "endVideoBehavior=loop";
                            break
                    }
                }
                if (elem[ELEM_TYPE] == 3) {
                    if (href.indexOf("?") < 0) href += "?wmode=transparent&rel=0"; else href += "&wmode=transparent&rel=0";
                    if (inst.options.videohidecontrols) href +=
                        "&controls=0&showinfo=0";
                    if (inst.options.mutevideo) href += "&mute=1";
                    href += "&enablejsapi=1&origin=" + document.location.protocol + "//" + document.location.hostname
                } else if (elem[ELEM_TYPE] == 4) {
                    href += href.indexOf("?") < 0 ? "?" : "&";
                    href += "api=1&player_id=html5boxiframevideo" + inst.options.curElem;
                    if (inst.options.mutevideo) href += "&muted=1"
                }
                $(".html5lightbox-video", inst.$image).html("<iframe style='margin:0;padding:0;border:0;' class='html5boxiframevideo' id='html5boxiframevideo" + inst.options.curElem + "' width='100%' height='100%' src='" +
                    href + "' frameborder='0' allow='autoplay' webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>");
                inst.$elem.show();
                if (elem[ELEM_TYPE] == 3) {
                    if (inst.options.inityoutube) {
                        inst.youtubeFinishCount = 0;
                        inst.initYoutubeFinishCallback()
                    }
                } else if (elem[ELEM_TYPE] == 4) if (inst.options.initvimeo) {
                    inst.vimeoFinishCount = 0;
                    inst.initVimeoFinishCallback()
                }
            };
            inst.initYoutubeFinishCallback = function () {
                if (typeof YT === "object" && typeof YT.Player === "function") inst.ytplayer = new YT.Player("html5boxiframevideo" + inst.options.curElem,
                    {
                        events: {
                            "onStateChange": function (event) {
                                if (event.data == YT.PlayerState.ENDED) {
                                    $(window).trigger("html5lightbox.videofinished");
                                    if (inst.autosliding) inst.gotoSlide(-1); else if (inst.options.autoclose) setTimeout(function () {
                                        inst.finish()
                                    }, inst.options.autoclosedelay)
                                }
                            }
                        }
                    }); else setTimeout(function () {
                    if (inst.youtubeFinishCount < 10) {
                        inst.youtubeFinishCount++;
                        inst.initYoutubeFinishCallback()
                    }
                }, 300)
            };
            inst.initVimeoFinishCallback = function () {
                if (typeof $f === "function") {
                    var vimeoIframe = $("#html5boxiframevideo" +
                        inst.options.curElem)[0];
                    inst.vimeoPlayer = $f(vimeoIframe);
                    inst.vimeoPlayer.addEvent("ready", function () {
                        inst.vimeoPlayer.addEvent("finish", function (id) {
                            $(window).trigger("html5lightbox.videofinished");
                            if (inst.autosliding) inst.gotoSlide(-1); else if (inst.options.autoclose) setTimeout(function () {
                                inst.finish()
                            }, inst.options.autoclosedelay)
                        })
                    })
                } else setTimeout(function () {
                    if (inst.vimeoFinishCount < 10) {
                        inst.vimeoFinishCount++;
                        inst.initVimeoFinishCallback()
                    }
                }, 300)
            };
            inst.showPDF = function (elem) {
                if (inst.options.enablepdfjs) {
                    if (inst.options.isIPhone &&
                        inst.options.openpdfinnewtaboniphone || inst.options.isIPad && inst.options.openpdfinnewtabonipad) {
                        var win = window.open(elem[ELEM_HREF], "_blank");
                        win.focus();
                        inst.finish();
                        return
                    }
                    if (!inst.options.pdfjsengine) inst.options.pdfjsengine = inst.options.jsfolder + "pdfjs/web/viewer.html";
                    var href = elem[ELEM_HREF];
                    if (href.substring(0, 5) != "http:" && href.substring(0, 6) != "https:") href = inst.absoluteUrl(href);
                    var hashindex = href.indexOf("#");
                    if (hashindex > 0) href = encodeURIComponent(href.substring(0, hashindex)) + href.substring(hashindex);
                    else href = encodeURIComponent(href);
                    var pdfelem = jQuery.extend(true, {}, elem);
                    pdfelem[ELEM_HREF] = inst.options.pdfjsengine + (inst.options.pdfjsengine.indexOf("?") < 0 ? "?" : "&") + "file=" + href;
                    inst.showWeb(pdfelem)
                } else if (inst.options.isIPhone || inst.options.isIPad || inst.options.isAndroid || inst.options.isIE || inst.options.isIE11) {
                    var win = window.open(elem[ELEM_HREF], "_blank");
                    win.focus();
                    inst.finish();
                    return
                } else inst.showWeb(elem)
            };
            inst.showMP3 = function (elem) {
            };
            inst.showDiv = function (elem) {
                inst.showTitle(elem[ELEM_TITLE],
                    elem[ELEM_DESCRIPTION]);
                var winWidth = $(window).width();
                var winH = $(window).height();
                var navH = inst.options.shownavigation && inst.navvisible ? inst.options.navheight : 0;
                var dataW = elem[ELEM_WIDTH] ? elem[ELEM_WIDTH] : inst.options.usedefaultsizeforcontent ? inst.options.defaultwidth : winWidth;
                var dataH = elem[ELEM_HEIGHT] ? elem[ELEM_HEIGHT] : inst.options.usedefaultsizeforcontent ? inst.options.defaultheight : winH - navH;
                var sizeObj = inst.calcElemSize({w: dataW, h: dataH}, false);
                dataW = sizeObj.w;
                dataH = sizeObj.h;
                inst.resizeLightbox(dataW,
                    dataH, true, function () {
                        inst.$loading.hide();
                        inst.$image.html("<div class='html5lightbox-div' id='html5lightbox-div" + inst.options.curElem + "' style='display:block;width:100%;height:" + (inst.options.autoresizecontent ? "auto" : "100%") + ";" + (inst.options.isIOS ? "-webkit-overflow-scrolling:touch;overflow-y:scroll;" : "overflow:auto;") + "'></div>").show();
                        var divID = elem[ELEM_HREF];
                        if ($(divID).length > 0) $(divID).children().appendTo($("#html5lightbox-div" + inst.options.curElem, inst.$image)); else $("#html5lightbox-div" +
                            inst.options.curElem, inst.$image).html("<div class='html5-error'>The specified div ID does not exist.</div>");
                        inst.$elem.show();
                        inst.showData();
                        if (inst.options.autoresizecontent) inst.resizeWindow();
                        if (inst.autosliding) {
                            inst.slideTimeout.stop();
                            inst.slideTimeout.start()
                        }
                    })
            };
            inst.isSameDomain = function (href) {
                if (href.substring(0, 5) != "http:" && href.substring(0, 6) != "https:") return true;
                var link = document.createElement("a");
                link.setAttribute("href", href);
                var result = link.protocol == document.location.protocol &&
                    link.host == document.location.host && link.port == document.location.port;
                link = null;
                return result
            };
            inst.showWeb = function (elem) {
                inst.showTitle(elem[ELEM_TITLE], elem[ELEM_DESCRIPTION]);
                var winWidth = $(window).width();
                var winH = $(window).height();
                var navH = inst.options.shownavigation && inst.navvisible ? inst.options.navheight : 0;
                var dataW = elem[ELEM_WIDTH] ? elem[ELEM_WIDTH] : inst.options.usedefaultsizeforcontent ? inst.options.defaultwidth : winWidth;
                var dataH = elem[ELEM_HEIGHT] ? elem[ELEM_HEIGHT] : inst.options.usedefaultsizeforcontent ?
                    inst.options.defaultheight : winH - navH;
                var sizeObj = inst.calcElemSize({w: dataW, h: dataH}, false);
                dataW = sizeObj.w;
                dataH = sizeObj.h;
                inst.resizeLightbox(dataW, dataH, true, function () {
                    inst.$image.html("<div class='html5lightbox-web' style='display:block;width:100%;height:100%;" + (inst.options.isIOS ? "-webkit-overflow-scrolling:touch;overflow-y:scroll;" : "") + "'></div>").show();
                    $(".html5lightbox-web", inst.$image).html("<iframe style='margin:0;padding:0;border:0;' class='html5lightbox-web-iframe' width='100%' height='100%' src='" +
                        elem[ELEM_HREF] + "' frameborder='0' webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>");
                    $(".html5lightbox-web-iframe", inst.$image).on("load", function () {
                        inst.$loading.hide()
                    });
                    inst.$elem.show();
                    inst.showData();
                    if (inst.options.autoresizecontent && inst.isSameDomain(elem[ELEM_HREF])) {
                        $(".html5lightbox-web-iframe", inst.$image).data("sameorigin", true);
                        $(".html5lightbox-web-iframe", inst.$image).on("load", function () {
                            $(this).data("sameoriginloaded", true);
                            inst.resizeWindow()
                        })
                    }
                    if (inst.autosliding) {
                        inst.slideTimeout.stop();
                        inst.slideTimeout.start()
                    }
                })
            };
            inst.scrollBox = function () {
            };
            inst.resizeWindow = function () {
                if (!inst.currentElem) return;
                if (!inst.options.responsive) return;
                var winWidth = $(window).width();
                var winH = $(window).height();
                if (!(inst.options.showtitle && inst.currentElem[ELEM_TITLE] && inst.currentElem[ELEM_TITLE].length > 0 || inst.options.showdescription && inst.currentElem[ELEM_DESCRIPTION] && inst.currentElem[ELEM_DESCRIPTION].length > 0 || inst.options.inGroup && (inst.options.showplaybutton || inst.options.showtitleprefix))) inst.options.barheight =
                    0;
                var elemW, elemH, keepratio;
                if (inst.currentElem[ELEM_TYPE] == 5 || inst.currentElem[ELEM_TYPE] == 7 || inst.currentElem[ELEM_TYPE] == 10) {
                    var navH = inst.options.shownavigation && inst.navvisible ? inst.options.navheight : 0;
                    elemW = inst.currentElem[ELEM_WIDTH] ? inst.currentElem[ELEM_WIDTH] : inst.options.usedefaultsizeforcontent ? inst.options.defaultwidth : winWidth;
                    elemH = inst.currentElem[ELEM_HEIGHT] ? inst.currentElem[ELEM_HEIGHT] : inst.options.usedefaultsizeforcontent ? inst.options.defaultheight : winH - navH;
                    keepratio = false
                } else {
                    elemW =
                        inst.currentElem[ELEM_WIDTH] ? inst.currentElem[ELEM_WIDTH] : inst.options.defaultwidth;
                    elemH = inst.currentElem[ELEM_HEIGHT] ? inst.currentElem[ELEM_HEIGHT] : inst.options.defaultheight;
                    if (inst.currentElem[ELEM_TYPE] == 0) keepratio = inst.options.imagekeepratio; else keepratio = true
                }
                var sizeObj = inst.calcElemSize({w: elemW, h: elemH}, keepratio);
                inst.adjustLightboxPos(sizeObj.w, sizeObj.h);
                inst.adjustDataHeight();
                if (inst.options.autoresizecontent && (inst.currentElem[ELEM_TYPE] == 5 || inst.currentElem[ELEM_TYPE] == 7 || inst.currentElem[ELEM_TYPE] ==
                        10)) {
                    var resizeHeight = false;
                    if (inst.currentElem[ELEM_TYPE] == 7 && $(".html5lightbox-web-iframe", inst.$lightbox).length > 0 && $(".html5lightbox-web-iframe", inst.$lightbox).data("sameoriginloaded")) {
                        var iframe = $(".html5lightbox-web-iframe", inst.$lightbox)[0];
                        if (iframe && iframe.contentWindow && iframe.contentWindow.document && iframe.contentWindow.document.documentElement.offsetHeight) if (elemH > iframe.contentWindow.document.documentElement.offsetHeight) {
                            elemH = iframe.contentWindow.document.documentElement.offsetHeight;
                            resizeHeight = true
                        }
                    } else if (inst.currentElem[ELEM_TYPE] == 10 && $(".html5lightbox-div", inst.$lightbox).length > 0) {
                        var divH = $(".html5lightbox-div", inst.$lightbox).height();
                        if (elemH > divH) {
                            elemH = divH;
                            resizeHeight = true
                        }
                    }
                    if (resizeHeight) {
                        sizeObj = inst.calcElemSize({w: elemW, h: elemH}, keepratio);
                        inst.adjustLightboxPos(sizeObj.w, sizeObj.h)
                    }
                }
                if ($(".html5-nav").length <= 0) return;
                $(".html5-nav-list").css({"margin-left": 0});
                var $navMask = $(".html5-nav-mask");
                var $navPrev = $(".html5-nav-prev");
                var $navNext = $(".html5-nav-next");
                var winWidth = $(window).width();
                if (inst.options.totalwidth <= winWidth) {
                    $navMask.css({width: inst.options.totalwidth + "px"});
                    $navPrev.hide();
                    $navNext.hide()
                } else {
                    $navMask.css({width: winWidth - 2 * inst.options.navbuttonwidth + "px"});
                    $navPrev.show();
                    $navNext.show()
                }
            };
            inst.calcElemSize = function (sizeObj, keepratio) {
                if (!inst.options.responsive) return sizeObj;
                var winWidth = $(window).width();
                var winH = $(window).height();
                winH = winH ? winH : $(document).height();
                if (inst.options.resizeleftright && (inst.options.titlestyle == "left" ||
                        inst.options.titlestyle == "right") && winWidth > inst.options.sidetobottomscreenwidth) sizeObj.w = sizeObj.w * 100 / inst.options.imagepercentage;
                var navH = inst.options.shownavigation && inst.navvisible ? inst.options.navheight : 0;
                var topmargin = $(window).height() < inst.options.smallscreenheight ? inst.options.bordertopmarginsmall : inst.options.bordertopmargin;
                var h0 = winH - navH - 2 * inst.options.bordersize - 2 * topmargin;
                if (inst.options.responsivebarheight) if (winH <= inst.options.smallscreenheight) inst.options.barheight = inst.options.barheightonsmallheight;
                else inst.options.barheight = inst.options.barheightoriginal;
                if (inst.options.titlestyle == "bottom") h0 -= inst.options.barheight; else if (inst.options.titlestyle == "outside") h0 -= inst.$elemData.outerHeight();
                var w0 = winWidth - 2 * inst.options.bordersize - 2 * inst.options.bordermargin;
                if (inst.options.resizeleftright && (inst.options.titlestyle == "left" || inst.options.titlestyle == "right") && winWidth > inst.options.sidetobottomscreenwidth) w0 -= 2 * inst.options.bordersize;
                if (inst.options.fullscreenmode && winWidth > inst.options.navarrowsbottomscreenwidth ||
                    (inst.options.isTouch && inst.options.navarrowsalwaysshowontouch || inst.options.alwaysshownavarrows) && winWidth > inst.options.navarrowsbottomscreenwidth) w0 -= 64;
                if (inst.options.notkeepratioonsmallheight && winH <= inst.options.smallscreenheight) keepratio = false;
                if (inst.currentElem[ELEM_TYPE] == 0 && keepratio) {
                    var ratio = inst.currentElem[ELEM_ORIGINALWIDTH] / inst.currentElem[ELEM_ORIGINALHEIGHT];
                    if (inst.options.resizeleftright && (inst.options.titlestyle == "left" || inst.options.titlestyle == "right") && winWidth > inst.options.sidetobottomscreenwidth) ratio *=
                        100 / inst.options.imagepercentage;
                    sizeObj.h = Math.round(sizeObj.w / ratio);
                    if (sizeObj.h > h0) {
                        sizeObj.w = Math.round(ratio * h0);
                        sizeObj.h = h0
                    }
                    if (sizeObj.w > w0) {
                        sizeObj.h = Math.round(w0 / ratio);
                        sizeObj.w = w0
                    }
                } else {
                    if (sizeObj.h > h0) {
                        if (keepratio) sizeObj.w = Math.round(sizeObj.w * h0 / sizeObj.h);
                        sizeObj.h = h0
                    } else if (inst.options.maxheight) sizeObj.h = h0;
                    if (sizeObj.w > w0) {
                        if (keepratio) sizeObj.h = Math.round(sizeObj.h * w0 / sizeObj.w);
                        sizeObj.w = w0
                    }
                }
                if (inst.options.resizeleftright && (inst.options.titlestyle == "left" || inst.options.titlestyle ==
                        "right") && winWidth > inst.options.sidetobottomscreenwidth) sizeObj.w += 2 * inst.options.bordersize;
                return sizeObj
            };
            inst.adjustDataHeight = function () {
                var winWidth = $(window).width();
                var winH = $(window).height();
                var isBottomText = inst.options.titlestyle == "bottom" || inst.options.titlestyle == "outside" || (inst.options.titlestyle == "left" || inst.options.titlestyle == "right") && winWidth <= inst.options.sidetobottomscreenwidth;
                if (inst.options.responsivebarheight) if (winH <= inst.options.smallscreenheight) inst.options.barheight =
                    inst.options.barheightonsmallheight; else inst.options.barheight = inst.options.barheightoriginal;
                if (isBottomText) {
                    var topmargin = $(window).height() < inst.options.smallscreenheight ? inst.options.bordertopmarginsmall : inst.options.bordertopmargin;
                    var navH = inst.options.shownavigation && inst.navvisible ? inst.options.navheight : 0;
                    var winH = $(window).height();
                    var maxH = winH - topmargin - navH;
                    var barHeight = inst.options.barautoheight ? inst.$elemData.outerHeight() : inst.options.barheight;
                    var totalHeight = inst.$elemWrap.outerHeight() +
                        barHeight;
                    var elemHeight = Math.min(maxH, totalHeight);
                    var boxMargin = (winH - navH - elemHeight) / 2;
                    inst.$elem.css({"max-height": elemHeight + "px"});
                    inst.$lightboxBox.css({"margin-top": boxMargin + "px"})
                } else inst.$elem.css({"max-height": "none"});
                if (inst.options.titlestyle == "bottom" || inst.options.titlestyle == "inside") inst.$lightboxBox.css({height: "auto"});
                if (inst.options.positionFixed) $("#html5-lightbox-overlay", inst.$lightbox).css({height: Math.max($(window).height(), $(document).height())}); else $("#html5-lightbox-overlay",
                    inst.$lightbox).css({height: "100%"})
            };
            inst.showData = function () {
                if (inst.$text.text().length > 0) inst.$elemData.show();
                inst.adjustDataHeight();
                $(window).trigger("html5lightbox.lightboxopened")
            };
            inst.resizeLightbox = function (elemW, elemH, bAnimate, onFinish) {
                inst.hideNavArrows();
                var boxPos = inst.calcBoxPosition(elemW, elemH);
                var boxW = boxPos[0];
                var boxH = boxPos[1];
                var boxT = boxPos[2];
                inst.$loading.hide();
                inst.$watermark.hide();
                if (inst.options.nextElem <= inst.options.curElem) if (inst.options.onlastitem && window[inst.options.onlastitem] &&
                    typeof window[inst.options.onlastitem] == "function") window[inst.options.onlastitem](inst.currentElem);
                if (inst.options.prevElem >= inst.options.curElem) if (inst.options.onfirstitem && window[inst.options.onfirstitem] && typeof window[inst.options.onfirstitem] == "function") window[inst.options.onfirstitem](inst.currentElem);
                if (!inst.options.fullscreenmode && (!inst.options.isTouch || !inst.options.navarrowsalwaysshowontouch) && !inst.options.alwaysshownavarrows) {
                    inst.$lightboxBox.on("mouseenter mousemove", function () {
                        if (inst.options.arrowloop &&
                            inst.options.prevElem >= 0 || !inst.options.arrowloop && inst.options.prevElem >= 0 && inst.options.prevElem < inst.options.curElem) inst.$prev.fadeIn();
                        if (inst.options.arrowloop && inst.options.nextElem >= 0 || !inst.options.arrowloop && inst.options.nextElem >= 0 && inst.options.nextElem > inst.options.curElem) inst.$next.fadeIn()
                    });
                    inst.$lightboxBox.on("mouseleave", function () {
                        inst.$next.fadeOut();
                        inst.$prev.fadeOut()
                    })
                }
                var existingBoxT = parseInt(inst.$lightboxBox.css("margin-top"));
                inst.$lightboxBox.css({"margin-top": boxT});
                inst.resizePositionFixed();
                var speed = bAnimate ? inst.options.resizespeed : 0;
                if (inst.options.fullscreenmode && inst.options.fullscreennotransition) speed = 0;
                if ((inst.options.transition == "slide" || inst.options.transition == "crossfade") && inst.existingElem >= 0) speed = 0;
                var winWidth = $(window).width();
                if ((inst.options.titlestyle == "left" || inst.options.titlestyle == "right") && winWidth > inst.options.sidetobottomscreenwidth) {
                    if (boxW == inst.$lightboxBox.width() && boxH == inst.$lightboxBox.height()) speed = 0;
                    inst.$lightboxBox.animate({width: boxW},
                        speed).animate({height: boxH}, speed, function () {
                        inst.onAnimateFinish(onFinish)
                    })
                } else {
                    if (boxW == inst.$elemWrap.width() && boxH == inst.$elemWrap.height()) speed = 0;
                    inst.$lightboxBox.css({"width": boxW, "height": "auto"});
                    inst.$elemWrap.animate({width: boxW}, speed).animate({height: boxH}, speed, function () {
                        inst.onAnimateFinish(onFinish)
                    })
                }
            };
            inst.onAnimateFinish = function (onFinish) {
                inst.$loading.show();
                inst.$watermark.show();
                inst.$close.show();
                inst.$elem.css({"background-color": inst.options.bgcolor});
                inst.resizePositionFixed();
                onFinish();
                inst.finishCallback()
            };
            inst.finishCallback = function () {
                if ((inst.options.transition == "slide" || inst.options.transition == "crossfade") && inst.existingElem >= 0) if (inst.options.transition == "slide") {
                    inst.$prevelem.animate({
                        left: inst.direction == -1 ? "-100%" : "100%",
                        opacity: 0
                    }, {duration: inst.options.transitionduration});
                    inst.$elem.animate({left: 0, opacity: 1}, {
                        duration: inst.options.transitionduration, always: function () {
                            inst.$prevelem.remove();
                            inst.$elem.removeClass("html5-elem-box-current").css({
                                position: "relative",
                                height: "100%"
                            })
                        }
                    })
                } else {
                    inst.$prevelem.animate({opacity: 0}, {duration: inst.options.transitionduration});
                    inst.$elem.animate({opacity: 1}, {
                        duration: inst.options.transitionduration, always: function () {
                            inst.$prevelem.remove();
                            inst.$elem.removeClass("html5-elem-box-current").css({position: "relative", height: "100%"})
                        }
                    })
                }
            }, inst.resetDiv = function (elemID) {
                if (inst.elemArray.length > 0 && elemID >= 0) if (inst.elemArray[elemID][ELEM_TYPE] == 10) {
                    var divID = inst.elemArray[elemID][ELEM_HREF];
                    if ($(divID).length > 0) $("#html5lightbox-div" +
                        elemID).children().appendTo($(divID))
                }
            };
            inst.reset = function () {
                if (inst.options.stamp) inst.$watermark.hide();
                inst.showing = false;
                inst.$image.empty();
                inst.$text.empty();
                inst.$error.hide();
                inst.$loading.hide();
                inst.$image.hide();
                if (inst.options.titlestyle == "bottom" || inst.options.titlestyle == "inside") inst.$elemData.hide();
                if (!inst.options.fullscreenmode) inst.$close.hide();
                inst.$elem.css({"background-color": ""})
            };
            inst.resetNavigation = function () {
                inst.options.navheight = 0;
                $(".html5-nav").remove();
                inst.navvisible =
                    false
            };
            inst.finish = function () {
                if (inst.options.exitanimation == "fadeOut" || inst.options.exitanimation == "fadeOutDown") {
                    inst.$lightbox.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend", function () {
                        inst.$lightboxBox.removeClass("html5box-animated html5box-" + inst.options.exitanimation);
                        inst.$lightbox.removeClass("html5box-animated html5box-fadeOut");
                        inst.finishDone()
                    });
                    inst.$lightbox.addClass("html5box-animated html5box-fadeOut");
                    inst.$lightboxBox.addClass("html5box-animated html5box-" +
                        inst.options.exitanimation)
                } else inst.finishDone()
            };
            inst.finishDone = function () {
                inst.existingElem = -1;
                inst.resetDiv(inst.options.curElem);
                if ($(".html5-lightbox-video", inst.$lightbox).length) $(".html5-lightbox-video", inst.$lightbox).attr("src", "");
                $("head").find("style").each(function () {
                    if ($(this).data("creator") == "html5box-html5-lightbox") $(this).remove()
                });
                if (inst.options.bodynoscroll) $("html,body").removeClass("bodynoscroll");
                inst.slideTimeout.stop();
                inst.reset();
                inst.resetNavigation();
                inst.$lightbox.remove();
                $("#html5box-html5-lightbox").remove();
                inst.showObjects();
                if (inst.options.oncloselightbox && window[inst.options.oncloselightbox] && typeof window[inst.options.oncloselightbox] == "function") window[inst.options.oncloselightbox](inst.currentElem);
                if (inst.onLightboxClosed && typeof inst.onLightboxClosed == "function") inst.onLightboxClosed(inst.currentElem);
                $(window).trigger("html5lightbox.lightboxclosed")
            };
            inst.pauseSlide = function () {
            };
            inst.playSlide = function () {
            };
            inst.gotoSlide = function (slide) {
                inst.existingElem =
                    inst.options.curElem;
                inst.direction = slide;
                inst.resetDiv(inst.options.curElem);
                if (slide == -1) {
                    if (inst.options.nextElem < 0) return;
                    inst.options.curElem = inst.options.nextElem
                } else if (slide == -2) {
                    if (inst.options.prevElem < 0) return;
                    inst.options.curElem = inst.options.prevElem
                } else if (slide >= 0) {
                    inst.direction = slide > inst.options.curElem ? -1 : -2;
                    inst.options.curElem = slide
                }
                if (inst.autosliding) inst.slideTimeout.stop();
                inst.calcNextPrevElem();
                if (inst.options.transition != "slide" && inst.options.transition != "crossfade") inst.reset();
                inst.loadCurElem();
                if (inst.options.titlestyle == "inside" && inst.options.showonmouseoverinside && inst.currentElem[ELEM_TYPE] !== 0 && inst.options.showinsidetitleforimageonly) inst.$elemData.css({opacity: 0})
            };
            inst.enableSwipe = function () {
                var preventDefault = inst.options.isAndroid && (inst.options.swipepreventdefaultonandroid || inst.options.androidVersion >= 0 && inst.options.androidVersion <= 5) ? true : false;
                inst.$lightboxBox.html5lightboxTouchSwipe({
                    preventWebBrowser: preventDefault, swipeDistance: inst.options.swipedistance,
                    swipeLeft: function () {
                        inst.gotoSlide(-1)
                    }, swipeRight: function () {
                        inst.gotoSlide(-2)
                    }
                })
            };
            inst.hideObjects = function () {
                $("select, embed, object").css({"visibility": "hidden"})
            };
            inst.showObjects = function () {
                $("select, embed, object").css({"visibility": "visible"})
            };
            inst.embedHTML5Video = function ($container, src, autoplay, loopvideo, mutevideo) {
                $container.html("<div style='display:block;width:100%;height:100%;position:relative;'><video class='html5-lightbox-video' width='100%' height='100%'" + (inst.options.html5videoposter &&
                inst.options.html5videoposter.length > 0 ? "poster='" + inst.options.html5videoposter + "'" : "") + (autoplay ? " autoplay" : "") + (loopvideo ? " loop" : "") + (mutevideo ? " muted" : "") + (inst.options.nativehtml5controls && !inst.options.videohidecontrols ? " controls='controls'" : "") + (inst.options.nativecontrolsnodownload ? ' controlsList="nodownload"' : "") + " src='" + src + "'></div>");
                if (mutevideo) inst.options.defaultvideovolume = 0;
                if (!inst.options.nativehtml5controls && !inst.options.videohidecontrols) {
                    $("video", $container).data("src",
                        src);
                    $("video", $container).lightboxHTML5VideoControls(inst.options.skinsfolder, inst, ".html5-lightbox-video", inst.options.videohidecontrols, false, inst.options.defaultvideovolume, inst.options.nativecontrolsonfullscreen, inst.options.nativecontrolsnodownload, null)
                }
                $("video", $container).off("ended").on("ended", function () {
                    $(window).trigger("html5lightbox.videofinished");
                    if (inst.autosliding) inst.gotoSlide(-1); else if (inst.options.autoclose) setTimeout(function () {
                        inst.finish()
                    }, inst.options.autoclosedelay)
                })
            };
            inst.embedFlash = function ($container, src, wmode, flashVars) {
                if (inst.options.flashInstalled) {
                    var htmlOptions = {
                        pluginspage: "http://www.adobe.com/go/getflashplayer",
                        quality: "high",
                        allowFullScreen: "true",
                        allowScriptAccess: "always",
                        type: "application/x-shockwave-flash"
                    };
                    htmlOptions.width = "100%";
                    htmlOptions.height = "100%";
                    htmlOptions.src = src;
                    htmlOptions.flashVars = $.param(flashVars);
                    htmlOptions.wmode = wmode;
                    var htmlString = "";
                    for (var key in htmlOptions) htmlString += key + "=" + htmlOptions[key] + " ";
                    $container.html("<embed " +
                        htmlString + "/>")
                } else $container.html("<div class='html5lightbox-flash-error' style='display:block; position:relative;text-align:center; width:100%; left:0px; top:40%;'><div class='html5-error'><div>The required Adobe Flash Player plugin is not installed</div><br /><div style='display:block;position:relative;text-align:center;width:112px;height:33px;margin:0px auto;'><a href='http://www.adobe.com/go/getflashplayer'><img src='http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif' alt='Get Adobe Flash player' width='112' height='33'></img></a></div></div>")
            };
            inst.checkType = function (href) {
                if (!href) return -1;
                if (href.match(/\.(jpg|gif|png|bmp|jpeg)(.*)?$/i)) return 0;
                if (href.match(/[^\.]\.(swf)\s*$/i)) return 1;
                if (href.match(/\.(mp4|m4v|ogv|ogg|webm)(.*)?$/i)) return 2;
                if (href.match(/\:\/\/.*(youtube\.com)/i) || href.match(/\:\/\/.*(youtu\.be)/i)) return 3;
                if (href.match(/\:\/\/.*(vimeo\.com)/i)) return 4;
                if (href.match(/\:\/\/.*(dailymotion\.com)/i) || href.match(/\:\/\/.*(dai\.ly)/i)) return 9;
                if (href.match(/[^\.]\.(pdf)/i)) return 5;
                if (href.match(/[^\.]\.(mp3)\s*$/i)) return 6;
                if (href.match(/[^\.]\.(flv)\s*$/i)) return 8;
                if (href.match(/\#\w+/i)) return 10;
                if (href.match(/\:\/\/.*(wistia)/i)) return 11;
                return 7
            };
            inst.getURLParams = function () {
                var result = {};
                var params = window.location.search.substring(1).split("&");
                for (var i = 0; i < params.length; i++) {
                    var value = params[i].split("=");
                    if (value && value.length == 2) result[value[0].toLowerCase()] = unescape(value[1])
                }
                return result
            };
            inst.absoluteUrl = function (href) {
                var link = document.createElement("a");
                link.href = href;
                return link.protocol + "//" + link.host +
                    link.pathname + link.search + link.hash
            };
            inst.showLightboxObject = function (obj) {
                if (obj) inst.showLightbox(obj.type, obj.href, obj.title, obj.width, obj.height, obj.webm, obj.ogg, obj.thumbnail, obj.description, obj.div, obj.originalwidth, obj.originalheight, obj.socialmedia, obj.weblink, obj.weblinktarget, obj.weblinktext, obj.group)
            };
            inst.showLightbox = function (type, href, title, width, height, webm, ogg, thumbnail, description, div, originalwidth, originalheight, socialmedia, weblink, weblinktarget, weblinktext, group) {
                inst.options =
                    $.extend(inst.options, inst.defaultoptions);
                $(window).trigger("html5lightbox.lightboxshow");
                inst.init();
                inst.reset();
                inst.$lightbox.show();
                inst.adjustLightboxPos(inst.options.loadingwidth, inst.options.loadingheight);
                inst.loadElem(new Array(type, href, title, group, width, height, webm, ogg, thumbnail, description, div, originalwidth, originalheight, socialmedia, weblink, weblinktarget, weblinktext))
            };
            inst.addItemNoDuplicate = function (href, title, group, width, height, webm, ogg, thumbnail, description, mediatype) {
                for (var i =
                    0; i < inst.elemArray.length; i++) if (inst.elemArray[i][ELEM_HREF] == href) return;
                inst.addItem(href, title, group, width, height, webm, ogg, thumbnail, description, mediatype)
            };
            inst.addItem = function (href, title, group, width, height, webm, ogg, thumbnail, description, mediatype) {
                type = mediatype && mediatype >= 0 ? mediatype : inst.checkType(href);
                inst.elemArray.push(new Array(type, href, title, group, width, height, webm, ogg, thumbnail, description))
            };
            inst.showItem = function (href) {
                inst.options = $.extend(inst.options, inst.defaultoptions);
                $(window).trigger("html5lightbox.lightboxshow");
                inst.init();
                if (inst.elemArray.length <= 0) return true;
                inst.hideObjects();
                for (var i = 0; i < inst.elemArray.length; i++) if (inst.elemArray[i][ELEM_HREF] == href) break;
                if (i == inst.elemArray.length) return true;
                inst.options.curElem = i;
                inst.calcNextPrevElem();
                inst.reset();
                inst.$lightbox.show();
                inst.adjustLightboxPos(inst.options.loadingwidth, inst.options.loadingheight);
                inst.loadCurElem();
                return false
            };
            inst.each(function () {
                var self = $(this);
                var nodeName = this.nodeName.toLowerCase();
                if (nodeName == "a" || nodeName == "area") self.off("click").click(inst.clickHandler);
                else self.find("a,area").each(function () {
                    $(this).off("click").click(inst.clickHandler)
                });
                var autoopen = false;
                var autoopendelay = 0;
                var autoopenonce = false;
                var autoopenonceexpire = 0;
                if (typeof html5lightbox_options != "undefined" && html5lightbox_options) {
                    if ("autoopen" in html5lightbox_options) autoopen = html5lightbox_options.autoopen;
                    if ("autoopendelay" in html5lightbox_options) autoopendelay = html5lightbox_options.autoopendelay;
                    if ("autoopenonce" in html5lightbox_options) autoopenonce = html5lightbox_options.autoopenonce;
                    if ("autoopenonceexpire" in html5lightbox_options) autoopenonceexpire = html5lightbox_options.autoopenonceexpire
                }
                autoopen = self.data("autoopen") ? self.data("autoopen") : autoopen;
                autoopendelay = self.data("autoopendelay") ? self.data("autoopendelay") : autoopendelay;
                autoopenonce = self.data("autoopenonce") ? self.data("autoopenonce") : autoopenonce;
                autoopenonceexpire = self.data("autoopenonceexpire") ? self.data("autoopenonceexpire") : autoopenonceexpire;
                autocookie = "html5lightboxpopup=1;path=/";
                if (autoopenonceexpire > 0) {
                    var expires =
                        new Date;
                    expires.setTime(expires.getTime() + autoopenonceexpire * 60 * 60 * 1E3);
                    autocookie += ";expires=" + expires.toUTCString()
                }
                if (autoopen) {
                    var is_popped = false;
                    if (autoopenonce) {
                        var cookies = document.cookie ? document.cookie.split(";") : [];
                        for (var i in cookies) {
                            var parts = $.trim(cookies[i]).split("=");
                            if (parts.length && parts[0] == "html5lightboxpopup") {
                                is_popped = true;
                                break
                            }
                        }
                    }
                    if (!is_popped) {
                        setTimeout(function () {
                            self.click();
                            document.cookie = autocookie
                        }, autoopendelay);
                        return false
                    }
                }
                if (self.data("preloadonpageload")) {
                    var fileType =
                        "mediatype" in self.data() ? self.data("mediatype") : inst.checkType(self.attr("href"));
                    if (fileType == 0) {
                        var preloaddelay = self.data("preloaddelay") ? self.data("preloaddelay") : 0;
                        setTimeout(function () {
                            (new Image).src = self.attr("href")
                        }, preloaddelay)
                    }
                }
            });
            var urlParams = inst.getURLParams();
            if ("html5lightboxshare" in urlParams) {
                var shareUrl = decodeURIComponent(urlParams["html5lightboxshare"]);
                var shareLink = $('.html5lightbox[href="' + shareUrl + '"]');
                if (shareLink.length > 0) shareLink.click()
            }
            if (inst.options.preloadallonpageload) setTimeout(function () {
                inst.each(function () {
                    if (this.nodeName.toLowerCase() !=
                        "a" && this.nodeName.toLowerCase() != "area") return;
                    var fileType = "mediatype" in $(this).data() ? $(this).data("mediatype") : inst.checkType($(this).attr("href"));
                    if (fileType !== 0) return;
                    (new Image).src = $(this).attr("href");
                    if ($(this).data("thumbnail")) (new Image).src = $(this).data("thumbnail")
                })
            }, inst.options.preloadalldelay);
            return inst
        }
    })(jQuery);
    (function ($) {
        $.fn.html5lightboxTouchSwipe = function (options) {
            var defaults = {
                preventWebBrowser: false,
                swipeDistance: 0,
                swipeLeft: null,
                swipeRight: null,
                swipeTop: null,
                swipeBottom: null
            };
            if (options) $.extend(defaults, options);
            return this.each(function () {
                var startX = -1, startY = -1;
                var curX = -1, curY = -1;

                function touchStart(event) {
                    var e = event.originalEvent;
                    if (e.targetTouches.length >= 1) {
                        startX = e.targetTouches[0].pageX;
                        startY = e.targetTouches[0].pageY
                    } else touchCancel(event)
                }

                function touchMove(event) {
                    if (defaults.preventWebBrowser) event.preventDefault();
                    var e = event.originalEvent;
                    if (e.targetTouches.length >= 1) {
                        curX = e.targetTouches[0].pageX;
                        curY = e.targetTouches[0].pageY
                    } else touchCancel(event)
                }

                function touchEnd(event) {
                    if (curX >
                        0 || curY > 0) {
                        triggerHandler();
                        touchCancel(event)
                    } else touchCancel(event)
                }

                function touchCancel(event) {
                    startX = -1;
                    startY = -1;
                    curX = -1;
                    curY = -1
                }

                function triggerHandler() {
                    if (Math.abs(curX - startX) > Math.abs(curY - startY)) {
                        if (Math.abs(curX - startX) > defaults.swipeDistance) if (curX > startX) {
                            if (defaults.swipeRight) defaults.swipeRight.call()
                        } else if (defaults.swipeLeft) defaults.swipeLeft.call()
                    } else if (Math.abs(curY - startY) > defaults.swipeDistance) if (curY > startY) {
                        if (defaults.swipeBottom) defaults.swipeBottom.call()
                    } else if (defaults.swipeTop) defaults.swipeTop.call()
                }

                try {
                    $(this).on("touchstart", touchStart);
                    $(this).on("touchmove", touchMove);
                    $(this).on("touchend", touchEnd);
                    $(this).on("touchcancel", touchCancel)
                } catch (e) {
                }
            })
        }
    })(jQuery);
    (function ($) {
        $.fn.lightboxHTML5VideoControls = function (skinFolder, parentInst, videoElem, hideControls, hidePlayButton, defaultVolume, fullscreenNativeControls, html5VideoNoDownload, skinImages) {
            var isTouch = "ontouchstart" in window;
            var eStart = isTouch ? "touchstart" : "mousedown";
            var eMove = isTouch ? "touchmove" : "mousemove";
            var eCancel = isTouch ? "touchcancel" :
                "mouseup";
            var eClick = "click";
            var BUTTON_SIZE = 32;
            var BAR_HEIGHT = isTouch ? 48 : 36;
            var hideControlsTimerId = null;
            var hideVolumeBarTimeoutId = null;
            var sliderDragging = false;
            var isFullscreen = false;
            var userActive = true;
            var isHd = $(this).data("ishd");
            var hd = $(this).data("hd");
            var src = $(this).data("src");
            var $videoObj = $(this);
            $videoObj.get(0).removeAttribute("controls");
            var $videoPlay = $("<div class='html5boxVideoPlay'></div>");
            $videoObj.after($videoPlay);
            var playbuttonImage = skinImages && "playbutton" in skinImages &&
            skinImages.playbutton.length > 0 ? skinImages.playbutton : skinFolder + "html5boxplayer_playvideo.png";
            $videoPlay.css({
                position: "absolute",
                top: "50%",
                left: "50%",
                display: "block",
                cursor: "pointer",
                width: 64,
                height: 64,
                "margin-left": -32,
                "margin-top": -32,
                "background-image": "url('" + playbuttonImage + "')",
                "background-position": "center center",
                "background-repeat": "no-repeat"
            }).on(eClick, function () {
                $videoObj.get(0).play()
            });
            var $videoFullscreenBg = $("<div class='html5boxVideoFullscreenBg'></div>");
            var $videoControls = $("<div class='html5boxVideoControls'>" +
                "<div class='html5boxVideoControlsBg'></div>" + "<div class='html5boxPlayPause'>" + "<div class='html5boxPlay'></div>" + "<div class='html5boxPause'></div>" + "</div>" + "<div class='html5boxTimeCurrent'>--:--</div>" + "<div class='html5boxFullscreen'></div>" + "<div class='html5boxHD'></div>" + "<div class='html5boxVolume'>" + "<div class='html5boxVolumeButton'></div>" + "<div class='html5boxVolumeBar'>" + "<div class='html5boxVolumeBarBg'>" + "<div class='html5boxVolumeBarActive'></div>" + "</div>" + "</div>" + "</div>" + "<div class='html5boxTimeTotal'>--:--</div>" +
                "<div class='html5boxSeeker'>" + "<div class='html5boxSeekerBuffer'></div>" + "<div class='html5boxSeekerPlay'></div>" + "<div class='html5boxSeekerHandler'></div>" + "</div>" + "<div style='clear:both;'></div>" + "</div>");
            $videoObj.after($videoControls);
            $videoObj.after($videoFullscreenBg);
            $videoFullscreenBg.css({display: "none", position: "fixed", left: 0, top: 0, bottom: 0, right: 0});
            $videoControls.css({
                display: "block",
                position: "absolute",
                width: "100%",
                height: BAR_HEIGHT,
                left: 0,
                bottom: 0,
                right: 0,
                margin: "0 auto"
            });
            var userActivate =
                function () {
                    userActive = true
                };
            $videoObj.on("touch click mousemove mouseenter", function () {
                userActive = true
            });
            if (!hideControls) setInterval(function () {
                if (userActive) {
                    $videoControls.show();
                    userActive = false;
                    clearTimeout(hideControlsTimerId);
                    hideControlsTimerId = setTimeout(function () {
                        if (!$videoObj.get(0).paused) $videoControls.fadeOut()
                    }, 5E3)
                }
            }, 250);
            $(".html5boxVideoControlsBg", $videoControls).css({
                display: "block",
                position: "absolute",
                width: "100%",
                height: "100%",
                left: 0,
                top: 0,
                "background-color": "#000000",
                opacity: 0.7,
                filter: "alpha(opacity=70)"
            });
            $(".html5boxPlayPause", $videoControls).css({
                display: "block",
                position: "relative",
                width: BUTTON_SIZE + "px",
                height: BUTTON_SIZE + "px",
                margin: Math.floor((BAR_HEIGHT - BUTTON_SIZE) / 2),
                "float": "left"
            });
            var $videoBtnPlay = $(".html5boxPlay", $videoControls);
            var $videoBtnPause = $(".html5boxPause", $videoControls);
            $videoBtnPlay.css({
                display: "block",
                position: "absolute",
                top: 0,
                left: 0,
                width: BUTTON_SIZE + "px",
                height: BUTTON_SIZE + "px",
                cursor: "pointer",
                "background-image": "url('" + skinFolder + "html5boxplayer_playpause.png" +
                "')",
                "background-position": "top left"
            }).hover(function () {
                $(this).css({"background-position": "bottom left"})
            }, function () {
                $(this).css({"background-position": "top left"})
            }).on(eClick, function () {
                $videoObj.get(0).play()
            });
            $videoBtnPause.css({
                display: "none",
                position: "absolute",
                top: 0,
                left: 0,
                width: BUTTON_SIZE + "px",
                height: BUTTON_SIZE + "px",
                cursor: "pointer",
                "background-image": "url('" + skinFolder + "html5boxplayer_playpause.png" + "')",
                "background-position": "top right"
            }).hover(function () {
                    $(this).css({"background-position": "bottom right"})
                },
                function () {
                    $(this).css({"background-position": "top right"})
                }).on(eClick, function () {
                $videoObj.get(0).pause()
            });
            var $videoTimeCurrent = $(".html5boxTimeCurrent", $videoControls);
            var $videoTimeTotal = $(".html5boxTimeTotal", $videoControls);
            var $videoSeeker = $(".html5boxSeeker", $videoControls);
            var $videoSeekerPlay = $(".html5boxSeekerPlay", $videoControls);
            var $videoSeekerBuffer = $(".html5boxSeekerBuffer", $videoControls);
            var $videoSeekerHandler = $(".html5boxSeekerHandler", $videoControls);
            $videoTimeCurrent.css({
                display: "block",
                position: "relative",
                "float": "left",
                "line-height": BAR_HEIGHT + "px",
                "font-weight": "normal",
                "font-size": "12px",
                margin: "0 8px",
                "font-family": "Arial, Helvetica, sans-serif",
                color: "#fff"
            });
            $videoTimeTotal.css({
                display: "block",
                position: "relative",
                "float": "right",
                "line-height": BAR_HEIGHT + "px",
                "font-weight": "normal",
                "font-size": "12px",
                margin: "0 8px",
                "font-family": "Arial, Helvetica, sans-serif",
                color: "#fff"
            });
            $videoSeeker.css({
                display: "block", cursor: "pointer", overflow: "hidden", position: "relative", height: "10px",
                "background-color": "#222", margin: Math.floor((BAR_HEIGHT - 10) / 2) + "px 4px"
            }).on(eStart, function (e) {
                var e0 = isTouch ? e.originalEvent.touches[0] : e;
                var pos = e0.pageX - $videoSeeker.offset().left;
                $videoSeekerPlay.css({width: pos});
                $videoObj.get(0).currentTime = pos * $videoObj.get(0).duration / $videoSeeker.width();
                $videoSeeker.on(eMove, function (e) {
                    var e0 = isTouch ? e.originalEvent.touches[0] : e;
                    var pos = e0.pageX - $videoSeeker.offset().left;
                    $videoSeekerPlay.css({width: pos});
                    $videoObj.get(0).currentTime = pos * $videoObj.get(0).duration /
                        $videoSeeker.width()
                })
            }).on(eCancel, function () {
                $videoSeeker.off(eMove)
            });
            $videoSeekerBuffer.css({
                display: "block",
                position: "absolute",
                left: 0,
                top: 0,
                height: "100%",
                "background-color": "#444"
            });
            $videoSeekerPlay.css({
                display: "block",
                position: "absolute",
                left: 0,
                top: 0,
                height: "100%",
                "background-color": "#fcc500"
            });
            var $videoFSObj = fullscreenNativeControls ? $videoObj : $videoObj.parent();
            if ($videoFSObj.get(0).requestFullscreen || $videoFSObj.get(0).webkitRequestFullScreen || $videoFSObj.get(0).mozRequestFullScreen || $videoFSObj.get(0).webkitEnterFullScreen ||
                $videoFSObj.get(0).msRequestFullscreen) {
                var switchScreen = function (fullscreen) {
                    if (fullscreen) {
                        if (fullscreenNativeControls) {
                            $videoObj.get(0).setAttribute("controls", "controls");
                            if (html5VideoNoDownload) $videoObj.get(0).setAttribute("controlsList", "nodownload")
                        }
                        if ($videoFSObj.get(0).requestFullscreen) $videoFSObj.get(0).requestFullscreen(); else if ($videoFSObj.get(0).webkitRequestFullScreen) $videoFSObj.get(0).webkitRequestFullScreen(); else if ($videoFSObj.get(0).mozRequestFullScreen) $videoFSObj.get(0).mozRequestFullScreen();
                        else if ($videoFSObj.get(0).webkitEnterFullScreen) $videoFSObj.get(0).webkitEnterFullScreen();
                        if ($videoFSObj.get(0).msRequestFullscreen) $videoFSObj.get(0).msRequestFullscreen()
                    } else if (document.cancelFullScreen) document.cancelFullScreen(); else if (document.mozCancelFullScreen) document.mozCancelFullScreen(); else if (document.webkitCancelFullScreen) document.webkitCancelFullScreen(); else if (document.webkitExitFullscreen) document.webkitExitFullscreen(); else if (document.msExitFullscreen) document.msExitFullscreen()
                };
                var switchScreenCSS = function (fullscreen) {
                    if (fullscreenNativeControls) if (fullscreen) {
                        $videoObj.get(0).setAttribute("controls", "controls");
                        if (html5VideoNoDownload) $videoObj.get(0).setAttribute("controlsList", "nodownload")
                    } else $videoObj.get(0).removeAttribute("controls"); else if (fullscreen) {
                        $(document).on("mousemove", userActivate);
                        $videoControls.css({"z-index": 2147483647, position: "fixed"});
                        $videoFullscreenBg.css({"z-index": 2147483647, display: "block"});
                        $videoPlay.css({"z-index": 2147483647})
                    } else {
                        $(document).off("mousemove",
                            userActivate);
                        $videoControls.css({"z-index": "", position: "absolute"});
                        $videoFullscreenBg.css({"z-index": "", display: "none"});
                        $videoPlay.css({"z-index": ""})
                    }
                };
                if (document.addEventListener) {
                    document.addEventListener("MSFullscreenChange", function () {
                        isFullscreen = document.msFullscreenElement != null;
                        switchScreenCSS(isFullscreen)
                    }, false);
                    document.addEventListener("fullscreenchange", function () {
                        isFullscreen = document.fullscreen;
                        switchScreenCSS(isFullscreen)
                    }, false);
                    document.addEventListener("mozfullscreenchange",
                        function () {
                            isFullscreen = document.mozFullScreen;
                            switchScreenCSS(isFullscreen)
                        }, false);
                    document.addEventListener("webkitfullscreenchange", function () {
                        isFullscreen = document.webkitIsFullScreen;
                        switchScreenCSS(isFullscreen)
                    }, false)
                }
                if ($videoFSObj && $videoFSObj.get(0) && $videoFSObj.get(0).addEventListener) {
                    $videoFSObj.get(0).addEventListener("webkitbeginfullscreen", function () {
                        isFullscreen = true;
                        switchScreenCSS(isFullscreen)
                    }, false);
                    $videoFSObj.get(0).addEventListener("webkitendfullscreen", function () {
                        isFullscreen =
                            false;
                        switchScreenCSS(isFullscreen)
                    }, false)
                }
                if (!fullscreenNativeControls) $("head").append("<style type='text/css'>video" + videoElem + "::-webkit-media-controls { display:none !important; }</style>");
                var $videoFullscreen = $(".html5boxFullscreen", $videoControls);
                $videoFullscreen.css({
                    display: "block",
                    position: "relative",
                    "float": "right",
                    width: BUTTON_SIZE + "px",
                    height: BUTTON_SIZE + "px",
                    margin: Math.floor((BAR_HEIGHT - BUTTON_SIZE) / 2),
                    cursor: "pointer",
                    "background-image": "url('" + skinFolder + "html5boxplayer_fullscreen.png" +
                    "')",
                    "background-position": "left top"
                }).hover(function () {
                    var backgroundPosX = $(this).css("background-position") ? $(this).css("background-position").split(" ")[0] : $(this).css("background-position-x");
                    $(this).css({"background-position": backgroundPosX + " bottom"})
                }, function () {
                    var backgroundPosX = $(this).css("background-position") ? $(this).css("background-position").split(" ")[0] : $(this).css("background-position-x");
                    $(this).css({"background-position": backgroundPosX + " top"})
                }).on(eClick, function () {
                    isFullscreen =
                        !isFullscreen;
                    switchScreen(isFullscreen)
                })
            }
            if (hd) {
                var $videoHD = $(".html5boxHD", $videoControls);
                $videoHD.css({
                    display: "block",
                    position: "relative",
                    "float": "right",
                    width: BUTTON_SIZE + "px",
                    height: BUTTON_SIZE + "px",
                    margin: Math.floor((BAR_HEIGHT - BUTTON_SIZE) / 2),
                    cursor: "pointer",
                    "background-image": "url('" + skinFolder + "html5boxplayer_hd.png" + "')",
                    "background-position": (isHd ? "right" : "left") + " center"
                }).on(eClick, function () {
                    isHd = !isHd;
                    $(this).css({"background-position": (isHd ? "right" : "left") + " center"});
                    parentInst.isHd =
                        isHd;
                    var isPaused = $videoObj.get(0).isPaused;
                    $videoObj.get(0).setAttribute("src", (isHd ? hd : src) + "#t=" + $videoObj.get(0).currentTime);
                    if (!isPaused) $videoObj.get(0).play(); else $videoObj.get(0).pause()
                })
            }
            $videoObj.get(0).volume = defaultVolume;
            var volumeSaved = defaultVolume == 0 ? 1 : defaultVolume;
            var volume = $videoObj.get(0).volume;
            $videoObj.get(0).volume = volume / 2 + 0.1;
            if ($videoObj.get(0).volume === volume / 2 + 0.1) {
                $videoObj.get(0).volume = volume;
                var $videoVolume = $(".html5boxVolume", $videoControls);
                var $videoVolumeButton =
                    $(".html5boxVolumeButton", $videoControls);
                var $videoVolumeBar = $(".html5boxVolumeBar", $videoControls);
                var $videoVolumeBarBg = $(".html5boxVolumeBarBg", $videoControls);
                var $videoVolumeBarActive = $(".html5boxVolumeBarActive", $videoControls);
                $videoVolume.css({
                    display: "block",
                    position: "relative",
                    "float": "right",
                    width: BUTTON_SIZE + "px",
                    height: BUTTON_SIZE + "px",
                    margin: Math.floor((BAR_HEIGHT - BUTTON_SIZE) / 2)
                }).hover(function () {
                    clearTimeout(hideVolumeBarTimeoutId);
                    var volume = $videoObj.get(0).volume;
                    $videoVolumeBarActive.css({
                        height: Math.round(volume *
                            100) + "%"
                    });
                    $videoVolumeBar.show()
                }, function () {
                    clearTimeout(hideVolumeBarTimeoutId);
                    hideVolumeBarTimeoutId = setTimeout(function () {
                        $videoVolumeBar.hide()
                    }, 1E3)
                });
                $videoVolumeButton.css({
                    display: "block",
                    position: "absolute",
                    top: 0,
                    left: 0,
                    width: BUTTON_SIZE + "px",
                    height: BUTTON_SIZE + "px",
                    cursor: "pointer",
                    "background-image": "url('" + skinFolder + "html5boxplayer_volume.png" + "')",
                    "background-position": "top " + (volume > 0 ? "left" : "right")
                }).hover(function () {
                    var backgroundPosX = $(this).css("background-position") ? $(this).css("background-position").split(" ")[0] :
                        $(this).css("background-position-x");
                    $(this).css({"background-position": backgroundPosX + " bottom"})
                }, function () {
                    var backgroundPosX = $(this).css("background-position") ? $(this).css("background-position").split(" ")[0] : $(this).css("background-position-x");
                    $(this).css({"background-position": backgroundPosX + " top"})
                }).on(eClick, function () {
                    var volume = $videoObj.get(0).volume;
                    if (volume > 0) {
                        volumeSaved = volume;
                        volume = 0
                    } else volume = volumeSaved;
                    var backgroundPosY = $(this).css("background-position") ? $(this).css("background-position").split(" ")[1] :
                        $(this).css("background-position-y");
                    $videoVolumeButton.css({"background-position": (volume > 0 ? "left" : "right") + " " + backgroundPosY});
                    $videoObj.get(0).volume = volume;
                    $videoVolumeBarActive.css({height: Math.round(volume * 100) + "%"})
                });
                $videoVolumeBar.css({
                    display: "none",
                    position: "absolute",
                    left: 4,
                    bottom: "100%",
                    width: 24,
                    height: 80,
                    "margin-bottom": Math.floor((BAR_HEIGHT - BUTTON_SIZE) / 2),
                    "background-color": "#000000",
                    opacity: 0.7,
                    filter: "alpha(opacity=70)"
                });
                $videoVolumeBarBg.css({
                    display: "block", position: "relative",
                    width: 10, height: 68, margin: 7, cursor: "pointer", "background-color": "#222"
                });
                $videoVolumeBarActive.css({
                    display: "block",
                    position: "absolute",
                    bottom: 0,
                    left: 0,
                    width: "100%",
                    height: "100%",
                    "background-color": "#fcc500"
                });
                $videoVolumeBarBg.on(eStart, function (e) {
                    var e0 = isTouch ? e.originalEvent.touches[0] : e;
                    var vol = 1 - (e0.pageY - $videoVolumeBarBg.offset().top) / $videoVolumeBarBg.height();
                    vol = vol > 1 ? 1 : vol < 0 ? 0 : vol;
                    $videoVolumeBarActive.css({height: Math.round(vol * 100) + "%"});
                    $videoVolumeButton.css({
                        "background-position": "left " +
                        (vol > 0 ? "top" : "bottom")
                    });
                    $videoObj.get(0).volume = vol;
                    $videoVolumeBarBg.on(eMove, function (e) {
                        var e0 = isTouch ? e.originalEvent.touches[0] : e;
                        var vol = 1 - (e0.pageY - $videoVolumeBarBg.offset().top) / $videoVolumeBarBg.height();
                        vol = vol > 1 ? 1 : vol < 0 ? 0 : vol;
                        $videoVolumeBarActive.css({height: Math.round(vol * 100) + "%"});
                        $videoVolumeButton.css({"background-position": "left " + (vol > 0 ? "top" : "bottom")});
                        $videoObj.get(0).volume = vol
                    })
                }).on(eCancel, function () {
                    $videoVolumeBarBg.off(eMove)
                })
            }
            var calcTimeFormat = function (seconds) {
                var h0 =
                    Math.floor(seconds / 3600);
                var h = h0 < 10 ? "0" + h0 : h0;
                var m0 = Math.floor((seconds - h0 * 3600) / 60);
                var m = m0 < 10 ? "0" + m0 : m0;
                var s0 = Math.floor(seconds - (h0 * 3600 + m0 * 60));
                var s = s0 < 10 ? "0" + s0 : s0;
                var r = m + ":" + s;
                if (h0 > 0) r = h + ":" + r;
                return r
            };
            if (hidePlayButton) $videoPlay.hide();
            if (hideControls) $videoControls.hide();
            var onVideoPlay = function () {
                if (!hidePlayButton) $videoPlay.hide();
                if (!hideControls) {
                    $videoBtnPlay.hide();
                    $videoBtnPause.show()
                }
            };
            var onVideoPause = function () {
                if (!hidePlayButton) $videoPlay.show();
                if (!hideControls) {
                    $videoControls.show();
                    clearTimeout(hideControlsTimerId);
                    $videoBtnPlay.show();
                    $videoBtnPause.hide()
                }
            };
            var onVideoEnded = function () {
                $(window).trigger("html5lightbox.videoended");
                if (!hidePlayButton) $videoPlay.show();
                if (!hideControls) {
                    $videoControls.show();
                    clearTimeout(hideControlsTimerId);
                    $videoBtnPlay.show();
                    $videoBtnPause.hide()
                }
            };
            var onVideoUpdate = function () {
                var curTime = $videoObj.get(0).currentTime;
                if (curTime) {
                    $videoTimeCurrent.text(calcTimeFormat(curTime));
                    var duration = $videoObj.get(0).duration;
                    if (duration) {
                        $videoTimeTotal.text(calcTimeFormat(duration));
                        if (!sliderDragging) {
                            var sliderW = $videoSeeker.width();
                            var pos = Math.round(sliderW * curTime / duration);
                            $videoSeekerPlay.css({width: pos});
                            $videoSeekerHandler.css({left: pos})
                        }
                    }
                }
            };
            var onVideoProgress = function () {
                if ($videoObj.get(0).buffered && $videoObj.get(0).buffered.length > 0 && !isNaN($videoObj.get(0).buffered.end(0)) && !isNaN($videoObj.get(0).duration)) {
                    var sliderW = $videoSeeker.width();
                    $videoSeekerBuffer.css({width: Math.round(sliderW * $videoObj.get(0).buffered.end(0) / $videoObj.get(0).duration)})
                }
            };
            try {
                $videoObj.on("play",
                    onVideoPlay);
                $videoObj.on("pause", onVideoPause);
                $videoObj.on("ended", onVideoEnded);
                $videoObj.on("timeupdate", onVideoUpdate);
                $videoObj.on("progress", onVideoProgress)
            } catch (e) {
            }
        }
    })(jQuery);
    jQuery(document).ready(function () {
        if (typeof html5Lightbox === "undefined") if (jQuery.fn.html5lightbox) html5Lightbox = jQuery(".html5lightbox").html5lightbox()
    })
};

$(document).ready(function (e) {
    $description = $(".description");
    $map = [];
    var stateData = {
        "states": {
            "IN-UP": {
                "id": "IN-UP",
                "name": "Uttar Pradesh",
                "stats": {
                    "MENTORS": 45895,
                    "INVESTORS": 26543,
                    "STARTUPS": 41200,
                    "ACCELERATORS": 895,
                    "INCUBATORS": 7685
                }
            },
            "IN-GA": {
                "id": "IN-GA",
                "name": "Goa",
                "stats": {
                    "MENTORS": 45895,
                    "INVESTORS": 26543,
                    "STARTUPS": 41200,
                    "ACCELERATORS": 895,
                    "INCUBATORS": 7685
                }
            },
            "IN-MP": {
                "id": "IN-MP",
                "name": "Madhya Pradesh",
                "stats": {
                    "MENTORS": 45895,
                    "INVESTORS": 26543,
                    "STARTUPS": 41200,
                    "ACCELERATORS": 895,
                    "INCUBATORS": 7685
                }
            }
        }
    }
    var shiftPositionObject = {
        'IN-GA': {
            x: 1,
            y: 30
        },
        'IN-MN': {
            x: -5,
            y: 30
        },
        'IN-NL': {
            x: -5,
            y: 30
        },
        'IN-AS': {
            x: -5,
            y: 18
        },
        'IN-ML': {
            x: 1,
            y: 25
        },
        'IN-MZ': {
            x: 1,
            y: 25
        },
        'IN-TR': {
            x: 1,
            y: 30
        },
        'IN-SK': {
            x: 1,
            y: 30
        },
        'IN-AR': {
            x: -5,
            y: 20
        },
        'IN-WB': {
            x: 1,
            y: -25
        },
        'IN-BR': {
            x: 1,
            y: 10
        },
        'IN-JH': {
            x: 8,
            y: 10
        },
        'IN-AP': {
            x: 20,
            y: -20
        },
        'IN-KL': {
            x: 1,
            y: 10
        },
        'IN-KA': {
            x: 1,
            y: -25
        },
        'IN-MH': {
            x: 15,
            y: 5
        },
        'IN-MP': {
            x: 5,
            y: -15
        },
        'IN-HR': {
            x: 1,
            y: 15
        },
        'IN-UT': {
            x: 1,
            y: 15
        },
        'IN-PB': {
            x: 1,
            y: 10
        },
        'IN-HP': {
            x: 1,
            y: 15
        },
        'IN-JK': {
            x: 5,
            y: 25
        },
        'IN-LADAKH': {
            x: -10,
            y: 10
        },
        'IN-UP': {
            x: 5,
            y: -5
        },
        'IN-TG': {
            x: 5,
            y: 10
        },
        'IN-DL': {
            x: 1,
            y: 32
        },
        'IN-LD': {
            x: 8,
            y: 30
        }
    }

    $('.enabled').hover(function () {
        stopAutoAnim();
        $description.addClass('active');
        $description.html($(this).attr('title'));
    }, function () {
        var listOfPaths = $('.enabled');
        listOfPaths.map(function (currentPath) {
            if ($(listOfPaths[currentPath]).hasClass('selected')) {
                $description.html($(this).attr('title'));
                mouseEneter(listOfPaths[currentPath]);
            }
        })
    });

    $('.enabled').click(clickedAnimation);

    $('.india-map').on('mouseenter', function (e) {
        stopAutoAnim();
    });
    $('.india-map-details').on('mouseenter', function (e) {
        stopAutoAnim();
    });
    $('.enabled').on('mouseenter', function (e) {
        mouseEneter(e);
    });

    $('.india-map').on('mouseleave', function (e) {
        var _autoAnim = setTimeout(function () {
            clearTimeout(_autoAnim);
            startAutoAnim();
        }, 0);
    });


    var autoStart = null;
    var index = 0;

    function stopAutoAnim() {
        autoStart && clearInterval(autoStart);
    }

    function startAnimOnInit() {
        stopAutoAnim();
        var listOfStates = ['IN-MP'];
        var listOfPaths = $('.enabled');
        listOfPaths.map(function (currentPath) {
            if ($(listOfPaths[currentPath]).attr('id') === listOfStates[index]) {
                $(listOfPaths[currentPath]).trigger('click');
                $description.addClass('active');
                $description.html($(this).attr('title'));
                mouseEneter(listOfPaths[currentPath]);
            }
        })
        index++;
        if (index >= listOfStates.length) {
            index = 0;
        }
        clickedAnimation();
    }

    startAnimOnInit();

    function startAutoAnim() {
        stopAutoAnim();
        autoStart = setInterval(function () {
            if ($('.more-on-map-div').length) {
                var listOfStates = ['IN-JK', 'IN-UP', 'IN-MP', 'IN-WB', 'IN-BR'];
                var listOfPaths = $('.enabled');
                listOfPaths.map(function (currentPath) {
                    if ($(listOfPaths[currentPath]).attr('id') === listOfStates[index]) {
                        $(listOfPaths[currentPath]).trigger('click');
                        $description.addClass('active');
                        $description.html($(this).attr('title'));
                        mouseEneter(listOfPaths[currentPath]);
                    }
                })
                index++;
                if (index >= listOfStates.length) {
                    index = 0;
                }
            }
        }, 3000);
    }

//startAutoAnim();

    function clickedAnimation() {
        $('.IN-LD').find('.enabled').prev().removeClass('makeVisible');
        $('.IN-LD').find('.enabled').removeClass('selected');
        $(this).addClass('selected');
        $(this).prev().addClass('makeVisible');
        $(this).parent().siblings().find('.enabled').prev().removeClass('makeVisible');
        $(this).parent().siblings().find('.enabled').removeClass('selected');
        if ($(this).attr('id') != 'IN-LD') {
            $(this).parent().appendTo('#map-parent');
        }
        if ($('#more-on-map-div').length) {
            var obj = $(this);
            $.ajax({
                type: "GET",
                contentType: "application/json",
                url: SIH.getEndPoint("/api/common/stateCount?stateId=" + $(this).attr('stateid'))
            }).done(function (data) {
                var name = $(obj).attr('title');
                var id = $(obj).attr('stateid');
                if (data && id) {
                    $(".india-map-details .sector-text h2").text(name);
                    var url = "/content/sih/en/search.html?states=" + id + "&roles=Startup&page=0";
                    $(".india-map-details .state-details .startup a").attr("href", url);
                    $(".india-map-details .state-details .startup .data").text(data.stats.Startup ? data.stats.Startup : "0");
                    url = "/content/sih/en/search.html?states=" + id + "&roles=Mentor&page=0";
                    $(".india-map-details .state-details .mentor a").attr("href", url);
                    $(".india-map-details .state-details .mentor .data").text(data.stats.Mentor ? data.stats.Mentor : 0);
                    url = "/content/sih/en/search.html?states=" + id + "&roles=Investor&page=0";
                    $(".india-map-details .state-details .investor a").attr("href", url);
                    $(".india-map-details .state-details .investor .data").text(data.stats.Investor ? data.stats.Investor : 0);
                    url = "/content/sih/en/search.html?states=" + id + "&roles=Incubator&page=0";
                    $(".india-map-details .state-details .incubator a").attr("href", url);
                    $(".india-map-details .state-details .incubator .data").text(data.stats.Incubator ? data.stats.Incubator : 0);
                    url = "/content/sih/en/search.html?states=" + id + "&roles=Accelerator&page=0";
                    $(".india-map-details .state-details .accelerator a").attr("href", url);
                    $(".india-map-details .state-details .accelerator .data").text(data.stats.Accelerator ? data.stats.Accelerator : 0);
                    url = "/content/sih/en/search.html?states=" + id + "&roles=Corporate&page=0";
                    $(".india-map-details .state-details .corporate a").attr("href", url);
                    $(".india-map-details .state-details .corporate .data").text(data.stats.Corporate ? data.stats.Corporate : 0);
                }
            });
        }

    }

    function mouseEneter(e) {
        var id = (e.hasOwnProperty('currentTarget') && e.currentTarget.id) || $(e).attr('id');
        var idElem = document.getElementById(id);
        var clientReact = idElem.getBoundingClientRect();
        var description = document.querySelector('.description');
        var descPosition = description.getBoundingClientRect();
        var isSmallState = shiftPositionObject[id] || 0;
        /*$(description).css({
            right: clientReact.x + clientReact.width / 2 - descPosition.width / 2 - ((isSmallState && isSmallState.x) || isSmallState),
            top: document.documentElement.scrollTop + clientReact.y - ((isSmallState && isSmallState.y) || isSmallState)
        });*/
        var mapContainer = document.getElementsByClassName('india-map')[0];
        var mapContainerRect = mapContainer.getBoundingClientRect();
        $(description).css({
            left: clientReact.left - mapContainerRect.left + clientReact.width / 2 - descPosition.width / 2 - ((isSmallState && isSmallState.x) || isSmallState),
            top: clientReact.top - mapContainerRect.top - ((isSmallState && isSmallState.y) || isSmallState)
        });
    }

});

var uniqueProfileId;
var applicationLink;
var $modal;
var imageContent;
var profileData;
var businessDocTitle;
var userJoiningDate;
var userJoiningYear;
var $reviewModal;
var teamSlickSlider;
var galleryItems = null;
var pageNum = 0;
var totalPages = 999999999;

$(document).ready(function(){
    $reviewModal = $(".review-modal");
});

var galleryItem = function (data,usr){
    var source = $('#gallery-template').html();
    if(source) {
        var template = Handlebars.compile(source);
        //if (data) {
        var galleryItemsValues = null;
        if(usr.role=="Startup") {
            galleryItemsValues = {
                ProductPortfolio: [],
                Events: [],
                Other: []
            };
        }else{
            galleryItemsValues = {
                ResearchFacilities: [],
                Campus: [],
                Workspaces: []
            };
        }
        if (data) {
            $.each(galleryItemsValues, function (index, val) {
                galleryItemsValues[index] = data[index]
            });
        }
        $('#gallery').html(template(galleryItemsValues));
        $(".html5lightbox").html5lightbox();
        setTimeout(function () {
            $("div.galleryImageDiv").mCustomScrollbar({
                'autoHideScrollbar': false,
                theme: "dark",
                scrollButtons: {
                    enable: true
                }
            });
        }, 2000);

        //}
    }
}


function createProfilePage(uid) {
    store.removeItem("connectTo");
    var path = "";
    var customHeader = {};
    if (store.getItem("token")) {
        path = "/api/auth/user/profile";
        customHeader["X-Auth-Token"] = store.getItem("token");
    }
    else {
        path = "/api/common/user/profile";
    }
    if (uid !== "") {
        var url = (uid == store.getItem("uniqueId") ? path : path + "/" + uid);
        $.ajax({
            type: "GET",
            url: SIH.getEndPoint(url),
            headers: customHeader
        }).done(function (data) {
            var pathname = window.location.pathname.split('.');
            var urlRole =pathname[1].toLowerCase();
            var profileRole = data.user.role.toLowerCase();
            urlRole = urlRole === 'int-startup' ? 'startup' :  urlRole;
            urlRole = urlRole === 'int-mentor' ? 'mentor' :  urlRole;
            urlRole = urlRole === 'int-investor' ? 'investor' :  urlRole;
            urlRole = urlRole === 'int-accelerator' ? 'accelerator' :  urlRole;
            urlRole = urlRole === 'int-corporate' ? 'corporate' :  urlRole;
            urlRole = urlRole === 'int-incubator' ? 'incubator' :  urlRole;
            urlRole = urlRole === 'int-individual' ? 'individual' :  urlRole;
            currUser = data.user;
            if(urlRole === profileRole){
                uniqueProfileId = uid;
                personaProfile(data);
                personaAttributes(data);
                personaSocialInfo(data);
                otherPersona(data, customHeader);
                personaDescription(data);
                personaDocuments(data);
                if(data.user.role=="Startup"){
                    galleryItems= {
                        ProductPortfolio: "Product Portfolio",
                        Events: "Events",
                        Other: "Other"
                    };
                }
                else{
                    galleryItems= {
                        ResearchFacilities: "Research Facilities",
                        Campus: "Campus",
                        Workspaces: "Workspaces"
                    };
                }
                if(data.user.role=="Startup") {
                    if (data.user.gallery && (data.user.gallery.ProductPortfolio.length > 0 || data.user.gallery.Events.length > 0 || data.user.gallery.Other.length > 0)
                        || store.getItem('uniqueId') == uid) {
                        galleryItem(data.user.gallery,data.user);
                    } else {
                        $('#gallery').html("<p class='no-image-msg'>" + $('#gallery').data('noimagemsg') + "</p>");
                    }
                }else {
                    if(data.user.gallery && (data.user.gallery.Campus.length > 0 || data.user.gallery.ResearchFacilities.length > 0 || data.user.gallery.Workspaces.length > 0)
                        || store.getItem('uniqueId') == uid) {
                        galleryItem(data.user.gallery,data.user);
                    }else{
                        $('#gallery').html("<p class='no-image-msg'>"+$('#gallery').data('noimagemsg')+"</p>");
                    }
                }
                if(profileRole != 'mentor' && profileRole != 'investor' && profileRole != 'individual'){
                    personaMember(data);
                }
                personaSuccessStories(data);
                reviewNrating(uid);
                personaBadges(data);
                personaIncubateeDetails(data);
                personaLocation(data);
                if(data.user.role === "GovernmentBody"){
                    var param = {
                        'ministry':data.user.agency.ministry.id,
                        'department':data.user.agency.department.id
                    };
                    displayContentListing(createQueryString(param));
                }
                //below code commented to enable Enablers to write reviews and rating
                // to any profile as per new connection logic
                /*if (!data.connectionStatus.connected) {
                    disableReviewButton();
                }*/
                if(data.connectionStatus.connected || store.getItem('uniqueId') === store.getItem('profileUniqueId')) {
                    setReviewButtonTitle();
                }

                if(!data.allowProfileEdit && store.getItem('uniqueId') === store.getItem('profileUniqueId')){
                    showSnackbar('<i class="fa-2x fa-info-circle"></i>Your profile is under moderation', "alert-info", 5000);
                }

                moreContent();
            }else{

                window.location.replace($('.notification-container').attr('error-page') + "/404.html");
            }

            $(".user-profile-banner-wrapper.connect").on("click", "div.connect-action div.cta a", function () {
                // setting uniqueId when enabler want to send message to non-connected user
                var enablers = ["Mentor","Incubator","Accelerator","Investor","Corporate"];
                if(enablers.indexOf(store.getItem("role")) > -1){
                    sessionStorage.setItem("messageToUniqueId", uid);
                }
                // end
            });
            // displaying block button
            /*if(store.getItem("uniqueId") !== store.getItem("profileUniqueId")){
                $('button[name="block"]').removeClass('hidden');
            }else{
                $('button[name="block"]').addClass('hidden');
            }*/


        }).error(function (xhr) {
            if (xhr.status == 404) {
                window.location.replace($('.notification-container').attr('error-page') + "/404.html");
            }
        });
    }
}

function personaSocialInfo(data){
    var activeSice;
    if(data.createdOn){
        var createdOn = new Date(data.createdOn);
        activeSice = createdOn.getDate() + "/" + (createdOn.getMonth()+1) + "/" + createdOn.getFullYear();
        var createdOn = createdOn.toDateString().split(" ");
        userJoiningDate = createdOn[1] + " " + createdOn[2] + ", " + createdOn[3] ;
        userJoiningYear = createdOn[3];

    }

    var user = data.user ? data.user : data;
    if($("#persona-social-template").length && user){
        $("div.persona-profile-social-wrapper").closest(".profile-sidebar-social").removeClass("hidden");
        var template = Handlebars.compile($("#persona-social-template").html());
        if(user.startup) {
            if (user.startup.socialInfos && user.startup.socialInfos.length) {
                $("div.persona-profile-social-wrapper").prepend(template(user.startup));
                $("div.persona-profile-social-wrapper .preview-profile").removeClass("hidden");
            } else if (user.startup.members && user.startup.members.length) {
                $("div.persona-profile-social-wrapper").prepend(template(user.startup.members[0]));
                if (user.startup.members.socialInfos && user.startup.members.socialInfos.length) {
                    $("div.persona-profile-social-wrapper .preview-profile").removeClass("hidden");
                }
            } else {
                $("div.persona-profile-social-wrapper").prepend(template([]));
            }
        }else{
            if (user.socialInfos && user.socialInfos.length) {
                $("div.persona-profile-social-wrapper").prepend(template(user));
                $("div.persona-profile-social-wrapper .preview-profile").removeClass("hidden");
            } else {
                $("div.persona-profile-social-wrapper").prepend(template([]));
            }
        }

        if(user.role=="Incubator"){
            $("p .joining-date").text("Year of Establishment: " + userJoiningYear);
            $(".company-name .active-since strong").text(activeSice);
        } else {
            $("p .joining-date").text("Joined Startup India: " + userJoiningDate);
            $(".company-name .active-since strong").text(activeSice);
        }
    }
}

function personaAttributes(data) {

    data = data.user ? data.user : data;
    var source = $("#persona-attributes-template").html();
    if (source) {
        var template = Handlebars.compile(source);
        $('.persona-attributes-container .advantage-grid-wrap,.persona-attributes-container .list-unstyled').html(template(data));
    }
    if (data.startup) {
        var startup = data.startup;
        $("input[value='" + startup.stage + "']").prop('checked', true);
        if (startup.location.state) {
            $("#state").val(startup.location.state.id).trigger('change');
            $("#city").val(startup.location.city.id).trigger('change');
        }
        $("#startupindustry").val(startup.focusArea.industry.id).trigger('change');
        $("#sector").val(startup.focusArea.sectors[0].id).trigger('change');
        $("#services").val(startup.services).trigger('change');
    }
    // Focused Sectors
    var focusSection = $(".focusSection .content");
    if(focusSection.length) {
        $(focusSection).each(function(i,v){
            var str = $(this).text();
            if (str.length > 100) {
                str = str.substr(0, 100);
                $(this).text(str.substr(0, str.lastIndexOf(",")));
                $(this).parents(".focusSection").find(".view-all").removeClass('hidden');
            } else {
                $(this).parents(".focusSection").find(".view-all").addClass('hidden');
            }
        })
    }
    return false;
}

function personaProfile(data) {
    var source = $("#persona-profile-template").html();
    if (source) {
        var connections = data.connectionStatus;
        store.setItem("connectTo", connections);
        store.setItem("userProfileRole", data.user.role);
        store.setItem("allowProfileEdit",data.allowProfileEdit);
        applicationLink = completeLink(data.user.applicationLink);
        // var cin = getCinNumber(data);
        //console.log("cinnnnnn"+cin);
        var updatedDate = new Date(data.lastUpdatedOn);
        var dateSplit = updatedDate.toString().split(" ");
        var timeSplit = dateSplit[4].split(":");
        var timezone = "AM";
        var hour = timeSplit[0];
        if (parseInt(timeSplit[0]) > 12) {
            hour = parseInt(timeSplit[0]) - 12;
            timezone = "PM"
        }
        if (parseInt(timeSplit[0]) === 12 && parseInt(timeSplit[1]) > 0) {
            timezone = "PM"
        }
        data.lastUpdatedOn = dateSplit[1] + " " + dateSplit[2] + " " + dateSplit[3] + " at " + timeSplit[0] + ":" + timeSplit[1] + " " + timezone;

        if(parseInt(timeSplit[0]) > 12){
            timezone = "PM"
        }if(parseInt(timeSplit[0]) === 12 && parseInt(timeSplit[1]) > 0){
            timezone = "PM"
        }
        data.lastUpdatedOn = dateSplit[1] +" "+  dateSplit[2] +" "+ dateSplit[3] + " at "+ hour+":"+timeSplit[1]+" "+timezone;

        var template = Handlebars.compile(source);
        $('.persona-profile-container').prepend(template(data));
        $('.connect-action').html($('.connect-content').html());
        $('.connect-content').remove();


        showConnectionWidgetCard("persona-connections-widget-template","persona-connections-widget-div", store.getItem("profileUniqueId"), pageNum);

        // equalHeightsForSelector(".personaprofilerevamp .side-cards.persona-attributes-container.user-profile .advantage-grid-wrap .content-section");
    }



    function showConnectionWidgetCard(cardId, displayCardId, puid, pageNumber){
        var connectionCard = $("#" + cardId).html();
        if(connectionCard) {
            let template = Handlebars.compile(connectionCard);
            let mainDiv = $("#" + displayCardId);
            let uid = store.getItem("uid");
            let path = mainDiv.data("path");

            if(puid){
                path = path + "/" + puid;
            }
            if (path && pageNum < totalPages) {
                var data = {};
                data["page"] = pageNumber;
                $.ajax({
                    type: "GET",
                    url: SIH.getEndPoint(path),
                    data: data,
                    success: function (response) {
                        totalPages = response.totalPages;
                        if(response.content.length > 0 || store.getItem("uniqueId") == store.getItem("profileUniqueId")){
                            if($(".connections-widget-container").length > 0){
                                if(pageNum && pageNum > 0){
                                    $(mainDiv).find(".modal.connection-showing-data .modal-body ").append(template(response));
                                }
                                mainDiv.html(template(response));
                                $(".connections-widget-container").removeClass("display-n");
                            }
                        }
                    }
                }).done(function (response) {
                    pageNum = pageNum + 1;
                    if (response.content.length > 0 && pageNum == 1) {
                        $(".modal.fade.connection-showing-data.in .modal-content .modal-body").mCustomScrollbar('destroy');
                        $(".modal.fade.connection-showing-data.in .modal-content .modal-body").mCustomScrollbar({
                            'autoHideScrollbar': false,
                            theme: "dark",
                            callbacks: {
                                onInit: function () {
                                    $(this).data("mCS").opt.callbacks.onTotalScrollOffset =
                                        Math.abs(this.mcs.content.innerHeight() - ($("#modal-content").position().top + $("#modal-content").outerHeight(true)));
                                },
                                onTotalScroll: function () {
                                    showConnectionWidgetCard("connection-pop-list-template", "persona-connections-widget-div", puid, pageNum);
                                },
                                alwaysTriggerOffsets: true
                            },
                            scrollButtons: {
                                enable: true
                            }
                        });
                    }
                });
            }
        }
    }

    var stageLevel = ["Explorer","Maverick","Star","Superstar","Champion"];
    var points = data.points;
    var level;
    if (points > 1000) {
        level = 5;
    } else if (points > 800) {
        level = 4;
    } else if (points > 500) {
        level = 3;
    } else if (points > 301) {
        level = 2;
    } else {
        level = 1;
    }
    if(data.user.role == "Incubator" || data.user.role == "Mentor" || data.user.role == "Accelerator"||  data.user.role == "Corporate"){
        $.ajax({
            type: "GET",
            url: SIH.getEndPoint("/api/common/connection-accepted/stats/"+uniqueProfileId),
            async: false
        }).done(function (response) {
            if(data.user.role == "Mentor"){
                data.user.connectionsAccepted = response;
                $(".orglevel strong").text(stageLevel[level - 1]);
            }else {
                $(".orglevel:not(.active-since)").parent("h6").html("Connections Accepted: &nbsp;<span class='orglevel'><strong>"+response+"% </strong></span>");
            }
        });

    }else {
        $(".orglevel strong").text(stageLevel[level - 1]);
    }
    return false;
}

store.eventing.on(ContextHub.Constants.EVENT_DATA_UPDATE, function(){
    if(store.getItem("uniqueId") !== store.getItem("profileUniqueId")
        && store.getItem('connectTo/connectionSent')){
        $('button[name="request-sent"]').removeClass('hidden');
    }else{
        $('button[name="request-sent"]').addClass('hidden');
    }
}, "connectTo/connectionSent");

store.eventing.on(ContextHub.Constants.EVENT_DATA_UPDATE, function(){
    if(store.getItem('connectTo/connectionRecieved')){
        $('button[name="accept-cta"]').removeClass('hidden');
        $('button[name="reject-cta"]').removeClass('hidden');
    }else{
        $('button[name="accept-cta"]').addClass('hidden');
        $('button[name="reject-cta"]').addClass('hidden');
    }
}, "connectTo/connectionRecieved");

store.eventing.on(ContextHub.Constants.EVENT_DATA_UPDATE, function(){
    var enablers = ["Mentor","Incubator","Accelerator","Investor","Corporate"];
    // || (enablers.indexOf(store.getItem("role")) > -1)
    if(store.getItem('connectTo/connected')
    /*|| (enablers.indexOf(store.getItem("role")) > -1)
    && store.getItem("uniqueId") !== store.getItem("profileUniqueId")*/){

        $('div.connect-action div.cta a').removeClass('hidden');
    }else{
        $('div.connect-action div.cta a').addClass('hidden');
    }
}, "connectTo/connected");

store.eventing.on(ContextHub.Constants.EVENT_DATA_UPDATE, function(){
    if(store.getItem("uniqueId") !== store.getItem("profileUniqueId")
        && store.getItem('connectTo/connectionAllowed') && !store.getItem('connectTo/connectionRecieved')){

        $('button[name="connect-cta"]').removeClass('hidden');
    }else{
        $('button[name="connect-cta"]').addClass('hidden');
    }
}, "connectTo/connectionAllowed");


function personaProfileSocial(data){
    var source = $("#persona-profile-social-template").html();
    if (source) {
        var template = Handlebars.compile(source);
        $('.persona-profile-social-container').prepend(template(data));
    }

    return false;
}

function cta (data,uid){
    if((store.getItem('token')) && (uid == store.getItem("uniqueId"))){
        $(".profile-cta").removeClass("profile-cta-hidden");
    }
}

function personaBadges(data){
    if((data.badges && data.badges.length) || (data.assignedBadges && data.assignedBadges.length)){
        var source = $("#persona-profile-badges-template").html();
        if (source) {
            var template = Handlebars.compile(source);
            $('.user-profile-badges').prepend(template(data));
        }
    }
    return false;

}

function otherPersona(data, customHeader) {
    var source = $("#other-persona-template").html();
    if (source) {
        var path = "";
        var template = Handlebars.compile(source);
        if(customHeader["X-Auth-Token"]){
            path = "/api/auth/search/similar/";
        }else {
            path = "/api/noauth/search/similar/";
        }
        $.ajax({
            url: SIH.getEndPoint(path + data.user.role + "?id=" + data.user.uniqueId),
            type: "GET",
            headers: customHeader
        }).done(function (data) {
            $('.other-persona-container').append(template(data));
            for(var i=0; i<Math.floor(data.accumaltiveRating); i++) {
                $(".other-persona-container").find(".otherPersonaRating.rating input[value='" + i +"']").prop("checked", "checked");
            }
        });
    }
    return false;
}

function personaDescription(data) {
    data = data.user ? data.user : data;
    var source = $("#persona-description-template").html();
    if (source) {
        var template = Handlebars.compile(source);
        $('.persona-description-container').append(template(data));
    }
    //$("[name=ideaBrief]").hide();
    return false;
}

function personaLocation(data, isEditMode) {
    data = data.user ? data.user : data;
    data.isEditMode = isEditMode;
    if(data.centerLocations || store.getItem("uniqueId") == store.getItem("profileUniqueId") ) {

        $(".location-widget-container").removeClass("display-n");
        var source = $("#persona-map-loction-template").html();
        if (source) {
            var template = Handlebars.compile(source);
            $('.person-map-content-placeholder').html(template(data));
        }

        source = $("#add-location-outer-template").html();
        if (source) {
            var templateMap = Handlebars.compile(source);
            $('.person-loc-map-content-placeholder').html(templateMap({"isEditMode":isEditMode}));
        }

        if(data.centerLocations && data.centerLocations.length > 0) {
            $.each(data.centerLocations, function (i, v) {
                compileLocationMapTemplate(v);
            });
        }else{
            var locationMapTemplate = $("#add-location-inner-template").html();
            if(locationMapTemplate) {
                locationMapTemplate = Handlebars.compile(locationMapTemplate);
                $("#addLocationTemplate").append(locationMapTemplate({}));
            }
        }

        $(".location-selection").on('change', function(){
            $(this).find("option:selected").each(function(){
                var optionValue = $(this).attr("value");
                console.log(optionValue);
                if(optionValue){
                    $(".box").not("." + optionValue).hide();
                    $("." + optionValue).show();
                } else{
                    $(".box").hide();
                }
            });
        });
    }
    return false;
}


function personaIncubateeDetails(data, isEditMode) {
    data = data.user ? data.user : data;
    data.isEditMode = isEditMode;
    if(data.numberOfIncubatees && data.numberOFIncubateesGraduated) {
        var source = $("#persona-incubatees-details-template").html();
        if (source) {
            var template = Handlebars.compile(source);
            $('.persona-incubatees-details-placeholder').html(template(data));
        }
    }
    return false;
}

function personaDocuments(data) {
    data = data.user ? data.user : data;
    var source = $("#persona-documents-template").html();
    if (source && (data.startup.businessPlan
            || store.getItem("uniqueId") == store.getItem("profileUniqueId")))  {

        $(".business-doc-container").removeClass("display-n");
        var template = Handlebars.compile(source);
        $('.persona-documents-container :not(h3)').remove();
        $('.persona-documents-container').append(template(data));
    }
    source = $("#add-documents-btn-template").html();
    if(store.getItem("allowProfileEdit") && source){
        var template = Handlebars.compile(source);
        $(".profile-sidebar-business-doc .edit-document").html(template);
    }
    return false;
}

function loadFirstMember(data, isMemberInfo) {
    var memberData = {};
    var firstMember = data;
    if(firstMember.user && firstMember.user.startup){
        firstMember = firstMember.user.startup;
    }else if(firstMember.user && firstMember.user.members){
        firstMember = firstMember.user;
    }
    memberData.memberGroup = {};
    memberData.memberGroup.members = [];
    if(firstMember.members && firstMember.members.length > 0){
        memberData.memberGroup.members.push(firstMember.members[0])
    }else if(isMemberInfo){
        memberData.memberGroup.members.push(firstMember);
    }
    firstMember = memberData;
    var source = $("#persona-member-template").html();
    if (source && firstMember.memberGroup && (firstMember.memberGroup.members.length > 0
            || store.getItem("uniqueId") == store.getItem("profileUniqueId"))) {

        $(".profile-team-members-container").removeClass("display-n");
        var template = Handlebars.compile(source);
        $('.persona-member-container').html(template(firstMember));
        $('.single-team-member').html(template(firstMember));
        $(".single-team-member .member-info").mCustomScrollbar({
            theme: "dark",
            scrollButtons: {
                enable: true
            }
        });
    }
}

function personaMember(data) {

    var records= $(".records").val();

    loadFirstMember(data);
    loadMembers(data);
    if(data.user.startup) {
        data = data.user.startup;
    }else if(data.user){
        data = data.user;
    }
    if(data){
        var source = $("#add-team-outer-template").html();
        if (store.getItem("allowProfileEdit") && source) {
            var templatek = Handlebars.compile(source);
            $('#add-team-outer-div').append(templatek);
            if (data.members && data.members.length) {
                $.each(data.members, function (i, v) {
                    compileTeamMemberTemplate(v);
                });
            } else {
                compileTeamMemberTemplate();
            }
        }

        if(data.members && $.isArray(data.members) && data.members.length > records){
            $("#show-more").show();
            showMore(records);
        }
        else {
            $(".user-profile-btn").hide();
        }
    }

    return false;
}



function loadMembers(data){
    var memberData = {};
    memberData.memberGroup = {};
    if(data.user.startup){
        memberData.memberGroup.members = data.user.startup.members;
    }else{
        memberData.memberGroup.members = data.user.members;
    }
    if(memberData.memberGroup.members && memberData.memberGroup.members.length > 1){
        if(teamSlickSlider){
            teamSlickSlider.slick('unslick');
        }
        var otherMembersTemplate = Handlebars.compile($("#persona-other-member-template").html());
        $('.member-slider-wrap .team-member-slider').html("");
        $('.member-slider-wrap .team-member-slider').html(otherMembersTemplate(memberData));

        createTeamSlider();
    }
}

function showMore(y){

    $(".profile-records").addClass('display-n');
    var size_data= $('.profile-records').size();
    var listing =  $('.profile-records:lt('+ y +')');
    $(listing).removeClass('display-n');
    $(".user-profile-btn").click(function () {

        y = parseInt(y)+2 <= size_data ? parseInt(y)+2 : size_data;

        if(y==size_data){
            $("#show-more").hide();
            $(".user-profile-btn").html("No More Data To Display");
        }
        $('.profile-records:lt('+ y +')').removeClass('display-n');

    });
}
function personaSuccessStories(data, editMode) {
    data = data.user ? data.user : data;
    var source = $("#success-stories-template").html();
    if (source) {
        var template = Handlebars.compile(source);
        $('.success-stories-container').append(template(data));

        $("button.delete-success-story").on("click", function(){
            $(".modal.confirmation-modal").modal('show');
        });

        $(".success-stories-container .story-list").mCustomScrollbar({
            theme: "dark",
            scrollButtons: {
                enable: true
            }
        });
    }
    if(editMode){
        $(".edit-success-story").toggleClass("hidden");
        $(".delete-success-story").toggleClass("hidden");
    }
    return false;
}
function reviewNrating(uid) {
    getAllReviews(uid);
    getAvgReview(uid);
}

$(document).on('click', ".review-modal .modal-body button", function () {
    var comment = $reviewModal.find('textarea').val();
    $(this).prev('div.err-div').remove();
    var uid = store.getItem("profileUniqueId");

    if(comment){
        var postData = {
            "comment": comment,
            "rating": $(".modal.review-modal").find(".rating > input:checked ~ label").length
        };
        $.ajax({
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify(postData),
            url: SIH.getEndPoint("/api/auth/user/review/" + uid),
            headers: {"X-Auth-Token": store.getItem("token")}
        }).done(function (data) {
            $("div.rating-star").find(".rating input[value='" + Math.floor(data.accumaltiveRating) +"']").prop("checked", true);
            disableReviewButton();
        }).always(function (){
            getAllReviews(uid);
            getAvgReview(uid);
        });

        $(".modal-backdrop.fade.in").each(function(){
            $(this).removeClass("in");
            $(this).addClass("out");
        });
    }else{
        $("<div class='err-div'></div>").insertBefore(this).text("Please add your comments.");
    }
});

function getAllReviews(uid) {
    var token = store.getItem('token');
    if (!token) {
        disableReviewButton();
    }
    $.ajax({
        type: "GET",
        contentType: "application/json",
        url: SIH.getEndPoint("/api/common/user/" + uid + "/reviews")
    }).done(function (data) {
        var source = $("#persona-reviewNrating-template").html();
        if((source && data.content.length > 0)
            || store.getItem("uniqueId") == store.getItem("profileUniqueId")) {

            $(".reviewNrating-row-container").removeClass("display-n");
            var template = Handlebars.compile(source);
            var $allReview = $(".persona-reviewNrating").find(".allReviews");
            $allReview.html('');
            // $allReview.append("<hr class='empty'>");
            $allReview.append(template(data.content));
            var allPersonaShowRating = $allReview.find(".persona-showRating");
            $.each(data.content, function (index, ratings) {
                $(allPersonaShowRating[index]).find("input[value='" + ratings.rating + "']").prop("checked", true);
            });

            $('.faqs-wrapper .home-left-quick-tabs ul.dynamicTabs li').each(function(){
                var className = $(this).children().find('.tab-data-wrapper').text().toLowerCase();
                $(this).addClass(className);
            });

            $('.persona-reviewNrating .allReviews').owlCarousel({
                loop:true,
                margin:10,
                items:1,
                autoPlay: true,
                autoPlayTimeout: 1000
            });

            moreContent();
        }else{
            $('.faqs-wrapper .home-left-quick-tabs ul.dynamicTabs li').each(function(){
                var className = $(this).children().find('.tab-data-wrapper').text().toLowerCase();
                $(this).addClass(className);
            });

            $(".faqs-wrapper .home-left-quick-tabs ul.dynamicTabs li.reviews").addClass("display-n");
            $(".profile-team-sec.startup").addClass("display-n");
            $(".persona-reviewNrating .allReviews").html("<h3>No Reviews</h3>");
        }
    }).fail(
        function(error){
            $('.faqs-wrapper .home-left-quick-tabs ul.dynamicTabs li').each(function(){
                var className = $(this).children().find('.tab-data-wrapper').text().toLowerCase();
                $(this).addClass(className);
            });
            $(".faqs-wrapper .home-left-quick-tabs ul.dynamicTabs li.reviews").addClass("display-n");
            $(".profile-team-sec.startup").addClass("display-n");
            $(".persona-reviewNrating .allReviews").html("<h3>No Reviews</h3>");
        }
    );
}

function getAvgReview(uid) {

    var options = {
        type: "GET"
    };
    if (store.getItem('token')) {
        options.url = SIH.getEndPoint("/api/auth/user/" + uid + "/reviews/average");
        options.headers = {"X-Auth-Token": store.getItem("token")};
    } else {
        options.url = SIH.getEndPoint("/api/common/user/" + uid + "/reviews/average");
    }
    $.ajax(options).done(function (data) {
        if (data.numberOfReview > 0) {
            $("div.rating-star").find(".rating input[value='" + Math.floor(data.accumaltiveRating) +"']").prop("checked", true);


            if (!data.canReview) {
                disableReviewButton();
            }
        }
        var source = $("#persona-profile-rating-template").html();
        if(source){
            var template = Handlebars.compile(source);
            $("#persona-profile-rating-container").html(template({
                'avgRating': Math.floor(data.accumaltiveRating),
                'ratingCount': data.numberOfReview,
                'canReview': data.canReview
            }));
        }
    }).fail(function () {
        var source = $("#persona-profile-rating-template").html();
        if(source){
            var template = Handlebars.compile($("#persona-profile-rating-template").html());
            $("#persona-profile-rating-container").html(template({
                'avgRating': 0,
                'ratingCount': 0,
                'canReview': uid == store.getItem("uniqueId") ? false : true
            }));
        }
    });
}

function disableReviewButton() {
    $('.persona-reviewNrating').find(".head-panel button").attr("disabled", "disabled");
}

function setReviewButtonTitle() {
    $('.persona-reviewNrating').find(".head-panel button").attr("title", "");
}



$("ul.profile-tabs").html($(".tab-container-headings").html());

$(document).ready(function(){

    $modal = $(".modal.review-modal");

    $modal.find("button.close").click(function () {
        $modal.find('input[type="radio"]:checked').prop("checked", false);
        $modal.find("textarea.form-control").val('');
    });

    $(".persona-reviewNrating .head-panel").find("button.writeReview").click(function () {
        $modal.find('input[type="radio"]:last').prop("checked", true);
    });
    $modal.find(".rating label").click(function () {
        var id = $(this).attr("for");
        $modal.find('.rating').children("#"+id).prop('checked', true);
    });
    $('.rating label').click(function(e){e.preventDefault();e.stopPropagation()});

});

function createTeamSlider() {

    teamSlickSlider = $('.team-member-slider').slick({
        infinite: true,
        slidesToShow: 3,
        slidesToScroll: 3,
        centerPadding: '30px',
        dots: true,

        responsive: [
            {
                breakpoint: 1024,
                settings: {
                    slidesToShow: 3,
                    slidesToScroll: 3,
                    infinite: true,
                    dots: true
                }
            },
            {
                breakpoint: 600,
                settings: {
                    slidesToShow: 2,
                    slidesToScroll: 2
                }
            },
            {
                breakpoint: 480,
                settings: {
                    slidesToShow: 1,
                    slidesToScroll: 1
                }
            }
        ]
    });
}

var teamCounter = 0;
function compileTeamMemberTemplate(members){
    var membersData = {'counter':++teamCounter};
    if(members) {
        membersData = members;
        $.each(members, function (i, v) {
            membersData.counter = teamCounter;
        });
        compileTeamTemplate(membersData);
    }
}

function compileTeamTemplate(membersData) {
    var teamMemberTemplate = $("#add-team-inner-template").html();
    teamMemberTemplate = Handlebars.compile(teamMemberTemplate);
    $("#addTeamTemplate").append(teamMemberTemplate(membersData));
}

var locationCounter = 0;
function compileLocationMapTemplate(locations, isNew){
    var locationsData = {'counter':++locationCounter};
    var locationMapTemplate = $("#add-location-inner-template").html();
    if((locationMapTemplate && locations) || (locationMapTemplate && isNew)) {
        locationMapTemplate = Handlebars.compile(locationMapTemplate);
        locationsData = isNew ? {} : locations;
        $("#addLocationTemplate").append(locationMapTemplate(locationsData));
    }
}

$(document).on('click', 'div.remove-location', function(){
    $(this).parent("div.add-loc-info-part").remove();
});



function viewAllFocusSectors(id,title){
    bootbox.dialog({
        title: title,
        message: $("#"+id).html(),
        onEscape: true,
        className: 'view-all-focus-sectors tag-view',

    });
    $(".bootbox.modal.fade.view-all-focus-sectors.tag-view .modal-content .modal-body").mCustomScrollbar({
        'autoHideScrollbar': true,
        theme: "dark",
        scrollButtons: {
            enable: true
        }
    });
}

function changeImage(title, resolution){
    var template = Handlebars.compile($("#change-image-template").html())
    bootbox.dialog({
        title: 'Change ' + (title ? title.charAt(0).toUpperCase()+title.slice(1) : '') + ' Image',
        message: template({'title':title,'resolution':resolution}),
        onEscape: true,
        className: 'view-all-focus-sectors designer-cta text-center',
        buttons: {
            OK: {
                label: 'Upload',
                className: 'button',
                callback: upload
            },
        }
    });
}

$(document).on('change', 'div.add-employee-sec input[name=dp-image]', function(e){
    upload($('div.add-employee-sec input[name=dp-image]'), e);
});

upload = function(targetEle, e, callback){
    var targetName;
    var file;
    var description;
    if(e && $(e.target).is(':file')){
        targetName = $(e.target).prop("name");
        file = e.target.files[0];
    } else {
        if(targetEle instanceof $.Event){
            targetName = $(this).find("input[type='file']")[0].name;
            file = $(this).find('input[name="'+targetName+'"]')[0].files[0];
            description = $(this).find('input[name="imageDesc"]').val();
        }else{
            targetName = $(targetEle).prop('name');
            file = $(targetEle).prop('files')[0];
        }
    }

    var filename = file ? file.name : "";
    var personaType = store.getItem("role");
    if (file && validateFile(targetName, file)) {
        var apiPath = SIH.getEndPoint("/api/file/");

        if (targetName.includes('cover')) {
            apiPath = apiPath + "user/cover/image/" + personaType;
        } else if (targetName === 'image') {
            apiPath = apiPath + "user/image/" + personaType;
        } else if (targetName === 'dp-image') {
            apiPath = apiPath + "member/pic";
        } else if (targetName === 'storyStartupLogo') {
            apiPath = apiPath + "user/image/" + personaType;
        } else if(targetName === 'galleryImage'){
            apiPath = apiPath+"user/gallery"
        }else {
            apiPath = apiPath + "user/doc/" + personaType;
        }

        var data = new FormData();
        data.append("file", file);
        $('#modal-loader').modal("show");
        $.ajax({
            url: apiPath,
            type: 'POST',
            data: data,
            cache: false,
            contentType: false,
            processData: false,
            success: function (fileInfo) {
                $('#modal-loader').modal("hide");
                if (fileInfo) {
                    if (targetName.includes('cover')) {
                        profileData[targetName] = fileInfo.name;
                        $(".user-profile-banner-wrapper").css("background-image", 'url(' + imageContent + ')');
                    } else if (targetName === 'dp-image') {
                        $(e.target).siblings("input[name=pic]").val(fileInfo.name);
                        $(e.target).siblings("span.square")
                            .css({"background-image": "url(" + imageContent + ")", "background-size": "100% auto"});
                        $(e.target).siblings("span.caption").text("Change Photo");
                    } else if (targetName === 'image') {
                        profileData[targetName] = fileInfo.name;
                        $(".user-profile-banner .image-section img").attr('src', imageContent);
                    } else if (targetName == 'storyStartupLogo') {
                        callback(fileInfo.name);
                    }  else if(targetName === 'galleryImage'){
                        fileInfo.originalFilename = filename;
                        fileInfo.description = description;
                        addImageAfterUpload(fileInfo)
                    }else {
                        if (profileData.startup.businessPlan) {
                            profileData.startup.businessPlan.push({
                                'title': businessDocTitle,
                                'fileName': fileInfo.name
                            });
                        } else {
                            profileData.startup.businessPlan = [{
                                'title': businessDocTitle,
                                'fileName': fileInfo.name
                            }];
                        }

                        personaDocuments(profileData);
                        $(".e-edit").removeClass("hidden");
                    }
                }
            }, error: function (data) {
                $('#modal-loader').modal("hide");
                alert("Error while uploading file :-The file is corrupt and cannot be uploaded");
            }
        });
    }else{
        if (targetName == 'storyStartupLogo') {
            callback($("#upload-startuplogo").data("filename"));
        }
        $(".businessDocsUploadDiv").find("span.text-danger").removeClass("display-n");
        if (targetName == 'galleryImage') {
            $(".gallery-image-error").removeClass("display-n");
            $(".gallery-image-error").removeClass("display-n");
        }
        return false;
    }
}

function addVideoAction() {
    var tabId= $("#gallery .tab-content .tab-pane.active").attr("id");
    var videoLink = $("[name=galleryVideo]").val();
    if(videoLink) {
        $("#videoUploadDiv div.text-danger").addClass("display-n");
        var videoThumbnail = "https://img.youtube.com/vi/" + getYoutubeVideoId(videoLink) + "/0.jpg";
        var video = "<a href='" + videoThumbnail + "' data-group='"+tabId+"' class='html5lightbox'>\n" +
            "<span class=\"cross-icon e-edit\" onclick=\"removeImageFromGallery(event)\"></span>" +
            "                <img src=" + videoThumbnail + " data-id=" + videoLink + " class='video gallery-item'>\n" +
            "            </a>";
        var isImageExists = $("#gallery .tab-content .tab-pane.active .galleryImageDiv .mCSB_container");
        $("#gallery .tab-content .tab-pane.active .galleryImageDiv .no-content-msg").remove();
        if(isImageExists.length){
            $("#gallery .tab-content .tab-pane.active .galleryImageDiv .mCSB_container").append(video);
        }else{
            $("#gallery .tab-content .tab-pane.active .galleryImageDiv").append(video);
            $("div.galleryImageDiv").mCustomScrollbar({
                'autoHideScrollbar': false,
                theme: "dark",
                scrollButtons: {
                    enable: true
                }
            });
        }
        //updateUserGallery();
    }else{
        $("#videoUploadDiv div.text-danger").removeClass("display-n");
        return false;
    }
}

function addImageAfterUpload(fileInfo) {
    var tabId= $("#gallery .tab-content .tab-pane.active").attr("id");
    var desc;
    var description = fileInfo.description === 'undefined' ? '' : fileInfo.description;
    if(fileInfo.description) {
        desc = fileInfo.description.replace(/ /g, "_");
    }

    var imagePath = SIH.getEndPoint("/api/file/user/gallery?fileName=" + fileInfo.name);
    var thumbnailPath = SIH.getEndPoint("/api/file/user/gallery?fileName=" + fileInfo.compressedName);
    var image = "<a href='" + imagePath + "' data-group='"+tabId+"' class='html5lightbox'>\n" +
        "<span class=\"cross-icon e-edit\" onclick=\"removeImageFromGallery(event)\"></span>" +
        "                <img src=" + thumbnailPath + " data-id=" + fileInfo.name + " data-thumbnail=" + fileInfo.compressedName + " data-description=" + desc + " class='gallery-item'>\n" +
        "            <div id=\"imgdesc\">" +description+ "</div></a>";
    var isImageExists = $("#gallery .tab-content .tab-pane.active .galleryImageDiv .mCSB_container");
    $("#gallery .tab-content .tab-pane.active .galleryImageDiv .no-content-msg").remove();
    if(isImageExists.length){
        $("#gallery .tab-content .tab-pane.active .galleryImageDiv .mCSB_container").append(image);
    }else{
        $("#gallery .tab-content .tab-pane.active .galleryImageDiv").append(image);
        $("div.galleryImageDiv").mCustomScrollbar({
            'autoHideScrollbar': false,
            theme: "dark",
            scrollButtons: {
                enable: true
            }
        });
    }
    //updateUserGallery();
}

function removeImageFromGallery(e) {

    $(".modal.del-gallery-image-confirmation-modal").modal('show');

    var modalConfirm = function(callback){
        $("#go-ahead").off().on("click", function(){
            callback(true);
            $(".modal.del-gallery-image-confirmation-modal").modal('hide');
        });

        $("#dont-delete").off().on("click", function(){
            callback(false);
            $(".modal.del-gallery-image-confirmation-modal").modal('hide');
        });
    };

    modalConfirm(function(confirm){
        if(confirm){
            $(e.target).closest(".html5lightbox").remove();
            //updateUserGallery($(e.target).parent(".html5lightbox").data("group"));
        }
    });

    e.preventDefault();
    e.stopPropagation();
}

function updateUserGallery(tabId){
    var galleryJson = {};
    $(".tab-content.gallery-tab-content .tab-pane").each(function (index, val) {
        var tabItemArray = [];
        $(this).find("a img.gallery-item").each(function (i, v) {
            var galleryItem = {};
            if($(this).hasClass('video')){
                galleryItem.videoURL = $(this).data("id");
            }else {
                galleryItem.fileName = $(this).data("id");
                galleryItem.thumbnail = $(this).data("thumbnail");
                var description = $(this).data("description") === 'undefined' ? '' : $(this).data("description");
                if(description!='') {
                    var desc = $(this).data("description").replace(/_/g, " ");
                    galleryItem.description = desc;
                }
            }
            galleryItem.title = $(this).data("title");
            tabItemArray.push(galleryItem);
        });
        galleryJson[$(this).attr('id')] = tabItemArray;
    });

    if(tabId && galleryJson[tabId].length <= 0){
        $("div.galleryImageDiv").mCustomScrollbar("destroy");
        $("#gallery .tab-content .tab-pane.active .galleryImageDiv")
            .html("<p class=\"no-content-msg\">No image or video has been uploaded yet.</p>");
    }

    $.ajax({
        type: "POST",
        url: SIH.getEndPoint("/api/auth/user/updateUserGallery"),
        data: JSON.stringify(galleryJson),
        dataType: 'json',
        contentType: "application/json",
        processData: false,
        headers: {"X-Auth-Token": store.getItem("token")}
    }).done(function (response) {
        $(".html5lightbox").html5lightbox();
    });
}
$(document).on('change', "#imageUploadDiv input[type='file'], .inner-add-info input[type=file], #upload-startuplogo", function(e){
    $("#imageUploadDiv img").remove();

    var reader = new FileReader();

    reader.onload = function(e) {
        imageContent = e.target.result;
        if(store.getItem("role")){
            $("form[name=storyForm]").find("span.square")
                .css({"background-image": "url(" + imageContent + ")", "background-size": "100% auto"});
        }
        $('<img>').attr({src: e.target.result}).prependTo("#imageUploadDiv");
    }

    reader.readAsDataURL($(this)[0].files[0]);
});


$(document).on('click', 'button.addBusinessDocsBtn', function(){
    var template = Handlebars.compile($("#add-business-documents-template").html())
    bootbox.dialog({
        title: 'Add business document',
        message: template(),
        onEscape: true,
        className: 'view-all-focus-sectors designer-cta',
        buttons: {
            upload: {
                label: 'Upload',
                className: 'button',
                callback: upload
            },
        }
    });

    $('input[name="doctitle"]').on('input', function(){
        businessDocTitle = $(this).val();
    });
});

$(document).on('click', 'a.add-social' ,function(){
    $(this).closest('div.edit-inner').next('div.social-edit').slideDown('2000');
    $(this).parent().hide();
    $("div.persona-profile-social-wrapper .preview-profile").hide();
});

function validateFile(targetName, file) {

    var allowedExtensionsForImage = ["image/png", "image/jpeg", "image/jpg"];
    var allowedExtensionsForFile = ["application/pdf", "application/vnd.ms-excel",
        "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet", "application/vnd.openxmlformats-officedocument.wordprocessingml.document", "application/msword",
        "application/vnd.openxmlformats-officedocument.presentationml.presentation", "application/vnd.ms-powerpoint"];
    var maxFileSizeInBytes = 2097152;
    var maxImageSizeInBytes = 1048576;
    if ($('input[name="'+targetName+'"]').hasClass("file")) {
        if ($.inArray(file.type, allowedExtensionsForFile) < 0) {
            alert("Supported Formats for file uploads are: " + allowedExtensionsForFile.join(" , "));
            return false;
        }
        if (file.size > maxFileSizeInBytes) {
            alert("Maximum file size allowed is 2 MB ");
            return false;
        }
    } else {
        if ($.inArray(file.type, allowedExtensionsForImage) < 0) {
            alert("Supported Formats for file uploads are: " + allowedExtensionsForImage.join(" , "));
            return false;
        }
        if (file.size > maxImageSizeInBytes) {
            alert("Maximum file size allowed is 1 MB ");
            return false;
        }
    }
    return true;
}

$(document).on('click', '#save-button', function(event){
    if(validateIdeaBrief(event)){
        $('textarea[name=ideaBrief]').summernote("destroy");
        $('div.read').html($('textarea[name=ideaBrief]').val());
        $('div.read').show();
        $('[name=ideaBrief]').hide();
        $('#save-button').addClass('hidden');
        $('#edit-button').show();

        if($('div.read').height()>90){
            $(this).parents("div.more-content").addClass('more-content-height-fixed');
            $(this).parents("div.more-content").siblings("a.read-desc").removeClass("hidden");
            $(this).siblings('.more-content-foot').css("display", "block");
        }

        $(".attr-edit").toggleClass("hidden");

        if(profileData.startup){
            profileData.startup.ideaBrief = $('div.read').html();
        }else{
            profileData.description = $('div.read').html();
        }
        // personaAttributes(profileData);
    }
});

function validateIdeaBrief(e){
    var valid = false;
    if($('textarea[name=ideaBrief]').val().replace(/<[^>]*>/g, "").trim() || $('div.read').html()){
        $('textarea[name=ideaBrief]').siblings(".text-danger").addClass("display-n");
        valid = true;
    }else{
        $('textarea[name=ideaBrief]').siblings(".text-danger").removeClass("display-n");
        window.scrollTo({ top: $('.note-editable').offset().top - 200, behavior: 'smooth' });
    }
    return valid;
}

function editor(e){
    $('div.read').hide();
    $('[name=ideaBrief]').summernote(personaJSON);
    $('textarea[name=ideaBrief]').summernote('code', $('div.read').html());
    $('div.read').html("");
    $('#edit-button').hide();
    $('#save-button').removeClass('hidden');
    //$(".attr-edit").toggleClass("hidden");
    $(e.target).parents("div.more-content").removeClass('more-content-height-fixed');
    $(e.target).parents("div.more-content").siblings("a.read-desc").addClass("hidden");
    $(e.target).parents("div.more-content").siblings("a.readLess").addClass("hidden");
    $(e.target).siblings('.more-content-foot').css("display", "none");
}

function editStory(e, storyIndex){
    var source = $("#storyFormTemplate").html();
    if(source){
        var template = Handlebars.compile(source);
        var data = {};
        data.portfolio = profileData.portfolios ? profileData.portfolios[storyIndex] : {};
        data.role = profileData.role;
        $("div.success-stories-container .story-form").html(template(data));
        $('textarea[name=storyGuidanceAreas]').summernote(personaJSON);
        $('textarea[name=storyBrief]').summernote(personaJSON);
        $("#save-story-btn").data("storyIndex", storyIndex);
        $("input[name=storyStartupEntryDate]").datepicker({
            "showButtonPanel": true,
            closeText: 'Clear',
            changeMonth: true,
            changeYear: true,
            yearRange: "c-50:c+10"
        });
    }

    $('div.success-stories-container .story-list').remove();
    $('.success-stories-container .story-form').removeClass('hidden');
}

function delStory(storyIndex) {
    event.stopPropagation();
    event.preventDefault();
    var modalConfirm = function(callback){
        $("#modal-btn-yes").off().on("click", function(){
            callback(true);
            $(".modal.confirmation-modal").modal('hide');
        });

        $("#modal-btn-no").off().on("click", function(){
            callback(false);
            $(".modal.confirmation-modal").modal('hide');
        });
    };

    modalConfirm(function(confirm){
        if(confirm){
            profileData.portfolios.splice(storyIndex, 1);
            $('div.success-stories-container .story-list').remove();
            personaSuccessStories(profileData, true);
        }
    });
}

$(document).on('click', '#save-story-btn', function () {
    var storyIndex = $(this).data("storyIndex");
    if(validateStory()) {
        if(store.getItem("role") == "Incubator" || store.getItem("role") == "Accelerator"|| store.getItem("role") == "Corporate") {
            upload($("#upload-startuplogo"), null, function (filename) {

                updateStory(storyIndex, filename);


            });
        }else if(store.getItem("role") == "Mentor"){
            updateStory(storyIndex);
        }
    }

    function updateStory(storyIndex, filename){
        if(storyIndex){
            profileData.portfolios[storyIndex] = {
                brief: $('textarea[name=storyBrief]').summernote('code'),
                sihProfileUrl: $("input[name=storySihProfileUrl]").val(),
                startupName: $("input[name=storyStartupName]").val(),
                url: $("input[name=storyWebsiteUrl]").val(),
                guidanceAreas: $('textarea[name=storyGuidanceAreas]').length ? $('textarea[name=storyGuidanceAreas]').summernote('code').replace(/<[^>]*>/g, "").trim() : "",
                startupLogo: filename ? filename : "",
                startupEntryDate: $("input[name=storyStartupEntryDate]").length ? $("input[name=storyStartupEntryDate]").val() : ""
            }
        } else {
            profileData.portfolios = Array.isArray(profileData.portfolios) ? profileData.portfolios : [];
            profileData.portfolios.push({
                brief: $('textarea[name=storyBrief]').summernote('code'),
                sihProfileUrl: $("input[name=storySihProfileUrl]").val(),
                startupName: $("input[name=storyStartupName]").val(),
                url: $("input[name=storyWebsiteUrl]").val(),
                guidanceAreas: $('textarea[name=storyGuidanceAreas]').length ? $('textarea[name=storyGuidanceAreas]').summernote('code') : "",
                startupLogo: filename ? filename : "",
                startupEntryDate: $("input[name=storyStartupEntryDate]").length ? $("input[name=storyStartupEntryDate]").val() : ""
            });
        }
        $('textarea[name=storyGuidanceAreas]').summernote('destroy');
        $('textarea[name=storyBrief]').summernote('destroy');

        $("div.success-stories-container .story-form").html("");

        personaSuccessStories(profileData, true);

        $('.success-stories-container .story-form').addClass('hidden');
    }

    $(".success-stories-container .story-list").mCustomScrollbar({
        'autoHideScrollbar': false,
        theme: "dark",
        scrollButtons: {
            enable: true
        }
    });
});

$(document).on('click', '#cancel-story-btn', function () {
    personaSuccessStories(profileData, true);
    $('.success-stories-container .story-form').addClass('hidden');
    $(".success-stories-container .story-list").mCustomScrollbar({
        'autoHideScrollbar': false,
        theme: "dark",
        scrollButtons: {
            enable: true
        }
    });
});

function validateStory() {
    var isValid = true;
    $("form[name=storyForm] input[data-member=true],form[name=storyForm] textarea[data-member=true]").each(function(i) {
        if($(this).prop('required')){
            if(!$(this).val()){
                console.log($(this));
                $(this).siblings("div.text-danger").removeClass("display-n");
                if(i == 0){
                    $(this).focus();
                }
                isValid = false;
            }else{
                $(this).siblings("div.text-danger").addClass("display-n");
            }
        }
    });
    return isValid;
}

$(document).on("click", "#add-story-button", function(e){
    editStory();
});

function removeBuzDoc(event, fileName){
    $.each(profileData.startup.businessPlan, function(i, v) {
        if (v.fileName == fileName) {
            profileData.startup.businessPlan.pop(v);
        }
    });

    personaDocuments(profileData);
}

function validateUrl(inputField) {
    var res = true;
    var re = /((http(s)?(\:\/\/))+(www\.)?([\w\-\.\/])*(\.[a-zA-Z]{2,3}\/?))[^\s\b\n|]*[^.,;:\?\!\@\^\$ -]/g;
    if ($(inputField).val()  && !re.test($(inputField).val())) {
        $(inputField).closest(".input-group").siblings("span.text-danger").removeClass("display-n");
        $(inputField).focus();
        res = false;
    }else{
        $(inputField).closest(".input-group").siblings("span.text-danger").addClass("display-n");
    }
    return res;
}

$(document).on('click', '.social-edit button', function(){
    var twitter = $("input[name='twitterInput']");
    var linkedin = $("input[name='linkedinInput']");
    var facebook = $("input[name='facebookInput']");

    if(profileData.startup){
        profileData.startup.socialInfos = [];
    }else{
        profileData.socialInfos = [];
    }

    if (twitter.val() && validateUrl(twitter)) {
        if(profileData.startup){
            profileData.startup.socialInfos.push({'social':'Twitter','url':twitter.val()});
        }else{
            profileData.socialInfos.push({'social':'Twitter','url':twitter.val()});
        }
    }
    if (linkedin.val() && validateUrl(linkedin)) {
        if(profileData.startup){
            profileData.startup.socialInfos.push({'social':'Linkedin','url':linkedin.val()});
        }else{
            profileData.socialInfos.push({'social':'Linkedin','url':linkedin.val()});
        }
    }
    if (facebook.val() && validateUrl(facebook)) {
        if(profileData.startup){
            profileData.startup.socialInfos.push({'social':'Facebook','url':facebook.val()});
        }else{
            profileData.socialInfos.push({'social':'Facebook','url':facebook.val()});
        }
    }
    if(validateUrl(twitter) && validateUrl(linkedin) && validateUrl(facebook)){
        personaSocialInfo(profileData);

        $(this).closest('div.social-edit').slideUp('1000');
        $("div.persona-profile-social-wrapper .preview-profile").removeClass("hidden");
        $("div.persona-profile-social-wrapper .edit-profile").removeClass("hidden");
    }
});

$(document).on('click', '#save-incubatees-button', function(){
    var currincubatees = $("input[name='currincubatees']");
    var gradincubatees = $("input[name='gradincubatees']");
    if (currincubatees.val()!=null) {
        profileData.numberOfIncubatees=currincubatees.val();
    }
    if (gradincubatees.val() !=null) {
        profileData.numberOFIncubateesGraduated=gradincubatees.val();
    }
    personaIncubateeDetails(profileData, true);
    $("#edit-incubatees-button").removeClass("hidden");
});

$(document).on('click', '#save-location-button', function(){
    saveLocation();
});


$(document).on('click', '#edit-incubatees-button', function(){
    $(".incubatees").toggleClass("hidden");
    $("#edit-incubatees-button").addClass("hidden");

});

$(document).on('click', '#edit-location-button', function(){
    $(".locationshowhide").toggleClass("hidden");
    $("#edit-location-button").toggleClass("hidden");

});

function saveLocation() {
    if(profileData){
        profileData.centerLocations = [];
        var valRes= true;
        $(".person-loc-map-content-placeholder .add-loc-info-part").each(function(i,v){
            var locationObj = {};
            var incubCentLocVal = $(this).find("input[name=incubationCenterLocation]").val();
            var incubCentLocAddrVal = $(this).find("input[name=incubatorCenterLocationAddress]").val();
            if((!incubCentLocVal && incubCentLocAddrVal) || (incubCentLocVal && !incubCentLocAddrVal)){
                if(!incubCentLocVal){
                    $(this).find("input[name=incubationCenterLocation]").siblings("span.text-danger").removeClass("display-n");
                    $(this).find("input[name=incubatorCenterLocationAddress]").siblings("span.text-danger").addClass("display-n");
                }else if(!incubCentLocAddrVal){
                    $(this).find("input[name=incubatorCenterLocationAddress]").siblings("span.text-danger").removeClass("display-n");
                    $(this).find("input[name=incubationCenterLocation]").siblings("span.text-danger").addClass("display-n");
                }
                valRes = false;
            }
            if(valRes){
                if($(this).find("input[name=incubationCenterLocation]").val() && $(this).find("input[name=incubatorCenterLocationAddress]").val()) {
                    locationObj.incubationCenterLocation = $(this).find("input[name=incubationCenterLocation]").val();
                    locationObj.incubatorCenterLocationAddress = $(this).find("input[name=incubatorCenterLocationAddress]").val();
                    profileData.centerLocations.push(locationObj);
                }
            }
        });
        if(valRes) {
            if (profileData.centerLocations) {
                personaLocation(profileData, true);
            }
            $(".locationshowhide").toggleClass("hidden");
            $("#edit-location-button").toggleClass("hidden");
        }
    }
}

$(document).on('change', 'div.swipe-btn input[type=checkbox]', function(){
    if(this.checked){
        $(this).closest("div.inner-add-info")
            .siblings(".add-social-link")
            .children("input[name="+$(this)
                .data('switch')+"]").removeClass("display-n");
    }else{
        $(this).closest("div.inner-add-info")
            .siblings(".add-social-link")
            .children("input[name="+$(this)
                .data('switch')+"]").addClass("display-n").val("");
        $(this).closest("div.inner-add-info")
            .siblings(".add-social-link").children(".text-danger").addClass("display-n");
    }
});

$(document).on('click', 'div.remove-member', function(){
    $(this).parent("div.add-info-part").remove();
});

function saveTeam() {
    if(validateTeamForm()){
        if(profileData.startup){
            profileData.startup.members = [];
        }else if(profileData){
            profileData.members = [];
        }
        if(profileData){
            var memberInfo = $("div.add-employee-sec").find("div.add-info-part");
            $(memberInfo).each(function(i,v){
                var memberObj = {};
                memberObj.socialInfos = [];
                $(this).find("input[data-member='true'], textarea[data-member='true'], input[data-member='true']:hidden").each(function () {
                    if($(this).val()){
                        if($(this).prop('name') === 'Twitter' || $(this).prop('name') === 'Linkedin'){
                            var socialObj = {};
                            socialObj.social = $(this).prop('name');
                            socialObj.url = $(this).val();
                            memberObj.socialInfos.push(socialObj);
                        }else{
                            memberObj[$(this).prop('name')] = $(this).val();
                        }
                    }
                });
                if(profileData.startup && profileData.startup.members){
                    profileData.startup.members.push(memberObj);
                }else if(profileData.members){
                    profileData.members.push(memberObj);
                }
            });
            $("#addTeamTemplate").html("");
            if(profileData.startup && profileData.startup.members){
                $.each(profileData.startup.members, function(i,v){
                    compileTeamMemberTemplate(v);
                });
            }else if(profileData.members){
                $.each(profileData.members, function(i,v){
                    compileTeamMemberTemplate(v);
                });
            }
            var userData = {};
            userData.user = profileData;
            loadMembers(userData);
            //showSnackbar();
        }
        return true;
    }else{
        return false;
    }
}

function validateTeamForm(){
    var res = true;
    $("div.add-employee-sec").find("div.add-info-part").each(function(){
        $(this).find("input[data-member='true'], textarea[data-member='true']").each(function () {
            if($(this).prop('required')){
                if(!$(this).val()){
                    $(this).siblings("span.text-danger").removeClass("display-n");
                    $(this).focus();
                    res = false;
                }else{
                    $(this).siblings("span.text-danger").addClass("display-n");
                }
            }
            if($(this).attr("name") === 'Twitter' || $(this).attr("name") === 'Linkedin'){
                var re = /((http(s)?(\:\/\/))+(www\.)?([\w\-\.\/])*(\.[a-zA-Z]{2,3}\/?))[^\s\b\n|]*[^.,;:\?\!\@\^\$ -]/g;
                if (!$(this).hasClass("display-n") && !re.test($(this).val()) && $(this).val().length > 0) {
                    //alert("url error");
                    $(this).siblings("span.text-danger").removeClass("display-n");
                    $(this).focus();
                    res = false;
                }else{
                    $(this).siblings("span.text-danger").addClass("display-n");
                }
            }
        });
    });
    return res;
}
function showSnackbar(message, classname, showtime) {
    $("#snackbar").addClass("show");
    $("#snackbar").addClass(classname);

    if(message){
        $("#snackbar").html(message);
    }

    setTimeout(function(){
        $("#snackbar").removeClass("show");
        $("#snackbar").removeClass(classname);
    }, showtime || 7000);
}

$(document).on("click", "span a[name=profile-save-changes],button[name=profile-save-changes]", function(event){
    if(validateIdeaBrief() && saveTeam()) {
        $('#modal-loader').modal("show");
        if (profileData.startup && profileData.startup.dippNumber === "") {
            profileData.startup.dippNumber = null;
        }
        var $target = $(event.target);
        var path = $target.data("path");
        path = path + store.getItem("role").toLowerCase();
        if (path) {
            $.ajax({
                type: "POST",
                url: SIH.getEndPoint(path),
                data: JSON.stringify(profileData),
                dataType: 'json',
                contentType: "application/json",
                processData: false,
                headers: {"X-Auth-Token": store.getItem("token")}
            }).done(function (response) {
                $('#modal-loader').modal("hide");
                $('.thankyou-modal .modal-body .heading').html("Success");
                /*if(response.role == "Startup"){
                    $('.thankyou-modal .modal-body p')
                        .html('Your profile has been updated successfully.');
                }else {
                    $('.thankyou-modal .modal-body p')
                        .html('Your profile has been submitted. Your changes will reflect once approved');
                }*/
                $('.thankyou-modal .modal-body p')
                    .html('Your profile has been updated successfully.');
                $('.thankyou-modal').modal('show');
            }).fail(function (xhr) {
                $('#modal-loader').modal("hide");
                var res = JSON.parse(xhr.responseText);
                showSnackbar(res[0].defaultMessage);
                //alert("something went wrong");
            });
        }

        updateUserGallery();
    }
});

function editProfile(e){
    $('#modal-loader').modal("show");

    var updateProfileAPI = SIH.getEndPoint("/api/auth/user/edit/profile");
    $.ajax({
        url: updateProfileAPI,
        type: "GET",
        headers: {"X-Auth-Token": store.getItem("token")},
        datatype: "json",
        success: function (response) {
            profileData = response;
            setTimeout(function () {
                $(".e-edit").toggleClass("hidden");
                $('#modal-loader').modal("hide");
                $(e.target).hide();
            }, 500);
        },
        error: function (response) {
            $('#modal-loader').modal("hide");
            if (response.status == 403) {
                showSnackbar('<i class="fa-2x fa-info-circle"></i>Your profile is under moderation. Please try later once your profile is active.', "alert-info");
            } else {
                showSnackbar('<i class="fa-2x fa-exclamation-triangle"></i>Something went wrong. We are unable to fetch the profile. Please try later.', "alert-danger");
            }
        }
    });
}

function discardChanges(){
    location.reload(true);
}

$(document).on('click' ,'div.member-slider-wrap div.member', function () {
    var data = $(this).data('member');
    loadFirstMember(data, true);
});

$(document).ready(function(){
    $(".profile-vertical-tab-container .static-content-section, .success-stories-container .story-list").mCustomScrollbar({
        'autoHideScrollbar': false,
        theme: "dark",
        scrollButtons: {
            enable: true
        }
    });

    $('.profile-vertical-tab-container.mentor .static-content-section').mCustomScrollbar('destroy');



});

$(document).ajaxStart(function(){
    // Show image container
    $("#loader").show();
});
$(document).ajaxComplete(function(){
    // Hide image container
    $("#loader").hide();
});

$(document).ready(function(){
    $('.allReviews hr.empty').remove();


});

$(window).on('load', function(){
    $(".profile-vertical-tab-container .static-content-section, .success-stories-container .story-list").mCustomScrollbar({
        'autoHideScrollbar': false,
        theme: "dark",
        scrollButtons: {
            enable: true
        }
    });
    // ============
    $('.allReviews').slick({
        infinite: true,
        slidesToShow: 1,
        slidesToScroll: 1,
        dots: true,

    });
});
$(document).ready(function () {
    var pageNumber = 0;
    var searchTerm = getUrlParameter('source');
    var searchPage = $('.notification-container').attr('search-page');
    if (searchTerm) {
        $('#search-listing-input').val(searchTerm);

        if (!(sessionStorage.getItem("tokenValidity") &&
            (new Date().getTime() >= parseInt(sessionStorage.getItem("tokenValidity"))))) {

            getToken();
        }
        getSearch(sessionStorage.getItem("searchToken"));
        getRelatedResult(sessionStorage.getItem("searchToken"));
    }

    $(document).on('keyup', 'input#search-listing-input', function (e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code === 13) { //Enter keycode
            var searchListingInput = $('#search-listing-input').val();
            ga('set', 'metric1', 1);
            var dimensionValue = searchListingInput;
            ga('set', 'dimension1', dimensionValue);
            ga("send", "pageview");
            searchTerm = searchListingInput;
            //getToken();
            // window.location = "http://10.1.201.4:4502/content/sih/en/search-listing.html?wcmmode=disabled&source="+searchListingInput
            location.href = location.protocol + '//' + location.hostname + (location.port ? ':' + location.port : '') + searchPage + '.' + 'html' + (location.port ? '?wcmmode=disabled&' : '?') + 'source=' + searchListingInput
        }
    });

    function getSearch(token) {
        var req = {
            "maxResults": 10,
            "pageNumber": 0,
            "searchTerm": searchTerm,
            "domainGroup": "INTERNAL",
            "webPageType": ""
        };
        var reqExt = {
            "maxResults": 3,
            "pageNumber": 0,
            "searchTerm": searchTerm,
            "domainGroup": "EXTERNAL",
            "webPageType": ""
        };
        var reqDocs = {
            "maxResults": 3,
            "pageNumber": 0,
            "searchTerm": searchTerm,
            "domainGroup": "EXTERNAL",
            "webPageType": "DOC"
        };

        getInternalSearchResult(req, token);

        $.ajax({
            url: "https://search.startupindia.gov.in/search-api/v1/search",
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "apiKey": token
            },
            data: JSON.stringify(reqExt),
            success: function (data) {
                var template_source = $("#search-result-related-listing-template").html();
                var listingTemplate = Handlebars.compile(template_source);
                searchlist = $('#search-list-right').html(listingTemplate(data.data));
                $(".modal.loader").modal("hide");
            }
        });

        $.ajax({
            url: "https://search.startupindia.gov.in/search-api/v1/search",
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "apiKey": token
            },
            data: JSON.stringify(reqDocs),
            success: function (data) {
                var template_doc_source = $("#search-related-result-template").html();
                var docsTemplate = Handlebars.compile(template_doc_source);
                $('.document .search-related').html(docsTemplate(data.data));
                $(".modal.loader").modal("hide");
            }
        });
    }

    function getInternalSearchResult(req, token) {
        $(".modal.loader").modal("show");
        $.ajax({
            url: "https://search.startupindia.gov.in/search-api/v1/search",
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "apiKey": token
            },
            data: JSON.stringify(req),
            success: function (data) {
                var source = $('#search-result-listing-template').html();
                var template = Handlebars.compile(source);
                $('#search-list').append(template(data.data));
                if ((parseInt(data.data.searchInformation.pageNumber + 1) * 10) < parseInt(data.data.searchInformation.totalResults)) {
                    $(".search-load-more").removeClass('display-n');
                } else {
                    $(".search-load-more").addClass('display-n');
                }
                $(".modal.loader").modal("hide");
            }
        });
    }

    function getRelatedResult(token) {
        var settings = {
            "url": "https://search.startupindia.gov.in/search-api/v1/trendingTerms?maxResults=10&country=India",
            "method": "GET",
            "headers": {
                "apiKey": token,
                "Content-Type": "application/json"
            },
            "processData": false
        }
        $.ajax(settings).done(function (response) {
            //console.log(response);
            var source = $('#search-related-trending-result-template').html();
            var template = Handlebars.compile(source);
            $('.terms .search-related').html(template(response.data));
        });
    }

    $("#loadmore-search").on('click', function () {
        ++pageNumber;
        var req = {
            "maxResults": 10,
            "pageNumber": pageNumber,
            "searchTerm": searchTerm,
            "domainGroup": "INTERNAL",
            "webPageType": ""
        };

        if (!(sessionStorage.getItem("tokenValidity") &&
            (new Date().getTime() >= parseInt(sessionStorage.getItem("tokenValidity"))))) {
            getToken();
        }

        getInternalSearchResult(req, sessionStorage.getItem("searchToken"));
    });

    function getToken() {
        var d = {"password": "Test@123", "userName": "investindia@gmail.com"};
        $.ajax({
            type: "POST",
            url: "https://search.startupindia.gov.in/search-api/v1/getAuthToken",
            contentType: "application/json",
            data: JSON.stringify(d),
            success: function (data) {
                sessionStorage.setItem("searchToken", data.data);
                sessionStorage.setItem("tokenValidity", (new Date()).getTime() + 3000000);
            }
        });
    }
});


$(document).ajaxStop(function() {
    /*$(".preload").fadeOut(function() {
        $(".onload").fadeIn();
    });*/
});


var html5lightbox_options = {
    skinsfoldername: "/etc/designs/invest-india/investindialibs/images",
    initvimeo: false
};



(function (factory) {
  'use strict';
  if (typeof define === 'function' && define.amd) {
      // AMD. Register as an anonymous module.
      define(['jquery'], factory);
  } else if (typeof module === 'object' && module.exports) {
      // Node/CommonJS
      module.exports = factory(require('jquery'));
  } else {
      // Browser globals
      factory(jQuery);
  }
}(function ($) {
  'use strict';
  var caretClass   = 'textarea-helper-caret'
    , dataKey      = 'textarea-helper'

    // Styles that could influence size of the mirrored element.
    , mirrorStyles = [ 
                       // Box Styles.
                       'box-sizing', 'height', 'width', 'padding-bottom'
                     , 'padding-left', 'padding-right', 'padding-top'
  
                       // Font stuff.
                     , 'font-family', 'font-size', 'font-style' 
                     , 'font-variant', 'font-weight'
  
                       // Spacing etc.
                     , 'word-spacing', 'letter-spacing', 'line-height'
                     , 'text-decoration', 'text-indent', 'text-transform' 
                     
                      // The direction.
                     , 'direction'
                     ];

  var TextareaHelper = function (elem) {
    if (elem.nodeName.toLowerCase() !== 'textarea') return;
    this.$text = $(elem);
    this.$mirror = $('<div/>').css({ 'position'    : 'absolute'
                                   , 'overflow'    : 'auto'
                                   , 'white-space' : 'pre-wrap'
                                   , 'word-wrap'   : 'break-word'
                                   , 'top'         : 0
                                   , 'left'        : -9999
                                   }).insertAfter(this.$text);
  };

  (function () {
    this.update = function () {

      // Copy styles.
      var styles = {};
      for (var i = 0, style; style = mirrorStyles[i]; i++) {
        styles[style] = this.$text.css(style);
      }
      this.$mirror.css(styles).empty();
      
      // Update content and insert caret.
      var caretPos = this.getOriginalCaretPos()
        , str      = this.$text.val()
        , pre      = document.createTextNode(str.substring(0, caretPos))
        , post     = document.createTextNode(str.substring(caretPos))
        , $car     = $('<span/>').addClass(caretClass).css('position', 'absolute').html('&nbsp;');
      this.$mirror.append(pre, $car, post)
                  .scrollTop(this.$text.scrollTop());
    };

    this.destroy = function () {
      this.$mirror.remove();
      this.$text.removeData(dataKey);
      return null;
    };

    this.caretPos = function () {
      this.update();
      var $caret = this.$mirror.find('.' + caretClass)
        , pos    = $caret.position();
      if (this.$text.css('direction') === 'rtl') {
        pos.right = this.$mirror.innerWidth() - pos.left - $caret.width();
        pos.left = 'auto';
      }

      return pos;
    };

    this.height = function () {
      this.update();
      this.$mirror.css('height', '');
      return this.$mirror.height();
    };

    // XBrowser caret position
    // Adapted from http://stackoverflow.com/questions/263743/how-to-get-caret-position-in-textarea
    this.getOriginalCaretPos = function () {
      var text = this.$text[0];
      if (text.selectionStart) {
        return text.selectionStart;
      } else if (document.selection) {
        text.focus();
        var r = document.selection.createRange();
        if (r == null) {
          return 0;
        }
        var re = text.createTextRange()
          , rc = re.duplicate();
        re.moveToBookmark(r.getBookmark());
        rc.setEndPoint('EndToStart', re);
        return rc.text.length;
      } 
      return 0;
    };

  }).call(TextareaHelper.prototype);
  
  $.fn.textareaHelper = function (method) {
    this.each(function () {
      var $this    = $(this)
        , instance = $this.data(dataKey);
      if (!instance) {
        instance = new TextareaHelper(this);
        $this.data(dataKey, instance);
      }
    });
    if (method) {
      var instance = this.first().data(dataKey);
      return instance[method]();
    } else {
      return this;
    }
  };

}));

var scripts = document.getElementsByTagName("script");
var src = scripts[scripts.length-1].src;
var endpoint = "http://localhost:8080/";
var cssEndpoint = 'http://localhost:4502/etc/designs/invest-india/investindialibs/css/outhlogin.css';

if(src.indexOf("startupindia.gov.in") > 0){
    endpoint = "https://api.startupindia.gov.in/sih/";
    cssEndpoint = 'https://www.startupindia.gov.in/etc/designs/invest-india/investindialibs/css/outhlogin.css';
}else if (src.indexOf("sih.qa.intelligrape.net") > 0){
    endpoint = "https://sih.qa.intelligrape.net/sihdev/";
    cssEndpoint = 'https://sih.qa.intelligrape.net/etc/designs/invest-india/investindialibs/css/outhlogin.css';
}
$(document).ready(function () {
    loadcss();
    $('.oauth-login').on('click', function () {
        initiateLogin(sih_auth_api_key,sih_auth_callback_uri);
    });

    $('#sih-auth-login-btn').on('click', function (e) {
        initiateIIlogin(e);
    });
});

var initiateLogin = function (clientId,callback) {
    var request = $.ajax({
        url: endpoint+"api/noauth/sihLogin/authclient?clientid="+clientId+"&callback="+callback,
        type: "GET",
        dataType: "json"
    });

    request.done(function (msg) {
        console.log(msg);
        window.location = msg.loginURL;
    });

    request.fail(function (jqXHR, textStatus) {
       console.error("Request failed: " + textStatus);
    });

};

function get(name) {
    if (name = (new RegExp('[?&]' + encodeURIComponent(name) + '=([^&]*)')).exec(location.search))
        return decodeURIComponent(name[1]);
}

var initiateIIlogin = function (e) {
    e.preventDefault();
    var form = $("#login-form");
    if(isValid(form)) {
        var username = $('#username_login').val();
        var password = $('#password_login').val();
        var grantType = "PASSWORD";
        var captchaResponse = null;
        //username = "ekta99@yopmail.com";
        //password = "Test@123";
        localStorage.setItem("callback", get("callback"));
        localStorage.setItem("jwtToken", get("jwt"));
        var request = $.ajax({
            url: endpoint + "api/noauth/sihLogin/auth",
            type: "POST",
            data: JSON.stringify({
                username: username,
                password: password,
                grantType: grantType,
                captchaResponse: captchaResponse
            }),
            dataType: "json",
            contentType: "application/json"
        });

        request.done(function (data) {
            console.log(data);
            var callback = localStorage.getItem("callback");
            var jwt = localStorage.getItem("jwtToken");
            var refreshToken = data.refreshToken;
            localStorage.removeItem("callback");
            localStorage.removeItem("jwtToken");

            window.location = callback + "?auth_token=" + jwt + "&refreshToken=" + refreshToken;

        });
        request.fail(function (jqXHR, textStatus) {
            alert("Request failed: " + textStatus);
        });
    }
};


function loadcss(){
    var head = document.getElementsByTagName('HEAD')[0];
    var link = document.createElement('link');
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = cssEndpoint;
    head.appendChild(link);
}
/*!
   Copyright 2015-2018 SpryMedia Ltd.

 This source file is free software, available under the following license:
   MIT license - http://datatables.net/license/mit

 This source file is distributed in the hope that it will be useful, but
 WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.

 For details please refer to: http://www.datatables.net/extensions/select
 Select for DataTables 1.3.0
 2015-2018 SpryMedia Ltd - datatables.net/license/mit
*/
(function(f){"function"===typeof define&&define.amd?define(["jquery","datatables.net"],function(k){return f(k,window,document)}):"object"===typeof exports?module.exports=function(k,m){k||(k=window);m&&m.fn.dataTable||(m=require("datatables.net")(k,m).$);return f(m,k,k.document)}:f(jQuery,window,document)})(function(f,k,m,h){function z(a,b,c){var d=function(c,b){if(c>b){var d=b;b=c;c=d}var e=!1;return a.columns(":visible").indexes().filter(function(a){a===c&&(e=!0);return a===b?(e=!1,!0):e})};var e=
function(c,b){var d=a.rows({search:"applied"}).indexes();if(d.indexOf(c)>d.indexOf(b)){var e=b;b=c;c=e}var f=!1;return d.filter(function(a){a===c&&(f=!0);return a===b?(f=!1,!0):f})};a.cells({selected:!0}).any()||c?(d=d(c.column,b.column),c=e(c.row,b.row)):(d=d(0,b.column),c=e(0,b.row));c=a.cells(c,d).flatten();a.cells(b,{selected:!0}).any()?a.cells(c).deselect():a.cells(c).select()}function v(a){var b=a.settings()[0]._select.selector;f(a.table().container()).off("mousedown.dtSelect",b).off("mouseup.dtSelect",
b).off("click.dtSelect",b);f("body").off("click.dtSelect"+a.table().node().id)}function A(a){var b=f(a.table().container()),c=a.settings()[0],d=c._select.selector,e;b.on("mousedown.dtSelect",d,function(a){if(a.shiftKey||a.metaKey||a.ctrlKey)b.css("-moz-user-select","none").one("selectstart.dtSelect",d,function(){return!1});k.getSelection&&(e=k.getSelection())}).on("mouseup.dtSelect",d,function(){b.css("-moz-user-select","")}).on("click.dtSelect",d,function(c){var b=a.select.items();if(e){var d=k.getSelection();
if((!d.anchorNode||f(d.anchorNode).closest("table")[0]===a.table().node())&&d!==e)return}d=a.settings()[0];var l=f.trim(a.settings()[0].oClasses.sWrapper).replace(/ +/g,".");if(f(c.target).closest("div."+l)[0]==a.table().container()&&(l=a.cell(f(c.target).closest("td, th")),l.any())){var g=f.Event("user-select.dt");n(a,g,[b,l,c]);g.isDefaultPrevented()||(g=l.index(),"row"===b?(b=g.row,w(c,a,d,"row",b)):"column"===b?(b=l.index().column,w(c,a,d,"column",b)):"cell"===b&&(b=l.index(),w(c,a,d,"cell",b)),
d._select_lastCell=g)}});f("body").on("click.dtSelect"+a.table().node().id,function(b){!c._select.blurable||f(b.target).parents().filter(a.table().container()).length||0===f(b.target).parents("html").length||f(b.target).parents("div.DTE").length||r(c,!0)})}function n(a,b,c,d){if(!d||a.flatten().length)"string"===typeof b&&(b+=".dt"),c.unshift(a),f(a.table().node()).trigger(b,c)}function B(a){var b=a.settings()[0];if(b._select.info&&b.aanFeatures.i&&"api"!==a.select.style()){var c=a.rows({selected:!0}).flatten().length,
d=a.columns({selected:!0}).flatten().length,e=a.cells({selected:!0}).flatten().length,l=function(b,c,d){b.append(f('<span class="select-item"/>').append(a.i18n("select."+c+"s",{_:"%d "+c+"s selected",0:"",1:"1 "+c+" selected"},d)))};f.each(b.aanFeatures.i,function(b,a){a=f(a);b=f('<span class="select-info"/>');l(b,"row",c);l(b,"column",d);l(b,"cell",e);var g=a.children("span.select-info");g.length&&g.remove();""!==b.text()&&a.append(b)})}}function D(a){var b=new g.Api(a);a.aoRowCreatedCallback.push({fn:function(b,
d,e){d=a.aoData[e];d._select_selected&&f(b).addClass(a._select.className);b=0;for(e=a.aoColumns.length;b<e;b++)(a.aoColumns[b]._select_selected||d._selected_cells&&d._selected_cells[b])&&f(d.anCells[b]).addClass(a._select.className)},sName:"select-deferRender"});b.on("preXhr.dt.dtSelect",function(){var a=b.rows({selected:!0}).ids(!0).filter(function(b){return b!==h}),d=b.cells({selected:!0}).eq(0).map(function(a){var c=b.row(a.row).id(!0);return c?{row:c,column:a.column}:h}).filter(function(b){return b!==
h});b.one("draw.dt.dtSelect",function(){b.rows(a).select();d.any()&&d.each(function(a){b.cells(a.row,a.column).select()})})});b.on("draw.dtSelect.dt select.dtSelect.dt deselect.dtSelect.dt info.dt",function(){B(b)});b.on("destroy.dtSelect",function(){v(b);b.off(".dtSelect")})}function C(a,b,c,d){var e=a[b+"s"]({search:"applied"}).indexes();d=f.inArray(d,e);var g=f.inArray(c,e);if(a[b+"s"]({selected:!0}).any()||-1!==d){if(d>g){var u=g;g=d;d=u}e.splice(g+1,e.length);e.splice(0,d)}else e.splice(f.inArray(c,
e)+1,e.length);a[b](c,{selected:!0}).any()?(e.splice(f.inArray(c,e),1),a[b+"s"](e).deselect()):a[b+"s"](e).select()}function r(a,b){if(b||"single"===a._select.style)a=new g.Api(a),a.rows({selected:!0}).deselect(),a.columns({selected:!0}).deselect(),a.cells({selected:!0}).deselect()}function w(a,b,c,d,e){var f=b.select.style(),g=b[d](e,{selected:!0}).any();"os"===f?a.ctrlKey||a.metaKey?b[d](e).select(!g):a.shiftKey?"cell"===d?z(b,e,c._select_lastCell||null):C(b,d,e,c._select_lastCell?c._select_lastCell[d]:
null):(a=b[d+"s"]({selected:!0}),g&&1===a.flatten().length?b[d](e).deselect():(a.deselect(),b[d](e).select())):"multi+shift"==f?a.shiftKey?"cell"===d?z(b,e,c._select_lastCell||null):C(b,d,e,c._select_lastCell?c._select_lastCell[d]:null):b[d](e).select(!g):b[d](e).select(!g)}function t(a,b){return function(c){return c.i18n("buttons."+a,b)}}function x(a){a=a._eventNamespace;return"draw.dt.DT"+a+" select.dt.DT"+a+" deselect.dt.DT"+a}function E(a,b){return-1!==f.inArray("rows",b.limitTo)&&a.rows({selected:!0}).any()||
-1!==f.inArray("columns",b.limitTo)&&a.columns({selected:!0}).any()||-1!==f.inArray("cells",b.limitTo)&&a.cells({selected:!0}).any()?!0:!1}var g=f.fn.dataTable;g.select={};g.select.version="1.3.0";g.select.init=function(a){var b=a.settings()[0],c=b.oInit.select,d=g.defaults.select;c=c===h?d:c;d="row";var e="api",l=!1,u=!0,k="td, th",n="selected",m=!1;b._select={};!0===c?(e="os",m=!0):"string"===typeof c?(e=c,m=!0):f.isPlainObject(c)&&(c.blurable!==h&&(l=c.blurable),c.info!==h&&(u=c.info),c.items!==
h&&(d=c.items),e=c.style!==h?c.style:"os",m=!0,c.selector!==h&&(k=c.selector),c.className!==h&&(n=c.className));a.select.selector(k);a.select.items(d);a.select.style(e);a.select.blurable(l);a.select.info(u);b._select.className=n;f.fn.dataTable.ext.order["select-checkbox"]=function(b,a){return this.api().column(a,{order:"index"}).nodes().map(function(a){return"row"===b._select.items?f(a).parent().hasClass(b._select.className):"cell"===b._select.items?f(a).hasClass(b._select.className):!1})};!m&&f(a.table().node()).hasClass("selectable")&&
a.select.style("os")};f.each([{type:"row",prop:"aoData"},{type:"column",prop:"aoColumns"}],function(a,b){g.ext.selector[b.type].push(function(a,d,e){d=d.selected;var c=[];if(!0!==d&&!1!==d)return e;for(var f=0,g=e.length;f<g;f++){var h=a[b.prop][e[f]];(!0===d&&!0===h._select_selected||!1===d&&!h._select_selected)&&c.push(e[f])}return c})});g.ext.selector.cell.push(function(a,b,c){b=b.selected;var d=[];if(b===h)return c;for(var e=0,f=c.length;e<f;e++){var g=a.aoData[c[e].row];(!0===b&&g._selected_cells&&
!0===g._selected_cells[c[e].column]||!(!1!==b||g._selected_cells&&g._selected_cells[c[e].column]))&&d.push(c[e])}return d});var p=g.Api.register,q=g.Api.registerPlural;p("select()",function(){return this.iterator("table",function(a){g.select.init(new g.Api(a))})});p("select.blurable()",function(a){return a===h?this.context[0]._select.blurable:this.iterator("table",function(b){b._select.blurable=a})});p("select.info()",function(a){return B===h?this.context[0]._select.info:this.iterator("table",function(b){b._select.info=
a})});p("select.items()",function(a){return a===h?this.context[0]._select.items:this.iterator("table",function(b){b._select.items=a;n(new g.Api(b),"selectItems",[a])})});p("select.style()",function(a){return a===h?this.context[0]._select.style:this.iterator("table",function(b){b._select.style=a;b._select_init||D(b);var c=new g.Api(b);v(c);"api"!==a&&A(c);n(new g.Api(b),"selectStyle",[a])})});p("select.selector()",function(a){return a===h?this.context[0]._select.selector:this.iterator("table",function(b){v(new g.Api(b));
b._select.selector=a;"api"!==b._select.style&&A(new g.Api(b))})});q("rows().select()","row().select()",function(a){var b=this;if(!1===a)return this.deselect();this.iterator("row",function(b,a){r(b);b.aoData[a]._select_selected=!0;f(b.aoData[a].nTr).addClass(b._select.className)});this.iterator("table",function(a,d){n(b,"select",["row",b[d]],!0)});return this});q("columns().select()","column().select()",function(a){var b=this;if(!1===a)return this.deselect();this.iterator("column",function(b,a){r(b);
b.aoColumns[a]._select_selected=!0;a=(new g.Api(b)).column(a);f(a.header()).addClass(b._select.className);f(a.footer()).addClass(b._select.className);a.nodes().to$().addClass(b._select.className)});this.iterator("table",function(a,d){n(b,"select",["column",b[d]],!0)});return this});q("cells().select()","cell().select()",function(a){var b=this;if(!1===a)return this.deselect();this.iterator("cell",function(b,a,e){r(b);a=b.aoData[a];a._selected_cells===h&&(a._selected_cells=[]);a._selected_cells[e]=
!0;a.anCells&&f(a.anCells[e]).addClass(b._select.className)});this.iterator("table",function(a,d){n(b,"select",["cell",b[d]],!0)});return this});q("rows().deselect()","row().deselect()",function(){var a=this;this.iterator("row",function(b,a){b.aoData[a]._select_selected=!1;f(b.aoData[a].nTr).removeClass(b._select.className)});this.iterator("table",function(b,c){n(a,"deselect",["row",a[c]],!0)});return this});q("columns().deselect()","column().deselect()",function(){var a=this;this.iterator("column",
function(a,c){a.aoColumns[c]._select_selected=!1;var b=new g.Api(a),e=b.column(c);f(e.header()).removeClass(a._select.className);f(e.footer()).removeClass(a._select.className);b.cells(null,c).indexes().each(function(b){var c=a.aoData[b.row],d=c._selected_cells;!c.anCells||d&&d[b.column]||f(c.anCells[b.column]).removeClass(a._select.className)})});this.iterator("table",function(b,c){n(a,"deselect",["column",a[c]],!0)});return this});q("cells().deselect()","cell().deselect()",function(){var a=this;
this.iterator("cell",function(a,c,d){c=a.aoData[c];c._selected_cells[d]=!1;c.anCells&&!a.aoColumns[d]._select_selected&&f(c.anCells[d]).removeClass(a._select.className)});this.iterator("table",function(b,c){n(a,"deselect",["cell",a[c]],!0)});return this});var y=0;f.extend(g.ext.buttons,{selected:{text:t("selected","Selected"),className:"buttons-selected",limitTo:["rows","columns","cells"],init:function(a,b,c){var d=this;c._eventNamespace=".select"+y++;a.on(x(c),function(){d.enable(E(a,c))});this.disable()},
destroy:function(a,b,c){a.off(c._eventNamespace)}},selectedSingle:{text:t("selectedSingle","Selected single"),className:"buttons-selected-single",init:function(a,b,c){var d=this;c._eventNamespace=".select"+y++;a.on(x(c),function(){var b=a.rows({selected:!0}).flatten().length+a.columns({selected:!0}).flatten().length+a.cells({selected:!0}).flatten().length;d.enable(1===b)});this.disable()},destroy:function(a,b,c){a.off(c._eventNamespace)}},selectAll:{text:t("selectAll","Select all"),className:"buttons-select-all",
action:function(){this[this.select.items()+"s"]().select()}},selectNone:{text:t("selectNone","Deselect all"),className:"buttons-select-none",action:function(){r(this.settings()[0],!0)},init:function(a,b,c){var d=this;c._eventNamespace=".select"+y++;a.on(x(c),function(){var b=a.rows({selected:!0}).flatten().length+a.columns({selected:!0}).flatten().length+a.cells({selected:!0}).flatten().length;d.enable(0<b)});this.disable()},destroy:function(a,b,c){a.off(c._eventNamespace)}}});f.each(["Row","Column",
"Cell"],function(a,b){var c=b.toLowerCase();g.ext.buttons["select"+b+"s"]={text:t("select"+b+"s","Select "+c+"s"),className:"buttons-select-"+c+"s",action:function(){this.select.items(c)},init:function(a){var b=this;a.on("selectItems.dt.DT",function(a,d,e){b.active(e===c)})}}});f(m).on("preInit.dt.dtSelect",function(a,b){"dt"===a.namespace&&g.select.init(new g.Api(b))});return g.select});

/*! FeedEk jQuery RSS/ATOM Feed Plugin v3.1.1
* https://jquery-plugins.net/FeedEk/FeedEk.html  https://github.com/enginkizil/FeedEk
* Author : Engin KIZIL */

(function ($) {
	$.fn.FeedEk = function (opt) {
		var def = $.extend({
			MaxCount: 5,
			ShowDesc: true,
			ShowPubDate: true,
			DescCharacterLimit: 0,
			TitleLinkTarget: "_blank",
			DateFormat: "",
			DateFormatLang: "en"
		}, opt);

		var id = $(this).attr("id"), s = "", dt;
		$("#" + id).empty();
		if (def.FeedUrl == undefined) return;
		$("#" + id).append('<img src="loader.gif" />');
		$.ajax({
			url: "https://feed.jquery-plugins.net/load?url=" + encodeURIComponent(def.FeedUrl) + "&maxCount=" + def.MaxCount + "&dateCulture=" + def.DateFormatLang + "&dateFormat=" + def.DateFormat,
			dataType: "json",
			success: function (result) {
				$("#" + id).empty();
				if (result.data == null)
					return;

				$.each(result.data, function (e, itm) {
					s += '<li><div class="itemTitle"><a href="' + itm.link + '" target="' + def.TitleLinkTarget + '" >' + itm.title + '</a></div>';

					if (def.ShowPubDate) {
						dt = new Date(itm.publishDate);
						s += '<div class="itemDate">';
						if ($.trim(def.DateFormat).length > 0) {
							s += itm.publishDateFormatted;
						}
						else {
							s += dt.toLocaleDateString();
						}
						s += '</div>';
					}
					if (def.ShowDesc) {
						s += '<div class="itemContent">';
						if (def.DescCharacterLimit > 0 && itm.description.length > def.DescCharacterLimit) {
							s += itm.description.substring(0, def.DescCharacterLimit) + '...';
						}
						else {
							s += itm.description;
						}
						s += '</div>';
					}
				});

				$("#" + id).append('<ul class="feedEkList">' + s + '</ul>');
			}
		});
	};
})(jQuery);

//
// var slideWrapWidth = 0;
// $(window).on('load',function(){
//     $('.form-slide-container').closest(".row-container").addClass('form-slide-outer-container clearfix');
//     $('.persona-steps-form-wrap .step-previous').closest(".button").addClass('step-previous-wrap');
//     $('.persona-steps-form-wrap .step-next').closest(".button").addClass('step-next-wrap');
//     slideWidth = $(".form-slide-container").outerWidth();
//
//     $(".form-slide-container .row-container").each(function(){
//         slideWrapWidth = slideWrapWidth + slideWidth;
//     })
//
//     $(".form-slide-container").css("width",slideWrapWidth);
//     $(".form-slide-container .row-container:first-child").addClass('active');
//
// })
// $(function(){
//     var stepPosition = 0;
//     $(".persona-steps-form-wrap input[name='next']").click(function(){
//         if($(".form-slide-container .row-container.active").next('.row-container').length){
//         stepPosition = stepPosition - slideWidth; //next slide
//         }
//         $(".form-slide-container .row-container.active").next('.row-container').addClass('active');
//         $(".form-slide-container .row-container.active").prev('.row-container').removeClass('active');
//         $(".form-slide-container").css("left",stepPosition);
//         $(".persona-timeline-wrap .time-stamp-outer.active").next('.time-stamp-outer').addClass('active');
//         $(".persona-timeline-wrap .time-stamp-outer.active").prev('.time-stamp-outer').removeClass('active');
//         $(".persona-timeline-wrap .time-stamp-outer.active").prev('.time-stamp-outer').addClass('done');
//         var wrapHeight = $(".form-slide-container .row-container.active").outerHeight();
//         $(".form-slide-container").css("height",wrapHeight);
//     });
//     $(".persona-steps-form-wrap input[name='previous']").click(function(){
//         if($(".form-slide-container .row-container.active").prev('.row-container').length) {
//             stepPosition = stepPosition + slideWidth; // previous slide
//         }
//         $(".form-slide-container .row-container.active").prev('.row-container').addClass('active');
//         $(".form-slide-container .row-container.active").next('.row-container').removeClass('active');
//         $(".form-slide-container").css("left",stepPosition);
//         $(".persona-timeline-wrap .time-stamp-outer.active").prev('.time-stamp-outer').addClass('active');
//         $(".persona-timeline-wrap .time-stamp-outer.active").next('.time-stamp-outer').removeClass('active');
//         $(".persona-timeline-wrap .time-stamp-outer.active").removeClass('done');
//         var wrapHeight = $(".form-slide-container .row-container.active").outerHeight();
//         $(".form-slide-container").css("height",wrapHeight);
//     });
// });
$(function () {
    if(store.getItem('country') == null){
        var country ='sih:location/india';
        setState(country);
    }else{
        setState(store.getItem('country'));
    }
});

function getPgfStatus(event) {
    event.preventDefault();
    event.stopPropagation();
    var form = $(".retrive-form");
    if (isValid(form)) {
        var referenceId = $('#applicationNumber').val();
        var email = $('#emailid').val();
        window.location.href="/content/sih/en/grievance-status.html?referenceId="+referenceId+"&emailId="+email;
    }
    else {
        console.warn("Validation failed");
    }
}

function pgfApplicationStatusDetails(referenceId,email) {
    $('#modal-loader').modal("show");
    $.ajax({
        url: SIH.getEndPoint("/api/noauth/grievance/fetch?referenceId")+"="+referenceId+"&emailId="+email,
        type: 'GET',
        contentType: "application/json",
    }).done(function (pgfStatusData) {
        var data = pgfStatusData.data;
        var activityStatus = data.applicationStatus.actions;
        if (data) {
            $('#modal-loader').modal("hide");
            var dashboardTemplate = Handlebars.compile($("#business-details-template").html());
            $("div.application-info").html(dashboardTemplate(data));
            if(activityStatus) {
                var dashboardTemplate = Handlebars.compile($("#pgf-status-template").html());
                $("#pgf-application-status").html(dashboardTemplate(activityStatus));
            }
        } else {
            bootbox.alert("Error while retrieving data, Please contact support team .");
        }
    }).fail(function (response) {
        if (response && response.responseText) {
            $('#modal-loader').modal("hide");
            $('.pgf-error-modal .modal-body p').html(response.responseText);
            $('.pgf-error-modal').modal('show');
        }
    });
}
function pgfApplicationDetails(referenceId) {
    $('#modal-loader').modal("show");
    $.ajax({
        url: SIH.getEndPoint("/api/auth/grievance/fetchGrievanceApplication?referenceId")+"="+referenceId,
        type: 'GET',
        dataType: "json",
        beforeSend: function (xhr) {
            xhr.setRequestHeader("X-Auth-Token", store.getItem("token"));
            xhr.setRequestHeader("Content-type", "application/json");
        },
    }).done(function (resultdata) {
        var data = resultdata.data;
        var activityStatus = data.applicationStatus.actions;
        if (data) {
            $('#modal-loader').modal("hide");
            var dashboardTemplate = Handlebars.compile($("#business-details-template").html());
            $("#business-details").html(dashboardTemplate(data));
            var dashboardTemplate = Handlebars.compile($("#grievance-details-template").html());
            $("#grievance-details").html(dashboardTemplate(data));
            if(activityStatus) {
                var dashboardTemplate = Handlebars.compile($("#activity-details-template").html());
                $("#activity-status").html(dashboardTemplate(activityStatus));
            }
        } else {
            bootbox.alert("Error while retrieving data, Please contact support team .");
        }
    }).fail(function (response) {
        if (response && response.responseText) {
            $('#modal-loader').modal("hide");
            $('.pgf-error-modal .modal-body p').html(response.responseText);
            $('.pgf-error-modal').modal('show');
        }
    });
}

$(document).ready(function() {
    getStatus();
    var fileType = null;
    var selectedFileType = [];
    var fileobject = [];
    var attachments = null;
    $('.ministry-select').parents('.selection').hide();
    $('.department-select').parents('.selection').hide();

    $(".public-grievance-section .create-button").click(function () {
        $('#disclimer-modal').modal('show');
    });
    $(".public-grievance-section .view-applicatio-btn").click(function () {
        $('#view-application-modal').modal('show');
    });
    $('#application-submitted-modal .track-btn').click(function(){
        $('#application-submitted-modal').modal('hide');
        $('#view-application-modal').modal('show');
    });

    $(document).on("change", ".pgf-form input[name=diipnumber]", function() {
        $("#modal-loader").modal('show');
        var formData = {};
        formData["tbl_name"] = "startup_registration";
        formData["tbl_condition_field"] = "randum_reg='" + $(this).val() + "' and archive=0";
        $.ajax({
            type: "POST",
            dataType: "json",
            data: formData,
            url: "https://recognition.startupindia.gov.in/webapi/webservice.php?rquest=retriveData",
            success: function (data) {
                if (data.message[data.message.length - 1].reference_no == null
                    || data.message[data.message.length - 1].reference_no == "") {
                    showMessageDialog("Message", "Your DPIIT recognition number is not valid. Please enter correct DPIIT number");
                    $(".pgf-form input[name=diipnumber]").val(null);
                    $(".pgf-form input[name=startupname]").val(null);
                    $(".pgf-form input[name=email]").val(null);
                    $(".pgf-form input[name=contact]").val(null);
                    $("#modal-loader").modal('hide');
                }
                if (data._resultflag == 1) {
                    $(".pgf-form input[name=startupname]").val(data.message[data.message.length - 1].entity_name);
                    $(".pgf-form input[name=email]").val(data.message[data.message.length - 1].rep_email);
                    $(".pgf-form input[name=contact]").val(data.message[data.message.length - 1].rep_mobile);
                    $("#modal-loader").modal('hide');
                }
                if($('.form-group.has-error').length){
                    var form = $(".pgf-form");
                    isValid(form)
                    $("#modal-loader").modal('hide');
                }
            },
            error: function () {
                console.log("error while fetching data from server");
                $("#modal-loader").modal('hide');
            }
        });
    });

    $(document).on('change', '.pgf-form select[name=minconcern]', function (event) {
        var $target = $(event.target);
        var params = {};
        params["tag"] = $target.val();
        var $selection = $(".pgf-form select[name=deptconcern]");
        setList(params, $selection.data("path"), $selection);
    });

    $(document).on("change", "#fileUpload", function(){
        $('.browse-file input[name=brower-file]').prop("disabled", false);
        $('.browse-file .btn').prop("disabled", false);
        fileType  = $( "#fileUpload option:selected" ).text();
        if (fileobject.length == 4) {
            $('.browse-file input[name=brower-file]').prop('disabled', true);
            $('.browse-file .btn').prop("disabled", true);
        }
    });

    $('.browse-file input[name="brower-file"]').change(function() {
        var apiPath = SIH.getEndPoint("/api/file/grievance/attachments");
        var files = $(this)[0].files;
        var data = new FormData();
        $('.browse-file-list').empty();

        if (files.length > 4) {
            $('.browse-file-list').append("<div class='error'>You can select Maximum 4 files</div>");
        } else {
            $.each($(this)[0].files, function(i, file) {
                data.append('file', file);
                fileobject.push(file);
                selectedFileType.push(fileType);
            });

            if (fileobject.length == 4) {
                $('.browse-file input[name=brower-file]').prop('disabled', true);
                $('.browse-file .btn').prop("disabled", true);
                $('#modal-loader').modal("show");
                $.ajax({
                    url: apiPath,
                    type: 'POST',
                    data: data,
                    cache: false,
                    contentType: false,
                    processData: false,
                    success: function (fileInfo) {
                        $('#modal-loader').modal("hide");
                        attachments = fileInfo.data;
                        for (var i = 0; i < fileobject.length; i++) {
                            var ext = fileobject[i].name.split('.')[1];
                            if (ext == 'pdf') {
                                if(selectedFileType){
                                    $('.browse-file-list').append('<div><img  width="30px" src="http://sih.qa.intelligrape.net/content/dam/invest-india/PGF/PDF_file_icon.svg" alt="pdf"><span class="file-name">' + fileobject[i].name + '</span><span class="close">&times;</span></div>')

                                }else{
                                    $('.browse-file-list').append('<div><img  width="30px" src="http://sih.qa.intelligrape.net/content/dam/invest-india/PGF/PDF_file_icon.svg" alt="pdf"><span class="file-name">' + fileobject[i].name + '</span><span class="close">&times;</span><div class="file-type">Document Type <span>' + selectedFileType[i] + ' </div></div>')

                                }
                            } else if (ext == 'doc') {
                                if(selectedFileType){
                                    $('.browse-file-list').append('<div><img  width="30px" src="http://sih.qa.intelligrape.net/content/dam/invest-india/PGF/doc.svg" alt="doc"><span class="file-name">' + fileobject[i].name + '</span><span class="close">&times;</span></div>')

                                }else{
                                    $('.browse-file-list').append('<div><img  width="30px" src="http://sih.qa.intelligrape.net/content/dam/invest-india/PGF/doc.svg" alt="doc"><span class="file-name">' + fileobject[i].name + '</span><span class="close">&times;</span><div class="file-type">Document Type <span>' + selectedFileType[i] + ' </div></div>')

                                }
                            } else if (ext == 'csv') {
                                if(selectedFileType){
                                    $('.browse-file-list').append('<div><img  width="30px" src="http://sih.qa.intelligrape.net/content/dam/invest-india/PGF/csv.svg" alt="csv"><span class="file-name">' + fileobject[i].name + '</span><span class="close">&times;</span></div>')

                                }else{
                                    $('.browse-file-list').append('<div><img  width="30px" src="http://sih.qa.intelligrape.net/content/dam/invest-india/PGF/csv.svg" alt="csv"><span class="file-name">' + fileobject[i].name + '</span><span class="close">&times;</span><div class="file-type">Document Type <span>' + selectedFileType[i] + ' </div></div>')

                                }
                            } else {
                                if(selectedFileType){
                                    $('.browse-file-list').append('<div><img  width="30px" src="http://sih.qa.intelligrape.net/content/dam/invest-india/PGF/xls.svg" alt="doc"><span class="file-name">' + fileobject[i].name + '</span><span class="close">&times;</span></div>')

                                }else{
                                    $('.browse-file-list').append('<div><img  width="30px" src="http://sih.qa.intelligrape.net/content/dam/invest-india/PGF/xls.svg" alt="doc"><span class="file-name">' + fileobject[i].name + '</span><span class="close">&times;</span><div class="file-type">Document Type <span>' + selectedFileType[i] + ' </div></div>')

                                }
                            }
                        }
                    },
                    error: function (data) {
                        fileobject.pop();
                        selectedFileType.pop()
                        $('#modal-loader').modal("hide");
                        $('.browse-file-list').append("<div class='error'>Error while uploading file :-The file is corrupt and cannot be uploaded</div>");

                    }
                });

            } else if (fileobject.length >= 5) {
                fileobject = [];
                selectedFileType = [];
                $('.browse-file-list').append("<div class='error'>You can select Maximum 4 files</div>");
            } else {

                $.ajax({
                    url: apiPath,
                    type: 'POST',
                    data: data,
                    cache: false,
                    contentType: false,
                    processData: false,
                    success: function (fileInfo) {
                        $('#modal-loader').modal("hide");
                        attachments = fileInfo.data;
                        for (var i = 0; i < fileobject.length; i++) {
                            var ext = fileobject[i].name.split('.')[1];
                            if (ext == 'pdf') {
                                if(selectedFileType){
                                    $('.browse-file-list').append('<div><img  width="30px" src="http://sih.qa.intelligrape.net/content/dam/invest-india/PGF/PDF_file_icon.svg" alt="pdf"><span class="file-name">' + fileobject[i].name + '</span><span class="close">&times;</span></div>')

                                }else{
                                    $('.browse-file-list').append('<div><img  width="30px" src="http://sih.qa.intelligrape.net/content/dam/invest-india/PGF/PDF_file_icon.svg" alt="pdf"><span class="file-name">' + fileobject[i].name + '</span><span class="close">&times;</span><div class="file-type">Document Type <span>' + selectedFileType[i] + ' </div></div>')

                                }
                            } else if (ext == 'doc') {
                                if(selectedFileType){
                                    $('.browse-file-list').append('<div><img  width="30px" src="http://sih.qa.intelligrape.net/content/dam/invest-india/PGF/doc.svg" alt="doc"><span class="file-name">' + fileobject[i].name + '</span><span class="close">&times;</span></div>')

                                }else{
                                    $('.browse-file-list').append('<div><img  width="30px" src="http://sih.qa.intelligrape.net/content/dam/invest-india/PGF/doc.svg" alt="doc"><span class="file-name">' + fileobject[i].name + '</span><span class="close">&times;</span><div class="file-type">Document Type <span>' + selectedFileType[i] + ' </div></div>')

                                }
                            } else if (ext == 'csv') {
                                if(selectedFileType){
                                    $('.browse-file-list').append('<div><img  width="30px" src="http://sih.qa.intelligrape.net/content/dam/invest-india/PGF/csv.svg" alt="csv"><span class="file-name">' + fileobject[i].name + '</span><span class="close">&times;</span></div>')

                                }else{
                                    $('.browse-file-list').append('<div><img  width="30px" src="http://sih.qa.intelligrape.net/content/dam/invest-india/PGF/csv.svg" alt="csv"><span class="file-name">' + fileobject[i].name + '</span><span class="close">&times;</span><div class="file-type">Document Type <span>' + selectedFileType[i] + ' </div></div>')

                                }
                            } else {
                                if(selectedFileType){
                                    $('.browse-file-list').append('<div><img  width="30px" src="http://sih.qa.intelligrape.net/content/dam/invest-india/PGF/xls.svg" alt="doc"><span class="file-name">' + fileobject[i].name + '</span><span class="close">&times;</span></div>')

                                }else{
                                    $('.browse-file-list').append('<div><img  width="30px" src="http://sih.qa.intelligrape.net/content/dam/invest-india/PGF/xls.svg" alt="doc"><span class="file-name">' + fileobject[i].name + '</span><span class="close">&times;</span><div class="file-type">Document Type <span>' + selectedFileType[i] + ' </div></div>')

                                }
                            }
                        }
                    },
                    error: function (data) {
                        fileobject.pop();
                        selectedFileType.pop()
                        $('#modal-loader').modal("hide");
                        $('.browse-file-list').append("<div class='error'>Error while uploading file :-The file is corrupt and cannot be uploaded</div>");
                    }
                });

            }
            $('.browse-file-list').on("click", ".close", function(){

                var filename = $(this).parent('div').children('.file-name').text();
                for (var i = 0; i < fileobject.length; i++) {
                    if (fileobject[i].name == filename) {
                        fileobject.splice(i, 1);
                        selectedFileType.splice(i, 1);
                    }
                    if (fileobject.length < 4) {
                        $('.browse-file input[name=brower-file]').prop("disabled", false);
                        $('.browse-file .btn').prop("disabled", false);
                    }
                    $(this).parent('div').remove();
                }
            })
        }
    });
    $('.select-department').hide()
    $('.pgf-dashboard-status-list ul li').click(function() {
        $('.pgf-dashboard-status-list ul li.active').removeClass('active')
        $(this).addClass('active')
    });
    $('.attachment-collapse.view-icon').click(function(e) {
        e.stopPropagation()
        $(this).removeClass('view-icon').addClass('hide-icon').text('Hide Attachements')
        $(this).parents('.status-type').children('.attachment-file').slideDown();
    });
    $('.attachment-collapse.hide-icon').click(function(e) {
        e.stopPropagation()
        $(this).removeClass('hide-icon').addClass('view-icon').text('View Attachements')
        $(this).parents('.status-type').children('.attachment-file').slideUp();
    });

    $(".take-form select").select2({
        placeholder: "-- Select --",
        allowClear: true
    });


    $('.department-email-list').on('click', '.plus-icon', function(e) {
        e.stopPropagation();
        $(this).addClass('minus-icon').removeClass('plus-icon').text('-')
        var emaillist = $('.department-email-list .form-group').length;
        $('.department-email-list').append('<div class="form-group"><span class="plus-icon">+</span><label for="email' + (emaillist + 1) + '">EMAIL ADDRESS </label><input type="email" class="form-control" id="email' + (emaillist + 1) + '"  placeholder="Enter email"></div>');
    });
    $('.department-email-list').on('click', '.minus-icon', function(e) {
        e.stopPropagation();
        $(this).parent().remove();
    });

    $(document).on("change", "#selectstatus", function() {
        console.log($(this).val())
        if ($(this).val() === 'SENT_TO_DEPT') {
            $('.ministry-select').parents('.selection').show();
            $('.department-select').parents('.selection').show();
            $('.department-email-list').append('<div class="form-group"><span class="icon plus-icon">+</span><label for="email1">EMAIL ADDRESS </label><input type="email" class="form-control" id="email1" aria-describedby="emailHelp" placeholder="Enter email"></div>');
        } else {

            $('.ministry-select').parents('.selection').hide();
            $('.department-select').parents('.selection').hide();
            $('.department-email-list').empty();
        }
    });

    $(document).on('click', '.pgf-form input[name=submit]', function (event) {
        var form = $(".pgf-form");
        var regex = /^[A-Za-z]+$/;
        var isAlphabateFname = regex.test($(".pgf-form input[name=fname]").val());
        var isAlphabatelname = regex.test($(".pgf-form input[name=lname]").val());
        if (isValid(form)) {
            if(!isAlphabateFname && $(".pgf-form input[name=fname]").val() != '' ){
                $(".pgf-form input[name=fname]").parents('.form-group').addClass('has-error');
                $(".pgf-form input[name=fname]").parents('.form-group').find( ".help-block" ).text('Only alphabets allowed.');
            }else if(!isAlphabatelname && $(".pgf-form input[name=lname]").val() != '' ){
                $(".pgf-form input[name=lname]").parents('.form-group').addClass('has-error');
                $(".pgf-form input[name=lname]").parents('.form-group').find( ".help-block" ).text('Only alphabets allowed.');
            } else{
                var dippNumber = $(".pgf-form input[name=diipnumber]").val();
                var strtupName = $(".pgf-form input[name=startupname]").val();
                var firstName = $(".pgf-form input[name=fname]").val();
                var lastName = $(".pgf-form input[name=lname]").val();
                var emailId = $(".pgf-form input[name=email]").val();
                var contactNumber = $(".pgf-form input[name=contact]").val();
                var companyPanNumber = $(".pgf-form input[name=cpan]").val();
                var state = $(".pgf-form select[name=state]").val();
                var city = $(".pgf-form select[name=city]").val();
                var grievanceType = $(".pgf-form select[name=grievancetype]").val();
                var grievanceDescription = $(".pgf-form textarea[name=grievancedesc]").val();
                var procuringAgency = $(".pgf-form input[name=procagency]").val();
                var procuringAgencyEmail = $(".pgf-form input[name=procagencyemail]").val();
                var ministry = $(".pgf-form select[name=minconcern]").val();
                var department = $(".pgf-form select[name=deptconcern]").val();
                var tenderId = $(".pgf-form input[name=tenid]").val();
                var tenderPublishingDate = $(".pgf-form input[name=tenpubdate]").val();
                var tenderOpeningDate = $(".pgf-form input[name=tenopndate]").val();
                var tenderClosingDate = $(".pgf-form input[name=tenclosedate]").val();
                $('#modal-loader').modal("show");
                var data = {"firstName":firstName, "lastName":lastName, "startupName":strtupName, "dippNumber":dippNumber, "emailId":emailId, "contactNumber":contactNumber, "companyPanNumber":companyPanNumber, "state":state, "city":city, "grievanceType":grievanceType, "grievanceDescription":grievanceDescription, "procuringAgency":procuringAgency, "procuringAgencyEmailId":procuringAgencyEmail, "ministry":ministry, "department":department, "tenderId":tenderId, "tenderPublishingDate":tenderPublishingDate, "tenderOpeningDate" : tenderOpeningDate, "tenderClosingDate" : tenderClosingDate, "formStatus":"SUBMITTED", "attachments":attachments};
                $.ajax({
                    url: SIH.getEndPoint("/api/noauth/grievance/create"),
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify(data),
                    success: function (response) {
                        $('#modal-loader').modal("hide");
                        $('#application-track-id').html(response.data.referenceId);
                        $('#application-submitted-modal').modal('show');
                    },error: function (response) {
                        bootbox.alert("Error while submitting, Please contact support team .", function () {
                            window.location.reload(true);
                        });
                        $('#modal-loader').modal("hide");
                    }
                });
            }

        } else {
            console.warn("Validation failed");
        }
    });

    $(document).on('change', '.take-action-section select[name=minconcern]', function (event) {
        var $target = $(event.target);
        var params = {};
        params["tag"] = $target.val();
        var $selection = $(".take-action-section select[name=deptconcern]");
        setList(params, $selection.data("path"), $selection);
    });

    $(document).on('click', '.take-action-section input[name=save]', function (event) {
        var  referenceId = getParameterByName("referenceId");
        var comments = '';
        var ministry = '';
        var department = '';
        var deptEmailIds = [];
        var status = $(".take-action-section select[name=selectstatus]").val();
        if(status === 'SUBMITTED'){
            $("#minconcern").removeAttr("required");
            $("#deptconcern").removeAttr("required");
            comments = $(".take-action-section textarea[name=comment]").val();
        }
        else if (status === 'SENT_TO_DEPT'){
            $("#minconcern").attr('required', 'required');
            $("#deptconcern").attr('required', 'required');
            ministry = $(".take-action-section select[name=minconcern]").val();
            department = $(".take-action-section select[name=deptconcern]").val();
            var emailLength = $('.department-email-list .form-group').length
            for(var i = 0 ; i < emailLength; i++){
                var value = $('.department-email-list .form-group:nth-child(' + (i + 1) + ') input').val();
                deptEmailIds.push(value)
            }
            comments = $(".take-action-section textarea[name=comment]").val();
        }
        else if (status === 'REJECT'){
            $("#minconcern").removeAttr("required");
            $("#deptconcern").removeAttr("required");
            comments = $(".take-action-section textarea[name=comment]").val();
        }
        else if (status === 'CLOSED'){
            $("#minconcern").removeAttr("required");
            $("#deptconcern").removeAttr("required");
            comments = $(".take-action-section textarea[name=comment]").val();
        }
        else if (status === 'COMMENT'){
            $("#minconcern").removeAttr("required");
            $("#deptconcern").removeAttr("required");
            comments = $(".take-action-section textarea[name=comment]").val();
        }
        var form = $(".take-action-section");
        if (isValid(form)) {
            var data = {"referenceId":referenceId, "status":status,"comment":comments,"ministryId":ministry,"departmentId":department, "attachments":attachments,"deptMailIds":deptEmailIds};
            $.ajax({
                url: SIH.getEndPoint("/api/auth/grievance/takeAction"),
                type: "POST",
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("X-Auth-Token", store.getItem("token"));
                    xhr.setRequestHeader("Content-type", "application/json");
                },
                data: JSON.stringify(data),
                success: function (response) {
                    $('#trackType').text('Status updated successfully');
                    $('#track-application-submitted-modal').modal('show');
                },error: function (response) {
                    bootbox.alert("Error while submitting, Please contact support team .", function () {
                        window.location.reload(true);
                    });
                }
            });
        }
    });
});
function getStatus(){
    $.ajax({
        url: SIH.getEndPoint("/api/noauth/lookup/grievance/action-status"),
        type: "GET",
        dataType: "json",
        success: function (response) {
            var items = response.data;

            $.each(items, function (i, item) {
                $('#selectstatus').append("<option value=" + item.key + ">" + item.title + "</option>");
            });
        },error: function (error) {
        }
    });
};

(function ($) {
    $(document).on("ready", function () {
        $('.partnership-banner .home-banner').prepend(`<div id="particles-js"></div>`);
        particlesJS("particles-js", {
            "particles": {
                "number": {
                    "value": 80,
                    "density": {
                        "enable": false,
                        "value_area": 800
                    }
                },
                "color": {
                    "value": "#ffffff"
                },
                "shape": {
                    "type": "circle",
                    "stroke": {
                        "width": 0,
                        "color": "#000000"
                    },
                    "polygon": {
                        "nb_sides": 5
                    },
                    "image": {
                        "src": "img/github.svg",
                        "width": 100,
                        "height": 100
                    }
                },
                "opacity": {
                    "value": 0.5,
                    "random": false,
                    "anim": {
                        "enable": false,
                        "speed": 1,
                        "opacity_min": 0.1,
                        "sync": false
                    }
                },
                "size": {
                    "value": 3,
                    "random": true,
                    "anim": {
                        "enable": false,
                        "speed": 40,
                        "size_min": 0.1,
                        "sync": false
                    }
                },
                "line_linked": {
                    "enable": true,
                    "distance": 150,
                    "color": "#ffffff",
                    "opacity": 0.4,
                    "width": 1
                },
                "move": {
                    "enable": true,
                    "speed": 3,
                    "direction": "none",
                    "random": false,
                    "straight": false,
                    "out_mode": "out",
                    "bounce": false,
                    "attract": {
                        "enable": false,
                        "rotateX": 600,
                        "rotateY": 1200
                    }
                }
            },
            "interactivity": {
                "detect_on": "canvas",
                "events": {
                    "onhover": {
                        "enable": false,
                        "mode": "repulse"
                    },
                    "onclick": {
                        "enable": false,
                        "mode": "push"
                    },
                    "resize": true
                },
                "modes": {
                    "grab": {
                        "distance": 400,
                        "line_linked": {
                            "opacity": 1
                        }
                    },
                    "bubble": {
                        "distance": 400,
                        "size": 40,
                        "duration": 2,
                        "opacity": 8,
                        "speed": 3
                    },
                    "repulse": {
                        "distance": 200,
                        "duration": 0.4
                    },
                    "push": {
                        "particles_nb": 4
                    },
                    "remove": {
                        "particles_nb": 2
                    }
                }
            },
            "retina_detect": true
        });
        var count_particles, stats, update;
        stats = new Stats;
        stats.setMode(0);
        stats.domElement.style.position = 'absolute';
        stats.domElement.style.left = '0px';
        stats.domElement.style.top = '0px';
        document.body.appendChild(stats.domElement);
        count_particles = document.querySelector('.js-count-particles');
        update = function () {
            stats.begin();
            stats.end();
            if (window.pJSDom[0].pJS.particles && window.pJSDom[0].pJS.particles.array) {
                count_particles.innerText = window.pJSDom[0].pJS.particles.array.length;
            }
            requestAnimationFrame(update);
        };
        requestAnimationFrame(update);
        
    });

    $( document ).ready(function() {
        var isMobile = window.matchMedia("(max-width: 767px)").matches;
        if (isMobile) {
            $('.reports-tab .reports-items').slick({
                infinite: false,
                speed: 300,
                slidesToShow: 1,
                slidesToScroll: 1,
                centerMode: true,
                dots: false,
                arrows: false,
                centerPadding: '60px',
            });
            $('.blogs-tab .blogs-items').slick({
                infinite: false,
                speed: 300,
                slidesToShow: 1,
                slidesToScroll: 1,
                centerMode: true,
                dots: false,
                arrows: false,
                centerPadding: '60px',
            })
            
            $('.resources-container #tab-1 a').click(function(){
                $('.blogs-tab .blogs-items').slick('unslick');
                $('.blogs-tab .blogs-items').slick({
                    infinite: false,
                    speed: 300,
                    slidesToShow: 1,
                    slidesToScroll: 1,
                    centerMode: true,
                    dots: false,
                    arrows: false,
                    centerPadding: '60px',
                })
            });
            $('.yt-playlist-card .inner').slick({
                infinite: false,
                    speed: 300,
                    slidesToShow: 1,
                    slidesToScroll: 1,
                    centerMode: true,
                    dots: false,
                    arrows: false,
                    centerPadding: '60px',
                });
        }
        
    });

    $(window).on('resize', function() {
        console.log('resize');
        
        var isMobile = window.matchMedia("(max-width: 767px)").matches;
        if (isMobile) {
           
            $('.reports-tab .reports-items').slick({
                infinite: false,    
                slidesToScroll: 1,
                centerMode: true,
                dots: false,
                arrows: false,
                centerPadding: '60px',
            });
            $('.blogs-tab .blogs-items').slick({
                infinite: false,
                speed: 300,
                slidesToShow: 1,
                slidesToScroll: 1,
                centerMode: true,
                dots: false,
                arrows: false,
                centerPadding: '60px',
            })
            
            $('.resources-container #tab-1 a').click(function(){
                $('.blogs-tab .blogs-items').slick('unslick');
                $('.blogs-tab .blogs-items').slick({
                    infinite: false,
                    speed: 300,
                    slidesToShow: 1,
                    slidesToScroll: 1,
                    centerMode: true,
                    dots: false,
                    arrows: false,
                    centerPadding: '60px',
                })
            });
            $('.yt-playlist-card .inner').slick({
                infinite: false,
                    speed: 300,
                    slidesToShow: 1,
                    slidesToScroll: 1,
                    centerMode: true,
                    dots: false,
                    arrows: false,
                    centerPadding: '60px',
                });
        }
    });

    $(window).on("load resize", function () {
        let containerW = $(".key-features .container").outerWidth();
        let windowW = $(window).width();
        let cornerW = (windowW - containerW) / 2;
        let sliderW = windowW - cornerW;
        $('.current-campaign-slider.container').css({
            "max-width": sliderW,
            "width": sliderW
        });
        $('.current-campaign-slider.container').closest('.row-container').addClass("clearfix");
        $('.current-campaign-slider').slick({
            infinite: true,
            speed: 300,
            slidesToShow: 3,
            slidesToScroll: 1,
            centerMode: false,
            dots: false,
            centerMode: true,
            centerPadding: '60px',

            responsive: [{
                    breakpoint: 768,
                    settings: {
                        slidesToShow: 2,
                        slidesToScroll: 1,
                        infinite: false,
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        slidesToShow: 1,
                        slidesToScroll: 1,
                        infinite: false,
                    }
                }
            ]
        });

        $(".current-campaign-slider .slick-next").css("right", `${cornerW + 15}px`);
        $(".current-campaign-slider .slick-prev").css("right", `${cornerW + 75}px`);
        
    });
    $('.logo-slider-wrap').slick({
        infinite: true,
        speed: 300,
        slidesToShow: 5,
        slidesToScroll: 5,
        centerMode: false,
        dots: false,
        variableWidth: false,
        responsive: [{
                breakpoint: 768,
                settings: {
                    slidesToShow: 2,
                    slidesToScroll: 1,
                    centerMode: true,
                }
            },
            {
                breakpoint: 480,
                settings: {
                    slidesToShow: 1,
                    slidesToScroll: 1,
                    centerMode: true,
                }
            }
        ]
    });

    try {
        $('.counter').counterUp({
            delay: 10,
            time: 1000
        });
    }catch (e) {
        
    }
    $(".testimonial-cards").mCustomScrollbar({'autoHideScrollbar':true});
})(jQuery);
// ===========================================================
/*
const $element = $('.unicorn-banner.partnership-banner img');
const imagePath = '/content/dam/invest-india/partnership/partner-banner';
const totalFrames = 112;
const animationDuration = 2000;
const timePerFrame = animationDuration / totalFrames;
let timeWhenLastUpdate;
let timeFromLastUpdate;
let frameNumber = 1;

// 'step' function will be called each time browser rerender the content
// we achieve that by passing 'step' as a parameter to the 'requestAnimationFrame' function
function step(startTime) {
    // 'startTime' is provided by requestAnimationName function, and we can consider it as current time
    // first of all we calculate how much time has passed from the last time when frame was update
    if (!timeWhenLastUpdate) timeWhenLastUpdate = startTime;
    timeFromLastUpdate = startTime - timeWhenLastUpdate;

    // then we check if it is time to update the frame
    if (timeFromLastUpdate > timePerFrame) {
        // and update it accordingly
        $element.attr('src', imagePath + `/partnership_banner_${frameNumber}.png`);
        // reset the last update time
        timeWhenLastUpdate = startTime;

        // then increase the frame number or reset it if it is the last frame
        if (frameNumber >= totalFrames) {
            frameNumber = 1;
        } else {
            frameNumber = frameNumber + 1;
        }
    }

    requestAnimationFrame(step);
}

// create a set of hidden divs
// and set their background-image attribute to required images
// that will force browser to download the images
$(document).ready(() => {
    for (var i = 00000; i < totalFrames + 1; i++) {
        $('body').append(`<div id="preload-image-${i}" style="background-image: url('${imagePath}/partnership_banner_${i}.png');"></div>`);
    }
});

// wait for images to be downloaded and start the animation
$(window).on('load', () => {
    requestAnimationFrame(step);
});*/

(function(){
    
   
    $(".offline-video-thumb .offline-play-pause").on("click",function(){
        $("#loginModal").modal('show');
    })
    $(window).load(function(){

        $(".hero-container .slick-slide").each(function(){
            
            if($(this).find(".offline-video-thumb").length){
                if(store.getItem("token")){
                    $(this).find(".offline-video-thumb").remove();
                }   
                else{
                    $(this).find(".off-videoContainer").remove();
                    // $("#videoContainer").remove();
                }
            }
        });
    })
    
    // $('.carouselherobanner .home-banner').on('beforeChange', function(event, slick, currentSlide, nextSlide){
    //     console.log(currentSlide);
    //     // #video.pause()
    //   });
})(jQuery);
// (function($){
// $(window).load(function(){
//     $('.inner-slider-wrap').not('.slick-initialized').slick({
//         infinite: true,
//         slidesToShow: 1,
//         slidesToScroll: 1,
//         prevArrow: '<div class="button-prev" style="display:none;">Previous Slide</div>',
//         nextArrow: '<div class="button-next" style="display:none;">Next Slide</div>',
//         autoplay: 1,
//         pauseOnHover:true,
//         responsive: [
//             {
//                 breakpoint: 767,
//                 settings: {
//                     adaptiveHeight: true
//                 }
//             }
//         ]
//     });
// });
// })(jQuery);




var player = {};
$(window).load(function () {

    $('.inner-slider-wrap').not('.slick-initialized').slick({
        infinite: true,
        slidesToShow: 1,
        dots:true,
        slidesToScroll: 1,
        prevArrow: '<div class="button-prev">Previous Slide</div>',
        nextArrow: '<div class="button-next">Next Slide</div>',
        autoplay: 1,
        responsive: [
            {
                breakpoint: 767,
                settings: {
                    adaptiveHeight: true
                }
            }
        ]
    });

    var playState = true;
    if ($(window).width() < 1024) {
        playState = false;
    }
    var muteState = true;
    var fullScreenPlayState = false;
    var fullScreen = false;
    var interval = null;
    var bannerTimer = null;
    var userPaused = false;
    var usercenterPaused = false;
    var isYoutubeVideo = false;
    var currentId = null;
    var isPlayerScriptLoaded = false;


    if ($('.video').length > 0) {
        var isVideo = $('.slick-active').find('video');
        $('.hero-container .black-bar').click(function (e) {

            if ($(window).width() > 1023) {
                playpauseHandle();
                if (e && e.hasOwnProperty('originalEvent')) {
                    usercenterPaused = !usercenterPaused;
                }
            }
        });
        if (isVideo.length && $(window).width() > 1023) {
            isVideo.get(0).play();
            isVideo.get(0).addEventListener('ended', addReplyButton);
        } else {
            isYoutubeVideo = true;
            var videoContainerCssId = $('.slick-active').find('.player-container').attr('id');
            currentId = videoContainerCssId;
            if (!player[currentId] && videoContainerCssId) {
                if (!isPlayerScriptLoaded) {
                    isPlayerScriptLoaded = true;
                    var tag = document.createElement('script');
                    tag.src = "https://www.youtube.com/iframe_api";
                    var firstScriptTag = document.getElementsByTagName('script')[0];
                    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
                    var videoSrc = $('.slick-active').find('#player-src').data('url');
                    if (!videoSrc) {
                        return;
                    }
                    var re = /https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube(?:-nocookie)?\.com\S*?[^\w\s-])([\w-]{11})(?=[^\w-]|$)(?![?=&+%\w.-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/ig;
                    var videoId = videoSrc.replace(re, '$1');

                    var url = document.createElement('a');
                    url.href = videoSrc;
                    var loop = getParameterFromUrl(url.search, "loop");

                    function getParameterFromUrl(url,name) {
                        var regexS = "[\\?&]" + name + "=([^&#]*)",
                            regex = new RegExp(regexS),
                            results = regex.exec(url);
                        if (results == null) {
                            return "";
                        } else {
                            return decodeURIComponent(results[1].replace(/\+/g, " "));
                        }
                    }

                    function onYouTubeIframeAPIReady() {
                        player[videoContainerCssId] = new YT.Player(videoContainerCssId, {
                            height: '453',
                            width: '100%',
                            videoId: videoId,
                            playerVars: {
                                autoplay: playState ? 1 : 0,
                                controls: 0,
                                mute: muteState ? 1 : 0,
                                showinfo: 0,
                                disablekb: 1,
                                rel: 0,
                                loop: loop ? 1 : 0,
                                playlist: videoId
                            },
                            events: {
                                'onReady': onPlayerReady,
                                'onStateChange': onPlayerStateChange
                            }
                        });

                        /*player[videoContainerCssId].cuePlaylist(videoId);
                        player[videoContainerCssId].setLoop(loop ? true : false);
                        console.log(player[videoContainerCssId].getPlaylist());*/
                    }
                }

                window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;

                function onPlayerReady(event) {
                }

                var done = false;

                function onPlayerStateChange(event) {
                    if (isYoutubeVideo) {
                        if (event.data == YT.PlayerState.PLAYING) {
                            if (!playState) {
                                $('.play-control').find('.control').toggleClass('pause play');
                                playState = !playState;
                                fullScreenPlayState = false;
                            }
                        }
                        if (event.data == YT.PlayerState.PAUSED) {
                            if (playState) {
                                $('.play-control').find('.control').toggleClass('pause play');
                                playState = !playState;
                                fullScreenPlayState = false;
                            }
                        }
                        if (event.data == YT.PlayerState.ENDED) {
                            addReplyButton();
                        }
                    }
                }
            } else {
                slideNext(this);
            }
        }

        /* var heroBanner = new Waypoint.Inview({
           element: document.querySelector('.home-hero-banner-content .button-next.slick-arrow'),
           enter: function (direction) {
             if(window.innerHeight != screen.height){
               if ($('.slick-current .control').hasClass('play') && !userPaused && !usercenterPaused) {
                 $('.slick-current .control').click();
               }
             }
           },
           exited: function (direction) {
             if(window.innerHeight != screen.height){
               if (!$('.slick-current .control').hasClass('play')) {
                 $('.slick-current .control').click();
               }
             }

           }
         });*/

        function bindFullScreenEvent() {
            document.removeEventListener("fullscreenchange", onFullScreenChange, false);
            document.removeEventListener("webkitfullscreenchange", onFullScreenChange, false);
            document.removeEventListener("mozfullscreenchange", onFullScreenChange, false);

            document.addEventListener("fullscreenchange", onFullScreenChange, false);
            document.addEventListener("webkitfullscreenchange", onFullScreenChange, false);
            document.addEventListener("mozfullscreenchange", onFullScreenChange, false);
        }

        function onFullScreenChange() {
            var fullscreenElement = document.fullscreenElement || document.mozFullScreenElement || document.webkitFullscreenElement;
            var videoElem = $('.slick-active').find('video');
            if (videoElem.length && !fullscreenElement) {
                var isMuted = videoElem.get(0).muted;
                var isPlaying = !videoElem.get(0).paused;
                muteState = isMuted;
                playState = isPlaying;
                if (isMuted) {
                    $('.volume').removeClass('unmute');
                }
                else {
                    $('.volume').addClass('unmute');
                }
                if (isPlaying) {
                    $('.play-control').find('.control').removeClass('play').addClass('pause');
                }
                else {
                    $('.play-control').find('.control').removeClass('pause').addClass('play');
                }
            }
        }

        $(document).idle({
            onIdle: function () {
                $('.hero-container').addClass('hideOnVideo')
            },
            onActive: function () {
                $('.hero-container').removeClass('hideOnVideo')
            },
            idle: 10000
        })
        bindFullScreenEvent();
        $(".slick-slider").on("beforeChange", function (event, slick, currentSlide, nextSlide) {

            var imgElem = $('.slick-active', this).find('.video');
            if (imgElem.length) {
                $('.home-banner').addClass('notVideo');
            }

            var videoElem = $('.slick-active', this).find('video');
            var imgWrapper = $('.slick-active', this).find('.images-wrapper');
            if (videoElem.length) {
                $('.coundownTimer').addClass('hideTimer');
                videoElem.get(0).pause();
                videoElem.get(0).removeEventListener('ended', addReplyButton);
            } else if (imgWrapper.length) {
                slideNext(this);
            } else if (isYoutubeVideo) {
                isYoutubeVideo = false;
                player[currentId] && player[currentId].pauseVideo && player[currentId].pauseVideo();
            }
        });

        $(".slick-slider").on("afterChange", function (e, slick, currentSlide) {
            var imgElem = $('.slick-active', this).find('.video');
            if (imgElem.length) {
                $('.home-banner').removeClass('notVideo');
            }


            /*var count = $('.slick-track .slick-slide',this).length;
            var curSlideIndex = parseInt($('.slick-track .slick-active',this).attr('data-slick-index'));
            if (curSlideIndex == 0) {
                $('.button-prev',this).hide();
                $('.button-next',this).show();
            }
            else {
                $('.button-prev',this).show();
            }

            //If we're on the last slide hide the Next button.
            if (count == curSlideIndex + 1) {
                $('.button-next',this).hide();
            }*/
            var videoElem = $('.slick-active', this).find('video');
            var imgWrapper = $('.slick-active', this).find('.images-wrapper');
            if (videoElem.length) {
                isYoutubeVideo = false;
                if (playState || fullScreenPlayState) {
                    videoElem.get(0).play();
                    $('.slick-active', this).find('.play-control').removeClass('replay').find('.control').removeClass('play').addClass('pause');
                    playState = true;
                }
                videoElem.get(0).addEventListener('ended', addReplyButton);
                videoElem.get(0).muted = muteState;

            }
            else if (imgWrapper.length) {
                slideNext(this);
            }
            else {
                /* case for rendering youtube player */

                isYoutubeVideo = true;
                var videoContainerCssId = $('.slick-active', this).find('.player-container').attr('id');
                currentId = videoContainerCssId;
                if (!player[currentId]) {

                    if (!isPlayerScriptLoaded) {
                        isPlayerScriptLoaded = true;
                        var tag = document.createElement('script');
                        tag.src = "https://www.youtube.com/iframe_api";
                        var firstScriptTag = document.getElementsByTagName('script')[0];
                        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
                        var videoSrc = $('.slick-active').find('#player-src').data('url');
                        if (!videoSrc) {
                            return;
                        }
                        var re = /https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube(?:-nocookie)?\.com\S*?[^\w\s-])([\w-]{11})(?=[^\w-]|$)(?![?=&+%\w.-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/ig;
                        var videoId = videoSrc.replace(re, '$1');

                        function onYouTubeIframeAPIReady() {
                            player[videoContainerCssId] = new YT.Player(videoContainerCssId, {
                                height: '100%',
                                width: '100%',
                                videoId: videoId,
                                playerVars: {
                                    autoplay: playState ? 1 : 0,
                                    controls: 0,
                                    mute: muteState ? 1 : 0,
                                    showinfo: 0,
                                    disablekb: 1,
                                    rel: 0
                                },
                                events: {
                                    'onReady': onPlayerReady,
                                    'onStateChange': onPlayerStateChange
                                }
                            });
                        }
                    } else {
                        var videoSrc = $('.slick-active', this).find('#player-src').data('url');
                        if (!videoSrc) {
                            return;
                        }
                        var re = /https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube(?:-nocookie)?\.com\S*?[^\w\s-])([\w-]{11})(?=[^\w-]|$)(?![?=&+%\w.-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/ig;
                        var videoId = videoSrc.replace(re, '$1');
                        player[videoContainerCssId] = new YT.Player(videoContainerCssId, {
                            height: '100%',
                            width: '100%',
                            videoId: videoId,
                            playerVars: {
                                autoplay: playState ? 1 : 0,
                                controls: 0,
                                mute: muteState ? 1 : 0,
                                showinfo: 0,
                                disablekb: 1,
                                rel: 0
                            },
                            events: {
                                'onReady': onPlayerReady,
                                'onStateChange': onPlayerStateChange
                            }
                        });

                    }

                    window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;

                    function onPlayerReady(event) {

                    }

                    var done = false;

                    function onPlayerStateChange(event) {
                        if (isYoutubeVideo) {
                            if (event.data == YT.PlayerState.PLAYING) {
                                if (!playState) {
                                    $('.play-control').find('.control').toggleClass('pause play');
                                    playState = !playState;
                                    fullScreenPlayState = false;
                                }
                            }
                            if (event.data == YT.PlayerState.PAUSED) {
                                if (playState) {
                                    $('.play-control').find('.control').toggleClass('pause play');
                                    playState = !playState;
                                    fullScreenPlayState = false;
                                }
                            }
                            if (event.data == YT.PlayerState.ENDED) {
                                addReplyButton();
                            }
                        }
                    }
                } else {
                    if (playState) {
                        $('.slick-active').find('.play-control').removeClass('replay').find('.control').removeClass('play').addClass('pause');
                        player[currentId].playVideo();
                        if (muteState) {
                            player[currentId].mute();
                        } else {
                            player[currentId].unMute();
                        }
                    }
                }
            }
        });
    }

    //End

    function addReplyButton() {
        $('.slick-active').find('.play-control').addClass('replay');
        var videoElem = $('.slick-active').find('video').get(0);
        fullScreenPlayState = true;

        var exitFullScreen = document.exitFullscreen || document.mozCancelFullScreen || document.webkitExitFullscreen || document.msExitFullscreen;
        if (exitFullScreen) {
            exitFullScreen.call(document);
        }
        bannerTimer = setTimeout(function () {
            $('.home-banner').slick('next')
        }, 5000)
        //coundownTimer();
    }

    function slideNext(thisObj) {
        /* setTimeout(function () {
             $('.home-banner',thisObj).slick('next')
         }, 10000);*/
    }


    function addVideEndEvent() {
        var isVideo = $('.slick-active').find('video');
        if (isVideo.length) {
            isVideo.get(0).addEventListener('ended', addReplyButton);
        }
    }

    /*Playpause handling function*/
    function playpauseHandle(e) {
        $('.play-control').find('.control').toggleClass('pause play');
        clearTimeout(bannerTimer);
        var isVideo = $('.slick-active').find('video');
        var isReplayActive = $(this).hasClass('replay');
        if (isReplayActive) {
            if (isYoutubeVideo) {
                player[currentId].playVideo();
            } else {
                isVideo.get(0).play();
            }
            $(this).removeClass('replay').find('.control').removeClass('play').addClass('pause');
            return;
        }
        $(this).removeClass('replay');
        playState = !playState;
        if (e && e.hasOwnProperty('originalEvent')) {
            userPaused = !userPaused;
            usercenterPaused = !usercenterPaused;
        }

        fullScreenPlayState = false;
        if (isYoutubeVideo) {
            if (playState) {
                if (player[currentId]) {
                    player[currentId].playVideo();
                }
            }
            else {
                player[currentId].pauseVideo();
            }
        } else {
            if (playState) {
                isVideo.get(0).play();
            }
            else {
                isVideo.get(0).pause();
            }
        }
    }

    $('body').on("click", '.hero-container .play-control', playpauseHandle)

    $('body').on("click", '.hero-container .volume', function () {
        $('.volume').toggleClass('unmute');
        var isVideo = $('.slick-active').find('video');
        muteState = !muteState;
        if (isYoutubeVideo) {
            if (muteState) {
                player[currentId].mute()
            }
            else {
                player[currentId].unMute()
            }
        } else {
            if (muteState) {
                isVideo.get(0).muted = true;
            }
            else {
                isVideo.get(0).muted = false;
            }
        }
    });

    $("body").on('click', '.hero-container #fullScreen', function () {
        if (isYoutubeVideo) {
            var playerElement = $('.slick-active').find('#' + currentId).get(0);
            var requestFullScreen = playerElement.requestFullScreen || playerElement.mozRequestFullScreen || playerElement.webkitRequestFullScreen;
            if (requestFullScreen) {
                requestFullScreen.bind(playerElement)();
            }
        } else {
            var videoElem = $('.slick-active').find('video').get(0);
            var isFullScreenAllow = videoElem.requestFullscreen || videoElem.mozRequestFullScreen || videoElem.webkitRequestFullscreen;
            if (isFullScreenAllow) {
                isFullScreenAllow.call(videoElem);
            }
            else {
                alert('full screen not supported by browser')
            }
        }
    });
    if(onYouTubeIframeAPIReady) {
        onYouTubeIframeAPIReady();
    }
    $('.covid-session .dynamicTabs .desktop-tabs').click(function(){
        
        // $('.blogs-tab .blogs-items').slick('unslick');
        $('.tab-content').find(".static-content-section.active").find(".inner-slider-wrap").slick('unslick');
        $('.tab-content').find(".static-content-section.active").find(".inner-slider-wrap").slick({
            infinite: true,
            slidesToShow: 1,
            dots:true,
            slidesToScroll: 1,
            prevArrow: '<div class="button-prev">Previous Slide</div>',
            nextArrow: '<div class="button-next">Next Slide</div>',
            autoplay: 1,
            responsive: [
                {
                    breakpoint: 767,
                    settings: {
                        adaptiveHeight: true
                    }
                }
            ]
        });
        $('.tab-content').find(".static-content-section.active").find(".home-banner").slick('unslick');
        $('.tab-content').find(".static-content-section.active").find(".home-banner").slick({
            infinite: true,
            slidesToShow: 1,
            slidesToScroll: 1,
            prevArrow: '<div class="button-prev">Previous Slide</div>',
            nextArrow: '<div class="button-next">Next Slide</div>',
            autoplay: 0,
            responsive: [
                {
                    breakpoint: 767,
                    settings: {
                        adaptiveHeight: true
                    }
                }
            ]
        });
    })
});

$(window).load(function(){
    if( window.location.pathname == '/content/sih/en/home-page.html' || window.location.href == 'https://www.startupindia.gov.in/')
    $("#covid-popup").modal("show");
});

